var AL={config:{},socialMedia:{show:function(a){if(a||!Ext.util.Cookies.get("social-media-closed")){Ext.getBody().addCls("display-social-media")}},hide:function(b){var a=Ext.getBody();a.removeCls("display-social-media");if(b){Ext.util.Cookies.set("social-media-closed",true)}},onButtonClick:function(a){Ext.Ajax.request({url:"/user/shared-tweeted/format/json",method:"POST",success:function(b,c){},failure:function(){}})}},date:function(){var b=null;if(arguments.length==1&&typeof arguments[0]=="string"){var a=arguments[0].split("-");if(a.length==3){b=new Date(a[0],(parseInt(a[1])-1),a[2])}else{throw"Argument format must be yyyy-mm-dd"}}else{if(typeof arguments[0]=="object"){b=new Date(arguments[0])}else{throw'Argument not supported. Expected "yyyy-mm-dd"'}}return b},math:{add:function(d,c,a){d=Big.parse(d);c=Big.parse(c);var b=parseFloat(d)+parseFloat(c);return parseFloat(b.toString())},sub:function(d,c,a){d=Big.parse(d);c=Big.parse(c);var b=parseFloat(d)-parseFloat(c);return parseFloat(b.toString())},mul:function(d,c,a){d=Big.parse(d);c=Big.parse(c);var b=d.times(c);return parseFloat(b.toString())},div:function(d,c,a){d=Big.parse(d);c=Big.parse(c);var b=d.over(c);return parseFloat(b.toString())},approx:function(g,b,a){a=parseInt(a);var h=g<0?-0.5:0.5;var f=AL.config.decimalPrecision;if(a===0||a>0){f=a}var e=Math.pow(10,f);g=new Big(g);e=new Big(e);h=new Big(h);var c=parseInt(g.times(e).plus(h).toString());var d=Big.parse(c).over(e);return parseFloat(d.toString())},comp:function(c,b,a){if(c<b){return -1}else{if(c>b){return 1}else{return 0}}}},format:{valueForGraph:function(d,c){c=c||1;var a=[{value:1000000000000000000,symbol:"E"},{value:1000000000000000,symbol:"P"},{value:1000000000000,symbol:"T"},{value:1000000000,symbol:"G"},{value:1000000,symbol:"M"},{value:1000,symbol:"K"}],e=/\.0+$|(\.[0-9]*[1-9])0+$/,b;for(b=0;b<a.length;b++){if(d>=a[b].value){return(d/a[b].value).toFixed(c).replace(e,"$1")+a[b].symbol}}return d.toFixed(c).replace(e,"$1")},ellipsis:function(d,c,a){if(d.length<=c){return d}var e=d.substr(0,c-a-3),b=a?d.substr(-a,a):"";return e+"..."+b}},util:{date:{getMonths:function(d){d=d-1||0;var a=[translate("january",true),translate("february",true),translate("march",true),translate("april",true),translate("may",true),translate("june",true),translate("july",true),translate("august",true),translate("september",true),translate("october",true),translate("november",true),translate("december",true)];var b=a.slice(d,a.length);var c=b.concat(a.slice(0,d));return c},getMonthName:function(b){var a=[translate("january",true),translate("february",true),translate("march",true),translate("april",true),translate("may",true),translate("june",true),translate("july",true),translate("august",true),translate("september",true),translate("october",true),translate("november",true),translate("december",true)];if(!a[b]){return}return a[b]},getQuarterName:function(a){var b=["Q1","Q2","Q3","Q4"];if(!b[a]){return}return b[a]},getDayName:function(a){var b=[translate("sunday",true),translate("monday",true),translate("tuesday",true),translate("wednesday",true),translate("thursday",true),translate("friday",true),translate("saturday",true)];if(!b[a]){return}return b[a]}}},string:{toCapitalizeFirstWord:function(b){if(!b){return}var a=b.toLocaleLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)},getRegexForEscapeAccents:function(b){if(!b){return}var a=["aáàâåäã","eéèêë","iíìîï","oóòôöõ","uúùûü","cç","nñ"];Ext.Array.each(a,function(c){v="["+c+"]";p=new RegExp("["+c+"]","gi");b=b.replace(p,v)});b="("+b+")";return new RegExp(b,"gi")}}};Ext.define("MenuManager",{singleton:true,activateMainMenuByText:function(c,a){a=!a?"span":a;var b=Ext.dom.Query.select("ul.accordion > li > label > "+a+":nodeValue("+c+")")[0];if(b){Ext.get(b.parentNode.parentNode).addCls("active");b.parentNode.parentNode.firstElementChild.checked=true}},activateSubMenuByText:function(b){var a=Ext.dom.Query.select("ul.accordion > li > ul > li > a:nodeValue("+b+")")[0];if(a){Ext.get(a.parentNode).addCls("active")}},activateWarehouseTransferSubMenu:function(){var a={tag:"li",cls:"active",children:[{tag:"a",href:"/warehouse/index-transfer",html:translate("warehouseTransfer",true)}]};var b=Ext.get(Ext.dom.Query.select("nav  ul.primary .active .secondary"));b.appendChild(a)},activateConfigurationMenu:function(){if(AL.config.currentKeyCountry=="usa"){var a=Ext.get(Ext.dom.Query.select("nav ul.secondary .retentionMenu"));a.remove()}}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("AL","/js/app/app");Ext.QuickTips.init();Ext.tip.QuickTipManager.init();Ext.override(Ext.view.Table,{loadingText:translate("loading",true)});Ext.override(Ext.toolbar.Paging,{emptyMsg:"",displayInfo:true,dock:"bottom",hideFirstButton:false,hidePrevButton:false,hideBeforePageText:false,hidePageNumberField:false,hideAfterPageText:false,hideNextButton:false,hideLastButton:false,hideRefreshButton:false,getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",hidden:a.hideFirstButton,disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",hidden:a.hidePrevButton,disabled:true,handler:a.movePrevious,scope:a},{xtype:"tbseparator",hidden:a.hideFirstButton&&a.hidePrevButton},{xtype:"tbtext",text:a.beforePageText,hidden:a.hideBeforePageText},{xtype:"numberfield",itemId:"inputItem",name:"inputItem",hidden:a.hidePageNumberField,cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,isFormField:false,width:a.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",hidden:a.hideAfterPageText,text:Ext.String.format(a.afterPageText,1)},{xtype:"tbseparator",hidden:a.hideNextButton&&a.hideLastButton},{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",hidden:a.hideNextButton,disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",hidden:a.hideLastButton,disabled:true,handler:a.moveLast,scope:a},{xtype:"tbseparator",hidden:a.hideRefreshButton},{itemId:"refresh",hidden:a.hideRefreshButton,tooltip:a.refreshText,overflowText:a.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",handler:a.doRefresh,scope:a}]}});Ext.override(Ext.grid.Panel,{columnLines:true});Ext.override(Ext.grid.column.Column,{menuDisabled:true});Ext.define("TooltipManager",{singleton:true,createTooltip:function(c,f){var b=(Ext.isObject(c)&&c.title)?c.title:"";var d="";if(Ext.isObject(c)&&c.description&&Ext.isString(c.description)){d=c.description}else{d=(Ext.isString(c))?c:""}var g="";if(Ext.isObject(c)&&c.cls&&Ext.isString(c.cls)){g=c.cls}var a=new Ext.XTemplate(['<div class="{cls}">','<tpl if="tooltipTitle"><h1>{tooltipTitle}</h1></tpl>',"<div>{tooltipDescription}</div>","</div>"]);var e=Ext.create("Ext.tip.ToolTip",{tpl:a,autoHide:true,closable:false});e.update({cls:g,tooltipTitle:b,tooltipDescription:d});if(f){e.setTarget(f)}return e},scanAndApplyMarkupTooltips:function(){var a=Ext.dom.Query.select("*[title]");Ext.each(a,function(c){var d=c.getAttribute("title");c.setAttribute("title","");var b={};b.description=d;if(c.getAttribute("data-tooltip-title")){b.title=c.getAttribute("data-tooltip-title")}this.createTooltip(b,c)},this)}});Ext.override(Ext.Component,{onRender:function(){this.callParent(arguments);var b=this;if(b.tooltip){var a=b.getEl();var d={tag:"td",children:[{tag:"span",id:b.getId()+"-help",html:"",cls:"icon-help",style:"cursor:help;width:21px;padding:10px; margin-left:10px"}]};switch(a.dom.tagName){case"TABLE":Ext.DomHelper.append(a.down("tr").dom,d);break;default:}var c=TooltipManager.createTooltip(b.tooltip,b.getId()+"-help");c.setVisibleIconHelp=function(f){var e=Ext.get(b.getId()+"-help");e.setVisible(f)};if(b.tooltip.visible===false){c.setVisibleIconHelp(false)}this.tooltip=c}}});Ext.override(Ext.form.field.Base,{labelSeparator:"",onRender:function(){this.callParent(arguments);var a=this;if(a.isFormField&&a.fieldLabel&&a.allowBlank===false){a.setFieldLabel(a.fieldLabel+'<span class="req">*</span>')}}});Ext.override(Ext.form.ComboBox,{assertValue:function(){var b=this.getRawValue(),a;if(this.forceSelection&&this.multiSelect){if(b!==this.getDisplayValue()){me.setRawValue(this.getDisplayValue())}}else{if(this.valueField&&Ext.isDefined(this.value)){a=this.findRecord(this.valueField,this.value)}if(!a||a.get(this.displayField)!=b){a=this.findRecord(this.displayField,b)}if(!a&&this.forceSelection){if(b.length>0&&b!=this.emptyText){this.el.dom.value=Ext.value(this.lastSelectionText,"");this.applyEmptyText()}else{this.clearValue()}}else{if(a&&this.valueField){b=a.get(this.valueField);if(this.value==b){return}}this.setValue(b)}}}});Ext.override(Ext.form.ComboBox,{getSelectedRecord:function(){return this.findRecordByValue(this.getValue())}});Ext.override(Ext.data.Store,{hasLoaded:function(){if(this.isLoading()||this.getCount()==0){return false}else{return true}}});Ext.override(Ext.chart.LegendItem,{getBBox:function(){var e=0,m,h,j=this.items,f=this.length,g=Infinity,c=g,l=-g,b=g,k=-g,d,a;for(;e<f;e++){m=j[e];if(m.el){h=m.getBBox();c=Math.min(c,h.x);b=Math.min(b,h.y);l=Math.max(l,h.height+h.y);k=Math.max(k,h.width+h.x)}}return{x:c,y:b,height:l-b,width:this.legend.configs&&this.legend.configs.width?this.legend.configs.width:k-c}},onMouseDown:function(g,f,j,i,h){if(this.legend.clickable!==false){this.callParent(arguments)}},onMouseOver:function(){if(this.legend.clickable!==false){this.callParent(arguments)}},onMouseOut:function(){if(this.legend.clickable!==false){this.callParent(arguments)}}});Ext.define("AL.chart.theme.CustomTheme",{extend:"Ext.chart.theme.Base",constructor:function(a){this.callParent([Ext.apply({colors:this.colors},a)])}});Ext.define("Ext.chart.theme.IncomeTheme",{extend:"AL.chart.theme.CustomTheme",colors:["#BDE3DC","#00B19D","#008E79","#BFCD31","#809BB6","#00535E"]});Ext.define("Ext.chart.theme.ExpenseTheme",{extend:"AL.chart.theme.CustomTheme",colors:["#F26A4F","#FFB05B","#D37863","#F9CA93","#F9D863","#F7E49E"]});Ext.define("Ext.chart.theme.IncomeExpenseTheme",{extend:"AL.chart.theme.CustomTheme",colors:["#00B19D","#F26A4F"]});Ext.define("TooltipAlegra",{singleton:true,addNewTooltip:function(a,c,b){var e=Ext.get(Ext.dom.Query.select(a));var d=Ext.create("Ext.tip.ToolTip",{html:b,closable:false,cls:"tooltip-text-wrapper"});var f={tag:"img",id:d.getId()+"-img",src:"https://cdn1.getsoft.app/images/sm-help.png",style:c};e.appendChild(f);d.setTarget(d.getId()+"-img");d.on("show",function(){Ext.get(d.getId()).on("mouseover",function(){d.show()});Ext.get(d.getId()).on("mouseout",function(){d.hide()})})}});Ext.define("AL.modal.Plans",{text:"",descrtiption:"",closable:"no",mailCompany:"",discount:0,canPayOnWebsite:true,hasPosAvailable:false,hasFeAside:false,constructor:function(a){this.text=a.text;this.description=a.description;if(a.closable){this.closable=a.closable}if(a.discount){this.discount=a.discount}this.mailCompany=a.mailCompany;if(typeof a.canPayOnWebsite!=="undefined"){this.canPayOnWebsite=a.canPayOnWebsite}if(typeof a.hasPosAvailable!=="undefined"){this.hasPosAvailable=a.hasPosAvailable}if(typeof a.hasFeAside!=="undefined"){this.hasFeAside=a.hasFeAside}this.companyKeyCountry=a.companyKeyCountry},init:function(){var a=this,b="";if(a.mailCompany){b=a.mailCompany}Ext.Ajax.request({url:"/plan/retrieve-all-features-for-modal/format/json",params:{mailCompany:b},success:function(c,d){var l=Ext.decode(c.responseText);var x=l.results.plansFeatures;var e=l.results.hiddenPlans;var k=l.myPlan;var r=[];var j=0;var o=a.text;var t=a.description;r.push({tag:"div",cls:"smile-modal-header",id:"smile-modal-header",children:[{tag:"h1",html:o+" <b>"+k+"</b>"},{tag:"h2",html:translate("chooseOneOfOurPlansAndKeepGrowingWithAlegra")}]});var y=e.length>0?true:false;Ext.each(x,function(H){var F="";var J="";if(H.name==="PLAN PRO"){F="plans-Recommended";J='<div><svg width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg">                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.64981 6.87472L6.49652 10.3106L4.51732 7.45455L0.94926 7.5988L3.1618 4.68057L2.10892 1.33383L5.45565 2.38671L8.37388 0.174175L8.22963 3.74224L11.0856 5.72143L7.64981 6.87472Z" fill="white"/>                        </svg> <span>SUGERIDO</span></div>'}var D={tag:"div",cls:F,html:J};var K=H.name==="PLAN GRATIS"?"plan-free":"";var I=H.currency==="MXN"?" plan-modal-currency-MXN ":"";var G="";var A="";if(a.discount){A="*";G='<div style="font-size: 13px; padding-top: 5px;">*Descuento del '+a.discount+"% ya aplicado</div>"}var E='<h1 class="'+I+'">'+H.price+A+"</h1>\n                                <h3>/ MES</h3> "+G+"<hr>";var C={tag:"ul",cls:" plans-table-content  plans-table-bl",children:[{tag:"div",cls:"bar"},D,{tag:"li",cls:K,html:"<h2>"+H.name.replace("PLAN","")+"</h2>"+E}]};Ext.each(H.features,function(L){if(L.text!="X"){C.children.push({tag:L.tag,cls:L.cls+" plan-li ",html:L.text})}});var B={tag:"div",cls:"plans-content",children:[C]};var z=(H.pay==="yes")?"/membership/payment-checkout/idPlan/"+H.id:"/index";if(a.canPayOnWebsite){C.children.push({tag:"p",children:[{tag:"br"},{tag:"a",cls:H.name==="PLAN PRO"?"button-hightlighted":"boton-ok",html:"ELEGIR PLAN",href:z}]})}r.push(B);j=j+1});var q="<strong>¿No sabes cuál elegir?</strong> Nosotros te asesoramos.";if(!a.canPayOnWebsite){q="<strong>¡Escríbenos!</strong> Te activaremos el plan que elijas."}plansContainerTablesChildren=[r,{tag:"div"}];if(a.hasPosAvailable){plansContainerTablesChildren.push({tag:"div",style:"width: 100%; text-align: center;",html:'<p style="color: #FFF; font-size: 15px; font-family: Roboto; line-height: 21px; margin-top: 30px;">(*) La cantidad de ventas para el '+translate("pointOfSaleSystem")+" está incluida en el límite del plan</p>"})}if(a.hasFeAside){plansContainerTablesChildren.push({tag:"div",style:"width: 100%; text-align: center;",html:'<p style="color: #FFF;font-size: 15px;font-family: Roboto;line-height: 21px;margin: 15px 0;">Si deseas facturación electrónica puedes activarla al elegir tu plan</p>'})}else{if(a.companyKeyCountry==="peru"){plansContainerTablesChildren.push({tag:"div",style:"width: 100%; text-align: center;",html:'<p style="color: #FFF;font-size: 15px;font-family: Roboto;line-height: 21px;margin: 15px 0;">Todos nuestros planes incluyen comprobantes electrónicos con validación OSE</p>'})}}if(y){plansContainerTablesChildren.push({tag:"div",style:"width: 100%; text-align: center;font-size:17px;",html:'<p style="font-weight: 300;color: #00535E !important;">Ver otros planes disponibles <a href="/plan" style="text-decoration: none; font-weight: bold;">aquí</a></p>'})}var u={tag:"div",id:"plans-modal-wrapper",cls:"smile-plans",children:[{tag:"div",id:"plans-modal",children:[{tag:"div",id:"plans-modal-header",style:"display:none",children:[{tag:"div",cls:"plans-container",children:[{tag:"div",id:"plans-title"},{tag:"div",id:"plans-logo"},{tag:"div",id:"plans-modal-person"},{tag:"div",id:"plans-phrase1",children:[{tag:"img",src:"https://cdn1.getsoft.app/images/plans-exclamation-symbol.png",width:"32",height:"32"},{tag:"div",id:"plans-text1",children:[{tag:"p",cls:"",html:o},{tag:"p",cls:"plans-green-dark",children:[{tag:"strong",cls:"",html:t}]}]}]},{tag:"div",id:"plans-phrase2",children:[{tag:"div",id:"plans-text2",children:[{tag:"p",cls:"margin-bottom",html:"Selecciona tu plan"},{tag:"p",cls:"margin-top",html:"...y <strong>sigue creciendo</strong> con Alegra"}]}]}]}]},{tag:"div",id:"plans-container-modal-tables",cls:x.length%2==0?"plans-container-modal-tables-padding":"",style:" color:white;",children:plansContainerTablesChildren},{tag:"div",cls:"plans-phrase-choose-container",children:[{tag:"h1",cls:"plans-phrase-choose",html:q},{tag:"p",cls:"center support-button",children:[{tag:"a",cls:"plans-alegra123",html:'Contactar a soporte <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.00093 9.18202L2.66663 5.79584V11.1098C2.66663 11.6552 3.11511 12.094 3.66541 12.094H12.3321C12.8872 12.094 13.3333 11.6552 13.3333 11.1098V5.79584L8.00093 9.18202ZM3.66541 3.3338C3.1505 3.3338 2.72675 3.72022 2.67293 4.21477C2.67002 4.24871 2.66663 4.28119 2.66663 4.31804L8.00093 7.7018L13.3333 4.31804C13.3333 4.27974 13.3318 4.24434 13.327 4.20798C13.2712 3.71828 12.8494 3.33331 12.3316 3.33331H3.66541V3.3338Z" fill="white"/>                                                    </svg>                                                    ',id:"modal-button-alegra123"}]}]}]}]};var w=Ext.DomHelper;w.append(Ext.getBody(),u);if(a.closable=="yes"){var m='<div class="close-button-modal"><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">                        <path fill-rule="evenodd" clip-rule="evenodd" d="M18.8269 6.86792L17.3679 5.5L12.4135 10.7848L7.45898 5.5L6 6.86792L11.0427 12.2468L6 17.6257L7.45911 18.9937L12.4135 13.709L17.3678 18.9937L18.8269 17.6257L13.7842 12.2468L18.8269 6.86792Z" fill="#CCCCCC"/>                        </svg>                    </div>';var g=Ext.getElementById("smile-modal-header");w.insertHtml("beforeEnd",g,m);var f=Ext.get(Ext.dom.Query.select(".close-button-modal")[0]);var s=Ext.dom.Query.select("#modal-button-alegra123");Ext.each(s,function(A){var z=Ext.get(A);z.on("click",function(C){var B=Ext.get(Ext.dom.Query.select("#plans-modal-wrapper")[0]);B.remove();C.preventDefault();Ext.create("AL.view.support.WindowCreateSupportTicket")})});f.on("click",function(){var z=Ext.get(Ext.dom.Query.select("#plans-modal-wrapper")[0]);Ext.Ajax.request({url:"/company/no-more-modal-plans/format/json",method:"POST",success:function(){z.remove()}})})}else{var h=Ext.get(Ext.dom.Query.select("#modal-button-alegra123")[0]);h.on("click",function(A){if(a.mailCompany){window.open("http://www.getsoft.app/123")}else{var z=Ext.get(Ext.dom.Query.select("#plans-modal-wrapper")[0]);z.remove();A.preventDefault();Ext.create("AL.view.support.WindowCreateSupportTicket")}})}var i=Ext.select(".plan-ui");Ext.each(i.elements,function(z){z=Ext.get(z);z.on("mouseover",function(){var A=Ext.select(".selected");if(A){Ext.get(A).removeCls("selected")}});z.on("click",function(){Ext.Ajax.request({url:"/company/no-more-modal-plans/format/json",method:"POST",success:function(){var A=Ext.get(z.down(".link"));window.location=A.dom.firstChild.href}})})});var n=Ext.get(Ext.dom.Query.select(".link"));n.on("click",function(A,z){A.preventDefault();Ext.Ajax.request({url:"/company/no-more-modal-plans/format/json",method:"POST",success:function(){window.location=z.href}})})}})}});Ext.define("AL.modal.PlansApiCamComercio",{closable:"no",text:"TU PERÍODO DE PRUEBA HA CONCLUIDO.",constructor:function(a){if(a.closable){this.closable=a.closable}if(a.text){this.text="Esta acción no está disponible en tu plan actual"}},init:function(){var f=this;var e={tag:"div",id:"plans-modal-wrapper",children:[{tag:"div",id:"plans-modal",children:[{tag:"div",id:"plans-modal-header",children:[{tag:"div",cls:"plans-container",children:[{tag:"div",id:"plans-title"},{tag:"div",id:"plans-logo"},{tag:"div",id:"plans-modal-person"},{tag:"div",id:"plans-phrase1",children:[{tag:"img",src:"https://cdn1.getsoft.app/images/plans-exclamation-symbol.png",width:"32",height:"32"},{tag:"div",id:"plans-text1",children:[{tag:"p",cls:"",html:f.text,style:"line-height: 26px;"}]}]},{tag:"div",id:"plans-phrase2",style:"border-radius: 10px;",children:[{tag:"div",id:"plans-text2",children:[{tag:"p",cls:"margin-bottom",html:"Te invitamos a realizar"},{tag:"p",cls:"margin-top",html:'el pago de tu plan <a style="font-weight: 700; color: #fff;" target="_blank" href="http://herramientas.camaramedellin.com.co/Inicio/Software/Alegra.aspx">aquí</a>.'}]}]}]}]},{tag:"div",id:"plans-container-modal-tables",style:"color: white; background-color: transparent;",children:[{tag:"div"}]},{tag:"h1",cls:"plans-phrase-choose",html:"¿Tienes dudas? <strong> Nosotros te asesoramos</strong>."},{tag:"p",cls:"center",children:[{tag:"a",cls:"plans-alegra123",html:"getsoft.app/123",id:"modal-button-alegra123"}]}]}]};var g=Ext.DomHelper;g.append(Ext.getBody(),e);if(f.closable=="yes"){var c='<div style="cursor: pointer;" class="close-button-modal"><img src="https://cdn1.getsoft.app/images/welcome-wizard/new-wizard-close-x.png"></div>';var b=Ext.getElementById("plans-modal-header");g.insertHtml("beforeEnd",b,c);var a=Ext.get(Ext.dom.Query.select(".close-button-modal")[0]);a.on("click",function(){var h=Ext.get(Ext.dom.Query.select("#plans-modal-wrapper")[0]);Ext.Ajax.request({url:"/company/no-more-modal-plans/format/json",method:"POST",success:function(){h.remove()}})})}var d=Ext.get(Ext.dom.Query.select("#modal-button-alegra123")[0]);d.on("click",function(i){var h=Ext.get(Ext.dom.Query.select("#plans-modal-wrapper")[0]);h.remove();i.preventDefault();Ext.create("AL.view.support.WindowCreateSupportTicket")})}});Ext.define("AL.welcome.Wizard",{currentStep:"",constructor:function(a){this.companyName=a.configs.companyName;this.country=a.configs.country;this.regime=a.configs.regime;this.city=a.configs.city;this.address=a.configs.address;this.addressObject=a.configs.addressObject;this.sector=a.configs.sector;this.phone=a.configs.phone;this.countryCode=a.configs.countryCode;this.showForms=a.configs.showForms;this.canSeeVideo=a.configs.canSeeVideo;this.mxState=a.configs.mxState;this.originKeyword=a.configs.originKeyword;this.ivaCondition=a.configs.ivaCondition},init:function(){var l=[];l.push({tag:"option",html:translate("select",true),value:""});l.push({tag:"option",html:translate("sector.agricultureLivestock",true),value:"Agricultura / Ganadería"});l.push({tag:"option",html:translate("sector.foodGastronomy",true),value:"Alimentación / Gastronomía"});l.push({tag:"option",html:translate("sector.architectureConstruction",true),value:"Arquitectura / Construcción"});l.push({tag:"option",html:translate("sector.artsCrafts",true),value:"Artes / Manualidades"});l.push({tag:"option",html:translate("sector.motorsAndParts",true),value:"Automotores y partes"});if(AL.config.currentKeyCountry=="mexico"){l.push({tag:"option",html:translate("sector.retailTrade",true),value:"Comercio al detalle"})}else{l.push({tag:"option",html:translate("sector.retail",true),value:"Comercio al detal"})}l.push({tag:"option",html:translate("sector.eCommerce",true),value:"Comercio electrónico"});l.push({tag:"option",html:translate("sector.consulting",true),value:"Consultoría"});l.push({tag:"option",html:translate("sector.personalCareAestheticsHealth",true),value:"Cuidado personal / Estética / Salud"});l.push({tag:"option",html:translate("sector.education",true),value:"Educación"});l.push({tag:"option",html:translate("sector.entertainment",true),value:"Entretenimiento"});l.push({tag:"option",html:translate("sector.hotelTourism",true),value:"Hotelería / Turismo"});l.push({tag:"option",html:translate("sector.manufacturing",true),value:"Manufactura"});l.push({tag:"option",html:translate("sector.nonGovernmentalOrganization",true),value:"Organización no gubernamental"});l.push({tag:"option",html:translate("sector.advertisingDigitalMedia",true),value:"Publicidad / Medios digitales"});l.push({tag:"option",html:translate("sector.accountingOrFinancialServices",true),value:"Servicios contables o financieros"});l.push({tag:"option",html:translate("sector.specializedServices",true),value:"Servicios especializados"});l.push({tag:"option",html:translate("sector.technologyTelecommunications",true),value:"Tecnología / Telecomunicaciones"});l.push({tag:"option",html:translate("sector.transportLogistics",true),value:"Transporte / Logística"});l.push({tag:"option",html:translate("othersM",true),value:"Otros"});var e=Ext.create("Ext.data.JsonStore",{fields:["tag","text","value"],data:[{tag:"option",text:translate("role.entrepeneur",true),value:"entrepreneur"},{tag:"option",text:translate("role.accountant",true),value:"accountant"},{tag:"option",text:translate("role.freelancer-independent",true),value:"freelancer/independent"},{tag:"option",text:translate("role.student",true),value:"student"},{tag:"option",text:translate("other",true),value:"other"}]});var i=[];i.push({tag:"option",html:translate("select",true),value:""});Ext.each(e.data.items,function(w){var x=w.data;i.push({tag:x.tag,html:x.text,value:x.value})});this.steps[0].content.children[1].children[1].children[1].children[0].children=i;this.steps[0].content.children[1].children[3].children[1].children[0].children=l;var q={tag:"div",id:"welcome-wizard",cls:"wizard-overlay",children:[{tag:"div",id:"wizard-content-wrapper",cls:"content-wrapper",children:[{tag:"div",id:"step-content-wrapper",children:[{tag:"div",id:"step-content"},{tag:"div",cls:"back-next-buttons",children:[{tag:"p",html:translate("youCanUpdateYourCompanyInformationAtAnyTime",true),cls:"wizard-next-button-title",id:"wizard-footer-title"},{tag:"img",cls:"wizard-back-button",src:"https://cdn1.getsoft.app/images/welcome-wizard/new-new-wizard-back-text.png"},{tag:"div",cls:"wizard-next-button",html:translate("next",true)},{tag:"div",cls:"wizard-loading-button disabled",style:"opacity: 0.7; cursor: default;",html:'<div class="img-loading-register" style="display: inline-block;margin-left: 0px;bottom: 1px;left: 5px;"></div><div style="bottom: 0px;width: 100%;display: inline-block;left: 6px;">'+translate("savingAction",true)+"</div>"},{tag:"div",cls:"go-to-invoice",html:translate("createMyFirstInvoice",true)},{tag:"div",cls:"go-to-index",html:translate("start",true)}]},{tag:"div",cls:"close-button bar-buttons wizard",children:[{tag:"img",cls:"wizard-close-button",src:"https://cdn1.getsoft.app/images/welcome-wizard/new-wizard-close-x.png"}]}]}]}]};var o=Ext.DomHelper;o.append(Ext.getBody(),q);var n=Ext.get(Ext.dom.Query.select(".wizard-back-button")[0]);var k=Ext.get(Ext.dom.Query.select(".wizard-next-button")[0]);var a=Ext.get(Ext.dom.Query.select(".close-button.wizard")[0]);var f=Ext.get(Ext.dom.Query.select(".go-to-invoice")[0]);var c=Ext.get(Ext.dom.Query.select(".go-to-video")[0]);var m=Ext.get(Ext.dom.Query.select(".go-to-index")[0]);var h=false;if(this.showForms=="no"){if(this.canSeeVideoStep()){this.setStep(1);if(c){c.addCls("hidden")}}else{h=true}}else{this.setStep(0)}n.on("click",this.previousStep,this);k.on("click",this.nextStep,this);a.on("click",this.noMoreAndClose,this);var t=this,j=function(x,y){var z=typeof(x)!="undefined"?x:"";var w=typeof(y)!=="undefined"?y&&t.canSeeVideoStep():false;if(t&&t.currentStep=="step-1"){if(t.validateForm()){t.saveCompanyInfo(t.currentStep,"yes",z)}}else{t.noMoreAndClose("yes",z)}if(w){t.openVideo()}};if(f){f.on("click",function(){j("/invoice/add")})}if(c){c.on("click",function(){j("",true)});if(!this.canSeeVideoStep()){c.addCls("hidden")}}if(m){m.on("click",function(){j()})}if(h){this.noMoreAndClose("yes")}var u=Ext.get(Ext.dom.Query.select("#input-country")[0]);if(u){u.on("change",this.inputMandatoryReset,u)}var g=Ext.get(Ext.dom.Query.select("#input-currency-div")[0]);if(g){var d=Ext.create("AL.store.CurrenciesAll");var s=Ext.create("Ext.form.field.ComboBox",{name:"wizardCurrency",id:"input-currency",renderTo:"currency-container",emptyText:translate("select",true),style:"position: absolute; top: 5px;",width:300,height:15,allowBlank:true,enableKeyEvents:true,store:d,valueField:"code",displayField:"comboName",queryMode:"local",forceSelection:true,autoLoadBeforeRender:true,cls:"wizard-combo",listConfig:{cls:"wizard-combo"},listeners:{keypress:function(){this.on("change",function(){t.inputMandatoryReset(this,g);var w=this.store;w.clearFilter();w.filter({property:"comboName",anyMatch:true,value:this.getValue()});if(this.getValue()==null){this.store.clearFilter()}})},select:function(){this.store.clearFilter()}}});d.load()}var b=Ext.get(Ext.dom.Query.select("#input-profile")[0]);var r=Ext.get(Ext.dom.Query.select("#input-other-profile")[0]);r.setVisibilityMode(Ext.Element.DISPLAY);r.hide();b.on("change",function(y){var x=Ext.dom.Query.select("#input-profile")[0].value;if(x=="other"){r.show()}else{if(r){r.hide();Ext.dom.Query.select("#input-other-profile")[0].value="";var w=Ext.get(Ext.dom.Query.select(".other-profile .mandatory-info.text")[0]);w.addCls("hidden")}}})},inputMandatoryReset:function(b,a){if(a.id=="input-country"){Ext.get(Ext.dom.Query.select("#input-country")[0]).removeCls("mandatory");Ext.get(Ext.dom.Query.select(".country .mandatory-info.text")[0]).addCls("hidden")}else{Ext.get(Ext.dom.Query.select("#input-currency")[0]).removeCls("mandatory");Ext.get(Ext.dom.Query.select(".currency .mandatory-info.text")[0]).addCls("hidden")}},refreshButtonsState:function(){var c=Ext.get(Ext.dom.Query.select(".wizard-back-button")[0]);var e=Ext.get(Ext.dom.Query.select(".wizard-next-button")[0]);var a=Ext.get(Ext.dom.Query.select(".close-button")[0]);var d=Ext.get(Ext.dom.Query.select(".go-to-invoice")[0]);var b=Ext.get(Ext.dom.Query.select(".go-to-index")[0]);c.addCls("disabled");if(!this.hasNextStep()){e.addCls("disabled");d.removeCls("disabled");b.removeCls("disabled")}else{e.removeCls("disabled");d.addCls("disabled");b.addCls("disabled")}if(this.currentStep=="step-1"){a.addCls("hidden")}else{a.removeCls("hidden")}},hasPreviousStep:function(){var b=false;var a=false;Ext.each(this.steps,function(c){if(a){b=true}if(this.currentStep==c.name){a=true}},this,true);return b},hasNextStep:function(){var b=false;var a=false;Ext.each(this.steps,function(c){if(a){b=true}if(this.currentStep==c.name){a=true}},this);if(!this.canSeeVideoStep()&&this.currentStep=="step-1"){b=false}return b},canSeeVideoStep:function(){return this.canSeeVideo?this.canSeeVideo:false},openVideo:function(){var a=new Date();if((this.country=="mexico"||this.country=="costaRica"||this.country=="peru"||this.country=="republicaDominicana")&&a.getMonth()==10&&Math.abs(AL.config.idCompany%2)==1){if(this.country=="peru"){window.open("https://youtu.be/2kQGUxvN9NY")}else{window.open("https://youtu.be/ndAyZ6WLDaI")}}else{if(this.country=="mexico"){window.open("https://youtu.be/xqUXfMrDdXc")}else{if(this.country=="republicaDominicana"){window.open("https://youtu.be/CsolatxQhA0")}else{if(this.country=="panama"){window.open("https://youtu.be/VwsMHe7meFU")}else{if(this.country=="colombia"){var b="https://youtu.be/cA7OxzomIVQ";if(this.originKeyword=="partner-claro"){b="https://www.youtube.com/watch?v=s4r5HLQ-r4I&feature=youtu.be"}window.open(b)}else{if(this.country=="usa"){window.open("https://youtu.be/RgMUJOXmhes")}else{if(this.country=="costaRica"){window.open("https://youtu.be/PJfmR2xGL2w")}else{if(this.country=="peru"){window.open("https://youtu.be/Wouvow3izeY")}else{if(this.country=="spain"){window.open("https://youtu.be/mDH4Fj_qos4")}else{if(this.country=="chile"){window.open("https://youtu.be/Zf5r2EVQAWs")}else{if(this.country=="argentina"){window.open("https://youtu.be/Pxq-Lr1xtfQ")}else{window.open("https://youtu.be/QeZGSfMEJ90")}}}}}}}}}}}},getCurrency:function(){var a;if(this.country=="colombia"){a="COP"}else{if(this.country=="mexico"){a="MXN"}else{if(this.country=="peru"){a="PEN"}else{if(this.country=="republicaDominicana"){a="DOP"}else{if(this.country=="panama"){a="PAB"}else{if(this.country=="usa"){a="USD"}else{if(this.country=="spain"){a="EUR"}else{if(this.country=="chile"){a="CLP"}else{if(this.country=="costaRica"){a="CRC"}else{if(this.country=="other"){a="USD"}else{if(this.country=="argentina"){a="ARS"}}}}}}}}}}}return a},validateForm:function(){var o=true;var l=Ext.get(Ext.dom.Query.select("#input-city")[0]);var i=Ext.get(Ext.dom.Query.select("#input-phone")[0]);var q=Ext.get(Ext.dom.Query.select("#input-country")[0]);var m=Ext.get(Ext.dom.Query.select("#input-currency")[0]);var e=Ext.get(Ext.dom.Query.select("#input-mx-state")[0]);var f=Ext.get(Ext.dom.Query.select("#input-profile")[0]);var n=Ext.get(Ext.dom.Query.select("#input-other-profile")[0]);switch(this.country){case"costaRica":var d=Ext.ComponentQuery.query("combo[name=wizardCanton]");if(d&&d[0]){d=d[0];var k=d.getSelectedRecord();if(!k){o=this.validIfWizardFieldIsRequired(d,"city")}}break;case"colombia":var r=Ext.ComponentQuery.query("combo[name=wizardCity]");if(r&&r[0]){r=r[0];var k=r.getSelectedRecord();if(!k){o=this.validIfWizardFieldIsRequired(r,"municipality")}}break;case"mexico":if(e){if(!e.getValue()){o=this.validIfWizardFieldIsRequired(e)}}break;case"argentina":var r=Ext.ComponentQuery.query("combo[name=wizardCity]")[0];if(r){var k=r.getSelectedRecord();if(!k){o=this.validIfWizardFieldIsRequired(r,"city",true)}}break;default:if(!l.getValue()){var r=Ext.ComponentQuery.query("combo[name=wizardCity]")[0];l.addCls("mandatory");o=this.validIfWizardFieldIsRequired()}break}var j=Ext.get(Ext.dom.Query.select(".phone .mandatory-info.text")[0]);if(!i.getValue()){o=this.validIfWizardFieldIsRequired(i)}else{j.addCls("hidden");i.removeCls("mandatory")}if(m){var g=Ext.ComponentQuery.query("combo[name=wizardCurrency]")[0];var k=g.getSelectedRecord();if(!k){var c=Ext.get(Ext.dom.Query.select(".currency .mandatory-info.text")[0]);if(!m.getValue()&&this.country=="other"){o=this.validIfWizardFieldIsRequired(m);g.store.clearFilter()}else{c.addCls("hidden");m.removeCls("mandatory")}}}if(q){var h=Ext.get(Ext.dom.Query.select(".country .mandatory-info.text")[0]);if(!q.getValue()){o=this.validIfWizardFieldIsRequired(q)}else{h.addCls("hidden");q.removeCls("mandatory")}}if(f){var b=Ext.get(Ext.dom.Query.select(".profile .mandatory-info.text")[0]);if(!f.getValue()){o=this.validIfWizardFieldIsRequired(f)}else{b.addCls("hidden");f.removeCls("mandatory");if(f.getValue()=="other"&&n){var a=Ext.get(Ext.dom.Query.select(".other-profile .mandatory-info.text")[0]);if(!n.getValue()){o=this.validIfWizardFieldIsRequired(n)}else{a.addCls("hidden");n.removeCls("mandatory")}}}}return o},validIfWizardFieldIsRequired:function(d,f,b){d=d||"default";f=f||"city";b=b||false;var e;var c='<div id="invoiceClientCombo-errorEl" class="x-form-error-msg x-form-invalid-icon" style="position: absolute; right: 120px; top: 4px" data-errorqtip="<ul class=&quot;x-list-plain&quot;><li>';var a=Ext.get(Ext.dom.Query.select("#input-profile")[0]).getValue();if(d.name=="wizardCity"||d.name=="wiz    ardCanton"){if(d.getValue()!=null){e=Ext.get(Ext.dom.Query.select(".city .mandatory-info.text")[0]);e.setHTML(c+"Debes seleccionar "+(b?"una ":"un ")+translate(f)+' de la lista.</li></ul>">')}else{e=Ext.get(Ext.dom.Query.select(".city .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}}else{if(d.id=="input-phone"){e=Ext.get(Ext.dom.Query.select(".phone .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}else{if(d.id=="input-mx-state"){e=Ext.get(Ext.dom.Query.select(".mx-state .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}else{if(d.id=="input-currency"){if(d.getValue()!=null){e=Ext.get(Ext.dom.Query.select(".currency .mandatory-info.text")[0]);e.setHTML(c+translate("multicurrencyNotSelectedMsg",true)+'.</li></ul>">')}else{e=Ext.get(Ext.dom.Query.select(".currency .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}}else{if(d.id=="input-country"){e=Ext.get(Ext.dom.Query.select(".country .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}else{if(d.id=="input-profile"){e=Ext.get(Ext.dom.Query.select(".profile .mandatory-info.text")[0]);e.setHTML(c+translate("thisFieldIsRequired",true)+'.</li></ul>">')}else{if(a=="other"&&d.id=="input-other-profile"){c='<div id="invoiceClientCombo-errorEl" class="x-form-error-msg x-form-invalid-icon" style="position: absolute; right: 120px; top: -3px" data-errorqtip="<ul class=&quot;x-list-plain&quot;><li>';e=Ext.get(Ext.dom.Query.select(".other-profile .mandatory-info.text")[0]);e.setHTML(c+'Es necesario especificar cual es el valor del otro perfil.</li></ul>">')}}}}}}}if(d!="default"){d.addCls("mandatory")}if(e){e.removeCls("hidden")}return false},nextStep:function(){var b=false;var a=this.currentStep;var c=this.validateForm();this.AddZindexToWizard();if(a=="step-1"&&c){this.saveCompanyInfo(a);Ext.each(this.steps,function(d){if(b){this.setStep(d.name);return false}if(this.currentStep==d.name){b=true}},this)}},previousStep:function(){var a=false;Ext.each(this.steps,function(b){if(a){this.setStep(b.name);return false}if(this.currentStep==b.name){a=true}},this,true)},setStep:function(b){if(Ext.isNumeric(b)){this.currentStep=this.steps[b].name;var c=Ext.DomHelper;c.overwrite("step-content",this.steps[b].content);this.steps[b].callback.call(this)}else{Ext.each(this.steps,function(d){if(d.name==b){this.currentStep=b;var e=Ext.DomHelper;e.overwrite("step-content",d.content);d.callback.call(this);return false}},this)}this.refreshButtonsState();var a=Ext.get("step-content-wrapper");a.removeCls(a.getAttribute("class"));a.addCls(this.currentStep);a.setVisible(true,true)},AddZindexToWizard:function(){Ext.Element.select("#welcome-wizard").elements[0].style.zIndex=19000},steps:[{name:"step-1",content:{children:[{tag:"div",cls:"step-header",children:[{tag:"div",id:"wizardMainIcon",html:'<svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)">                       <circle cx="17.0001" cy="17" r="17.5" fill="#01A592"/>                                <path fill-rule="evenodd" clip-rule="evenodd" d="M19.2399 15.0466C20.564 20.3944 23.2439 21.5419 23.2439 21.5419C23.2439 21.5419 18.675 20.5141 15.6547 16.7051C13.8165 14.3868 12.0514 9.97953 12.0514 9.97953L18.8211 8.12329C18.8211 8.12329 18.47 11.9374 19.2399 15.0466ZM12.9871 23.9091C19.385 25.4217 25.1615 22.6022 25.1615 22.6022C25.1615 22.6022 21.3259 23.6679 15.4916 19.0347C12.0983 16.3416 9.33671 11.9209 9.33671 11.9209L3.55811 19.7468C3.55811 19.7468 9.0945 22.9858 12.9871 23.9091ZM22.589 19.8235C22.589 19.8235 21.7221 18.0183 23.3821 14.6907C24.3471 12.7561 26.1911 10.9728 26.1911 10.9728L21.933 8.83323C21.933 8.83323 20.9089 11.8834 20.8325 13.9019C20.7088 17.2198 22.589 19.8235 22.589 19.8235ZM25.5128 16.3906C23.4967 17.0605 23.127 18.1637 23.127 18.1637C23.127 18.1637 23.401 16.3062 24.7837 14.9976C25.6258 14.2013 27.2709 13.3783 27.2709 13.3783L28.1596 16.0432C28.1596 16.0432 26.6866 16.0014 25.5128 16.3906Z" fill="white"/>  </g><defs><clipPath id="clip0"><rect width="34" height="34" fill="white"/></clipPath>     </defs></svg>'},{tag:"div",id:"companyName",html:"¡Hola!"}]},{tag:"div",cls:"content",id:"input-container",children:[{tag:"div",cls:"subtitle",html:translate("wizard.intro",true)},{tag:"div",cls:"profile",id:"profile",children:[{tag:"div",cls:"label",style:translate("util.language")=="EN"?"width: 174px; margin-left: -86px;":"width: 133px; margin-left: -42px;",html:translate("whastYourMainRole",true)+': <span class="mandatory-info">*</span>'},{tag:"div",id:"div-input-profile",cls:"input profile",children:[{tag:"select",id:"input-profile",cls:"input",type:"text",name:"profile",children:[]}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]},{tag:"div",cls:"other-profile",id:"div-other-profile",children:[{tag:"input",id:"input-other-profile",cls:"input",type:"text",name:"other-profile",placeholder:translate("writeWhatYouDo",true)},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]},{tag:"div",cls:"sector",id:"sector",children:[{tag:"div",cls:"label sector",html:'Sector: <span class="mandatory-info">&nbsp;</span>'},{tag:"div",cls:"input sector",children:[{tag:"select",cls:"input",id:"input-sector",children:[]}]}]},{tag:"div",cls:"city",id:"city",children:[{tag:"p",cls:"label",html:translate("city",true)+': <span class="mandatory-info">*</span>'},{tag:"div",id:"div-input-city",cls:"input",children:[{tag:"input",id:"input-city",cls:"input",type:"text",name:"city"}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]},{tag:"div",cls:"mx-state",id:"mx-state",hidden:true,children:[{tag:"p",cls:"label",html:'Estado: <span class="mandatory-info">*</span>'},{tag:"div",cls:"input",children:[{tag:"input",id:"input-mx-state",cls:"input",type:"text",name:"mx-state"}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]},{tag:"div",cls:"phone",children:[{tag:"p",cls:"label",html:translate("phone",true)+': <span class="mandatory-info">*</span>'},{tag:"div",cls:"input",id:"div-input-phone",children:[{tag:"input",type:"hidden",name:"callingCode",id:"input-calling-code"},{tag:"div",id:"dropdown-calling-code-wrapper",children:[{tag:"div",id:"dropdown-calling-code-button",children:[{tag:"span",id:"flag-selected",html:'<i id="flag-show" class="flag flag-16 flag-us"></i>'},{tag:"span",id:"calling-code-selected",html:"+58"},{tag:"span",id:"arrow-base",cls:"arrow-up"}]}]},{tag:"div",id:"dropdown-country-calling-code",cls:"dropdown-content",children:[{tag:"div",id:"dropdown-content-wrapper",html:'<input type="text" style="width: 284px;" placeholder='+translate("search",true)+' id="search-calling-code" onkeyup="">'}]},{tag:"input",id:"input-phone",cls:"input",type:"text",name:"phone"}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]},{tag:"div",id:"regime",children:[{tag:"div",cls:"label regime",html:'Régimen:  <span class="mandatory-info">&nbsp;</span>'},{tag:"div",cls:"input input-regime",id:"input-regime",children:[{html:""}]}]},{tag:"div",id:"ivaCondition",children:[{tag:"div",cls:"label ivaCondition",html:"Condición de IVA:"},{tag:"div",cls:"input input-ivaCondition",id:"input-ivaCondition",children:[{html:""}]}]},{id:"terms-conditions",tag:"div",cls:"terms-conditions",html:'Al oprimir el botón "Siguiente" aceptas nuestros <a href="http://www.getsoft.app/terminos-y-condiciones" target="_blank">Términos y Condiciones</a> y <a href="http://www.getsoft.app/terminos-y-condiciones" target="_blank">Política de Tratamiento de Datos</a>.',hidden:true}]}]},callback:function(){var t=Ext.DomHelper;var s=Ext.getElementById("city");var T=true;switch(this.country){case"other":break;case"mexico":var X=Ext.getElementById("mx-state");s.hidden=true;X.hidden=false;break;case"peru":var h=Ext.dom.Query.select(".label.sector")[0];h.innerHTML='Giro de negocio: <span class="mandatory-info">&nbsp;</span>';h.style.width="125px";h.style.marginLeft="-37px";break;case"chile":var h=Ext.dom.Query.select(".label.sector")[0];h.innerHTML='Giro: <span class="mandatory-info">&nbsp;</span>';h.style.width="125px";h.style.marginLeft="-37px";break;case"colombia":var S=Ext.dom.Query.select(".label.regime")[0];S.innerHTML='Responsabilidad: <span class="mandatory-info">&nbsp;</span>';S.style.width="130px";S.style.marginLeft="-40px";break}switch(this.originKeyword){case"partner-innpulsa":var X=Ext.getElementById("terms-conditions");X.hidden=false;T=false;break;case"partner-claro":var X=Ext.getElementById("terms-conditions");X.hidden=false;T=false;var G=Ext.dom.Query.select("#input-container .subtitle")[0];G.innerHTML="Cuéntanos más sobre tu negocio para que trabajemos especialmente para ti";var r=Ext.dom.Query.select("#wizardMainIcon")[0];r.hidden=true;break}var H="";var L=Ext.get("companyName");var e=Ext.get(Ext.dom.Query.select("#input-city")[0]);var x=Ext.get(Ext.dom.Query.select(".city .mandatory-info.text")[0]);var R=Ext.get(Ext.dom.Query.select(".phone .mandatory-info.text")[0]);var y=Ext.get(Ext.dom.Query.select(".sector .mandatory-info.text")[0]);var K=Ext.get(Ext.dom.Query.select(".country .mandatory-info.text")[0]);var E=Ext.get(Ext.dom.Query.select(".currency .mandatory-info.text")[0]);var V=Ext.get(Ext.dom.Query.select(".mx-state .mandatory-info.text")[0]);var I=Ext.get(Ext.dom.Query.select("#input-phone")[0]);var F=Ext.get(Ext.dom.Query.select("#input-sector")[0]);var Q=Ext.get(Ext.dom.Query.select("#input-country")[0]);var l=Ext.get(Ext.dom.Query.select("#input-currency")[0]);var P=Ext.get(Ext.dom.Query.select("#input-mx-state")[0]);var m=Ext.get(Ext.dom.Query.select("#input-profile")[0]);var i=Ext.get(Ext.dom.Query.select(".profile .mandatory-info.text")[0]);var f=Ext.get(Ext.dom.Query.select("#input-other-profile")[0]);var D=Ext.get(Ext.dom.Query.select(".other-profile .mandatory-info.text")[0]);switch(this.country){case"colombia":H='<select id="input-regime-select"class="input regime" name="regime"><option value="COMMON_REGIME">Responsable del IVA (régimen común)</option><option value="SIMPLIFIED_REGIME">No responsable del IVA (régimen simplificado)</option><option value="SIMPLE_REGIME_OF_TAXATION">Régimen simple de tributación</option><option value="NOT_REPONSIBLE_FOR_CONSUMPTION">No responsable de consumo (régimen simplificado del INC)</option><option value="SPECIAL_REGIME">Régimen especial</option></select>';var O=Ext.get(Ext.dom.Query.select(".city .label")[0]);O.update(translate("municipality",true)+': <span class="mandatory-info">*</span>');e.hide();var a=Ext.create("AL.store.Cities");var N=Ext.create("Ext.form.field.ComboBox",{name:"wizardCity",renderTo:"div-input-city",emptyText:translate("select",true),style:"position: absolute; top: 5px;",width:300,height:15,allowBlank:true,store:a,valueField:"id",displayField:"value",queryMode:"local",forceSelection:true,cls:"wizard-combo",listConfig:{loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"wizard-combo",getInnerTpl:function(){return'{value}<tpl if="isRepeated">, {parentValue}</tpl>'}}});N.on("focus",function(ab){ab.removeCls("mandatory");x.addCls("hidden")});var z=this;a.load({callback:function(ab){if(z.addressObject&&z.addressObject.city){N.setValue(z.addressObject.city)}}});break;case"republicaDominicana":H='<select id="input-regime-select"class="input regime" name="regime"><option value="GENERAL_REGIME">Régimen general</option><option value="RST_REGIME">Régimen RST</option><option value="SPECIAL_REGIME_OF_TAXATION">Regímenes especiales de tributación</option></select>';break;case"panama":H='<select id="input-regime-select"class="input regime" name="regime"><option value="COMMON_REGIME">Régimen común</option></select>';break;case"mexico":H='<select id="input-regime-select"class="input regime" name="regime"><option value="GENERAL_REGIME_OF_MORAL_PEOPLE_LAW">Régimen General de Ley Personas Morales</option><option value="BUSINESS_ACTIVITIES_REGIME">Régimen actividades empresariales</option><option value="FISCAL_INCORPORATION_REGIME">Régimen de Incorporación Fiscal</option><option value="SALARIED_REGIME">Régimen asalariados</option><option value="FEES_REGIME">Régimen honorarios (servicios profesionales)</option><option value="LEASEHOLD_REGIME">Régimen de arrendamiento</option><option value="REGIME_OF_MORAL_PEOPLE_NOT_PROFIT">Régimen de las Personas Morales con Fines No Lucrativos</option><option value="REGIME_OF_THE_COORDINATED">Régimen de los Coordinados</option><option value="PRIMARY_SECTOR_REGIME">Régimen de Actividades Agrícolas, Ganaderas, Silvicolas y Pesqueras</option></select>';break;case"peru":H='<select id="input-regime-select"class="input regime" name="regime"><option value="GENERAL_REGIME">Régimen general</option><option value="SPECIAL_REGIME">Régimen especial</option><option value="MYPE_TRIBUTARY_REGIME">Régimen MYPE tributario</option><option value="NEW_RUS">Nuevo RUS</option></select>';break;case"spain":H='<select id="input-regime-select"class="input regime" name="regime"><option value="GENERAL_REGIME">Régimen general</option><option value="SIMPLIFIED_REGIME">Régimen simplificado</option></select>';break;case"chile":H='<select id="input-regime-select" class="input regime" name="regime"><option value="PRESUMED_INCOME">Renta presunta</option><option value="SIMPLIFIED_TAXATION">Tributación simplificada</option><option value="ATTRIBUTED_INCOME">Renta atribuida</option><option value="SEMI_INTEGRATED">Semi integrado</option><option value="PRO_PYME_GENERAL">Pro pyme general</option><option value="PRO_PYME_TRANSPARENT">Pro pyme transparente</option></select>';break;case"costaRica":H='<select id="input-regime-select"class="input regime" name="regime"><option value="SIMPLIFIED_REGIME" >Régimen simplificado</option><option value="TRADITIONAL_REGIME">Régimen tradicional</option><option value="PHYSICAL_PERSON">Persona física</option></select>';e.hide();var a=Ext.create("AL.store.Cantons");var N=Ext.create("Ext.form.field.ComboBox",{name:"wizardCanton",renderTo:"div-input-city",emptyText:translate("select",true),style:"position: absolute; top: 5px;",width:300,height:15,allowBlank:true,store:a,valueField:"id",displayField:"value",queryMode:"local",forceSelection:true,cls:"wizard-combo",listConfig:{cls:"wizard-combo"}});N.on("focus",function(ab){ab.removeCls("mandatory");x.addCls("hidden")});var z=this;a.load({callback:function(ab){if(z.addressObject&&z.addressObject.canton){N.setValue(z.addressObject.canton)}}});break;case"argentina":H='<select id="input-ivaCondition-select" class="input ivaCondition" name="ivaCondition"><option value="IVA_RESPONSABLE" >IVA responsable inscripto</option><option value="IVA_RESPONSABLE_NO_INSCRIPT" >IVA responsable no inscripto</option><option value="IVA_EXEMPT">IVA sujeto exento</option><option value="FINAL_CONSUMER">Consumidor final</option><option value="UNIQUE_TRIBUTE_RESPONSABLE">Responsable monotributo</option><option value="PROVIDER_FROM_EXTERIOR">Proveedor del exterior</option><option value="CLIENT_FROM_EXTERIOR">Cliente del exterior</option><option value="IVA_RELEASED_LAW_19640">IVA Liberado - Ley 19.640</option><option value="UNIQUE_TRIBUTE_SOCIAL">Monotributista Social</option><option value="IVA_NOT_REACHED">IVA No alcanzado</option></select>';e.hide();var a=Ext.create("AL.store.Cities");var N=Ext.create("Ext.form.ComboBox",{name:"wizardCity",renderTo:"div-input-city",emptyText:"Buscar...",style:"position: absolute; top: 5px;",width:300,height:15,allowBlank:true,store:a,valueField:"id",displayField:"value",queryMode:"remote",queryDelay:300,forceSelection:true,autoSelect:false,hideTrigger:true,minChars:1,cls:"wizard-combo wizard-searchable",listConfig:{loadingText:translate("searching",true),emptyText:'<div style="padding:10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"wizard-combo",getInnerTpl:function(){return'{value}<tpl if="isRepeated">, {parentValue}</tpl>'}}});N.on("focus",function(ab){ab.removeCls("mandatory");x.addCls("hidden")});var z=this;if(z.addressObject&&z.addressObject.city){a.getProxy().extraParams={query:z.addressObject.city};a.load({callback:function(ac){if(z.addressObject&&z.addressObject.city){var ab=a.findRecord("value",z.addressObject.city);if(ab){N.select(ab)}}}})}break}if(this.country!=="argentina"){var W=Ext.getElementById("ivaCondition");W.remove()}if(["panama","usa","other","argentina"].indexOf(this.country)===-1){var w=Ext.getElementById("input-regime");t.insertHtml("afterBegin",w,H);if(this.regime){Ext.dom.Query.select("#input-regime-select")[0].value=this.regime}}else{var w=Ext.getElementById("regime");w.remove();if(this.country==="argentina"){var A=Ext.getElementById("input-ivaCondition");t.insertHtml("afterBegin",A,H);if(this.ivaCondition){Ext.dom.Query.select("#input-ivaCondition-select")[0].value=this.ivaCondition}}}if(this.country=="other"){var q=[{tag:"div",cls:"country",children:[{tag:"div",cls:"label",html:translate("country",true)+': <span class="mandatory-info">*</span>'},{tag:"div",cls:"input",children:[{html:'<select id="input-country"class="input country" name="country">\n                                    <option value="">'+translate("select",true)+'</option>\n                                    <option value="AFG">Afghanistan</option><option value="ALA">Åland Islands</option>\n<option value="ALB">Albania</option><option value="DZA">Algeria</option><option value="ASM">American Samoa</option>\n                                    <option value="AND">Andorra</option><option value="AGO">Angola</option><option value="AIA">Anguilla</option>\n                                    <option value="ATA">Antarctica</option><option value="ATG">Antigua and Barbuda</option><option value="ARG">Argentina</option>\n                                    <option value="ARM">Armenia</option><option value="ABW">Aruba</option><option value="AUS">Australia</option>\n                                    <option value="AUT">Austria</option><option value="AZE">Azerbaijan</option><option value="BHS">Bahamas</option>\n                                    <option value="BHR">Bahrain</option><option value="BGD">Bangladesh</option><option value="BRB">Barbados</option>\n                                    <option value="BLR">Belarus</option><option value="BEL">Belgium</option><option value="BLZ">Belize</option>\n                                    <option value="BEN">Benin</option><option value="BMU">Bermuda</option><option value="BTN">Bhutan</option>\n                                    <option value="BOL">Bolivia</option><option value="BES">Bonaire, Sint Eustatius and Saba</option>\n                                    <option value="BIH">Bosnia and Herzegovina</option><option value="BWA">Botswana</option>\n                                    <option value="BVT">Bouvet Island</option><option value="BRA">Brasil</option><option value="IOT">British Indian Ocean Territory</option>\n                                    <option value="BRN">Brunei Darussalam</option><option value="BGR">Bulgaria</option><option value="BFA">Burkina Faso</option>\n                                    <option value="BDI">Burundi</option><option value="KHM">Cambodia</option><option value="CMR">Cameroon</option>\n                                    <option value="CAN">Canada</option><option value="CPV">Cape Verde</option><option value="CYM">Cayman Islands</option>\n                                    <option value="CAF">Central African Republic</option><option value="TCD">Chad</option>\n                                    <option value="CHL">Chile</option><option value="CHN">China</option><option value="CXR">Christmas Island</option>\n                                    <option value="CCK">Cocos (Keeling) Islands</option><option value="COL">Colombia</option>\n                                    <option value="COM">Comoros</option><option value="COG">Congo</option><option value="COD">Congo, the Democratic Republic of the</option>\n                                    <option value="COK">Cook Islands</option><option value="CRI">Costa Rica</option><option value="CIV">Côte d\'Ivoire</option>\n                                    <option value="HRV">Croatia</option><option value="CUB">Cuba</option><option value="CUW">Curaçao</option>\n                                    <option value="CYP">Cyprus</option><option value="CZE">Czech Republic</option><option value="DNK">Denmark</option>\n                                    <option value="DJI">Djibouti</option><option value="DMA">Dominica</option><option value="DOM">República Dominicana</option>\n                                    <option value="ECU">Ecuador</option><option value="EGY">Egypt</option><option value="SLV">El Salvador</option>\n                                    <option value="GNQ">Equatorial Guinea</option><option value="ERI">Eritrea</option><option value="EST">Estonia</option>\n                                    <option value="ETH">Ethiopia</option><option value="FLK">Falkland Islands (Malvinas)</option><option value="FRO">Faroe Islands</option>\n                                    <option value="FJI">Fiji</option><option value="FIN">Finland</option><option value="FRA">France</option>\n                                    <option value="GUF">French Guiana</option><option value="PYF">French Polynesia</option>\n                                    <option value="ATF">French Southern Territories</option><option value="GAB">Gabon</option>\n                                    <option value="GMB">Gambia</option><option value="GEO">Georgia</option><option value="DEU">Germany</option>\n                                    <option value="GHA">Ghana</option><option value="GIB">Gibraltar</option><option value="GRC">Greece</option>\n                                    <option value="GRL">Greenland</option><option value="GRD">Grenada</option><option value="GLP">Guadeloupe</option>\n                                    <option value="GUM">Guam</option><option value="GTM">Guatemala</option><option value="GGY">Guernsey</option>\n                                    <option value="GIN">Guinea</option><option value="GNB">Guinea-Bissau</option><option value="GUY">Guyana</option>\n                                    <option value="HTI">Haiti</option><option value="HMD">Heard Island and McDonald Islands</option>\n                                    <option value="VAT">Holy See (Vatican City State)</option><option value="HND">Honduras</option>\n                                    <option value="HKG">Hong Kong</option><option value="HUN">Hungary</option>\n                                    <option value="ISL">Iceland</option><option value="IND">India</option>\n                                    <option value="IDN">Indonesia</option><option value="IRN">Iran, Islamic Republic of</option>\n                                    <option value="IRQ">Iraq</option><option value="IRL">Ireland</option><option value="IMN">Isle of Man</option>\n                                    <option value="ISR">Israel</option><option value="ITA">Italy</option><option value="JAM">Jamaica</option>\n                                    <option value="JPN">Japan</option><option value="JEY">Jersey</option><option value="JOR">Jordan</option>\n                                    <option value="KAZ">Kazakhstan</option><option value="KEN">Kenya</option><option value="KIR">Kiribati</option>\n                                    <option value="PRK">Korea, Democratic People\'s Republic of</option><option value="KOR">Korea, Republic of</option>\n                                    <option value="KWT">Kuwait</option><option value="KGZ">Kyrgyzstan</option><option value="LAO">Lao People\'s Democratic Republic</option>\n                                    <option value="LVA">Latvia</option><option value="LBN">Lebanon</option><option value="LSO">Lesotho</option>\n                                    <option value="LBR">Liberia</option><option value="LBY">Libya</option><option value="LIE">Liechtenstein</option>\n                                    <option value="LTU">Lithuania</option><option value="LUX">Luxembourg</option><option value="MAC">Macao</option>\n                                    <option value="MKD">Macedonia</option><option value="MDG">Madagascar</option>\n                                    <option value="MWI">Malawi</option><option value="MYS">Malaysia</option><option value="MDV">Maldives</option>\n                                    <option value="MLI">Mali</option><option value="MLT">Malta</option><option value="MHL">Marshall Islands</option>\n                                    <option value="MTQ">Martinique</option><option value="MRT">Mauritania</option>\n                                    <option value="MUS">Mauritius</option><option value="MYT">Mayotte</option>\n                                    <option value="MEX">México</option><option value="FSM">Micronesia, Federated States of</option>\n                                    <option value="MDA">Moldova, Republic of</option><option value="MCO">Monaco</option>\n                                    <option value="MNG">Mongolia</option><option value="MNE">Montenegro</option><option value="MSR">Montserrat</option>\n                                    <option value="MAR">Morocco</option><option value="MOZ">Mozambique</option><option value="MMR">Myanmar</option>\n                                    <option value="NAM">Namibia</option><option value="NRU">Nauru</option><option value="NPL">Nepal</option>\n                                    <option value="NLD">Netherlands</option><option value="NCL">New Caledonia</option><option value="NZL">New Zealand</option>\n                                    <option value="NIC">Nicaragua</option><option value="NER">Niger</option><option value="NGA">Nigeria</option>\n                                    <option value="NIU">Niue</option><option value="NFK">Norfolk Island</option><option value="MNP">Northern Mariana Islands</option>\n                                    <option value="NOR">Norway</option><option value="OMN">Oman</option><option value="PAK">Pakistan</option>\n                                    <option value="PLW">Palau</option><option value="PSE">Palestinian Territory, Occupied</option><option value="PAN">Panamá</option>\n                                    <option value="PNG">Papua New Guinea</option><option value="PRY">Paraguay</option><option value="PER">Perú</option>\n                                    <option value="PHL">Philippines</option><option value="PCN">Pitcairn</option><option value="POL">Poland</option>\n                                    <option value="PRT">Portugal</option><option value="PRI">Puerto Rico</option><option value="QAT">Qatar</option>\n                                    <option value="REU">Réunion</option><option value="ROU">Romania</option><option value="RUS">Russian Federation</option>\n                                    <option value="RWA">Rwanda</option><option value="BLM">Saint Barthélemy</option><option value="SHN">Saint Helena, Ascension and Tristan da Cunha</option>\n                                    <option value="KNA">Saint Kitts and Nevis</option><option value="LCA">Saint Lucia</option>\n                                    <option value="MAF">Saint Martin (French part)</option><option value="SPM">Saint Pierre and Miquelon</option>\n                                    <option value="VCT">Saint Vincent and the Grenadines</option><option value="WSM">Samoa</option>\n                                    <option value="SMR">San Marino</option><option value="STP">Sao Tome and Principe</option><option value="SAU">Saudi Arabia</option>\n                                    <option value="SEN">Senegal</option><option value="SRB">Serbia</option><option value="SYC">Seychelles</option>\n                                    <option value="SLE">Sierra Leone</option><option value="SGP">Singapore</option><option value="SXM">Sint Maarten (Dutch part)</option>\n                                    <option value="SVK">Slovakia</option><option value="SVN">Slovenia</option><option value="SLB">Solomon Islands</option>\n                                    <option value="SOM">Somalia</option><option value="ZAF">South Africa</option><option value="SGS">South Georgia and the South Sandwich Islands</option>\n                                    <option value="SSD">South Sudan</option><option value="ESP">Spain</option><option value="LKA">Sri Lanka</option>\n                                    <option value="SDN">Sudan</option><option value="SUR">Suriname</option><option value="SJM">Svalbard and Jan Mayen</option>\n                                    <option value="SWZ">Swaziland</option><option value="SWE">Sweden</option><option value="CHE">Switzerland</option>\n                                    <option value="SYR">Syrian Arab Republic</option><option value="TWN">Taiwan, Province of China</option><option value="TJK">Tajikistan</option>\n                                    <option value="TZA">Tanzania, United Republic of</option><option value="THA">Thailand</option>\n                                    <option value="TLS">Timor-Leste</option><option value="TGO">Togo</option><option value="TKL">Tokelau</option>\n                                    <option value="TON">Tonga</option><option value="TTO">Trinidad and Tobago</option>\n                                    <option value="TUN">Tunisia</option><option value="TUR">Turkey</option><option value="TKM">Turkmenistan</option>\n                                    <option value="TCA">Turks and Caicos Islands</option><option value="TUV">Tuvalu</option>\n                                    <option value="UGA">Uganda</option><option value="UKR">Ukraine</option><option value="ARE">United Arab Emirates</option>\n                                    <option value="GBR">United Kingdom</option><option value="USA">United States</option><option value="UMI">United States Minor Outlying Islands</option>\n                                    <option value="URY">Uruguay</option><option value="UZB">Uzbekistan</option><option value="VUT">Vanuatu</option>\n                                    <option value="VEN">Venezuela</option><option value="VNM">Viet Nam</option>\n                                    <option value="VGB">Virgin Islands, British</option><option value="VIR">Virgin Islands, U.S.</option><option value="WLF">Wallis and Futuna</option>\n                                    <option value="ESH">Western Sahara</option><option value="YEM">Yemen</option><option value="ZMB">Zambia</option>\n                                    <option value="ZWE">Zimbabwe</option>\n                                    </select>'}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"},{tag:"div",cls:"currency",children:[{tag:"div",cls:"label currency",html:translate("currency",true)+': <span class="mandatory-info">*</span>'},{tag:"div",cls:"input currency",id:"currency-container",children:[{tag:"select",cls:"input",id:"input-currency-div"}]},{tag:"span",html:translate("thisFieldIsRequired",true),cls:"mandatory-info text hidden"}]}]}];t.insertBefore(s,q);var o=Ext.get(Ext.dom.Query.select("#welcome-wizard #step-content .content")[0]);o.addCls("otherCountryContent")}var g="us";if(this.country=="colombia"){g="co"}else{if(this.country=="mexico"){g="mx"}else{if(this.country=="peru"){g="pe"}else{if(this.country=="republicaDominicana"){g="do"}else{if(this.country=="panama"){g="pa"}else{if(this.country=="usa"){g="us"}else{if(this.country=="spain"){g="es"}else{if(this.country=="chile"){g="cl"}else{if(this.country=="costaRica"){g="cr"}else{if(this.country=="argentina"){g="ar"}}}}}}}}}}var C=document.getElementById("calling-code-selected");var k=document.getElementById("flag-show");var b=document.getElementById("input-calling-code");var B=Ext.create("AL.store.CountriesPhone");var Y=B.findRecord("alpha2",g).data;C.innerText="+"+Y.callingCode;k.className="flag flag-16 flag-"+Y.alpha2;b.value="+"+Y.callingCode;var d=document.getElementById("dropdown-calling-code-button");var n=document.getElementById("dropdown-content-wrapper");var u=B.data.items;var J=document.createElement("a");J.innerText="No se encontraron resultados";J.style.display="none";J.id="calling-code-no-results";n.appendChild(J);var j=function(af){var ae=af.target;var ab=document.getElementById("dropdown-country-calling-code");var ad=document.getElementById("calling-code-selected");var ac=document.getElementById("flag-show");b.value=ae.getAttribute("data-value");ad.innerText=ae.getAttribute("data-value");ac.className="flag flag-16 flag-"+ae.getAttribute("data-alpha2");ab.classList.remove("show")};for(var M=0;M<u.length;M++){var c=u[M].data;J=document.createElement("a");J.innerHTML='<i class="flag flag-16 flag-'+c.alpha2+'"></i> +'+c.callingCode+" "+c.name;J.setAttribute("data-value","+"+c.callingCode);J.setAttribute("data-alpha2",c.alpha2);J.addEventListener("click",j);n.appendChild(J)}var aa=document.getElementById("search-calling-code");var Z=function(ab){ab=ab.replace(/á/g,"a");ab=ab.replace(/é/g,"e");ab=ab.replace(/í/g,"i");ab=ab.replace(/ó/g,"o");ab=ab.replace(/ú/g,"u");return ab};aa.addEventListener("keyup",function(ai){var ac=ai.target,af,ab,ad,ah,ag=0,ae;af=ac.value.toLowerCase();af=Z(af);div=document.getElementById("dropdown-content-wrapper");ae=document.getElementById("calling-code-no-results");ab=div.getElementsByTagName("a");for(ad=1;ad<ab.length;ad++){ah=ab[ad].getAttribute("data-value")+" "+ab[ad].innerText;ah=Z(ah.toLowerCase());if(ah.indexOf(af)>-1){ab[ad].style.display=""}else{ab[ad].style.display="none";ag++}}if(ag>7){ac.style.width="298px"}else{ac.style.width="284px"}if(ag==ab.length-1){ae.style.display=""}else{ae.style.display="none"}});var U=function(ac){var ab=document.getElementById("dropdown-country-calling-code");ab.classList.toggle("show")};d.addEventListener("click",U);document.addEventListener("click",this.closeDropDown);L.setHTML(translate("wrapperExclamationSentence",true,{sentence:"<span>"+translate("hello",true)+" "+this.companyName+", </span>"+translate("weWelcomeYou",true)}));e.on("focus",function(){e.removeCls("mandatory");x.addCls("hidden")});I.on("focus",function(){I.removeCls("mandatory");R.addCls("hidden")});if(Q){Q.on("focus",function(){Q.removeCls("mandatory");K.addCls("hidden")})}if(P){P.on("focus",function(){P.removeCls("mandatory");V.addCls("hidden")})}if(f){f.on("focus",function(){f.removeCls("mandatory");D.addCls("hidden")})}if(m){m.on("focus",function(){m.removeCls("mandatory");i.addCls("hidden")})}if(this.country!=="costaRica"&&this.city){Ext.dom.Query.select("#input-city")[0].value=this.city}if(this.phone){Ext.dom.Query.select("#input-phone")[0].value=this.phone}if(this.sector){Ext.dom.Query.select("#input-sector")[0].value=this.sector}if(this.currencyField&&this.country=="other"){Ext.dom.Query.select("#input-currency")[0].value=this.currency}if(Q&&this.countryCode){Ext.dom.Query.select("#input-country")[0].value=this.countryCode}if(this.mxState&&this.country=="mexico"){Ext.dom.Query.select("#input-mx-state")[0].value=this.mxState}if(T){document.querySelector("#input-container").lastElementChild.previousElementSibling.style.marginBottom="66px"}}},{name:"step-video",content:{tag:"div",cls:"image-wrapper",children:[{tag:"img",itemId:"imgVideoCountry",cls:"step4 wizard-video"}]},callback:function(){var b=Ext.get(Ext.dom.Query.select(".wizard-video")[0]);var d=Ext.get("wizard-footer-title");d.hide();if(this.country=="mexico"){var a=new Date();if(a.getMonth()==10&&Math.abs(AL.config.idCompany%2)==1){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_mexico-factura2.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_mx2.png"}}else{if(this.country=="republicaDominicana"){var a=new Date();if(a.getMonth()==10&&Math.abs(AL.config.idCompany%2)==1){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_republica-factura2.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_rd2.png"}}else{if(this.country=="panama"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_pan2.png"}else{if(this.country=="spain"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_spain2.png"}else{if(this.country=="peru"){var a=new Date();if(a.getMonth()==10&&Math.abs(AL.config.idCompany%2)==1){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_peru-factura2.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_peru2.png"}}else{if(this.country=="colombia"){if(this.originKeyword=="partner-claro"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video-col-claro2.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_col2.png"}}else{if(this.country=="usa"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_usa2.png"}else{if(this.country=="costaRica"){var a=new Date();if(a.getMonth()==10&&Math.abs(AL.config.idCompany%2)==1){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_costarica-factura2.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_costarica2.png"}}else{if(this.country=="chile"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_chile2.png"}else{if(this.country=="argentina"){b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_arg.png"}else{b.dom.src="https://cdn1.getsoft.app/images/welcome-wizard/video_other2.png"}}}}}}}}}}var c=this;b.on("click",function(){c.openVideo()})}}],closeWizard:function(a){if(a=="/invoice/add"){window.location=a}else{window.location.reload()}Ext.get("welcome-wizard").destroy()},noMoreAndClose:function(e,a){var d="yes";var c=typeof(a)!="undefined"&&a?a:"";if(e=="no"){d="no"}var b=this;Ext.Ajax.request({url:"/user/no-more-wizard/format/json",success:function(f){if(d=="yes"){b.closeWizard(a)}}})},hideWizard:function(){Ext.get("welcome-wizard").setStyle({display:"none"})},closeDropDown:function(c){var b=c.target;var d=document.getElementById("dropdown-calling-code-button");var a=document.getElementById("dropdown-country-calling-code");if(d&&a&&!d.contains(b)&&!a.contains(b)){a.classList.remove("show")}},saveCompanyInfo:function(g,j,a){var m=Ext.get(Ext.dom.Query.select("#input-sector")[0]);var f=Ext.get(Ext.dom.Query.select("#input-regime-select")[0]);var r=Ext.get(Ext.dom.Query.select("#input-city")[0]);var i=Ext.get(Ext.dom.Query.select("#input-phone")[0]);var b=Ext.get(Ext.dom.Query.select("#input-country")[0]);var u=Ext.ComponentQuery.query("combo[name=wizardCurrency]")[0];var l=Ext.get(Ext.dom.Query.select("#input-mx-state")[0]);var e=Ext.get(Ext.dom.Query.select("#input-profile")[0]);var h=Ext.get(Ext.dom.Query.select("#input-other-profile")[0]);var x=document.getElementById("input-calling-code");var t={};if(m&&m.getValue()!=""){t.sector=m.getValue()}if(f&&f.getValue()!=""){t.regime=f.getValue()}if(r&&r.getValue()!=""){t.city=r.getValue()}if(i&&Ext.String.trim(i.getValue())!=""){var n="";if(x){n=x.value+" "}t.phone=n+Ext.String.trim(i.getValue())}switch(this.country){case"mexico":if(l&&l.getValue()!=""){t.state=l.getValue();t.city=l.getValue()}break;case"costaRica":var q=Ext.ComponentQuery.query("combo[name=wizardCanton]");if(q&&q[0]){q=q[0];var c=q.getSelectedRecord();if(c){t.canton=c.get("value")}}break;case"colombia":var d=Ext.ComponentQuery.query("combo[name=wizardCity]")[0];if(d){var c=d.getSelectedRecord();if(c){t.city=c.get("value");t.idDepartment=c.get("idDepartment")}}break;case"argentina":var d=Ext.ComponentQuery.query("combo[name=wizardCity]")[0];if(d){var c=d.getSelectedRecord();if(c){t.city=c.get("value");t.idProvince=c.get("idProvince")}}var s=Ext.get(Ext.dom.Query.select("#input-ivaCondition-select")[0]);if(s&&s.getValue()!=""){var k={ivaCondition:s.getValue()};t.metadata=Ext.encode(k)}break}if(u&&u.getValue()!=""&&this.country=="other"){t.currency=u.getValue()}else{t.currency=this.getCurrency()}if(b&&b.getValue()!=""){t.countryCode=b.getValue()}if(e&&e.getValue()!=""){var o=e.getValue();if(o&&o=="other"){o=o+", "+h.getValue()}t.profile=o}if(t.regime||((t.canton||t.city||t.state)&&t.phone&&t.currency)){var w=this;w.savingChanges(true);Ext.Ajax.request({url:"/company/edit-info-from-wizard/format/json",method:"POST",params:t,success:function(){if(g=="step-1"){document.removeEventListener("click",w.closeDropDown);j=typeof(j)!="undefined"&&j?j:"no";w.noMoreAndClose(j,a)}w.savingChanges(false)}})}},savingChanges:function(a){var d=Ext.get(Ext.dom.Query.select(".wizard-loading-button")[0]);var b=Ext.get(Ext.dom.Query.select(".close-button.wizard")[0]);var e=Ext.get(Ext.dom.Query.select(".go-to-invoice")[0]);var c=Ext.get(Ext.dom.Query.select(".go-to-index")[0]);if(a){d.removeCls("disabled");b.addCls("disabled");e.hide();c.hide()}else{d.addCls("disabled");b.removeCls("disabled");e.show();c.show()}}});Ext.define("AL.modal.SideBanner",{constructor:function(a){this.message=a.configs.message;this.title=a.configs.title;this.promoBannerCls=a.configs.message?a.configs.message:"";this.bannerType=a.configs.type?a.configs.type:"";this.agreeMessage=a.configs.agreeMessage?a.configs.agreeMessage:"";this.declineMessage=a.configs.declineMessage?a.configs.declineMessage:"";this.closable=a.configs.closable?a.configs.closable:false;this.hideDecline=this.declineMessage?"":"hidden";this.hideClose=this.closable?"":"hidden";this.callback=a.configs.callback?a.configs.callback:null;this.closeBannerCallback=a.configs.closeBannerCallback?a.configs.closeBannerCallback:null;this.waitTime=a.configs.afterAnwser&&a.configs.afterAnwser.waitTime?a.configs.afterAnwser.waitTime:3000;this.afterAgreeMessage=a.configs.afterAnwser&&a.configs.afterAnwser.afterAgreeMessage?a.configs.afterAnwser.afterAgreeMessage:null;this.afterDeclineMessage=a.configs.afterAnwser&&a.configs.afterAnwser.afterDeclineMessage?a.configs.afterAnwser.afterDeclineMessage:null;this.requestConfig={};this.requestConfig.url=a.configs.requestConfig&&a.configs.requestConfig.url?a.configs.requestConfig.url:null;this.requestConfig.params=a.configs.requestConfig&&a.configs.requestConfig.params?a.configs.requestConfig.params:null},init:function(){var c={tag:"section",cls:"promo-banner "+this.promoBannerCls,type:this.bannerType?this.bannerType:"",children:[{tag:"div",cls:"promo-banner-header",children:[{tag:"span",cls:"arrow left anim-1"},{tag:"span",cls:"arrow left anim-2"},{tag:"h3",html:this.title},{tag:"span",cls:"arrow right anim-1"},{tag:"span",cls:"arrow right anim-2"}]},{tag:"div",cls:"promo-banner-message",children:[{tag:"p",html:this.message},{tag:"button",cls:"primary",html:this.agreeMessage,answer:"yes"},{tag:"button",cls:"discard "+this.hideDecline,html:this.declineMessage,answer:"no"}]},{tag:"div",cls:"close "+this.hideClose}]};var d=Ext.DomHelper;d.append(Ext.getBody(),c);var a=Ext.Element.select(".promo-banner-message button");var b=this;if(a.elements){Ext.each(a.elements,function(f){f.onclick=function(){b.respondBanner(f.getAttribute("answer"))}})}var e=Ext.Element.select(".promo-banner .close");if(e.elements&&e.elements[0]){e.elements[0].onclick=function(){b.closeBanner()}}},respondBanner:function(b){if(this.requestConfig.url){var c=this.requestConfig.params?this.requestConfig.params:{};c.answer=b;Ext.Ajax.request({url:this.requestConfig.url,method:"POST",params:c,success:function(e,f){if(this.callback){this.callback()}},failure:function(){}})}if(this.afterAgreeMessage||this.afterDeclineMessage){var d=Ext.Element.select(".promo-banner h3");Ext.Element.select(".promo-banner-message").elements[0].remove();var a=b=="yes"?this.afterAgreeMessage:this.afterDeclineMessage;if(d){d.elements[0].innerHTML=a;Ext.Element.select(".promo-banner").elements[0].className="promo-banner goodBye longText"}setTimeout(function(){Ext.Element.select(".promo-banner").elements[0].remove()},this.waitTime)}},closeBanner:function(){this.closeBannerCallback();Ext.Element.select(".promo-banner").elements[0].remove()}});Ext.define("AL.modal.PlanLimit",{constructor:function(a){this.message=a.configs.message},init:function(){var c={tag:"div",id:"plan-limit",cls:"wizard-overlay",children:[{tag:"div",id:"plan-limit-content-wrapper",children:[{tag:"div",id:"plan-limit-header",children:[{tag:"p",html:translate("yourBusinessIsGrowing",true)},{tag:"svg",id:"plan-limit-close-button",width:"24",height:"24",html:'<path fill-rule="evenodd" clip-rule="evenodd" d="M6.72951 5.68392C7.13243 5.30619 7.76526 5.3266 8.14299 5.72951L12.4135 10.2847L16.6839 5.72951C17.0616 5.3266 17.6945 5.30619 18.0974 5.68392C18.5003 6.06165 18.5207 6.69448 18.143 7.0974L13.7842 11.7468L18.143 16.3962C18.5207 16.7991 18.5003 17.4319 18.0974 17.8097C17.6945 18.1874 17.0616 18.167 16.6839 17.7641L12.4135 13.2089L8.14299 17.7641C7.76526 18.167 7.13243 18.1874 6.72951 17.8097C6.3266 17.4319 6.30619 16.7991 6.68392 16.3962L11.0427 11.7468L6.68392 7.0974C6.30619 6.69448 6.3266 6.06165 6.72951 5.68392Z" fill="#999999"/>'}]},{tag:"div",id:"plan-limit-body",children:[{tag:"img",src:"http://cdn1.getsoft.app/images/plan-limit.png"},{tag:"p",html:this.message}]},{tag:"div",id:"plan-limit-footer",children:[{tag:"div",id:"wrapper-buttons",children:[{tag:"button",id:"plan-limit-skip-button",html:translate("skip",true)},{tag:"button",id:"plan-limit-see-plans",html:translate("seePlans",true)}]}]}]}]};var d=Ext.DomHelper;d.append(Ext.getBody(),c);var b=Ext.get("plan-limit-skip-button");var e=Ext.get("plan-limit-see-plans");var a=Ext.get("plan-limit-close-button");e.on("click",this.redirectPlans,this);b.on("click",this.closeModal,this);a.on("click",this.closeModal,this)},redirectPlans:function(){window.location="/plan"},closeModal:function(){Ext.get("plan-limit").remove()}});Ext.define("AL.LoadMask",{extend:"Ext.LoadMask",dependantTasks:0,addDependantTask:function(){this.dependantTasks++},endDependantTask:function(){this.dependantTasks--;if(this.dependantTasks<=0&&this.rendered){this.destroy()}}});Ext.define("AL.form.field.ResizableImage",{extend:"Ext.panel.Panel",alias:"widget.resizableimage",title:"",border:false,cw:null,style:"text-align: left;",id:"resizableimage",initComponent:function(){var c=this.acceptedWidthImage;var h=this.acceptedHeightImage;var b=this.nameField;var e=this.textFieldLabel;var a=this.textButtonText;var g=this.htmlAfterBodyEl;var f=["image/png","image/jpg","image/jpeg"];var d=[{xtype:"filefield",name:b,fieldLabel:e,buttonText:a,afterBodyEl:g,listeners:{afterrender:function(j){var i=this;document.getElementById(j.fileInputEl.id).addEventListener("change",function(t){var k=t.target.files;var r=false;for(var n=0,q;q=k[n];n++){if(!f.includes(q.type)){r=true;break}if(!q.type.match("image.*")){continue}var o=new FileReader();o.onload=(function(u){return function(y){var x=y.target.result;var w=y.target.result;i.cw=new AL.view.ux.ImageWindowCrop({width:600,height:600,acceptedWidthImage:c,acceptedHeightImage:h,nameField:b,imageUrl:w,listeners:{save:function(){},scope:this}});i.cw.show()}})(q);o.readAsDataURL(q)}if(r){var s=Ext.ComponentQuery.query("filefield[name="+b+"]")[0];var l=s.getInputId();var m=Ext.DomQuery.selectNode("input[id="+s.getInputId()+"]");if(s&&s.oldValue){m.value=s.oldName;s.value=s.oldValue}else{m.value="";s.value=""}Ext.MessageBox.alert(translate("invalidFormat",true),translate("yourLogoMustHaveAnImageFormatPngJpgOrJpeg",true))}},false)},change:function(l,k,i){var j=Ext.DomQuery.selectNode("input[id="+l.getInputId()+"]");j.value=k.replace("C:\\fakepath\\","")}}},{xtype:"image",name:"imagePreviewUploadResize",id:"imagePreviewUploadResize",width:c,height:h,hidden:true,style:"margin-top: 4px; text-align: center; border: solid 1px #e6e6e6;",src:""}];this.items=d;this.callParent()}});Ext.ns("Ext.ux");Ext.define("AL.view.ux.ImageWindowCrop",{requires:["Ext.Window","Ext.slider.Single"],extend:"Ext.Window",alias:"widget.imagewindowcrop",name:"modalCrop",imageUrl:"",title:translate("adjustImage",true),width:500,height:500,minWidth:500,minHeight:500,modal:true,closable:false,autoScroll:true,resizable:false,maximized:false,constrain:true,refCropper:null,data:null,containerData:null,imageData:null,canvasData:null,cropBoxData:null,initComponent:function(){var b=this;var a=this.acceptedWidthImage;var d=this.acceptedHeightImage;this.fbar={xtype:"toolbar",items:[{xtype:"container",layout:"hbox",id:"container-buttons-controls-imagewindowcrop",items:[{xtype:"button",text:translate("increase",true),itemId:"zoomPlusButton",hidden:false},{xtype:"button",text:translate("reduce",true),itemId:"zoomMinusButton",hidden:false},{xtype:"button",text:"left",itemId:"moveImageLeftButton",hidden:true},{xtype:"button",text:"right",itemId:"moveImageRightButton",hidden:true},{xtype:"button",text:"top",itemId:"moveImageTopButton",hidden:true},{xtype:"button",text:"bottom",itemId:"moveImageBottomButton",hidden:true},{xtype:"sliderfield",label:"Percentage",itemId:"zoomSlider",value:50,minValue:0,maxValue:100,width:200,cls:"xxx",hidden:true,listeners:{change:function(e,g,f){b.changeZoomSlider(e,g,f)}}},{xtype:"button",text:"rot left",itemId:"rotateImageLeftButton",hidden:true},{xtype:"button",text:"rot right",itemId:"rotateImageRightButton",hidden:true}]},{xtype:"button",text:translate("cancelAction",true),itemId:"cancelButton"},{xtype:"button",text:translate("accept",true),itemId:"aceptButton"}]};this.callParent(arguments);var c=new Image();c.src=this.imageUrl;c.onload=(function(){var l=b.calculateResizeImage(c);var j=(c.width/l);var e=(c.height/l);var h=Ext.create("Ext.Img",{src:this.imageUrl,width:j,height:e});this.add(h);var k=h.el.dom;var i=0.5;var g=1.5;var f=new Cropper(k,{dragMode:"move",restore:false,guides:true,center:true,highlight:true,cropBoxMovable:true,cropBoxResizable:true,toggleDragModeOnDblclick:false,aspectRatio:(a/d),ready:function(){var n=b.refCropper=this.cropper;var m=n.getContainerData();var q=n.getCropBoxData();var o=a/d;this.data=n.getData();this.containerData=n.getContainerData();this.imageData=n.getImageData();this.canvasData=n.getCanvasData();this.cropBoxData=n.getCropBoxData()},cropmove:function(){var o=this.cropper;var r=this.data=o.getData();var m=this.containerData=o.getContainerData();var s=this.imageData=o.getImageData();var n=this.canvasData=o.getCanvasData();var q=this.cropBoxData=o.getCropBoxData()},zoom:function(o){if(o.detail.ratio>o.detail.oldRatio){}else{var m=b.refCropper;var s=this.imageData=m.getImageData();var q=this.cropBoxData=m.getCropBoxData();var r=s.width;var n=s.height;if((n<q.height)&&(r<q.width)){o.preventDefault()}}}})}).bind(this);this.down("#cancelButton").on("click",this.cancelCrop,this);this.down("#aceptButton").on("click",this.aceptCrop,this);this.down("#zoomPlusButton").on("click",this.zoomPlusCropper,this);this.down("#zoomMinusButton").on("click",this.zoomMinusCropper,this);this.down("#moveImageLeftButton").on("click",this.moveImageLeft,this);this.down("#moveImageRightButton").on("click",this.moveImageRight,this);this.down("#moveImageTopButton").on("click",this.moveImageTop,this);this.down("#moveImageBottomButton").on("click",this.moveImageBottom,this);this.down("#rotateImageLeftButton").on("click",this.rotateImageLeft,this);this.down("#rotateImageRightButton").on("click",this.rotateImageRight,this)},calculateResizeImage:function(d){var b=1;var c=d.width;var a=d.height;if(c>this.width||a>this.height){if(c>a){b=((c)/(this.width-50))}else{b=((a)/(this.height-50))}}return b},removeValueField:function(c,b){var a=Ext.DomQuery.selectNode("input[id="+c.getInputId()+"]");a.value=b.replace("C:\\fakepath\\","")},cancelCrop:function(b){var c=Ext.ComponentQuery.query("filefield[name="+this.nameField+"]")[0];var d=c.getInputId();var a=Ext.DomQuery.selectNode("input[id="+c.getInputId()+"]");if(c&&c.oldValue){a.value=c.oldName;c.value=c.oldValue}else{a.value="";c.value=""}b.up().up().doClose()},aceptCrop:function(e){var a=this;var c=this.refCropper;var b=c.getCroppedCanvas({maxWidth:1000,maxHeight:1000,fillColor:"#fff"});var g=b.toDataURL("image/png");if(g=="data:,"){g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII="}var d=Ext.getCmp("imagePreviewUploadResize");if(d){d.setSrc(g);d.show()}var f=Ext.ComponentQuery.query("filefield[name="+a.nameField+"]")[0];if(f){f.currentName=f.value;f.oldName=f.value;f.value=null;f.value=g;f.oldValue=null;f.oldValue=g}e.up().up().doClose()},changeZoomSlider:function(c,d,a){var b=this.refCropper;b.zoom(0.1)},zoomPlusCropper:function(){var a=this.refCropper;a.zoom(0.1)},zoomMinusCropper:function(){var a=this.refCropper;var e=this.imageData=a.getImageData();var c=this.cropBoxData=a.getCropBoxData();var d=e.width;var b=e.height;if((b>c.height)||(d>c.width)){a.zoom(-0.1)}},moveImageLeft:function(){var a=this.refCropper;a.move(-10,0)},moveImageRight:function(){var a=this.refCropper;a.move(10,0)},moveImageTop:function(){var a=this.refCropper;a.move(0,-10)},moveImageBottom:function(){var a=this.refCropper;a.move(0,10)},rotateImageLeft:function(){var a=this.refCropper;a.rotate(-15)},rotateImageRight:function(){var a=this.refCropper;a.rotate(15)}});Ext.onReady(function(){(function(){var l=Ext.get("social-modal");if(l){l.on("click",function(o,m){var n=Ext.get(m);if(n.getAttribute("id")==="close-media-link"||!n.up("#social-media-container")){AL.socialMedia.hide(true)}});var k=l.down("a.facebook-share-link");k.on("click",function(){AL.socialMedia.onButtonClick(k);window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("http://www.getsoft.app"),"facebook-share-dialog","width=626,height=436")})}})();(function(){var k=Ext.select("a.twitter-share-link");if(k){k.on("click",function(m){m.preventDefault();AL.socialMedia.onButtonClick(k);var l=["https://twitter.com/intent/tweet?","original_referer=https%3A%2F%2Fapp.getsoft.app%2F&","text=",encodeURIComponent(k.elements[0].getAttribute("data-text")),"&tw_p=tweetbutton&url=",encodeURIComponent(k.elements[0].getAttribute("data-url")),"&via=",encodeURIComponent(k.elements[0].getAttribute("data-via"))].join("");window.open(l,"_blank","width=500,height=500")})}})();function b(q,l,n,o){if(l.responseText){try{var k=Ext.decode(l.responseText)}catch(m){console.log(m);var k=null}if(k&&typeof(k.notification)!=="undefined"){GlobalMsg.showNotification(k.notification)}}}Ext.Ajax.on("requestcomplete",b);Ext.Ajax.on("requestexception",b);Ext.Ajax.on("beforerequest",function(l,k){var m=new Date().toUTCString();if(!k.headers){k.headers={"Request-Date":m}}else{k.headers["Request-Date"]=m}});(function(){if(Ext.get("quick-add-button-holder")){var l=[{text:translate("income",true),iconCls:"icon-transaction-in",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("income"),url:"/transaction/in"})}},{text:translate("expense",true),iconCls:"icon-transaction-out",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("expense"),url:"/transaction/out"})}},"-",{text:["mexico","peru","costaRica"].indexOf(AL.config.currentKeyCountry)!==-1?translate("specializedInvoice",true):translate("invoice",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newInvoice",true)+" "+translate("invoice"),url:"/invoice/add"})}},{text:translate("remission",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newRemission",true),url:"/remission/add"})},listeners:{beforerender:function(m){if(AL.config.currentKeyCountry=="usa"){m.hide()}}}},{text:translate("bill",true),iconCls:"icon-bill",handler:function(){GlobalRedirector.go({zoneTitle:translate("newF",true)+" "+translate("bill"),url:"/bill/add"})}},{text:translate("purchaseOrder",true),iconCls:"icon-bill",handler:function(){GlobalRedirector.go({zoneTitle:translate("newF",true)+" "+translate("purchaseOrder"),url:"/purchase-order/add"})}},"-",{text:translate("saleItem",true),iconCls:"icon-item",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("saleItem"),url:"/item/add"})}},"-",{text:translate("client",true),iconCls:"icon-client",handler:function(){GlobalRedirector.go({zoneTitle:translate("newContact",true),url:"/client/add"})}},{text:translate("estimate",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newF",true)+" "+translate("estimate")+"",url:"/estimate/add"})}},"-",{text:translate("othersM",true),name:"otherButtonMainenu",iconCls:"icon-other-add",listeners:{beforerender:function(m){if(AL.config.currentKeyCountry=="mexico"){m.menu.insert(1,[{text:translate("invoice",true)+" desde XML",iconCls:"icon-invoice",handler:function(){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,title:"Crear "+translate("invoice")+" a partir de archivo XML",bodyStyle:"background: transparent",items:[{xtype:"form",width:550,frame:false,border:false,defaults:{width:450,labelWidth:140},bodyPadding:"0 0 0 50",items:[{xtype:"hidden",name:"type",value:"invoiceXml"},{xtype:"filefield",name:"file",allowBlank:false,fieldLabel:"Seleccionar archivo XML",listeners:{change:function(q,o){var n=Ext.DomQuery.selectNode("input[id="+q.getInputId()+"]");n.value=o.replace("C:\\fakepath\\","")}}},{xtype:"filefield",name:"pdfFile",fieldLabel:"Seleccionar archivo PDF",labelWidth:140,width:450,listeners:{change:function(q,o){var n=Ext.DomQuery.selectNode("input[id="+q.getInputId()+"]");n.value=o.replace("C:\\fakepath\\","")}}}],buttons:[{text:translate("attach",true),action:"uploadFile",hidden:true}]}],footer:{items:[{cls:"button main-button",text:translate("attach",true),margin:"0 28 0 0",handler:function(n){var r=n.up("window");var o=r.down("button[action=uploadFile]");if(o){o.fireEvent("click",o)}var q=r.down("form");if(q.isValid()){q.submit({url:"/invoice/upload-xml/format/json",waitMsg:translate("uploadingFile"),success:function(t,x){var u=x.response;var y=Ext.decode(u.responseText);if(o){o.fireEvent("click",o)}r.close();if(y.success){var s="";if(y.idPdf){s="/idPdf/"+y.idPdf}if(y.canGenerateInvoiceAutomatically=="yes"){var w=y.xmlTotal;Ext.Msg.show({title:translate("createInvoiceTitle"),msg:"¿"+translate("createInvoiceConfirmationWithTotal")+": "+w+" "+translate("forTheClient")+" "+y.clientName+"?",buttons:Ext.Msg.YESNOCANCEL,buttonText:{yes:translate("createButton"),no:translate("editButton"),cancel:translate("cancelButton")},icon:Ext.Msg.QUESTION,fn:function(B){if(B=="yes"){var z=Ext.dom.Query.select(".content-area")[0];var A=Ext.create("AL.LoadMask",{target:z,msg:translate("loading")});A.show();Ext.Ajax.request({url:"/invoice/generate-from-xml/format/json",method:"POST",params:{idXml:y.idXml,idPdf:y.idPdf},success:function(C,D){var E=Ext.decode(C.responseText);A.hide();if(E.success){window.location="/invoice/view/id/"+E.invoiceIdLocal}else{if(E.cause){Ext.MessageBox.alert(translate("errorTitle"),E.cause)}if(E.idXml){window.location="/invoice/add-from-xml/id/"+E.idXml+s}}},failure:function(){A.hide()}})}else{if(B=="no"){window.location="/invoice/add-from-xml/id/"+y.idXml+s}}}})}else{window.location="/invoice/add-from-xml/id/"+y.idXml+s}}else{GlobalMsg.showErrorMessage(translate("errorTitle"),y.cause)}},failure:function(u,t){if(o){o.fireEvent("click",o)}r.close();var s=t.response;var w=Ext.decode(s.responseText);if(w.cause){GlobalMsg.showErrorMessage(translate("errorTitle"),w.cause)}else{GlobalMsg.showErrorMessage(translate("errorTitle"),translate("fileUploadFailed"))}}})}},listeners:{afterrender:function(n){var q=n.up("window");var o=q.down("form");n.setDisabled(o.hasInvalidField());o.on("validitychange",function(s,r){n.setDisabled(!r)})}}}]}})}},{text:translate("bill",true)+" desde XML",iconCls:"icon-invoice",handler:function(){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,bodyStyle:"background: transparent",title:"Crear "+translate("bill")+" a partir de archivo XML",items:[{xtype:"form",width:550,frame:false,border:false,defaults:{width:450,labelWidth:140},bodyPadding:"0 0 0 50",items:[{xtype:"hidden",name:"type",value:"billXml"},{xtype:"filefield",name:"file",allowBlank:false,fieldLabel:"Seleccionar archivo XML",listeners:{change:function(q,o){var n=Ext.DomQuery.selectNode("input[id="+q.getInputId()+"]");n.value=o.replace("C:\\fakepath\\","")}}},{xtype:"filefield",name:"pdfFile",fieldLabel:"Seleccionar archivo PDF",labelWidth:140,width:450,listeners:{change:function(q,o){var n=Ext.DomQuery.selectNode("input[id="+q.getInputId()+"]");n.value=o.replace("C:\\fakepath\\","")}}}],buttons:[{text:translate("attach",true),action:"uploadFile",hidden:true}]}],footer:{items:[{cls:"button main-button",text:translate("attach",true),margin:"0 28 0 0",handler:function(n){var r=n.up("window");var o=r.down("button[action=uploadFile]");if(o){o.fireEvent("click",o)}var q=r.down("form");q.submit({url:"/bill/upload-xml/format/json",waitMsg:translate("uploadingFile"),success:function(t,x){var u=x.response;var y=Ext.decode(u.responseText);if(o){o.fireEvent("click",o)}r.close();if(y.success){var s="";if(y.idPdf){s="/idPdf/"+y.idPdf}if(y.canGenerateBillAutomatically=="yes"){var w=y.xmlTotal;Ext.Msg.show({title:translate("createBillTitle"),msg:"¿"+translate("createBillConfirmationWithTotal")+": "+w+" "+translate("forTheProvider")+" "+y.clientName+"?",buttons:Ext.Msg.YESNOCANCEL,buttonText:{yes:translate("createButton"),no:translate("editButton"),cancel:translate("cancelButton")},icon:Ext.Msg.QUESTION,fn:function(B){if(B=="yes"){var z=Ext.dom.Query.select(".content-area")[0];var A=Ext.create("AL.LoadMask",{target:z,msg:translate("loading")});A.show();Ext.Ajax.request({url:"/bill/generate-from-xml/format/json",method:"POST",params:{idXml:y.idXml,idPdf:y.idPdf},success:function(C,D){var E=Ext.decode(C.responseText);A.hide();if(E.success){window.location="/bill/view/id/"+E.billId}else{if(E.cause){Ext.MessageBox.alert(translate("errorTitle"),E.cause)}if(E.idXml){window.location="/bill/add-from-xml/id/"+E.idXml+s}}},failure:function(){A.hide()}})}else{if(B=="no"){window.location="/bill/add-from-xml/id/"+y.idXml+s}}}})}else{window.location="/bill/add-from-xml/id/"+y.idXml+s}}else{GlobalMsg.showErrorMessage(translate("errorTitle"),y.cause)}},failure:function(u,t){if(o){o.fireEvent("click",o)}r.close();var s=t.response;var w=Ext.decode(s.responseText);if(w.cause){GlobalMsg.showErrorMessage(translate("errorTitle"),w.cause)}else{GlobalMsg.showErrorMessage(translate("errorTitle"),translate("fileUploadFailed"))}}})},listeners:{afterrender:function(n){var q=n.up("window");var o=q.down("form");n.setDisabled(o.hasInvalidField());o.on("validitychange",function(s,r){n.setDisabled(!r)})}}}]}})}}])}}},menu:new Ext.menu.Menu({items:[{text:translate("recurringInvoice",true),iconCls:"icon-recurring-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newInvoice",true)+" "+translate("recurringInvoice"),url:"/recurring-invoice/add"})}},{text:translate("recurringExpense",true),iconCls:"icon-recurring-payment",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("recurringExpense"),url:"/recurring-payment/add"})}},{text:translate("bank",true),iconCls:"icon-bank",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("bank"),url:"/account/add"})}},{text:translate("creditNote",true),iconCls:"icon-credit-note",handler:function(){GlobalRedirector.go({zoneTitle:translate("newF",true)+" "+translate("creditNote"),url:"/credit-note/add"})}},{text:translate("debitNote",true),iconCls:"icon-debit-note",handler:function(){GlobalRedirector.go({zoneTitle:translate("newF",true)+" "+translate("debitNote"),url:"/debit-note/add"})}},{text:translate("seller",true),iconCls:"icon-client",handler:function(){GlobalRedirector.go({zoneTitle:translate("newM",true)+" "+translate("seller"),url:"/seller/add"})}}]})}];switch(AL.config.currentKeyCountry){case"peru":var k=AL.config.regime==="NEW_RUS"?1:0;l.splice(3,k,{text:translate("saleTicket",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newInvoice",true)+" "+translate("saleTicket"),url:"/invoice/add/dt/saleTicket"})}});break;case"mexico":l.splice(3,0,{text:translate("saleTicket",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newInvoice",true)+" "+translate("saleTicket"),url:"/invoice/add/dt/saleTicket"})}});l.splice(5,0,{text:translate("globalInvoice",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newGlobalInvoice",true),url:"/global-invoice/add"})}});break;case"costaRica":l.splice(3,0,{text:translate("saleTicket",true),iconCls:"icon-invoice",handler:function(){GlobalRedirector.go({zoneTitle:translate("newInvoice",true)+" "+translate("saleTicket"),url:"/invoice/add/dt/saleTicket"})}});break}Ext.create("Ext.button.Split",{renderTo:"quick-add-button-holder",text:"+",scale:"medium",handler:function(){this.showMenu()},menu:{xtype:"menu",items:l}})}})();var h=Ext.get("change-logo-link");if(h){h.on("click",function(k){k.preventDefault();Ext.create("AL.view.company.FileUploadWindowLogo",{title:translate("changeLogo",true),url:"/company/set-logo/format/json",fieldName:"logo",fieldLabel:translate("logo",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingLogo",true),bodyPadding:0,height:230})})}(function(){if(Ext.get("search")){var k=Ext.create("Ext.data.JsonStore",{proxy:{type:"ajax",url:"/search/query/format/json",reader:{type:"json",root:"results"}},fields:["title","description","resourceType","categoryNameES","link","icon"]});Ext.create("Ext.form.ComboBox",{hideLabel:true,hideTrigger:true,store:k,queryMode:"remote",queryDelay:500,listConfig:{minWidth:306,maxHeight:500,loadingText:translate("searching",true),emptyText:'<div style="padding:10px !important; color: #666">'+translate("theSearchDidNotGetAnyResults",true)+"</div>",cls:"search-input-list"},autoSelect:false,emptyText:translate("search",true),allowBlank:true,displayField:"title",minChars:1,renderTo:"search",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="search-result {[this.darkLightClass(values)]} {[this.isFirstTypeShowed(values) ?   "first" : ""]} {[(parent[xindex]) ? (parent[xindex-1].resourceType != parent[xindex].resourceType) ? "last" : "" : ""]}" >','<div class="label">{[this.isFirstTypeShowed(values) ?  values.categoryNameES : "&nbsp;"]}</div>',"{[this.setTypeShowedOn(values)]}",'<div class="value x-boundlist-item">','<div class="title">{title}</div>','<div class="description">{description}</div>',"</div>","</div>","</tpl>",{resources:{},isFirstTypeShowed:function(l){if(!this.resources[l.resourceType]){return true}else{return false}},setTypeShowedOn:function(l){this.resources[l.resourceType]=true},lastCategory:"",currentCategory:"",currentClass:"light",darkLightClass:function(l){if(this.lastCategory==""){this.lastCategory=l.resourceType}else{this.lastCategory=this.currentCategory}this.currentCategory=l.resourceType;if(this.currentCategory!=this.lastCategory){if(this.currentClass=="light"){this.currentClass="dark"}else{this.currentClass="light"}}return this.currentClass},reset:function(){for(var l in this.resources){this.resources[l]=null}this.lastCategory="";this.currentCategory="";this.currentClass="light"}}),listeners:{beforequery:function(){this.tpl.reset()},select:function(n,l,m){window.location=l[0].get("link")},specialkey:function(m,l){if(l.getKey()==l.ENTER){if(!isNaN(m.getValue())||!m.findRecordByValue(m.getValue())){window.location="/search/query/query/"+m.getValue()}}}}})}})();var i=Ext.Element.select(".achievement-close-button");i.on("click",function(n,r){var q=Ext.get("achievements-banner");var l=Ext.create("Ext.Component",{html:'<div class="close-bar"><img src="https://cdn1.getsoft.app/images/cerrar2-banner.png" class="achievements-cancel"><div class="wrapper"><div class="achievements-close">Cerrar</div><div class="achievements-close-not-show">Cerrar y no volver a mostrar</div><div class="achievements-cancel">Cancelar</div></div></div>',width:1024,id:"achievements-banner-close-div",renderTo:q});var o=Ext.Element.select(".achievements-close");o.on("click",function(s,t){q.destroy()});var m=Ext.Element.select(".achievements-close-not-show");m.on("click",function(){Ext.Ajax.request({url:"/company/close-achievements-banner/format/json",method:"POST",success:function(s,t){},failure:function(){}});q.destroy()});var k=Ext.Element.select(".achievements-cancel");k.on("click",function(){l.destroy()})});var j=Ext.Element.select("div.hint div.closeButton");j.on("click",function(m,n){m.preventDefault();var l=Ext.get(n);var k=l.up("div.hint");k.destroy();Ext.Ajax.request({url:"/user/read-hint/format/json",method:"POST",params:{id:n.getAttribute("data-hint-id")},success:function(o,q){},failure:function(){}})});var g=Ext.Element.select(".promo-banner-message button");if(g.elements){Ext.each(g.elements,function(k){k.onclick=function(){var l=Ext.Element.select(".promo-banner").elements[0];var m=l.getAttribute("type");var o=k.getAttribute("answer");Ext.Ajax.request({url:"/company/answer-share-data-promo/format/json",method:"POST",params:{answer:o,type:m},success:function(t,u){if(m=="test-new-interface"){setTimeout(function(){location.reload()},5000)}},failure:function(){}});var s=Ext.Element.select(".promo-banner h3");Ext.Element.select(".promo-banner-message").elements[0].remove();var n=m==="test-new-interface"?"Escríbenos a Soporte si necesitas ayuda":"¡Gracias!";var q=m==="test-new-interface"?5000:3000;var r="";if(o==="no"){n=m==="test-new-interface"?"Gracias por tu respuesta":"Tus datos nunca serán compartidos sin tu autorización";q=5000;r=" longText "}if(s){s.elements[0].innerHTML=n;Ext.Element.select(".promo-banner").elements[0].className="promo-banner goodBye"+r}setTimeout(function(){Ext.Element.select(".promo-banner").elements[0].remove()},q)}})}var c=Ext.Element.select(".promo-banner .close");if(c.elements&&c.elements[0]){c.elements[0].onclick=function(){var k=Ext.Date.add(new Date(),Ext.Date.DAY,7);Ext.util.Cookies.set("al-experience-faster-interface","no",k);Ext.Element.select(".promo-banner").elements[0].remove()}}var e=Ext.Element.select("#welcome-wizard.new-interface .content");if(e.elements&&e.elements[0]){e.elements[0].onclick=function(){var k=document.createElement("div");k.className="video-player";k.innerHTML='<iframe width="900" height="438" src="https://www.youtube.com/embed/9QPxA7lFSVo?autoplay=1&amp;rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>';Ext.Element.select("#welcome-wizard.new-interface #step-content").elements[0].appendChild(k)}}var f=Ext.Element.select("#welcome-wizard.new-interface #step-content-wrapper .back-next-buttons span");if(f.elements&&f.elements[0]){f.elements[0].onclick=function(){Ext.create("AL.view.support.WindowCreateSupportTicket")}}var a=Ext.Element.select("#welcome-wizard.new-interface .close");if(a.elements){Ext.each(a.elements,function(k){k.onclick=function(){Ext.Ajax.request({url:"/user/no-more-wizard/format/json",method:"POST",params:{type:"close-new-interface-banner"},success:function(l,m){Ext.Element.select("#welcome-wizard.new-interface").elements[0].remove()},failure:function(){}})}})}Ext.define("GlobalMsg",{singleton:true,configs:{messages:{formError:translate("youMustCheckTheFieldsMarkedInRedToContinue",true)},templates:{formInvalidFields:{title:translate("error",true),text:translate("youMustCheckTheFieldsMarkedInRedToContinue",true),type:"error"}}},msgContainer:Ext.get("notification-wrapper"),createBox:function(m,l,k){return'<div class="div-notification notification '+k+'"><div id="border-top"></div><div class="notification-icon"><svg class="icon '+k+' light large"><use xlink:href="/images/smile-icons.svg#'+(k=="success"?"success":"info")+'"></use></svg></div><h3>'+m+"</h3><p>"+l+'</p><div class="notification-close-button">x</div></div>'},showNotification:function(n){var l="notice";var q="Información";var o="";var m=n.closeable;if(Ext.isObject(n)){if(n.tpl){l=this.configs.templates[n.tpl].type;q=this.configs.templates[n.tpl].title;o=this.configs.templates[n.tpl].text}else{l=n.type||l;q=n.title||q;o=n.text||o}if(Ext.isArray(o)){var k="<ul>";Ext.each(o,function(r){k+="<li>"+r+"</li>"});k+="</ul>";o=k}}else{if(Ext.isString(n)){o=n}}Ext.getBody().scrollTo("top",0,{duration:500,callback:function(){var r=Ext.DomHelper.append(this.msgContainer,this.createBox(q,o,l),true);if(r.query(".appsupport-link")&&Ext.get(r.query(".appsupport-link"))){var t=Ext.get(r.query(".appsupport-link"));t.on("click",function(u){u.preventDefault();Ext.create("AL.view.support.WindowCreateSupportTicket")})}var s=Ext.dom.Query.select(".notification-close-button");Ext.each(s,function(u){var x=Ext.get(u);var w=x.findParentNode(".notification");w=Ext.get(w);x.on("click",function(){w.destroy()})});if(m==="no"){r.slideIn("t")}else{r.slideIn("t").ghost("t",{duration:1000,delay:7000,remove:true});n.destroy()}window.scrollTo(0,0)},scope:this})},showErrorMessage:function(n,k,m,l){k=(k)?k:this.configs.messages.formError;l=(l)?l:"error";this.showNotification({title:n,text:k,type:l,closeable:m})}});Ext.define("GlobalMask",{singleton:true,mask:null,lastCls:null,show:function(l){if(!this.mask){this.mask=Ext.create("Ext.Component",{renderTo:Ext.getBody(),id:"global-mask",hidden:true,style:{zIndex:19035,position:"absolute",width:"100%",height:"100%"}})}var k=this.mask;if(this.lastCls){k.removeCls(this.lastCls);this.lastCls=null}if(l){k.addCls(l);this.lastCls=l}k.show()},hide:function(){var k=this.mask;k.hide();if(this.lastCls){k.removeCls(this.lastCls);this.lastCls=null}}});Ext.define("GlobalLoadMask",{singleton:true,masks:{},defaults:{msg:translate("loadingAction",true)},show:function(m,l){var n=null;var k=this.getComponent(m);if(k){n=k.id;if(n){if(!this.masks[n]){l=this.loadDefaults(l);this.masks[n]=new Ext.LoadMask(k,l)}if(!this.masks[n].visible){this.masks[n].show();this.masks[n].visible=true}}}},hide:function(l){var m=null;var k=this.getComponent(l);if(k){m=k.id;if(m){if(this.masks[m]){this.masks[m].hide();this.masks[m].visible=false}}}},getComponent:function(l){var k=l;if(Ext.typeOf(l)==="string"){k=Ext.get(l)}return k},loadDefaults:function(k){var l=this.defaults;if(k){Ext.Object.each(l,function(m,o,n){if(!k[m]){k[m]=o}})}else{k=l}return k}});Ext.define("GlobalRedirector",{singleton:true,bar:null,go:function(m){var l=m.zoneTitle||translate("loadingAction",true);var k=Ext.MessageBox.show({msg:l,width:160,wait:true,waitConfig:{interval:200}});if(m.url){window.location=m.url}this.bar=k},close:function(){var k=this.bar;k.close()}});var d=function(){var l=this;if(!this.configs){return}var m=["container","fieldset","panel","addressField","form"];var k=function(q,o){Ext.each(q,function(s){if(s&&m.indexOf(s.xtype)!==-1){return k(s.items.items,s)}if(s.orders){var r=Ext.Array.filter(s.orders,function(t){if(l.configs.country in t){return t}});if(r){Ext.each(r,function(u){var t=u[l.configs.country];o.insert(t,s)})}}})};var n=function(o){var q=AL.config.advancedFunctionsKey;Ext.each(o,function(u){var s=null;var w=l.configs.country;var t=l.configs.isActiveElectronicInvoicing;if(u.countries){if(u.countriesStampValidate){if(u.countries.indexOf(w)!==-1&&t){u.show()}else{u.hide()}}else{if(u.countries.indexOf(w)!==-1){u.show()}else{u.hide()}}}if(m.indexOf(u.xtype)!==-1){return n(u.items.items)}if(u.advancedFunctionKey&&q){if(q.indexOf(u.advancedFunctionKey)!==-1){u.show()}else{u.hide()}}if(u.requires){if(u.requires.indexOf(w)!==-1){s=false}else{s=true}}if(u.isRequiredForElectronicInvoicing){if(u.isRequiredForElectronicInvoicing.indexOf(w)!==-1&&t){s=false}else{s=s===null?true:s}}u.allowBlank=s===null?u.allowBlank:s;if(u.store){var r=u.getStore();if(!r.hasLoaded()){if(r.autoLoadBeforeRender===true){if(!u.countries||(u.countries&&u.countries.indexOf(w)!==-1)){r.load()}}}}})};n(this.items.items);k(this.items.items,this)};Ext.override(Ext.form.Panel,{listeners:{beforeRender:function(){this.executeActionsBeforeRender()}},executeActionsBeforeRender:function(){this.validateCustomProperties()},validateCustomProperties:d});Ext.override(Ext.window.Window,{listeners:{beforeRender:function(){this.executeActionsBeforeRender()}},executeActionsBeforeRender:function(){this.validateCustomProperties()},validateCustomProperties:d})});/*
Copyright(c) 2012 Company Name
*/
Ext.define("AL.proxy.CacheAjax",function(){var b="AL";var a;return{extend:"Ext.data.proxy.Ajax",alias:"proxy.cacheajax",useLocalStorage:false,queryParam:"query",constructor:function(){this.callParent(arguments);if(this.useLocalStorage&&window.localStorage){if(!localStorage.getItem(b)){localStorage[b]="{}"}a=this.getLocalStorageObj();if(!a[this.cacheName]){a[this.cacheName]={};this.setLocalStorageObj(a)}}else{Ext.ns("AL.data."+this.cacheName)}},read:function(e,k,f){var h=e.params?e.params[this.queryParam]:"",g=e.page,j=e.start,c=e.limit,d=this.getCachedResponse(h,g,j,c);if(e.forceRequest||!d||f.proxy.forceRequest){this.callParent(arguments)}else{this.processResponse(true,e,null,d,k,f,true)}},getCachedResponse:function(g,f,h,c){var d;var e=g+"-"+f+"-"+h+"-"+c;if(this.useLocalStorage&&window.localStorage){d=a[this.cacheName][e]}else{d=AL.data[this.cacheName][e]}if(d){return Ext.decode(d)}},setCachedResponse:function(c,e){var d=e.query+"-"+e.page+"-"+e.start+"-"+e.limit;if(this.useLocalStorage&&window.localStorage){a[this.cacheName][d]=c;this.setLocalStorageObj(a)}else{AL.data[this.cacheName][d]=c}},processResponse:function(h,e,g,d,j,f,c){if(h===true&&!c){this.setCachedResponse(d.responseText,e.params)}this.callParent(arguments)},getCacheKeys:function(){var c=[];if(this.useLocalStorage&&window.localStorage){for(property in a[this.cacheName]){c.push(property)}}else{for(property in AL.data[this.cacheName]){c.push(property)}}return c},clearCacheByTerms:function(f){var c=this.getCacheKeys();for(var d in f){for(var e in c){if(f[d].match(new RegExp(c[e],"gi"))){this.clearCache(c[e]);delete c[e]}}}},clearCache:function(c){if(Ext.isDefined(c)){if(Ext.isString(c)){if(this.useLocalStorage&&window.localStorage){if(a[this.cacheName][c]){delete a[this.cacheName][c];this.setLocalStorageObj(a)}}else{if(AL.data[this.cacheName][c]){delete AL.data[this.cacheName][c]}}}}else{if(this.useLocalStorage&&window.localStorage){for(property in a[this.cacheName]){delete a[this.cacheName][property]}}else{for(property in AL.data[this.cacheName]){delete AL.data[this.cacheName][property]}}}},getLocalStorageObj:function(){return Ext.decode(localStorage[b])},setLocalStorageObj:function(c){localStorage[b]=Ext.encode(c)}}});Ext.define("AL.view.ux.window.ModalTooltip",{extend:"Ext.window.Window",alias:"widget.ux_window_ModalTooltip",cls:"modal-tooltip",modal:true,floating:true,closable:true,showBtnClose:true,showHeader:true,draggable:false,resizable:false,padding:1,positionByEl:false,layout:null,targetEl:null,targetImg:null,position:"tl",offsets:null,offsetsImg:[0,0],positionBy:"alignTo",title:"Título",newBadge:false,bodyImage:null,bodyImageStyle:{},bodyImageCallback:null,bodyHtml:"",bodyBorder:false,frame:false,footerItems:[],closeCallback:null,repositionOnWindowResize:true,usesQueue:false,useMaskInQueue:true,dispatchNextModalOnClose:true,prioritize:false,maskType:"dark",closeGroupOnClose:false,beforeDispatch:null,afterDispatch:null,dispatchShowDelayTime:0,delayAll:false,initComponent:function(){var d=this;if(this.showHeader){this.header={height:50,title:this.title,tools:[{xtype:"button",height:18,width:18,border:0,padding:0,style:"background: transparent !important; margin-right: 10px; ",hidden:!this.showBtnClose,handler:function(j,h,f){var g=this.up("window");if(g.closeCallback){g.closeCallback(g)}else{g.close()}},html:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.861839 1.18392C1.26475 0.806188 1.89759 0.826602 2.27532 1.22951L6.54578 5.78468L10.8162 1.22951C11.194 0.826602 11.8268 0.806188 12.2297 1.18392C12.6326 1.56165 12.653 2.19448 12.2753 2.5974L7.91651 7.24679L12.2753 11.8962C12.653 12.2991 12.6326 12.9319 12.2297 13.3097C11.8268 13.6874 11.194 13.667 10.8162 13.2641L6.54578 8.7089L2.27532 13.2641C1.89759 13.667 1.26475 13.6874 0.861839 13.3097C0.458926 12.9319 0.438512 12.2991 0.816243 11.8962L5.17505 7.24679L0.816242 2.5974C0.438512 2.19448 0.458926 1.56165 0.861839 1.18392Z" fill="#B3B3B3"/>                            </svg>'}],}}var b=[];if(this.bodyHtml){if(this.bodyImage){var c={},a="";if(this.bodyImageCallback){c={el:{click:function(){d.bodyImageCallback(d)}}};a="cursor: pointer;"}b.push({xtype:"container",html:'<img src="'+this.bodyImage+'" style="'+a+'">',style:this.bodyImageStyle,listeners:c})}b.push({xtype:"container",margin:"12 20",style:{color:"#808080",fontFamily:"Roboto"},html:this.bodyHtml,})}if(b.length){this.items=b;this.layout="auto"}if(this.footerItems){this.dockedItems=[{xtype:"toolbar",dock:"bottom",margin:"12 20",border:0,style:"background: transparent !important;",items:this.footerItems}]}this.callParent(arguments)},setNewPosition:function(a){if(a.positionBy=="setPosition"){if(a.offsets){a.setPosition(a.targetEl.getX()+a.offsets[0],a.targetEl.getY()+a.offsets[1])}else{a.setPosition(a.targetEl.getX(),a.targetEl.getY())}}else{a.alignTo(a.targetEl,a.position,a.offsets)}},removeFromQueue:function(e){var d=AL.config.modalTooltips.length;var c,a,b;for(c=0;c<d;c++){b=AL.config.modalTooltips[c];for(a=0;a<b.length;a++){if(e==b[a]){AL.config.modalTooltips[c].splice(a,1);if(AL.config.modalTooltips[c].length==0){AL.config.modalTooltips.splice(c,1)}return}}}},getModalsByModal:function(e){var d=AL.config.modalTooltips.length;var c,a,b;for(c=0;c<d;c++){b=AL.config.modalTooltips[c];for(a=0;a<b.length;a++){if(e==b[a]){return b}}}return[]},queueToShow:function(a){var b=this;var a=a||[];a.unshift(b);Ext.each(a,function(c){c.usesQueue=true});if(!AL.config.modalTooltips){AL.config.modalTooltips=[]}if(b.prioritize){AL.config.modalTooltips.unshift(a);b.showModals(a)}else{AL.config.modalTooltips.push(a);if(AL.config.modalTooltips.length==1){b.showModals(a)}}},showModals:function(b){var c=false;var a=0;Ext.each(b,function(d){if(d.delayAll){c=true;a=d.dispatchShowDelayTime;return false}});if(c){setTimeout(function(){Ext.each(b,function(d){if(d.beforeDispatch){d.beforeDispatch(d)}if(d.useMaskInQueue){GlobalMask.show(d.maskType)}d.show();if(d.afterDispatch){d.afterDispatch(d)}})},a)}else{Ext.each(b,function(d){if(d.beforeDispatch){d.beforeDispatch(d)}setTimeout(function(){if(d.useMaskInQueue){GlobalMask.show(d.maskType)}d.show();if(d.afterDispatch){d.afterDispatch(d)}},d.dispatchShowDelayTime)})}},dispatchNextInQueue:function(){if(AL.config.modalTooltips.length>0){var a=AL.config.modalTooltips[0];Ext.each(a,function(b){if(b.beforeDispatch){b.beforeDispatch(b)}setTimeout(function(){if(b.useMaskInQueue){GlobalMask.show(b.maskType)}b.show();if(b.afterDispatch){b.afterDispatch(b)}},b.dispatchShowDelayTime)})}},listeners:{show:function(a){if(!a.targetEl){return}if(a.targetImg){var b=a.targetImgStyle?a.targetImgStyle:{};a.targetImgEl=Ext.create("Ext.Img",{cls:"modal-tooltip-target-image",src:a.targetImg,renderTo:Ext.getBody(),floating:true,style:b,})}if(a.targetImgEl){if(a.positionBy=="setPosition"){a.targetImgEl.setPosition(a.targetEl.getX()+a.offsetsImg[0],a.targetEl.getY()+a.offsetsImg[1])}else{a.targetImgEl.alignTo(a.targetEl,"tl-tl")}}this.setNewPosition(a);if(a.repositionOnWindowResize){Ext.EventManager.onWindowResize(function(){if(a.isHidden()||a.isDestroyed){return}a.setNewPosition(a);if(a.targetImgEl){if(a.positionBy=="setPosition"){a.targetImgEl.setPosition(a.targetEl.getX(),a.targetEl.getY())}else{a.targetImgEl.alignTo(a.targetEl,"tl-tl")}}})}},close:function(b){if(b.targetImgEl){b.targetImgEl.hide()}if(b.usesQueue){var a=b.getModalsByModal(b);b.removeFromQueue(b);if(b.closeGroupOnClose){Ext.each(a,function(c){if(c&&c!=b){c.dispatchNextModalOnClose=false;c.close()}})}if(b.useMaskInQueue){GlobalMask.hide()}if(b.dispatchNextModalOnClose){b.dispatchNextInQueue()}}}}});Ext.define("AL.view.common.SmileCarrousel",{extend:"Ext.Component",alias:"widget.common_SmileCarrousel",style:"display:none;",cls:"smile-carrousel",initComponent:function(){if(!this.items||!this.renderTo){return}var e=document.getElementById(this.renderTo);if(!e){return}e.innerHTML="";e.setAttribute("data-carrousel-slide-active",1);if(!this.translationTime){this.translationTime=3500}this.items=this.slideDepuration();e.append(this.createHeader());for(var d=0;d<this.items.length;d++){var c=this.items[d];e.append(this.createSlide(c,d+1))}e.append(this.createFooter());var f=document.querySelectorAll(".dot");for(var a=0;a<f.length;a++){var b=f[a];b.addEventListener("click",this.translation.bind(this,a+1))}this.interval=setInterval(this.translation.bind(this),this.translationTime);this.callParent(arguments)},createHeader:function(){var a=document.createElement("div");a.classList.add("carrousel-wrapper-header");a.innerHTML='<div class="carrousel-content-header">                                <p style="display:inline; color: white; margin-right:10px;">Para ayuda escríbenos al</p>                                <a href="https://wa.me/593998911231?text=Hola%20Centro%20de%20Soporte%20GETSOFT" class="button-outline" target="_blank">0998911231</a>                            </div>';return a},createFooter:function(){var c=document.createElement("div");c.classList.add("carrousel-footer-wrapper");var b="";for(var a=0;a<this.items.length;a++){if(a==0){b+='<button><span class="dot active"></span></button>';continue}b+='<button><span class="dot"></span></button>'}c.innerHTML='<div class="carrousel-footer-content">                                <div  class="carrousel-controls">'+b+'</div>                            <div class="carrousel-advertising">                                <span style="padding-right: 10px; padding-top: 5px;">Síguenos en nuestras redes sociales</span>                                                              <a title="Facebook" class="button-circle" href="https://www.facebook.com/GETSOFTECUADOR/" target="_blank">                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">                                        <path fill="#fff" d="M25.4913914,33.257811 L25.4913914,24.4740625 L28.4385481,24.4740625 L28.8807085,21.0498641 L25.4913914,21.0498641 L25.4913914,18.8640127 C25.4913914,17.8729378 25.7654762,17.1975322 27.1882844,17.1975322 L29,17.1967874 L29,14.1340632 C28.6866893,14.0933477 27.6112042,14 26.3594508,14 C23.7455902,14 21.9560943,15.5954766 21.9560943,18.5248824 L21.9560943,21.0498641 L19,21.0498641 L19,24.4740625 L21.9560943,24.4740625 L21.9560943,33.257811 L25.4913914,33.257811 Z"></path>                                    </svg>                                </a>   <a title="Instagram" class="button-circle" href="https://www.instagram.com/getsoft.ec/" target="_blank">                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">                                        <g fill="#fff" transform="translate(14 14)">                                            <path d="M14.4007059,0 L5.48870588,0 C2.46223529,0 0,2.46235294 0,5.48882353 L0,14.4008235 C0,17.4274118 2.46223529,19.8896471 5.48870588,19.8896471 L14.4007059,19.8896471 C17.4274118,19.8896471 19.8896471,17.4272941 19.8896471,14.4008235 L19.8896471,5.48882353 C19.8897647,2.46235294 17.4274118,0 14.4007059,0 Z M18.1250588,14.4008235 C18.1250588,16.4543529 16.4543529,18.1249412 14.4008235,18.1249412 L5.48870588,18.1249412 C3.43529412,18.1250588 1.76470588,16.4543529 1.76470588,14.4008235 L1.76470588,5.48882353 C1.76470588,3.43541176 3.43529412,1.76470588 5.48870588,1.76470588 L14.4007059,1.76470588 C16.4542353,1.76470588 18.1249412,3.43541176 18.1249412,5.48882353 L18.1249412,14.4008235 L18.1250588,14.4008235 Z"></path>                                            <path d="M9.94482353 4.82C7.11882353 4.82 4.81976471 7.11905882 4.81976471 9.94505882 4.81976471 12.7709412 7.11882353 15.0698824 9.94482353 15.0698824 12.7708235 15.0698824 15.0698824 12.7709412 15.0698824 9.94505882 15.0698824 7.11905882 12.7708235 4.82 9.94482353 4.82zM9.94482353 13.3050588C8.092 13.3050588 6.58447059 11.7977647 6.58447059 9.94494118 6.58447059 8.092 8.09188235 6.58458824 9.94482353 6.58458824 11.7977647 6.58458824 13.3051765 8.092 13.3051765 9.94494118 13.3051765 11.7977647 11.7976471 13.3050588 9.94482353 13.3050588zM15.2848235 3.32364706C14.9448235 3.32364706 14.6108235 3.46129412 14.3707059 3.70247059 14.1294118 3.94247059 13.9907059 4.27658824 13.9907059 4.61776471 13.9907059 4.95788235 14.1295294 5.29188235 14.3707059 5.53305882 14.6107059 5.77305882 14.9448235 5.91188235 15.2848235 5.91188235 15.626 5.91188235 15.9589412 5.77305882 16.2001176 5.53305882 16.4412941 5.29188235 16.5789412 4.95776471 16.5789412 4.61776471 16.5789412 4.27658824 16.4412941 3.94247059 16.2001176 3.70247059 15.9601176 3.46129412 15.626 3.32364706 15.2848235 3.32364706z"></path>                                        </g>                                    </svg>                                </a>                            </div>                        </div>                    </div>';return c},createSlide:function(d,b){var a=document.createElement("div");var c=document.createElement("div");a.classList.add("carrousel-slide");c.classList.add("carrousel-slide-content");if(d.content){c.innerHTML=d.content}a.style="background: url("+d.url+") no-repeat center;";if(b===1){a.classList.add("active")}a.setAttribute("data-carrousel-index",b);a.append(c);return a},slideDepuration:function(){if(!this.country){return this.items}var b=[];var f=this.country;for(var c=0;c<this.items.length;c++){var e=this.items[c];var d=e.except;var a=e.only;if(d&&d.indexOf(f)!=-1){continue}if(a&&a.indexOf(f)==-1){continue}b.push(e)}return b},translation:function(a){if(a){clearInterval(this.interval);this.interval=null}var f=document.querySelector(".carrousel-slide.active");var d=(a==undefined)?((parseInt(f.dataset.carrouselIndex)%this.items.length)+1):a;var e=document.querySelector(".dot.active");var g=document.querySelectorAll(".dot")[d-1];var b=document.querySelector('.carrousel-slide[data-carrousel-index="'+d+'"]');f.classList.toggle("active");b.classList.toggle("active");e.classList.toggle("active");g.classList.toggle("active");var c=document.getElementById(this.renderTo);c.setAttribute("data-carrousel-slide-active",d);if(this.interval==null){this.interval=setInterval(this.translation.bind(this),this.translationTime)}},});Ext.define("AL.store.CategoryRules",{extend:"Ext.data.Store",fields:["id","key"],data:[{id:"1",key:"ID_ASSETS",},{id:"2",key:"ID_FIXED_ASSET",},{id:"3",key:"ID_RETENTIONS_IN_FAVOR",},{id:"4",key:"ID_TAXES_IN_FAVOR",},{id:"5",key:"ID_RECEIVABLE_ACCOUNTS",},{id:"6",key:"ID_BANKS",},{id:"7",key:"ID_INVENTORY",},{id:"8",key:"ID_RECEIVABLE_ACCOUNTS_RETURNS",},{id:"9",key:"ID_ADVANCE_OUT",},{id:"85",key:"ID_BANK_ACCOUNTS",},{id:"86",key:"ID_CASH_ACCOUNTS",},{id:"106",key:"ID_OTHER_TAX_TYPE_IN_FAVOR",},{id:"108",key:"ID_OTHER_RETENTION_TYPE_IN_FAVOR",},{id:"10",key:"ID_LIABILITIES",},{id:"11",key:"ID_DEBTS_TO_PAY_PROVIDERS",},{id:"12",key:"ID_RETENTIONS_TO_PAY",},{id:"13",key:"ID_TAXES_TO_PAY",},{id:"14",key:"ID_DEBTS_TO_PAY_CREDIT_CARDS",},{id:"15",key:"ID_DEBTS_TO_PAY_RETURNS",},{id:"16",key:"ID_ADVANCE_IN",},{id:"105",key:"ID_OTHER_TAX_TYPE_TO_PAY",},{id:"107",key:"ID_OTHER_RETENTION_TYPE_TO_PAY",},{id:"17",key:"ID_EQUITY",},{id:"18",key:"ID_UTILITIES",},{id:"19",key:"ID_INITIAL_ADJUSTMENTS_BANKS",},{id:"20",key:"ID_INITIAL_ADJUSTMENTS_INVENTORY",},{id:"21",key:"ID_INCOME",},{id:"22",key:"ID_SALES",},{id:"24",key:"ID_INTEREST_INCOME",},{id:"25",key:"ID_NO_OPERATIONAL_INCOME",},{id:"26",key:"ID_SALES_RETURNS",},{id:"27",key:"ID_EXPENSES",},{id:"28",key:"ID_BANK_EXPENSES",},{id:"29",key:"ID_COST_OF_MERCHANDISE_SOLD",},{id:"30",key:"ID_UNCOLLECTIBLE_ACCOUNTS",},{id:"31",key:"ID_OTHER_TAXES",},{id:"33",key:"ID_INVENTARIABLE_PURCHASES",},{id:"34",key:"ID_SOLD_SERVICES_COST",},{id:"35",key:"ID_NO_OPERATIONAL_EXPENSES",},{id:"36",key:"ID_INVENTORY_ADJUSTMENTS",},{id:"37",key:"ID_ITEM_PURCHASES_RETURNS",},{id:"38",key:"ID_EXCHANGE_DIFFERENCE",},{id:"39",key:"ID_FINANCIAL_DISCOUNT",},{id:"101",key:"ID_CALCULATIONS_APPROX",},{id:"114",key:"ID_TAX_NOT_DEDUCTIBLE",},{id:"40",key:"ID_BANK_TRANSFERS",},{id:"109",key:"ID_FIXED_ASSET_DEDUCTIBLE",},{id:"41",key:"ID_FUENTE_RETENTION_IN_FAVOR_COL",},{id:"43",key:"ID_IVA_RETENTION_IN_FAVOR_COL",},{id:"44",key:"ID_IVA_IN_FAVOR_COL",},{id:"46",key:"ID_ICO_IN_FAVOR_COL",},{id:"42",key:"ID_INDUSTRY_RETENTION_IN_FAVOR_COL",},{id:"49",key:"ID_INDUSTRY_RETENTION_TO_PAY_COL",},{id:"47",key:"ID_IVA_TO_PAY_COL",},{id:"48",key:"ID_FUENTE_RETENTION_TO_PAY_COL",},{id:"50",key:"ID_IVA_RETENTION_TO_PAY_COL",},{id:"51",key:"ID_ICO_TO_PAY_COL",},{id:"53",key:"ID_ISR_RETENTION_IN_FAVOR_MEX",},{id:"54",key:"ID_IVA_RETENTION_IN_FAVOR_MEX",},{id:"55",key:"ID_FLETES_IVA_RETENTION_IN_FAVOR_MEX",},{id:"100",key:"ID_LOCAL_RETENTION_IN_FAVOR_MEX",},{id:"56",key:"ID_IVA_IN_FAVOR_MEX",},{id:"96",key:"ID_IEPS_IN_FAVOR_MEX",},{id:"98",key:"ID_LOCAL_TAX_IN_FAVOR_MEX",},{id:"57",key:"ID_ISR_RETENTION_TO_PAY_MEX",},{id:"58",key:"ID_IVA_RETENTION_TO_PAY_MEX",},{id:"59",key:"ID_FLETES_IVA_RETENTION_TO_PAY_MEX",},{id:"99",key:"ID_LOCAL_RETENTION_TO_PAY_MEX",},{id:"60",key:"ID_IVA_TO_PAY_MEX",},{id:"95",key:"ID_IEPS_TO_PAY_MEX",},{id:"97",key:"ID_LOCAL_TAX_TO_PAY_MEX",},{id:"61",key:"ID_ITBIS_RETENTION_IN_FAVOR_DOM",},{id:"62",key:"ID_ISR_RETENTION_IN_FAVOR_DOM",},{id:"63",key:"ID_ITBIS_IN_FAVOR_DOM",},{id:"103",key:"ID_ISC_IN_FAVOR_DOM",},{id:"64",key:"ID_ITBIS_RETENTION_TO_PAY_DOM",},{id:"65",key:"ID_ISR_RETENTION_TO_PAY_DOM",},{id:"66",key:"ID_ITBIS_TO_PAY_DOM",},{id:"102",key:"ID_ISC_TO_PAY_DOM",},{id:"104",key:"ID_TIPS_TO_PAY_DOM",},{id:"93",key:"ID_FIXED_ASSET_CAT_2",},{id:"94",key:"ID_FIXED_ASSET_CAT_3",},{id:"67",key:"ID_FUENTE_RETENTION_IN_FAVOR_PAN",},{id:"68",key:"ID_ITBMS_IN_FAVOR_PAN",},{id:"69",key:"ID_FUENTE_RETENTION_TO_PAY_PAN",},{id:"70",key:"ID_ITBMS_TO_PAY_PAN",},{id:"71",key:"ID_DETRACCION_RETENTION_IN_FAVOR_PER",},{id:"72",key:"ID_IGV_IN_FAVOR_PER",},{id:"73",key:"ID_DETRACCION_RETENTION_TO_PAY_PER",},{id:"74",key:"ID_IGV_TO_PAY_PER",},{id:"75",key:"ID_IRPF_RETENTION_IN_FAVOR_ESP",},{id:"76",key:"ID_IVA_IN_FAVOR_ESP",},{id:"77",key:"ID_IRPF_RETENTION_TO_PAY_ESP",},{id:"78",key:"ID_IVA_TO_PAY_ESP",},{id:"79",key:"ID_IVA_IN_FAVOR_CHL",},{id:"87",key:"ID_FEE_RETENTION_IN_FAVOR_CHL",},{id:"88",key:"ID_IVA_RETENTION_IN_FAVOR_CHL",},{id:"80",key:"ID_IVA_TO_PAY_CHL",},{id:"89",key:"ID_FEE_RETENTION_TO_PAY_CHL",},{id:"90",key:"ID_IVA_RETENTION_TO_PAY_CHL",},{id:"81",key:"ID_IV_IN_FAVOR_CRI",},{id:"82",key:"ID_EXENTO_IN_FAVOR_CRI",},{id:"83",key:"ID_IV_TO_BE_PAID_CRI",},{id:"84",key:"ID_EXENTO_TO_BE_PAID_CRI",},{id:"115",key:"ID_PARENT_IVA_IN_FAVOR_CRI",},{id:"116",key:"ID_PARENT_IVA_TO_PAY_CRI",},{id:"117",key:"ID_IVA_IN_FAVOR_CRI",},{id:"118",key:"ID_IVA_TO_PAY_CRI",},{id:"119",key:"ID_IVA_USED_GODS_IN_FAVOR_CRI",},{id:"120",key:"ID_IVA_USED_GODS_TO_PAY_CRI",},{id:"110",key:"ID_IVA_IN_FAVOR_ARG",},{id:"112",key:"ID_EXENTO_IN_FAVOR_ARG",},{id:"111",key:"ID_IVA_TO_PAY_ARG",},{id:"113",key:"ID_EXENTO_TO_PAY_ARG",},{id:"125",key:"ID_RETENTION_IVA_SUFFERED_IN_FAVOR_ARG",},{id:"126",key:"ID_RETENTION_GROSS_INCOME_SUFFERED_IN_FAVOR_ARG",},{id:"127",key:"ID_RETENTION_SOCIAL_CHARGES_SUFFERED_IN_FAVOR_ARG",},{id:"128",key:"ID_RETENTION_PROFITS_SUFFERED_IN_FAVOR_ARG",},{id:"129",key:"ID_OTHER_RETENTIONS_SUFFERED_IN_FAVOR_ARG",},{id:"130",key:"ID_RETENTION_IVA_SUFFERED_TO_PAY_ARG",},{id:"131",key:"ID_RETENTION_GROSS_INCOME_SUFFERED_TO_PAY_ARG",},{id:"132",key:"ID_RETENTION_SOCIAL_CHARGES_SUFFERED_TO_PAY_ARG",},{id:"133",key:"ID_RETENTION_PROFITS_SUFFERED_TO_PAY_ARG",},{id:"134",key:"ID_OTHER_RETENTIONS_SUFFERED_TO_PAY_ARG",},{id:"23",key:"ID_OTHER_EARNINGS",},{id:"32",key:"ID_ADMIN_EXPENSES",},{id:"45",key:"ID_CREE_RETENTION_IN_FAVOR_COL",},{id:"52",key:"ID_CREE_RETENTION_TO_PAY_COL",},]});Ext.define("AL.store.CountriesPhone",{extend:"Ext.data.Store",autoLoad:true,fields:["id","name","alpha2","alpha3","callingCode"],data:[{id:4,name:"Afganistán",alpha2:"af",alpha3:"afg",callingCode:"93"},{id:8,name:"Albania",alpha2:"al",alpha3:"alb",callingCode:"355"},{id:276,name:"Alemania",alpha2:"de",alpha3:"deu",callingCode:"49"},{id:20,name:"Andorra",alpha2:"ad",alpha3:"and",callingCode:"376"},{id:24,name:"Angola",alpha2:"ao",alpha3:"ago",callingCode:"244"},{id:28,name:"Antigua y Barbuda",alpha2:"ag",alpha3:"atg",callingCode:"1"},{id:682,name:"Arabia Saudita",alpha2:"sa",alpha3:"sau",callingCode:"966"},{id:12,name:"Argelia",alpha2:"dz",alpha3:"dza",callingCode:"213"},{id:32,name:"Argentina",alpha2:"ar",alpha3:"arg",callingCode:"54"},{id:51,name:"Armenia",alpha2:"am",alpha3:"arm",callingCode:"374"},{id:36,name:"Australia",alpha2:"au",alpha3:"aus",callingCode:"61"},{id:40,name:"Austria",alpha2:"at",alpha3:"aut",callingCode:"43"},{id:31,name:"Azerbaiyán",alpha2:"az",alpha3:"aze",callingCode:"994"},{id:44,name:"Bahamas",alpha2:"bs",alpha3:"bhs",callingCode:"1"},{id:50,name:"Bangladés",alpha2:"bd",alpha3:"bgd",callingCode:"880"},{id:52,name:"Barbados",alpha2:"bb",alpha3:"brb",callingCode:"1"},{id:48,name:"Baréin",alpha2:"bh",alpha3:"bhr",callingCode:"973"},{id:56,name:"Bélgica",alpha2:"be",alpha3:"bel",callingCode:"32"},{id:84,name:"Belice",alpha2:"bz",alpha3:"blz",callingCode:"501"},{id:204,name:"Benín",alpha2:"bj",alpha3:"ben",callingCode:"229"},{id:112,name:"Bielorrusia",alpha2:"by",alpha3:"blr",callingCode:"375"},{id:68,name:"Bolivia",alpha2:"bo",alpha3:"bol",callingCode:"591"},{id:70,name:"Bosnia y Herzegovina",alpha2:"ba",alpha3:"bih",callingCode:"387"},{id:72,name:"Botsuana",alpha2:"bw",alpha3:"bwa",callingCode:"267"},{id:76,name:"Brasil",alpha2:"br",alpha3:"bra",callingCode:"55"},{id:96,name:"Brunéi",alpha2:"bn",alpha3:"brn",callingCode:"673"},{id:100,name:"Bulgaria",alpha2:"bg",alpha3:"bgr",callingCode:"359"},{id:854,name:"Burkina Faso",alpha2:"bf",alpha3:"bfa",callingCode:"226"},{id:108,name:"Burundi",alpha2:"bi",alpha3:"bdi",callingCode:"257"},{id:64,name:"Bután",alpha2:"bt",alpha3:"btn",callingCode:"975"},{id:132,name:"Cabo Verde",alpha2:"cv",alpha3:"cpv",callingCode:"238"},{id:116,name:"Camboya",alpha2:"kh",alpha3:"khm",callingCode:"855"},{id:120,name:"Camerún",alpha2:"cm",alpha3:"cmr",callingCode:"237"},{id:124,name:"Canadá",alpha2:"ca",alpha3:"can",callingCode:"1"},{id:634,name:"Catar",alpha2:"qa",alpha3:"qat",callingCode:"974"},{id:148,name:"Chad",alpha2:"td",alpha3:"tcd",callingCode:"235"},{id:152,name:"Chile",alpha2:"cl",alpha3:"chl",callingCode:"56"},{id:156,name:"China",alpha2:"cn",alpha3:"chn",callingCode:"86"},{id:196,name:"Chipre",alpha2:"cy",alpha3:"cyp",callingCode:"357"},{id:170,name:"Colombia",alpha2:"co",alpha3:"col",callingCode:"57"},{id:174,name:"Comoras",alpha2:"km",alpha3:"com",callingCode:"269"},{id:408,name:"Corea del Norte",alpha2:"kp",alpha3:"prk",callingCode:"850"},{id:410,name:"Corea del Sur",alpha2:"kr",alpha3:"kor",callingCode:"82"},{id:384,name:"Costa de Marfil",alpha2:"ci",alpha3:"civ",callingCode:"225"},{id:188,name:"Costa Rica",alpha2:"cr",alpha3:"cri",callingCode:"506"},{id:191,name:"Croacia",alpha2:"hr",alpha3:"hrv",callingCode:"385"},{id:192,name:"Cuba",alpha2:"cu",alpha3:"cub",callingCode:"53"},{id:208,name:"Dinamarca",alpha2:"dk",alpha3:"dnk",callingCode:"45"},{id:212,name:"Dominica",alpha2:"dm",alpha3:"dma",callingCode:"1"},{id:218,name:"Ecuador",alpha2:"ec",alpha3:"ecu",callingCode:"593"},{id:818,name:"Egipto",alpha2:"eg",alpha3:"egy",callingCode:"20"},{id:222,name:"El Salvador",alpha2:"sv",alpha3:"slv",callingCode:"503"},{id:784,name:"Emiratos Árabes Unidos",alpha2:"ae",alpha3:"are",callingCode:"971"},{id:232,name:"Eritrea",alpha2:"er",alpha3:"eri",callingCode:"291"},{id:703,name:"Eslovaquia",alpha2:"sk",alpha3:"svk",callingCode:"421"},{id:705,name:"Eslovenia",alpha2:"si",alpha3:"svn",callingCode:"386"},{id:724,name:"España",alpha2:"es",alpha3:"esp",callingCode:"34"},{id:840,name:"Estados Unidos",alpha2:"us",alpha3:"usa",callingCode:"1"},{id:233,name:"Estonia",alpha2:"ee",alpha3:"est",callingCode:"372"},{id:231,name:"Etiopía",alpha2:"et",alpha3:"eth",callingCode:"251"},{id:608,name:"Filipinas",alpha2:"ph",alpha3:"phl",callingCode:"63"},{id:246,name:"Finlandia",alpha2:"fi",alpha3:"fin",callingCode:"358"},{id:242,name:"Fiyi",alpha2:"fj",alpha3:"fji",callingCode:"679"},{id:250,name:"Francia",alpha2:"fr",alpha3:"fra",callingCode:"33"},{id:266,name:"Gabón",alpha2:"ga",alpha3:"gab",callingCode:"241"},{id:270,name:"Gambia",alpha2:"gm",alpha3:"gmb",callingCode:"220"},{id:268,name:"Georgia",alpha2:"ge",alpha3:"geo",callingCode:"995"},{id:288,name:"Ghana",alpha2:"gh",alpha3:"gha",callingCode:"233"},{id:308,name:"Granada",alpha2:"gd",alpha3:"grd",callingCode:"1"},{id:300,name:"Grecia",alpha2:"gr",alpha3:"grc",callingCode:"30"},{id:320,name:"Guatemala",alpha2:"gt",alpha3:"gtm",callingCode:"502"},{id:324,name:"Guinea",alpha2:"gn",alpha3:"gin",callingCode:"224"},{id:624,name:"Guinea-Bisáu",alpha2:"gw",alpha3:"gnb",callingCode:"245"},{id:226,name:"Guinea Ecuatorial",alpha2:"gq",alpha3:"gnq",callingCode:"240"},{id:328,name:"Guyana",alpha2:"gy",alpha3:"guy",callingCode:"592"},{id:332,name:"Haití",alpha2:"ht",alpha3:"hti",callingCode:"509"},{id:340,name:"Honduras",alpha2:"hn",alpha3:"hnd",callingCode:"504"},{id:348,name:"Hungría",alpha2:"hu",alpha3:"hun",callingCode:"36"},{id:356,name:"India",alpha2:"in",alpha3:"ind",callingCode:"91"},{id:360,name:"Indonesia",alpha2:"id",alpha3:"idn",callingCode:"62"},{id:368,name:"Irak",alpha2:"iq",alpha3:"irq",callingCode:"964"},{id:364,name:"Irán",alpha2:"ir",alpha3:"irn",callingCode:"98"},{id:372,name:"Irlanda",alpha2:"ie",alpha3:"irl",callingCode:"353"},{id:352,name:"Islandia",alpha2:"is",alpha3:"isl",callingCode:"354"},{id:584,name:"Islas Marshall",alpha2:"mh",alpha3:"mhl",callingCode:"692"},{id:90,name:"Islas Salomón",alpha2:"sb",alpha3:"slb",callingCode:"677"},{id:376,name:"Israel",alpha2:"il",alpha3:"isr",callingCode:"972"},{id:380,name:"Italia",alpha2:"it",alpha3:"ita",callingCode:"39"},{id:388,name:"Jamaica",alpha2:"jm",alpha3:"jam",callingCode:"1"},{id:392,name:"Japón",alpha2:"jp",alpha3:"jpn",callingCode:"81"},{id:400,name:"Jordania",alpha2:"jo",alpha3:"jor",callingCode:"962"},{id:398,name:"Kazajistán",alpha2:"kz",alpha3:"kaz",callingCode:"7"},{id:404,name:"Kenia",alpha2:"ke",alpha3:"ken",callingCode:"254"},{id:417,name:"Kirguistán",alpha2:"kg",alpha3:"kgz",callingCode:"996"},{id:296,name:"Kiribati",alpha2:"ki",alpha3:"kir",callingCode:"686"},{id:414,name:"Kuwait",alpha2:"kw",alpha3:"kwt",callingCode:"965"},{id:418,name:"Laos",alpha2:"la",alpha3:"lao",callingCode:"856"},{id:426,name:"Lesoto",alpha2:"ls",alpha3:"lso",callingCode:"266"},{id:428,name:"Letonia",alpha2:"lv",alpha3:"lva",callingCode:"371"},{id:422,name:"Líbano",alpha2:"lb",alpha3:"lbn",callingCode:"961"},{id:430,name:"Liberia",alpha2:"lr",alpha3:"lbr",callingCode:"231"},{id:434,name:"Libia",alpha2:"ly",alpha3:"lby",callingCode:"218"},{id:438,name:"Liechtenstein",alpha2:"li",alpha3:"lie",callingCode:"423"},{id:440,name:"Lituania",alpha2:"lt",alpha3:"ltu",callingCode:"370"},{id:442,name:"Luxemburgo",alpha2:"lu",alpha3:"lux",callingCode:"352"},{id:807,name:"Macedonia del Norte",alpha2:"mk",alpha3:"mkd",callingCode:"389"},{id:450,name:"Madagascar",alpha2:"mg",alpha3:"mdg",callingCode:"261"},{id:458,name:"Malasia",alpha2:"my",alpha3:"mys",callingCode:"60"},{id:454,name:"Malaui",alpha2:"mw",alpha3:"mwi",callingCode:"265"},{id:462,name:"Maldivas",alpha2:"mv",alpha3:"mdv",callingCode:"960"},{id:466,name:"Malí",alpha2:"ml",alpha3:"mli",callingCode:"223"},{id:470,name:"Malta",alpha2:"mt",alpha3:"mlt",callingCode:"356"},{id:504,name:"Marruecos",alpha2:"ma",alpha3:"mar",callingCode:"212"},{id:480,name:"Mauricio",alpha2:"mu",alpha3:"mus",callingCode:"230"},{id:478,name:"Mauritania",alpha2:"mr",alpha3:"mrt",callingCode:"222"},{id:484,name:"México",alpha2:"mx",alpha3:"mex",callingCode:"52"},{id:583,name:"Micronesia",alpha2:"fm",alpha3:"fsm",callingCode:"691"},{id:498,name:"Moldavia",alpha2:"md",alpha3:"mda",callingCode:"373"},{id:492,name:"Mónaco",alpha2:"mc",alpha3:"mco",callingCode:"377"},{id:496,name:"Mongolia",alpha2:"mn",alpha3:"mng",callingCode:"976"},{id:499,name:"Montenegro",alpha2:"me",alpha3:"mne",callingCode:"382"},{id:508,name:"Mozambique",alpha2:"mz",alpha3:"moz",callingCode:"258"},{id:104,name:"Birmania",alpha2:"mm",alpha3:"mmr",callingCode:"95"},{id:516,name:"Namibia",alpha2:"na",alpha3:"nam",callingCode:"264"},{id:520,name:"Nauru",alpha2:"nr",alpha3:"nru",callingCode:"674"},{id:524,name:"Nepal",alpha2:"np",alpha3:"npl",callingCode:"977"},{id:558,name:"Nicaragua",alpha2:"ni",alpha3:"nic",callingCode:"505"},{id:562,name:"Níger",alpha2:"ne",alpha3:"ner",callingCode:"227"},{id:566,name:"Nigeria",alpha2:"ng",alpha3:"nga",callingCode:"234"},{id:578,name:"Noruega",alpha2:"no",alpha3:"nor",callingCode:"47"},{id:554,name:"Nueva Zelanda",alpha2:"nz",alpha3:"nzl",callingCode:"64"},{id:512,name:"Omán",alpha2:"om",alpha3:"omn",callingCode:"968"},{id:528,name:"Países Bajos",alpha2:"nl",alpha3:"nld",callingCode:"31"},{id:586,name:"Pakistán",alpha2:"pk",alpha3:"pak",callingCode:"92"},{id:585,name:"Palaos",alpha2:"pw",alpha3:"plw",callingCode:"680"},{id:591,name:"Panamá",alpha2:"pa",alpha3:"pan",callingCode:"507"},{id:598,name:"Papúa Nueva Guinea",alpha2:"pg",alpha3:"png",callingCode:"675"},{id:600,name:"Paraguay",alpha2:"py",alpha3:"pry",callingCode:"595"},{id:604,name:"Perú",alpha2:"pe",alpha3:"per",callingCode:"51"},{id:616,name:"Polonia",alpha2:"pl",alpha3:"pol",callingCode:"48"},{id:620,name:"Portugal",alpha2:"pt",alpha3:"prt",callingCode:"351"},{id:826,name:"Reino Unido",alpha2:"gb",alpha3:"gbr",callingCode:"44"},{id:140,name:"República Centroafricana",alpha2:"cf",alpha3:"caf",callingCode:"236"},{id:203,name:"República Checa",alpha2:"cz",alpha3:"cze",callingCode:"420"},{id:178,name:"República del Congo",alpha2:"cg",alpha3:"cog",callingCode:"242"},{id:180,name:"República Democrática del Congo",alpha2:"cd",alpha3:"cod",callingCode:"243"},{id:214,name:"República Dominicana",alpha2:"do",alpha3:"dom",callingCode:"1"},{id:646,name:"Ruanda",alpha2:"rw",alpha3:"rwa",callingCode:"250"},{id:642,name:"Rumania",alpha2:"ro",alpha3:"rou",callingCode:"40"},{id:643,name:"Rusia",alpha2:"ru",alpha3:"rus",callingCode:"7"},{id:882,name:"Samoa",alpha2:"ws",alpha3:"wsm",callingCode:"685"},{id:659,name:"San Cristóbal y Nieves",alpha2:"kn",alpha3:"kna",callingCode:"1"},{id:674,name:"San Marino",alpha2:"sm",alpha3:"smr",callingCode:"378"},{id:670,name:"San Vicente y las Granadinas",alpha2:"vc",alpha3:"vct",callingCode:"1"},{id:662,name:"Santa Lucía",alpha2:"lc",alpha3:"lca",callingCode:"1"},{id:678,name:"Santo Tomé y Príncipe",alpha2:"st",alpha3:"stp",callingCode:"239"},{id:686,name:"Senegal",alpha2:"sn",alpha3:"sen",callingCode:"221"},{id:688,name:"Serbia",alpha2:"rs",alpha3:"srb",callingCode:"381"},{id:690,name:"Seychelles",alpha2:"sc",alpha3:"syc",callingCode:"248"},{id:694,name:"Sierra Leona",alpha2:"sl",alpha3:"sle",callingCode:"232"},{id:702,name:"Singapur",alpha2:"sg",alpha3:"sgp",callingCode:"65"},{id:760,name:"Siria",alpha2:"sy",alpha3:"syr",callingCode:"963"},{id:706,name:"Somalia",alpha2:"so",alpha3:"som",callingCode:"252"},{id:144,name:"Sri Lanka",alpha2:"lk",alpha3:"lka",callingCode:"94"},{id:748,name:"Suazilandia",alpha2:"sz",alpha3:"swz",callingCode:"268"},{id:710,name:"Sudáfrica",alpha2:"za",alpha3:"zaf",callingCode:"27"},{id:729,name:"Sudán",alpha2:"sd",alpha3:"sdn",callingCode:"249"},{id:728,name:"Sudán del Sur",alpha2:"ss",alpha3:"ssd",callingCode:"211"},{id:752,name:"Suecia",alpha2:"se",alpha3:"swe",callingCode:"46"},{id:756,name:"Suiza",alpha2:"ch",alpha3:"che",callingCode:"41"},{id:740,name:"Surinam",alpha2:"sr",alpha3:"sur",callingCode:"597"},{id:764,name:"Tailandia",alpha2:"th",alpha3:"tha",callingCode:"66"},{id:834,name:"Tanzania",alpha2:"tz",alpha3:"tza",callingCode:"255"},{id:762,name:"Tayikistán",alpha2:"tj",alpha3:"tjk",callingCode:"992"},{id:626,name:"Timor Oriental",alpha2:"tl",alpha3:"tls",callingCode:"670"},{id:768,name:"Togo",alpha2:"tg",alpha3:"tgo",callingCode:"228"},{id:776,name:"Tonga",alpha2:"to",alpha3:"ton",callingCode:"676"},{id:780,name:"Trinidad y Tobago",alpha2:"tt",alpha3:"tto",callingCode:"1"},{id:788,name:"Túnez",alpha2:"tn",alpha3:"tun",callingCode:"216"},{id:795,name:"Turkmenistán",alpha2:"tm",alpha3:"tkm",callingCode:"993"},{id:792,name:"Turquía",alpha2:"tr",alpha3:"tur",callingCode:"90"},{id:798,name:"Tuvalu",alpha2:"tv",alpha3:"tuv",callingCode:"688"},{id:804,name:"Ucrania",alpha2:"ua",alpha3:"ukr",callingCode:"380"},{id:800,name:"Uganda",alpha2:"ug",alpha3:"uga",callingCode:"256"},{id:858,name:"Uruguay",alpha2:"uy",alpha3:"ury",callingCode:"598"},{id:860,name:"Uzbekistán",alpha2:"uz",alpha3:"uzb",callingCode:"998"},{id:548,name:"Vanuatu",alpha2:"vu",alpha3:"vut",callingCode:"678"},{id:862,name:"Venezuela",alpha2:"ve",alpha3:"ven",callingCode:"58"},{id:704,name:"Vietnam",alpha2:"vn",alpha3:"vnm",callingCode:"84"},{id:887,name:"Yemen",alpha2:"ye",alpha3:"yem",callingCode:"967"},{id:262,name:"Yibuti",alpha2:"dj",alpha3:"dji",callingCode:"253"},{id:894,name:"Zambia",alpha2:"zm",alpha3:"zmb",callingCode:"260"},{id:716,name:"Zimbabue",alpha2:"zw",alpha3:"zwe",callingCode:"263"}]});Ext.define("AL.model.Account",{extend:"Ext.data.Model",fields:["idLocal","name","number","initialBalance","initialBalanceDate","balance","description","type","typeName","deletable","status","exchangeRate","currencySymbol","currencyCode","balanceSecondaryCurrency","currentExchangeRate"]});Ext.define("AL.model.Transaction",{extend:"Ext.data.Model",fields:["idLocal",{name:"date",type:"date",dateFormat:"c"},{name:"name",type:"string",specialName:"clientName"},{name:"amount",type:"float",filterEmptyText:translate("outputsInputs",true)},{name:"number",type:"int"},"accountName","accountType","accountTypeName","observations","anotation","type",{name:"conciliated",type:"auto",isEnum:true,values:{1:translate("reconciledF",true),0:translate("notReconciled",true)},filterEmptyText:translate("reconciledM",true)},"draftConciliated","editable","deletable","associations","hasCategories","paymentMethod","decimalPrecision","openable","voidable",{name:"status",isEnum:true,values:{open:"("+translate("empty",true)+")","void":translate("canceledMale",true)}},"total","subTotal","transactionNumber","currencyCode","exchangeRate","currencySymbol","amountTotal","movementType","uuid","isObligedAddVoidCause","proportionalPayment",]});Ext.define("AL.model.Conciliation",{extend:"Ext.data.Model",fields:["idLocal",{name:"realBalance",type:"float"},{name:"accountExpenses",type:"float"},{name:"accountInterests",type:"float"},{name:"accountTaxes",type:"float"},{name:"date",type:"date",dateFormat:"c"},{name:"state",type:"string",isEnum:true,values:{draft:"Borrador",open:"Abierta"}},"deletable"]});Ext.define("AL.model.CompanyCurrency",{extend:"Ext.data.Model",fields:["id","code","name","exchangeRate","status","deletable","canBeInactive","symbol","main","autoUpdate",{name:"splitCodeName",convert:function(c,a){var b=a.get("code")+" - "+a.get("name");if(b&&b.length>48){b=b.substr(0,48)+" ..."}return b}}]});Ext.define("AL.view.account.FormAdd",{extend:"Ext.form.Panel",alias:"widget.account_FormAdd",title:translate("add",true)+" "+translate("account"),bodyPadding:30,width:450,layout:"anchor",defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",width:300,labelPad:15,msgTarget:"side"},listeners:{afterrender:function(){var a=this.down("combo[name=type]");a.on("change",function(f,e,c,d){if(f.getSelectedRecord()){var b=this.down("textfield[name=initialBalance]");if(e==="credit-card"){b.setFieldLabel(translate("initialDebtBalance",true))}else{b.setFieldLabel(translate("initialBalance",true))}}},this)}},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{xtype:"combo",name:"type",fieldLabel:translate("accountType",true),allowBlank:false,forceSelection:true,id:"accountTypeCombo",store:Ext.create("Ext.data.Store",{fields:["type","name"],data:[{type:"bank",name:translate("bank",true)},{type:"credit-card",name:translate("creditCard",true)},{type:"cash",name:translate("cash",true)}]}),displayField:"name",valueField:"type"},{fieldLabel:translate("accountName",true),name:"name",allowBlank:false,id:"accountNameTextfield"},{fieldLabel:translate("accountNumber",true),name:"number",allowBlank:true,id:"accountNumberTextfield"},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyOfYourBank",true),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">Nueva moneda</a></div>',cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicatesTheExchangeRateOfTheSelectedCurrencyToYourPrimaryCurrencyForYourInitialBalance",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{fieldLabel:translate("initialBalance",true),name:"initialBalance",allowBlank:false,regex:/^-?([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),id:"accountInitialBalanceTextfield"},{xtype:"datefield",fieldLabel:translate("date",true),name:"initialBalanceDate",allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",id:"accountInitialBalanceDateDatefield"},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",allowBlank:true,id:"accountDescriptionTextarea"}],buttons:[{xtype:"buttons_Cancel",cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),action:"save",cls:"sm-button-primary",height:38,width:157}]});Ext.define("AL.view.account.GridAll",{extend:"Ext.grid.Panel",alias:"widget.account_GridAllAccounts",frame:true,cls:"grid-accounts grid-with-icons",minHeight:100,width:1024,columnLines:true,store:"Accounts",viewConfig:{stripeRows:true,emptyText:'<style>.grid-accounts .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("bank")})+'</div><div class="button-wrapper"><a href="/account/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>Nuevo banco</a></div></div></div>'},initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",flex:1,renderer:this.renderAccount},{header:translate("accountNumber",true),dataIndex:"number",flex:1},{header:translate("description",true),dataIndex:"description",flex:1},{header:translate("balance",true),dataIndex:"balance",flex:1,renderer:this.renderMoney,align:"right"},{header:translate("actions",true),align:"center",type:"actions",renderer:this.setActions,width:150}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/account/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';if(c.get("status")==="active"){b+='<a href="/account/edit/id/'+a+'" title="'+translate("edit",true)+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>';b+='<a href="/conciliation/index/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/clock_add.png" alt="'+translate("reconcile",true)+'" /></a>'}else{if(c.get("status")==="inactive"){b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" title="'+translate("edit",true)+'"/>';b+='<img src="https://cdn1.getsoft.app/images/icons/clock_add.png" alt="'+translate("reconcile",true)+'" class="disabled"/>'}}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteAccount" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderAccount:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/account/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(f,j,b,d,h,g,e){var c=b.get("currencySymbol")?b.get("currencySymbol"):null;var a=b.get("currencyCode")?b.get("balanceSecondaryCurrency"):b.get("balance");return Ext.util.Format.usMoney(a,2,c)}});Ext.define("AL.view.account.GridAccount",{extend:"Ext.grid.Panel",alias:"widget.account_GridAccount",requres:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:"",overflowY:"auto",scroll:"vertical",layout:"fit",holds:"transactions",width:1024,minHeight:390,store:"Transactions",idAccount:null,cls:"grid-account-transactions",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotRegisteredATransactionWithThisBankYet",true)+"</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("date",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:translate("provider",true),dataIndex:"name",sortable:false,flex:1},{header:translate("reconciledM",true),renderer:this.renderConciliated,width:65,align:"center",sortable:false},{header:translate("category",true),dataIndex:"associations",sortable:false,width:210},{header:translate("status",true),dataIndex:"status",width:90,align:"center",sortable:false,renderer:this.renderStatus},{header:translate("outgoingAmount",true),dataIndex:"amount",align:"right",width:120,renderer:this.renderPayment},{header:translate("incomingAmount",true),dataIndex:"amount",align:"right",width:120,sortable:false,renderer:this.renderDeposit},{header:translate("actions",true),align:"center",type:"transactionActions",renderer:this.setActions,width:150,filter:false,sortable:false}];this.callParent(arguments)},renderConciliated:function(f,g,b,h,d,c,a){var e=(b.get("conciliated"))?translate("yes",true):translate("no",true);return e},renderDeposit:function(g,l,c,e,j,h,f){var b="";var k="";if(c.get("type")==="in"){var d=c.get("currencySymbol")?c.get("currencySymbol"):null;b=Ext.util.Format.usMoney(c.get("amount"),2,d)}if(c.get("movementType")=="currency-adjustment"&&b){var a=this;k='<span class="totalCurrencyTip">'+a.companyCurrency+"</span> "}return k+b},renderPayment:function(g,l,c,e,j,h,f){var b="";var k="";if(c.get("type")==="out"){var d=c.get("currencySymbol")?c.get("currencySymbol"):null;b=Ext.util.Format.usMoney(c.get("amount"),2,d)}if(c.get("movementType")=="currency-adjustment"&&b){var a=this;k='<span class="totalCurrencyTip">'+a.companyCurrency+"</span> "}return k+b},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/transaction/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/transaction/view/id/'+b+'">'+f+"</a>"}return a},setActions:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var a=d.get("movementType")=="transaction"?"/transaction":"/currency-adjustment";var c='<div class="action-icons">';c+='<a href="'+a+"/view/id/"+b+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'"/></a>';if(d.get("movementType")=="transaction"){if(d.get("editable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="editTransaction" />'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(d.get("deletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteTransaction" />'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}c+='<a href="/transaction/print/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="printTransaction" /></a>';if(d.get("voidable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="voidTransaction"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="disabled voidTransaction"/>'}if(d.get("openable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("open")+'" class="convertTransactionToOpen"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("open")+'" class="disabled"/>'}}else{if(d.get("editable")){c+='<a href="/currency-adjustment/edit/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="editCurrencyAdjustment" /></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(d.get("deletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteCurrencyAdjustment" />'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}}c+="</div>";return c},renderStatus:function(e,h,b,c,g,f,d){var j="invoiceOpen";var a="";if(e=="void"){j="invoiceVoid";a=translate("canceledMale",true)}return'<span class="'+j+'">'+a+"</span>"}});Ext.define("AL.view.account.FormAccountTransfer",{extend:"Ext.form.Panel",alias:"widget.account_FormAccountTransfer",bodyPadding:"20 35 10 35",frame:false,border:false,cls:"window-account-transfer",style:{background:"#ffffff"},layout:"anchor",defaults:{labelAlign:"right",labelPad:15,labelWidth:160,width:380},defaultType:"textfield",items:[{xtype:"groupingcombobox",fieldLabel:translate("originAccount",true),name:"idOrigin",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts"},{xtype:"groupingcombobox",fieldLabel:translate("destinationAccount",true),name:"idDestination",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts"},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,width:380},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"textfield",fieldLabel:translate("amount",true),name:"amount",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("currencyEditRateErrorMsg",true)},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:true,value:new Date(),format:"d/m/Y"},{xtype:"textarea",fieldLabel:translate("observations",true),name:"observations",allowBlank:true}],buttons:[{text:"Guardar",formBind:true,disabled:true,action:"save",margin:"10 10 0 0",height:40,cls:"button main-button",}]});Ext.define("AL.view.account.GridConciliationTransactions",{extend:"Ext.grid.Panel",alias:"widget.account_GridConciliationTransactions",layout:"fit",holds:"transactions",minHeight:400,store:"Transactions",idAccount:null,cls:"grid-account-transactions",viewConfig:{stripeRows:true,emptyText:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">Esta conciliación no tiene transacciones asociadas</div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",width:90,renderer:this.renderDate},{header:"Beneficiario",dataIndex:"name",flex:1,sortable:false},{header:"Estado",renderer:this.renderConciliated,width:100,sortable:false},{header:"Detalle",dataIndex:"associations",width:250,sortable:false},{header:"Salidas",dataIndex:"amount",align:"right",width:125,renderer:this.renderPayment},{header:"Entradas",dataIndex:"amount",align:"right",width:125,renderer:this.renderDeposit},{header:"Acciones",align:"center",type:"transactionInActions",renderer:this.setActions,sortable:false,width:60}];this.callParent(arguments)},renderDate:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b=AL.date(f);return this.renderLink(Ext.Date.format(b,"d/m/Y"),j,c,d,h,g,e)},renderConciliated:function(f,g,b,h,d,c,a){var e=(b.get("conciliated"))?"Conciliada":"No conciliada";return e},renderDeposit:function(f,j,b,d,h,g,e){var a="";var c=b.get("currencySymbol")?b.get("currencySymbol"):null;if(b.get("type")==="in"){a=Ext.util.Format.usMoney(b.get("amount"),2,c)}return a},renderPayment:function(f,j,b,d,h,g,e){var a="";var c=b.get("currencySymbol")?b.get("currencySymbol"):null;if(b.get("type")==="out"){a=Ext.util.Format.usMoney(b.get("amount"),2,c)}return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/transaction/view/id/'+b+'">'+f+"</a>"}return a},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/transaction/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle"/></a>';if(c.get("editable")){b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar" title="Editar" class="editTransaction"/>'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" title="Eliminar" class="deleteTransaction"/>'}b+="</div>";return b}});Ext.define("AL.view.account.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.account_MoreActionsButton",text:translate("moreActions",true),cls:"button2",style:"margin: 0 0.5em; padding: 0 8px 0 1em;",height:25,status:null,idLocal:null,accountName:null,currency:null,handler:function(){this.showMenu()},initComponent:function(){var a=[];if(this.status){if(this.status==="active"){a.push({text:translate("edit",true),href:"/account/edit/id/"+this.idLocal});a.push({text:translate("deactivate",true),href:"#",action:"toggleActivateAccount",status:"active",idAccount:this.idLocal,accountName:this.accountName});a.push({text:[translate("see",true),translate("reconciliations")].join(" "),href:"/account/view-conciliations/id/"+this.idLocal})}}if(this.currency){a.push({text:translate("makeAdjustmentForDifferenceInRate",true),href:"/currency-adjustment/add/currency/"+this.currency})}if(!this.hasCategory){a.push({text:translate("createAssociatedCategory",true,{category:false}),href:"/account/setup-category/id/"+this.idLocal})}this.menu.items=a;this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.store.Accounts",{extend:"Ext.data.Store",model:"AL.model.Account",autoLoad:false,proxy:{type:"ajax",url:"/account/retrieve-all/format/json",reader:{type:"json",root:"results"},sorters:[{property:"category",direction:"ASC"},{property:"name",direction:"ASC"}]},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt="+translate("reconcile",true)+"], img[alt="+translate("seeDetail",true)+"], img[alt="+translate("accountTransfer",true)+"]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.Transactions",{extend:"Ext.data.Store",model:"AL.model.Transaction",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",timeout:180000,url:"",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt="+translate("print",true)+"], img[alt="+translate("seeDetail",true)+"], img[alt="+translate("addPayment",true)+"], img[alt="+translate("convertTo",true)+" "+translate("openF")+"], img[alt="+translate("edit",true)+"], img[alt="+translate("cancel",true)+"], img[alt="+translate("remove",true)+"]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.Conciliations",{extend:"Ext.data.Store",model:"AL.model.Conciliation",remoteSort:true,autoLoad:false,proxy:{type:"ajax",url:"/account/retrieve-conciliations/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CompanyCurrenciesCombo",{extend:"Ext.data.Store",model:"AL.model.CompanyCurrency",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/currency/retrieve-company-currencies/format/json/onlyActive/yes/deletable/no",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Eliminar], img[alt=Inactivar], img[alt=Editar tasa]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.model.Advance",{extend:"Ext.data.Model",fields:["id","idLocal","number","date","total","amountAvailable"]});Ext.define("AL.view.advance.Form",{extend:"Ext.form.Panel",alias:"widget.advance_Form",border:false,height:40,style:"border-bottom: .2px solid #dcdcdc; margin-top: 15px;",transaction:null,layout:{type:"table",columns:5,tableAttrs:{style:{}}},defaults:{width:140,style:"text-align: center"},items:[{xtype:"displayfield",name:"number"},{xtype:"datefield",width:115,name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",skipValidation:true,validateValue:function(b){if(this.skipValidation){return true}var a=this,d=a.getErrors(b),c=Ext.isEmpty(d);if(!a.preventMark){if(c){a.clearInvalid()}else{a.markInvalid(d)}}return c}},{xtype:"displayfield",name:"amount"},{xtype:"displayfield",name:"amountAvailable"},{xtype:"textfield",style:"margin-left: 20px;",width:120,name:"amountToApply",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),blankText:translate("itIsNecessaryToSetTheAmountToApply",true),tooltip:translate("indicateTheAmountYouWantToAssociateWithTheInvoice",true),validateOnChange:false},{xtype:"hidden",name:"id"},]});Ext.define("AL.view.advance.EditForm",{extend:"Ext.form.Panel",alias:"widget.advance_EditForm",border:false,height:40,style:"border-bottom: .2px solid #dcdcdc; margin-top: 15px;",advanceApplied:null,layout:{type:"table",columns:8,tableAttrs:{style:{}}},defaults:{width:145,style:"text-align: center"},items:[{xtype:"displayfield",name:"number"},{xtype:"displayfield",name:"date"},{xtype:"displayfield",name:"total"},{xtype:"displayfield",name:"missingAmount"},{xtype:"displayfield",name:"amount"},{xtype:"displayfield",name:"amountAvailable"},{xtype:"textfield",style:"margin-left: 20px;",width:100,name:"amountToApply",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos positivos mayores a 0, con el punto (.) como separador decimal",blankText:"Es necesario fijar el monto a aplicar",allowBlank:false,enableKeyEvents:true},{xtype:"button",action:"deleteAdvanceApplied",height:16,width:16,style:"cursor:pointer; position:absolute; top:3px; right:0;",baseCls:"none"}]});Ext.define("AL.view.advance.Panel",{extend:"Ext.panel.Panel",alias:"widget.advance_Panel",style:"margin-bottom:10px",anchor:100,defaults:{msgTarget:"side"},items:[{xtype:"panel",border:false,height:30,layout:{type:"table",columns:5,tableAttrs:{style:"background: #eee;"}},defaults:{width:265},items:[{xtype:"box",style:"padding: 5px 5px 5px 10px;",html:translate("advanceNumber",true),width:210},{xtype:"box",style:"padding: 5px;",html:translate("applicationDate",true),width:110},{xtype:"box",style:"padding: 5px;",html:translate("amount",true)},{xtype:"box",style:"padding: 5px;",html:translate("amountToApply",true)},{xtype:"box",style:"padding: 5px;",html:translate("amountApplied",true),width:200}]},{xtype:"container",style:"padding: 5px 5px 5px 10px;",id:"advancesContainer",items:[]},{xtype:"box",style:"padding: 5px 10px;",html:'<a href="#" id="addAdvance">'+translate("add",true)+" "+translate("advance")+"</a>"}]});Ext.define("AL.view.advance.FormPanel",{extend:"Ext.form.Panel",alias:"widget.advance_FormPanel",border:false,height:50,style:"border-bottom: .2px solid #dcdcdc; margin-top: 15px;",transaction:null,layout:{type:"table",columns:6,tableAttrs:{style:{}}},defaults:{width:265},items:[{xtype:"combo",name:"number",triggerAction:"all",allowBlank:false,emptyText:translate("selectSimple",true)+" "+translate("advance"),displayField:"number",valueField:"id",queryMode:"local",width:180,style:"margin-right: 20px",matchFieldWidth:false,listConfig:{width:180,height:200}},{xtype:"datefield",width:95,name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust")+" {1}",skipValidation:true,style:"margin-right: 20px;",hidden:true,validateValue:function(b){if(this.skipValidation){return true}var a=this,d=a.getErrors(b),c=Ext.isEmpty(d);if(!a.preventMark){if(c){a.clearInvalid()}else{a.markInvalid(d)}}return c}},{xtype:"displayfield",name:"amount"},{xtype:"displayfield",name:"amountAvailable"},{xtype:"textfield",width:130,name:"amountToApply",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),disabled:true,validateOnChange:false},{xtype:"button",name:"destroy",style:"margin-top: -5px; margin-left: 10px; cursor:pointer;",height:16,width:16,baseCls:"none"}]});Ext.define("AL.store.Advances",{extend:"Ext.data.Store",model:"AL.model.Advance",autoLoad:false,proxy:{type:"ajax",url:"/advance-applied/retrieve-open-advances/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.Bill",{extend:"Ext.data.Model",fields:["idLocal","idClient","name","identification","phone1","phone2","fax","mobile","billNumber",{name:"date",type:"date",dateFormat:"c"},{name:"dueDate",type:"date",dateFormat:"c"},"observations","total","totalPayed","missingAmount","termsConditions","editable","deletable","isOverdue","state","decimalPrecision","subTotal","prefix","currencySymbol","legalStatus",{name:"canPrintOrDownload",type:"bool"},{name:"hasResolution",type:"bool"},"idCostCenter"]});Ext.define("AL.model.Client",{extend:"Ext.data.Model",fields:["idLocal","name","identification","identificationType","identificationTypeAbbreviature","phone1","phone2","fax","mobile","address","city","observations","idTerm","isClient","isProvider","deletable","termDays","termName","idPriceList","idSeller","cfdiUse","balanceAdvancesPayments","balanceCreditNotes","balanceAdvances","balanceDebitNotes","metadata","co_dv",{name:"nameIdentification",type:"string",convert:function(b,a){if(!a.get("identification")){return a.get("name")}if(!a.get("identificationTypeAbbreviature")){return a.get("name")+" ("+a.get("identification")+")"}return a.get("name")+" ("+a.get("identificationTypeAbbreviature")+". "+a.get("identification")+")"}},]});Ext.define("AL.model.Category",{extend:"Ext.data.Model",fields:[{name:"idLocal"},{name:"idCategoryRule"},{name:"name",type:"string"},{name:"text",type:"string"},{name:"description",type:"string"},{name:"total"},{name:"debit"},{name:"credit"},{name:"isEditable"},{name:"isDeletable"},{name:"category606"},{name:"purchaseType606",type:"string"},{name:"incomeType607"},{name:"code",type:"string"},{name:"codeText",type:"string",convert:function(b,a){return a.convertCodeText(a)}},{name:"blocked",type:"string"},{name:"canChangeBlocked",type:"bool"},{name:"allowedToAdd"},{name:"allowedToEdit"},{name:"allowedToDelete"},{name:"ruleName"},{name:"conceptCode"},{name:"conceptType"},{name:"report1001concept5002RetentionIdCategory"},{name:"metadata"},{name:"keyCountry"},{name:"satGroupingCodeText",type:"string",convert:function(b,a){return a.convertSatGrouping(a)}},{name:"amount"},{name:"type"}],convertCodeText:function(b){var a=b.data;if(!a.code){return a.text}return a.code+" - "+a.text},convertSatGrouping:function(b){var a=b.data;if(a.keyCountry=="mexico"){return(a.metadata.satGroupingCode&&a.metadata.satGroupingText)?(a.metadata.satGroupingCode+" - "+a.metadata.satGroupingText):""}return""},updateConvertFields:function(){this.set("codeText",this.convertCodeText(this));this.set("satGroupingCodeText",this.convertSatGrouping(this))}});Ext.define("AL.model.Tax",{extend:"Ext.data.Model",fields:["deletable","description","editable","idLocal","idTaxReference","keyTaxReference","name","status","tax","taxReference","deductible",{name:"disabled",type:"boolean",defaultValue:false},{name:"idCategoryFavorable",type:"integer"},{name:"idCategoryToBePaid",type:"integer"}]});Ext.define("AL.model.CategoryCombo",{extend:"Ext.data.Model",fields:["idLocal","text","parentName","description","isInventariable","itemLastCost","quantityRemissioned","availableQuantity","maxQuantity","maxQuantityReal","quantity","type","indentClass","recordType","itemLastCost",{name:"blocked",type:"string"},"idCategoryRule"]});Ext.define("AL.model.Retention",{extend:"Ext.data.Model",fields:["idLocal","idRetentionReference","retentionReference","keyRetentionReference","name","percentage","description","status","retentionType606","editable","deletable","metadata","calculatedBy",],isEditable:function(a){return((a=="republicaDominicana"&&this.get("idRetentionReference")=="9")||(["colombia","argentina"].indexOf(a)!=-1)||this.get("editable"))}});Ext.define("AL.model.StampDocumentReceived",{extend:"Ext.data.Model",fields:["idLocal","identification","name","number","address","total","currencySymbol",{name:"date",type:"date",dateFormat:"c"},{name:"datetime",type:"date",dateFormat:"c"},"idBill","billIdLocal","origin","idStampReceptionMail",{name:"response",type:"string",isEnum:true,values:{ACCEPT:"Aceptado",PARTIALL_ACCEPT:"Aceptado parcialmente",REJECT:"Rechazado"}},"accusedId","uuid","responseNumber","message",{name:"legalStatus",type:"string",isEnum:true,values:{ACCEPTED:"Aceptada",ACCEPTED_WITH_OBSERVACTIONS:"Aceptada con observaciones",REJECTED:"Rechazada",PENDING:"En proceso"}},{name:"resourceType",type:"string",isEnum:true,values:{bill:"Factura",debitNote:"Nota crédito"}}]});Ext.define("AL.model.PurchaseOrder",{extend:"Ext.data.Model",fields:["idClient","idCompany","id","observations","anotation","termsConditions","name","identification","phone1","fax","mobile","address","city","purchaseOrderNumber","decimalPrecision",{name:"date",type:"date",dateFormat:"c"},{name:"deliveryDate",type:"date",dateFormat:"c"},"total","editable","deletable","voidable",{name:"status",type:"string",isEnum:true,values:{open:translate("withoutStatus",true),closed:translate("billed",true),"void":translate("canceledFemale",true)}},"number","currencySymbol","currencyCode","warehouse","canPrintOrDownload"],proxy:{type:"ajax",method:"POST",api:{read:"/purchase-order/retrieve-all/format/json",update:"data/updateItems.json",create:"/purchase-order/add/format/json",destroy:"/purchase-order/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.Warehouse",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"string"},{name:"name",type:"string"},{name:"address",type:"string"},{name:"observations",type:"string"},{name:"deletable",type:"bool"},{name:"editable",type:"bool"},{name:"status",type:"string"},{name:"isMain",type:"string"},{name:"idCostCenter",},{name:"costCenterName",type:"string"}],idProperty:"idLocal"});Ext.define("AL.model.CostCenter",{extend:"Ext.data.Model",fields:["id","idLocal","code","name","created","description","status","lft","rgt","deletable","items"]});Ext.define("AL.view.bill.PhysicalDocument",{extend:"Ext.form.Panel",alias:"widget.bill_PhysicalDocument",style:"margin-bottom: 10px; margin-top: 10px",title:"",width:1024,layout:"hbox",labelStyle:"color: rgb(107, 133, 113); font-weight: bold",items:[{xtype:"container",title:"",defaults:{width:300,labelAlign:"right",labelPad:15},items:[{xtype:"textfield",name:"physicalDocumentNumber",fieldLabel:translate("physicalDocumentNumber",true)},{xtype:"datefield",name:"physicalDocumentDate",fieldLabel:translate("physicalDocumentDate",true),value:new Date(),maxValue:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDateOf",true)+" "+translate("theBill")+" "+translate("bill"),invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",}]}]});Ext.define("AL.view.bill.FormAddBill",{extend:"Ext.form.Panel",alias:"widget.bill_FormAddBill",style:"margin-bottom: 10px",bodyCls:"container-visible",bodyPadding:30,layout:"hbox",callUpdateTotal:true,defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",flex:1,defaults:{width:300,labelAlign:"right",labelPad:15},items:[{xtype:"container",layout:"hbox",items:[{xtype:"combo",fieldLabel:translate("supplier",true),name:"idClient",blankText:translate("itIsNecessaryToAssignASupplierTo",true)+" "+translate("theBill")+" "+translate("supplierInvoice"),style:"margin-bottom:5px",msgTarget:"side",emptyText:translate("search",true),labelAlign:"right",width:300,triggerCls:"x-form-search-trigger",labelPad:15,id:"billClientCombo",minChars:0,triggerAction:"all",allowBlank:false,store:"Clients",matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("createNewContact",true)+" </a></div>",width:250,height:200,loadingText:translate("search",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},tooltip:{title:"Edición de proveedor deshabilitada",description:"No puedes editar el proveedor a causa de los "+translate("advances")+" aplicados en la "+translate("supplierInvoice"),visible:false},displayField:"name",valueField:"idLocal"},{xtype:"box",width:170,style:"margin-left: 10px",html:'<a href="#" class="addAnother" id="createOtherContact">'+translate("createNewContact",true)+"</a>"}]},{xtype:"textarea",fieldLabel:"Observaciones",name:"observations",allowBlank:true,id:"billObservationsTextarea",msgTarget:"side",labelAlign:"right",labelPad:15,width:300,hidden:true},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("bill"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"displayfield",fieldLabel:translate("rate"),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"combo",name:"economicActivity",emptyText:"Buscar...",fieldLabel:translate("economicActivity",true),allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:1,tooltip:translate("indicateTheSuppliesEconomicActivity",true),listConfig:{loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",getInnerTpl:function(){return"{id} - {value}"}},hidden:true},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"togglerFields",name:"physicalDocumentsToggler",hidden:true,width:1024,togglerParameters:{toggleElements:false,toggleLabelText:translate("physicalDocumentInfo",true),childComponent:Ext.create("AL.view.bill.PhysicalDocument"),toggleLabelTextStyle:{color:"#888",}}}]},{xtype:"container",name:"rightContainer",flex:1,defaults:{msgTarget:"side",labelAlign:"right",width:280,labelPad:15,labelWidth:190},items:[{xtype:"container",name:"isElectronicBillContainer",margin:"3 0 5 0",countries:["costaRica"],countriesStampValidate:true,items:[{xtype:"label",text:translate("stampElectronicBill",true),name:"isElectronicBillLabel",width:190,margin:"0 15 0 0",style:"text-align: right; line-height: 14px; padding-bottom: 5px; float: left;",cls:"x-form-item-label",},{xtype:"checkbox",name:"isElectronicBillCheckbox",style:"margin-top: 5px",margin:"0 5 0 0",inputValue:true,uncheckedValue:false},{xtype:"container",name:"isElectronicBillTooltip",html:'<div class="tooltip-wrapper add-invoice" style="left: 230px; top: 6px; margin-left: 0px; z-index: 10;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="top: 15px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 273px; padding:3px"><div class="text">'+translate("stampElectronicBillHelp",true)+' <a target="_blank" href="https://ayuda.getsoft.app/articles/3787860">'+translate("here")+"</a>.</div></div></div></div>",margin:"0 5 0 0"},]},{xtype:"container",name:"numberContainer",layout:"hbox",margin:"0 0 5 0",width:480,items:[{xtype:"label",text:translate("number",true),name:"billNumberLabel",width:190,margin:"0 15 0 0",style:"text-align: right;",cls:"x-form-item-label"},{xtype:"textfield",name:"prefix",allowBlank:true,width:135,emptyText:translate("prefix",true),margin:"0 5 0 0",hidden:true},{xtype:"textfield",name:"billNumber",allowBlank:true,id:"billNumberTextfield",width:135,emptyText:translate("number",true)},]},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDateOf",true)+" "+translate("theBill")+" "+translate("bill"),invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",id:"billDateDatefield",width:340},{xtype:"combo",name:"saleCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("condition",true),store:"SaleConditions",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,hidden:true,width:340},{xtype:"combo",fieldLabel:translate("deadline",true),name:"days",allowBlank:true,store:"Terms",displayField:"name",valueField:"idLocal",queryMode:"local",hidden:true},{xtype:"datefield",fieldLabel:translate("due",true),name:"dueDate",allowBlank:false,value:new Date(),minValue:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineADateWhen",true)+" "+translate("theBill")+" "+translate("bill")+" "+translate("expiresItself"),invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",id:"billDueDateDatefield",width:340},{xtype:"combo",name:"paymentMethod",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Método de pago",store:"PaymentMethods",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,width:340,hidden:true,},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,width:340,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"checkboxfield",boxLabel:"Operación sujeta a proporcionalidad",name:"isSubjectToProportionality606",inputValue:"yes",uncheckedValue:"no",checked:false,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="left: 79%; margin-left: 12px; z-index: 10;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -35px;top: 5px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 273px;padding:3px;line-height: 14px;"><div class="text">Activa esta opción para considerar el ITBIS en la proporcionalidad de tus reportes. <a target="_blank" href="https://ayuda.getsoft.app/genera-el-reporte-606-desde-alegra-rep%C3%BAblica-dominicana#casilla-de-proporcionalidad-en-facturas-de-compra">Ver más.</a></div></div></div></div>',boxLabelAlign:"before",labelPad:20,boxLabelCls:"isSubjectToProportionalityCheckbox",hidden:true},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,queryMode:"remote",forceSelection:true,width:340,listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},}]}],getFieldValuesAsMetadata:function(){var d=null;var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"costaRica":var f=this.down("checkbox[name=isElectronicBillCheckbox]");if(f&&f.getValue()){var h=this.down("combo[name=saleCondition]");var a=this.down("combo[name=paymentMethod]");var g=this.down("combo[name=economicActivity]");var e=Ext.ComponentQuery.query("bill_PhysicalDocument textfield[name=physicalDocumentNumber]")[0];var c=Ext.ComponentQuery.query("bill_PhysicalDocument datefield[name=physicalDocumentDate]")[0];d={saleCondition:h.getValue(),paymentMethod:a.getValue(),economicActivity:g.getValue(),isElectronicBill:f.getValue()};if(e&&e.getValue()){d.physicalDocument={number:e.getValue(),date:Ext.Date.format(c.getValue(),"Y-m-d")}}}break}return d},setFieldValuesFromMetadata:function(f){var g=this.configs&&this.configs.country?this.configs.country:null;switch(g){case"costaRica":if(typeof f.saleCondition!=="undefined"){var j=this.down("combo[name=saleCondition]");var h=j.getStore();if(h.hasLoaded()){j.setValue(f.saleCondition)}else{h.on("load",function(k){j.setValue(f.saleCondition)})}}if(typeof f.paymentMethod!=="undefined"){var c=this.down("combo[name=paymentMethod]");var h=c.getStore();if(h.hasLoaded()){c.setValue(f.paymentMethod)}else{h.on("load",function(k){c.setValue(f.paymentMethod)})}}if(typeof f.economicActivity!=="undefined"){var a=this.down("combo[name=economicActivity]");var h=a.getStore();if(h.hasLoaded()){a.setValue(f.economicActivity)}else{h.on("load",function(k){a.setValue(f.economicActivity)})}}if(typeof f.isElectronicBill!=="undefined"){var d=this.down("checkbox[name=isElectronicBillCheckbox]");d.setValue(f.isElectronicBill)}if(typeof f.physicalDocument!=="undefined"){if(typeof f.physicalDocument.number!=="undefined"){var e=Ext.ComponentQuery.query("bill_PhysicalDocument textfield[name=physicalDocumentNumber]")[0];e.setValue(f.physicalDocument.number)}if(typeof f.physicalDocument.date!=="undefined"){var b=Ext.ComponentQuery.query("bill_PhysicalDocument datefield[name=physicalDocumentDate]")[0];b.setValue(f.physicalDocument.date)}}break}}});Ext.define("AL.view.category.Tree",{extend:"Ext.tree.Panel",alias:"widget.category_Tree",title:"",height:400,rootVisible:false,store:"Categories",columns:[{xtype:"treecolumn",text:"Nombre",flex:2,sortable:true,dataIndex:"text"},{text:"Descripción",flex:3,dataIndex:"description",sortable:true}]});Ext.define("AL.view.bill.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.bill_MoreActionsButton",text:translate("moreActions",true),cls:"button2",padding:"1 5 8 5",handler:function(){this.showMenu()},typeTransaction:"out",idLocal:null,billNumber:null,date:null,legalStatus:null,initComponent:function(){var a=[];if(this.isCloseable){a.push({text:translate("closeWithoutPayment",true),action:"closeBill",disabled:(this.legalStatus=="IN_PROCCESS")})}else{if(this.legalStatus=="REJECTED"){a.push({text:translate("closeWithoutPayment",true),disabled:true})}}a.push({text:translate("apply",true)+" "+translate("advances"),href:"#",action:"applyAdvances",disabled:!this.canApplyAdvances});a.push({text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile"});if(this.canEditRetentions===true){a.push({text:translate("edit",true)+" "+translate("retentions"),href:"/bill/edit-retentions/id/"+this.idType})}this.menu.items=a;this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.view.bill.FormAddPurchaseOrder",{extend:"Ext.form.Panel",alias:"widget.bill_FormAddPurchaseOrder",bodyPadding:"10 10 25 10",name:"purchaseOrderContainer",items:[{xtype:"purchaseOrder_PurchaseOrderForBill"}],dockedItems:[{xtype:"box",cls:"link-add-purchaseOrder",dock:"bottom",name:"addPurchaseOrderLink",html:'<a id="addPurchaseOrderLink">'+translate("add",true)+" "+translate("purchaseOrder")+"</a>"}]});Ext.define("AL.view.ux.fields.TogglerFields",{extend:"Ext.panel.Panel",alias:"widget.togglerFields",title:"",labelPad:15,width:1024,msgTarget:"side",labelAlign:"right",margin:"20 0 0 0",togglerParameters:{toggleElements:false,toggleLabelText:"",toggleLabelTextStyle:{},childComponent:{},showChildComponent:true},defaults:{width:1025,},items:[],initComponent:function(){var a=this;a.items.push(Ext.create("Ext.form.Label",{html:'<span id="componentTogglerLabel">'+a.togglerParameters.toggleLabelText+"</a>",style:a.togglerParameters.toggleLabelTextStyle}));a.items.push(a.togglerParameters.childComponent);a.callParent();a.doLayout()},listeners:{afterrender:function(a){if(a.togglerParameters.toggleElements){var b=Ext.get("componentTogglerLabel");if(b){b.setStyle({textDecoration:"underline",cursor:"pointer"});if(!a.togglerParameters.showChildComponent&&a.togglerParameters.showChildComponent){a.getComponent(1).hide()}b.on("click",function(c){c.preventDefault();a.showPhysicalDocumentLinkForm(a)})}}},},showPhysicalDocumentLinkForm:function(b){var a=b.getComponent(1);if(a.hidden){a.show()}else{a.hide()}},});Ext.define("AL.view.purchaseOrder.ComboPurchaseOrders",{extend:"Ext.form.field.ComboBox",alias:"widget.purchaseOrder_ComboPurchaseOrders",name:"idPurchaseOrder",fieldLabel:translate("purchaseOrder",true),displayField:"purchaseOrderNumber",valueField:"id",store:"PurchaseOrdersCombo",editable:false,labelAlign:"right",queryMode:"local",msgTarget:"side",labelPad:15,labelWidth:120,padding:"5 0 10 0",allowBlank:true,emptyText:translate("selectSimple",true),labelStyle:"color: rgb(107, 133, 113); font-weight: bold",matchFieldWidth:false,listConfig:{emptyText:'<div class="noPurchaseOrderCombo">'+translate("thereAreNoPurchaseOrdersAssociatedWithTheSelectedSupplier",true)+"</div>",width:200}});Ext.define("AL.view.purchaseOrder.PurchaseOrderForBill",{extend:"Ext.container.Container",border:true,alias:"widget.purchaseOrder_PurchaseOrderForBill",style:"background: #F9F9FD; border-left: 1px solid #eee; border-right: 1px solid #eee; position: relative;",padding:"10px 1px 5px 1px",margin:"0 0 20 0",items:[{xtype:"purchaseOrder_ComboPurchaseOrders"},{xtype:"button",action:"deletePurchaseOrder",width:16,height:16,style:"position: absolute; top : 19px; right: 15px; cursor: pointer; color: #B1B1B1; background-image: url(https://cdn1.getsoft.app/images/sm-delete.png);",baseCls:"deleteIcon"}]});Ext.define("AL.store.Bills",{extend:"Ext.data.Store",model:"AL.model.Bill",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/bill/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.Clients",{extend:"Ext.data.Store",model:"AL.model.Client",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/client/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a "+translate("openInvoice",true)+"], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.Categories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",autoLoad:false,folderSort:true,proxy:{type:"ajax",url:"/category/retrieve-all/format/json",timeout:480000}});Ext.define("AL.store.Taxes",{extend:"Ext.data.Store",model:"AL.model.Tax",autoLoad:false,data:[],proxy:{type:"ajax",url:"/tax/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CategoriesCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",pageSize:80,autoLoad:false,proxy:{type:"cacheajax",url:"/category/retrieve-for-combo/format/json/",cacheName:"CategoriesCombo",timeout:480000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.Retentions",{extend:"Ext.data.Store",model:"AL.model.Retention",autoLoad:false,proxy:{type:"ajax",url:"/retention/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.StampDocumentsReceived",{extend:"Ext.data.Store",model:"AL.model.StampDocumentReceived",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/stamp-document-received/retrieve-all/noIdResource/true/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Convertir a factura de compra], img[alt=Descargar],img[alt=Eliminar], img[alt=Ver correo]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.PurchaseOrdersCombo",{extend:"Ext.data.Store",model:"AL.model.PurchaseOrder",proxy:{type:"ajax",url:"/purchase-order/retrieve-all-open-by-client/format/json",reader:{type:"json",root:"results"}},sorters:[{property:"name",direction:"ASC"}]});Ext.define("AL.store.WarehouseCombo",{extend:"Ext.data.Store",model:"AL.model.Warehouse",autoLoad:false,pageSize:150,proxy:{type:"ajax",url:"/warehouse/retrieve-all/format/json/only-active/yes",timeout:60000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.CostCentersCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CostCenter",autoLoad:false,pageSize:20,proxy:{type:"cacheajax",url:"/cost-center/retrieve-all/status/active/format/json",cacheName:"CostCentersCombo",reader:{type:"json",root:"results"}}});Ext.define("AL.view.ux.fields.Address",{extend:"Ext.panel.Panel",alias:"widget.addressField",border:false,layout:{type:"table",columns:3,tableAttrs:{},tdAttrs:{valign:"top"}},defaults:{margin:"0 0 10 5",},defaultType:"textfield",initComponent:function(){if(this.marginAllItems){this.defaults.margin=this.marginAllItems}this.callParent()},setCountry:function(e){this.country=e;var d=this;var c=this.labelPad?this.labelPad:14;var a=[{xtype:"displayfield",name:"label",fieldLabel:translate("address",true),id:"labelNameAddress",labelAlign:"right",labelPad:c,labelWidth:this.labelWidth,width:this.labelWidth,rowspan:5,}];var b=(d.fullWidth/2)-2;switch(e){case"peru":a.push({emptyText:this.placeholders==false?"":translate("address",true),name:"address",allowBlank:true,width:b,submitValue:false},{emptyText:this.placeholders==false?"":translate("department",true),name:"state",allowBlank:true,width:b,},{emptyText:this.placeholders==false?"":translate("city",true),name:"city",allowBlank:true,width:b,},{emptyText:this.placeholders==false?"":translate("district",true),name:"district",allowBlank:true,width:b,},{emptyText:this.placeholders==false?"":translate("urbanization",true),name:"urbanization",allowBlank:true,maxLength:25,maxLengthText:"Puedes agregar máximo 25 caracteres, para poder emitir tus documentos.",width:b,},{emptyText:this.placeholders==false?"":"Código ubigeo",name:"ubigeoCode",allowBlank:true,regex:/^([0-9]{6})$/,width:b,});break;case"costaRica":a=[{xtype:"displayfield",name:"label",fieldLabel:"Ubicación",labelAlign:"right",labelPad:c,labelWidth:this.labelWidth,width:this.labelWidth,rowspan:5,},{xtype:"combo",name:"province",emptyText:this.placeholders==false?"":"Provincia",allowBlank:true,store:"Provinces",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["costaRica"],listeners:{change:function(m,l){var k=m.up("form");var f=k.down("addressField[name=addressComponent]");if(f){var j=f.down("combo[name=canton]");var g=j.getStore();var h=g.getProxy();h.setExtraParam("filters",Ext.encode({province:m.getSelectedRecord()?m.getSelectedRecord().data.id:null}));g.load()}}}},{xtype:"combo",name:"canton",emptyText:this.placeholders==false?"":"Cantón",allowBlank:true,store:"Cantons",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["costaRica"],listeners:{change:function(m,l){var k=m.up("form");var f=k.down("addressField[name=addressComponent]");if(f){var j=f.down("combo[name=district]");var g=j.getStore();var h=g.getProxy();h.setExtraParam("filters",Ext.encode({canton:m.getSelectedRecord()?m.getSelectedRecord().data.id:null}));g.load()}}},},{xtype:"combo",name:"district",emptyText:this.placeholders==false?"":"Distrito",allowBlank:true,store:"Districts",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["costaRica"],listeners:{change:function(m,l){var k=m.up("form");var f=k.down("addressField[name=addressComponent]");if(f){var h=f.down("combo[name=neighborhood]");var g=h.getStore();var j=g.getProxy();j.setExtraParam("filters",Ext.encode({district:m.getSelectedRecord()?m.getSelectedRecord().data.id:null}));g.load()}}},},{xtype:"combo",name:"neighborhood",emptyText:this.placeholders==false?"":"Barrio",allowBlank:true,store:"Neighborhoods",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["costaRica"],},{emptyText:this.placeholders==false?"":"Otras señas",name:"description",allowBlank:true,colspan:2,width:d.fullWidth,isRequiredForElectronicInvoicing:["costaRica"],}];break;case"colombia":a.push({xtype:"textfield",emptyText:this.placeholders==false?"":translate("address",true),name:"description",allowBlank:true,colspan:2,width:d.fullWidth},{xtype:"combo",name:"country",emptyText:this.placeholders==false?"":translate("country",true),allowBlank:true,store:"Countries",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,excludeFrom:[{country:"colombia",views:["company_FormInfoEdit","company_WindowInfoEdit"]}],listeners:{beforerender:function(g){var f=g.up("form");if(!f.type||f.type!=="edit"){g.select("Colombia")}},change:function(m,k){var j=m.up("form");var f=j.down("addressField[name=addressComponent]");if(f){var h=j.down("combo[name=city]");var n=j.down("combo[name=department]");var l=j.down("textfield[name=zipCode]");var g=j.configs.country=="colombia"&&j.configs.isActiveElectronicInvoicing===true&&j.configs.electronicInvoicingVersion=="2.1";if(k!=="Colombia"){if(n){n.allowBlank=true;n.select(null);n.disable();n.hide()}if(h){h.allowBlank=true;h.select(null);h.disable();h.hide()}if(l){l.setValue(null);l.disable();l.hide()}if(g){j.down("textfield[name=description]").allowBlank=true}}else{if(n){n.enable();n.show()}if(h){h.enable();h.show()}if(l){l.enable();l.show()}if(g){h.allowBlank=false;n.allowBlank=false;j.down("textfield[name=description]").allowBlank=false}}}}}},{xtype:"combo",name:"department",emptyText:this.placeholders==false?"":translate("department",true),allowBlank:true,store:"Departments",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,listeners:{change:function(g,n){var f=g.up("form");var h=f.down("addressField[name=addressComponent]");if(h){var j=g.getSelectedRecord();var p=h.down("combo[name=country]");var l=h.down("combo[name=city]");var o=l.getStore();var m=o.getProxy();if(l){l.select(null)}if(j.raw&&j.raw.id){m.setExtraParam("filters",Ext.encode({idDepartment:j.raw.id}))}else{m.setExtraParam("filters",null)}o.load();if(p&&n!==null&&!Ext.isEmpty(n)){p.select("Colombia")}if(l){var k=false;switch(f.xtype){case"client_FormAdd":k=p.getValue()=="Colombia"&&f.configs.isActiveElectronicInvoicing===true&&f.configs.electronicInvoicingVersion=="2.1";break;case"company_WindowInfoEdit":k=f.configs.isActiveElectronicInvoicing===true&&f.configs.electronicInvoicingVersion=="2.1";break;case"company_FormInfoEdit":k=f.down("checkbox[name=isActiveElectronicInvoicing]").checked===true&&f.down("combo[name=versionElectronicInvoicing]").getValue()=="2.1";break}if(Ext.isEmpty(n)&&Ext.isEmpty(l.getValue())){g.allowBlank=true;l.allowBlank=true}else{g.allowBlank=false;l.allowBlank=true}if(k){l.allowBlank=false}g.isValid();l.isValid();if(f.xtype=="company_WindowInfoEdit"){f.isValid()}}}}},},{xtype:"combo",name:"city",emptyText:this.placeholders==false?"":translate("municipality",true),allowBlank:true,store:"Cities",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,listeners:{change:function(k,j){var h=k.up("form");var f=h.down("addressField[name=addressComponent]");if(f){var m=f.down("combo[name=department]");if(m){var l=k.getSelectedRecord();if(l){var g=m.getStore();g.findBy(function(n,o){if(l.raw&&l.raw.idDepartment&&l.raw.idDepartment==o){m.select(n);return true}return false})}if(Ext.isEmpty(j)&&Ext.isEmpty(m.getValue())){k.allowBlank=true;m.allowBlank=true}else{k.allowBlank=true;m.allowBlank=false}k.isValid();m.isValid()}}}},},{xtype:"textfield",emptyText:this.placeholders==false?"":translate("zipCode",true),name:"zipCode",allowBlank:true,colspan:2,hidden:true,countries:["colombia"],maxLength:10,maxLengthText:"Este valor no puede contener más de 10 dígitos",regex:/^[\d]+$/,regexText:"Solo se admite un valor numérico",width:b,msgTarget:"side",validator:function(f){if(this.allowBlank&&f==""){return true}var g=["000000","913057","915010","911018","913050","915019","914050","917010","911039","911037","911017","916017","915017","912010","915018","913017","911038","917017","912019","913019","916057","912018","913010","914057","911010","910001","911030","910007","916058","913018","910008","917018","912017","054018","055030","051437","050032","057067","051430","056040","056417","054438","051037","055068","056847","055020","053838","055840","052050","057040","054848","057030","051448","051030","057050","054828","053467","057457","056438","057857","057837","050040","055057","056860","051417","051860","052850","057028","053830","057458","053010","056470","051857","057440","054057","053420","055837","052848","055050","051020","054038","051427","056838","051054","054428","056027","054058","054817","052810","051038","056850","055430","056427","056837","055440","055867","056818","057840","055027","052448","052079","053820","054030","053020","057068","055420","053017","057420","056820","055038","057017","057829","053857","054838","057868","054020","051410","051058","057020","055070","053810","057447","050015","051858","053457","051028","052060","053817","053048","050004","051868","053028","054448","050006","050043","054827","051070","053447","053410","053428","051460","050016","057010","053440","050024","052447","055077","057467","057438","052030","055438","054010","053430","050036","057427","052020","050021","055427","051450","051447","055827","057820","052847","050012","057418","050010","054050","055460","057817","053050","054048","053427","054017","052857","054410","051837","051027","056017","052018","055848","056817","055422","056467","055421","050007","051847","055858","056447","052428","052017","055018","050041","055010","052438","050029","057827","056830","051059","055450","056037","054028","051838","050023","051850","057839","055457","053450","056440","050037","051830","055847","050033","055860","054440","053037","055817","050013","054430","054847","056430","057018","057878","057858","055411","050020","056477","055048","057037","052837","050031","050048","050018","052068","057460","055040","056468","056840","051818","052458","050047","050044","052437","052067","050022","052418","050014","050030","053417","051468","055017","053418","053460","051052","056867","052037","052077","050001","050025","056047","053040","056810","056010","051817","052047","056420","051810","052468","052427","050017","052818","051820","057847","052820","057038","050011","052038","054450","055818","055410","054040","057060","051057","057410","056460","056410","057417","052027","054447","055437","057450","053047","056828","054417","051053","057828","053837","053437","057877","051048","056077","056858","057437","057428","051827","055067","053847","052450","051051","050005","052010","057860","050026","053027","057841","053827","054840","052827","055028","054810","057869","056067","055820","055078","057058","056020","056057","052460","055037","052828","052817","056478","050034","052070","054047","052467","052417","054027","050002","052840","055467","052440","054427","052420","057870","055413","051420","055417","056030","055810","057047","051840","055468","055857","057850","056068","055850","052040","054837","050027","054457","050028","056857","057430","052057","053840","054437","051467","051867","050042","055830","051047","055060","053850","050003","051010","056457","055047","055447","056060","057027","051050","053030","056827","056028","057838","057810","051017","055448","053448","055412","054820","052457","055058","056050","052430","056450","056868","056070","052410","057830","052078","054037","050035","054830","052830","054420","054829","051457","057057","054818","051077","051440","055428","057867","053057","056437","051040","814057","815017","816018","810009","813017","813010","814050","814017","814010","812017","812010","816017","816019","810008","812019","810001","815010","816010","814058","810007","814018","812018","813018","815018","880007","880001","880028","880008","880027","880020","082020","081007","080006","083027","084047","080011","082040","081028","085001","080016","081001","082001","084040","082007","085040","082027","081047","082047","085047","084067","081040","080010","083080","084001","081027","080004","083020","085067","085060","083087","085020","085027","080001","085007","084060","085048","084027","083005","084087","082067","083040","084008","080012","085068","085008","080020","081020","080002","080015","083060","083003","083010","083001","084080","083004","083021","085009","081067","081048","081008","083007","083047","081060","084007","080005","080003","080007","083067","083002","080013","083028","084020","082060","080014","083006","082028","111321","110231","110931","110511","110841","111161","111221","111961","110911","111121","110721","110441","110551","110561","111151","110871","111821","111041","111621","111971","111941","110311","111156","111176","110111","111631","110151","112021","112031","111131","111611","110571","110421","110921","110221","110741","111911","111311","111011","112011","110881","111061","111921","111031","111021","110431","110731","111811","112041","111711","110411","111511","110121","110811","110531","111051","111951","111831","111211","110851","111411","111111","111071","111171","110861","110611","110711","111166","110541","110821","110131","111981","111931","110621","111141","111841","110521","110321","110831","110211","110141","131077","130015","132527","134077","134040","131547","131040","132047","131028","132057","135027","130011","130510","133040","130528","133537","134070","133049","132040","130008","134517","130002","134501","132511","131067","133028","132519","130027","130014","131540","133007","134068","131029","134027","132547","134527","133567","130012","130013","130018","130019","131520","130527","132557","134047","132567","133518","130530","132050","131068","131069","132560","130009","130547","135008","132030","132058","135007","134510","131020","133510","133550","130017","135028","134020","135048","131507","135040","134048","134548","133538","134547","132059","130501","133530","133020","132540","133047","132548","130540","131548","130001","130007","135060","135067","132518","134008","132001","131017","131007","131527","132501","130517","132018","131501","131027","131010","130005","131567","130003","133508","132507","134067","131008","134060","134001","135020","135047","131001","133507","133558","133557","132037","130537","130507","134028","134520","132512","134507","133501","133027","132550","132007","132517","130508","133001","130006","133048","133560","132568","132017","131560","134007","131048","133517","132010","132508","130520","133008","130004","131047","135001","131060","130010","134540","153420","151007","151407","153880","155218","152429","153207","152001","151201","150617","151287","154407","153667","153287","153450","155047","154827","150610","152847","150487","154001","155060","152211","151240","150267","150680","150220","150640","153847","150462","151801","155219","154269","153020","155201","150660","154448","152447","151267","154860","150647","152468","154847","153867","150469","153827","150488","150620","153240","152240","154040","155001","151047","153468","152867","150207","153460","151827","153801","155027","153260","152047","152080","153227","151247","153840","152647","152247","153037","153407","151820","152601","154220","153057","153440","150247","151647","152469","150820","152427","154808","153608","153860","153220","154080","152210","154427","150448","154887","151608","154201","150667","151660","153457","151807","153620","150807","151667","154268","152237","154667","150627","153248","154640","153627","151027","152217","151627","153047","153280","153201","150480","152627","153268","153809","150408","153247","150827","153067","151447","150008","152667","152060","153637","154601","151427","153467","154447","153447","150009","154820","150002","153887","152448","154801","151020","152020","153050","150467","154647","155217","152250","150687","154047","150840","150607","153668","151448","152218","152268","152640","155208","152428","153217","154460","150887","150260","154087","151260","150447","152401","152807","155067","153267","154267","154207","154609","150461","151420","150601","150468","154660","154840","152027","154608","153660","154828","155028","153647","151601","154807","150440","153487","152087","154428","154677","153630","153648","152820","154617","153030","152840","153807","153607","152257","151220","151280","154227","151609","151440","154260","150427","155048","153427","151640","150268","152280","152267","150449","152467","150880","151067","154060","154240","150401","153408","153649","152288","152620","152260","154648","154007","155209","154670","153060","152420","151401","152660","152287","152407","152207","150407","152230","150801","154687","152680","153001","154440","151840","152219","153820","152607","151060","153617","152067","153808","152007","152617","150227","150201","151628","150477","151001","152440","150007","154401","150420","151040","151607","155068","154247","151620","153601","150003","154467","154067","155007","150208","153040","154607","151847","153210","152687","154420","150860","153027","150847","153610","153007","154020","152827","152460","150428","150240","150867","153640","154680","152801","152201","155207","152040","155040","153480","150001","152860","154880","154848","151227","151207","152610","153401","154867","154027","155020","172001","170003","176001","170008","176007","177060","171020","172027","174008","173020","172048","170001","172060","178001","170017","178047","170002","178057","174001","177087","176048","173060","172029","176028","174007","175001","178049","177089","177040","173001","171008","178020","172047","172040","178048","171047","174037","177047","175007","176047","175037","170009","172007","178007","171001","172009","173047","173067","177020","173007","175030","176040","177027","177067","170006","178040","173028","170004","172008","174030","176027","172028","171007","177007","170007","171040","171028","173048","173040","178028","177080","177001","172067","173068","176020","177068","175038","174038","177088","173069","174009","175031","176008","171027","172020","173027","178027","180017","184010","186037","181037","180002","181059","186017","184017","186058","181058","186038","181017","182017","185017","186010","186030","186077","184019","183010","185077","186059","186057","185037","180001","185057","181039","181050","185030","186070","183019","182058","181057","185070","185058","186050","181010","185018","183017","182019","181038","180007","184018","185038","180009","181067","185010","185050","182018","182057","186078","182050","186018","183027","182059","183018","182010","181018","181030","180008","181019","185078","855030","850001","855039","852058","856017","853059","851070","856030","853038","851030","856019","851077","854037","854017","855050","854018","852039","852038","853039","853057","855057","852050","855038","855010","853030","852030","852037","850007","856010","855018","853058","850008","854019","851038","856038","853017","853010","854010","856050","855058","851078","851057","852019","851010","856058","856018","854038","853018","855037","854039","850009","851037","855017","851058","851017","850002","853037","852017","852057","854030","856057","852010","852018","851050","853050","856037","853019","191077","191088","193588","194028","195539","191528","190509","191501","194007","192027","196038","194037","192579","193507","190517","190547","193550","193001","194080","193589","191048","195008","190567","194068","192008","196009","190518","195067","193578","191079","192007","190009","190508","190018","190501","195040","192020","195047","192048","192578","192057","191047","196030","195017","195538","191529","193579","192077","194558","194508","195060","193570","192001","192508","190538","191039","195009","190002","190558","195547","191067","191568","196037","194089","191007","196008","194501","191017","195507","190017","192040","190589","196060","194027","191567","191540","191038","195019","193508","190539","191037","190004","190001","192547","190507","194008","195001","192518","194067","192009","191569","193537","191030","190548","193008","195018","190530","192539","192049","193007","193557","193577","191060","194088","192078","194509","195508","194029","195567","194087","193597","191087","190003","192531","194001","194528","196001","190588","194527","193520","193009","191009","195501","196068","190537","194060","194557","190580","191001","192548","195068","192047","191078","191049","190550","191008","192079","190008","192537","192570","192070","191520","190559","193527","192577","190557","194520","192029","194507","195069","192028","191560","195530","192501","190587","193587","194020","195560","191527","194550","192509","190597","192507","192517","193529","196007","194038","195007","192087","196067","192538","191547","193528","193501","193558","191507","195509","190007","191070","195537","200009","201057","201038","201048","203067","205008","205010","201058","200002","202037","201037","205017","200008","204067","205078","204001","200001","200007","201010","203020","201040","202017","203060","203048","203047","201027","201030","205040","204047","204020","200017","201050","204040","203040","202018","202030","205037","202010","204028","201018","203001","204068","205050","201020","201017","202038","204060","203007","200003","201001","205047","205007","204027","204007","203027","205057","202050","202058","201007","205030","205058","205070","205048","202057","200004","200018","201047","200005","205059","202001","201008","205018","205077","202007","205001","274017","273077","272017","276078","272020","272050","278037","272048","274050","276018","276030","276038","275038","277010","273058","271037","276019","275010","273037","276050","272058","276077","274010","277050","272040","272057","270070","272027","275030","271030","274018","274039","270077","273030","272037","276070","273057","277038","270078","277037","275058","275057","276037","278010","273010","277030","273038","278057","274037","271017","277017","274058","278038","275037","275050","278018","271050","270007","273050","273078","271018","278050","274038","270002","276057","272047","270009","277018","278017","270001","274019","276058","278030","272010","275017","273070","272018","274030","275018","271058","278058","273017","271010","274057","276010","272030","276017","271077","271070","271057","277057","270008","231520","233049","232039","230520","232557","230017","234010","233501","230507","232537","234538","234007","231048","234517","235020","233048","234539","230558","230550","233001","232050","234030","235028","232508","233020","232529","233538","231038","231007","232547","230027","231540","234039","234508","230002","231029","230009","232558","232020","232507","235027","230028","230019","233530","232527","234038","232008","231507","235048","233028","234518","234537","232017","234501","232001","231027","235008","235040","230529","234507","231047","230537","232059","233040","230007","233537","231020","232559","230018","234001","232540","233007","232007","231528","232528","235007","231508","231001","230538","235047","233027","232038","232520","232010","232030","232548","233507","232058","232057","230003","233539","232538","231527","230557","234037","232509","233008","231501","231028","230029","232027","231037","233009","231509","230528","234530","232517","230501","231039","230527","235001","230001","232549","233047","233057","232501","230004","230008","234509","230559","231547","234008","231008","234017","232018","253427","253627","252610","252417","252848","253460","252847","250601","251267","251227","251628","250051","250818","253047","253620","253040","252008","252212","250257","250020","251208","253840","252040","253847","250407","250630","252247","251020","250220","250251","253440","250637","250418","254007","251810","250450","251038","253660","253437","252801","253607","253601","253227","250607","251027","252010","251047","252820","254040","252030","250052","250410","252037","253201","250252","253260","250430","252657","253610","250640","252001","253449","251407","252248","250030","253420","253217","251847","251040","253447","250078","250608","252830","253257","252627","252640","253647","250810","253230","251850","250417","251830","252201","250830","250055","250077","252638","251620","253827","251217","250054","250247","252630","253608","250827","253020","252850","251808","253650","251401","250217","252810","252648","251057","251010","250440","252431","250037","252217","253030","252410","253052","251240","250437","252240","251607","253250","253618","253410","250010","253637","253057","252211","253051","253407","250837","251230","250847","251837","251627","252607","253667","251001","251648","252257","252219","253401","251201","250620","251247","250047","251857","250240","250428","250058","253207","250447","252207","253007","252401","250057","254020","254008","250420","250002","251647","252667","251067","254027","253408","251428","253027","250820","253258","253468","253237","252020","253807","250617","252408","253240","251210","250227","251817","252218","251058","250848","253808","254030","250618","250017","252840","252007","250840","253010","251030","251048","252028","253220","253658","252208","251420","250210","251218","250801","251050","251801","253467","253480","250401","253017","251220","250457","253820","251807","252647","253448","252817","251820","251060","252432","254050","251008","250228","250647","251860","252660","252608","254037","252237","252437","251260","254047","251827","250053","252827","251237","252617","251427","250007","250008","251268","254057","253640","253001","252620","251840","251257","250627","253037","250207","250027","253247","253430","252637","252047","253801","252807","250427","252650","252407","252230","253058","252250","252857","250237","254001","250408","253630","253617","251207","251601","253417","253418","253487","250258","250610","252601","253657","250201","250038","250070","251238","251640","251037","253048","253267","252668","250208","250040","253648","252017","250001","252027","251017","252837","253210","253848","251250","250808","251007","250807","250230","250817","251867","942057","944058","944018","943018","940001","944057","941017","942010","940008","943019","943067","940018","943058","940007","940027","941038","940028","941047","940019","940009","943057","941018","941039","941037","941010","943059","944019","942018","944059","940017","942017","944010","943017","944017","951008","951007","952001","953007","950001","952017","953009","950007","952007","951001","952008","950008","952009","950009","951009","953017","951017","953001","953018","953008","418049","414040","410003","418047","412020","417038","414027","416048","416001","413008","413067","418077","418067","415008","413001","416067","418007","410007","417039","414020","417018","411087","415047","415001","411048","414008","414029","411027","414068","416087","415080","412047","415069","414009","415040","417060","412080","412087","410001","411088","411007","410017","416047","415027","411028","418001","417079","417030","416007","417037","415060","413040","414060","411080","417007","410010","411060","418028","414028","415078","412060","411001","414001","418040","416088","410006","414047","415087","410009","418069","417070","417078","415020","412008","413028","410005","410008","412067","414067","413027","414007","417067","415007","417088","412027","415077","418027","416080","418068","411047","412040","413060","411020","418008","412068","416027","411040","418020","417001","413047","418060","417087","417077","410004","418048","411008","412001","416020","413020","412007","410002","415068","413007","415088","416089","417047","416040","417048","410018","411067","417017","417010","413048","446007","440007","446009","444008","443027","440003","444010","441048","444037","443007","444030","446008","443049","444057","442009","441009","440008","443048","445007","441008","444050","442001","441039","445040","443040","442008","443028","441057","441058","441027","441018","444007","445027","444001","445020","441007","443047","440001","441059","441001","443020","440009","444018","446017","446001","443008","440017","445047","441047","440002","441017","442007","444038","445001","444017","441020","441038","445008","441049","443009","443001","441029","441037","441028","474048","476020","478007","472007","475008","472028","475007","478020","478001","470009","473029","475057","478067","476067","475030","475020","476058","470004","476068","478027","473047","473027","474028","473048","475017","475010","474067","473049","477047","476007","472027","470017","478048","475038","472047","476027","477009","476037","474020","475018","472020","478060","475037","477050","473001","477001","475027","472040","470002","474040","474007","476047","476040","477008","475019","475028","476057","470008","472008","478037","478008","477040","470007","472001","478040","478029","475001","474068","473040","476008","473020","476048","477058","478002","477020","477057","476050","476030","470003","478047","470005","470001","473028","474001","474027","476060","474047","475050","473007","473008","478028","477007","477027","470006","476001","474060","504068","503008","504027","501001","500004","503007","506027","506068","504067","505008","507019","500003","507008","507051","502008","507048","501028","506047","500001","504047","506061","504001","506001","507028","501007","501021","504061","505007","507058","503061","501017","502048","507021","503067","503021","501057","500017","507047","500005","506007","504007","506048","506041","504048","501041","507037","501038","502047","507007","502049","503068","502041","501018","503027","500007","505048","501047","504021","501027","503029","503041","507041","506021","503001","501031","505021","505047","502058","507057","502009","504028","500002","505028","507017","503037","504041","505027","500008","507029","501037","507027","507001","502001","504008","505001","501011","506008","505041","502057","502007","502059","507011","503028","506067","500009","501051","507009","503047","528538","524587","527529","525550","527520","524038","522068","525068","525038","525030","527007","527580","527060","526520","521060","524527","526027","520530","523540","526001","528008","520004","525001","526560","526007","525037","526567","527589","522048","525069","525529","527067","521048","521080","520537","523007","522067","520003","522520","524039","521001","520577","520509","521548","527508","521501","527547","524069","528039","520027","528560","526057","523087","520517","522047","521569","525579","520518","528517","528078","525067","524009","524520","523507","523527","524540","528037","528009","523080","520570","522088","528519","522501","524060","524030","520019","522087","525558","527068","525047","521540","525501","523067","527527","525570","520010","528509","527039","528502","528047","528069","528518","525520","523501","520029","522007","521560","524007","527540","526568","522027","520002","524077","520039","528007","526507","524078","525507","524567","525008","524547","525009","520501","523547","527548","527030","520028","524528","526527","522527","523068","520538","520037","520008","526529","520007","521087","526047","525528","521067","520038","528067","521520","525039","521547","520557","526040","523060","521040","527001","526528","523008","523548","524037","521007","522060","525557","528508","520009","522080","528507","521020","522547","526501","524067","522540","524008","527038","528539","525527","520018","520507","521528","527037","521549","527567","528567","526020","523508","528527","521050","527587","528528","525007","521028","520017","528068","527569","522020","528568","525537","524507","521027","521047","527568","523040","525508","524061","527008","524588","522040","520001","528537","521527","528060","527501","524001","528017","522548","528030","524560","527009","527537","522507","520006","525577","521529","520539","526049","527588","525060","523001","523047","522508","526058","527560","521508","523027","522001","520578","521568","528038","523520","523028","524501","521567","520508","521507","528529","528001","528501","527528","528503","527507","523528","526048","525578","524068","524580","523020","528077","547018","545077","540004","545557","547010","540003","547050","540007","543037","542017","540008","541057","548017","541017","546058","547077","546551","547017","542037","547057","542030","543030","546552","546077","544070","545037","545537","547058","540019","547037","545070","548050","547039","542050","546070","544058","546557","546559","544017","544527","540001","544520","540011","542038","548030","541030","544557","548057","546079","546510","540005","543010","545530","540002","544528","545539","544037","541038","547070","545050","545538","546057","542058","547078","546078","545518","545010","548058","544057","541070","546537","546038","546030","542010","542018","545517","546037","544558","544030","548010","543050","540013","546050","545550","543018","541018","545510","543057","546010","545017","545030","547030","546017","546517","544570","540010","544578","548037","547059","544529","544077","544010","544050","541010","544577","545558","544517","547038","543058","543017","541050","540017","546558","547079","543038","540006","546530","542057","544550","541077","540018","544038","545057","544510","548018","861040","864007","861007","861027","864008","863007","862080","861088","861087","861047","862047","861060","861067","861020","863008","860001","862020","863001","862069","861068","861001","862040","862060","862001","862087","861008","862008","861080","862028","864009","862068","862067","864001","862007","860007","862027","860008","634001","633027","632008","631028","634008","632060","630004","632001","634007","633001","632027","630001","630002","630007","632020","633020","632040","632007","633007","630003","631020","630008","631001","634027","632080","632067","632047","632087","631007","631008","634020","633008","631027","661007","660004","660007","661048","660001","661001","663037","661047","660002","661040","662030","660006","664017","663038","660008","664008","664047","663017","660017","664007","664020","661027","664027","664001","663030","662017","663007","662010","662007","664040","664048","662001","661028","663008","660005","661002","664028","663018","663011","663001","662037","660009","660003","664018","661020","661008","664010","687519","682548","683531","685517","687038","683019","680001","682061","685501","682031","683528","684051","682538","680507","685041","685048","680547","683037","686537","687039","686029","683571","684021","681002","683587","686531","682527","682001","683049","686058","685507","683061","685561","685518","681531","684069","681003","687587","682009","685567","685007","683541","682578","685551","681521","687061","681027","683031","687578","683028","682051","681019","684041","685527","683057","683581","684017","687518","682547","687509","680004","683021","682568","687557","680002","680541","683521","684527","686028","680007","682509","687577","683557","681501","684507","687517","682021","682041","681048","681547","680567","681557","686508","683578","680527","683507","684058","686569","684541","685541","686007","681518","684061","681527","683568","687527","687069","683517","681007","681561","682017","687068","680531","684517","687047","681017","685047","687001","682559","683501","683029","684057","680568","684037","682557","683077","687511","680501","683017","685521","686001","681507","686567","682058","681038","682577","683569","683547","683051","681567","687501","685008","687548","686008","683527","683567","682549","687507","681508","681018","681551","681519","686539","686021","683537","684028","681031","682537","686047","686027","680561","684007","682517","682541","680003","684031","683558","685001","682528","684511","681548","682551","684011","682531","683071","683007","686568","686049","687008","682508","682048","685531","685547","685568","681509","687579","683048","682008","682038","687571","681541","686538","684039","684001","682511","681001","683041","682037","687508","683001","681004","681511","685061","682507","687032","680517","683038","685009","680008","687007","683561","684537","684067","682571","683011","682519","682057","682529","682018","683511","686041","687067","686057","686507","681537","681037","681529","686501","686547","682047","684521","685569","684551","683039","687542","686577","683027","681538","687558","683551","687549","681517","687547","684531","682539","682567","681528","680011","682067","685021","686561","687033","682007","680005","683577","684068","681021","687031","684557","685067","681012","685557","684027","682027","685049","683047","682011","684008","684038","681008","687037","685511","684048","687541","684009","682558","680006","680551","684501","682521","682501","684047","686048","680557","685027","681047","680548","681011","682561","683518","683067","684547","685537","680511","707030","705070","704050","702037","706037","700001","702057","705077","702070","705018","704018","703058","703038","703070","701038","705050","707010","701057","700003","705057","705078","705037","702018","702017","703018","701037","704030","707057","705039","701050","700009","703030","701030","703037","704037","702010","701077","704010","707037","704038","705058","703010","705079","706018","701017","700008","703078","706017","705017","705038","701010","705010","706030","702077","706010","702078","700007","701078","707017","704057","701070","700002","704017","705030","703077","703050","702050","707018","707050","706057","703017","700017","702030","703057","706050","701058","734007","733508","730002","735538","733578","730588","730568","731501","730018","735058","733558","734540","731580","732028","732508","732040","730006","733547","730001","735567","735569","733517","733527","732001","734060","730587","735007","734560","731568","734567","735070","731507","735037","731060","735028","730004","730019","730003","732027","735507","730580","731587","732020","733587","730520","731040","730005","734068","731001","731528","734509","733529","735029","733048","732507","735560","735550","731047","735057","733520","731067","735537","730009","734040","734020","733001","734507","734067","735008","733008","734528","731007","734547","733507","733540","735078","735509","735557","730527","732047","733040","735588","730528","735001","730501","732060","735027","730010","734027","732007","731560","734048","732068","733510","730507","735517","731567","735508","735050","733047","735501","734001","732501","731527","731540","735077","733577","734508","735587","730017","733007","733501","730008","731048","734520","730567","733588","734527","735530","733557","734047","735589","733549","732048","734028","733548","734501","731547","732067","730548","731548","735568","731027","733020","733027","735020","730547","730560","730540","735580","731520","731508","733528","731020","733597","730007","733570","732008","733580","733590","760036","762037","762520","764503","760011","763001","763038","760507","762501","761501","760009","762017","761528","760001","760024","763037","760557","763517","762530","761047","762047","763567","760026","760538","761540","762548","761038","761028","762027","760518","760023","760035","761558","760016","764007","760010","760031","760006","761048","761030","762538","762517","760042","764504","762021","760034","761517","762547","764509","763527","763557","762018","760527","763578","761530","763021","760014","760004","760003","760044","760041","763520","762527","761520","764001","760517","760020","763049","763550","763538","762001","763008","760510","762008","762007","760547","762010","763558","762022","762537","763029","761037","761008","760550","763537","760030","764517","763048","763501","763047","761537","763042","760529","761001","762540","763028","763560","761007","761020","762040","763568","760002","763547","763027","760050","761040","763507","763532","763579","760508","761557","762510","763518","760040","764008","763533","761527","760015","760540","764507","760530","761567","760013","760528","760007","761550","761548","760548","762030","763577","760043","760022","760502","763010","763510","760033","761027","763022","763531","760045","760501","763023","763041","763508","763570","760021","760008","763539","760537","760520","761560","762528","760012","761547","764502","761507","764508","760025","760032","760046","764501","761508","763528","763030","763007","762507","761510","763017","970009","971007","973008","972047","973048","972048","970008","972007","970007","972008","970001","973047","971008","972040","973001","973007","990001","992009","991057","992001","991059","991007","991019","990009","991048","992017","992018","991009","995007","991001","992007","991049","991047","991038","990008","995008","991039","990007","990018","991008","991017","991027","992050","991018","991058","991029","992008","995009","991028","991037","990017"];return(g.indexOf(f)>-1)?true:("El "+translate("zipCode",true)+" no es válido")}});break;case"mexico":a=[{xtype:"displayfield",itemId:"mxAddressDisplayField",fieldLabel:translate("address",true),labelAlign:"right",labelPad:c,labelWidth:this.labelWidth,width:this.labelWidth,},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",align:"right",defaults:{xtype:"textfield"},items:[{xtype:"textfield",emptyText:translate("street",true),name:"street",width:115,allowBlank:true},{xtype:"textfield",emptyText:translate("exterior",true),name:"exteriorNumber",allowBlank:true,width:55,margin:"0 5"},{xtype:"textfield",emptyText:translate("interior",true),name:"interiorNumber",allowBlank:true,width:54}]},{xtype:"container",layout:"hbox",align:"right",margin:"5 0 0 0",defaults:{xtype:"textfield"},items:[{xtype:"textfield",emptyText:translate("colony",true),name:"colony",width:115,margin:"0 5 0 0",allowBlank:true},{xtype:"textfield",emptyText:translate("locality",true),name:"locality",width:114,allowBlank:true}]},{xtype:"container",margin:"5 0 0 0",layout:"hbox",align:"right",defaults:{xtype:"textfield"},items:[{xtype:"textfield",emptyText:translate("municipalityOrDelegation"),name:"municipality",allowBlank:true,width:115,margin:"0 5 0 0"},{xtype:"textfield",emptyText:translate("postalCode",true),name:"zipCode",allowBlank:this.allowEmptyZipCode,width:114,minLength:5,maxLength:5,regex:/^([0-9]+$)/}]},{xtype:"container",layout:"hbox",margin:"5 0",align:"right",defaults:{xtype:"textfield"},items:[{xtype:"textfield",emptyText:translate("state",true),name:"state",width:115,margin:"0 5 0 0",allowBlank:true},{xtype:"combo",emptyText:translate("country",true),id:"countryCombo",name:"country",width:114,store:"CountriesList",displayField:"name",valueField:"code",queryMode:"local",value:"MEX",editable:false,disabled:true,matchFieldWidth:false,listConfig:{width:250},validator:function(h,j){var g=this.up("form");var f=g.down("combo[name=thirdsType]");if(f){var k=f.getValue();if(k=="FOREIGN"){if(h=="MEX"||h==""||h=="México"){return"Debes seleccionar un pais diferente de México"}}}return true}}]}]}];break;case"argentina":a=[{xtype:"displayfield",name:"label",fieldLabel:translate("address",true),labelAlign:"right",labelPad:c,labelWidth:this.labelWidth,width:this.labelWidth,rowspan:5,isRequiredForElectronicInvoicing:["argentina"]},{xtype:"combo",name:"province",emptyText:this.placeholders==false?"":translate("department",true),allowBlank:true,store:"Provinces",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["argentina"],anyMatch:true,listeners:{change:function(m,l){var k=m.up("form");var f=k.down("addressField[name=addressComponent]");if(f){var j=f.down("combo[name=city]");if(m.getSelectedRecord()){j.enable();var g=j.getStore();var h=g.getProxy();h.setExtraParam("filters",Ext.encode({idProvince:m.getSelectedRecord()?m.getSelectedRecord().data.id:null}));g.load()}else{j.disable()}}}}},{xtype:"combo",name:"city",emptyText:this.placeholders==false?"":translate("city",true),allowBlank:true,store:"Cities",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["argentina"],disabled:true},{emptyText:this.placeholders==false?"":"Domicilio",name:"address",allowBlank:true,isRequiredForElectronicInvoicing:["argentina"],submitValue:false},{emptyText:this.placeholders==false?"":"Código postal",name:"postalCode",allowBlank:true}];break;case"chile":a=[{xtype:"displayfield",name:"label",fieldLabel:translate("address",true),labelAlign:"right",labelPad:c,labelWidth:this.labelWidth,width:this.labelWidth,rowspan:5,isRequiredForElectronicInvoicing:["chile"]},{xtype:"textfield",emptyText:this.placeholders==false?"":translate("address",true),name:"description",allowBlank:true,maxLength:200,colspan:2,width:d.fullWidth,isRequiredForElectronicInvoicing:["chile"],},{xtype:"combo",name:"region",emptyText:translate("region",true),allowBlank:true,store:"Regions",valueField:"value",displayField:"value",queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,colspan:2,minChars:0,width:d.fullWidth,isRequiredForElectronicInvoicing:["chile"],listeners:{change:function(m,l){var k=m.up("form");var f=k.down("addressField[name=addressComponent]");if(f){var j=f.down("combo[name=commune]");var g=j.getStore();var h=g.getProxy();h.setExtraParam("filters",Ext.encode({idRegion:m.getSelectedRecord()?m.getSelectedRecord().data.id:null}));g.load()}}}},{xtype:"combo",name:"commune",emptyText:this.placeholders==false?"":translate("commune",true),allowBlank:true,store:"Communes",minChars:0,valueField:"value",displayField:"value",queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,width:b,isRequiredForElectronicInvoicing:["chile"],listeners:{beforerender:function(h){var f=h.getStore();var g=f.getProxy();g.setExtraParam("filters",Ext.encode({idRegion:null}));f.load()}}},{xtype:"textfield",emptyText:this.placeholders==false?"":translate("city",true),name:"city",allowBlank:true,maxLength:50,width:b}];break;default:a.push({emptyText:this.placeholders==false?"":translate("address",true),name:"address",allowBlank:true,width:b,},{emptyText:this.placeholders==false?"":translate("city",true),name:"city",allowBlank:true,width:b,});break}this.add(a);if(Ext.Array.contains(["costaRica","colombia","argentina","chile"],e)){d.up("form").executeActionsBeforeRender()}},setValues:function(c){if(["costaRica","colombia","argentina","peru","mexico","chile"].indexOf(this.country)!==-1){c=c.addressObject}for(var a in c){var h=this.items.find(function(j){return j.name===a});if(h==null){h=this.query("[name="+a+"]")[0]}if(h){var f=h.xtype+"[name="+h.name+"]";var d=this.down(f);var g=c[a];if(d&&g){if(h.xtype==="combo"){var b=d.getStore();if(this.country=="costaRica"){g=AL.string.toCapitalizeFirstWord(g)}if(b.hasLoaded()){d.setValue(g)}else{var e={element:d,value:g};b.on("load",function(){if(this.element.store){this.element.setValue(this.value)}else{d.setValue(this.value)}},e)}}else{d.setValue(g)}}}}},getValues:function(){var a={};Ext.each(this.items.items,function(c){if(["textfield","combo"].indexOf(c.xtype)===-1){if(c.xtype=="container"){fields=c.query("textfield");for(var b=0;b<fields.length;b++){a[fields[b].name]=fields[b].getValue()}}else{return}}else{a[c.name]=c.getValue()}});return a},changeLabel:function(a){var b=this.down("displayfield[name=label]");b.setFieldLabel(a)},hideLabel:function(){var a=this.down("displayfield[name=label]");a.hide()},isValid:function(){var f=true;if(this.country==="argentina"){var b=this.down("combo[name=province]");var d=this.down("combo[name=city]");if(b.getValue()&&b.getValue()!=""&&!b.getSelectedRecord()){b.markInvalid("Selecciona una provincia de la lista");f=false}if(d.getValue()&&d.getValue()!=""&&!d.getSelectedRecord()){d.markInvalid("Selecciona una localidad de la lista");f=false}}else{if(this.country==="colombia"){var c=this.down("combo[name=country]");if(c&&c.getValue()&&c.getValue()!=""&&!c.getSelectedRecord()){c.markInvalid("Selecciona un "+translate("country")+" de la lista");f=false}else{if(!c||c.getValue()=="Colombia"){var d=this.down("combo[name=city]"),g=this.down("combo[name=department]");if(d.getValue()&&d.getValue()!=""&&!d.getSelectedRecord()){d.markInvalid("Selecciona un "+translate("municipality")+" de la lista");f=false}if(g.getValue()&&g.getValue()!=""&&!g.getSelectedRecord()){g.markInvalid("Selecciona "+translate("aDepartment")+" "+translate("department")+" de la lista");f=false}}}}else{if(this.country==="chile"){var a=this.down("combo[name=region]");var e=this.down("combo[name=commune]");if(a.getValue()&&a.getValue()!=""&&!a.getSelectedRecord()){a.markInvalid("Selecciona un "+translate("region")+" de la lista");f=false}if(e.getValue()&&e.getValue()!=""&&!e.getSelectedRecord()){e.markInvalid("Selecciona un "+translate("commune")+" de la lista");f=false}}}}return f},listeners:{beforerender:function(g){var f=g.up("form");var b=this.items.items;var e,d;for(var c=0;c<b.length;c++){e=b[c];if(e.initialConfig.excludeFrom){for(var a=0;a<e.initialConfig.excludeFrom.length;a++){d=e.initialConfig.excludeFrom[a];if(d.country==f.country&&g.componentView&&Ext.Array.contains(d.views,g.componentView)){g.remove(e);break}}}}}}});Ext.define("AL.view.ux.fields.Name",{extend:"Ext.panel.Panel",alias:"widget.nameField",border:false,layout:{type:"table",columns:3,tableAttrs:{},tdAttrs:{valign:"top"}},defaults:{margin:"0 0 10 5",},defaultType:"textfield",initComponent:function(){if(this.marginAllItems){this.defaults.margin=this.marginAllItems}var a=[{xtype:"displayfield",name:"label",fieldLabel:translate("name",true),labelAlign:"right",labelPad:14,labelWidth:this.labelWidth,width:this.labelWidth,allowBlank:false,id:"clientNameLabelField",rowspan:5},{blankText:translate("itIsNecessaryToAssign",true)+" "+translate("name")+" "+translate("toTheNewCustomer"),name:"name",allowBlank:false,allowOnlyWhitespace:false,colspan:2,width:this.fullWidth,id:"clientNameTextField",emptyText:this.placeholders==false?"":translate("name",true)},{blankText:translate("itIsNecessaryToAssign",true)+" "+translate("firstName")+" "+translate("toTheNewCustomer"),name:"firstName",allowBlank:true,emptyText:this.placeholders==false?"":translate("firstName",true)},{blankText:translate("itIsNecessaryToAssign",true)+" "+translate("secondName")+" "+translate("toTheNewCustomer"),name:"secondName",allowBlank:true,emptyText:this.placeholders==false?"":translate("secondName",true)},{blankText:translate("itIsNecessaryToAssign",true)+" "+translate("lastName")+" "+translate("toTheNewCustomer"),name:"lastName",allowBlank:true,colspan:2,width:this.fullWidth,emptyText:this.placeholders==false?"":translate("lastName",true)}];this.items=a;this.callParent()},setValues:function(b){for(var a in b){var c="set"+a.charAt(0).toUpperCase()+a.slice(1);if(typeof(this[c])===typeof(Function)){this[c](b[a])}}},changeLabel:function(a){var b=this.down("displayfield[name=label]");b.setFieldLabel(a)},changeVisibilitySpecificNameFields:function(a){a=a?a:false;var d=this.down("textfield[name=name]");var e=this.down("textfield[name=firstName]");var b=this.down("textfield[name=secondName]");var c=this.down("textfield[name=lastName]");if(a){d.allowBlank=true;d.allowOnlyWhitespace=true;d.hide();e.allowBlank=false;e.allowOnlyWhitespace=false;e.show();b.show();c.allowBlank=false;c.allowOnlyWhitespace=false;c.show()}else{d.allowBlank=false;d.allowOnlyWhitespace=false;d.show();e.allowBlank=true;e.allowOnlyWhitespace=true;e.hide();b.hide();c.allowBlank=true;c.allowOnlyWhitespace=true;c.hide()}},listeners:{beforerender:function(c){var b=c.up("form");var e=["company_WindowInfoEdit","company_FormInfoEdit"];if(b.country&&b.country==="colombia"&&e.indexOf(b.xtype)!==-1){var a=b.down("textfield[id=clientNameTextField]");var d=b.down("nameField[name=nameComponent]");a.blankText="Este campo es obligatorio";a.tooltip="Ingresa el nombre principal de tu empresa. Lo encuentras en la casilla 35 del RUT"}},afterrender:function(){var a=[this.down("textfield[name=firstName]"),this.down("textfield[name=secondName]"),this.down("textfield[name=lastName]")];Ext.each(a,function(b){b.hide()})}}});Ext.define("AL.model.RetentionApplied",{extend:"Ext.data.Model",fields:["idRetention","name","percentage","amount","description","date","associationText","associationUrl"]});Ext.define("AL.model.TaxApplied",{extend:"Ext.data.Model",fields:["idTax","name","tax","amount","description","date","associationText","associationUrl"]});Ext.define("AL.model.CreditNote",{extend:"Ext.data.Model",fields:["idLocal","name","idClient","identification",{name:"date",type:"date",dateFormat:"c"},"phone1","phone2","fax","mobile","observations","anotation","termsConditions","total","missingAmount","editable","deletable","voidable",{name:"status",type:"string",isEnum:true,values:{open:"Vigente","void":"Cancelada"}},"paymentMethod","accountNumber","decimalPrecision","subTotal","number","creditNoteNumber","currencySymbol","uuid","legalStatus","creditNoteTypeText","canPrintOrDownload","subDocumentTypeLetter",],proxy:{type:"ajax",method:"POST",api:{read:"/credit-note/retrieve-all/format/json",update:"data/updateItems.json",create:"/credit-note/add/format/json",destroy:"/credit-note/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.Invoice",{extend:"Ext.data.Model",fields:["prefix","number","idLocal","idClient",{name:"idInvoiceTemplate",type:"int"},"idResolution",{name:"decimalPrecision",type:"number"},{name:"invoiceNumber",type:"string"},{name:"name",type:"string"},{name:"identification",type:"string"},{name:"date",type:"date",dateFormat:"c"},{name:"dueDate",type:"date",dateFormat:"c"},{name:"phone1",type:"string"},{name:"phone2",type:"string"},{name:"fax",type:"string"},{name:"mobile",type:"string"},{name:"observations",type:"string"},{name:"termsConditions",type:"string"},{name:"paymentMethod",type:"string"},{name:"accountNumber",type:"string"},{name:"status",type:"string",isEnum:true,values:{open:translate("openInvoice",true),closed:translate("closedInvoice",true),"void":translate("voidInvoice",true),draft:translate("draft",true)}},{name:"subTotal",type:"number"},{name:"total",type:"number"},{name:"totalPayed",type:"number"},{name:"subTotal",type:"number"},{name:"missingAmount",type:"number"},"hasCreditNotes","payment","isOverdue","editable","voidable","deletable","openable","idPriceList","currencySymbol","uuid","mx_waitingToVoid","showSatMessage","warehouse","documentType","blockedAssociations","legalStatus","canPrintOrDownload","subDocumentTypeLetter","isVoidedByCreditNote","retentions","retentionsSuggested","hasRetentions","retentionsAreEditable",{name:"electronicInvoicingVersion",type:"string"},"idCostCenter"],proxy:{type:"ajax",method:"POST",api:{read:"/invoice/retrieve-all/format/json",update:"data/updateItems.json",create:"/invoice/add/format/json",destroy:"/Invoice/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.DebitNote",{extend:"Ext.data.Model",fields:["idLocal","name","idClient","identification",{name:"date",type:"date",dateFormat:"c"},"phone1","phone2","fax","mobile","observations","termsConditions","total","missingAmount","editable","deletable","decimalPrecision","number","subTotal","debitNoteNumber","currencySymbol","subDocumentTypeLetter",],proxy:{type:"ajax",method:"POST",api:{read:"/debit-note/retrieve-all/format/json",update:"data/updateItems.json",create:"/debit-note/add/format/json",destroy:"/debit-note/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.GroupingCode",{extend:"Ext.data.Model",fields:["key","name",{name:"keyAndName",convert:function(a,b){return b.data.key+" - "+b.data.name}}]});Ext.define("AL.view.category.FormAdd",{extend:"Ext.form.Panel",alias:"widget.category_FormAdd",title:"Agregar "+translate("category"),bodyPadding:5,width:350,layout:"anchor",defaults:{anchor:"100%"},defaultType:"textfield",items:[{fieldLabel:"Nombre de la "+translate("category"),name:"name",allowBlank:true},{xtype:"textarea",fieldLabel:"Descripción",name:"description",allowBlank:true},]});Ext.define("AL.view.category.CrudTree",{extend:"Ext.tree.Panel",alias:"widget.category_CrudTree",cls:"categories-tree",requires:["Ext.tree.*","Ext.data.*","Ext.tip.*"],showDetailsIcon:false,showCategoriesCode:"no",isStealth:"no",defaultSelected:null,title:translate("categories",true),rootVisible:false,store:"Categories",minHeight:151,viewConfig:{getRowClass:function(a,c,d,b){return"bg-yellow"},onDragDrop:function(a,b){console.log("enter")},stripeRows:true,overflowY:"auto",scroll:"vertical",plugins:{ptype:"treeviewdragdrop",},loadMask:true},initComponent:function(){if(this.configs.country=="mexico"){this.columns[2].hidden=false;if(this.showCategoriesCode=="yes"){this.columns[0].text=translate("categoryShort",true);this.columns[0].dataIndex="codeText"}}else{if(this.showCategoriesCode=="yes"){this.columns[0].text=translate("title",true);this.columns[0].dataIndex="codeText"}}if(this.isStealth=="yes"){this.columns[3].hidden=false}this.callParent(arguments)},columns:[{xtype:"treecolumn",text:translate("name",true),flex:2,sortable:true,dataIndex:"text"},{text:translate("description",true),flex:2,dataIndex:"description",sortable:true},{text:'Agrupador SAT <img id="satGroupingCodeTooltip" class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png" style="position: absolute; left: 100px;">',flex:2,sortable:true,dataIndex:"satGroupingCodeText",hidden:true},{text:"Regla",flex:2,dataIndex:"ruleName",hidden:true},{header:translate("actions",true),align:"center",type:"actions",width:120,renderer:function(g,k,d,e,j,h,f){var c='<div class="action-icons">',b=translate("category");if(this.showDetailsIcon){c+='</a><a href="/category/view/id/'+d.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail")+" title="+translate("seeDetail")+" "+translate("of")+" "+b+'" class="viewCategoryDetails" /></a>'}if(d.get("allowedToAdd")){c+='<img src="https://cdn1.getsoft.app/images/icons/add.png" alt="'+translate("add",true)+" sub-"+b+'" class="addCategoryAction" title="'+translate("add",true)+" sub-"+b+'"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/add.png" alt="'+translate("add",true)+" sub-"+b+'" class="disabled" title="'+translate("add",true)+" sub-"+b+'"/>'}if(d.get("isEditable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+b+'" class="editCategoryAction" title="'+translate("edit",true)+" "+b+'"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+b+'" class="disabled" title="'+translate("edit",true)+" "+b+'"/>'}var a="disabled";if(d.get("allowedToEdit")&&d.get("canChangeBlocked")){a="toggleCategoryBlocked"}if(d.get("blocked")=="yes"){c+='<img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" title="'+translate("activate",true)+" "+b+'" class="'+a+'" />'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" title="'+translate("deactivate",true)+" "+b+'" class="'+a+'" />'}if(d.get("isDeletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+" "+b+'" class="deleteCategoryAction" title="'+translate("remove",true)+" "+b+'"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+" "+b+'" class="disabled" title="'+translate("remove",true)+" "+b+'"/>'}c+="</div>";return c}}]});Ext.define("AL.view.category.GridRetentionsApplied",{extend:"Ext.grid.Panel",alias:"widget.category_GridRetentionsApplied",title:"",scroll:true,width:1024,border:true,frame:true,minHeight:390,store:"RetentionsApplied",columnLines:true,cls:"grid-category-retentions grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene "+translate("retentions")+" asociadas!</div></div></div>"},listeners:{afterrender:function(){var a=this.getStore();var b=a.getProxy();if(this.retainedByCompany){b.url="/retention/retrieve-all-applied-by-company/format/json"}else{b.url="/retention/retrieve-all-applied-to-company/format/json"}if(this.retentionReference!==""){b.extraParams={type:this.retentionReference}}a.load()}},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",flex:1,renderer:this.renderDate},{header:"Detalle",dataIndex:"associationText",flex:2,renderer:this.renderLink},{header:"Nombre",dataIndex:"name",flex:3},{header:translate("retention",true)+" (%)",dataIndex:"percentage",flex:1,renderer:this.renderPercentage,align:"right"},{header:"Valor",dataIndex:"amount",align:"right",flex:1,renderer:this.renderMoney}];this.callParent(arguments)},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="'+c.get("associationUrl")+'">'+f+"</a>"}return a},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderPercentage:function(e,f,b,g,d,c,a){if(e){return AL.math.approx(e,null,4)}}});Ext.define("AL.view.category.GridTaxesApplied",{extend:"Ext.grid.Panel",alias:"widget.category_GridTaxesApplied",title:"",scroll:true,width:1024,border:true,frame:true,minHeight:390,store:"TaxesApplied",columnLines:true,cls:"grid-category-taxes grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene impuestos asociadas!</div></div></div>"},listeners:{afterrender:function(){var a=this.getStore();var b=a.getProxy();if(this.appliedByCompany){b.url="/tax/retrieve-all-applied-by-company/format/json/ignoreLimit/true"}else{b.url="/tax/retrieve-all-applied-to-company/format/json/ignoreLimit/true"}if(this.taxReference!==""){b.extraParams={type:this.taxReference}}a.load()}},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",flex:1,renderer:this.renderDate},{header:"Detalle",dataIndex:"associationText",flex:3,renderer:this.renderLink},{header:"Nombre",dataIndex:"name",flex:3},{header:"Impuesto (%)",dataIndex:"tax",flex:1,align:"right"},{header:"Valor",dataIndex:"amount",align:"right",width:130,renderer:this.renderMoney}];this.callParent(arguments)},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="'+c.get("associationUrl")+'">'+f+"</a>"}return a},renderDate:function(f,j,c,d,h,g,e){var b=AL.date(f);var a='<a href="'+c.get("associationUrl")+'">'+Ext.Date.format(b,"d/m/Y")+"</a>";return a},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.store.RetentionsApplied",{extend:"Ext.data.Store",model:"AL.model.RetentionApplied",autoLoad:false,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",timeout:120000,url:"/retention/retrieve-all-applied/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.TaxesApplied",{extend:"Ext.data.Store",model:"AL.model.TaxApplied",autoLoad:false,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/tax/retrieve-all-applied/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CreditNotes",{extend:"Ext.data.Store",model:"AL.model.CreditNote",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/credit-note/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.Invoices",{extend:"Ext.data.Store",model:"AL.model.Invoice",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/invoice/retrieve-all/format/json",reader:{type:"json",root:"results"},timeout:120000},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Facturar], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.DebitNotes",{extend:"Ext.data.Store",model:"AL.model.DebitNote",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/debit-note/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt="+translate("print",true)+"], img[alt="+translate("seeDetail",true)+"], img[alt="+translate("addPayment",true)+"], img[alt=Convertir a Abierta], img[alt="+translate("edit",true)+"], img[alt="+translate("cancel",true)+"], img[alt="+translate("remove",true)+"]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.GroupingCodes",{extend:"Ext.data.Store",model:"AL.model.GroupingCode",autoLoad:false,proxy:{type:"ajax",url:"/category/retrieve-grouping-codes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.Contact",{extend:"Ext.data.Model",fields:["idLocal","name","lastName","idCliente","identification","phone","fax","mobile","address","email","observations","sendNotifications"],proxy:{type:"ajax",method:"POST",api:{read:"/contact/retrieveall/format/json",update:"data/updateItems.json",create:"/contact/add/format/json",destroy:"/client/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.Term",{extend:"Ext.data.Model",fields:["idLocal","name","days","deletable","editable"]});Ext.define("AL.model.PriceList",{extend:"Ext.data.Model",fields:["idLocal","name","main","status","dependent","percentage","editable","deletable","nameWithPercent"],idProperty:"idLocal"});Ext.define("AL.model.Seller",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"auto"},{name:"name",type:"string"},{name:"identification",type:"auto"},{name:"observations",type:"auto"},{name:"status",type:"auto"},{name:"editable",type:"auto"},{name:"deletable",type:"auto"}],idProperty:"idLocal"});Ext.define("AL.model.ClientStatement",{extend:"Ext.data.Model",fields:["idLocal","number","currencySymbol","currency","type",{name:"documentType",type:"string",isEnum:true,values:{invoice:translate("invoice",true),creditNote:translate("creditNote",true),advance:translate("advance",true),transactionIn:translate("transactionIn",true)}},{name:"status",type:"string",isEnum:true,values:{open:translate("unpaid",true),closed:translate("paid",true),apply:translate("unapplied",true),checkingPayment:translate("checkingPayment",true)}},{name:"date",type:"date",dateFormat:"c"},{name:"dueDate",type:"date",dateFormat:"c"},{name:"overdueDays",type:"number"},{name:"total",type:"number"},{name:"totalPaid",type:"number"},{name:"missingAmount",type:"number"},{name:"decimalPrecision",type:"number"},{name:"hasStamp",type:"string"}]});Ext.define("AL.model.CountryLegalParameter",{extend:"Ext.data.Model",fields:["id","key","value","code","abbreviature","rules","display","factor","name"]});Ext.define("AL.view.client.FormAdd",{extend:"Ext.form.Panel",requires:["AL.view.ux.fields.Address","AL.view.ux.fields.Name"],alias:"widget.client_FormAdd",title:translate("add",true)+" "+translate("clientA"),bodyPadding:30,style:"margin-bottom:10px",layout:"hbox",defaults:{msgTarget:"side"},documentType:null,listeners:{beforerender:function(b,j){if(this.configs&&this.configs.companySettings){var e=this.down("checkbox[name=statementAttached]");var f=this.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");if(typeof this.configs.companySettings.attachStatement!="undefined"&&e){e.setValue(this.configs.companySettings.attachStatement)}if(typeof this.configs.companySettings.sendMailWithDocumentAfterAcceptanceByGovernmentEntity!="undefined"&&f){f.setValue(this.configs.companySettings.sendMailWithDocumentAfterAcceptanceByGovernmentEntity)}}switch(this.clientType){case"client":var d=this.down("checkbox[name=isClient]");d.setValue(true);break;case"provider":var k=this.down("checkbox[name=isProvider]");k.setValue(true);break;default:break}if(this.hideLinkToComments){var g=this.down("[name=linkToComments]");if(g){g.hide()}}var a=this.down("container[name=rightContainer]");var c=Ext.ComponentQuery.query("client_FormAdd [name=paymentMethod]")[0];var l=Ext.ComponentQuery.query("client_FormAdd [name=paymentType]")[0];var h=[];if(!l){h.push({xtype:"combo",name:"paymentType",fieldLabel:translate("paymentMethod",true),displayField:"label",valueField:"value",labelAlign:"right",allowBlank:true,forceSelection:true,value:"",editable:false,emptyText:translate("selectSimple",true),labelPad:15,queryMode:"local",matchFieldWidth:true,countries:["mexico"],store:{fields:["label","value"],data:[{label:"Una sola exhibición",value:"PUE"},{label:"Parcialidades o Diferido",value:"PPD"}]}})}if(!c){h.push({xtype:"combo",name:"paymentMethod",fieldLabel:translate("paymentType",true),valueField:"paymentMethod",displayField:"display",allowBlank:true,forceSelection:true,value:"cash",editable:false,emptyText:translate("selectSimple",true),value:"",labelPad:15,queryMode:"local",matchFieldWidth:true,countries:["mexico"],store:Ext.create("AL.store.DocumentPaymentMethods",{country:b.country,stampVersion:b.stampVersion}),})}if(h.length>0){a.insert(0,h)}}},defaultType:"textfield",items:[{xtype:"container",name:"leftContainer",flex:1,defaults:{xtype:"textfield",labelAlign:"right",labelPad:15,width:395,msgTarget:"side",labelWidth:140},items:[{xtype:"nameField",name:"nameComponent",labelWidth:135,fullWidth:239,marginAllItems:"0 0 5 3",orders:[{colombia:4}]},{xtype:"combo",name:"thirdsType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("thirdsType",true),store:"TypeOfThirdsCombo",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:false,countries:["mexico"]},{xtype:"combo",name:"identificationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("identificationType",true),store:"IdentificationTypes",valueField:"key",displayField:"value",displayTpl:'<tpl for=".">{abbreviature} - {value}</tpl>',forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{abbreviature} - {value}</div></tpl>'},queryMode:"local",editable:true,countries:["peru","colombia","costaRica","argentina"],isRequiredForElectronicInvoicing:["colombia","argentina"],hidden:true,orders:[{colombia:0}]},{xtype:"panel",layout:"hbox",margin:"0 0 10 0",items:[{xtype:"container",name:"identificationLabelContainer",layout:{type:"hbox",pack:"end"},flex:1.15,items:[{xtype:"label",style:"min-width:40px;",cls:"x-form-item-label",name:"labelIdentification",text:translate("identification",true)}],listeners:{afterrender:function(a){var e=a.up("form");var c=a.down("label[name=labelIdentification]");var f=(typeof e.configs=="object")?e.configs.country:null;var d=(typeof e.configs=="object")?e.configs.isActiveElectronicInvoicing:null;var b=false;switch(f){case"colombia":b=(typeof d=="boolean")?d:false;break;case"peru":b=true;break;case"costaRica":if(d===true&&e.configs.electronicInvoicingVersion==="4.3"&&(!e.documentType||e.documentType==="invoice")){b=true}break;case"chile":if(d){b=true}break;default:b=false;break}if(b){c.getEl().dom.innerHTML=translate("identification",true)+'<span class="req">*</span>'}}}},{xtype:"container",name:"identificationFieldContainer",layout:{type:"hbox"},flex:1.48,items:[{xtype:"textfield",margin:"0 0 0 15",width:150,name:"identification",allowBlank:true,id:"clientIdentidicationTextField",isRequiredForElectronicInvoicing:["colombia","argentina"],orders:[{colombia:1}]}]},{xtype:"container",name:"identificationCoDvLabelContainer",layout:{type:"hbox",pack:"end"},flex:0.3,items:[{xtype:"box",cls:"x-form-item-label",html:'DV<span class="req">*</span>'}]},{xtype:"container",name:"identificationCoDvFieldContainer",layout:{type:"hbox"},flex:0.3,items:[{xtype:"textfield",margin:"0 0 0 15",width:19,name:"co_dv",regex:/^[0-9]*$/,maxLength:1,orders:[{colombia:2}]}]}]},{xtype:"textarea",name:"economicActivityName",fieldLabel:"Giro",labelAlign:"right",rows:2,labelPad:15,maxLength:40,labelWidth:140,tooltip:"Escribe la actividad económica que desarrolla el contacto",isRequiredForElectronicInvoicing:["chile"],countries:["chile"],hidden:true},{xtype:"textfield",name:"fiscalId",allowBlank:false,fieldLabel:"Id fiscal",queryMode:"local",countries:["mexico"],tooltip:"Identificación del proveedor en su país",hidden:true,},{xtype:"combo",name:"kindOfPerson",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("kindOfPerson",true),store:"KindsOfPerson",valueField:"id",displayField:"value",queryMode:"local",editable:false,hidden:true,orders:[{colombia:3}]},{xtype:"combo",name:"regime",fieldLabel:translate("regime",true),store:"Regimes",valueField:"key",displayField:"display",queryMode:"local",forceSelection:true,allowBlank:true,editable:false,hidden:true,matchFieldWidth:false,displayTpl:'<tpl for=".">{display}</tpl>',listConfig:{width:300,tpl:'<tpl for="."><div class="x-boundlist-item">{display}</div></tpl>'},},{xtype:"combo",name:"ivaCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Condición de IVA",store:"IvaConditions",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,countries:["argentina"],requires:["argentina"]},{xtype:"addressField",name:"addressComponent",fullWidth:237,labelWidth:132,marginAllItems:"0 0 8 5",allowEmptyZipCode:true,forClients:true},{fieldLabel:translate("electronicEmail",true),name:"email",allowBlank:true,id:"clientEmailField",regex:/(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)(?:,\s*(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*))*)?;\s*)/,invalidText:translate("thisFieldMustBeAnEmailAddressInTheFormat",true)},{fieldLabel:translate("phone",true)+" 1",name:"phone1",allowBlank:true,id:"clientPhoneTextField"},{fieldLabel:translate("phone",true)+" 2",name:"phone2",allowBlank:true},{fieldLabel:"Fax",name:"fax",allowBlank:true},{fieldLabel:translate("mobilePhone",true),name:"mobile",allowBlank:true}]},{xtype:"container",flex:1.1,name:"rightContainer",style:"margin-left:40px",defaults:{xtype:"textfield",labelAlign:"right",labelPad:15,labelWidth:140,width:360,msgTarget:"side"},items:[{xtype:"combo",name:"idPriceList",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("priceList",true),tooltip:translate("selectThePriceListYouWantToAssociateWithThisClient",true),store:"PriceListCombo",valueField:"idLocal",displayField:"name",queryMode:"local",editable:false},{xtype:"combo",name:"idSeller",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("seller",true),tooltip:translate("selectTheSellerYouWantToAssociateWithThisClient",true),store:"SellersCombo",valueField:"idLocal",displayField:"name",queryMode:"local",editable:false},{xtype:"combo",fieldLabel:translate("deadline",true),name:"idTerm",allowBlank:true,store:"Terms",displayField:"name",valueField:"idLocal",id:"clientTermsCombo",queryMode:"local",editable:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewTerm" class="createNewTerm">'+translate("newTerm",true)+"</a></div>"}},{xtype:"combo",name:"CFDIuse",fieldLabel:"Uso CFDI",displayField:"name",valueField:"code",store:"CFDIUseList",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),tooltip:"Selecciona el uso que el cliente le dará a las "+translate("invoices"),allowBlank:true,hidden:true,matchFieldWidth:false,listConfig:{width:350}},{xtype:"checkbox",name:"isClient",inputValue:"yes",fieldLabel:translate("clientA",true),id:"clientIsClientCheckBox"},{xtype:"checkbox",name:"isProvider",inputValue:"yes",fieldLabel:translate("supplier",true)},{xtype:"combo",name:"operationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Tipo de operación",store:"OperationTypes",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,countries:["mexico"]},{xtype:"textarea",fieldLabel:translate("observations",true),name:"observations",allowBlank:true,id:"clientObservationsTextArea",hidden:true},{xtype:"checkboxfield",name:"statementAttached",inputValue:"yes",fieldLabel:translate("includeAccountStatus",true),tooltip:translate("yourClientWillReceiveHisAccountStatementOnEachInvoice",true)},{xtype:"checkboxfield",name:"sendMailWithDocumentAfterAcceptanceByGovernmentEntity",inputValue:"yes",fieldLabel:"Enviar documentos electrónicos",tooltip:"Tu cliente recibirá sus documentos electrónicos después de que sean aceptados por "+translate("theGovernmentEntity")+" "+translate("governmentEntity"),countries:["peru","argentina","costaRica","colombia"],countriesStampValidate:true,},{xtype:"checkboxfield",name:"cr_isBeneficiaryOfExoneration",inputValue:true,fieldLabel:"Beneficiario de exoneración",tooltip:"Marca está casilla si tu cliente es beneficiario de exoneración de impuestos",hidden:true,},{xtype:"combo",name:"cr_exonerationDocumentType",tooltip:"Indica el tipo de documento que autoriza al cliente como exonerado",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Tipo de documento",store:"ExonerationDocumentTypes",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,requires:["costaRica"]},{fieldLabel:"Número de documento",name:"cr_exonerationDocumentNumber",tooltip:"Número del documento que autoriza al cliente como exonerado",maxLength:17,allowBlank:true,hidden:true,requires:["costaRica"]},{xtype:"datefield",fieldLabel:"Fecha de emisión del documento",tooltip:"Fecha en la que se emitió el documento que autoriza al cliente como exonerado",name:"cr_exonerationDocumentDate",format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true,requires:["costaRica"]},{xtype:"panel",name:"responsabilitiesPanel",hidden:true,items:[{xtype:"box",style:"border-top: 1px solid rgb(208, 208, 208);margin-top: 20px;",html:'<div style="color: #1A5E53;font-size: 16px;">Responsabilidades</div>',width:450,padding:"20 0 10 20"},{xtype:"editableListModalComponent",name:"responsabilitiesComponent",width:450,padding:"0 0 10 20",displayField:"value",valueField:"id",emptyMessage:"Aún no has agregado ninguna responsabilidad.",modalConfig:{title:"Responsabilidades fiscales",descriptionText:"Selecciona las responsabilidades, calidades y atributos que aparecen en la parte inferior del RUT de tu cliente.",dynamicField:{fieldLabel:"Responsabilidad",labelWidth:140,labelAlign:"right",width:390},addDynamicFieldButton:{text:"Agregar nueva responsabilidad",icon:'<svg class="icon" style="color:#00B19D;height:15px;"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'}},storeConfig:{name:"FiscalResponsabilities",autoLoad:true}}]}]}],getFieldValuesAsMetadata:function(){var o=this.configs&&this.configs.country?this.configs.country:null;var h=this.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");var n={settings:{sendMailWithDocumentAfterAcceptanceByGovernmentEntity:h.getValue()}};switch(o){case"costaRica":var m=this.down("checkboxfield[name=cr_isBeneficiaryOfExoneration]");if(m.checked){var d=this.down("combo[name=cr_exonerationDocumentType]");var f=this.down("textfield[name=cr_exonerationDocumentNumber]");var k=this.down("textfield[name=cr_exonerationDocumentDate]");n.exemptionDocument={type:d.getValue(),number:f.getValue(),date:k.getValue(),}}break;case"argentina":var b=this.down("combo[name=ivaCondition]");n.ivaCondition=b.getValue();break;case"mexico":var r=false;var p=this.down("combo[name=thirdsType]");var g=this.down("combo[name=operationType]");var a=this.down("textfield[name=fiscalId]");var j=this.down("checkbox[name=isProvider]");if(p){if(p.getValue()){n.thirdsType=p.getValue()}}if(g){if(g.getValue()){if(j.getValue()){n.operationType=g.getValue()}else{n.operationType=" "}}}if(a){if(a.getValue()){n.fiscalId=a.getValue()}}var e=this.down("combo[name=paymentMethod]");var q=this.down("combo[name=paymentType]");if(q&&q.getValue()){n.paymentType=q.getValue()}if(e&&e.getValue()){n.paymentMethod=e.getValue()}break;case"colombia":var l=this.down("editableListModalComponent[name=responsabilitiesComponent]");n.fiscalResponsabilities=l.getElements();break;case"chile":var c=this.down("textfield[name=economicActivityName]");n={economicActivityName:c.getValue()};break}return n},setFieldValuesFromMetadata:function(n){var o=this.configs&&this.configs.country?this.configs.country:null;if(typeof n.settings!=="undefined"){var g=n.settings;if(typeof g.sendMailWithDocumentAfterAcceptanceByGovernmentEntity!=="undefined"){var j=this.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");j.setValue(g.sendMailWithDocumentAfterAcceptanceByGovernmentEntity)}}switch(o){case"costaRica":var m=this.down("checkboxfield[name=cr_isBeneficiaryOfExoneration]");if(n.exemptionDocument){m.setValue(true);if(typeof n.exemptionDocument.type!=="undefined"){var d=this.down("combo[name=cr_exonerationDocumentType]");d.setValue(n.exemptionDocument.type)}if(typeof n.exemptionDocument.number!=="undefined"){var f=this.down("textfield[name=cr_exonerationDocumentNumber]");f.setValue(n.exemptionDocument.number)}if(typeof n.exemptionDocument.date!=="undefined"&&n.exemptionDocument.date!=""){var k=this.down("textfield[name=cr_exonerationDocumentDate]");k.setValue(n.exemptionDocument.date)}}else{m.setValue(false)}break;case"argentina":if(typeof n.ivaCondition!=="undefined"){var b=this.down("combo[name=ivaCondition]");var q=b.getStore();if(q.hasLoaded()){b.setValue(n.ivaCondition)}else{q.on("load",function(s){b.setValue(n.ivaCondition)})}}break;case"mexico":if(typeof n.thirdsType!=="undefined"){var p=this.down("combo[name=thirdsType]");if(p){p.setValue(n.thirdsType)}}if(typeof n.operationType!=="undefined"){var h=this.down("combo[name=operationType]");if(h){h.setValue(n.operationType.trim())}}if(typeof n.fiscalId!=="undefined"){var a=this.down("textfield[name=fiscalId]");if(a){a.setValue(n.fiscalId)}}if(typeof n.paymentType!=="undefined"){var r=this.down("combo[name=paymentType]");r.setValue(n.paymentType)}if(typeof n.paymentMethod!=="undefined"){var e=this.down("combo[name=paymentMethod]");e.setValue(n.paymentMethod.toLowerCase())}break;case"colombia":if(typeof n.fiscalResponsabilities!=="undefined"){var l=this.down("editableListModalComponent[name=responsabilitiesComponent]");var q=l.getStore();if(q.hasLoaded()){l.setElements(n.fiscalResponsabilities)}else{q.load({callback:function(){l.setElements(n.fiscalResponsabilities)}})}}break;case"chile":if(typeof n.economicActivityName!=="undefined"){var c=this.down("textfield[name=economicActivityName]");c.setValue(n.economicActivityName)}break}}});Ext.define("AL.view.client.FormAddContact",{extend:"Ext.form.Panel",alias:"widget.client_FormAddContact",bodyPadding:5,style:"border-bottom: 1px solid #eee; padding-top: 5px;",border:false,layout:"hbox",defaults:{anchor:"100%",msgTarget:"side",},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{name:"name",allowBlank:true,width:150,emptyText:translate("name",true)},{name:"lastName",allowBlank:true,emptyText:translate("lastName",true),width:150,cls:"itemInput"},{name:"email",allowBlank:true,emptyText:translate("electronicEmail",true),width:220,cls:"itemInput",regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:translate("thisFieldMustBeAnEmailAddressInTheFormat",true)},{name:"phone",allowBlank:true,emptyText:translate("phone",true),width:150,cls:"itemInput"},{name:"mobile",allowBlank:true,emptyText:translate("mobilePhone",true),width:150,cls:"itemInput"},{xtype:"checkbox",inputValue:"yes",name:"sendNotifications",width:30,style:"margin-left: 50px"},{xtype:"button",action:"deleteContact",width:16,height:16,style:"margin-left: 45px",baseCls:"none"}]});Ext.define("AL.view.invoice.WindowPrint",{extend:"Ext.window.Window",id:"window-print",bodyPadding:35,style:"background: #fff",bodyStyle:"background: #fff",title:"Cambio de estado en "+translate("invoice"),autoShow:true,modal:true,pdfType:"original",layout:{type:"vbox",align:"center"},items:[{xtype:"container",style:"margin-bottom:15px",html:translate("theInvoice")+" "+translate("invoice")+" se ha convertido a "+translate("openInvoice")+" exitosamente."},{xtype:"button",text:"Imprimir",listeners:{click:function(a){var d=a.up("window").idLocal;var b=a.up("window").pdfType;window.open("/invoice/print/id/"+d+"/type/"+b);var c=a.up("window");c.destroy()}}}],listeners:{destroy:function(){window.location.reload()}}});Ext.define("AL.view.client.MoreActionsButton",{extend:"Ext.button.Split",alias:"client_MoreActionsButton",text:translate("moreActions",true),cls:"button2",padding:"1 5 8 5",hiddenStatement:false,handler:function(){this.showMenu()},initComponent:function(){this.menu.items=[{text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile"},{text:translate("see",true)+" "+translate("statementWC"),id:"viewStatement",action:"viewStatement",href:"/client/statement/id/"+this.idType,hidden:this.hiddenStatement=="yes"?true:false}];this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.view.client.FormAddRetentions",{extend:"Ext.form.Panel",alias:"widget.client_FormAddRetentions",bodyPadding:"5",border:false,items:[{xtype:"textfield",style:"display:inline-block",name:"retention",emptyText:"Nombre de "+translate("retention"),allowBlank:false},{xtype:"textfield",style:"display:inline-block;margin-left:10px",regex:/^([0-9]+(\.[0-9]+)?)$/,emptyText:"Monto",name:"amount",allowBlank:false},{xtype:"button",action:"deleteRetention",height:16,width:16,style:"margin-left: 40px; float: right; position: absolute; left: 282px; top:8px; cursor:pointer;",baseCls:"none",handler:function(a){var b=a.up("form");b.destroy()}}]});Ext.define("AL.view.client.PositiveBalances",{extend:"Ext.form.Panel",alias:"widget.client_PositiveBalances",border:false,id:"positive-balances",transaction:null,hidden:true,defaults:{},configs:{showBalanceAdvances:true,showBalanceCreditNotes:true},items:[{xtype:"displayfield",name:"title",cls:"text-body",fieldCls:"text"}]});Ext.define("AL.view.client.NequiPaymentWindow",{extend:"Ext.panel.Panel",alias:"widget.client_NequiPaymentWindow",width:480,height:480,floating:true,border:false,shadow:"frame",shadowOffset:40,modal:true,style:"border-radius: 10px; opacity: 0;",currentContainer:"info",windowTransitionTime:100,containerTransitionTime:300,containerSwitchTime:3000,amount:0,qrCode:"",decimalPrecision:2,currencySymbol:"$",verifying:false,verificationUrl:"",idInvoice:null,refreshTime:15000,refreshTimer:null,verifyingInBackground:false,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:"hbox",flex:0.12,style:"border-bottom: 1px solid #F2F2F2;",items:[{xtype:"container",layout:"hbox",flex:0.5,items:[{xtype:"label",text:"Paga con Nequi",margin:"17 0 0 31",style:"font-family: 'Roboto', sans-serif; font-weight: normal; font-size: 24px; color: #00B19D;"}]},{xtype:"container",layout:{type:"hbox",pack:"end"},flex:0.5,items:[{xtype:"box",html:'<svg class="icon big pay-with-nequi-close-button"><use xlink:href="/images/smile-icons.svg#close"></use></svg>',margin:"18 18 0 0",listeners:{render:function(b){var a=this.up("client_NequiPaymentWindow");b.getEl().on("click",function(c){a.fadeOut()})}}}]}]},{xtype:"container",name:"info",layout:{type:"vbox",align:"stretch"},flex:0.7,items:[{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"box",margin:"17 0 0 0"}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",name:"totalAmount",margin:"22 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 20px; color: #00B19D;"}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",margin:"16 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 16px; color: #595959;",html:'Escanea este código con tu app&nbsp;&nbsp;<img width="80" height="21" src="https://cdn1.getsoft.app/images/logo-nequi-header.png" alt="NEQUI" style="vertical-align: middle;" />'}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",margin:"8 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 12px; color: #808080; text-align: center;",html:'¿Sin cuenta de Nequi?&nbsp;&nbsp;Créala en <a class="pay-with-nequi-link" href="https://www.nequi.com.co/#4" target="_blank">www.nequi.com.co</a><br>Puedes descargar la app de Nequi <a class="pay-with-nequi-link" href="http://tiendas.nequi.co/?utm_source=alegra%20web&utm_medium=organic" target="_blank">aquí</a>.'}]}]},{xtype:"container",name:"pendingPayment",layout:{type:"vbox",align:"stretch"},flex:0.7,hidden:true,items:[{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"box",margin:"50 0 0 0",html:'<svg class="icon big" style="width: 158px; height: 158px; color: #F99D36;"><use xlink:href="/images/smile-icons.svg#info-outline"></use></svg>'}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",margin:"14 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 16px; color: #595959;",html:"Pago en estado pendiente"}]}]},{xtype:"container",name:"successfulPayment",layout:{type:"vbox",align:"stretch"},flex:0.7,hidden:true,items:[{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"box",margin:"50 0 0 0",html:'<svg class="icon big" style="width: 158px; height: 158px; color: #00C3AD;"><use xlink:href="/images/smile-icons.svg#success-outline"></use></svg>'}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",margin:"16 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 16px; color: #595959;",html:'Pago exitoso en&nbsp;&nbsp;<img width="80" height="21" src="https://cdn1.getsoft.app/images/logo-nequi-header.png" alt="NEQUI" style="vertical-align: middle;" />'}]},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"label",name:"paymentReference",margin:"14 0 0 0",style:"font-family: 'Roboto', sans-serif; font-size: 14px; color: #808080;",html:"Referencia de pago"}]}]},{xtype:"container",layout:{type:"hbox",pack:"end"},flex:0.14,style:"border-top: 1px solid #F2F2F2;",items:[{xtype:"box",html:'<button class="pay-with-nequi-cancel-button">Cancelar</button>',margin:"13 14 0 0",padding:"2 2 2 2",listeners:{render:function(b){var a=this.up("client_NequiPaymentWindow");b.getEl().on("click",function(c){a.fadeOut()})}}},{xtype:"box",html:'<button id="verifyButton" class="pay-with-nequi-verify-button">Verificar</button>',margin:"13 17 0 0",padding:"2 2 2 2",listeners:{render:function(a){var b=a.up("client_NequiPaymentWindow");a.getEl().on("click",function(d){if(b.verifying){return}b.verifying=true;var c=Ext.get("verifyButton").el.dom;c.setAttribute("disabled","");c.innerText="Verificando...";Ext.Ajax.request({url:b.verificationUrl,method:"POST",params:{origin:window.location.href,idInvoice:b.idInvoice},success:function(e,f){var h=Ext.decode(e.responseText);if(h.success){if(h.reference==""){window.location.reload();c.innerText="Verificar";c.removeAttribute("disabled");b.verifying=false}else{var g=b.down("[name=paymentReference]");g.update("Referencia de pago "+h.reference);b.switchContainer("successfulPayment",function(){c.innerText="Verificar";setTimeout(function(){window.location.reload();c.removeAttribute("disabled");b.verifying=false},b.containerSwitchTime)})}}else{switch(h.status){case"pending":b.switchContainer("pendingPayment",function(){c.innerText="Verificar";setTimeout(function(){b.switchContainer("info",function(){c.removeAttribute("disabled");b.verifying=false})},b.containerSwitchTime)});break;case"expired":case"rejected":b.fadeOut();Ext.Msg.alert("",h.cause);break;default:Ext.Msg.alert("",h.cause);c.innerText="Verificar";c.removeAttribute("disabled");b.verifying=false;break}}},failure:function(e,f){c.innerText="Verificar";c.removeAttribute("disabled");b.verifying=false;Ext.Msg.alert("","Ha ocurrido un error, no se pudo verificar el estado del pago")}})})}}}]}],listeners:{afterrender:function(a){if(a.refreshTime==0){return}a.refreshTimer=setInterval(function(){if(a.verifyingInBackground||a.verifying){return}a.verifyingInBackground=true;Ext.Ajax.request({url:a.verificationUrl,method:"POST",params:{origin:window.location.href,idInvoice:a.idInvoice},success:function(b,d){var f=Ext.decode(b.responseText);if(f.success){var c=Ext.get("verifyButton").el.dom;c.setAttribute("disabled","");if(f.reference==""){if(f.expiredOrCanceled){a.fadeOut();Ext.Msg.alert("","La transacción ha expirado o ha sido rechazada")}else{window.location.reload()}}else{var e=a.down("[name=paymentReference]");e.update("Referencia de pago "+f.reference);a.switchContainer("successfulPayment",function(){setTimeout(function(){window.location.reload()},a.containerSwitchTime)})}}else{a.verifyingInBackground=false}},failure:function(b,c){a.verifyingInBackground=false}})},a.refreshTime)}},initComponent:function(){this.items[1].items[0].items[0].html='<img id="qrCode" class="pay-with-nequi-qr-code" width="195" height="195" src="/client/nequi-qr-code?qrcode='+this.qrCode+"&origin="+window.location.href+'" alt="QR Code" />';this.items[1].items[1].items[0].html="Total "+Ext.util.Format.usMoney(this.amount,this.decimalPrecision,this.currencySymbol);this.callParent(arguments)},switchContainer:function(c,e){var b=this.down("[name="+this.currentContainer+"]");var a=this.down("[name="+c+"]");var d=this.containerTransitionTime;this.currentContainer=c;Ext.create("Ext.fx.Anim",{target:b,duration:this.containerTransitionTime,from:{opacity:1},to:{opacity:0},callback:function(){b.hide();a.show();Ext.create("Ext.fx.Anim",{target:a,duration:d,from:{opacity:0},to:{opacity:1},callback:e})}})},fadeIn:function(){var b=this;var a=b.windowTransitionTime;b.show();Ext.create("Ext.fx.Anim",{target:b,duration:a,from:{opacity:0},to:{opacity:1}})},fadeOut:function(){var b=this;var a=b.windowTransitionTime;clearInterval(b.refreshTimer);Ext.create("Ext.fx.Anim",{target:b,duration:a,from:{opacity:1},to:{opacity:0},callback:function(){b.close()}})}});Ext.define("AL.view.ux.fields.EditableListModal",{extend:"Ext.panel.Panel",alias:"widget.editableListModalComponent",width:"100%",items:[],initComponent:function(){var a=this;if(!a.storeObject){a.storeObject=Ext.create("AL.store."+a.storeConfig.name);if(a.storeConfig.autoLoad===true){a.storeObject.load()}}var b=function(e){if(!a.elements){return}var c={};if(a.modalConfig.descriptionText){c={xtype:"box",html:'<div class="sublabel" style="font-size: 12px;text-align: center;">'+a.modalConfig.descriptionText+"</div>",}}var f=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,width:520,title:a.modalConfig.title,bodyStyle:"background: transparent",padding:"5px 20px 20px 20px",items:[c,{xtype:"panel",name:"dynamicFieldsPanel",padding:"20 20 0 20",items:[]},{xtype:"button",text:(a.modalConfig.addDynamicFieldButton.icon||"")+a.modalConfig.addDynamicFieldButton.text,cls:"sm-button-clear sm-button-clear-without-hover",style:"float:right;border-width: 1px;right: 20px; background: rgba(255, 255, 255) !important;",handler:function(g){g.up("window").createDynamicField()}}],footer:{items:[{text:"Cancelar",handler:function(){this.up("window").close()},cls:"button",},{cls:"button main-button",text:"Guardar",margin:"0 28 0 0",handler:function(h){var l=h.up("window");var g=[];var j=l.down("panel[name=dynamicFieldsPanel]");var k=true;j.items.items.forEach(function(n){var p=n.down("combo");var m=p.getSelectedRecord();if(m){g.push(m.data[a.valueField])}else{var o=p.getValue()&&p.getValue()!=""?"El valor ingresado no coincide con ningún elemento de la lista":"Debes seleccionar un elemento de la lista";p.markInvalid(o);k=false}});if(k===true){a.setElements(g);l.destroy()}}}]},createDynamicField:function(g){var h=this.down("panel[name=dynamicFieldsPanel]");h.add({xtype:"panel",style:"position:relative;",items:[{xtype:"combo",name:"EditableListModalElement-"+h.items.length,emptyText:"Buscar...",fieldLabel:a.modalConfig.dynamicField.fieldLabel,labelWidth:a.modalConfig.dynamicField.labelWidth,labelAlign:a.modalConfig.dynamicField.labelAlign,width:a.modalConfig.dynamicField.width,allowBlank:false,valueField:a.valueField,displayField:a.displayField,value:g||null,forceSelection:true,autoSelect:false,queryMode:"local",queryParam:"value",store:Ext.create("AL.store."+a.storeConfig.name,{autoLoad:true}),listConfig:{loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>'},listeners:{beforerender:function(k){var j=k.getStore();var l=k.name;if(j.hasLoaded()){k.setValue(g)}else{j.on("load",function(){var m=Ext.ComponentQuery.query("combo[name="+l+"]")[0];if(m){m.setValue(g)}})}}}},{xtype:"button",height:16,width:16,style:"position: absolute; right:15px; top:3px; cursor:pointer;",baseCls:"none",handler:function(k){var j=k.up("panel");j.destroy()}}]})}});if(a.elements.length<=0){f.createDynamicField()}else{for(var d=0;d<a.elements.length;d++){f.createDynamicField(a.elements[d])}}};a.items=[{xtype:"box",name:"emptyMessage",html:a.emptyMessage},{xtype:"panel",border:false,name:"list",items:[]},{xtype:"button",name:"addElementsToList",text:'<svg class="icon" style="color:#00B19D;height:15px;"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>Agregar',cls:"sm-button-outline sm-button-outline-secondary",style:"border-color: #00B19D !important;color: #00B19D !important;",padding:10,margin:"10 0 0 0",hidden:true,listeners:{click:b}},{xtype:"button",name:"editList",text:'<svg class="icon" style="color:#00B19D;height:15px;"><use xlink:href="/images/smile-icons.svg#edit"></use></svg>Editar',cls:"sm-button-outline sm-button-outline-secondary",style:"border-color: #00B19D !important;color: #00B19D !important;",padding:10,margin:"10 0 0 0",hidden:true,listeners:{click:b}}];a.callParent();a.setElements([])},setElements:function(a){a=a||[];this.elements=a;this.renderElements()},getElements:function(){return this.elements},renderElements:function(){var c=this;var a=this.down("box[name=emptyMessage]");var b=this.down("box[name=editList]");var e=this.down("box[name=addElementsToList]");var d=this.down("panel[name=list]");d.removeAll();if(this.elements.length<=0){a.show();b.hide();e.show();return}a.hide();b.show();e.hide();this.elements.forEach(function(g){var f=c.getStore().findRecord(c.valueField,g);var h=g;if(f){h=f.data[c.displayField]}d.add({xtype:"box",html:h})})},isValid:function(){var a=true;if(this.allowBlank===false&&this.elements.length<=0){a=false}return a},getStore:function(){return this.storeObject}});Ext.define("AL.store.Contacts",{extend:"Ext.data.Store",model:"AL.model.Contact",proxy:{type:"ajax",url:"/contact/retrieveall/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Terms",{extend:"Ext.data.Store",model:"AL.model.Term",autoLoad:false,data:[],proxy:{type:"ajax",url:"/term/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.PriceListCombo",{extend:"Ext.data.Store",model:"AL.model.PriceList",autoLoad:false,proxy:{type:"ajax",url:"/price-list/retrieve-all-active/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.SellersCombo",{extend:"Ext.data.Store",model:"AL.model.Seller",autoLoad:false,proxy:{type:"ajax",url:"/seller/retrieve-all-active/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.PurchaseOrders",{extend:"Ext.data.Store",model:"AL.model.PurchaseOrder",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/purchase-order/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.ClientStatement",{extend:"Ext.data.Store",model:"AL.model.ClientStatement",autoLoad:false,proxy:{type:"ajax",url:"retrieve-statement/id/",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CountriesList",{extend:"Ext.data.Store",fields:["code","name"],data:[{code:"AFG",name:"Afghanistan"},{code:"ALA",name:"Åland Islands"},{code:"ALB",name:"Albania"},{code:"DZA",name:"Algeria"},{code:"ASM",name:"American Samoa"},{code:"AND",name:"Andorra"},{code:"AGO",name:"Angola"},{code:"AIA",name:"Anguilla"},{code:"ATA",name:"Antarctica"},{code:"ATG",name:"Antigua and Barbuda"},{code:"ARG",name:"Argentina"},{code:"ARM",name:"Armenia"},{code:"ABW",name:"Aruba"},{code:"AUS",name:"Australia"},{code:"AUT",name:"Austria"},{code:"AZE",name:"Azerbaijan"},{code:"BHS",name:"Bahamas"},{code:"BHR",name:"Bahrain"},{code:"BGD",name:"Bangladesh"},{code:"BRB",name:"Barbados"},{code:"BLR",name:"Belarus"},{code:"BEL",name:"Belgium"},{code:"BLZ",name:"Belize"},{code:"BEN",name:"Benin"},{code:"BMU",name:"Bermuda"},{code:"BTN",name:"Bhutan"},{code:"BOL",name:"Bolivia"},{code:"BES",name:"Bonaire, Sint Eustatius and Saba"},{code:"BIH",name:"Bosnia and Herzegovina"},{code:"BWA",name:"Botswana"},{code:"BVT",name:"Bouvet Island"},{code:"BRA",name:"Brasil"},{code:"IOT",name:"British Indian Ocean Territory"},{code:"BRN",name:"Brunei Darussalam"},{code:"BGR",name:"Bulgaria"},{code:"BFA",name:"Burkina Faso"},{code:"BDI",name:"Burundi"},{code:"KHM",name:"Cambodia"},{code:"CMR",name:"Cameroon"},{code:"CAN",name:"Canada"},{code:"CPV",name:"Cape Verde"},{code:"CYM",name:"Cayman Islands"},{code:"CAF",name:"Central African Republic"},{code:"TCD",name:"Chad"},{code:"CHL",name:"Chile"},{code:"CHN",name:"China"},{code:"CXR",name:"Christmas Island"},{code:"CCK",name:"Cocos (Keeling) Islands"},{code:"COL",name:"Colombia"},{code:"COM",name:"Comoros"},{code:"COG",name:"Congo"},{code:"COD",name:"Congo, the Democratic Republic of the"},{code:"COK",name:"Cook Islands"},{code:"CRI",name:"Costa Rica"},{code:"CIV",name:"Côte d'Ivoire"},{code:"HRV",name:"Croatia"},{code:"CUB",name:"Cuba"},{code:"CUW",name:"Curaçao"},{code:"CYP",name:"Cyprus"},{code:"CZE",name:"Czech Republic"},{code:"DNK",name:"Denmark"},{code:"DJI",name:"Djibouti"},{code:"DMA",name:"Dominica"},{code:"DOM",name:"República Dominicana"},{code:"ECU",name:"Ecuador"},{code:"EGY",name:"Egypt"},{code:"SLV",name:"El Salvador"},{code:"GNQ",name:"Equatorial Guinea"},{code:"ERI",name:"Eritrea"},{code:"EST",name:"Estonia"},{code:"ETH",name:"Ethiopia"},{code:"FLK",name:"Falkland Islands (Malvinas)"},{code:"FRO",name:"Faroe Islands"},{code:"FJI",name:"Fiji"},{code:"FIN",name:"Finland"},{code:"FRA",name:"France"},{code:"GUF",name:"French Guiana"},{code:"PYF",name:"French Polynesia"},{code:"ATF",name:"French Southern Territories"},{code:"GAB",name:"Gabon"},{code:"GMB",name:"Gambia"},{code:"GEO",name:"Georgia"},{code:"DEU",name:"Germany"},{code:"GHA",name:"Ghana"},{code:"GIB",name:"Gibraltar"},{code:"GRC",name:"Greece"},{code:"GRL",name:"Greenland"},{code:"GRD",name:"Grenada"},{code:"GLP",name:"Guadeloupe"},{code:"GUM",name:"Guam"},{code:"GTM",name:"Guatemala"},{code:"GGY",name:"Guernsey"},{code:"GIN",name:"Guinea"},{code:"GNB",name:"Guinea-Bissau"},{code:"GUY",name:"Guyana"},{code:"HTI",name:"Haiti"},{code:"HMD",name:"Heard Island and McDonald Islands"},{code:"VAT",name:"Holy See (Vatican City State)"},{code:"HND",name:"Honduras"},{code:"HKG",name:"Hong Kong"},{code:"HUN",name:"Hungary"},{code:"ISL",name:"Iceland"},{code:"IND",name:"India"},{code:"IDN",name:"Indonesia"},{code:"IRN",name:"Iran, Islamic Republic of"},{code:"IRQ",name:"Iraq"},{code:"IRL",name:"Ireland"},{code:"IMN",name:"Isle of Man"},{code:"ISR",name:"Israel"},{code:"ITA",name:"Italy"},{code:"JAM",name:"Jamaica"},{code:"JPN",name:"Japan"},{code:"JEY",name:"Jersey"},{code:"JOR",name:"Jordan"},{code:"KAZ",name:"Kazakhstan"},{code:"KEN",name:"Kenya"},{code:"KIR",name:"Kiribati"},{code:"PRK",name:"Korea, Democratic People's Republic of"},{code:"KOR",name:"Korea, Republic of"},{code:"KWT",name:"Kuwait"},{code:"KGZ",name:"Kyrgyzstan"},{code:"LAO",name:"Lao People's Democratic Republic"},{code:"LVA",name:"Latvia"},{code:"LBN",name:"Lebanon"},{code:"LSO",name:"Lesotho"},{code:"LBR",name:"Liberia"},{code:"LBY",name:"Libya"},{code:"LIE",name:"Liechtenstein"},{code:"LTU",name:"Lithuania"},{code:"LUX",name:"Luxembourg"},{code:"MAC",name:"Macao"},{code:"MKD",name:"Macedonia"},{code:"MDG",name:"Madagascar"},{code:"MWI",name:"Malawi"},{code:"MYS",name:"Malaysia"},{code:"MDV",name:"Maldives"},{code:"MLI",name:"Mali"},{code:"MLT",name:"Malta"},{code:"MHL",name:"Marshall Islands"},{code:"MTQ",name:"Martinique"},{code:"MRT",name:"Mauritania"},{code:"MUS",name:"Mauritius"},{code:"MYT",name:"Mayotte"},{code:"MEX",name:"México"},{code:"FSM",name:"Micronesia, Federated States of"},{code:"MDA",name:"Moldova, Republic of"},{code:"MCO",name:"Monaco"},{code:"MNG",name:"Mongolia"},{code:"MNE",name:"Montenegro"},{code:"MSR",name:"Montserrat"},{code:"MAR",name:"Morocco"},{code:"MOZ",name:"Mozambique"},{code:"MMR",name:"Myanmar"},{code:"NAM",name:"Namibia"},{code:"NRU",name:"Nauru"},{code:"NPL",name:"Nepal"},{code:"NLD",name:"Netherlands"},{code:"NCL",name:"New Caledonia"},{code:"NZL",name:"New Zealand"},{code:"NIC",name:"Nicaragua"},{code:"NER",name:"Niger"},{code:"NGA",name:"Nigeria"},{code:"NIU",name:"Niue"},{code:"NFK",name:"Norfolk Island"},{code:"MNP",name:"Northern Mariana Islands"},{code:"NOR",name:"Norway"},{code:"OMN",name:"Oman"},{code:"PAK",name:"Pakistan"},{code:"PLW",name:"Palau"},{code:"PSE",name:"Palestinian Territory, Occupied"},{code:"PAN",name:"Panamá"},{code:"PNG",name:"Papua New Guinea"},{code:"PRY",name:"Paraguay"},{code:"PER",name:"Perú"},{code:"PHL",name:"Philippines"},{code:"PCN",name:"Pitcairn"},{code:"POL",name:"Poland"},{code:"PRT",name:"Portugal"},{code:"PRI",name:"Puerto Rico"},{code:"QAT",name:"Qatar"},{code:"REU",name:"Réunion"},{code:"ROU",name:"Romania"},{code:"RUS",name:"Russian Federation"},{code:"RWA",name:"Rwanda"},{code:"BLM",name:"Saint Barthélemy"},{code:"SHN",name:"Saint Helena, Ascension and Tristan da Cunha"},{code:"KNA",name:"Saint Kitts and Nevis"},{code:"LCA",name:"Saint Lucia"},{code:"MAF",name:"Saint Martin (French part)"},{code:"SPM",name:"Saint Pierre and Miquelon"},{code:"VCT",name:"Saint Vincent and the Grenadines"},{code:"WSM",name:"Samoa"},{code:"SMR",name:"San Marino"},{code:"STP",name:"Sao Tome and Principe"},{code:"SAU",name:"Saudi Arabia"},{code:"SEN",name:"Senegal"},{code:"SRB",name:"Serbia"},{code:"SYC",name:"Seychelles"},{code:"SLE",name:"Sierra Leone"},{code:"SGP",name:"Singapore"},{code:"SXM",name:"Sint Maarten (Dutch part)"},{code:"SVK",name:"Slovakia"},{code:"SVN",name:"Slovenia"},{code:"SLB",name:"Solomon Islands"},{code:"SOM",name:"Somalia"},{code:"ZAF",name:"South Africa"},{code:"SGS",name:"South Georgia and the South Sandwich Islands"},{code:"SSD",name:"South Sudan"},{code:"ESP",name:"Spain"},{code:"LKA",name:"Sri Lanka"},{code:"SDN",name:"Sudan"},{code:"SUR",name:"Suriname"},{code:"SJM",name:"Svalbard and Jan Mayen"},{code:"SWZ",name:"Swaziland"},{code:"SWE",name:"Sweden"},{code:"CHE",name:"Switzerland"},{code:"SYR",name:"Syrian Arab Republic"},{code:"TWN",name:"Taiwan, Province of China"},{code:"TJK",name:"Tajikistan"},{code:"TZA",name:"Tanzania, United Republic of"},{code:"THA",name:"Thailand"},{code:"TLS",name:"Timor-Leste"},{code:"TGO",name:"Togo"},{code:"TKL",name:"Tokelau"},{code:"TON",name:"Tonga"},{code:"TTO",name:"Trinidad and Tobago"},{code:"TUN",name:"Tunisia"},{code:"TUR",name:"Turkey"},{code:"TKM",name:"Turkmenistan"},{code:"TCA",name:"Turks and Caicos Islands"},{code:"TUV",name:"Tuvalu"},{code:"UGA",name:"Uganda"},{code:"UKR",name:"Ukraine"},{code:"ARE",name:"United Arab Emirates"},{code:"GBR",name:"United Kingdom"},{code:"USA",name:"United States"},{code:"UMI",name:"United States Minor Outlying Islands"},{code:"URY",name:"Uruguay"},{code:"UZB",name:"Uzbekistan"},{code:"VUT",name:"Vanuatu"},{code:"VEN",name:"Venezuela, Bolivarian Republic of"},{code:"VNM",name:"Viet Nam"},{code:"VGB",name:"Virgin Islands, British"},{code:"VIR",name:"Virgin Islands, U.S."},{code:"WLF",name:"Wallis and Futuna"},{code:"ESH",name:"Western Sahara"},{code:"YEM",name:"Yemen"},{code:"ZMB",name:"Zambia"},{code:"ZWE",name:"Zimbabwe"}]});Ext.define("AL.store.CFDIUseList",{extend:"Ext.data.Store",fields:["code","name","personType"],data:[{code:"G01",name:"Adquisición de mercancias",personType:"both"},{code:"G03",name:"Gastos en general",personType:"both"},{code:"I01",name:"Construcciones",personType:"both"},{code:"I02",name:"Mobilario y equipo de oficina por inversiones",personType:"both"},{code:"I03",name:"Equipo de transporte",personType:"both"},{code:"I04",name:"Equipo de computo y accesorios",personType:"both"},{code:"I05",name:"Dados, troqueles, moldes, matrices y herramental",personType:"both"},{code:"I06",name:"Comunicaciones telefónicas",personType:"both"},{code:"I07",name:"Comunicaciones satelitales",personType:"both"},{code:"I08",name:"Otra maquinaria y equipo",personType:"both"},{code:"D01",name:"Honorarios médicos, dentales y gastos hospitalarios.",personType:"physical"},{code:"D02",name:"Gastos médicos por incapacidad o discapacidad",personType:"physical"},{code:"D03",name:"Gastos funerales",personType:"physical"},{code:"D04",name:"Donativos",personType:"physical"},{code:"D05",name:"Intereses reales efectivamente pagados por créditos hipotecarios (casa habitación)",personType:"physical"},{code:"D06",name:"Aportaciones voluntarias al SAR",personType:"physical"},{code:"D07",name:"Primas por seguros de gastos médicos",personType:"physical"},{code:"D08",name:"Gastos de transportación escolar obligatoria",personType:"physical"},{code:"D09",name:"Depósitos en cuentas para el ahorro, primas que tengan como base planes de pensiones",personType:"physical"},{code:"D10",name:"Pagos por servicios educativos (colegiaturas)",personType:"physical"},{code:"P01",name:"Por definir",personType:"both"}]});Ext.define("AL.store.ExonerationDocumentTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/exonerationDocumentTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Provinces",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/provinces/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Regions",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/regions/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Communes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/communes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Cantons",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/cantons/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Districts",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/districts/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Neighborhoods",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/neighborhoods/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.IvaConditions",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/ivaConditions/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.DocumentPaymentMethods",{extend:"Ext.data.Store",country:null,stampVersion:null,includeDepositRecord:false,type:null,fields:[{name:"display",type:"string"},{name:"paymentMethod",type:"string"},{name:"type",type:"string"}],data:[],constructor:function(a){var d=this.country||(a&&a.country);switch(d){case"mexico":var c=a.stampVersion=="3.3";this.data=[{display:"Efectivo",paymentMethod:"cash",type:"pue"},{display:c?"Tarjeta de débito":"Tarjeta de Débito",paymentMethod:"debit-card",type:"pue"},{display:c?"Tarjeta de crédito":"Tarjeta de Crédito",paymentMethod:"credit-card",type:"pue"},{display:c?"Tarjeta de servicios":"Tarjeta de Servicio",paymentMethod:"service-card",type:"pue"},{display:c?"Transferencia electrónica de fondos":"Transferencia electrónica",paymentMethod:"transfer",type:"pue"},{display:c?"Cheque nominativo":"Cheque",paymentMethod:"check",type:"pue"},{display:"Monedero electrónico",paymentMethod:"electronic-wallet",type:"pue"},{display:"Dinero electrónico",paymentMethod:"electronic-money",type:"pue"},{display:"Vales de despensa",paymentMethod:"grocery-voucher",type:"pue"}];if(c){this.data.push({display:"Dación en pago",paymentMethod:"dation-payment",type:"pue"});this.data.push({display:"Pago por subrogación",paymentMethod:"subrogation-payment",type:"pue"});this.data.push({display:"Pago por consignación",paymentMethod:"allocation-payment",type:"pue"});this.data.push({display:"Condonación",paymentMethod:"forgiveness",type:"pue"});this.data.push({display:"Compensación",paymentMethod:"compensation",type:"pue"});this.data.push({display:"Novación",paymentMethod:"novation",type:"pue"}),this.data.push({display:"Confusión",paymentMethod:"misunderstanding",type:"pue"});this.data.push({display:"Remisión de deuda",paymentMethod:"debt-remission",type:"pue"});this.data.push({display:"Prescripción o caducidad",paymentMethod:"prescription-or-expiration",type:"pue"});this.data.push({display:"A satisfacción del acreedor",paymentMethod:"creditor-satisfaction",type:"pue"})}if(!c){var e=this.data;this.data[9]=({display:"Otros",paymentMethod:"other"});this.data[10]=({display:"No aplica",paymentMethod:"not-applicable"})}else{if(a.type!="transaction"){this.data[9]=({display:"Por definir",paymentMethod:"other",type:"ppd"})}}break;case"republicaDominicana":var b=[{paymentMethod:"cash",display:"Efectivo"},{paymentMethod:"check",display:"Cheque"},{paymentMethod:"transfer",display:"Transferencia"},{paymentMethod:"deposit",display:"Depósito"},{paymentMethod:"debit-card",display:"Tarjeta débito"},{paymentMethod:"credit-card",display:"Tarjeta crédito"},{paymentMethod:"barter",display:"Permuta"},];if(a.type==="transaction"){switch(a.transactionType){case"in":b.push({paymentMethod:"giftVoucher",display:"En bonos o certificados de regalos"},{paymentMethod:"mixed",display:"Otras formas de venta"});break;case"out":b.push({paymentMethod:"mixed",display:"Mixto"});break}}this.data=b;break;default:this.data=[{display:translate("cash",true),paymentMethod:"cash"},{display:translate("deposit",true),paymentMethod:"deposit"},{display:translate("transfer",true),paymentMethod:"transfer"},{display:translate("check",true),paymentMethod:"check"},{display:translate("creditCard",true),paymentMethod:"credit-card"},{display:translate("debitCard",true),paymentMethod:"debit-card"}];break}if(d!=="republicaDominicana"&&(this.includeDepositRecord||(a&&a.includeDepositRecord))){this.data.splice(1,0,{display:"Depósito",paymentMethod:"deposit"})}return this.callParent(arguments)}});Ext.define("AL.store.FiscalResponsabilities",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/fiscalResponsabilities/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.TypeOfThirdsCombo",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/thirdTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.OperationTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/operationTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.Comment",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"idLocal",type:"int"},{name:"idCompany",type:"int"},{name:"idUser",type:"int"},{name:"idResource",type:"int"},"resourceType","userName","userInitial","comment","status","createdAt","updatedAt","publishedAt",{name:"isOwnerUser",type:"boolean"},{name:"isEditing",type:"boolean",defaultValue:false}]});Ext.define("AL.view.comment.Header",{extend:"Ext.Component",cls:"document-comments-header",data:{quantity:null},tpl:['<span class="title">',translate("comments",true),'<tpl if="quantity && quantity &gt; 0">'," ({quantity})","</tpl>","</span>",'<tpl if="quantity && quantity &gt; 0"><a id="addNewCommentButton" href="#" class="btn-green"><svg class="icon"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newComment",true)+"</a>","</tpl>",]});Ext.define("AL.view.comment.Detail",{extend:"Ext.view.View",alias:"widget.comment_Detail",frame:false,border:false,store:"Comments",itemSelector:"section.comment-container",tpl:['<tpl for="."><div class="comment-area"><section class="comment-container"><div class="comment-user"><div class="avatar"><span class="initials">{userInitial}</span></div><div class="username">{userName}</div></div><tpl if="!isEditing"><div class="comment-details"><div class="comment"><tpl if="status !== \'deleted\'"><span>{comment}</span></tpl><tpl if="status === \'deleted\'"><span class="deleted">{comment}</span></tpl></div><div class="comment-others"><span>'+translate("publishedOn",true)+' {publishedAt}<tpl if="createdAt !== updatedAt"><span class="status-updated"><tpl if="status !== \'deleted\'"> - '+translate("edited",true)+"</tpl><tpl if=\"status === 'deleted'\"> - "+translate("removed",true)+'</tpl></span></tpl></span><tpl if="status !== \'deleted\' && isOwnerUser"><div class="comment-actions"><a href="#" class="comment-action-delete"><svg class="icon"><use xlink:href="/images/smile-icons.svg#delete"></use></svg>'+translate("remove",true)+'</a><a href="#" class="comment-action-edit"><svg class="icon"><use xlink:href="/images/smile-icons.svg#edit"></use></svg>'+translate("edit",true)+'</a></div></tpl></div></div></tpl><tpl if="isEditing"><div class="comment-details"><textarea id="new-comment" placeholder="'+translate("writeANewComment",true)+'">{comment}</textarea><div class="comment-others"><span>'+translate("commentAnnotations",true)+'</span><div><button class="button outline cancel-comment" background-color: #FFFFFF">'+translate("cancel",true)+'</button><button class="button primary add-comment">'+translate("edit",true)+"</button></div></div></div></tpl></section></div></tpl>",],});Ext.define("AL.view.comment.FormAddComment",{extend:"Ext.form.Panel",alias:"widget.comment_FormAdd",cls:"comment-area",comment:null,frame:false,border:false,initComponent:function(){var b='<div class="comment-user"><div class="avatar"><span class="initials">'+this.comment.userInitial+'</span></div><div class="username">'+this.comment.userName+"</div></div>";var a='<textarea id="new-comment" placeholder="'+translate("writeANewComment",true)+'"></textarea>';this.items=[{frame:false,border:false,html:'<section class="comment-container">'+b+'<div class="comment-details">'+a+'<div class="comment-others"><span>'+translate("commentAnnotations",true)+'</span><div><button id="cancel-comment" class="button outline" style="display: none; background-color: #FFFFFF">'+translate("cancelAction",true)+'</button><button id="add-comment" class="button primary" disabled>'+translate("toComment",true)+"</button></div></div></div></section>"}];this.callParent(arguments)}});Ext.define("AL.store.Comments",{extend:"Ext.data.Store",model:"AL.model.Comment"});Ext.define("AL.model.Company",{extend:"Ext.data.Model",fields:["name","identification","address","phone","website","email","currency","resolution","termsConditions","hasLogo","decimalPrecision","StampReceptionMail","countryCode","timezone","exportablesDecimalSeparator"]});Ext.define("AL.model.InvoiceTemplate",{extend:"Ext.data.Model",fields:["idLocal","name","template","companysDefault","pageSize","font","fontSize","itemsSpacing","showItemsCount"]});Ext.define("AL.model.StampReceptionMail",{extend:"Ext.data.Model",fields:["idLocal","fromName","fromAddress","message","subject","toAddress",{name:"datetime",type:"date",dateFormat:"c"}]});Ext.define("AL.model.PdfTemplate",{extend:"Ext.data.Model",fields:["idLocal","documentType","name","template","companysDefault","pageSize","itemsSpacing","font","fontSize","showItemsCount","showDiscount","showTaxValue","showTaxPercentage"]});Ext.define("AL.view.company.FormInfoEdit",{extend:"Ext.form.Panel",alias:"widget.company_FormInfoEdit",title:"",bodyPadding:"35 0 35 0",requires:["AL.view.ux.fields.Address","AL.view.ux.fields.Name","AL.view.ux.fields.EditableListModal"],bodyStyle:"background:transparent",border:false,items:[{xtype:"container",layout:"hbox",name:"parentCointainer",items:[{xtype:"fieldset",name:"editCompanyInfoFieldset",cls:"editCompanyInfoFieldset",title:translate("updateYourCompanysGeneralData",true),layout:"vbox",border:1,padding:"35 35 35 35",width:500,bodyStyle:"background:white",style:{borderColor:"#d0d0d0",borderStyle:"solid",backgroundColor:"white"},defaults:{labelAlign:"right",labelPad:15,labelWidth:140,width:403,cls:"textInput",margin:"0 0 10 0",msgTarget:"side"},defaultType:"textfield",items:[{xtype:"nameField",name:"nameComponent",fullWidth:248,labelWidth:140,labelPad:15,width:410,defaults:{margin:"0 0 0 0",},orders:[{colombia:4}]},{xtype:"textfield",fieldLabel:translate("tradeName",true),name:"tradeName",colspan:2,allowBlank:true,hidden:true,minLength:5,maxLength:450,countries:["colombia"],tooltip:"Completa este campo si en en la casilla 36 del RUT tienes asignado un nombre comercial",orders:[{colombia:5}],listeners:{afterrender:function(b){var a=b.up("form");if(a.configs.country!="colombia"){b.allowBlank=true}}}},{xtype:"combo",name:"identificationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("identificationType",true),store:"IdentificationTypes",valueField:"key",displayField:"value",displayTpl:'<tpl for=".">{value} ({abbreviature})</tpl>',forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{value} ({abbreviature})</div></tpl>'},queryMode:"local",editable:false,countries:["colombia","costaRica","argentina"],isRequiredForElectronicInvoicing:["colombia","costaRica","argentina"],hidden:true,orders:[{colombia:0}]},{xtype:"panel",border:false,cls:"container-visible",bodyCls:"container-visible",layout:{type:"table",columns:2,tableAttrs:{},tdAttrs:{valign:"top"}},defaultType:"textfield",items:[{fieldLabel:translate("identification",true),name:"identification",labelAlign:"right",labelPad:15,labelWidth:140,width:402,allowBlank:true,tooltip:translate("youCanEnter1234IfYouWishToPerformTests",true),isRequiredForElectronicInvoicing:["colombia","costaRica","argentina","chile"],orders:[{colombia:1}]},{fieldLabel:"DV",labelPad:15,labelAlign:"right",labelWidth:60,name:"co_dv",allowBlank:true,hidden:true,regex:/^[0-9]*$/,maxLength:1,orders:[{colombia:2}]}]},{xtype:"textarea",name:"economicActivityName",fieldLabel:"Giro",labelAlign:"right",rows:2,labelPad:15,maxLength:80,labelWidth:140,tooltip:"Escribe la actividad económica que se desarrolla en tu empresa",isRequiredForElectronicInvoicing:["chile"],countries:["chile"],hidden:true},{xtype:"addressField",name:"addressComponent",labelWidth:130,fullWidth:247,allowEmptyZipCode:false,componentView:"company_FormInfoEdit",isRequiredForElectronicInvoicing:{idNeighborhood:["costaRica"]}},{fieldLabel:translate("phone",true),name:"phone",allowBlank:true},{fieldLabel:translate("webSite",true),name:"website",allowBlank:true},{fieldLabel:translate("electronicEmail",true),name:"email",regex:/(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)(?:,\s*(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*))*)?;\s*)/,invalidText:'Este campo debe ser una dirección de correo electrónico con el formato "usuario@dominio.com"',allowBlank:true,isRequiredForElectronicInvoicing:["costaRica","colombia"]},{xtype:"combo",name:"kindOfPerson",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("kindOfPerson",true),store:"KindsOfPerson",valueField:"id",displayField:"value",queryMode:"local",editable:false,countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],hidden:true,orders:[{colombia:3}]},{xtype:"combo",name:"regime",fieldLabel:translate("regime",true),valueField:"key",displayField:"display",forceSelection:true,allowBlank:false,editable:false,matchFieldWidth:false,queryMode:"local",displayTpl:'<tpl for=".">{display}</tpl>',countries:["colombia","republicaDominicana","mexico","peru","spain","chile","costaRica"],requires:["colombia","republicaDominicana","mexico","peru","spain","costaRica"],listConfig:{width:300,tpl:'<tpl for="."><div class="x-boundlist-item">{display}</div></tpl>'},orders:[{colombia:5}]},{xtype:"combo",name:"economicActivity",emptyText:"Buscar...",fieldLabel:"Actividad económica",allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:1,listConfig:{width:300,loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',getInnerTpl:function(){return"{id} - {value}"}},countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"],tooltip:"Selecciona  tu actividad económica relacionada a lo que estás vendiendo"},{xtype:"datefield",fieldLabel:"Inicio de actividades",tooltip:"Fecha de inicio de actividades",name:"activityStartDate",format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true,countries:["argentina"],requires:["argentina"],},{xtype:"combo",name:"ivaCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Condición de IVA",store:"IvaConditions",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,countries:["argentina"],requires:["argentina"]},{xtype:"combo",name:"conditionIibb",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Condición IIBB",store:"ConditionsIIBB",valueField:"key",displayField:"value",queryMode:"local",editable:false,countries:["argentina"],isRequiredForElectronicInvoicing:["argentina"],hidden:true},{fieldLabel:"Número de IIBB",name:"numberIibb",countries:["argentina"],isRequiredForElectronicInvoicing:["argentina"]},{xtype:"combo",name:"invoiceText",fieldLabel:"Documento de facturación",valueField:"value",displayField:"label",forceSelection:true,editable:false,hidden:true,disabled:true,cls:"x-item-disabled",orders:[{colombia:6}]},{xtype:"combo",name:"countryCode",fieldLabel:translate("country",true),valueField:"code",displayField:"name",forceSelection:true,emptyText:translate("selectSimple",true),store:"CountriesList",hidden:true,disabled:true},{xtype:"combo",name:"timezone",fieldLabel:translate("timeZone",true),valueField:"timezone",displayField:"timezone",forceSelection:true,emptyText:translate("selectSimple",true),store:"TimezonesList",hidden:true,disabled:true},{xtype:"combo",name:"currency",fieldLabel:translate("currency",true),store:"CurrenciesAll",valueField:"code",displayField:"comboName",validateOnChange:true,submitValue:true,editable:true,forceSelect:true,enableKeyEvents:true,allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{comboName}</div></tpl>'},queryMode:"local",msgTarget:"side",},{xtype:"component",html:'<div class="company-currency-note">'+translate("youCanCreateAdditionalCurrenciesWithTheMultiCurrencyOption",true,{multicurrency:'<a href="/currency" class="company-currency-link">{{multicurrency}}</a>'})+". "+translate("findMoreInformation",true)+' <a href="https://ayudas.getsoft.app/primeros-pasos/primeros-pasos/realiza-transacciones-en-diferentes-monedas" target="_blank" class="company-currency-link">'+translate("here")+"</a>.</div>",width:316,cls:"currency-note-container"},{xtype:"combo",name:"decimalPrecision",fieldLabel:translate("decimalPrecision",true),valueField:"decimalPrecision",displayField:"decimalPrecision",forceSelection:true,allowBlank:false,editable:false,store:{fields:["decimalPrecision"],data:[{decimalPrecision:"0"},{decimalPrecision:"1"},{decimalPrecision:"2"},{decimalPrecision:"3"},{decimalPrecision:"4"}]}},{xtype:"combo",name:"exportablesDecimalSeparator",fieldLabel:translate("decimalSeparatorForExportables",true),valueField:"exportablesDecimalSeparator",displayField:"exportablesDecimalSeparator",forceSelection:true,editable:false,store:{fields:["exportablesDecimalSeparator"],data:[{exportablesDecimalSeparator:"."},{exportablesDecimalSeparator:","}]}},{xtype:"hidden",name:"locale"},{xtype:"resizableimage",name:"resizableimage",id:"resizableimage-plain",style:"text-align: right",acceptedWidthImage:300,acceptedHeightImage:90,nameField:"logo",textFieldLabel:translate("logo",true),textButtonText:translate("selectSimple",true),},{xtype:"box",html:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px; position: relative; top: -33px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -236px;top: -57px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("ifYouNeedHelpReason",true,{reason:translate("addingTheLogo")})+'<a target="_blank" href="https://ayudas.getsoft.app/es/articles/1711305"> '+translate("clickHere")+"</a>.</div></div></div></div>"},{xtype:"checkbox",name:"isActiveElectronicInvoicing",width:170,fieldLabel:"Activar facturación electrónica",tooltip:"Selecciona esta opción si deseas "+translate("stamp")+" documentos electrónicos, validos ante "+translate("governmentEntity"),inputValue:true,uncheckedValue:false,hidden:true,countries:["peru","costaRica","colombia","argentina","chile"],listeners:{afterrender:function(){}}},{xtype:"box",html:'<div style="margin-top: 24px; width: 444px; color: #888;;">Nuestro PSE autorizado para generar comprobantes electrónicos mediante resolución 034-005-0004781, es BIZLINKS S.A.C. Si deseas ver la resolución, haz </br><strong><a href="https://ayudas.getsoft.app/es/articles/1711499" target="_blank" style="cursor: pointer;">clic aquí</a></strong>.</div>',countries:["peru"]},{xtype:"box",html:'<div style="margin-top: 24px; width: 444px; text-align: center; color: #888;;">'+translate("whenYouUseAlegraYouAcceptOurTermsAndConditions",true,{termsAndConditions:'<a href="https://www.getsoft.app/terminos-y-condiciones.html" target = "_blank" style="cursor : pointer;">{{termsAndConditions}}.</a>'})+"</div>",listeners:{afterrender:function(b){var a=b.up("form");if(a.configs.originKeyword=="partner-claro"){b.update('<div style="margin-top: 24px; width: 444px; text-align: center; color: #888;;">'+translate("whenYouUseAlegraYouAcceptOurTermsAndConditions",true,{termsAndConditions:'<a href="https://www.getsoft.app/terminos-y-condiciones.html" target = "_blank" style="cursor : pointer;">{{termsAndConditions}}.</a>'})+'Cuando compras en Claro Cloud, aceptas sus <a href="" target = "_blank" style="cursor : pointer;">términos y condiciones.</a> </div>')}}}}]},{xtype:"container",layout:"vbox",width:580,cls:"container-visible",defaults:{hidden:true,disabled:true,margin:"0 0 0 50",padding:"20px 10px 45px 12px",border:1,bodyStyle:"background:white",style:{borderColor:"#d0d0d0",borderStyle:"solid",backgroundColor:"white"},},items:[{xtype:"fieldset",itemId:"signatureFields",name:"certificateCompanyInfo",cls:"editCompanyInfoFieldset",style:"border-bottom: none;min-height: 350px;background: #FFF;border: .2px solid #DCDCDC;width: 474px;",title:"Carga tu sello digital para timbrar",margin:"0 0 0 50",defaults:{margin:"5 0 0 0",width:450},fieldDefaults:{labelWidth:150,labelPad:15,labelAlign:"right"},items:[{xtype:"fieldcontainer",itemId:"hasCertificate",hidden:true,items:[{xtype:"component",html:"¡Ya tienes cargado "+translate("aCertificate")+" "+translate("certificate")+"!",width:375,style:"margin-bottom: 8px; text-align:center; color:#399921;font-size:11px;font-weight:bold;"},{xtype:"displayfield",itemId:"certificateSerialDisplayField",fieldLabel:"Serial:",},{xtype:"displayfield",itemId:"certificateDueDateDisplayField",fieldLabel:"Vencimiento:",},{xtype:"displayfield",itemId:"otherCertificateDisplayField",value:"Cargar otro "+translate("certificate"),margin:"25 0 0 0 ",fieldStyle:"color:#1A5E53 !important; font-weight: bold; font-size : 14px;"},]},{xtype:"panel",name:"hasNotCertificate",style:"font-weight: bold; font-size:14px; text-align:center;",margin:"-5px 0px 15px 0px",html:'<div style="color:#767681;font-family:Roboto">Carga tu certificado digital para que Alegra firme electrónicamente tus DTE</div>',countries:["chile"]},{xtype:"filefield",name:"certificate",fieldLabel:translate("certificate",true)+" CSD (.cer)",buttonText:translate("selectSimple",true),width:418,editable:false,forceSelection:true,cls:"refCSD",getTargetXY:function(){return[0,0]},isRequiredForElectronicInvoicing:["costaRica","chile"],msgTarget:"side",},{xtype:"filefield",name:"privateKey",width:418,fieldLabel:"Llave privada (.key)",buttonText:translate("selectSimple",true),margin:"10 0 0 0"},{xtype:"panel",style:"position: relative",items:[{xtype:"textfield",name:"keyPassword",width:418,fieldLabel:"Contraseña",inputType:"password",margin:"10 0 0 0",isRequiredForElectronicInvoicing:["costaRica","chile"]},{xtype:"button",name:"toggleViewPassword",style:"position: absolute; right: 33px; top: 11px; cursor:pointer; border:none;",html:'<svg id="viewPassword" class="icon small dark"><use xlink:href="/images/smile-icons.svg#view-eye"></use></svg>'}]},{xtype:"box",name:"helpTextCertificate",html:'<div style="margin-top:25px;">Nuestro PAC autorizado para generar CFDI es Quadrum, si deseas conocer cómo firmar el manifiesto de autorización, haz <a href="https://ayudas.getsoft.app/es/articles/1711492#firma-tu-contrato-con--quadrum" target="_blank"><span style="font-weight: bold; text-decoration: underline">clic aquí</span>.</a></div>',hidden:true,countries:["mexico"]},]},{xtype:"fieldset",name:"economicActivityCompanyInfo",cls:"editCompanyInfoFieldset",style:"border-bottom: none;min-height: 350px;background: #FFF;border: .2px solid #DCDCDC;width: 474px;",title:"Actividades económicas (ACTECO)",margin:"0 0 0 50",hidden:true,countries:["chile"],disabled:false,items:[{xtype:"component",html:'<div class="company-currency-note">ACTECO es el código de la actividad económica que realizas en tu empresa. Si no sabes cuáles son tu(s) ACTECO(s) <a href="https://zeus.sii.cl/cvc/stc/stc.html" target="_blank">aquí</a> los puedes consultar.</div>',width:400,cls:"currency-note-container",padding:"20 0 10 28"},{xtype:"combo",name:"mainEconomicActivity",emptyText:"Seleccionar",fieldLabel:"Principal",labelAlign:"top",labelStyle:"margin-bottom: 10px; font-weight: bold",allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:0,width:390,padding:"20 0 10 28",listConfig:{width:300,loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',getInnerTpl:function(){return"{id} - {value}"}},countries:["chile"],isRequiredForElectronicInvoicing:["chile"],},{xtype:"editableListComponent",name:"secondaryEconomicActivity",width:460,padding:"0 0 10 25",emptyText:"Seleccionar",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',valueField:"id",allowBlank:true,minChars:1,fieldLabel:"Otros ACTECO",labelStyle:"font-weight: bold; color: #767681; font-family: Roboto; font-size: 14px;",labelPadding:"0 0 0 0",invalidSelectionMessage:"Selecciona una actividad de la lista",modalConfig:{dynamicField:{width:390,padding:"10 0 0 0"},addDynamicFieldButton:{text:"Nueva actividad",icon:'<svg class="icon" style="color:#00B19D;height:15px;"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>',style:"float:right; border-width: 1px; right: 43px; background: rgba(255, 255, 255) !important; margin-top: 5px"}},storeConfig:{name:"EconomicActivities",autoLoad:true,queryParam:"queryByIdAndValue",queryMode:"remote",minChars:0,},listConfig:{width:300,loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',getInnerTpl:function(){return"{id} - {value}"}},},]},{xtype:"fieldset",itemId:"electronicInvoiceAdditionalParams",cls:"editCompanyInfoFieldset",style:"overflow:visible;border-color: rgb(208, 208, 208);border-style: solid;background-color: white;border-top:none;",width:474,padding:"20 10",title:"",defaults:{margin:"5 0 0 0",width:450},fieldDefaults:{labelWidth:190,labelPad:15,labelAlign:"right"},items:[{xtype:"textfield",name:"governmentEntityUser",fieldLabel:"Identificación",margin:"30 0 0 0",maxLength:60,isRequiredForElectronicInvoicing:["costaRica"],tooltip:"Agrega la identificación de la llave que solicitaste en la ATV.",msgTarget:"side"},{xtype:"textfield",name:"governmentEntityPassword",fieldLabel:"Contraseña de identificación",inputType:"password",labelWidth:190,maxLength:60,isRequiredForElectronicInvoicing:["costaRica"],tooltip:"Escribe la contraseña de ingreso."},{xtype:"box",html:'<div style="position: absolute;bottom: 15px;right: 30px;">Si necesitas ayuda para configurar tus datos, haz <a href="https://ayuda.getsoft.app/configura-la-informaci%C3%B3n-de-tu-cuenta-y-llave-criptogr%C3%A1fica-de-producci%C3%B3n-costa-rica#configurar-llave" target="_blank"><span style="font-weight: bold; text-decoration: underline">clic aquí</span>.</a></div>',hidden:true,countries:["costaRica"]},]},{xtype:"fieldset",itemId:"mxStampVersionContainer",name:"mxStampVersionContainer",cls:"editCompanyInfoFieldset",hidden:true,disabled:true,title:"Selecciona la versión para timbrar CFDI",padding:"20 25 41",items:[{xtype:"component",html:'<div class="tooltip-wrapper" style="margin-left:-215px;top:0px;margin-top: 39px;">\n                                                <img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png">\n                                                                                              </div>\n                                            </div>',},{xtype:"container",layout:"hbox",width:420,items:[{xtype:"combo",name:"stampVersion",fieldLabel:"Versión",valueField:"mxStampVersionOption",displayField:"mxStampVersionOption",store:{fields:["mxStampVersionOption"],data:[{mxStampVersionOption:"3.2"},{mxStampVersionOption:"3.3"}]}}]}]},{xtype:"fieldset",itemId:"electronicInvoiceCadenaParam",cls:"editCompanyInfoFieldset",title:"Configura tu información para facturación electrónica",margin:"0 0 0 50",style:"background-color:#FFF; border-color: #d0d0d0;",disabled:true,hidden:true,countries:["colombia"],countriesStampValidate:true,items:[{xtype:"component",html:'<div>Si aún no estas habilitado en la DIAN como facturador electrónico <strong><a target="_blank" href="https://ayudas.getsoft.app/es/articles/1939968">conoce el proceso aquí</a></div></strong>.',margin:"10px 30px -10px 30px",style:"text-align: center; color:#888; font-size: 12px; position: relative;"},{xtype:"component",name:"helpVersionElectronincInvoicing",html:"<div>Selecciona la versión de facturación electrónica que usarás para emitir tus comprobantes a la DIAN.</div>",margin:"10px 20px 20px 20px",style:"text-align:center; color:#888;font-size:12px;position:relative;"},{name:"containerComponentsVersionElectronicInvoicing",xtype:"container",layout:"hbox",width:450,items:[{xtype:"combo",name:"versionElectronicInvoicing",fieldLabel:"Versión",labelAlign:"right",emptyText:translate("selectSimple",true),editable:false,valueField:"value",displayField:"label",countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],store:{fields:["label","value"],data:[{label:"Facturación sin validación previa",value:"2.0"},{label:"Facturación con validación previa",value:"2.1"}]},value:"2.1",width:400,tooltip:"La versión de validación previa entró en vigencia en septiembre de 2019."}]},{xtype:"panel",name:"responsabilitiesPanel",hidden:true,items:[{name:"labelTitleResponsabilities",xtype:"box",cls:"border-top-box-feco",html:'<div style="color: #1A5E53;font-size: 16px;font-weight: bold;">Responsabilidades</div>',width:450,padding:"20 0 10 20"},{xtype:"editableListModalComponent",name:"responsabilitiesComponent",width:450,padding:"0 0 10 20",displayField:"value",valueField:"id",emptyMessage:"Aún no has agregado ninguna responsabilidad.",modalConfig:{title:"Responsabilidades fiscales",descriptionText:"Selecciona las responsabilidades, calidades y atributos que aparecen en la parte inferior de tu RUT.",dynamicField:{fieldLabel:"Responsabilidad",labelWidth:140,labelAlign:"right",width:390},addDynamicFieldButton:{text:"Agregar nueva responsabilidad",icon:'<svg class="icon" style="color:#00B19D;height:15px;"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'}},storeConfig:{name:"FiscalResponsabilities",autoLoad:true}}]},]},{xtype:"fieldset",itemId:"electronicResolutionParam",cls:"editCompanyInfoFieldset",title:"Configura tu resolución de pruebas para habilitación",margin:"50 0 0 50",style:"max-height: 210px; background-color:#FFF; border-color: #d0d0d0;",hidden:true,disabled:true,items:[{xtype:"component",html:'<div>Copia y pega el identificador del set pruebas entregado por la DIAN. <strong><a target="_blank" href="https://ayudas.getsoft.app/es/articles/1958841#configura-tu-resolucin-de-pruebas-para-habilitacin">Saber más</a></div></strong>.',margin:"10px 10px 10px 10px",style:"text-align: center; color:#888; font-size: 12px; position: relative;"},{xtype:"container",layout:"hbox",width:420,items:[{xtype:"textfield",fieldLabel:"Identificador de pruebas (TestSetid)",name:"testSetId",allowBlank:false,maxLength:60,labelPad:15,labelWidth:170,width:380,labelAlign:"right",regex:/^([A-Za-z0-9]{8})-([A-Za-z0-9]{4})-([A-Za-z0-9]{4})-([A-Za-z0-9]{4})-([A-Za-z0-9]{12})$/,regexText:"El valor ingresado no parece ser un testSetId válido, verifica la información directamente en la plataforma de la DIAN",countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],tooltip:"Campo informativo para identificar el set de pruebas que se desea habilitar."},]},{xtype:"container",layout:"hbox",width:420,items:[{xtype:"fieldcontainer",itemId:"hasStatusDianVP",margin:"35px 0px 0px 0px",items:[{xtype:"displayfield",itemId:"statusDianVPField",fieldLabel:"Estado de envío de set de pruebas: ",hideMode:"offsets",fieldStyle:"color: rgb(0, 177, 157); font-weight: bold; text-align:left;",labelPad:10,labelWidth:240,labelAlign:"right",width:420},{xtype:"button",action:"showModalSendSetTest",text:'<span title="Reenviar set de pruebas"><svg class="icon small"><use xmlns:xlink="http://www.w3.org/1999/xlink" style="color: #00B19D" xlink:href="/images/smile-icons.svg#sync"></use></svg><span>',style:"border-radius: 100%;",height:28,width:28,padding:0,margin:"-50 0 0 340",tooltip:"Reenviar set de pruebas",hidden:true}]},]},]},{xtype:"fieldset",itemId:"mailInboxFields",cls:"editCompanyInfoFieldset",title:"Configura tu buzón de correo para recibir CDFI",margin:"20 0 0 50",style:"max-height: 220px; background-color:#FFF; border-color: #d0d0d0;",hidden:true,disabled:true,items:[{xtype:"component",name:"helpStampReceptionMail",html:'<div>Puedes configurar una dirección de correo para recibir \n                                           los CFDI de tus proveedores, guardarlos\n                                           en el sistema y convertirlos en facturas \n                                           de compra automáticamente.</div>\n                                           <div class="tooltip-wrapper" style="left: auto;right: 135px;top: 40px;">\n                                                <img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png">\n                                                <div class="tooltip-text-container">\n                                                    <div class="tooltip-text-wrapper" style="position:relative;top:10px;right:180px;">\n                                                        <div class="text">Si necesitas ayuda para configurar tu buzón de correo, haz <a target ="_blank" href="https://ayuda.getsoft.app/configura-el-buz%C3%B3n-de-correo-de-alegra-para-recibir-tus-cfdi-de-proveedores">clic aquí</a>.</div>\n                                                    </div>\n                                                </div>\n                                            </div>',margin:"10px 20px 20px 20px",style:"text-align:center; color:#888;font-size:12px;position:relative;"},{xtype:"container",layout:"hbox",width:420,items:[{xtype:"textfield",name:"stampReceptionEmail",fieldLabel:"Buzón de correo",labelAlign:"right",labelPad:15,labelWidth:110,width:310,emptyText:"ejemplo",fieldStyle:{"text-align":"right"}},{xtype:"displayfield",name:"domainText",value:" @cfdi.getsoft.app",padding:"0 0 0 4"}]}]},]}]}],buttons:[{xtype:"buttons_Cancel",height:23,width:65,cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),action:"saveCompanyInfo",disabled:false,cls:"sm-button-primary",height:38,width:157}],getFieldValuesAsMetadata:function(){var o=null;var p=this.configs&&this.configs.country?this.configs.country:null;switch(p){case"colombia":var g=this.down("checkbox[name=isActiveElectronicInvoicing]");var c=this.down("combo[name=versionElectronicInvoicing]");var n=this.down("editableListModalComponent[name=responsabilitiesComponent]");var k=this.down("textfield[name=testSetId]");var d=this.down("textfield[name=tradeName]");o={isActiveElectronicInvoicing:g.getValue(),versionElectronicInvoicing:c.getValue(),fiscalResponsabilities:n.getElements(),setTestForGovernmentEntity:{testId:k.getValue()},tradeName:d.getValue()};break;case"peru":case"mexico":var g=this.down("checkbox[name=isActiveElectronicInvoicing]");o={isActiveElectronicInvoicing:g.getValue()};break;case"costaRica":var g=this.down("checkbox[name=isActiveElectronicInvoicing]"),b=this.down("combo[name=economicActivity]");o={isActiveElectronicInvoicing:g.getValue(),economicActivity:b.getValue()};var m=this.down("fieldset[itemId=electronicInvoiceAdditionalParams]");if(m){var l=m.down("textfield[name=governmentEntityUser]");var j=m.down("textfield[name=governmentEntityPassword]");o.governmentEntityUser=l.getValue();o.governmentEntityPassword=j.getValue()}break;case"argentina":var g=this.down("checkbox[name=isActiveElectronicInvoicing]"),a=this.down("combo[name=ivaCondition]"),f=this.down("combo[name=conditionIibb]"),h=this.down("textfield[name=numberIibb]"),q=this.down("datefield[name=activityStartDate]");o={isActiveElectronicInvoicing:g.getValue(),ivaCondition:a.getValue(),conditionIibb:f.getValue(),numberIibb:h.getValue(),activityStartDate:Ext.Date.format(q.getValue(),"Y-m-d")};break;case"chile":var g=this.down("checkbox[name=isActiveElectronicInvoicing]"),e=this.down("combo[name=mainEconomicActivity]");secondaryActivityField=this.down("editableListComponent[name=secondaryEconomicActivity]");economicActivityNameField=this.down("textfield[name=economicActivityName]");o={isActiveElectronicInvoicing:g.getValue(),economicActivity:e.getValue(),economicActivityName:economicActivityNameField.getValue(),secondaryEconomicActivity:secondaryActivityField.getElements()}}return o},setFieldValuesFromMetadata:function(l){var m=this.configs&&this.configs.country?this.configs.country:null;switch(m){case"colombia":if(typeof l.isActiveElectronicInvoicing!=="undefined"){var c=this.down("checkbox[name=isActiveElectronicInvoicing]");c.setValue(l.isActiveElectronicInvoicing)}if(typeof l.versionElectronicInvoicing!=="undefined"){var o=this.down("combo[name=versionElectronicInvoicing]");o.setValue(l.versionElectronicInvoicing)}if(typeof l.fiscalResponsabilities!=="undefined"){var a=this.down("editableListModalComponent[name=responsabilitiesComponent]");var f=a.getStore();if(f.hasLoaded()){a.setElements(l.fiscalResponsabilities)}else{f.load({callback:function(){a.setElements(l.fiscalResponsabilities)}})}}if(typeof l.setTestForGovernmentEntity!=="undefined"){var p=this.down("textfield[name=testSetId]");p.setValue(l.setTestForGovernmentEntity.testId)}if(typeof l.tradeName!=="undefined"){var g=this.down("textfield[name=tradeName]");g.setValue(l.tradeName)}break;case"peru":case"mexico":if(typeof l.isActiveElectronicInvoicing!=="undefined"){var c=this.down("checkbox[name=isActiveElectronicInvoicing]");c.setValue(l.isActiveElectronicInvoicing)}break;case"costaRica":if(typeof l.isActiveElectronicInvoicing!=="undefined"){var c=this.down("checkbox[name=isActiveElectronicInvoicing]");c.setValue(l.isActiveElectronicInvoicing)}var q=this.down("fieldset[itemId=electronicInvoiceAdditionalParams]");if(q){if(typeof l.governmentEntityUser!=="undefined"){var b=q.down("textfield[name=governmentEntityUser]");b.setValue(l.governmentEntityUser)}if(typeof l.governmentEntityPassword!=="undefined"){var d=q.down("textfield[name=governmentEntityPassword]");d.setValue(l.governmentEntityPassword)}}if(typeof l.economicActivity!=="undefined"){var e=this.down("combo[name=economicActivity]");var f=e.getStore();if(f.hasLoaded()){e.setValue(l.economicActivity)}else{f.on("load",function(t){e.setValue(l.economicActivity)})}}break;case"argentina":if(typeof l.isActiveElectronicInvoicing!=="undefined"){var c=this.down("checkbox[name=isActiveElectronicInvoicing]");c.setValue(l.isActiveElectronicInvoicing)}if(typeof l.ivaCondition!=="undefined"){var r=this.down("combo[name=ivaCondition]");var f=r.getStore();if(f.hasLoaded()){r.setValue(l.ivaCondition)}else{f.on("load",function(t){r.setValue(l.ivaCondition)})}}if(typeof l.conditionIibb!=="undefined"){var j=this.down("combo[name=conditionIibb]");var f=j.getStore();if(f.hasLoaded()){j.setValue(l.conditionIibb)}else{f.on("load",function(t){j.setValue(l.conditionIibb)})}}if(typeof l.numberIibb!=="undefined"){var s=this.down("textfield[name=numberIibb]");s.setValue(l.numberIibb)}if(typeof l.activityStartDate!=="undefined"&&l.activityStartDate!=""){var k=this.down("datefield[name=activityStartDate]");k.setValue(l.activityStartDate)}break;case"chile":if(typeof l.isActiveElectronicInvoicing!=="undefined"){var c=this.down("checkbox[name=isActiveElectronicInvoicing]");c.setValue(l.isActiveElectronicInvoicing)}if(typeof l.economicActivityName!=="undefined"){var h=this.down("textarea[name=economicActivityName]");h.setValue(l.economicActivityName)}if(typeof l.economicActivity!=="undefined"){var e=this.down("combo[name=economicActivity]");var f=e.getStore();if(f.hasLoaded()){e.setValue(l.economicActivity)}else{f.on("storeloaded",function(){e.setValue(l.economicActivity)});f.on("load",function(t){f.fireEvent("storeloaded");f.suspendEvent("storeloaded")})}}if(typeof l.secondaryEconomicActivity!=="undefined"){var n=this.down("editableListComponent[name=secondaryEconomicActivity]");var f=n.getStore();if(f.hasLoaded()){n.setElements(l.secondaryEconomicActivity)}else{f.on("storeloaded",function(){n.setElements(l.secondaryEconomicActivity)});f.on("load",function(t){f.fireEvent("storeloaded");f.suspendEvent("storeloaded")})}}break}},});Ext.define("AL.view.company.FormInvoiceInfoEdit",{extend:"Ext.form.Panel",alias:"widget.company_FormInvoiceInfoEdit",title:"Información de facturación",bodyPadding:35,width:1024,defaultType:"textfield",defaults:{labelWidth:250,labelAlign:"right",width:300,labelPad:15},items:[{xtype:"textarea",fieldLabel:"Términos y condiciones",name:"termsConditions",labelWidth:300,allowBlank:true,width:700,height:90,maxLength:400,msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-top: 30px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper tooltip-small"><div class="text">{{generalDataTermsAndConditionsHelp}}</div></div></div></div>'},{xtype:"textarea",fieldLabel:"Notas "+translate("ofTheInvoice")+" "+translate("invoice"),name:"invoiceAnotation",labelWidth:300,allowBlank:true,width:700,height:90,maxLength:400,msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-top: 30px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style=""><div class="tooltip-text-wrapper tooltip-small"><div class="text">{{generalDataInvoiceAnotationHelp}}</div></div></div></div>'},{xtype:"checkboxfield",name:"statementClientAttached",inputValue:"yes",fieldLabel:"Incluir "+translate("statement")+" en "+translate("invoices"),tooltip:"Activando esta opción se incluirá un enlace al "+translate("statement")+" en cada envío de "+translate("invoice"),width:350,labelWidth:300},{xtype:"checkboxfield",name:"sendMailWithDocumentAfterAcceptanceByGovernmentEntity",inputValue:"yes",fieldLabel:"Envio automático de documentos electrónicos",tooltip:"Activando esta opción se enviará el documento electrónico a tu cliente, luego de que sea aceptado por "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+".",width:350,labelWidth:300,countries:["peru","argentina","costaRica","colombia"],countriesStampValidate:true}],initComponent:function(){this.items[0].fieldLabel=translate("termAndCondition",true);this.items[0].afterBodyEl=this.items[0].afterBodyEl.replace("{{generalDataTermsAndConditionsHelp}}",translate("generalDataTermsAndConditionsHelp",false,{invoices:false}));this.items[1].fieldLabel=AL.string.toCapitalizeFirstWord(translate("invoiceAnotation",true,{invoice:false,ofTheInvoice:false}));this.items[1].afterBodyEl=this.items[1].afterBodyEl.replace("{{generalDataInvoiceAnotationHelp}}",translate("generalDataInvoiceAnotationHelp",false,{invoices:false}));this.items[2].fieldLabel=translate("includeStatementInInvoices",true,{statement:false,invoices:false});this.items[2].tooltip=translate("generalDataIncludeStatementHelp",true,{statement:false,invoice:false});this.items[3].fieldLabel=translate("generalDataEDAutoEmails",true);this.items[3].tooltip=translate("generalDataEDAutoEmailsHelp",true,{theGovernmentEntity:false,governmentEntity:false});this.callParent(arguments)},setFieldValuesFromMetadata:function(a){if(typeof a.settings!=="undefined"){var b=a.settings;if(typeof b.sendMailWithDocumentAfterAcceptanceByGovernmentEntity!=="undefined"){var c=this.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");c.setValue(b.sendMailWithDocumentAfterAcceptanceByGovernmentEntity)}}},getFieldValuesAsMetadata:function(){var b=this.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");var a={settings:{sendMailWithDocumentAfterAcceptanceByGovernmentEntity:b.getValue()}};return a}});Ext.define("AL.view.company.FormNextInvoiceNumber",{extend:"Ext.form.Panel",alias:"widget.company_FormNextInvoiceNumber",bodyStyle:"background: transparent",style:"background: transparent",bodyPadding:"25 0 25 25",anchor:100,border:false,layout:"anchor",defaults:{width:350,labelWidth:220,labelAlign:"right",labelPad:25},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"checkbox",fieldLabel:translate("electronicNumeration",true),inputValue:true,uncheckedValue:false,checked:true,name:"isElectronicResolution",tooltip:translate("selectThisOptionIfYouWillUseThisNumerationTo",true)+"  "+translate("stamp")+" "+translate("stampDocuments"),hidden:true,countries:["colombia","peru","costaRica","argentina"],countriesStampValidate:true,},{xtype:"displayfield",name:"name",fieldLabel:translate("numeration",true)},{xtype:"checkbox",name:"autoincrement",inputValue:"yes",checked:true,fieldLabel:translate("automaticNumeration",true),listeners:{change:function(e,f,b,c){var d=e.up("form");var a=d.down("textfield[name=prefix]");var g=d.down("textfield[name=nextInvoiceNumber]");if(f){a.enable();a.show();g.enable();g.show()}else{a.disable();a.hide();g.disable();g.hide()}}}},{xtype:"textfield",fieldLabel:translate("prefix",true)+" "+translate("of")+" "+translate("invoice"),name:"prefix",allowBlank:true,isRequiredForElectronicInvoicing:["costaRica"],},{xtype:"textfield",fieldLabel:translate("next",true)+" "+translate("number")+" "+translate("of")+" "+translate("invoice"),name:"nextInvoiceNumber",regex:/^[1-9]([0-9]+)?$/,regexText:translate("theNumeration",true)+" "+translate("numeration")+" "+translate("mustBeANumericalValueGreaterThanZero"),allowBlank:false,blankText:translate("itIsNecessaryToIndicateTheNext",true)+" "+translate("number")+" "+translate("of")+" "+translate("invoice"),msgTarget:"side",maxLength:10,listeners:{beforerender:function(c,a){var b=c.up("company_FormNextInvoiceNumber");if(b.country=="republicaDominicana"){c.maxLength=9}}}},{xtype:"label",cls:"x-form-item-label",style:"border-top: 1px solid rgba(151, 151, 151, 0.2); padding: 0px 0px 0px; right: auto; left: 0px; margin: 0px; width: 925px; top: 0px; margin-top: 20px ; margin-bottom: 20px;",},{xtype:"label",text:translate("resolutionText",true),cls:"x-form-item-label",},{xtype:"textarea",name:"resolutionText",allowBlank:true,listeners:{beforerender:function(c,a){var b=c.up("company_FormNextInvoiceNumber");switch(b.country){case"colombia":c.emptyText=translate("exampleResolutionTextColombia",true);break;case"costaRica":c.emptyText="Ejemplo: Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019";break;case"peru":c.emptyText="Ejemplo: Autorizado mediante resolución Nº 034-005-0004781";break;default:c.emptyText=translate("exampleResolutionTextDefault",true);break}if(b.country=="republicaDominicana"){c.maxLength=9}}}},{xtype:"label",html:'<a href="/resolution" target="_blank" style="color:#00b19d; position:absolute; bottom:0px; font-size:10px;">'+translate("manageMyNumerations",true)+"</a>",margin:"20 0 0 0"}],buttons:[{text:translate("save",true),action:"saveNextInvoiceNumber",formBind:true,disabled:true,margin:"10 10 0 0",height:40,cls:"button main-button",hidden:true}],getFieldValuesAsMetadata:function(){var b=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"colombia":case"peru":case"mexico":case"costaRica":var c=this.down("checkbox[name=isElectronicResolution]");b={isElectronicResolution:c.getValue()};break}return b},setFieldValuesFromMetadata:function(b){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"colombia":case"peru":case"mexico":case"costaRica":if(typeof b.isElectronicResolution!=="undefined"){var c=this.down("checkbox[name=isElectronicResolution]");c.setValue(b.isElectronicResolution)}break}},});Ext.define("AL.view.company.FormNextTransactionNumber",{extend:"Ext.form.Panel",alias:"widget.company_FormNextTransactionNumber",bodyStyle:"background: transparent",style:"background: transparent",anchor:100,border:false,layout:"anchor",defaults:{width:350},defaultType:"textfield",items:[{xtype:"container",margin:"0 30 0 30",layout:"hbox",items:[{xtype:"label",html:translate("next",true)+" "+translate("number")+'<span class="req">*</span>',margin:"0 5 0 0",width:120},{xtype:"textfield",name:"transactionPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,width:100},{xtype:"textfield",name:"nextTransactionNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el siguiente "+translate("number")+" de transacción",msgTarget:"side",width:100}]},],listeners:{afterrender:function(){if(this.country=="republicaDominicana"){this.down("textfield[name=transactionPrefix]").show()}}},buttons:[{text:"Guardar",action:"saveNextTransactionNumber",formBind:true,disabled:true,height:40,formBind:true,hidden:true}]});Ext.define("AL.view.company.WindowAclError",{id:"window-acl-error",extend:"Ext.window.Window",reason:"aclError",style:"padding: 0; border: none; box-shadow : 0px",border:false,frameHeader:false,header:false,closable:true,shadow:false,resizable:false,modal:true,width:480,height:140,autoShow:true,listeners:{afterrender:function(b){var a=Ext.create("Ext.Template",'<div id="add-action-blocked" ><div class="close">X</div><div class="title">{title}</div>','<div class="text">{text}',"<div>{extraInfo}</div></div></div>");a.compile();a.overwrite(b.body,{title:b.configs.title,text:b.configs.text,extraInfo:b.configs.extraInfo});var c=Ext.DomQuery.select(".close");c=Ext.get(c);c.on("click",function(){b.close()})}}});Ext.define("AL.view.company.InvoiceTemplatePicker",{extend:"Ext.view.View",alias:"widget.company_InvoiceTemplatePicker",recordValue:"idLocal",itemSelector:"div.item-title",autoScroll:true,trackOver:true,overItemCls:"x-item-over",loadingText:translate("loading",true),collapsable:true,showPreviewButton:true,useRadioAsSelector:true,useItemsGroup:true,containerStyle:"margin-bottom: 5px;",labelType:"div",labelStyle:"",label:"Plantilla de impresión de "+translate("invoice"),fieldsetStyle:"",itemsContainerStyle:"",itemsLabelStyle:"text-decoration: underline; cursor: pointer;",initComponent:function(){var k=this;if(!k.store){k.store="InvoiceTemplates"}var e={beginning:"",ending:""};switch(k.labelType){case"fieldset":e.beginning='<fieldset style="'+k.fieldsetStyle+'"><legend class="label" style="'+k.labelStyle+'">'+k.label+"</legend>";e.ending="</fieldset>";break;default:e.beginning='<div class="label" style="'+k.labelStyle+'">'+k.label+"</div>";e.ending="";break}var d="";var a="";var n="";if(k.useItemsGroup===true&&k.collapsable===true){d='<span class="collapsable-icon"></span>';a='role="collapsable"';n="collapsed"}var h="";var f="";var j=' {[values.name + " (" + translate(values.pageSize) + ")"]}';if(k.useItemsGroup===true){h='<tpl if="xindex == 1 || parent[xindex - 2][\'pageSize\'] != values[\'pageSize\']"><tpl if="xindex == 1"><div class="items-group" '+a+'><tpl else></div><div class="items-group '+n+'" '+a+'></tpl><div class="items-label" style="'+k.itemsLabelStyle+'">'+d+'Tamaño {[translate(values["pageSize"])]}</div></tpl>';f="</div>";j="{name}"}else{k.collapsable=false}var l="https://cdn1.getsoft.app/images/invoiceTemplates/{template}.png";var m="https://cdn1.getsoft.app/images/invoiceTemplates/minified/{template}.png";if(this.resource=="remission"||this.resource=="estimate"){l="https://cdn1.getsoft.app/images/Templates/"+this.resource+"/"+this.country+"_{template}.png";m="https://cdn1.getsoft.app/images/Templates/"+this.resource+"/minified/"+this.country+"_{template}.png"}var c="";if(k.showPreviewButton){c='<a class="view-thumb" href="'+l+'" target="_blank"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver imagen" title="Ver imagen"></a>'}if(!k.itemTemplate){var b="",g="vertical-align: middle; cursor: pointer;";if(!k.useRadioAsSelector){b="cursor: pointer;";g+=" display: none;";k.itemTemplate='<div class="thumb-wrap" style="'+b+'"><div class="item-title" style="text-align: center; margin: 2px 0; display: block;"><label style="cursor: pointer;"><input type="radio" name="idInvoiceTemplate" value="{'+this.recordValue+'}" style="'+g+'">'+j+'</label><div class="thumb"><img src="'+m+'" title="{name}">'+c+"</div></div></div>"}else{k.itemTemplate='<div class="thumb-wrap" style="'+b+'"><div class="item-title" style="text-align: center; margin: 2px 0; display: block;"><label style="cursor: pointer;"><input type="radio" name="idInvoiceTemplate" value="{'+this.recordValue+'}" style="'+g+'">'+j+'</label></div><div class="thumb"><img src="'+m+'" title="{name}">'+c+"</div></div>"}}this.tpl=['<div style="'+k.containerStyle+'"><div class="imagepicker">',e.beginning,'<tpl if="values.length &gt; 0" >','<div class="items" style="'+k.itemsContainerStyle+'">','<tpl for=".">',h,k.itemTemplate,"</tpl>",f,"</div>","<tpl else>","No disponible","</tpl>",e.ending,"</div></div>"];this.callParent(arguments)},listeners:{viewready:function(h,k){var a=h.up("form");a.setHeight("auto");if(h.collapsable===true){var e=Ext.select("#"+h.getId()+" .items-label").elements;for(var g in e){var b=Ext.get(e[g]);b.on("click",function(m,l){var n=Ext.get(l);var j=n.parent(".items-group");j.toggleCls("collapsed");a.setHeight("auto")})}}var c=Ext.query("#"+this.getId()+" input[type=radio][name=idInvoiceTemplate]");for(var f=c.length-1;f>=0;f--){var d=Ext.get(c[f]).parent(".thumb-wrap");d.enableDisplayMode()}},beforeselect:function(a,b,c){a.view.recordToSelect=b},select:function(a,b,c){var d=a.view.up("form").getForm();d.idInvoiceTemplate=b.get(this.recordValue);delete a.view.recordToSelect;this.toggleSelectRecord(b,true)},beforedeselect:function(a,b,c){if(!a.view.recordToSelect){return false}},deselect:function(a,b,c){this.toggleSelectRecord(b,false)},highlightitem:function(a,c,b){var d=Ext.get(c);d.up(".thumb-wrap").addCls(this.overItemCls)},unhighlightitem:function(a,c,b){var d=Ext.get(c);d.up(".thumb-wrap").removeCls(this.overItemCls)}},toggleSelectRecord:function(a,d){var f=Ext.query("#"+this.getId()+" input[type=radio][name=idInvoiceTemplate][value="+a.get(this.recordValue)+"]")[0];f.checked=d;var c=Ext.get(f).parent(".thumb-wrap");if(d){c.addCls(this.selectedItemCls);if(this.collapsable===true){var b=c.parent(".items-group");if(b.hasCls("collapsed")){b.removeCls("collapsed");var e=this.up("form");e.setHeight("auto")}}}else{c.removeCls(this.selectedItemCls)}},collapseAll:function(){if(this.collapsable===true){var c=Ext.select("#"+this.getId()+" .items-group").elements;for(var a in c){Ext.get(c[a]).addCls("collapsed")}var b=this.up("form");b.setHeight("auto")}},changeRecordsVisibility:function(d,c){c=typeof c==="undefined"?"true":c;var f="show";if(c){f="hide"}for(var b in d){var e=Ext.query("#"+this.getId()+" input[type=radio][name=idInvoiceTemplate][value="+d[b]+"]")[0];var a=Ext.get(e).parent(".thumb-wrap");a[f]()}}});Ext.define("AL.view.company.FormUploadFile",{extend:"Ext.form.Panel",alias:"widget.company_FormUploadFile",width:550,frame:false,border:false,defaults:{width:450,labelWidth:140},layout:{type:"vbox",align:"stretch"},items:[{xtype:"hidden",name:"type",margin:0},{xtype:"hidden",name:"idType",margin:0},{xtype:"filefield",name:"file",allowBlank:false,fieldLabel:translate("selectFile",true)},],buttons:[{text:translate("attach",true),action:"uploadFile",margin:"10 10 0 0",height:40,formBind:true,cls:"button main-button",}]});Ext.define("AL.view.company.EmailTemplates",{extend:"Ext.panel.Panel",alias:"widget.company_EmailTemplates",width:1020,frame:false,border:false,defaults:{width:800},items:[{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:translate("invoice")}),width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"invoice",margin:"10 0 10 523"},{xtype:"container",name:"invoice",width:700,items:[{xtype:"box",width:600,name:"invoice",cls:"email-preview",queryName:"invoice"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:translate("estimate")}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"estimate",margin:"10 0 10 523"},{xtype:"container",name:"estimate",width:700,items:[{xtype:"box",width:600,name:"estimate",cls:"email-preview",queryName:"estimate"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:translate("creditNote")}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"credit-note",margin:"10 0 10 523"},{xtype:"container",name:"credit-note",width:700,items:[{xtype:"box",width:600,name:"credit-note",cls:"email-preview",queryName:"credit-note"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:"{{remission}}"}),margin:"40 0 0 0",width:622,name:"remissionContainer",items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"remission",margin:"10 0 10 523"},{xtype:"container",name:"remission",width:700,items:[{xtype:"box",width:600,name:"remission",cls:"email-preview",queryName:"remission"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:"{{transactionsIn}}"}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"transaction-in",margin:"10 0 10 523"},{xtype:"container",name:"transaction-in",width:700,items:[{xtype:"box",width:600,name:"transaction-in",cls:"email-preview",queryName:"transaction-in"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:"{{transactionOut}}"}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"transaction-out",margin:"10 0 10 523"},{xtype:"container",name:"transaction-out",width:700,items:[{xtype:"box",width:600,name:"transaction-out",cls:"email-preview",queryName:"transaction-out"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:"{{purchaseOrder}}"}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"purchase-order",margin:"10 0 10 523"},{xtype:"container",name:"purchase-order",width:700,items:[{xtype:"box",width:600,name:"purchase-order",cls:"email-preview",queryName:"purchase-order"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:translate("documentEmail",true,{document:"{{statementWCClient}}"}),margin:"40 0 0 0",width:622,items:[{xtype:"button",text:translate("editEmail",true),name:"configureTemplate",emailType:"statement",margin:"10 0 10 523"},{xtype:"container",name:"statement",width:700,items:[{xtype:"box",width:600,name:"statement",cls:"email-preview preview-statement",queryName:"statement"}]}]}]});Ext.define("AL.view.admin.company.CountriesCombo",{extend:"Ext.form.ComboBox",alias:"widget.admin_company_CountriesCombo",fieldLabel:"País",displayField:"name",valueField:"value",queryMode:"local",editable:false,forceSelection:true,store:{fields:["name","value"],data:[{name:"Colombia",value:"colombia"},{name:"España",value:"spain"},{name:"Estados Unidos",value:"usa"},{name:"Internacional",value:"other"},{name:"México",value:"mexico"},{name:"Panamá",value:"panama"},{name:"Perú",value:"peru"},{name:"República Dominicana",value:"republicaDominicana"},{name:"Chile",value:"chile"},{name:"Costa Rica",value:"costaRica"},{name:"Argentina",value:"argentina"}],sorters:[{property:"name",direction:"ASC"}]}});Ext.define("AL.view.company.WindowReactiveDemo",{alias:"widget.company_WindowReactiveDemo",extend:"Ext.window.Window",autoShow:true,modal:true,border:false,closable:false,width:900,height:687,resizable:false,bodyStyle:"background: transparent",id:"modal-reactive-demo",items:[{xtype:"image",src:"images/reactive.jpg",width:900,height:657,style:"cursor : pointer;",listeners:{el:{click:function(){GlobalLoadMask.show("modal-reactive-demo");Ext.Ajax.request({url:"/membership/add-membership-demo/format/json",method:"POST",success:function(){window.location.reload()},failure:function(){Ext.Msg.alert("Error","Error al reactivar el plan demo")}})}}}}],});Ext.define("AL.view.company.FormTemplateOther",{extend:"Ext.form.Panel",alias:"widget.company_FormTemplateOther",width:1024,defaultType:"textfield",bodyPadding:35,defaults:{labelWidth:250,labelAlign:"right",width:300,labelPad:15},items:[{xtype:"combo",name:"transactionPrintFormat",fieldLabel:"Plantilla de impresión de transacciones",width:420,editable:false,labelWidth:300,allowBlank:true,displayField:"label",valueField:"value",queryMode:"local",store:Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"Media carta",value:"half"},{label:"Carta",value:"full"}]})},{xtype:"combo",name:"purchaseOrderPrintFormat",fieldLabel:"Plantilla de impresión de "+translate("purchaseOrders"),width:420,editable:false,labelWidth:300,allowBlank:true,displayField:"label",valueField:"value",queryMode:"local",store:Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:"Media carta",value:"half"},{label:"Carta",value:"full"}]})},],buttons:[{text:"Guardar",action:"saveInvoiceInfo",formBind:true,margin:12,disabled:true}]});Ext.define("AL.view.company.EditTemplatesPanel",{extend:"Ext.form.Panel",alias:"widget.company_EditTemplatesPanel",bodyPadding:"20 0 0 0",width:1022,border:false,layout:{type:"vbox",align:"stretch"},initComponent:function(){var d=this;this.callParent(arguments);var g=Ext.ComponentQuery.query("[name=showInvoiceTotalInWords]")[0],a=Ext.ComponentQuery.query("[name=showRetentionInvoice]")[0];if(d.showInvoiceTotalInWords&&d.showInvoiceTotalInWords=="yes"){g.setValue(true)}if(d.showRetentionInvoice&&d.showRetentionInvoice=="yes"){a.setValue(true)}if(d.showNewLineCharOnPdf&&d.showNewLineCharOnPdf=="yes"){Ext.ComponentQuery.query("[name=showNewLineCharOnPdf]")[0].setValue(true)}if(d.keyCountry){Ext.ComponentQuery.query("[name=keyCountry]")[0].setValue(d.keyCountry)}if(d.isTest&&d.isTest=="yes"){Ext.ComponentQuery.query("[name=testParameters]")[0].show()}if(d.keyCountry){switch(d.keyCountry){case"usa":g.setVisible(false);d.items.items[2].items.items[1].items.items[0].hidden=true;case"argentina":a.setVisible(false);break;case"mexico":case"republicaDominicana":a.setVisible(false);break}}if(d.signatureUrl&&d.signatureUrl!=""){var c=406;var b=72;var f=(d.signatureWidth*Math.min(b,d.signatureHeight))/d.signatureHeight;var e="";if(f<c){e="width: auto; max-height: "+b+"px;"}else{e="height: auto; max-width: "+c+"px;"}d.items.items[2].items.items[1].items.items[0].items.items[1].html='<div style="width: 100%; margin-top: 10px; margin-bottom: 10px; overflow: hidden;"><div style="float: right; width: 406px; height: 80px; line-height: 72px; background-color: #F3F5F7; border: 2px dashed; border-color: #E8EBF0; text-align: center;"><img src="'+d.signatureUrl+'" alt="Firma actual" style="margin: 0 auto; '+e+' vertical-align: middle;"></div></div>'}},items:[{xtype:"panel",bodyPadding:"0 30 30 30",border:false,layout:{type:"hbox",pack:"end"},items:[{xtype:"combo",name:"globalTemplate",fieldLabel:translate("overallStyle",true),displayField:"displayName",valueField:"displayName",allowBlank:true,forceSelection:true,editable:false,disabled:true,labelStyle:"font-weight: bold; font-size: 14px; color: #58595F;",fieldStyle:"font-size; 14px; color: #58595F;",queryMode:"local"}]},{xtype:"documentpicker",disabled:true},{xtype:"form",name:"globalParametersForm",bodyStyle:"border-width: 0px 2px 0px 2px; border-color: #E8EBF0;",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",margin:"40 0 40 0",bodyPadding:"5 35 10 17",flex:1,border:false,items:[{xtype:"fieldset",title:'<b style="font-size: 16px; color: #58595F;">'+translate("generalSetting",true)+'</b>&nbsp;&nbsp;<img id="tooltip1" class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png">',listeners:{render:function(){var a=Ext.create("Ext.tip.ToolTip",{target:"tooltip1",html:translate("ifYouNeedHelp",true)+' <b><a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115004645686#global">'+translate("clickHere")+"</a></b>.",listeners:{render:function(b){b.getEl().on({mouseenter:function(){a.show()},mouseleave:function(){a.hide()},scope:b})}},constrain:true,closeAction:"hide",})}},itemId:"generalInvoiceParameters",padding:15,layout:"anchor",defaultType:"checkboxfield",style:"border-color: #E8EBF0;",fieldDefaults:{inputValue:"yes",checked:false,layout:"100%",labelWidth:315,labelStyle:"font-size: 12px; color: #58595F;"},items:[{xtype:"box",html:'<div style="padding-left: 1px; margin-bottom: 30px; font-size: 11px; color: #90909A;">'+translate("theParametersYouActivateApplyToAllTemplates",true)+".</div>"},{name:"showInvoiceTotalInWords",fieldLabel:translate("template.showInvoiceTotalInWords",true),tooltip:translate("template.showInvoiceTotalInWordsTooltip",true)},{name:"showNewLineCharOnPdf",fieldLabel:translate("template.showNewLineCharOnPdf",true),tooltip:translate("template.showNewLineCharOnPdfTooltip",true)},{name:"showRetentionInvoice",fieldLabel:translate("template.showRetentionInvoice",true),tooltip:translate("template.showRetentionInvoiceTooltip",true)}]},{xtype:"fieldset",title:'<b style="font-size: 16px; color: #58595F;">'+translate("parametersForTesting",true)+"</b>",name:"testParameters",padding:15,layout:"anchor",defaultType:"checkboxfield",style:"border-color: #E8EBF0;",fieldDefaults:{inputValue:"yes",checked:false,layout:"100%",labelWidth:315,labelStyle:"font-size: 12px; color: #58595F;",fieldStyle:"font-size; 12px; color: #58595F;"},hidden:true,items:[{xtype:"box",html:'<div style="padding-left: 1px; margin-bottom: 30px; font-size: 11px; color: #90909A;">'+translate("theParametersYouActivateApplyOnlyToTests",true)+"</div>"},{xtype:"combo",name:"keyCountry",fieldLabel:translate("countryToPreview",true),displayField:"country",valueField:"keyCountry",forceSelection:true,editable:false,labelWidth:250,store:{fields:["country","keyCountry"],data:[{country:translate("country.colombia",true),keyCountry:"colombia"},{country:translate("country.spain",true),keyCountry:"spain"},{country:translate("country.usa",true),keyCountry:"usa"},{country:translate("international",true),keyCountry:"other"},{country:translate("country.mexico",true),keyCountry:"mexico"},{country:translate("country.panama",true),keyCountry:"panama"},{country:translate("country.peru",true),keyCountry:"peru"},{country:translate("country.republicaDominicana",true),keyCountry:"republicaDominicana"},{country:translate("country.chile",true),keyCountry:"chile"},{country:translate("country.costaRica",true),keyCountry:"costaRica"},{country:translate("country.argentina",true),keyCountry:"argentina"}],sorters:[{property:"country",direction:"ASC"}]}},{name:"multicurrency",fieldLabel:translate("activateMulticurrency",true)},{name:"showPlanText",fieldLabel:"Mostrar legenda de versión educativa"}]},{xtype:"filefield",name:"signatureToPreview",hidden:true,disabled:true},{xtype:"filefield",name:"signature",hidden:true,disabled:true}]},{xtype:"panel",margin:"40 0 40 0",bodyPadding:"5 35 10 17",bodyStyle:"border-width: 0px 0px 0px 1px; border-color: #809BB6;",flex:1,items:[{xtype:"fieldset",itemId:"userInvoiceParameters",padding:15,style:"border-color: #E8EBF0;",title:'<b style="font-size: 16px; color: #58595F;">'+translate("userSignatureForDocuments",true)+'</b>&nbsp;&nbsp;<img id="tooltip2" class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png">',listeners:{render:function(){var a=Ext.create("Ext.tip.ToolTip",{target:"tooltip2",html:translate("ifYouNeedHelp",true)+' <b><a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115003239466">'+translate("clickHere")+"</a></b>.",listeners:{render:function(b){b.getEl().on({mouseenter:function(){a.show()},mouseleave:function(){a.hide()},scope:b})}},constrain:true,closeAction:"hide",})}},layout:"anchor",items:[{html:'<div id="templateSignature" style="height: 110px; width: 426px; padding-left:25px"></div>',tooltip:translate("template.showInvoiceTotalInWordsTooltip",true)},{xtype:"box",html:'<div style="padding-left: 1px; font-size: 11px; color: #90909A; text-align:center;">'+translate("sizeSignature",true)+"</div>",tooltip:translate("template.showInvoiceTotalInWordsTooltip",true),afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -350px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -245px; top: -55px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("ifYouNeedHelp",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115003239466">'+translate("clickHere")+"</a>.</div></div></div></div>"}]}]}]},{xtype:"panel",border:false,bodyStyle:"background: #F3F5F7;",layout:{type:"hbox",pack:"end"},items:[{xtype:"button",name:"saveButton",width:150,height:38,text:translate("save",true),cls:"sm-button-primary save-button-templates",}]}]});Ext.define("AL.view.company.DocumentPicker",{extend:"Ext.view.View",alias:"widget.company_DocumentPicker",xtype:"documentpicker",itemSelector:"div.thumb-wrap",overItemCls:"documentOver",style:"background-color: #E8EBF0;",tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" style="margin: 20px 10px 20px 10px; width: auto; border: 4px solid transparent; text-align: center;">','<div style="margin: 0; width: 166px; height: 211px; background: #dbdbdb; display: block;">','<img {attributes} width="166" height="211" border="0" style="width: auto; height: 100%; border: 0px; box-shadow: 0 0 6px 0 rgba(0,0,0,0.15);" />','<div style="position: relative; top: -213px; left: 0px; padding-top: 120px; width: 166px; height: 211px; background: rgba(255,255,255,0.47); background-image: url(https://cdn1.getsoft.app/images/icon-edit.png); background-position: center 70px; background-repeat: no-repeat; text-align: center;">','<span style="font-size: 12px; color: #809BB6;">'+translate("edit",true)+" "+translate("template",true)+"</span>","</div>","</div>",'<div style="padding: 8px; width: 166px; background: #809BB6; font-size: big; color: white; text-align: center;">{documentName}</div>',"</div>","</tpl>"),store:{fields:[{name:"documentName",type:"string"},{name:"documentType",type:"string"},{name:"attributes",type:"string"}],data:[]},initComponent:function(){var c=this.initialConfig.isContained;var b=translate("invoice");if(c.keyCountry&&c.keyCountry=="mexico"){b=translate("specializedInvoice")}var d=this,a=d.getStore(),e=[{documentName:b.toUpperCase(),documentType:"invoice",attributes:""},{documentName:translate("estimate").toUpperCase(),documentType:"estimate",attributes:""},{documentName:translate("remission").toUpperCase(),documentType:"remission",attributes:""},{documentName:translate("transaction").toUpperCase(),documentType:"transaction",attributes:""},{documentName:translate("purchaseOrder").toUpperCase(),documentType:"purchaseOrder",attributes:""}];if(c.keyCountry&&c.keyCountry=="usa"){e.splice(2,1)}a.data=e;this.callParent(arguments)}});Ext.define("AL.view.company.TemplateWindow",{extend:"Ext.window.Window",alias:"widget.company_TemplateWindow",xtype:"templatewindow",width:904,modal:true,resizable:false,draggable:false,closable:false,border:false,style:"background: white;",layout:{type:"vbox",align:"stretch"},initComponent:function(){if(this["document"]){var a=this.document.get("documentType"),c=translate(a).toUpperCase(),b="";this.items[0].items[0].items[0].html='<div style="padding: 8px; background: #809BB6; font-size: big; color: white; overflow: hidden;"><div style="width: 50%; float: left; font-size: 12px;">'+c+'</div><div style="width: 50%; float: right; font-size: 11px; color: #D9E1E9; text-align: right;">'+translate("preview",true)+"</div></div>";if(a=="transaction"){b=translate("theseParametersAreOnlyActivatedInThisTemplateAndApplyEquallyTo",true)+" "+translate("transactionsIn")+" "+translate("and")+" "+translate("transactionsOut")+"."}else{b=""+translate("theseParametersAreOnlyActivatedInThisTemplate",true)+"."}this.items[0].items[1].items[0].items[0].html='<div style="padding-left: 1px; margin-bottom: 15px; font-size: 11px; color: #90909A;">'+b+"</div>"}this.callParent(arguments)},items:[{xtype:"panel",name:"windowPanel",margin:"30 30 0 30",border:false,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",bodyPadding:"0 30 0 30",flex:1,border:false,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box"},{xtype:"box",itemId:"previewBox",margin:"4 0 0 0",height:441,width:"100%",style:"background-color: #F3F5F7; border: 0;",autoEl:{tag:"iframe"}},]},{xtype:"form",name:"templateConfigurationForm",flex:1,border:false,items:[{xtype:"fieldset",cls:"unbordered-fieldset",padding:"0 30 15 30",title:'<b style="font-size: 16px; color: #58595F;">'+translate("templateConfigurationTitle",true)+"</b>",layout:{type:"vbox",align:"stretch"},fieldDefaults:{labelWidth:175,labelStyle:"margin-top: 5px; margin-bottom: 5px; font-size: 14px; color: #58595F;",fieldStyle:"font-size; 14px; color: #58595F;"},items:[{xtype:"box"},{xtype:"combo",name:"template",fieldLabel:translate("style",true),displayField:"name",valueField:"template",allowBlank:false,forceSelection:true,editable:false,queryMode:"local"},{xtype:"combo",name:"font",fieldLabel:translate("font",true),displayField:"label",valueField:"value",allowBlank:false,forceSelection:true,editable:false,store:{fields:["label","value"],data:[{label:"Helvetica",value:"HELVETICA"},{label:"Times New Roman",value:"TIMES"}]}},{xtype:"combo",name:"fontSize",fieldLabel:translate("font size",true),displayField:"label",valueField:"value",allowBlank:false,forceSelection:true,editable:false,store:{fields:["label","value"],data:[{label:translate("font.big",true),value:"BIG"},{label:translate("font.normal",true),value:"NORMAL"},{label:translate("font.small",true),value:"SMALL"}]}},{xtype:"numberfield",name:"itemsSpacing",fieldLabel:translate("spaceBetweenItems",true),allowBlank:false,minValue:0,decimalPrecision:2,allowExponential:false,allowOnlyWhitespace:false},{xtype:"checkboxfield",fieldLabel:translate("showTotalOfItems",true),name:"showItemsCount",inputValue:"yes"},{xtype:"combo",name:"transactionType",fieldLabel:translate("preview",true),displayField:"type",valueField:"value",forceSelection:true,editable:false,hidden:true,store:{fields:["type","value"],data:[{type:translate("transactionIn",true),value:"in"},{type:translate("transactionOut",true),value:"out"}]}}]},{xtype:"fieldset",name:"columnsConfigurationFieldSet",padding:"0 30 15 30",title:'<b style="font-size: 16px; color: #58595F;">'+translate("columnConfigurationInTheTemplate",true)+"</b>",layout:{type:"vbox",align:"stretch"},fieldDefaults:{labelWidth:175,labelStyle:"margin-top: 5px; margin-bottom: 5px; font-size: 14px; color: #58595F;",fieldStyle:"font-size; 14px; color: #58595F;"},items:[{xtype:"box",html:'<div style="padding-left: 1px; margin-bottom: 15px; font-size: 11px; color: #90909A;">'+translate("theTaxInformationYouActivateWillBeDisplayedInASingleColumn",true)+".</div>"},{xtype:"checkboxfield",fieldLabel:translate("discount",true),name:"showDiscount",inputValue:"yes"},{xtype:"checkboxfield",fieldLabel:translate("tax",true)+" ("+translate("value",true)+")",name:"showTaxValue",inputValue:"yes"},{xtype:"checkboxfield",fieldLabel:translate("tax",true)+" (%)",name:"showTaxPercentage",inputValue:"yes"}]},{xtype:"box",name:"helpPeruGeneralHalf",html:'<p style="font-size: 11px;color: #90909A;text-align: center;">Esta plantilla incluye todos los campos de dirección del cliente y de tu compañía</p>',hidden:true}]}]},{xtype:"panel",margin:"0 5 5 5",border:false,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:50,layout:{type:"hbox",pack:"center"},items:[{xtype:"label",name:"stampedInvoiceDefaultTemplateHelp",style:"margin: 24px; padding-left: 23px; padding-bottom: 15px; font-size: 11px; color: black",text:"Todos los "+translate("stampDocuments")+" se crean con la plantilla Clásico (carta).",hidden:true,labelAlign:"right"}]},{xtype:"container",flex:50,layout:{type:"hbox",pack:"end"},items:[{xtype:"button",name:"cancelButton",cls:"cancelButton",style:"margin-right: 0px;",text:translate("cancelAction",true)},{xtype:"button",name:"previewButton",cls:"actionButton",pressedCls:"actionButtonPressed",style:"margin-right: 0px;",text:translate("preview",true)},{xtype:"button",name:"applyButton",cls:"actionButton",pressedCls:"actionButtonPressed",text:translate("save",true)}]}]}]});Ext.define("AL.view.company.WindowInfoEdit",{extend:"Ext.form.Panel",alias:"widget.company_WindowInfoEdit",title:"",bodyPadding:"35 0 35 0",requires:["AL.view.ux.fields.Address","AL.view.ux.fields.Name"],bodyStyle:"background:transparent",border:false,items:[{xtype:"container",name:"leftContainer",flex:1,defaults:{xtype:"textfield",labelAlign:"right",labelPad:15,width:395,msgTarget:"side",labelWidth:140},items:[{xtype:"nameField",name:"nameComponent",fullWidth:240,labelWidth:140,defaults:{margin:"0 0 5 0.2",},orders:[{colombia:4}]},{xtype:"textfield",fieldLabel:translate("tradeName",true),name:"tradeName",colspan:2,allowBlank:true,hidden:true,minLength:5,maxLength:450,countries:["colombia"],tooltip:"Completa este campo si en en la casilla 36 del RUT tienes asignado un nombre comercial",orders:[{colombia:5}],listeners:{afterrender:function(b){var a=b.up("form");if(a.configs.country!="colombia"){b.allowBlank=true}}}},{xtype:"panel",border:false,cls:"container-visible",bodyCls:"container-visible",layout:{type:"table",columns:2,tableAttrs:{},tdAttrs:{valign:"top"}},defaultType:"textfield",items:[{fieldLabel:"Identificación",name:"identification",labelAlign:"right",labelPad:15,labelWidth:140,width:395,allowBlank:true,isRequiredForElectronicInvoicing:["colombia","argentina"],orders:[{colombia:1,argentina:2}]},{fieldLabel:"DV",labelPad:15,labelAlign:"right",labelWidth:60,name:"co_dv",allowBlank:true,hidden:true,regex:/^[0-9]*$/,maxLength:1,orders:[{colombia:2}]}]},{xtype:"addressField",name:"addressComponent",labelWidth:130,fullWidth:240,allowEmptyZipCode:false,componentView:"company_WindowInfoEdit",},{xtype:"combo",name:"regime",fieldLabel:translate("regime",true),valueField:"key",displayField:"display",forceSelection:true,allowBlank:false,editable:false,matchFieldWidth:false,queryMode:"local",displayTpl:'<tpl for=".">{display}</tpl>',countries:["colombia","republicaDominicana","mexico","peru","spain","chile","costaRica"],requires:["colombia","republicaDominicana","mexico","peru","spain","chile","costaRica"],listConfig:{width:300,tpl:'<tpl for="."><div class="x-boundlist-item">{display}</div></tpl>'},orders:[{colombia:5}]},{xtype:"combo",name:"economicActivity",emptyText:"Buscar...",fieldLabel:"Actividad económica",allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:1,listConfig:{width:300,loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',getInnerTpl:function(){return"{id} - {value}"}},countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},{xtype:"combo",name:"ivaCondition",emptyText:"Seleccionar",allowBlank:true,fieldLabel:"Condición de IVA",store:"IvaConditions",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,countries:["argentina"],requires:["argentina"]},{fieldLabel:translate("phone",true),name:"phone",allowBlank:true},{fieldLabel:translate("electronicEmail",true),name:"email",regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:'Este campo debe ser una dirección de correo electrónico con el formato "usuario@dominio.com"',allowBlank:true},{fieldLabel:"Sitio web",name:"website",allowBlank:true,hidden:true},{xtype:"combo",name:"kindOfPerson",id:"modalKindOfPerson",emptyText:"Seleccionar",allowBlank:true,fieldLabel:translate("kindOfPerson",true),store:"KindsOfPerson",valueField:"id",displayField:"value",queryMode:"local",editable:false,countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],hidden:true,orders:[{colombia:3}]},{xtype:"combo",name:"invoiceText",fieldLabel:"Documento de facturación",valueField:"value",displayField:"label",forceSelection:true,editable:false,hidden:true,disabled:true,cls:"x-item-disabled",orders:[{colombia:6}]},{xtype:"combo",name:"countryCode",fieldLabel:"País",valueField:"code",displayField:"name",forceSelection:true,emptyText:"Seleccionar",store:"CountriesList",hidden:true,disabled:true},{xtype:"combo",name:"timezone",fieldLabel:"Zona horaria",valueField:"timezone",displayField:"timezone",forceSelection:true,emptyText:"Seleccionar",store:"TimezonesList",hidden:true,disabled:true},{xtype:"combo",name:"currency",fieldLabel:"Moneda",store:"CurrenciesAll",valueField:"code",displayField:"comboName",submitValue:true,editable:false,forceSelection:true,hidden:true},{xtype:"combo",name:"decimalPrecision",fieldLabel:"Precisión decimal",valueField:"decimalPrecision",displayField:"decimalPrecision",forceSelection:true,hidden:true,allowBlank:false,editable:false,store:{fields:["decimalPrecision"],data:[{decimalPrecision:"0"},{decimalPrecision:"1"},{decimalPrecision:"2"},{decimalPrecision:"3"},{decimalPrecision:"4"}]}},{xtype:"combo",name:"exportablesDecimalSeparator",fieldLabel:"Separador decimal para exportables",valueField:"exportablesDecimalSeparator",displayField:"exportablesDecimalSeparator",forceSelection:true,hidden:true,editable:false,store:{fields:["exportablesDecimalSeparator"],data:[{exportablesDecimalSeparator:"."},{exportablesDecimalSeparator:","}]}},{xtype:"hidden",name:"locale"},{xtype:"filefield",name:"logo",fieldLabel:"Logo",buttonText:"Seleccionar",hidden:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -236px;top: -57px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si necesitas ayuda para agregar el logo, haz <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/208577146">clic aquí</a>.</div></div></div></div>'},{xtype:"checkbox",name:"isActiveElectronicInvoicing",width:405,fieldLabel:"Activar facturación electrónica",tooltip:"Selecciona esta opción si deseas "+translate("stamp")+" documentos electrónicos, validos ante "+translate("governmentEntity"),inputValue:true,uncheckedValue:false,hidden:true,countries:["peru"]},{xtype:"combo",name:"identificationType",id:"modalIdentificationType",emptyText:"Seleccionar",allowBlank:true,fieldLabel:translate("identificationType",true),store:"IdentificationTypes",valueField:"key",displayField:"value",displayTpl:'<tpl for=".">{value} ({abbreviature})</tpl>',forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{value} ({abbreviature})</div></tpl>'},queryMode:"local",editable:false,countries:["colombia","costaRica","argentina"],isRequiredForElectronicInvoicing:["colombia","costaRica","argentina"],hidden:true,orders:[{colombia:0,costaRica:1,argentina:1}]},{xtype:"combo",name:"stampVersion",hidden:true,fieldLabel:"Versión",valueField:"mxStampVersionOption",displayField:"mxStampVersionOption",store:{fields:["mxStampVersionOption"],data:[{mxStampVersionOption:"3.2"},{mxStampVersionOption:"3.3"}]}},{xtype:"label",name:"mxCertificateTitle",text:"",html:'<div class="no-create-icon-title" style="margin-top: 20px;"><h1 style="font-size:20px; margin-left: 20px; margin-top:20px; display: inline;">'+translate("certificate",true)+' para timbrar CFDI</h1><div id="hasCertModal" style="display: none;"><span style="color: #00B19D; margin-left: 25px;"><svg class="icon small" style="color: #00B19D;" ><use xlink:href="/images/smile-icons.svg#success"></use></svg>Configurado</span></div></div>',hidden:true,},{xtype:"container",width:500,defaults:{xtype:"textfield",labelAlign:"right",margin:"0 5",labelPad:15,width:395,msgTarget:"side",labelWidth:140},items:[{xtype:"filefield",name:"certificate",fieldLabel:translate("certificate")+" CSD (.cer)",buttonText:"Seleccionar",margin:"5 0 0 20",width:375,align:"center",hidden:true},{xtype:"filefield",name:"privateKey",fieldLabel:"Llave privada (.key)",buttonText:"Seleccionar",margin:"5 0 0 20",width:375,align:"center",hidden:true},{xtype:"textfield",name:"keyPassword",fieldLabel:"Contraseña",inputType:"password",margin:"5 0 0 20",width:375,align:"center",hidden:true},{xtype:"displayfield",itemId:"certificateSerialDisplayField",fieldLabel:"Serial:",hidden:true},{xtype:"displayfield",itemId:"certificateDueDateDisplayField",fieldLabel:"Vencimiento:",hidden:true},{xtype:"button",name:"editCertificates",text:'<svg class="icon small"><use xmlns:xlink="http://www.w3.org/1999/xlink" style="color: #767681" xlink:href="/images/smile-icons.svg#edit"></use></svg>',style:"border-radius: 100%",height:30,width:30,margin:"-90 0 0 410",hidden:true},{xtype:"button",name:"closeCertificates",text:'<svg class="icon small"><use xmlns:xlink="http://www.w3.org/1999/xlink" style="color: #767681" xlink:href="/images/smile-icons.svg#close"></use></svg>',style:"border-radius: 100%",height:30,width:30,margin:"-120 0 0 410",hidden:true},{xtype:"box",id:"mxPacText",html:'<div style="margin-top:25px; margin-left:40px;">Nuestro PAC autorizado para generar CFDI es Quadrum, si deseas conocer cómo firmar el manifiesto de autorización, haz <a href="https://ayudas.getsoft.app/es/articles/1711492#firma-tu-contrato-con--quadrum" target="_blank"><span style="font-weight: bold; text-decoration: underline">clic aquí</span>.</a></div>',hidden:true},]},]},],buttons:[{text:"Guardar",action:"saveCompanyInfo",disabled:false,hidden:true,id:"modalSaveCompanyInfo"}],getFieldValuesAsMetadata:function(){var d=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"colombia":var c=this.down("checkbox[name=isActiveElectronicInvoicing]");var f=this.down("textfield[name=tradeName]");d={isActiveElectronicInvoicing:c.getValue(),tradeName:f.getValue()};break;case"peru":case"mexico":var c=this.down("checkbox[name=isActiveElectronicInvoicing]");d={isActiveElectronicInvoicing:c.getValue()};break;case"costaRica":var c=this.down("checkbox[name=isActiveElectronicInvoicing]"),e=this.down("combo[name=economicActivity]");d={isActiveElectronicInvoicing:c.getValue(),economicActivity:e.getValue()};break;case"argentina":var c=this.down("checkbox[name=isActiveElectronicInvoicing]"),b=this.down("combo[name=ivaCondition]");d={isActiveElectronicInvoicing:c.getValue(),ivaCondition:b.getValue()};break}return d},setFieldValuesFromMetadata:function(e){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"colombia":case"peru":case"mexico":if(typeof e.isActiveElectronicInvoicing!=="undefined"){var d=this.down("checkbox[name=isActiveElectronicInvoicing]");d.setValue(e.isActiveElectronicInvoicing)}if(typeof e.tradeName!=="undefined"){var g=this.down("textfield[name=tradeName]");g.setValue(e.tradeName)}break;case"costaRica":if(typeof e.isActiveElectronicInvoicing!=="undefined"){var d=this.down("checkbox[name=isActiveElectronicInvoicing]");d.setValue(e.isActiveElectronicInvoicing)}if(typeof e.economicActivity!=="undefined"){var f=this.down("combo[name=economicActivity]");var b=f.getStore();if(b.hasLoaded()){f.setValue(e.economicActivity)}else{b.on("load",function(h){f.setValue(e.economicActivity)})}}break;case"argentina":if(typeof e.isActiveElectronicInvoicing!=="undefined"){var d=this.down("checkbox[name=isActiveElectronicInvoicing]");d.setValue(e.isActiveElectronicInvoicing)}if(typeof e.ivaCondition!=="undefined"){var c=this.down("combo[name=ivaCondition]");var b=c.getStore();if(b.hasLoaded()){c.setValue(e.ivaCondition)}else{b.on("load",function(h){c.setValue(e.ivaCondition)})}}break}},});Ext.define("AL.view.common.FormSignature",{extend:"Ext.panel.Panel",alias:"widget.common_FormSignature",xtype:"formsignature",configs:{disableSignatureEditing:false,showFooter:true},initComponent:function(){var b=this;var a=[{xtype:"container",margin:"60 0 60 36",layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",name:"signatureBox",configs:{maxWidth:300,maxHeight:86,madeByText:(translate("signatureMadeBy",true)).toUpperCase()},html:'<div class="form-add-common-image-zone" onselectstart="return false;"><div style="font-size: 24px; font-weight: bold; padding-top: 23px;">'+translate("useMySignature",true)+'</div><div style="font-size: 12px;">178 x 51 '+translate("pixels")+"</div></div>",listeners:{render:function(d){var c=d.up("formsignature");if(!c.configs.disableSignatureEditing){b.promptFileUploadWindowOnClick(d,"signatureUrl",true,{asyncUpload:true,title:translate("changeSignature",true),url:"/company/set-signature/format/json",fieldName:"signature",fieldLabel:translate("signature",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingSignature",true)})}}}}]}];this.items=a;this.callParent()},listeners:{afterrender:function(c){if(c.configs){var b=c.down("box[name=signatureBox]");if(c.configs.userSignatureUrl){var a=new Image;a.onload=function(j){var h=(a.width*Math.min(b.configs.maxHeight,a.height))/a.height;var g="";if(h<b.configs.maxWidth){g="width: auto; max-height: "+b.configs.maxHeight+"px;"}else{g="height: auto; max-width: "+b.configs.maxWidth+"px;"}var f="1px solid rgba(151, 151, 151, 0.4);";var d='<div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+b.configs.madeByText+"</div></dib>";if(!c.configs.showFooter){d="</div>";f="0px;"}b.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" style="border-bottom:'+f+'" onselectstart="return false;"><img id="user-signature-form" name="user-signature-form" src="'+c.configs.userSignatureUrl+'" style="margin: 0 auto; '+g+'" /></div>'+d)};a.src=c.configs.userSignatureUrl}else{if(c.configs.disableSignatureEditing){b.update()}}}}},promptFileUploadWindowOnClick:function(d,a,b,g,f){var e=false;var c=this;d.getEl().on("click",function(j,m){if(e){return}e=true;var l=false;var h=d.getEl().getHTML();var k=Ext.create("AL.view.company.FileUploadWindow",{asyncUpload:g.asyncUpload,title:g.title,url:g.url,fieldName:g.fieldName,fieldLabel:g.fieldLabel,buttonText:g.buttonText,helpText:g.helpText,height:230,onSubmit:function(n,o){l=true;Ext.create("Ext.fx.Anim",{target:n,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){n.close()}});Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){d.update('<div class="form-add-invoice-image-zone-loading"></div>');Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(o,n,p){e=false;Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var q=new Image;q.onload=function(v){var u=(q.width*Math.min(d.configs.maxHeight,q.height))/q.height;var t="";if(u<d.configs.maxWidth){t="width: auto; max-height: "+d.configs.maxHeight+"px;"}else{t="height: auto; max-width: "+d.configs.maxWidth+"px;"}if(b){var s="1px solid rgba(151, 151, 151, 0.4);";var r='<div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+d.configs.madeByText+"</div></dib>";if(!c.configs.showFooter){r="</div>";s="0px;"}d.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" style="border-bottom:'+s+'" onselectstart="return false;"><img id="user-signature-form" name="user-signature-form" src="'+n[a]+'" style="margin: 0 auto; '+t+'" /></div>'+r)}else{d.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img id="user-signature-form" name="user-signature-form" src="'+n[a]+'" style="margin: 0 auto; '+t+'" /></div>')}if(f){f(n[a])}Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:0},to:{opacity:1}})};q.src=n[a]}})},onFailure:function(o,n,q){e=false;Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){d.update(h);Ext.create("Ext.fx.Anim",{target:d,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof n=="string"||!n.cause){Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}else{var p=n.title?n.title:translate("error",true);Ext.MessageBox.alert(p,n.cause)}},onClose:function(n){if(!l){e=false}}});k.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:k,duration:300,from:{opacity:0},to:{opacity:1}})},d)}});Ext.define("AL.view.company.FormExternalPaymentsEditSwitch",{extend:"Ext.tab.Panel",alias:"widget.company_FormExternalPaymentsEditSwitch",activeTab:0,cls:"modern-tab-panel",bodyCls:"modern-tab-panel-body",idCompany:null,environment:"production",initComponent:function(){var b=this;var c=Ext.create("AL.store.OnlinePaymentListByCountry",{environment:b.environment});var a=[];Ext.each(c.data.items,function(d){var e=d.data;if(e.country==b.country){var f=e.onlinePayments;Ext.each(f,function(g){a.push(g)})}});this.items=a;this.callParent(arguments)},buttons:[{text:translate("cancelAction",true),action:"cancel",style:"margin-left: 20px;",cls:"sm-button-basic",width:157,height:38},{text:translate("save",true),action:"saveExternalPaymentsInfo",style:"margin-left: 20px;",cls:"sm-button-primary",name:"button-save",width:157,height:38}]});Ext.define("AL.view.externalpayments.FormEdit",{extend:"Ext.form.Panel",alias:"widget.externalpayments_FormEdit",title:"",bodyPadding:5,width:1024,defaults:{labelWidth:245,labelAlign:"right",width:500,labelPad:15},items:[{xtype:"checkboxfield",fieldLabel:"Recibir "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no",cls:"checkBox-switch"},{xtype:"fieldset",title:"",itemId:"testParameters",padding:35,layout:"anchor",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 180px;",fieldDefaults:{layout:"100%",labelWidth:110,width:380},items:[{xtype:"textfield",fieldLabel:translate("identification",true),name:"identification",allowBlank:false,tooltip:"Ingresa "+translate("theIdentification")+" "+translate("identification")+" que se encuentra afiliado a "+translate("providerPayments",true)+"."},{xtype:"textfield",fieldLabel:translate("merchantId",true),name:"merchantId",tooltip:"Agrega la identificación de comercio asignada por "+translate("providerPayments",true)+".",maxLength:50,minValue:0},{xtype:"textfield",fieldLabel:translate("email",true),name:"email",tooltip:"Indica el correo electrónico de contacto para la activación.",allowBlank:false,regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:'Este campo debe ser una dirección de correo electrónico con el formato "usuario@dominio.com"'},{xtype:"textfield",fieldLabel:translate("phone",true),name:"phone",tooltip:"Agrega el número telefónico de contacto para la activación.",allowBlank:false},{name:"editButton",xtype:"box",style:"text-align: right; margin-right: 46px;",html:'<a id="editInfoVisanet" class="button basic small" href="#"><svg class="icon small"><use xlink:href="/images/smile-icons.svg#edit"></use></svg> Editar</a>',hidden:true}]},{xtype:"box",html:'<hr style="border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">'},{xtype:"box",html:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos dominicanos (DOP).</div>'}],disabledControls:function(c){var d=this.down("textfield[name=identification]");var e=this.down("textfield[name=merchantId]");var b=this.down("textfield[name=email]");var a=this.down("textfield[name=phone]");if(c){d.enable();e.enable();b.enable();a.enable()}else{d.disable();e.disable();b.disable();a.disable()}},getFieldValuesAsMetadata:function(){var d=Ext.ComponentQuery.query("company_FormExternalPaymentsEditSwitch");var c=null;var b=this.country?this.country:null;if(!b&&d){b=d.country}switch(b){case"republicaDominicana":var f=this.down("textfield[name=identification]"),e=this.down("textfield[name=phone]"),a=this.down("textfield[name=email]");c={identification:f.getValue(),phone:e.getValue(),email:a.getValue()};break}return c},setFieldValuesFromMetadata:function(c){var d=Ext.ComponentQuery.query("company_FormExternalPaymentsEditSwitch")[0];var b=this.country?this.country:null;if(!b&&d){b=d.country}switch(b){case"republicaDominicana":if(typeof c.visanet!=="undefined"){if(typeof c.visanet.identification!=="undefined"){var f=this.down("textfield[name=identification]");f.setValue(c.visanet.identification)}if(typeof c.visanet.phone!=="undefined"){var e=this.down("textfield[name=phone]");e.setValue(c.visanet.phone)}if(typeof c.visanet.email!=="undefined"){var a=this.down("textfield[name=email]");a.setValue(c.visanet.email)}}}}});Ext.define("AL.view.externalpayments.Welcome",{extend:"Ext.form.Panel",alias:"widget.externalpayments_Welcome",title:"",bodyPadding:5,width:1024,cls:"external-payments-welcome",items:[{xtype:"box",html:'<div id="title">Recibe tus pagos en línea con '+translate("providerPayments",true)+"</div>"},{xtype:"box",html:'<br><div class="text">Afíliate a '+translate("providerPayments",true)+" y recibe de una forma rápida y segura los pagos de tus clientes con solo compartir el Estado de cuenta.</div>"},{xtype:"box",html:'<br><div class="text">Comienza con una tasa inicial del 4.5% que podrá mejorar al aumentar los pagos.</div>'},{xtype:"box",style:"margin-left: 252px;",html:'<br><br><br><div><button id="affiliate" type="button">Ya estoy afiliado</button><button id="joinMe" type="button">Afilliarme a '+translate("providerPayments",true)+"</button></div><br>"}]});Ext.define("AL.view.externalpayments.FormEditNequi",{extend:"Ext.form.Panel",alias:"widget.externalpayments_FormEditNequi",title:"",bodyPadding:5,width:1024,defaults:{labelWidth:245,labelAlign:"right",width:920,labelPad:15},initComponent:function(){var a=[{xtype:"checkboxfield",fieldLabel:translate("activate",true)+" "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no",cls:"checkBox-switch",allowBlank:false},{xtype:"fieldset",title:"",itemId:"testParameters",padding:35,layout:"anchor",name:"fieldset",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 30px; border:none;",fieldDefaults:{layout:"100%",labelWidth:110,width:680},items:[{margin:"0 0 0 0",xtype:"box",name:"title",html:this.titleHtml}]},{xtype:"fieldset",title:"",padding:0,layout:"anchor",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 30px; border:none;",fieldDefaults:{layout:"100%",labelWidth:110,width:680},items:[{margin:"0 0 0 0",xtype:"box",name:"help1",html:this.subtitleHtml}]},{xtype:"box",html:this.footerHtml},{xtype:"box",html:this.subfooterHtml}];this.items=a;this.callParent()},disabledControls:function(c){var d=this.down("textfield[name=identification]");var e=this.down("textfield[name=merchantId]");var b=this.down("textfield[name=email]");var a=this.down("textfield[name=phone]");if(c){d.enable();e.enable();b.enable();a.enable()}else{d.disable();e.disable();b.disable();a.disable()}},getFieldValuesAsMetadata:function(){var c=null;var b=this.country?this.country:null;switch(b){case"republicaDominicana":var e=this.down("textfield[name=identification]"),d=this.down("textfield[name=phone]"),a=this.down("textfield[name=email]");c={identification:e.getValue(),phone:d.getValue(),email:a.getValue()};break}return c},setFieldValuesFromMetadata:function(c){var b=this.country?this.country:null;switch(b){case"republicaDominicana":if(typeof c.visanet!=="undefined"){if(typeof c.visanet.identification!=="undefined"){var e=this.down("textfield[name=identification]");e.setValue(c.visanet.identification)}if(typeof c.visanet.phone!=="undefined"){var d=this.down("textfield[name=phone]");d.setValue(c.visanet.phone)}if(typeof c.visanet.email!=="undefined"){var a=this.down("textfield[name=email]");a.setValue(c.visanet.email)}}}}});Ext.define("AL.view.externalpayments.FormEditPayU",{extend:"Ext.form.Panel",alias:"widget.externalpayments_FormEditPayU",title:"",bodyPadding:5,width:1100,defaults:{labelWidth:245,labelAlign:"right",width:660,labelPad:15},initComponent:function(){var a=[{xtype:"checkboxfield",fieldLabel:translate("activate",true)+" "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no",cls:"checkBox-switch",allowBlank:false},{xtype:"fieldset",title:"",itemId:"testParameters",padding:35,labelAlign:"right",layout:"anchor",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 160px;",fieldDefaults:{layout:"100%",labelWidth:230,width:550},items:[{margin:"0 0 0 0",xtype:"box",name:"help1",html:this.titleHtml},{xtype:"textfield",fieldLabel:translate("apiKey",true),name:"apiKey",tooltip:"Puedes encontrarla en el panel de configuración/información técnica de PayU",allowBlank:false,labelAlign:"right"},{xtype:"textfield",fieldLabel:translate("merchantId",true),name:"merchantId",tooltip:"Puedes encontrarla en el panel de configuración/información técnica de PayU",allowBlank:false,maxLength:12,regex:/^([0-9]+(\.[0-9]+)?)$/,minValue:0,labelAlign:"right"},{xtype:"textfield",fieldLabel:translate("accountId",true),name:"accountId",tooltip:"Puedes encontrarla en el panel de cuentas de PayU",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,maxLength:6,minValue:0,labelAlign:"right"},{xtype:"textfield",fieldLabel:"Secret key",name:"secretKey",tooltip:"Puedes encontrarla en el panel de cuentas de PayU",maxLength:512,hidden:true,labelAlign:"right"},{xtype:"checkboxfield",fieldLabel:"Monto mínimo de pago",name:"restrictMinimumPayment",tooltip:"Activando esta opción, estableces un monto mínimo para recibir pagos de tus clientes",inputValue:"yes",uncheckedValue:"no",labelAlign:"right"},{xtype:"textfield",regex:/^([0-9]+(\.[0-9]+)?)$/,fieldLabel:"Establecer monto mínimo de pago",name:"minimumAmount",minValue:0,disabled:true,labelAlign:"right"},{padding:"0 0 0 0",xtype:"box",name:"help2",html:this.subtitleHtml},]},{xtype:"box",html:this.footerHtml},{xtype:"box",html:this.subfooterHtml}];this.items=a;this.callParent()},disabledControls:function(a){var e=this.down("textfield[name=apiKey]");var d=this.down("textfield[name=merchantId]");var f=this.down("textfield[name=accountId]");var c=this.down("checkboxfield[name=restrictMinimumPayment]");var b=this.down("textfield[name=minimumAmount]");if(a){e.enable();d.enable();f.enable();c.enable();b.enable()}else{e.disable();d.disable();f.disable();c.disable();b.disable()}},getFieldValuesAsMetadata:function(){var a=null;return a},setFieldValuesFromMetadata:function(a){}});Ext.define("AL.view.externalpayments.FormEditRappiPay",{extend:"Ext.form.Panel",alias:"widget.externalpayments_FormEditRappiPay",title:"",bodyPadding:5,width:1100,defaults:{labelWidth:245,labelAlign:"right",width:660,labelPad:15},initComponent:function(){var a=[{xtype:"checkboxfield",fieldLabel:translate("activate",true)+" "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no",cls:"checkBox-switch",allowBlank:false},{xtype:"fieldset",title:"",id:"fieldsetNotification",padding:10,labelAlign:"right",hidden:true,layout:"anchor",style:"border: 0.8px solid #FFD772; box-sizing: border-box; border-radius: 5px; margin-left: 160px; background-color: #FFD772;",fieldDefaults:{layout:"100%",labelWidth:230,width:550},items:[{margin:"0 0 0 0",xtype:"box",name:"help1",html:'<h1>Para continuar <a style="font-weight:bold; color: #00b19d;" href="https://tienda.rappipay.com" target="_blank">inicia sesión aquí</a> y termina el proceso de activación con RappiPay.</h1>'}]},{xtype:"fieldset",title:"",itemId:"testParameters",padding:35,labelAlign:"right",layout:"anchor",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 160px;",fieldDefaults:{layout:"100%",labelWidth:230,width:550},items:[{margin:"0 0 0 0",xtype:"box",name:"help1",html:this.titleHtml},{xtype:"textfield",fieldLabel:translate("Nombre del negocio",true),name:"name",tooltip:"Nombre del negocio con el que se creará la cuenta para el panel de RappiPay",allowBlank:false,labelAlign:"right",disabled:true},{xtype:"textfield",fieldLabel:translate("Categoría del negocio",true),name:"category",tooltip:"Ejemplo: Restaurante, Joyería, etc ...",allowBlank:false,labelAlign:"right",disabled:true},{xtype:"textfield",fieldLabel:translate("phone",true),name:"phone",tooltip:"Número de teléfono con el que se creará la cuenta para el panel de RappiPay",allowBlank:false,maxLength:20,regex:/^([0-9]+(\.[0-9]+)?)$/,minValue:0,labelAlign:"right",disabled:true},{xtype:"textfield",fieldLabel:"Correo electrónico",name:"email",allowBlank:false,blankText:"Este campo es obligatorio",regex:/^[A-Za-z0-9!#$%&'*+-/=?^_`{|}~]+@[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?(.[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?)*$/i,regexText:"Tiene que ingresar una cuenta de correo válida",tooltip:"Correo con el que se creará la cuenta panel de RappiPay",labelAlign:"right",disabled:true},{xtype:"textfield",name:"password",tooltip:"Contraseña con la que se creará la cuenta para el panel de RappiPay",fieldLabel:"Contraseña",allowBlank:false,blankText:"Este campo es obligatorio",inputType:"password",labelAlign:"right",disabled:true},{xtype:"textfield",name:"oldState",hidden:true},{padding:"0 0 0 0",xtype:"box",name:"help2",html:this.subtitleHtml},]},{xtype:"box",html:this.footerHtml},{xtype:"box",html:this.subfooterHtml}];this.items=a;this.callParent()},enableControls:function(e){var d=this.down("textfield[name=name]");var f=this.down("textfield[name=category]");var a=this.down("textfield[name=phone]");var c=this.down("textfield[name=email]");var b=this.down("textfield[name=password]");if(e){d.enable();f.enable();a.enable();c.enable();b.enable()}else{d.disable();f.disable();a.disable();c.disable();b.disable()}}});Ext.define("AL.view.externalpayments.FormEditTpaga",{extend:"Ext.form.Panel",alias:"widget.externalpayments_FormEditTpaga",title:"",bodyPadding:5,width:1100,defaults:{labelWidth:245,labelAlign:"right",width:660,labelPad:15},initComponent:function(){var a=[{xtype:"checkboxfield",fieldLabel:translate("activate",true)+" "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no",cls:"checkBox-switch",allowBlank:false},{xtype:"fieldset",title:"",itemId:"testParameters",padding:35,labelAlign:"right",layout:"anchor",style:"0.8px solid #CCCCCC;box-sizing: border-box; border-radius: 5px; margin-left: 160px;",fieldDefaults:{layout:"100%",labelWidth:230,width:550},items:[{margin:"0 0 0 0",xtype:"box",name:"help1",html:this.titleHtml},{xtype:"textfield",fieldLabel:"Usuario",name:"username",tooltip:"Nombre de usuario con el que se creó la cuenta en Tpaga",allowBlank:false,blankText:"Este campo es obligatorio",labelAlign:"right",disabled:true},{xtype:"textfield",fieldLabel:"Contraseña",name:"pass",tooltip:"Contraseña con la que se creó la cuenta en Tpaga",allowBlank:false,blankText:"Este campo es obligatorio",inputType:"password",labelAlign:"right",disabled:true},{xtype:"textfield",name:"oldState",hidden:true},{padding:"0 0 0 0",xtype:"box",name:"help2",html:this.subtitleHtml},]},{xtype:"box",html:this.footerHtml},{xtype:"box",html:this.subfooterHtml}];this.items=a;this.callParent()},enableControls:function(b){var c=this.down("textfield[name=username]");var a=this.down("textfield[name=pass]");if(b){c.enable();a.enable()}else{c.disable();a.disable()}}});Ext.define("AL.view.ux.form.Switch",{extend:"Ext.panel.Panel",alias:"widget.switch",border:false,initComponent:function(){var d=this.label;var c=this.options;var g=this.afterBodyEl;if(!this.options){return console.warn("Attribute options is not found")}var e="";if(d){d.style=d.style?d.style:"";d.cls=d.cls?d.cls:"";e='<div style="'+d.style+'" class="label '+d.cls+'">'+d.text+"</div>"}if(c){for(var b=0;b<c.length;b++){var f=c[b];if(!f.value||!f.id||!f.text){return console.warn("Parameters `value`, `id` or `text` not found")}if(typeof f.name=="undefined"){f.name="selector"}e+='<input value="'+f.value+'" type="radio" id="'+f.id+'" name="'+f.name+'" '+(f.checked===true?'checked="true"':"")+'><label for="'+f.id+'">'+f.text+"</label>"}}if(g){e+=g}var a=[{xtype:"box",cls:"horizontal-label-radio-group switch",html:e}];this.items=a;this.callParent()},getOptionSelected:function(){var e=this.optionSelected;var b=this.options;if(b&&!e){for(var a=0;a<b.length;a++){var d=b[a];var c=Ext.get(d.id);if(c){if(c.dom.getAttribute("checked")=="true"){e=d;break}}}}return e},findOptionById:function(c){var a=null;var b=Ext.Array.filter(this.options,function(d){return d.value===c});if(b.length>0){a=b[0]}return a},select:function(c,b){if(typeof c!=="object"){return console.warn("The parameter option is not a object")}if(!c.value||!c.id||!c.text){return console.warn("Parameters `value`, `id` or `text` not found")}var a=Ext.get(c.id);if(a){a.dom.checked=true}this.optionSelected=c;if(b){return}this.fireEvent("change",c)},setValue:function(b,c){var a=c?false:true;this.select(this.findOptionById(b),a)},getValue:function(){return this.getOptionSelected().value},listeners:{afterrender:function(){var e=this;var b=this.options;if(b){for(var a=0;a<b.length;a++){var d=b[a];var c=Ext.get(d.id);if(c){c.setClickEvent=function(f){this.on("click",function(){e.optionSelected=f;e.fireEvent("change",f)})};c.setClickEvent(d)}}}}}});Ext.define("AL.view.ux.fields.EditableList",{extend:"Ext.panel.Panel",alias:"widget.editableListComponent",width:300,padding:"0 0 10 25",items:[],initComponent:function(){var b=this;var a={};b.items=[a,{xtype:"label",name:"dynamicFieldsPanelLabel",text:b.fieldLabel||"",style:b.labelStyle||"font-weight: bold; color: #767681; font-family: Roboto; font-size: 14px;",padding:b.modalConfig.dynamicField.labelPadding,listeners:{afterrender:function(c){var d=false;if(b.allowBlank!=undefined){d=b.allowBlank}if(!d){c.getEl().setHTML(b.fieldLabel+'<span class="req">*</span>')}}}},{xtype:"panel",fieldLabel:"Principal",labelAlign:"top",labelStyle:"margin-bottom: 10px; font-weight: bold",name:"dynamicFieldsPanel",padding:b.modalConfig.dynamicField.padding,items:[]},{xtype:"button",text:(b.modalConfig.addDynamicFieldButton.icon||"")+b.modalConfig.addDynamicFieldButton.text,cls:"sm-button-clear sm-button-clear-without-hover",style:b.modalConfig.addDynamicFieldButton.style||"float:right; border-width: 1px; right: 43px; background: rgba(255, 255, 255) !important; margin-top: 5px",handler:function(c){b.createDynamicField()}},{xtype:"panel",border:false,name:"list",items:[]},];if(!b.storeObject){b.storeObject=Ext.create("AL.store."+b.storeConfig.name);if(b.storeConfig.autoLoad===true){b.storeObject.load()}}b.callParent()},listeners:{afterrender:function(a){a.createDynamicField()}},createDynamicField:function(a){var c=this;var b=this.down("panel[name=dynamicFieldsPanel]");b.add({xtype:"panel",style:"position:relative;",items:[{xtype:"combo",name:"EditableListElement-"+b.items.length,emptyText:c.emptyText||"Buscar...",width:c.modalConfig.dynamicField.width||c.width-70,minChars:c.minChars,valueField:c.valueField,displayField:c.displayField,displayTpl:c.displayTpl,minChars:c.storeConfig.minChars,value:a||null,forceSelection:true,autoSelect:false,queryMode:c.storeConfig.queryMode,queryParam:c.storeConfig.queryParam,store:Ext.create("AL.store."+c.storeConfig.name,{autoLoad:true}),listConfig:c.listConfig,listeners:{beforerender:function(e){var d=e.getStore();var f=e.name;if(d.hasLoaded()){e.setValue(a)}else{d.on("storeloaded",function(){var g=Ext.ComponentQuery.query("combo[name="+f+"]")[0];if(g){g.setValue(a)}});d.on("load",function(g){d.fireEvent("storeloaded");d.suspendEvent("storeloaded")})}}},},{xtype:"button",height:16,width:16,style:"position: absolute; right:15px; top:3px; cursor:pointer;",baseCls:"none",handler:function(e){var d=e.up("panel");d.destroy()}}]})},setElements:function(c){var b=this;if(c!=null&&c.length>0){var a=this.down("panel[name=dynamicFieldsPanel]");a.removeAll();c.forEach(function(d){b.createDynamicField(d)})}b.elements=c},getElements:function(){var b=this;var c=[];var a=b.down("panel[name=dynamicFieldsPanel]");a.items.items.forEach(function(d){c.push(d.items.items[0].getValue())});b.elements=c;this.isValid;return b.elements},isValid:function(){var c=true;var b=this;var a=b.down("panel[name=dynamicFieldsPanel]");a.items.items.forEach(function(d){dynamicElementCombo=d.items.items[0];if(dynamicElementCombo&&dynamicElementCombo.getValue()&&dynamicElementCombo.getValue()!=""&&!dynamicElementCombo.getSelectedRecord()){invalidMessage=b.invalidSelectionMessage,dynamicElementCombo.markInvalid(invalidMessage);c=false}});if(this.allowBlank===false&&this.elements.length<=0){c=false}return c},getStore:function(){return this.storeObject}});Ext.define("AL.view.client.ClientsCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.client_ClientsCombo",name:"idClient",fieldLabel:"Contacto",allowBlank:true,valueField:"idLocal",displayField:"nameIdentification",store:"Clients",typeAhead:true,minChars:0,emptyText:"Selecciona el contacto",width:300,labelWidth:60,matchFieldWidth:false,listConfig:{width:300},forceSelection:true,});Ext.define("AL.store.Companies",{extend:"Ext.data.Store",model:"AL.model.Company",autoLoad:false,proxy:{type:"ajax",url:"/company/retrieve-info/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.InvoiceTemplates",{extend:"Ext.data.Store",model:"AL.model.InvoiceTemplate",autoLoad:false,proxy:{type:"ajax",url:"/configuration/retrieve-invoice-templates/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.TemplatesPdf",{extend:"Ext.data.Store",fields:["id","idLocal","name","template","companysDefault","pageSize","font","fontSize","itemsSpacing","showItemsCount"],data:[{id:"1",idLocal:"1",name:translate("classic",true),template:"general",companysDefault:false,pageSize:"letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"},{id:"2",idLocal:"2",name:"Simple",template:"simple",companysDefault:false,pageSize:"letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"},{id:"3",idLocal:"3",name:"Moderno",template:"modern",companysDefault:false,pageSize:"letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"},{id:"4",idLocal:"4",name:translate("classic",true),template:"general_half",companysDefault:false,pageSize:"half-letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"},{id:"5",idLocal:"5",name:"Compacto",template:"compact_half",companysDefault:false,pageSize:"half-letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"}],basic:[{id:"1",idLocal:"1",name:translate("classic",true),template:"general",companysDefault:false,pageSize:"letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"},{id:"2",idLocal:"2",name:translate("classic",true),template:"general_half",companysDefault:false,pageSize:"half-letter",font:"HELVETICA",fontSize:"NORMAL",itemsSpacing:"1.00",showItemsCount:"no"}]});Ext.define("AL.store.StampReceptionMails",{extend:"Ext.data.Store",model:"AL.model.StampReceptionMail",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/stamp-reception-mail/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Ver detalle]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.TimezonesList",{extend:"Ext.data.Store",fields:["timezone"],data:[{timezone:"Atlantic/Azores"},{timezone:"Africa/Abidjan"},{timezone:"Africa/Accra"},{timezone:"Africa/Addis_Ababa"},{timezone:"Africa/Algiers"},{timezone:"Africa/Asmara"},{timezone:"Africa/Asmera"},{timezone:"Africa/Bamako"},{timezone:"Africa/Bangui"},{timezone:"Africa/Banjul"},{timezone:"Africa/Bissau"},{timezone:"Africa/Blantyre"},{timezone:"Africa/Brazzaville"},{timezone:"Africa/Bujumbura"},{timezone:"Africa/Cairo"},{timezone:"Africa/Casablanca"},{timezone:"Africa/Ceuta"},{timezone:"Africa/Conakry"},{timezone:"Africa/Dakar"},{timezone:"Africa/Dar_es_Salaam"},{timezone:"Africa/Djibouti"},{timezone:"Africa/Douala"},{timezone:"Africa/El_Aaiun"},{timezone:"Africa/Freetown"},{timezone:"Africa/Gaborone"},{timezone:"Africa/Harare"},{timezone:"Africa/Johannesburg"},{timezone:"Africa/Juba"},{timezone:"Africa/Kampala"},{timezone:"Africa/Khartoum"},{timezone:"Africa/Kigali"},{timezone:"Africa/Kinshasa"},{timezone:"Africa/Lagos"},{timezone:"Africa/Libreville"},{timezone:"Africa/Lome"},{timezone:"Africa/Luanda"},{timezone:"Africa/Lubumbashi"},{timezone:"Africa/Lusaka"},{timezone:"Africa/Malabo"},{timezone:"Africa/Maputo"},{timezone:"Africa/Maseru"},{timezone:"Africa/Mbabane"},{timezone:"Africa/Mogadishu"},{timezone:"Africa/Monrovia"},{timezone:"Africa/Nairobi"},{timezone:"Africa/Ndjamena"},{timezone:"Africa/Niamey"},{timezone:"Africa/Nouakchott"},{timezone:"Africa/Ouagadougou"},{timezone:"Africa/Porto-Novo"},{timezone:"Africa/Sao_Tome"},{timezone:"Africa/Timbuktu"},{timezone:"Africa/Tripoli"},{timezone:"Africa/Tunis"},{timezone:"Africa/Windhoek"},{timezone:"America/Adak"},{timezone:"America/Anchorage"},{timezone:"America/Anguilla"},{timezone:"America/Antigua"},{timezone:"America/Araguaina"},{timezone:"America/Argentina/Buenos_Aires"},{timezone:"America/Argentina/Catamarca"},{timezone:"America/Argentina/ComodRivadavia"},{timezone:"America/Argentina/Cordoba"},{timezone:"America/Argentina/Jujuy"},{timezone:"America/Argentina/La_Rioja"},{timezone:"America/Argentina/Mendoza"},{timezone:"America/Argentina/Rio_Gallegos"},{timezone:"America/Argentina/Salta"},{timezone:"America/Argentina/San_Juan"},{timezone:"America/Argentina/San_Luis"},{timezone:"America/Argentina/Tucuman"},{timezone:"America/Argentina/Ushuaia"},{timezone:"America/Aruba"},{timezone:"America/Asuncion"},{timezone:"America/Atikokan"},{timezone:"America/Atka"},{timezone:"America/Bahia"},{timezone:"America/Bahia_Banderas"},{timezone:"America/Barbados"},{timezone:"America/Belem"},{timezone:"America/Belize"},{timezone:"America/Blanc-Sablon"},{timezone:"America/Boa_Vista"},{timezone:"America/Bogota"},{timezone:"America/Boise"},{timezone:"America/Buenos_Aires"},{timezone:"America/Cambridge_Bay"},{timezone:"America/Campo_Grande"},{timezone:"America/Cancun"},{timezone:"America/Caracas"},{timezone:"America/Catamarca"},{timezone:"America/Cayenne"},{timezone:"America/Cayman"},{timezone:"America/Chicago"},{timezone:"America/Chihuahua"},{timezone:"America/Coral_Harbour"},{timezone:"America/Cordoba"},{timezone:"America/Costa_Rica"},{timezone:"America/Creston"},{timezone:"America/Cuiaba"},{timezone:"America/Curacao"},{timezone:"America/Danmarkshavn"},{timezone:"America/Dawson"},{timezone:"America/Dawson_Creek"},{timezone:"America/Denver"},{timezone:"America/Detroit"},{timezone:"America/Dominica"},{timezone:"America/Edmonton"},{timezone:"America/Eirunepe"},{timezone:"America/El_Salvador"},{timezone:"America/Ensenada"},{timezone:"America/Fort_Wayne"},{timezone:"America/Fortaleza"},{timezone:"America/Glace_Bay"},{timezone:"America/Godthab"},{timezone:"America/Goose_Bay"},{timezone:"America/Grand_Turk"},{timezone:"America/Grenada"},{timezone:"America/Guadeloupe"},{timezone:"America/Guatemala"},{timezone:"America/Guayaquil"},{timezone:"America/Guyana"},{timezone:"America/Halifax"},{timezone:"America/Havana"},{timezone:"America/Hermosillo"},{timezone:"America/Indiana/Indianapolis"},{timezone:"America/Indiana/Knox"},{timezone:"America/Indiana/Marengo"},{timezone:"America/Indiana/Petersburg"},{timezone:"America/Indiana/Tell_City"},{timezone:"America/Indiana/Vevay"},{timezone:"America/Indiana/Vincennes"},{timezone:"America/Indiana/Winamac"},{timezone:"America/Indianapolis"},{timezone:"America/Inuvik"},{timezone:"America/Iqaluit"},{timezone:"America/Jamaica"},{timezone:"America/Jujuy"},{timezone:"America/Juneau"},{timezone:"America/Kentucky/Louisville"},{timezone:"America/Kentucky/Monticello"},{timezone:"America/Knox_IN"},{timezone:"America/Kralendijk"},{timezone:"America/La_Paz"},{timezone:"America/Lima"},{timezone:"America/Los_Angeles"},{timezone:"America/Louisville"},{timezone:"America/Lower_Princes"},{timezone:"America/Maceio"},{timezone:"America/Managua"},{timezone:"America/Manaus"},{timezone:"America/Marigot"},{timezone:"America/Martinique"},{timezone:"America/Matamoros"},{timezone:"America/Mazatlan"},{timezone:"America/Mendoza"},{timezone:"America/Menominee"},{timezone:"America/Merida"},{timezone:"America/Metlakatla"},{timezone:"America/Mexico_City"},{timezone:"America/Miquelon"},{timezone:"America/Moncton"},{timezone:"America/Monterrey"},{timezone:"America/Montevideo"},{timezone:"America/Montreal"},{timezone:"America/Montserrat"},{timezone:"America/Nassau"},{timezone:"America/New_York"},{timezone:"America/Nipigon"},{timezone:"America/Nome"},{timezone:"America/Noronha"},{timezone:"America/North_Dakota/Beulah"},{timezone:"America/North_Dakota/Center"},{timezone:"America/North_Dakota/New_Salem"},{timezone:"America/Ojinaga"},{timezone:"America/Panama"},{timezone:"America/Pangnirtung"},{timezone:"America/Paramaribo"},{timezone:"America/Phoenix"},{timezone:"America/Port_of_Spain"},{timezone:"America/Port-au-Prince"},{timezone:"America/Porto_Acre"},{timezone:"America/Porto_Velho"},{timezone:"America/Puerto_Rico"},{timezone:"America/Rainy_River"},{timezone:"America/Rankin_Inlet"},{timezone:"America/Recife"},{timezone:"America/Regina"},{timezone:"America/Resolute"},{timezone:"America/Rio_Branco"},{timezone:"America/Rosario"},{timezone:"America/Santa_Isabel"},{timezone:"America/Santarem"},{timezone:"America/Santiago"},{timezone:"America/Santo_Domingo"},{timezone:"America/Sao_Paulo"},{timezone:"America/Scoresbysund"},{timezone:"America/Shiprock"},{timezone:"America/Sitka"},{timezone:"America/St_Barthelemy"},{timezone:"America/St_Johns"},{timezone:"America/St_Kitts"},{timezone:"America/St_Lucia"},{timezone:"America/St_Thomas"},{timezone:"America/St_Vincent"},{timezone:"America/Swift_Current"},{timezone:"America/Tegucigalpa"},{timezone:"America/Thule"},{timezone:"America/Thunder_Bay"},{timezone:"America/Tijuana"},{timezone:"America/Toronto"},{timezone:"America/Tortola"},{timezone:"America/Vancouver"},{timezone:"America/Virgin"},{timezone:"America/Whitehorse"},{timezone:"America/Winnipeg"},{timezone:"America/Yakutat"},{timezone:"America/Yellowknife"},{timezone:"Antarctica/Casey"},{timezone:"Antarctica/Davis"},{timezone:"Antarctica/DumontDUrville"},{timezone:"Antarctica/Macquarie"},{timezone:"Antarctica/Mawson"},{timezone:"Antarctica/McMurdo"},{timezone:"Antarctica/Palmer"},{timezone:"Antarctica/Rothera"},{timezone:"Antarctica/South_Pole"},{timezone:"Antarctica/Syowa"},{timezone:"Antarctica/Troll"},{timezone:"Antarctica/Vostok"},{timezone:"Arctic/Longyearbyen"},{timezone:"Asia/Aden"},{timezone:"Asia/Almaty"},{timezone:"Asia/Amman"},{timezone:"Asia/Anadyr"},{timezone:"Asia/Aqtau"},{timezone:"Asia/Aqtobe"},{timezone:"Asia/Ashgabat"},{timezone:"Asia/Ashkhabad"},{timezone:"Asia/Baghdad"},{timezone:"Asia/Bahrain"},{timezone:"Asia/Baku"},{timezone:"Asia/Bangkok"},{timezone:"Asia/Beirut"},{timezone:"Asia/Bishkek"},{timezone:"Asia/Brunei"},{timezone:"Asia/Calcutta"},{timezone:"Asia/Chita"},{timezone:"Asia/Choibalsan"},{timezone:"Asia/Chongqing"},{timezone:"Asia/Chungking"},{timezone:"Asia/Colombo"},{timezone:"Asia/Dacca"},{timezone:"Asia/Damascus"},{timezone:"Asia/Dhaka"},{timezone:"Asia/Dili"},{timezone:"Asia/Dubai"},{timezone:"Asia/Dushanbe"},{timezone:"Asia/Gaza"},{timezone:"Asia/Harbin"},{timezone:"Asia/Hebron"},{timezone:"Asia/Ho_Chi_Minh"},{timezone:"Asia/Hong_Kong"},{timezone:"Asia/Hovd"},{timezone:"Asia/Irkutsk"},{timezone:"Asia/Istanbul"},{timezone:"Asia/Jakarta"},{timezone:"Asia/Jayapura"},{timezone:"Asia/Jerusalem"},{timezone:"Asia/Kabul"},{timezone:"Asia/Kamchatka"},{timezone:"Asia/Karachi"},{timezone:"Asia/Kashgar"},{timezone:"Asia/Kathmandu"},{timezone:"Asia/Katmandu"},{timezone:"Asia/Khandyga"},{timezone:"Asia/Kolkata"},{timezone:"Asia/Krasnoyarsk"},{timezone:"Asia/Kuala_Lumpur"},{timezone:"Asia/Kuching"},{timezone:"Asia/Kuwait"},{timezone:"Asia/Macao"},{timezone:"Asia/Macau"},{timezone:"Asia/Magadan"},{timezone:"Asia/Makassar"},{timezone:"Asia/Manila"},{timezone:"Asia/Muscat"},{timezone:"Asia/Nicosia"},{timezone:"Asia/Novokuznetsk"},{timezone:"Asia/Novosibirsk"},{timezone:"Asia/Omsk"},{timezone:"Asia/Oral"},{timezone:"Asia/Phnom_Penh"},{timezone:"Asia/Pontianak"},{timezone:"Asia/Pyongyang"},{timezone:"Asia/Qatar"},{timezone:"Asia/Qyzylorda"},{timezone:"Asia/Rangoon"},{timezone:"Asia/Riyadh"},{timezone:"Asia/Saigon"},{timezone:"Asia/Sakhalin"},{timezone:"Asia/Samarkand"},{timezone:"Asia/Seoul"},{timezone:"Asia/Shanghai"},{timezone:"Asia/Singapore"},{timezone:"Asia/Srednekolymsk"},{timezone:"Asia/Taipei"},{timezone:"Asia/Tashkent"},{timezone:"Asia/Tbilisi"},{timezone:"Asia/Tehran"},{timezone:"Asia/Tel_Aviv"},{timezone:"Asia/Thimbu"},{timezone:"Asia/Thimphu"},{timezone:"Asia/Tokyo"},{timezone:"Asia/Ujung_Pandang"},{timezone:"Asia/Ulaanbaatar"},{timezone:"Asia/Ulan_Bator"},{timezone:"Asia/Urumqi"},{timezone:"Asia/Ust-Nera"},{timezone:"Asia/Vientiane"},{timezone:"Asia/Vladivostok"},{timezone:"Asia/Yakutsk"},{timezone:"Asia/Yekaterinburg"},{timezone:"Asia/Yerevan"},{timezone:"Atlantic/Bermuda"},{timezone:"Atlantic/Canary"},{timezone:"Atlantic/Cape_Verde"},{timezone:"Atlantic/Faeroe"},{timezone:"Atlantic/Faroe"},{timezone:"Atlantic/Jan_Mayen"},{timezone:"Atlantic/Madeira"},{timezone:"Atlantic/Reykjavik"},{timezone:"Atlantic/South_Georgia"},{timezone:"Atlantic/St_Helena"},{timezone:"Atlantic/Stanley"},{timezone:"Australia/ACT"},{timezone:"Australia/Adelaide"},{timezone:"Australia/Brisbane"},{timezone:"Australia/Broken_Hill"},{timezone:"Australia/Canberra"},{timezone:"Australia/Currie"},{timezone:"Australia/Darwin"},{timezone:"Australia/Eucla"},{timezone:"Australia/Hobart"},{timezone:"Australia/LHI"},{timezone:"Australia/Lindeman"},{timezone:"Australia/Lord_Howe"},{timezone:"Australia/Melbourne"},{timezone:"Australia/North"},{timezone:"Australia/NSW"},{timezone:"Australia/Perth"},{timezone:"Australia/Queensland"},{timezone:"Australia/South"},{timezone:"Australia/Sydney"},{timezone:"Australia/Tasmania"},{timezone:"Australia/Victoria"},{timezone:"Australia/West"},{timezone:"Australia/Yancowinna"},{timezone:"Brazil/Acre"},{timezone:"Brazil/DeNoronha"},{timezone:"Brazil/East"},{timezone:"Brazil/West"},{timezone:"Canada/Atlantic"},{timezone:"Canada/Central"},{timezone:"Canada/East-Saskatchewan"},{timezone:"Canada/Eastern"},{timezone:"Canada/Mountain"},{timezone:"Canada/Newfoundland"},{timezone:"Canada/Pacific"},{timezone:"Canada/Saskatchewan"},{timezone:"Canada/Yukon"},{timezone:"Chile/Continental"},{timezone:"Chile/EasterIsland"},{timezone:"Europe/Amsterdam"},{timezone:"Europe/Andorra"},{timezone:"Europe/Athens"},{timezone:"Europe/Belfast"},{timezone:"Europe/Belgrade"},{timezone:"Europe/Berlin"},{timezone:"Europe/Bratislava"},{timezone:"Europe/Brussels"},{timezone:"Europe/Bucharest"},{timezone:"Europe/Budapest"},{timezone:"Europe/Busingen"},{timezone:"Europe/Chisinau"},{timezone:"Europe/Copenhagen"},{timezone:"Europe/Dublin"},{timezone:"Europe/Gibraltar"},{timezone:"Europe/Guernsey"},{timezone:"Europe/Helsinki"},{timezone:"Europe/Isle_of_Man"},{timezone:"Europe/Istanbul"},{timezone:"Europe/Jersey"},{timezone:"Europe/Kaliningrad"},{timezone:"Europe/Kiev"},{timezone:"Europe/Lisbon"},{timezone:"Europe/Ljubljana"},{timezone:"Europe/London"},{timezone:"Europe/Luxembourg"},{timezone:"Europe/Madrid"},{timezone:"Europe/Malta"},{timezone:"Europe/Mariehamn"},{timezone:"Europe/Minsk"},{timezone:"Europe/Monaco"},{timezone:"Europe/Moscow"},{timezone:"Europe/Nicosia"},{timezone:"Europe/Oslo"},{timezone:"Europe/Paris"},{timezone:"Europe/Podgorica"},{timezone:"Europe/Prague"},{timezone:"Europe/Riga"},{timezone:"Europe/Rome"},{timezone:"Europe/Samara"},{timezone:"Europe/San_Marino"},{timezone:"Europe/Sarajevo"},{timezone:"Europe/Simferopol"},{timezone:"Europe/Skopje"},{timezone:"Europe/Sofia"},{timezone:"Europe/Stockholm"},{timezone:"Europe/Tallinn"},{timezone:"Europe/Tirane"},{timezone:"Europe/Tiraspol"},{timezone:"Europe/Uzhgorod"},{timezone:"Europe/Vaduz"},{timezone:"Europe/Vatican"},{timezone:"Europe/Vienna"},{timezone:"Europe/Vilnius"},{timezone:"Europe/Volgograd"},{timezone:"Europe/Warsaw"},{timezone:"Europe/Zagreb"},{timezone:"Europe/Zaporozhye"},{timezone:"Europe/Zurich"},{timezone:"Indian/Antananarivo"},{timezone:"Indian/Chagos"},{timezone:"Indian/Christmas"},{timezone:"Indian/Cocos"},{timezone:"Indian/Comoro"},{timezone:"Indian/Kerguelen"},{timezone:"Indian/Mahe"},{timezone:"Indian/Maldives"},{timezone:"Indian/Mauritius"},{timezone:"Indian/Mayotte"},{timezone:"Indian/Reunion"},{timezone:"Pacific/Apia"},{timezone:"Pacific/Auckland"},{timezone:"Pacific/Bougainville"},{timezone:"Pacific/Chatham"},{timezone:"Pacific/Chuuk"},{timezone:"Pacific/Easter"},{timezone:"Pacific/Efate"},{timezone:"Pacific/Enderbury"},{timezone:"Pacific/Fakaofo"},{timezone:"Pacific/Fiji"},{timezone:"Pacific/Funafuti"},{timezone:"Pacific/Galapagos"},{timezone:"Pacific/Gambier"},{timezone:"Pacific/Guadalcanal"},{timezone:"Pacific/Guam"},{timezone:"Pacific/Honolulu"},{timezone:"Pacific/Johnston"},{timezone:"Pacific/Kiritimati"},{timezone:"Pacific/Kosrae"},{timezone:"Pacific/Kwajalein"},{timezone:"Pacific/Majuro"},{timezone:"Pacific/Marquesas"},{timezone:"Pacific/Midway"},{timezone:"Pacific/Nauru"},{timezone:"Pacific/Niue"},{timezone:"Pacific/Norfolk"},{timezone:"Pacific/Noumea"},{timezone:"Pacific/Pago_Pago"},{timezone:"Pacific/Palau"},{timezone:"Pacific/Pitcairn"},{timezone:"Pacific/Pohnpei"},{timezone:"Pacific/Ponape"},{timezone:"Pacific/Port_Moresby"},{timezone:"Pacific/Rarotonga"},{timezone:"Pacific/Saipan"},{timezone:"Pacific/Samoa"},{timezone:"Pacific/Tahiti"},{timezone:"Pacific/Tarawa"},{timezone:"Pacific/Tongatapu"},{timezone:"Pacific/Truk"},{timezone:"Pacific/Wake"},{timezone:"Pacific/Wallis"},{timezone:"Pacific/Yap"}]});Ext.define("AL.store.PdfTemplates",{extend:"Ext.data.Store",model:"AL.model.PdfTemplate",autoLoad:false,proxy:{type:"ajax",url:"/pdf-template/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ConditionsIIBB",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/conditionsIibb/format/json",reader:{type:"json",root:"results"}}});var me=this;Ext.define("AL.store.OnlinePaymentListByCountry",{extend:"Ext.data.Store",fields:["country","countryName","onlinePayments"],data:[],environment:"",constructor:function(b){var a=b.environment;var c=a=="production";this.data=[{country:"republicaDominicana",onlinePayments:[{title:"VisaNet",layout:"fit",tabId:"option0",id:"visanet",items:[{xtype:"externalpayments_FormEdit",country:me.country,canReceiveExternalPayments:false,hidden:true},{xtype:"externalpayments_Welcome",country:me.country,canReceiveExternalPayments:false,hidden:false}]}]},{country:"colombia",onlinePayments:[{title:"Nequi",layout:"fit",tabId:"optionNequi",id:"nequi",items:[{xtype:"externalpayments_FormEditNequi",country:me.country,canReceiveExternalPayments:false,hidden:false,titleHtml:'<div style="margin-bottom: 4px;font-size: 14px; text-align:center;">Si aún no tienes cuenta en Nequi <a style="font-weight:bold; color: #00b19d;" href="https://negocios.nequi.co/registro/alegra?utm_source=alegra%20app&utm_medium=organic" target="_blank">regístrate aquí</a><div style="font-weight: bold; display: inline;"> como Negocio Nequi </div> y recibe de forma rápida y segura los pagos de tus clientes con solo compartir el Estado de cuenta.</div><br><div style="margin-bottom: 4px;font-size: 14px; text-align:center;">Con Nequi pagas comisión de 1.5% por transacción, sin superar los $3.000 COP</div>',subtitleHtml:"",footerHtml:'<hr style="width: 150%; border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">',subfooterHtml:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos colombianos (COP).</div>'}]},{title:"PayU",layout:"fit",tabId:"optionPayU",id:"payu",items:[{xtype:"externalpayments_FormEditPayU",country:me.country,canReceiveExternalPayments:false,hidden:false,titleHtml:'<div style="margin-bottom: 4px;font-size: 11px;">Gana tiempo y tranquilidad con la integración entre PayU y Alegra, puedes crear una cuenta en PayU <a style="font-weight:bold; color: #00b19d;" href="https://www.payulatam.com/co/abre-tu-cuenta-aliado-soluciones-alegra/" target="_blank">aquí</a></div><br>',subtitleHtml:'<br><div style="margin-bottom: 4px;"><span style="font-size: 11px;">Alegra te ofrece la integración con PayU que es un servicio independiente, Alegra no es responsable por los pagos realizados por esta plataforma.</span></div>',footerHtml:'<hr style="width: 150%; border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">',subfooterHtml:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos colombianos (COP).</div>'}]},{title:"RappiPay",layout:"fit",tabId:"optionRappiPay",id:"rappiPay",hidden:c,items:[{xtype:"externalpayments_FormEditRappiPay",country:me.country,canReceiveExternalPayments:false,hidden:false,titleHtml:'<div style="margin-bottom: 4px;font-size: 11px;">Gana tiempo y tranquilidad con la integración entre RappiPay y Alegra.</div><br>',subtitleHtml:'<br><div style="margin-bottom: 4px;"><span style="font-size: 11px;">Alegra te ofrece la integración con RappiPay que es un servicio independiente, Alegra no es responsable por los pagos realizados por esta plataforma.</span></div>',footerHtml:'<hr style="width: 150%; border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">',subfooterHtml:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos colombianos (COP).</div>'}]},{title:"Tpaga ",layout:"fit",tabId:"optionTpaga",id:"tpaga",hidden:false,items:[{xtype:"externalpayments_FormEditTpaga",country:me.country,canReceiveExternalPayments:false,hidden:false,titleHtml:'<div style="margin-bottom: 4px;font-size: 14px; text-align:center;">Si aún no tienes cuenta en Tpaga <a style="font-weight:bold; color: #00b19d;" href="https://tpaga.co/2019/12/23/alegra/" target="_blank">regístrate aquí</a>, una vez registrado completa los siguientes campos con los datos que te propociona Tpaga.<br><br><div style="margin-bottom: 4px;font-size: 14px; text-align:center;">Tpaga te cobrará una comisión del 2.99% + IVA por cada transacción efectuada</div><br>',subtitleHtml:"",footerHtml:'<hr style="width: 150%; border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">',subfooterHtml:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos colombianos (COP).</div>'}]}]},{country:"mexico",onlinePayments:[{title:"PayU",layout:"fit",tabId:"optionPayU",id:"payu",items:[{xtype:"externalpayments_FormEditPayU",country:me.country,canReceiveExternalPayments:false,hidden:false,titleHtml:'<div style="margin-bottom: 4px;font-size: 11px;">Gana tiempo y tranquilidad con la integración entre PayU y Alegra, puedes crear una cuenta en PayU <a style="font-weight:bold; color: #00b19d;" href="https://www.payulatam.com/mx/abre-tu-cuenta-aliado-soluciones-alegra/" target="_blank">aquí</a></div><br>',subtitleHtml:'<br><div style="margin-bottom: 4px;"><span style="font-size: 11px;">Alegra te ofrece la integración con PayU que es un servicio independiente, Alegra no es responsable por los pagos realizados por esta plataforma.</span></div>',footerHtml:'<hr style="width: 150%; border: none; border-bottom: 1px solid #F2F2F2; margin-top: 30px; margin-bottom: 20px;">',subfooterHtml:'<div style="margin-top: 25px; font-size: 12px; color: #00535E;">Los pagos están disponibles para documentos en pesos colombianos (MXN).</div>'}]}]}];return this.callParent(arguments)}});Ext.define("AL.view.wizard.CompanyWizard",{extend:"Ext.panel.Panel",alias:"widget.wizard_CompanyWizard",bodyPadding:35,layout:"card",defaults:{border:false},items:[{xtype:"form",defaults:{msgTarget:"side",labelAlign:"right",labelPad:15,labelWidth:120,width:360},items:[{xtype:"combo",fieldLabel:"Gremio",name:"sector",valueField:"sector",displayField:"sector",store:Ext.create("Ext.data.Store",{fields:["sector"],data:[{sector:"Alimentos"},{sector:"Automotriz, autopartes"},{sector:"Comercio mayorista"},{sector:"Comercio minorista"},{sector:"Educativo"},{sector:"Eventos"},{sector:"Industria"},{sector:"Servicios de catering, restaurantes, etc."},{sector:"Servicios financieros"},{sector:"Servicios organizacionales"},{sector:"Servicios tecnológicos"}]})},{xtype:"combo",name:"regime",fieldLabel:"Régimen",valueField:"regime",displayField:"regime",store:Ext.create("Ext.data.Store",{fields:["regime"],data:[{regime:"Régimen común"},{regime:"Régimen simplificado"}]})},{xtype:"textfield",name:"accountName",fieldLabel:"Nombre del banco"},{xtype:"textfield",name:"initialBalance",fieldLabel:"Saldo inicial",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal"},{xtype:"datefield",name:"initialBalanceDate",fieldLabel:"Fecha",width:250,value:new Date()}],buttons:[{text:"Guardar",action:"saveWizard"}]}]});Ext.define("AL.view.conciliation.Buttons",{extend:"Ext.form.Panel",alias:"widget.conciliation_Buttons",bodyPadding:5,frame:true,layout:"anchor",defaults:{anchor:"100%"},buttons:[{text:"Posponer",action:"postpone",cls:"sm-button-basic",height:38,width:157},{text:"Conciliar",disabled:true,action:"save",cls:"sm-button-primary",height:38,width:157}]});Ext.define("AL.view.ux.grid.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",disableColumn:false,disableFunction:null,disabledColumnDataIndex:null,columnHeaderCheckbox:false,constructor:function(a){var b=this;b.addEvents("beforecheckchange","checkchange");b.callParent(arguments)},toggleSortState:function(){var b=this;if(b.columnHeaderCheckbox){var a=b.up("tablepanel").store;var c=b.getStoreIsAllChecked(a,b.dataIndex);a.each(function(d){d.set(b.dataIndex,!c);d.commit()})}else{b.callParent(arguments)}},getStoreIsAllChecked:function(a,b){var c=true;a.each(function(d){if(!d.get(b)){c=false}});return c},processEvent:function(f,h,l,b,g,d){if(f=="mousedown"||(f=="keydown"&&(d.getKey()==d.ENTER||d.getKey()==d.SPACE))){var c=h.panel.store.getAt(b),j=this.dataIndex,k=!c.get(j),a=h.panel.columns[g];if(!(a.disableColumn||c.get(a.disabledColumnDataIndex)||(a.disableFunction&&a.disableFunction(k,c)))){if(this.fireEvent("beforecheckchange",this,b,k,c)){c.set(j,k);this.fireEvent("checkchange",this,b,k,c)}}return false}else{return this.callParent(arguments)}},renderer:function(f,a,c,d,h,g,e){var b=Ext.baseCSSPrefix,j=[b+"grid-checkheader"];if(f){j.push(b+"grid-checkheader-checked")}return'<div class="'+j.join(" ")+'">&#160;</div>'}});Ext.define("AL.model.Item",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"auto"},{name:"reference",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"price",type:"auto"},{name:"idCategory",type:"auto"},{name:"idTax",type:"auto"},{name:"deletable",type:"bool"},{name:"editable",type:"bool"},{name:"status",type:"string"},{name:"taxName",type:"string"},{name:"taxStatus",type:"string"},{name:"taxTax",type:"auto"},{name:"quantity",type:"auto"},{name:"decimalPrecision",type:"auto"},{name:"priceList",type:"auto"},{name:"isInventariable",type:"string"},{name:"availableQuantity",type:"auto"},{name:"minQuantity",type:"auto"},{name:"quantityRemissioned",type:"auto"},{name:"warehouses",type:"string"},{name:"taxes",type:"auto"},{name:"productKey",type:"string"},{name:"canUseImportRequest",type:"string"},{name:"unit",type:"string"},{name:"unitCost",type:"auto"},{name:"image",type:"auto"}],idProperty:"idLocal"});Ext.define("AL.model.ItemCreditNote",{extend:"Ext.data.Model",fields:["idLocal","reference","name","description","price","idTax"],proxy:{type:"ajax",method:"POST",api:{read:"/itemCreditNote/retrieve-all/format/json",update:"data/updateItems.json",create:"/itemCreditNote/add/format/json",destroy:"/itemCreditNote/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.view.invoice.WindowReactiveSat",{alias:"widget.invoice_WindowReactiveSat",extend:"Ext.window.Window",autoShow:true,modal:true,border:false,closable:false,width:900,height:687,resizable:false,bodyStyle:"background: transparent",id:"modal-reactive-sat",html:'<div style="margin-top: -250px; margin-left: 420px;"> <a href="https://ayuda.getsoft.app/hc/es/articles/115003866766" target="_blank" style="font-size: 17px;"> Ver más. </a></div>',items:[{xtype:"image",src:"/images/sat_message.jpg",width:900,height:657,style:"cursor : pointer;",listeners:{el:{click:function(){window.location.reload()}}}}],});Ext.define("AL.view.creditnote.FormAdvancedOptions",{extend:"Ext.form.Panel",alias:"widget.creditnote_FormAdvancedOptions",border:false,bodyPadding:"20 0 0 0",items:[{xtype:"container",layout:"hbox",width:1050,items:[{xtype:"container",name:"containerLeft",defaults:{labelAlign:"right",labelPad:15,width:400,labelWidth:120},items:[{xtype:"textarea",fieldLabel:translate("observations",true)+' <div class="sublabel">(no visible en la '+translate("creditNote")+")</div>",name:"observations",id:"creditnoteObservationsTextarea",allowBlank:true,hidden:true}]},{xtype:"container",defaults:{labelAlign:"right",labelPad:24,width:400,labelWidth:120},items:[{xtype:"combo",name:"idPriceList",fieldLabel:translate("priceList",true),displayField:"name",valueField:"idLocal",store:"PriceListCombo",editable:false,labelAlign:"right",queryMode:"local",tooltip:translate("selectTheDocument1YouWantToAssociateWithThisDocument2",true,{document1:translate("priceList"),document2:translate("creditNote")}),labelPad:15,allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">'+translate("newList",true)+"</a></div>"}}]}]}]});Ext.define("AL.view.creditnote.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.creditnote_MoreActionsButton",cls:"button2",padding:"1 5 8 5",text:translate("moreActions",true),menu:{xtype:"menu",items:[]},handler:function(){this.showMenu()},initComponent:function(){var a=this;var b=Ext.get("emailCreditNote").el.dom;this.menu.items.push({text:"Imprimir como copia",handler:function(e,d){var c=window.open("/credit-note/print/id/"+a.idLocal+"/type/copy","_blank");c.print()}});this.menu.items.push({text:"Descargar como copia",href:"/credit-note/print/id/"+this.idLocal+"/type/copy/download/yes"});this.menu.items.push({text:"Enviar como copia",action:"email"});this.callParent(arguments)}});Ext.define("AL.view.ux.fields.Numeration",{extend:"Ext.panel.Panel",alias:"widget.numerationField",border:false,configs:{},values:{},initComponent:function(){var g=this;if(!this.configs.documentType){return console.warn("Componentente sin configuración asignada")}var b=["invoice","creditNote","debitNote","transactionIn","transactionOut","bill","estimate","purchaseOrder","remission"];if(b.indexOf(this.configs.documentType)==-1){return console.warn("Tipo de documento no soportado")}var k=(typeof this.configs.autoload=="undefined"||this.configs.autoload===true);var j=this.configs.documentType;var f=this.configs.labelWidth;var h=this.configs.labelPad;var l=this.configs.fieldWidth;var c=l;if(!["remission","estimate"].includes(j)){c=l-(f?f:0)-(h?h:0)}var d=Ext.create("AL.store.ResolutionsCombo");if(k){var a="/resolution/retrieve-all-active/documentType/"+j+"/format/json";if(this.configs.onlyAutoincrement===true){a+="/onlyAutoincrement/true"}d.getProxy().url=a;d.load()}var e=[{xtype:"combo",name:"resolutionCombo",width:l,fieldLabel:translate("numeration",true),blankText:"Es necesario seleccionar una "+translate("numeration")+" para tu "+translate(j),allowBlank:false,forceSelection:true,displayField:"name",store:d,labelAlign:"right",queryMode:"local",valueField:"idLocal",msgTarget:"side",labelWidth:f,labelPad:h,editable:false,matchFieldWidth:false,listConfig:{width:c},listeners:{change:function(q){var w=g.configs.parent?Ext.ComponentQuery.query(g.configs.parent)[0]:null;var t=q.getSelectedRecord().data;var r=g.down("panel[name=nextNumberContainer]");if(!w){return}if(g.configs.showNextNumberContainer===false){return}var n=translate("number",true);if(w.configs&&w.configs.country==="peru"){n="Número"}var v=[{xtype:"textfield",name:"prefix",fieldLabel:n,emptyText:translate("prefix",true),labelAlign:"right",labelPad:h,labelWidth:f,width:l/2},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[1-9]([0-9]+)?$/,regexText:translate("theNumeration",true)+" "+translate("numeration")+" debe iniciar con un valor diferente a cero",hideLabel:true,allowBlank:false,width:(l/2)-5,style:"margin-left:5px",msgTarget:"side",blankText:"Debes ingresar el "+translate("number",true)+" de tu "+translate(j)}];var m=63;var x=91;var u=10;var s=[{xtype:"label",padding:"4 7 0 77",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:m,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:x,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:u}];if(w.type==="edit"||w.edit===true){r.removeAll(false);if(["remission","estimate"].includes(j)){r.add(s)}else{r.add(v)}var t=q.getSelectedRecord().data;var p=r.down("textfield[name=prefix]");var o=r.down("textfield[name=number]");if(t&&g.values.numerationIdLocal==t.idLocal){p.setValue(g.values.prefix);o.setValue(g.values.number)}else{if(t&&t.autoincrement&&t.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:t.idLocal},success:function(y,A){var z=Ext.decode(y.responseText);var B=z.results;if(w.configs){switch(w.configs.country){case"argentina":B.number=Ext.String.leftPad(B.number,8,"0");break}}p.setValue(B.prefix);o.setValue(B.number)}})}else{o.setValue(null)}}}else{if(w.type!=="edit"&&t){if(t.autoincrement&&t.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/documentType/"+j+"/format/json",method:"POST",params:{id:t.idLocal},success:function(y,A){var z=Ext.decode(y.responseText);var B=z.results;var C="";if(w.configs){switch(w.configs.country){case"peru":if(j==="creditNote"&&B.prefix){C="-"}break;case"argentina":if(B.prefix){C="-"}B.number=Ext.String.leftPad(B.number,8,"0");break}}var B=B.prefix+C+B.number;r.removeAll(false);if(["remission","estimate"].includes(j)){r.add({xtype:"box",html:'<div class="x-box-inner " role="presentation" style="width: 309px; height: 48px; "><div class="x-box-target" style="width: 309px;"><label class="x-component form-add-invoice-header-number-text x-box-item x-component-default" style="padding: 4px 7px 0px 0px; right: auto; left: 145px; top: 0px; margin: 0px;" id="label-1200" for="">N<span style="font-size: 18px;">o.</span></label><table class="x-field x-table-plain x-form-item x-form-readonly x-box-item x-field-default x-hbox-form-item" style="width: 95px; height: 48px; margin: 0px; table-layout: fixed; right: auto; left: 185px; top: 0px;" cellpadding="0" id="textfield-1201"><tbody><tr id="textfield-1201-inputRow"><td id="textfield-1201-labelCell" style="display:none;" valign="top" halign="left" width="140" class="x-field-label-cell"><label id="textfield-1201-labelEl" for="textfield-1201-inputEl" class="x-form-item-label x-unselectable x-form-item-label-left" style="width:100px;margin-right:40px;" unselectable="on"></label></td><td class="x-form-item-body " id="textfield-1201-bodyEl" colspan="3" role="presentation" style="width: 100%;"><input id="textfield-1201-inputEl" type="text" size="1" value='+B+' readonly="readonly" class="form-add-invoice-header-number-left x-form-text" autocomplete="off" aria-invalid="false" data-errorqtip="" style="width: 100%; height: 48px;"></td></tr></tbody></table><div class="x-component x-box-item x-component-default" style="padding: 5px 0px 0px; right: auto; left: 283px; top: 0px; margin: 0px;" id="component-1202"><a class="button clear" style="padding: 0px !important; margin: 0px !important;" target="__blank" href="/resolution"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a></div></div></div>'})}else{r.add({xtype:"box",html:'<div class="x-form-item-label unselectable" style="display:inline-block; text-align:right; min-width:100px; width:'+f+"px; margin-right:"+h+'px; cursor: default;">'+n+'</div><div style="background: none repeat scroll 0 0 #EEEEEE;border: 1px solid #CCCCCC;color: #666666;display: inline-block;font-size: 13px;line-height: 27px;padding: 0px 9px 1px 8px;text-align: right;width:'+c+'px;">'+B+"</div>"})}}})}else{r.removeAll(false);if(["remission","estimate"].includes(j)){r.add(s)}else{r.add(v)}}}}},select:function(q){var w=g.configs.parent?Ext.ComponentQuery.query(g.configs.parent)[0]:null;var t=q.getSelectedRecord().data;var r=g.down("panel[name=nextNumberContainer]");if(!w){return}if(g.configs.showNextNumberContainer===false){return}var n=translate("number",true);if(w.configs&&w.configs.country==="peru"){n="Número"}var v=[{xtype:"textfield",name:"prefix",fieldLabel:n,emptyText:translate("prefix",true),labelAlign:"right",labelPad:h,labelWidth:f,width:l/2},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[1-9]([0-9]+)?$/,hideLabel:true,allowBlank:false,width:(l/2)-5,style:"margin-left:5px",msgTarget:"side",blankText:"Debes ingresar el "+translate("number",true)+" de tu "+translate(j)}];var m=63;var x=91;var u=10;var s=[{xtype:"label",padding:"4 7 0 77",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:m,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:x,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:u}];if(w.type==="edit"||w.edit===true){r.removeAll(false);if(["remission","estimate"].includes(j)){r.add(s)}else{r.add(v)}var t=q.getSelectedRecord().data;var p=r.down("textfield[name=prefix]");var o=r.down("textfield[name=number]");if(t&&g.values.numerationIdLocal==t.idLocal){p.setValue(g.values.prefix);o.setValue(g.values.number)}else{if(t&&t.autoincrement&&t.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:t.idLocal},success:function(y,A){var z=Ext.decode(y.responseText);var B=z.results;p.setValue(B.prefix);o.setValue(B.number)}})}else{o.setValue(null)}}}}}},{xtype:"panel",name:"nextNumberContainer",layout:"hbox",border:false,width:this.width,style:" margin: 8px 0;",items:[]}];if(["remission","estimate"].includes(j)){e[0].fieldLabel=null;e[0].padding="0 0 0 180";e[0].id="numeration-container-combo";e[0].listConfig.id="numeration-combo-list"}this.items=e;this.callParent()},getSelectedNumeration:function(){var a=this.down("combo[name=resolutionCombo]");return a.getSelectedRecord().data},selectNumerationByIdLocal:function(e,b){var d=this.down("combo[name=resolutionCombo]");var a=d.getStore();var c=function(){var f=a.findRecord("idLocal",e);if(!f){return}d.select(f.data.idLocal);if(b){d.fireEvent("change",d)}};if(a.hasLoaded()){c()}else{a.on("load",function(){c()})}},setDocumentType:function(a,f){var f=typeof f=="function"?f:null;var c=this.configs.parent?Ext.ComponentQuery.query(this.configs.parent)[0]:null;var e=this.down("combo[name=resolutionCombo]");var b=e.getStore();b.getProxy().url="/resolution/retrieve-all-active/documentType/"+a+"/format/json";b.load();var d=function(){var h=b.data.items;var g=b.findRecord("isDefault","yes");if(h.length<=1){e.hide()}else{e.show()}if(c&&c.configs&&!c.configs.selectDefaultNumerationOnEdit&&(c.type==="edit"||c.edit===true)){return}if(g){e.select(g.data.idLocal)}else{if(h[0]){e.select(h[0].data.idLocal)}}};if(b.hasLoaded()){if(f){f(e)}else{d()}}else{b.on("load",function(){if(f){f(e)}else{d()}})}this.configs.documentType=a},setNumerationForDocumentsOldNumeration:function(b,a){var c=this.configs.parent?Ext.ComponentQuery.query(this.configs.parent)[0]:null;var d=b.down("panel[name=nextNumberContainer]");d.removeAll(false);if(c.type==="edit"||c.edit===true){d.add({xtype:"box",html:'<div class="x-box-inner " role="presentation" style="width: 309px; height: 48px; "><div class="x-box-target" style="width: 309px;"><label class="x-component form-add-invoice-header-number-text x-box-item x-component-default" style="padding: 4px 7px 0px 0px; right: auto; left: 145px; top: 0px; margin: 0px;" id="label-1200" for="">N<span style="font-size: 18px;">o.</span></label><table class="x-field x-table-plain x-form-item x-form-readonly x-box-item x-field-default x-hbox-form-item" style="width: 95px; height: 48px; margin: 0px; table-layout: fixed; right: auto; left: 185px; top: 0px;" cellpadding="0" id="textfield-1201"><tbody><tr id="textfield-1201-inputRow"><td id="textfield-1201-labelCell" style="display:none;" valign="top" halign="left" width="140" class="x-field-label-cell"><label id="textfield-1201-labelEl" for="textfield-1201-inputEl" class="x-form-item-label x-unselectable x-form-item-label-left" style="width:100px;margin-right:40px;" unselectable="on"></label></td><td class="x-form-item-body " id="textfield-1201-bodyEl" colspan="3" role="presentation" style="width: 100%;"><input id="textfield-1201-inputEl" type="text" size="1" value='+c.configs[a+"Number"]+' readonly="readonly" class="form-add-invoice-header-number-left x-form-text" autocomplete="off" aria-invalid="false" data-errorqtip="" style="width: 100%; height: 48px;"></td></tr></tbody></table></div></div>'})}else{Ext.Ajax.request({url:"/company/retrieve-numeration-info/format/json",method:"POST",success:function(f,h){var g=Ext.decode(f.responseText);var e="next"+a[0].toUpperCase()+a.substr(1)+"Number";var j=g.results[e];d.add({xtype:"box",html:'<div class="x-box-inner " role="presentation" style="width: 309px; height: 48px; "><div class="x-box-target" style="width: 309px;"><label class="x-component form-add-invoice-header-number-text x-box-item x-component-default" style="padding: 4px 7px 0px 0px; right: auto; left: 145px; top: 0px; margin: 0px;" id="label-1200" for="">N<span style="font-size: 18px;">o.</span></label><table class="x-field x-table-plain x-form-item x-form-readonly x-box-item x-field-default x-hbox-form-item" style="width: 95px; height: 48px; margin: 0px; table-layout: fixed; right: auto; left: 185px; top: 0px;" cellpadding="0" id="textfield-1201"><tbody><tr id="textfield-1201-inputRow"><td id="textfield-1201-labelCell" style="display:none;" valign="top" halign="left" width="140" class="x-field-label-cell"><label id="textfield-1201-labelEl" for="textfield-1201-inputEl" class="x-form-item-label x-unselectable x-form-item-label-left" style="width:100px;margin-right:40px;" unselectable="on"></label></td><td class="x-form-item-body " id="textfield-1201-bodyEl" colspan="3" role="presentation" style="width: 100%;"><input id="textfield-1201-inputEl" type="text" size="1" value='+j+' readonly="readonly" class="form-add-invoice-header-number-left x-form-text" autocomplete="off" aria-invalid="false" data-errorqtip="" style="width: 100%; height: 48px;"></td></tr></tbody></table><div class="x-component x-box-item x-component-default" style="padding: 5px 0px 0px; right: auto; left: 283px; top: 0px; margin: 0px;" id="component-1202"><a class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" target="__blank"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a></div></div></div>'})}})}},listeners:{beforerender:function(b){var c=this.configs.parent?Ext.ComponentQuery.query(this.configs.parent)[0]:null;var f=b.down("combo[name=resolutionCombo]");var e=b.down("textfield[name=number]");if(c&&c.configs&&(!c.configs.resolutionModel||c.configs.resolutionModel!="new")){if(["remission","estimate"].includes(this.configs.documentType)){this.setNumerationForDocumentsOldNumeration(b,this.configs.documentType)}else{this.hide()}f.allowBlank=true;if(e){e.allowBlank=true}}var a=f.getStore();var d=function(){var h=a.data.items;var g=a.findRecord("isDefault","yes");if(h.length<=1){f.hide()}if(c&&c.configs&&!c.configs.selectDefaultNumerationOnEdit&&(c.type==="edit"||c.edit===true)){return}if(g){f.select(g.data.idLocal)}else{if(h[0]){f.select(h[0].data.idLocal)}}};if(a.hasLoaded()){d()}else{a.on("load",function(){d()})}}}});Ext.define("AL.view.item.FormEditDiscount",{extend:"Ext.window.Window",name:"modalDiscount",autoShow:true,modal:true,resizable:false,border:false,bodyPadding:"0 20 20 20",style:"overflow:visible",bodyStyle:"background: transparent; overflow: visible;",width:400,frame:false,title:"",items:[],listeners:{afterrender:function(d){var g=d.configs.discountField;var c=[{text:"Cancelar",action:"close",handler:function(h){var j=h.up("form");var k=d.configs.discountField;if(k.discount){k.discount=null;k.setValue("0")}d.destroy()}},{text:"Aceptar",formBind:true,handler:function(h){var l=h.up("form");var k=l.down("textfield[name=discount]");var n=l.down("textfield[name=discountNature]");var m=d.configs.discountField;var j=parseInt(d.configs.valueDiscountMax);if(d.configs.country=="colombia"&&d.configs.isActiveElectronicInvoicing&&j==100){j=99}if(k.getValue()>j){k.markInvalid("El porcentaje de "+translate("discount")+" ingresado es mayor que el permitido.");return}m.setValue(k.getValue());m.discount={discountNature:n.getValue(),discount:k.getValue()};d.destroy()}}];var b=Ext.create("Ext.form.Panel",{border:false,items:[{xtype:"box",cls:"modal-title",html:"Edita tu "+translate("discount")},{xtype:"textarea",fieldLabel:translate("reasonDiscount")+" "+translate("ofTheDiscount")+" "+translate("discount"),name:"discountNature",blankText:"Es necesario indicar la naturaleza "+translate("ofTheDiscount")+" "+translate("discount"),tooltip:"Indica el origen "+translate("ofTheDiscount")+" "+translate("discount"),maxLength:80,allowBlank:false},{xtype:"textfield",fieldLabel:"Porcentaje de "+translate("discount"),name:"discount",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos positivos con el punto (.) como separador decimal",blankText:"Es necesario fijar el monto a aplicar",tooltip:"Indica el porcentaje de "+translate("discount")+" que deseas aplicar",allowBlank:false},],buttons:c});d.items.add(b);if(g.discount){var f=b.down("button[action=close]");f.setText("Eliminar "+translate("discount"));var a=b.down("textfield[name=discount]");var e=b.down("textfield[name=discountNature]");a.setValue(g.discount.discount);e.setValue(g.discount.discountNature)}}}});Ext.define("AL.store.Items",{extend:"Ext.data.Store",model:"AL.model.Item",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/item/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.ItemsCreditNote",{extend:"Ext.data.Store",model:"AL.model.ItemCreditNote",autoLoad:false,proxy:{type:"ajax",url:"/item/index/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CreditNoteTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/creditNoteTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.VoidCauses",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/voidCauses/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CreditNoteTypesMx",{extend:"Ext.data.Store",fields:["code","name"],data:[{code:"01",name:"Anulaciones, descuentos y bonificaciones",},{code:"03",name:"Devolución de mercancía sobre facturas o traslados previos",}]});Ext.define("AL.store.SalesConcepts",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/salesConcepts/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.PaymentForm",{extend:"Ext.data.Store",fields:["id","value"],autoLoad:true,data:[{id:1,value:"Contado",},{id:2,value:"Crédito",},{id:3,value:"Sin costo (entrega gratuita)",},]});Ext.define("AL.model.Currency",{extend:"Ext.data.Model",fields:["code","name","status",{name:"comboName",convert:function(b,a){var c=a.get("code")+" - "+a.get("name");return c}}]});Ext.define("AL.view.currency.FormAdd",{extend:"Ext.form.Panel",alias:"widget.currency_FormAdd",border:false,frame:false,defaults:{labelAlign:"right",labelPad:15,width:250,labelWidth:80},items:[{xtype:"combo",store:"Currencies",fieldLabel:translate("currency",true),displayField:"comboName",valueField:"code",name:"currency",width:310,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{comboName}</div></tpl>',width:"215px"},matchFieldWidth:false,editable:true,forceSelect:true,enableKeyEvents:true,allowBlank:false,emptyText:translate("selectSimple",true),anyMatch:true,queryMode:"local",msgTarget:"side",},{xtype:"container",layout:"hbox",name:"exchangeRateContainer",items:[{width:180,labelWidth:80,xtype:"textfield",labelAlign:"right",fieldLabel:translate("rate",true),name:"exchangeRate",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",msgTarget:"side",allowBlank:false,labelPad:15,}]},{xtype:"checkbox",name:"updateExchangeRateAuto",width:405,labelWidth:210,labelAlign:"right",margin:"10px 0px 0px 72px",boxLabel:"Actualizar tasa automáticamente",inputValue:"yes",hidden:false,countries:["colombia"]}],buttons:[{text:translate("save",true),action:"save",formBind:true,hidden:true}],initComponent:function(){this.items[1].items[0].regexText=translate("currencyEditRateErrorMsg");this.callParent(arguments)}});Ext.define("AL.view.currency.MulticurrencyForm",{extend:"Ext.form.Panel",alias:"widget.currency_Multicurrency",border:false,bodyStyle:"background-color:transparent;",items:[{xtype:"checkboxfield",name:"multicurrency",inputValue:"yes",fieldLabel:"Activar multimoneda",labelWidth:170},{xtype:"component",html:'<div class="tooltip-wrapper" style="left: 150px;top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="position: relative;top:-34px;left: 5px;"><div class="tooltip-text-wrapper" style="width: 379px;"><div class="text">{{currencyCheckboxHelp}}</div></div></div></div>'}],initComponent:function(){this.items[0].fieldLabel=translate("activateMulticurrency",true);this.items[1].html=this.items[1].html.replace("{{currencyCheckboxHelp}}",translate("currencyCheckboxHelp"));this.callParent(arguments)}});Ext.define("AL.store.Currencies",{extend:"Ext.data.Store",model:"AL.model.Currency",proxy:{type:"ajax",url:"/currency/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CompanyCurrencies",{extend:"Ext.data.Store",model:"AL.model.CompanyCurrency",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/currency/retrieve-company-currencies/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Eliminar], img[alt=Inactivar], img[alt=Editar tasa]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.model.CurrencyAdjustmentAccount",{extend:"Ext.data.Model",fields:["idLocal","name","balance","balanceSecondaryCurrency","newBalance","gainOrLoss","adjustBalance","currencySymbol"]});Ext.define("AL.model.CurrencyAdjustment",{extend:"Ext.data.Model",fields:["date","idLocal","currencyCode","observations","amount","deletable","name","editable"]});Ext.define("AL.view.currencyAdjustment.CurrencyAdjustmentForm",{extend:"Ext.form.Panel",alias:"widget.currencyAdjustment_CurrencyAdjustmentForm",bodyPadding:30,anchor:100,items:[{xtype:"hidden",name:"idLocal"},{xtype:"container",layout:"hbox",items:[{xtype:"container",defaults:{msgTarget:"side",labelAlign:"right",labelPad:15},defaultType:"textfield",items:[{xtype:"datefield",fieldLabel:"Fecha",name:"date",width:246,allowBlank:false,value:new Date(),format:"d/m/Y",blankText:"Es necesario definir la fecha",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",readOnly:true},{xtype:"container",layout:"hbox",name:"exchangeRateContainer",margin:"0 0 5 0",items:[{xtype:"label",html:'Tasa<span class="req">*</span>',width:100,style:"text-align: right;",margin:"3 15 0 0"},{xtype:"label",name:"currencyLabelBegin",margin:"3 5 0 0"},{width:80,xtype:"textfield",name:"exchangeRate",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",msgTarget:"side",allowBlank:false,labelPad:15},{xtype:"label",name:"currencyLabelEnd",margin:"3 10 0 7"},{xtype:"button",action:"revalueCurrency",text:"Calcular"}]},{xtype:"textarea",name:"observations",fieldLabel:"Observaciones",width:400},]},{xtype:"container",items:[{xtype:"box",html:"Los ajustes por diferencia en tasa te permiten actualizar el balance de tus bancos a la tasa que desees.",cls:"journal-explanation"}]}]}]});Ext.define("AL.view.currencyAdjustment.GridAdjustmentAccounts",{extend:"Ext.grid.Panel",alias:"widget.currencyAdjustment_GridAdjustmentAccounts",requires:["AL.view.ux.grid.CheckColumn"],title:"",frame:true,border:true,minHeight:180,cls:"grid-adjustment-currency",viewConfig:{markDirty:false,stripeRows:true,emptyText:'<style>.grid-conciliation-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes bancos en la moneda seleccionada!</div></div></div>'},holds:"currencyAdjustmentAccounts",autoScroll:true,store:"CurrencyAdjustmentAccounts",initComponent:function(){this.columns=[{xtype:"checkcolumn",header:"Seleccionar",dataIndex:"adjustBalance",width:80,sortable:false,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"}},{header:"Nombre",dataIndex:"name",align:"center",flex:1},{header:"Balance",dataIndex:"balanceSecondaryCurrency",renderer:this.renderCurrency,sortable:false,align:"center",flex:2},{header:"Balance",dataIndex:"balance",sortable:false,renderer:this.renderMoney,flex:2,align:"center"},{header:"Nuevo balance",dataIndex:"newBalance",renderer:this.renderMoney,align:"center",flex:2},{header:"Ganancia/Pérdida",dataIndex:"gainOrLoss",flex:1.2,renderer:this.renderMoney,align:"center",sortable:false}];this.callParent(arguments)},renderCurrency:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2,b.get("currencySymbol"))},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)}});Ext.define("AL.view.currencyAdjustment.GridAll",{extend:"Ext.grid.Panel",alias:"widget.currencyAdjustment_GridAll",frame:true,minHeight:450,width:1024,columnLines:true,store:"CurrencyAdjustments",viewConfig:{stripeRows:true,emptyText:'<style>.grid-accounts .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has realizado ningún ajuste  por diferencia en tasa!</div></div></div>'},initComponent:function(){this.columns=[{header:"Número",dataIndex:"idLocal",renderer:this.renderLink,sortable:false,},{header:"Fecha",dataIndex:"date",flex:1,renderer:this.renderDate,sortable:false,},{header:"Nombre de la cuenta",dataIndex:"name",flex:1,renderer:this.renderName,sortable:false,},{header:"Moneda",dataIndex:"currencyCode",flex:1,sortable:false,},{header:"Observaciones",dataIndex:"observations",flex:1,sortable:false,},{header:"Ganancia/Pérdida",dataIndex:"amount",flex:1,renderer:this.renderMoney,align:"right",sortable:false,},{header:"Acciones",align:"center",type:"actions",renderer:this.setActions,width:150,sortable:false,}];this.callParent(arguments)},renderLink:function(c,d,a){var b="";if(c){b='<a href="/currency-adjustment/view/id/'+a.get("idLocal")+'">'+c+"</a>"}return b},renderDate:function(f,j,b,c,h,g,d){var a=AL.date(f);var e=Ext.Date.format(a,"d/m/Y");return this.renderLink(e,j,b)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/currency-adjustment/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle" /></a>';if(c.get("editable")){b+='<a href="/currency-adjustment/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Eliminar" title="Eliminar" class="editCurrencyAdjustment" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Eliminar" title="Eliminar" class="disabled" />'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" title="Eliminar" class="deleteCurrencyAdjustment" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" title="Eliminar" class="disabled" />'}b+="</div>";return b},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,2,d)},renderName:function(e,f,b,g,d,c,a){return this.renderLink(e,f,b)}});Ext.define("AL.store.CurrencyAdjustmentAccounts",{extend:"Ext.data.Store",model:"AL.model.CurrencyAdjustmentAccount",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],proxy:{type:"ajax",url:"/currency-adjustment/retrieve-accounts-by-code/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CurrencyAdjustments",{extend:"Ext.data.Store",model:"AL.model.CurrencyAdjustment",remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/currency-adjustment/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.CustomField",{extend:"Ext.data.Model",fields:["id","idLocal","name","description","defaultValue","resourceType","status","type","key"]});Ext.define("AL.view.customField.FormAdd",{extend:"Ext.form.Panel",alias:"widget.customField_FormAdd",border:false,bodyPadding:"0 35 0 20",minHeight:150,defaults:{padding:"0 0 10 0"},configs:{},items:[{xtype:"textfield",fieldLabel:"Nombre",name:"name",allowBlank:false,labelAlign:"right",tooltip:"Esta será la etiqueta que encontrarás en tus campos"},{xtype:"combo",labelAlign:"right",store:"CustomFieldTypes",fieldLabel:"Tipo",displayField:"name",valueField:"type",name:"type",editable:false,forceSelect:true,allowBlank:false,emptyText:"Seleccionar",queryMode:"local",tooltip:"Tipo de dato que deseas registrar en el nuevo "+translate("customfield")},{xtype:"textfield",fieldLabel:"Valor por defecto",name:"defaultValue",labelAlign:"right",tooltip:"Establece un valor por defecto",allowBlank:true,},{xtype:"textarea",fieldLabel:"Descripción",name:"description",labelAlign:"right",}],buttons:[{text:"Cancelar",action:"close",handler:function(a){var b=a.up("window");b.destroy()}},{text:"Guardar",action:"save",formBind:true}]});Ext.define("AL.view.admin.customemail.FormEdit",{extend:"Ext.form.Panel",alias:"widget.admin_customemail_FormEdit",border:false,config:{customEmail:null},items:[{xtype:"textfield",name:"subject",fieldLabel:"Asunto",style:"margin-bottom: 20px;",width:500,labelWidth:50},{xtype:"htmleditor",name:"code",height:500}],buttons:[{text:"Reiniciar",itemId:"reset"},{text:"Previsualizar",itemId:"preview"},{text:"Probar",itemId:"sendTest"},{text:"Guardar",itemId:"save"}],resetForm:function(){var a=this.getCustomEmail();if(a&&a.code){var b=Ext.util.Format.htmlDecode(a.code);this.down("[name=code]").setValue(b);this.down("[name=subject]").setValue(a.subject)}}});Ext.define("AL.model.IncomeExpense",{extend:"Ext.data.Model",fields:["date","detail","amount","amountAdvancesApplied","url","decimalPrecision"]});Ext.define("AL.model.IncomeExpenseGraphPoint",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"in",type:"float"},{name:"out",type:"float"}]});Ext.define("AL.model.OverdueGraphPoint",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"overdueLess30",type:"float"},{name:"overdue30To60",type:"float"},{name:"overduePlus60",type:"float"}]});Ext.define("AL.model.SimpleGraphPoint",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"value",type:"float"},{name:"percentage",type:"int"}]});Ext.define("AL.model.UserHistory",{extend:"Ext.data.Model",fields:["id","idCompany","resourceTitle",{name:"datetime",type:"string",filterField:"datetime"},"userEmail","idResource","url"]});Ext.define("AL.view.dashboard.GridAccounts",{extend:"Ext.grid.Panel",alias:"widget.dashboard_GridAccounts",width:350,minHeight:88,maxHeight:180,columnLines:true,store:"DashboardAccounts",viewConfig:{stripeRows:true,emptyText:'<style>.grid-accounts .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has creado un banco!</div><div class="button-wrapper"><a href="/account/add" class="button green"><span class="plus"></span>Nuevo banco</a></div></div></div>'},listeners:{afterrender:function(){this.getStore().load({callback:function(b,a,c){Ext.each(b,function(d){if(d.get("type")==="credit-card"){d.set("balance",AL.math.mul(-1,d.get("balance")));d.set("balanceSecondaryCurrency",AL.math.mul(-1,d.get("balanceSecondaryCurrency")))}})}})}},initComponent:function(){this.columns=[{header:"Nombre de la Cuenta",dataIndex:"name",flex:5,renderer:this.renderAccount},{header:"Saldo",dataIndex:"balance",flex:3,renderer:this.renderMoney,align:"right"}];this.callParent(arguments)},renderAccount:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/account/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(f,j,b,d,h,g,e){var c=b.get("currencySymbol")?b.get("currencySymbol"):null;var a=b.get("currencyCode")?b.get("balanceSecondaryCurrency"):b.get("balance");return Ext.util.Format.usMoney(a,2,c)}});Ext.define("AL.view.dashboard.GridIncomeExpense",{extend:"Ext.grid.Panel",alias:"widget.dashboard_GridIncomeExpense",frame:false,emptyMessage:"Aún no has registrado transacciones",emptyLinkText:"¡Registra tu primer ingreso aquí!",emptyLink:"/transaction/in",height:190,columnLines:true,store:"",viewConfig:{stripeRows:true,emptyText:'<div class="blank-state-message"><div class="message"></div><div class="link"><a href=""></a></div></div><div class="dashboard-blank-state-grids"></div>'},listeners:{afterrender:function(){var a=this.getStore();var b=this;a.on("load",function(){a.sort("date","DESC");if(a.getRange()==0){b.applyEmptyMessage()}})}},applyEmptyMessage:function(){var a=this.getEl().down(".blank-state-message");a.down(".message").setHTML(this.emptyMessage);a.down(".link a").setHTML(this.emptyLinkText);a.down(".link a").set({href:this.emptyLink})},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",align:"center",width:85,renderer:this.renderDate},{header:"Detalle",dataIndex:"detail",renderer:this.renderDetail,flex:10},{header:"Valor",dataIndex:"amount",renderer:this.renderMoney,align:"right",width:113}];this.callParent(arguments)},renderDetail:function(e,f,b,g,d,c,a){return'<a href="'+b.get("url")+'">'+e+"</a>"},renderDate:function(f,j,c,d,h,g,e){var b=AL.date(f);var a=Ext.Date.format(b,"d/m/Y");return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.dashboard.DateOptions",{extend:"Ext.form.Panel",alias:"widget.dashboard_DateOptions",border:false,width:350,style:"margin-bottom:20px;",bodyStyle:"background: transparent",enableButtons:function(){var a=this.query("button");Ext.each(a,function(b){b.enable()})},disableButtons:function(){var a=this.query("button");Ext.each(a,function(b){b.disable()})},getPressedButton:function(){var a=this.query("button");var b=null;Ext.each(a,function(c){if(c.pressed){b=c}});return b},defaultButton:"thisWeek",listeners:{afterrender:function(){var a=this.down("button[dateRange="+this.defaultButton+"]");if(a){setTimeout(function(){a.toggle()},500)}}},defaults:{width:100,height:40,style:"margin-right:5px"},items:[{xtype:"button",cls:"dashboard-button",enableToggle:true,toggleGroup:"date-buttons",allowDepress:false,text:"Hoy",dateRange:"today"},{xtype:"button",enableToggle:true,cls:"dashboard-button",toggleGroup:"date-buttons",allowDepress:false,text:"Esta semana",dateRange:"thisWeek"},{xtype:"button",enableToggle:true,cls:"dashboard-button",toggleGroup:"date-buttons",allowDepress:false,text:"Este mes",dateRange:"thisMonth"}]});Ext.define("AL.view.dashboard.GraphExpense",{extend:"Ext.chart.Chart",alias:"widget.dashboard_GraphExpense",width:350,height:200,animate:true,store:"ExpenseGraph",theme:"ExpenseTheme",legend:{position:"right",boxStrokeWidth:0,clickable:true,labelFont:"10px helvetica",configs:{width:150}},configs:{type:"pie"},shadow:false,series:[{type:"pie",field:"value",showInLegend:true,highlight:true,highlightCfg:{segment:{margin:5},fillOpacity:0.9,stroke:"#E8EBF0",},style:{fillOpacity:1,lineWidth:2,stroke:"#FFF",},tips:{trackMouse:true,width:200,height:45,cls:"tooltip-graph",renderer:function(a,b){var c=a.get("name")+" <br>"+Ext.util.Format.usMoney(a.get("value"),AL.config.decimalPrecision)+" ("+a.get("percentage")+"%)";this.setTitle(c)}}}]});Ext.define("AL.view.dashboard.GraphExpensePanel",{extend:"Ext.panel.Panel",alias:"widget.dashboard_GraphExpensePanel",border:false,width:350,height:240,items:[{xtype:"container",items:[{xtype:"box",name:"radioGroup",cls:"horizontal-label-radio-group",style:"margin-left   : 21%;",html:'<input type="radio" value="categories" id="optionCategories" name="selector" checked="true"><label for="optionCategories">'+translate("categoriesTitle",true)+'</label><input type="radio" value="providers" id="optionProviders" name="selector"><label for="optionProviders">'+translate("suppliers",true)+"</label>"},{xtype:"box",name:"reloadButton",html:'<div class="graph-reload-button"></div>'},{xtype:"dashboard_GraphExpense"}]}]});Ext.define("AL.view.dashboard.GraphIncomeExpense",{extend:"Ext.chart.Chart",alias:"widget.dashboard_GraphIncomeExpense",animate:true,width:552,height:200,store:"IncomeExpenseGraph",theme:"IncomeExpenseTheme",shadow:true,legend:{docked:"bottom",boxStrokeWidth:0,clickable:true},configs:{completeLimit:true},axes:[{type:"Numeric",minimum:0,position:"left",fields:["in","out"],dashSize:1.5,label:{renderer:function(a){return AL.format.valueForGraph(a)},style:{fill:"#6E6E6E"}}},{type:"Category",position:"bottom",fields:["name"]}],series:[{type:"Column",xField:"name",yField:["in","out"],title:[translate("incomesMenu",true),translate("expenses",true)],groupGutter:1,highlight:true,highlightCfg:{lineWidth:1,stroke:"#E8EBF0",},style:{lineWidth:0},tips:{trackMouse:true,width:160,height:45,cls:"tooltip-graph",renderer:function(a,c){var e,b;if(c.yField==="in"){e=translate("incomesMenu",true)+": "+Ext.util.Format.usMoney(a.get("in"),AL.config.decimalPrecision)}else{e=translate("expenses",true)+": "+Ext.util.Format.usMoney(a.get("out"),AL.config.decimalPrecision)}var d=a.get("name")+"<br>"+e;this.setTitle(d)}},renderer:function(e,a,c,d,b){if(a){if(a.get("in")<0){a.set("in",AL.config.decimalPrecision)}if(a.get("out")<0){a.set("out",AL.config.decimalPrecision)}}return c}}]});Ext.define("AL.view.dashboard.GraphOpenInvoices",{extend:"Ext.chart.Chart",alias:"widget.dashboard_GraphOpenInvoices",animate:true,theme:"IncomeTheme",width:552,height:200,store:"OpenInvoicesGraph",shadow:true,legend:{docked:"bottom",boxStrokeWidth:0},configs:{completeLimit:true},axes:[{type:"Numeric",minimum:0,position:"left",fields:["overdueLess30","overdue30To60","overduePlus60"],dashSize:1.5,label:{renderer:function(a){return AL.format.valueForGraph(a)},style:{fill:"#6E6E6E"}}},{type:"Category",position:"bottom",fields:"name"}],series:[{type:"Column",axis:"left",xField:"name",stacked:true,yField:["overdueLess30","overdue30To60","overduePlus60"],showInLegend:true,title:[translate("thirtyDaysOrLessIncludesNotExpired",true),translate("thirtytoSixty",true),translate("moreThanSixty",true)],highlight:true,highlightCfg:{lineWidth:1,stroke:"#E8EBF0",},style:{lineWidth:0},tips:{trackMouse:true,width:270,height:67,cls:"tooltip-graph",renderer:function(a,c){var f,e,b=0;f=Ext.util.Format.usMoney(a.get(c.yField),AL.config.decimalPrecision);b=Ext.util.Format.usMoney(AL.math.add(b,a.get("overdueLess30")+a.get("overdue30To60")+a.get("overduePlus60")),AL.config.decimalPrecision);switch(c.yField){case"overdueLess30":e=translate("overdueLessThan30",true);break;case"overdue30To60":e=translate("overdueBetween30",true);break;case"overduePlus60":e=translate("overdueMoreThan61",true);break}var d=translate("totalReceivable",true)+" <br>"+b+" <br>"+e+" <br>"+f;this.setTitle(d)}},renderer:function(e,a,c,d,b){if(a){if(a.get("overdueLess30")<0){a.set("overdueLess30",0)}if(a.get("overdue30To60")<0){a.set("overdue30To60",0)}if(a.get("overduePlus60")<0){a.set("overduePlus60",0)}}return c}}]});Ext.define("AL.view.dashboard.GraphOpenInvoicesPanel",{extend:"Ext.panel.Panel",alias:"widget.dashboard_GraphOpenInvoicesPanel",style:"overflow:visible;",bodyStyle:"overflow: visible;",border:false,width:550,height:255,items:[{xtype:"container",items:[{xtype:"box",name:"reloadButton",html:'<div class="graph-reload-button"></div>'},{xtype:"dashboard_GraphOpenInvoices"},{xtype:"box",itemId:"firstInvoiceButton",html:'<div id="finvoice" class="first-invoice button-dashboard"><strong><a href="/invoice/add">'+translate("createYourFirstSalesInvoice",true)+'</a></strong></div><div class="dashboard-blank-state-graph"></div>',hidden:true}]}],});Ext.define("AL.view.dashboard.GraphSalesPanel",{extend:"Ext.panel.Panel",alias:"widget.dashboard_GraphSalesPanel",style:"overflow:visible;",bodyStyle:"overflow: visible;",border:false,width:350,height:255,items:[{xtype:"container",items:[{xtype:"box",name:"radioGroup",cls:"horizontal-label-radio-group",style:"margin-left : 11%;",html:'<form><input type="radio" id="optionClients" name="selector" checked="true" value="clients"><label for="optionClients">'+translate("bestClients",true)+'</label><input type="radio" id="optionItems" name="selector" value="items"><label for="optionItems">'+translate("mostSoldItems",true)+"</label></form>"},{xtype:"box",name:"reloadButton",html:'<div class="graph-reload-button"></div>'},{xtype:"dashboard_GraphSales"}]}],});Ext.define("AL.view.dashboard.GraphSales",{extend:"Ext.chart.Chart",alias:"widget.dashboard_GraphSales",width:350,height:200,animate:true,theme:"IncomeTheme",store:"SalesGraph",legend:{position:"right",boxStrokeWidth:0,clickable:true,labelFont:"10px helvetica",configs:{width:150}},configs:{type:"pie"},shadow:false,series:[{type:"pie",field:"value",showInLegend:true,highlight:true,highlightCfg:{segment:{margin:5},fillOpacity:0.9,stroke:"#E8EBF0",},style:{fillOpacity:1,lineWidth:2,stroke:"#FFF",},tips:{trackMouse:true,width:200,height:45,cls:"tooltip-graph",renderer:function(a,b){var c=a.get("name")+" ("+a.get("percentage")+"%)<br> "+Ext.util.Format.usMoney(a.get("value"),AL.config.decimalPrecision);this.setTitle(c)}}}]});Ext.define("AL.view.dashboard.GridUserHistory",{extend:"Ext.grid.Panel",alias:"widget.dashboard_GridUserHistory",columnLines:true,store:"DashboardUserHistory",width:980,minHeight:100,viewConfig:{emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes historial para mostrar!</div></div></div>'},listeners:{afterrender:function(){var a=this.getStore();a.load()}},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"datetime",align:"center",width:85,renderer:this.renderDate},{header:"Detalle",dataIndex:"resourceTitle",flex:2,renderer:this.renderDetail},{header:"Usuario",dataIndex:"userEmail",align:"rigth",flex:1}];this.callParent(arguments)},renderDetail:function(f,j,c,d,h,g,e){var a=c.get("url");var b="";if(f){if(a){b='<a href = "'+a+'">'+f+"</a>"}else{b=f}}return b},renderDate:function(f,j,c,d,h,g,e){f=f.replace(/-/g,"/");var b=new Date(f);var a=Ext.Date.format(b,"d/m/Y H:i");return a}});Ext.define("AL.view.dashboard.OldGraphIncomeExpense",{extend:"Ext.chart.Chart",alias:"widget.dashboard_OldGraphIncomeExpense",id:"grafica",animate:{duration:580,esasing:"ease"},width:552,height:200,store:"IncomeExpenseGraph",axes:[{type:"Numeric",minimum:0,position:"left",fields:["in","out"],title:"",label:{renderer:Ext.util.Format.currency},renderer:"currency"},{type:"Category",position:"bottom",fields:["name"],title:"Día"}],series:[{type:"line",axis:"left",xField:"name",yField:"in",smooth:true,fill:true,style:{stroke:"#568F3F","stroke-width":2,fill:"#568F3F"},markerConfig:{type:"circle",size:4,radius:3,stroke:"#568F3F","stroke-width":0},highlight:{size:3,radius:6},tips:{trackMouse:true,width:140,height:28,renderer:function(b,a){this.setTitle(Ext.util.Format.usMoney(b.get("in"),2))}}},{type:"line",axis:"left",xField:"name",yField:"out",smooth:true,fill:true,style:{stroke:"#C91D1D","stroke-width":2,fill:"#bc0d0d"},markerConfig:{type:"circle",size:4,radius:3,stroke:"#bc0d0d","stroke-width":0},highlight:{size:3,radius:6},tips:{trackMouse:true,width:140,height:28,renderer:function(b,a){this.setTitle(Ext.util.Format.usMoney(b.get("out"),2))}}}]});Ext.define("AL.view.dashboard.OldGraphIncomeExpensePanel",{extend:"Ext.panel.Panel",alias:"widget.dashboard_OldGraphIncomeExpensePanel",border:false,width:552,items:[{xtype:"radiogroup",width:"210px",style:"float: right",items:[{boxLabel:"Día a día",name:"type",inputValue:"day-to-day"},{boxLabel:"Acumulado",name:"type",inputValue:"cumulative",checked:true}]},{xtype:"container",items:[{xtype:"dashboard_OldGraphIncomeExpense"},{xtype:"box",itemId:"firstInvoiceButton",html:'<div id="finvoice" class="old-first_invoice"><strong><a href="/invoice/add">¡Crea tu primera factura!</a></strong></div><div class="dashboard-blank-state-graph"></div>',hidden:true}]}]});Ext.define("AL.store.DashboardAccounts",{extend:"Ext.data.Store",model:"AL.model.Account",autoLoad:false,proxy:{type:"ajax",url:"/account/retrieve-all-for-dashboard/format/json",reader:{type:"json",root:"results"},sorters:[{property:"category",direction:"ASC"},{property:"name",direction:"ASC"}]}});Ext.define("AL.store.DashboardIncome",{extend:"Ext.data.Store",model:"AL.model.IncomeExpense",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-income-for-dashboard/format/json",reader:{type:"json",root:"results"},sortOnLoad:true,sorters:[{property:"date",direction:"DESC"}]}});Ext.define("AL.store.DashboardExpense",{extend:"Ext.data.Store",model:"AL.model.IncomeExpense",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-expense-for-dashboard/format/json",reader:{type:"json",root:"results"},sorters:[{property:"date",direction:"DESC"}]}});Ext.define("AL.store.DashboardUserHistory",{extend:"Ext.data.Store",model:"AL.model.UserHistory",autoLoad:false,proxy:{type:"ajax",url:"/history/retrieve-history-dashboard/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ExpenseGraph",{extend:"Ext.data.Store",model:"AL.model.SimpleGraphPoint",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-expense-graph/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.IncomeExpenseGraph",{extend:"Ext.data.Store",model:"AL.model.IncomeExpenseGraphPoint",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-income-expense-graph/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.OpenInvoicesGraph",{extend:"Ext.data.Store",model:"AL.model.OverdueGraphPoint",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-open-invoices-graph/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.SalesGraph",{extend:"Ext.data.Store",model:"AL.model.SimpleGraphPoint",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-sales-graph/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.DistributorCompany",{extend:"Ext.data.Model",fields:["id","name","planName","idPlan",{name:"dateEnd",type:"date",dateFormat:"c"},{name:"dateStart",type:"date",dateFormat:"c"},{name:"registryDate",type:"date",dateFormat:"c"},"trialMode"]});Ext.define("AL.store.DistributorCompanies",{extend:"Ext.data.Store",model:"AL.model.DistributorCompany",autoLoad:false,pageSize:20,proxy:{type:"ajax",url:"/distributor/retrieve-companies/format/json",reader:{type:"json",root:"results"},sorters:[]}});Ext.define("AL.model.ItemDebitNote",{extend:"Ext.data.Model",fields:["idLocal","reference","name","description","price","idTax"],proxy:{type:"ajax",method:"POST",api:{read:"/itemDebitNote/retrieve-all/format/json",update:"data/updateItems.json",create:"/itemDebitNote/add/format/json",destroy:"/itemDebitNote/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.view.debitnote.FormAddBill",{extend:"Ext.form.Panel",alias:"widget.debitnote_FormAddBill",hideMode:"display",border:false,style:"border-bottom: 1px solid #eee",bodyPadding:8,anchor:100,layout:{type:"hbox"},defaults:{anchor:"100%",msgTarget:"side"},defaultType:"textfield",items:[{xtype:"hidden",name:"idBill"},{xtype:"displayfield",name:"billNumber",width:180},{xtype:"displayfield",name:"total",fieldStyle:"padding-left: 10px; padding-right:20px;",width:200},{xtype:"displayfield",name:"totalPayed",fieldStyle:"color: #64A574;padding-left:10px;",width:200},{xtype:"displayfield",name:"missingAmount",fieldStyle:"color: #B83F3F",width:170},{xtype:"textfield",name:"amount",width:170,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",style:"margin-left: 18px",enableKeyEvents:true,calculateFromRetentions:true}]});Ext.define("AL.view.debitnote.FormAddBillCombo",{extend:"Ext.form.Panel",alias:"widget.debitnote_FormAddBillCombo",border:false,style:"border-bottom: 1px solid #eee; padding-top: 5px;",bodyPadding:5,anchor:100,layout:"hbox",defaults:{anchor:"100%",msgTarget:"side"},height:50,defaultType:"textfield",items:[{xtype:"combo",name:"number",triggerAction:"all",allowBlank:false,emptyText:translate("invoice",true),store:"",displayField:"billNumber",valueField:"idLocal",queryMode:"local",width:140,style:"margin-right: 10px",matchFieldWidth:false,blankText:translate("itIsNecessaryToSelectTheInvoiceToBeAssociated",true,{theInvoice:translate("theInvoice"),invoice:translate("bill")}),listConfig:{width:200,height:200},editable:false},{xtype:"hidden",name:"idBill"},{xtype:"displayfield",name:"total",fieldStyle:"padding-left: 50px; padding-right:20px;",width:200},{xtype:"displayfield",name:"totalPayed",fieldStyle:"color: #64A574;padding-left:50px;",width:200},{xtype:"displayfield",name:"missingAmount",fieldStyle:"color: #B83F3F;padding-left:30px;",width:170},{xtype:"textfield",name:"amount",allowBlank:false,width:130,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",disabled:true,blankText:translate("itIsNecessaryToFixTheAmountToBePaid",true),listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.el,trackMouse:true,html:a.notAllowedText,listeners:{beforeshow:function b(c){if(!a.isDisabled()||!a.notAllowedText){return false}c.update(a.notAllowedText)}}})}}},{xtype:"button",action:"deleteInvoice",width:16,height:16,style:"margin-left: 20px",baseCls:"none"}]});Ext.define("AL.store.ItemsDebitNote",{extend:"Ext.data.Store",model:"AL.model.ItemDebitNote",autoLoad:false,proxy:{type:"ajax",url:"/item/index/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.Estimate",{extend:"Ext.data.Model",fields:["idLocal","idClient","name",{name:"date",type:"date",dateFormat:"c"},{name:"dueDate",type:"date",dateFormat:"c"},"observations","anotation","identification","phone1","phone2","fax","mobile","address","city","total","editable","deletable","decimalPrecision","currencySymbol","prefix","number","estimateNumber","canPrintOrDownload","subDocumentTypeLetter",],proxy:{type:"ajax",method:"POST",api:{read:"/estimate/retrieve-all/format/json",update:"data/updateItems.json",create:"/estimate/add/format/json",destroy:"/estimate/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.view.estimate.FormAdvancedOptions",{extend:"Ext.form.Panel",alias:"widget.estimate_FormAdvancedOptions",layout:"hbox",width:1050,display:"none",style:"margin-top:10px",items:[{xtype:"container",style:"margin-left: 25px;",name:"containerLeft",width:534,items:[{xtype:"textarea",labelAlign:"right",fieldLabel:'Observaciones <div class="sublabel">(no visible en la '+translate("estimate")+")</div>",name:"observations",id:"estimateObservationsTextarea",width:400,labelPad:15,allowBlank:true,hidden:true}]},{xtype:"container",defaults:{msgTarget:"side",labelAlign:"right",labelWidth:150,width:350,labelPad:15},items:[{xtype:"combo",fieldLabel:translate("seller",true),name:"idSeller",allowBlank:true,queryMode:"local",store:"SellersCombo",valueField:"idLocal",displayField:"name",emptyText:translate("selectSimple",true),matchFieldWidth:false,listConfig:{emptyText:'<div style="padding:3px 5px 5px !important; color:#666;">Aún no has registrado vendedores</div><div style="padding: 0px 0px 7px 5px;"><a id="createSeller" href="/seller/add" >'+translate("createNewSeller",true)+"</a></div>",width:200},editable:false},{xtype:"combo",name:"idPriceList",fieldLabel:translate("priceList",true),displayField:"name",valueField:"idLocal",store:"PriceListCombo",editable:false,labelAlign:"right",queryMode:"local",tooltip:translate("indicateThePriceListYouWishToUseIn",true)+" "+translate("this")+" "+translate("estimate"),labelPad:15,allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">Nueva lista</a></div>'}}]}]});Ext.define("AL.view.estimate.BottomContainer",{extend:"Ext.panel.Panel",alias:"widget.estimate_BottomContainer",xtype:"bottomcontainer",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:35,style:"width: 100%; padding-left: 30px; padding-right: 30px; left:0;",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textarea",flex:1,fieldLabel:translate("notes",true),name:"anotation",allowBlank:true,labelAlign:"top",labelStyle:"margin-bottom: 11px;",fieldStyle:"max-height: 80px !important; padding: 8px !important;",emptyText:translate("visibleInDocumentPrinting",true),msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper" style="left: 44px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -54px; top: 5px;"><div class="tooltip-text-wrapper"><div class="text">'+translate("addImportantInformationThatClientsWillSeeIn",true)+translate("theEstimate")+" "+translate("estimate")+"</div></div></div></div>"}]}]},{xtype:"container",style:"margin-top: 29px;",items:[{xtype:"box",name:"requiredText",cls:"bottom-container-required-fields-text",html:""}]}]});Ext.define("AL.view.invoice.TotalLeftContainer",{extend:"Ext.panel.Panel",alias:"widget.invoice_TotalLeftContainer",xtype:"totalleftcontainer",items:[{xtype:"container",margin:"60 0 60 36",layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",name:"signatureBox",configs:{maxWidth:300,maxHeight:86,madeByText:"ELABORADO POR"},html:'<div class="form-add-invoice-image-zone" onselectstart="return false;"><div style="font-size: 24px; font-weight: bold; padding-top: 23px;">'+translate("useMySignature",true)+'</div><div style="font-size: 12px;">178 x 51 '+translate("pixels")+"</div></div>"}]}]});Ext.define("AL.store.Estimate",{extend:"Ext.data.Store",model:"AL.model.Estimate",autoLoad:false,remoteSort:true,pageSize:20,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/estimate/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.model.SaleTicket",{extend:"Ext.data.Model",fields:["idLocal","number",{name:"invoiceNumber",type:"string"},{name:"date",type:"date",dateFormat:"c"},{name:"total",type:"number"},{name:"observations",type:"string"},"uuid","idGlobalInvoice",]});Ext.define("AL.model.Resolution",{extend:"Ext.data.Model",fields:["idLocal","idCompany","prefix","nextInvoiceNumber","resolutionText",{name:"isDefault",type:"string",isEnum:true,values:{yes:"Si",no:"No"}},"isElectronicResolution",{name:"status",type:"string",isEnum:true,values:{active:translate("active",true),inactive:translate("inactive",true)}},"editable","deletable","autoincrement","name","endDate",{name:"documentType",type:"string",isEnum:true,values:{invoice:{name:translate("specializedInvoice",true)},saleTicket:{country:["peru"],name:translate("saleTicket",true)},creditNote:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("creditNote",true)},debitNote:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("debitNote",true)},transactionIn:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("transactionIn",true)},transactionOut:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("transactionOut",true)},estimate:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("estimate",true)},purchaseOrder:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("purchaseOrder",true)},remission:{country:["republicaDominicana","peru","argentina","chile","costaRica"],name:translate("remission",true)},creditNoteSaleTicket:{country:["peru"],name:translate("creditNoteSaleTicket",true)},}},"startDate","endDate","metadata"],idProperty:"idLocal"});Ext.define("AL.view.globalInvoice.FormAddGlobalInvoice",{extend:"Ext.form.Panel",alias:"widget.globalInvoice_FormAddGlobalInvoice",configs:{autoIncrement:true},bodyPadding:30,layout:"hbox",defaultType:"textfield",items:[{xtype:"container",name:"containerLeft",flex:1.5,items:[{xtype:"combo",name:"resolutionCombo",width:270,fieldLabel:translate("numeration",true),blankText:"Es necesario seleccionar una "+translate("numeration")+" para "+translate("theInvoice")+" "+translate("invoice"),allowBlank:false,forceSelection:true,displayField:"name",store:"ResolutionsCombo",labelAlign:"right",queryMode:"local",valueField:"idLocal",msgTarget:"side",labelWidth:100,labelPad:13,hidden:false,editable:false,matchFieldWidth:false,listConfig:{width:157},style:{"margin-left":"3px"}},{xtype:"panel",id:"nextInvoiceNumberContainer",layout:"hbox",border:false,width:610,style:" margin: 8px 0;",items:[]},]},{xtype:"container",flex:0.84,defaults:{msgTarget:"side",labelAlign:"right",width:300,labelPad:15},items:[{xtype:"datefield",fieldLabel:"Fecha",tooltip:"Fecha en la que se emite "+translate("theGlobalInvoice"),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:"Es necesario definir la fecha de emisión de "+translate("theGlobalInvoice"),invalidText:"{0} no es una fecha válida - debe estar en el formato {1}"}]}],listeners:{afterrender:function(c,b){if(c.type||c.type==="edit"){var d=c.down("#nextInvoiceNumberContainer");var a=[{xtype:"textfield",name:"prefix",width:170,fieldLabel:translate("number",true),emptyText:translate("prefix",true),labelAlign:"right",labelPad:14},{xtype:"textfield",name:"number",emptyText:translate("number",true),hideLabel:true,allowBlank:false,regex:/^[0-9]+$/,width:125,style:"margin-left:5px;"+(c.configs&&c.configs.country==="peru"?"margin-top:10px;":""),msgTarget:"side",blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice")}];d.add(a)}}}});Ext.define("AL.view.globalInvoice.Buttons",{extend:"Ext.form.Panel",alias:"widget.globalInvoice_Buttons",bodyPadding:0,frame:true,layout:"anchor",defaults:{anchor:"100%"},buttons:[{text:"Cancelar",action:"cancel",width:150,height:38,cls:"sm-button-basic",style:"margin-left: 20px;",},{xtype:"splitbutton",text:"Timbrar",action:"saveAndStamp",disabled:true,hidden:false,style:"margin-left: 20px;",cls:"sm-button-primary",width:157,height:38,id:"saveAndStampGlobalInvoiceButton",menu:new Ext.menu.Menu({id:"saveAndStampGlobalInvoiceButtonDropDown",action:"saveGlobalInvoice",items:[{text:"Guardar sin timbrar",action:"save",status:"open",id:"saveGlobalInvoiceButton"}]})}]});Ext.define("AL.store.SaleTickets",{extend:"Ext.data.Store",model:"AL.model.SaleTicket",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/invoice/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.ResolutionsCombo",{extend:"Ext.data.Store",model:"AL.model.Resolution",proxy:{type:"ajax",url:"/resolution/retrieve-all-active/format/json",reader:{type:"json",root:"results"}},sorters:[{property:"name",direction:"ASC"}]});Ext.define("AL.store.HistoryGridAll",{extend:"Ext.data.Store",model:"AL.model.UserHistory",pageSize:20,autoLoad:false,remoteSort:true,proxy:{type:"ajax",url:"/history/retrieve-all-history/format/json",timeout:120000,reader:{type:"json",root:"results"}}});Ext.define("AL.model.ItemSold",{extend:"Ext.data.Model",fields:["idLocal","reference","description","price","idTax","idRemission"],proxy:{type:"ajax",method:"POST",api:{read:"/itemSold/retrieve-all/format/json",update:"data/updateItems.json",create:"/itemSold/add/format/json",destroy:"/item/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.InvoicePayment",{extend:"Ext.data.Model",fields:["idLocal","editable","deletable","voidable","number","name","amount","accountName","idAccount","date","type","transactionNumber","associations","decimalPrecision","openable","status","currencySymbol"]});Ext.define("AL.model.AutoRetention",{extend:"Ext.data.Model",fields:["idLocal","name","retention","description","editable","deletable"]});Ext.define("AL.model.InvoiceVersion",{extend:"Ext.data.Model",fields:["idLocal","invoiceNumber","datetime","date","version","invoiceIdLocal"]});Ext.define("AL.model.Remission",{extend:"Ext.data.Model",fields:["idClient","idCompany","idLocal","idSeller","idPriceList","observations","anotation","name","identification","phone1","fax","mobile","address","city","decimalPrecision",{name:"date",type:"date",dateFormat:"c"},{name:"dueDate",type:"date",dateFormat:"c"},"total","editable","deletable","voidable",{name:"status",type:"string",isEnum:true,values:{open:translate("withoutStatus",true),closed:translate("billed",true),"void":translate("canceledFemale",true)}},"documentName","remissionNumber","number","currencySymbol","currencyCode",{name:"openable",type:"boolean"},"warehouse","canPrintOrDownload","metadata"],proxy:{type:"ajax",method:"POST",api:{read:"/remission/retrieve-all/format/json",update:"data/updateItems.json",create:"/remission/add/format/json",destroy:"/remission/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.GlobalInvoice",{extend:"Ext.data.Model",fields:["prefix","number","invoiceNumber","idLocal","idClient","idResolution","status","uuid",{name:"date",type:"date",dateFormat:"c"},"total","deletable","voidable",{name:"decimalPrecision",type:"int"}]});Ext.define("AL.view.buttons.SaveInvoice",{extend:"Ext.form.Panel",alias:"widget.buttons_SaveInvoice",enableButtons:function(){var a=this.query("button");Ext.each(a,function(b){b.enable()})},disableButtons:function(){var a=this.query("button");Ext.each(a,function(b){b.disable()})},cls:"buttons-form",items:[{xtype:"buttons_Cancel",width:150,height:38,cls:"sm-button-basic",style:"margin-left: 20px;",},{xtype:"button",text:translate("preview",true),action:"save",status:"draft",afterSave:"preview",width:157,height:38,cls:"sm-button-basic",style:"margin-left: 20px;"},{xtype:"button",text:translate("saveAndAddPayment",true),action:"save",status:"open",cls:"sm-button-basic",afterSave:"addPayment",width:157,height:38,style:"margin-left: 20px;"},{xtype:"button",text:translate("save",true)+" "+translate("and")+" "+translate("stamp"),name:"stampReplace",cls:"sm-button-basic",status:"open",width:157,height:38,style:"margin-left: 20px;",hidden:true},{xtype:"button",text:translate("saveAndCreateNew",true),action:"save",status:"open",cls:"sm-button-basic",afterSave:"createInvoice",width:157,height:38,style:"margin-left: 20px;"},{xtype:"splitbutton",text:translate("save",true),action:"save",status:"open",style:"margin-left: 20px;",cls:"sm-button-primary",width:157,height:38,id:"invoiceSaveInvoiceButton",menu:new Ext.menu.Menu({id:"invoiceSaveButtonDropDown",action:"saveInvoice",items:[{text:translate("saveAsDraft",true),action:"save",status:"draft"},{text:translate("saveAndPrint",true),action:"save",status:"open",afterSave:"print"}]})}],frame:false,border:false,layout:{type:"hbox",pack:"end"}});Ext.define("AL.view.invoice.GridVersions",{extend:"Ext.grid.Panel",alias:"widget.invoice_GridVersions",scroll:true,minHeight:390,width:1024,border:false,store:"InvoiceVersions",sortableColumns:false,invoiceNumber:null,columnLines:true,cls:"grid-invoice-versions grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-invoice-versions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("theInvoice",true)+" "+translate("invoice")+" no tiene versiones disponibles!</div></div></div>"},enableColumnHide:false,listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.url="/invoice/retrieve-versions/id/"+c.invoiceIdLocal+"/format/json";a.load()}},initComponent:function(){this.columns=[{header:"Versión",dataIndex:"version",flex:1,align:"left",hideable:false},{header:"Fecha",dataIndex:"datetime",flex:2,renderer:this.renderDate,align:"left",hideable:false},{header:translate("number",true)+" de "+translate("invoice"),dataIndex:"invoiceNumber",flex:2,align:"center",hideable:false},{header:"Acciones",align:"center",type:"invoiceVersionsActions",renderer:this.setActions,width:150}];this.callParent(arguments)},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(e,f,b,h,d,c,a){var g='<div class="action-icons">';g+='<a href="/invoice/view/id/'+b.get("invoiceIdLocal")+"/version/"+b.get("version")+'"><img src="https://cdn1.getsoft.app/images/icons/clock.png" alt="Ver '+translate("invoice")+' en esta versión" title="Ver '+translate("invoice")+' en esta versión"></a>';g+="</div>";return g}});Ext.define("AL.view.invoice.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.invoice_MoreActionsButton",text:translate("moreActions",true),cls:"button2 sm-button-basic filling",style:"margin: 0 0.5em; padding: 0 8px 0 1em;",height:38,status:null,idLocal:null,invoiceNumber:null,canPrint:"no",canEmail:"no",isEditable:false,hasStamp:false,retentionsAreEditable:false,hasBeenEdited:false,isVoidable:false,hasCreditNotes:false,needReplacement:null,hasCreditNoteStamped:false,hasStampTransactionsPending:false,handler:function(){this.showMenu()},typeTransaction:"in",initComponent:function(){var d=[];switch(this.status){case"draft":if(this.isActiveElectronicInvoicing&&!(this.country==="mexico"&&this.documentType==="saleTicket")){d.push({text:"Facturar y "+translate("stamp"),href:"#",action:"convertInvoiceToOpen"});d.push({text:"Facturar sin "+translate("stamp"),href:"#",action:"convertInvoiceToOpen",stamp:"no"})}else{d.push({text:translate("toBill",true),href:"#",action:"convertInvoiceToOpen",stamp:"no"})}break;case"void":if(this.country==="mexico"&&this.documentType!=="saleTicket"){d.push({text:translate("toBill",true),href:"#",action:"convertInvoiceToOpen",stamp:"no"})}if(this.country==="republicaDominicana"&&!this.hasVoidCause){d.push({text:"Agregar motivo de "+translate("cancelation"),href:"#",action:"addVoidCause"})}break}if((this.status=="void"||this.status=="closed")&&this.hasStamp&&this.needReplacement==true){d.push({text:"Sustituir",href:"/invoice/add/idInvoice/"+this.idLocal+"/replace/true"});d.push("-")}if(this.country=="mexico"){if((this.status=="open"||this.status=="closed")&&this.hasStamp&&this.mxIsWaitingToVoid){d.push({text:"Descargar acuse de solicitud",href:"/invoice/generate-cancel-receipt/id/"+this.idLocal});d.push("-")}}if(this.documentType!=="saleTicket"&&!this.hasRemissions){d.push({text:translate("clone",true),href:"/invoice/add/idInvoice/"+this.idLocal,action:"cloneInvoice"},{text:translate("convert",true)+" "+translate("recurring"),action:"makeRecurring",href:"/invoice/make-recurring/id/"+this.idLocal});d.push("-")}if(this.isEditable===true){d.push({text:translate("edit",true),href:"/invoice/edit/id/"+this.idLocal})}else{var b="";if(this.hasStamp===true){b=", sin "+translate("stamp")}if(this.country!=="mexico"||this.documentType=="invoice"){d.push({text:translate("edit",true),id:"edit",cls:Ext.baseCSSPrefix+"menu-item-disabled",listeners:{click:function(){Ext.Msg.show({title:"",msg:translate("youCanOnlyEditYour",true)+" "+translate("invoice")+" "+translate("withStatusOpen")+" "+b+"<br> "+translate("andWithoutCreditNotesAssociated")+'. <a href="https://ayuda.getsoft.app/c%C3%B3mo-editar-una-factura-cobrada" target="_blank">'+translate("seeMore",true)+".</a>",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}})}else{if(this.country=="mexico"&&this.documentType==="saleTicket"){d.push({text:translate("edit",true),id:"edit",cls:Ext.baseCSSPrefix+"menu-item-disabled",listeners:{click:function(){Ext.Msg.show({title:"",msg:"No puedes editar "+translate("aSaleTicket")+" en estado "+translate("canceledMale")+" o asociado a "+translate("aGlobalInvoice")+".",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}})}}}if(this.retentionsAreEditable===true){d.push({text:translate("edit",true)+" "+translate("retentions"),href:"/invoice/edit-retentions/id/"+this.idLocal})}d.push("-");if(this.hasBeenEdited===true){d.push({text:translate("seeVersions",true),href:"/invoice/view-versions/id/"+this.idLocal})}else{d.push({text:translate("seeVersions",true),disabled:true})}if(this.isVoidable===true&&this.country!=="mexico"){var a={text:translate("cancel",true),href:"#",};if(this.hasCreditNotes){a.cls=Ext.baseCSSPrefix+"menu-item-disabled";a.listeners={click:function(){var e="Solo puedes "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+", que no tengan "+translate("creditNotes")+" "+translate("appliedCreditNotes")+" o cierres sin pago asociados. ";switch(this.country){case"peru":e+="Para "+translate("cancel")+" "+translate("invoices")+" "+translate("stampedInvoices")+", emite una "+translate("creditNote");break}Ext.Msg.show({title:translate("cancel",true),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}else{a.action="voidInvoiceFromMoreActions"}d.push(a)}else{if(this.country=="mexico"){var a={text:translate("cancel",true),href:"#",};if(this.isVoidable===false){a.cls=Ext.baseCSSPrefix+"menu-item-disabled";if(this.documentType!=="saleTicket"){if(this.mxIsWaitingToVoid){a.listeners={click:function(){var e=translate("theInvoice",true)+" "+translate("invoice")+" ya se encuentra en proceso de "+translate("cancelation")+".";Ext.Msg.show({title:translate("cancel",true),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}else{a.listeners={click:function(){var e="Solo puedes "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+" que hayas timbrado en Alegra, sin "+translate("creditNotes")+" y complementos de pago asociados.";Ext.Msg.show({title:translate("cancel",true),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}}else{a.listeners={click:function(){var e=translate("theInvoice",true)+" "+translate("invoice")+" ya fue cancelada y no es necesario cancelarla de nuevo.";Ext.Msg.show({title:translate("cancel",true),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}}else{a.action="voidInvoiceFromMoreActions"}d.push(a)}}if(this.isCloseable){d.push({text:translate("closeWithoutPayment",true),action:"closeInvoice"})}if(this.country=="peru"||this.documentType!=="saleTicket"){d.push({text:translate("apply",true)+" "+translate("advances"),action:"applyAdvances",disabled:!this.canApplyAdvances});var c={text:translate("apply",true)+" "+translate("creditNote"),href:"#"};if(this.status=="open"||this.status=="closed"){if(this.country=="mexico"&&this.hasStamp&&this.mxIsWaitingToVoid){c.cls=Ext.baseCSSPrefix+"menu-item-disabled";c.listeners={click:function(){var e=translate("youCanOnlyApply",true)+" "+translate("creditNotes")+" "+translate("to")+" "+translate("invoices")+" sin solicitudes de cancelación pendientes.";Ext.Msg.show({title:translate("apply",true)+" "+translate("creditNote"),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}else{c.href="/credit-note/add/idInvoice/"+this.idLocal}}else{c.cls=Ext.baseCSSPrefix+"menu-item-disabled";c.listeners={click:function(){var e=translate("youCanOnlyApply",true)+" "+translate("creditNotes")+" "+translate("to")+" "+translate("invoices")+" "+translate("toCollectOrCollected")+".";Ext.Msg.show({title:translate("apply",true)+" "+translate("creditNote"),msg:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}}if(!this.hasCreditNoteStamped&&!this.hasStampTransactionsPending){d.push(c)}if(this.country!="mexico"){d.push("-");d.push({text:translate("printAsCopy",true),id:"printInvoiceCopy",action:"print",type:"copy",href:"/invoice/print/id/"+this.idLocal},{text:translate("downloadAsCopy",true),id:"downloadInvoiceCopy",action:"download",type:"copy"},{text:translate("sendAsCopy",true),id:"emailInvoiceCopy",action:"email",type:"copy"})}d.push("-");d.push({text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile"});if(this.attachPdfFile=="yes"){d.push({text:translate("attachPdf",true),id:"uploadPdfFile",action:"uploadPdfFile"})}}this.menu.items=d;this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.view.invoice.FormAdvancedOptions",{extend:"Ext.form.Panel",alias:"widget.invoice_FormAdvancedOptions",bodyPadding:"20 0 0 0",layout:"vbox",defaultType:"textfield",border:false,items:[{xtype:"container",layout:"hbox",width:1050,items:[{xtype:"container",name:"containerLeft",width:597,items:[{xtype:"textarea",id:"invoiceObservationsTextArea",fieldLabel:'Observaciones<div class="sublabel">(no visible en '+translate("theInvoice")+" "+translate("invoice")+")</div>",labelSeparator:"",name:"observations",allowBlank:true,tooltip:"Información adicional en "+translate("theInvoice")+" "+translate("invoice")+" no visible para el cliente. Este campo es de uso interno en tu empresa",msgTarget:"side",labelAlign:"right",labelPad:15,width:400,hidden:true}]},{xtype:"container",defaults:{msgTarget:"side",labelAlign:"right",width:300,labelPad:15},items:[{xtype:"groupingcombobox",name:"idInvoiceTemplate",fieldLabel:translate("template",true),displayField:"name",displayTpl:'<tpl for=".">{[typeof values === "string" ? values : values["name"] + " (" + translate(values["pageSize"]) + ")"]}<tpl if="xindex < xcount">, </tpl></tpl>',groupField:["pageSize"],valueField:"id",listConfig:{afterTpl:'<div><a style="display: block; padding: 4px 0px 6px 8px;" href="/company/edit-invoice-template">'+translate("configTemplate",true)+"</a></div>",groupFieldPrefix:"Tamaño "},store:"InvoiceTemplates",labelAlign:"right",queryMode:"local",tooltip:"Selecciona la plantilla que deseas utilizar para imprimir  "+translate("theInvoice")+" "+translate("invoice"),allowBlank:false,forceSelection:true,listeners:{afterrender:function(e,d,a,b){var c=e.up("form");var f=c.up("form");if(!f.type||f.type!=="edit"){e.hide();e.setDisabled(true)}else{e.getStore().load()}}}},{xtype:"combo",fieldLabel:translate("seller",true),name:"idSeller",allowBlank:true,queryMode:"local",store:"SellersCombo",valueField:"idLocal",displayField:"name",emptyText:translate("selectSimple",true),matchFieldWidth:false,editable:false,listConfig:{emptyText:'<div style="padding:3px 5px 5px !important; color:#666;">Aún no has registrado vendedores</div><div style="padding: 0px 0px 7px 5px;"><a id="createSeller" href="/seller/add" >Crear vendedor</a></div>',width:200},afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left : 5px; cursor : help;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom "><div class="tooltip-text-wrapper tooltip-small"><div class="text">Descubre cómo crear tus vendedores <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205772559">aquí</a>.</div></div></div></div>'},{xtype:"combo",name:"idPriceList",fieldLabel:translate("priceList",true),displayField:"name",valueField:"idLocal",store:"PriceListCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">'+translate("newList",true)+"</a></div>"},afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left : 5px; margin-top : 10px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -244px;top: -17px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Descubre cómo crear listas de precios <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205799159">aquí</a>.</div></div></div></div>'},{xtype:"textfield",name:"numberPurchaseOrder",fieldLabel:translate("purchaseOrder",true),maxLength:20,countries:["peru"],type:"textfield"},{xtype:"textfield",name:"numberPurchaseOrderCol",fieldLabel:translate("purchaseOrder",true),maxLength:20,countries:["colombia"],type:"textfield",maxLengthText:"El tamaño máximo para este campo es de 20",regex:/^[A-z0-9]+$/,regexText:"Solo se admite un valor alfanumérico",},{xtype:"combo",name:"operationTypeCol",fieldLabel:"Tipo de operación",allowBlank:true,store:"OperationTypes",valueField:"key",displayField:"value",countries:["colombia"],listeners:{afterrender:function(e,d,a,b){var f=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0],c=Ext.get("advancedFieldTooltipoperationTypeColCustomContainer"),g=e.getStore();if(c){c.hide()}g.load({callback:function(h){if(f&&f.type!=="edit"){record=g.findRecord("value","Estándar");if(record){e.setValue(record.data.key)}}recordDel=g.findRecord("value","Genérica");if(recordDel){g.remove(recordDel)}recordDel2=g.findRecord("value","Mandatos bienes");if(recordDel2){g.remove(recordDel2)}}})},change:function(c,b){var a=Ext.get("advancedFieldTooltipoperationTypeColCustomContainer");if(a){if(b==="AIU_SERVICE"){a.show()}else{a.hide()}}}}}]}]}],listeners:{afterrender:function(b,a){var c=b.up("form");if(c.type=="edit"){if(c.configs.country=="colombia"){}}}}});Ext.define("AL.view.invoice.FormAddRemissions",{extend:"Ext.form.Panel",alias:"widget.invoice_FormAddRemissions",bodyPadding:"10 0 25 0",name:"remissionContainer",});Ext.define("AL.view.invoice.BottomContainer",{extend:"Ext.panel.Panel",alias:"widget.invoice_BottomContainer",xtype:"bottomcontainer",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",margin:"0 12 0 36",flex:65,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textarea",flex:1,fieldLabel:translate("termAndCondition",true),name:"termsConditions",allowBlank:true,msgTarget:"side",labelAlign:"top",labelStyle:"margin-bottom: 11px;",fieldStyle:"max-height: 80px !important; padding: 8px !important;",emptyText:translate("visibleInDocumentPrinting",true),msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper" style="left: 160px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -54px; top: 5px;"><div class="tooltip-text-wrapper"><div class="text">'+translate("defineTheConditionsThatYouWillInformYourClients",true)+' <a target="_blank" href="/company/edit-invoice-info">'+translate("clickHere")+"</a>.</div></div></div></div>"}]},{xtype:"container",margin:"0 54 0 12",flex:35,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textarea",flex:1,fieldLabel:translate("notes",true),name:"anotation",allowBlank:true,labelAlign:"top",labelStyle:"margin-bottom: 11px;",fieldStyle:"max-height: 80px !important; padding: 8px !important;",emptyText:translate("visibleInDocumentPrinting",true),msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper" style="left: 45px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -54px; top: 5px;"><div class="tooltip-text-wrapper"><div class="text">'+translate("addImportantInformationThatClientsWillSeeIn",true)+translate("theInvoices")+" "+translate("invoices")+". "+translate("toDefineADefaultText",true)+' <a target="_blank" href="/company/edit-invoice-info">'+translate("clickHere")+"</a>.</div></div></div></div>"}]}]},{xtype:"container",style:"text-align: center; margin-top: 23px;",items:[{xtype:"box",name:"resolutionText",cls:"bottom-container-resolution-text",html:""},],},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",margin:"12 54 0 36",flex:65,layout:{type:"hbox",align:"stretch"},items:[{xtype:"textarea",flex:1,fieldLabel:translate("resolutionText",true),name:"resolutionPie",allowBlank:true,msgTarget:"side",labelAlign:"top",labelStyle:"margin-bottom: 11px;",fieldStyle:"padding: 8px !important;",emptyText:"Visible en la impresión del documento",}]}]},{xtype:"container",style:"margin-top: 29px;",items:[{xtype:"box",name:"requiredText",cls:"bottom-container-required-fields-text",html:""}]}]});Ext.define("AL.view.remission.ComboRemissions",{extend:"Ext.form.field.ComboBox",alias:"widget.remission_ComboRemissions",name:"idRemission",fieldLabel:translate("remission",true),displayField:"remissionNumber",valueField:"idLocal",store:"RemissionsCombo",editable:false,labelAlign:"left",queryMode:"local",msgTarget:"side",labelPad:15,labelWidth:75,padding:"5 0 0 0",allowBlank:true,emptyText:"Seleccionar",labelStyle:"color:#005E67; font-weight: bold; font-size: 15px;",matchFieldWidth:false,listConfig:{emptyText:'<div class="noRemissionsCombo">No existen '+translate("remissions")+" asociadas al cliente seleccionado</div>",width:200}});Ext.define("AL.view.remission.RemissionForInvoice",{extend:"Ext.container.Container",border:true,alias:"widget.remission_RemissionForInvoice",style:"background: #F9F9FD; border-left: 1px solid #eee; border-right: 1px solid #eee; position : relative;",padding:"10px 5px 5px 10px",margin:"0 0 20 0",items:[{xtype:"remission_ComboRemissions"},{xtype:"button",action:"deleteRemission",width:16,height:16,style:"position: absolute; top : 19px; right: 15px; cursor: pointer; color: #B1B1B1; background-image: url(https://cdn1.getsoft.app/images/sm-delete.png);",baseCls:"deleteIcon"}]});Ext.define("AL.store.ItemsSold",{extend:"Ext.data.Store",model:"AL.model.ItemSold",proxy:{type:"ajax",url:"/item/index/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ItemsCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.Item",autoLoad:false,clearOnPageLoad:true,pageSize:10,proxy:{type:"cacheajax",url:"/item/retrieve-all-active/format/json",cacheName:"ItemsCombo",forceRequest:false,reader:{type:"json",root:"results",}},sorters:[{property:"name",direction:"ASC"}]});Ext.define("AL.store.InvoicePayments",{extend:"Ext.data.Store",model:"AL.model.InvoicePayment",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/invoice/retrieve-payments/format/json",reader:{type:"json",root:"results",messageProperty:"cause"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.AutoRetentions",{extend:"Ext.data.Store",model:"AL.model.AutoRetention",autoLoad:false,proxy:{type:"ajax",url:"/auto-retention/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.InvoiceVersions",{extend:"Ext.data.Store",model:"AL.model.InvoiceVersion",autoLoad:false,proxy:{type:"ajax",url:"",reader:{type:"json",root:"results"}}});Ext.define("AL.store.RemissionsCombo",{extend:"Ext.data.Store",model:"AL.model.Remission",proxy:{type:"ajax",url:"/remission/retrieve-all-open/format/json",reader:{type:"json",root:"results"}},sorters:[{property:"name",direction:"ASC"}]});Ext.define("AL.store.OptionsForCloseInvoice",{extend:"Ext.data.Store",fields:["idLocal","text","default","keyword"],autoLoad:false,remoteSort:false,remoteFilter:false,queryMode:"local",proxy:{type:"ajax",url:"/category/retrieve-all-to-close-invoice/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.GlobalInvoices",{extend:"Ext.data.Store",model:"AL.model.GlobalInvoice",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/global-invoice/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a "+translate("openInvoice",true)+"], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.PaymentTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/paymentTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.InvoiceTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/invoiceTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.SaleTicketTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/saleTicketTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.DeliveryTerms",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/deliveryTerms/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.InventoryAdjustment",{extend:"Ext.data.Model",fields:["idLocal",{name:"date",type:"date",dateFormat:"c"},{name:"warehouseName",type:"string",mapping:"warehouse.name"},{name:"totalCost",type:"float"},"observations","editable","deletable"]});Ext.define("AL.view.inventoryadjustment.BottomContainer",{extend:"Ext.panel.Panel",alias:"widget.inventoryadjustment_BottomContainer",layout:"anchor",defaults:{anchor:"100%",labelWidth:150,width:"100%",labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[],buttons:[{text:translate("cancelAction",true),action:"cancel",width:150,height:38},{text:translate("save",true),action:"save",width:150,height:38,cls:["x-btn","sm-button-primary","x-unselectable","x-box-item","x-btn-default-small","x-noicon","x-btn-noicon","x-btn-default-small-noicon"]}]});Ext.define("AL.view.inventoryadjustment.FormInventoryAdjustment",{extend:"Ext.form.Panel",alias:"widget.inventoryadjustment_FormInventoryAdjustment",title:"Ajuste al inventario",layout:"anchor",defaults:{anchor:"100%",labelWidth:250,width:"100%",labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[{xtype:"form",layout:"column",border:false,items:[{columnWidth:0.3,name:"leftContainer",layout:"form",border:true,defaults:{xtype:"textfield",labelAlign:"top",labelPad:15,width:194,msgTarget:"side",labelWidth:140},items:[{xtype:"hidden",name:"idLocal"},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,matchFieldWidth:true,cls:"inventory-adjustment-warehouse-field",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:false,value:new Date(),forceSelection:true,format:"d/m/Y",cls:"inventory-adjustment-warehouse-field",tooltip:translate("dateOnWhichTheDocumentWasMade",true,{document:translate("inventoryAdjustment")}),afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="left: 200px; top:26px;margin-left: 0px; z-index: 100;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -150px;top: -48px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 150px;padding:3px;line-height: 14px;"><div class="text">'+translate("dateOnWhichTheDocumentWasMade",true,{document:translate("inventoryAdjustment")})+"</div></div></div></div>",}]},{columnWidth:0.7,name:"rightContainer",border:false,defaults:{xtype:"textfield",labelAlign:"top",labelPad:15,msgTarget:"side",labelWidth:140,cls:["inventory-adj-top-right-container"]},items:[{xtype:"textarea",fieldLabel:translate("observations",true),name:"observations",allowBlank:true,msgTarget:"side",}]}]},{xtype:"container",name:"div-division",cls:["inventory-form-div"],html:'<div class="inventory-icon"><svg fill="rgba(0, 195, 173, 1)" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#stock"></use></svg></div> <div class="inventory-text">'+translate("salesItems",true)+"</div>"},],});Ext.define("AL.view.inventoryadjustment.InventoryFormAddItem",{extend:"Ext.form.Panel",alias:"widget.inventoryadjustment_InventoryFormAddItem",bodyPadding:"5 5 5 5",border:false,style:"border-bottom: 1px solid #eee; padding-top: 0px;",layout:"hbox",defaults:{anchor:"100%",msgTarget:"side",},getComboDependentFields:function(){var a=[];a.push(this.down("textfield[name=cost]"));a.push(this.down("displayfield[name=availableQuantity]"));a.push(this.down("numberfield[name=quantity]"));a.push(this.down("displayfield[name=finalQuantity]"));a.push(this.down("textfield[name=cost]"));a.push(this.down("displayfield[name=totalCost]"));a.push(this.down("combo[name=type]"));return a},enableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.enable()})},disableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.disable()})},listeners:{beforerender:function(a){var b=this.down("combo[name=idItem]");b.on("change",function(e,c,d){if(e.getSelectedRecord()){e.up("form").enableFields()}else{e.up("form").disableFields()}})},render:function(){}},defaultType:"textfield",items:[{xtype:"container",itemId:"imageContent",cls:["inventory-image-bg"],name:"thumbnail",width:44,height:44,html:'<svg fill="rgba(197, 208, 222, 1)" xmlns="http://www.w3.org/2000/svg" width="44" height="44"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#priceTag"></use></svg>',},{xtype:"fieldcontainer",layout:"anchor",defaultType:"textfield",items:[{xtype:"combo",name:"idItem",allowBlank:false,emptyText:translate("searchAction",true)+" "+translate("inventoryItem",true)+"...",displayField:"name",valueField:"idLocal",width:186,matchFieldWidth:false,triggerCls:"x-form-search-trigger",queryMode:"remote",triggerAction:"query",pageSize:10,typeAhead:true,minChars:0,forceSelection:true,cls:["inventory-field-item","inventory-input-common"],listConfig:{width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list",tpl:'<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl>'}},]},{xtype:"displayfield",allowBlank:true,cls:["itemInput","inventory-input-common"],name:"availableQuantity",value:"0",width:109,style:"text-align: center",fieldBodyCls:"totalAligned"},{xtype:"combo",name:"type",allowBlank:false,emptyText:translate("typeOfAdjustment",true),displayField:"label",valueField:"value",width:104,cls:["inventory-field-type","inventory-input-common"],forceSelection:true,matchFieldWidth:true,queryMode:"local",editable:false,value:"in",store:{fields:["label","value"],data:[{label:translate("increase",true),value:"in"},{label:translate("decrease",true),value:"out"},]}},{xtype:"numberfield",name:"quantity",allowBlank:false,decimalPrecision:2,minValue:0,width:57,value:0,cls:["inventory-input-common","inventory-input-qty"]},{xtype:"displayfield",name:"finalQuantity",value:"0",style:"text-align: center",cls:["inventory-field-type","inventory-input-common"],width:105},{name:"cost",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),width:73,cls:["inventory-input-common"]},{xtype:"displayfield",name:"totalCost",width:94,value:"$0.00",style:"text-align: right",cls:["inventory-field-type","inventory-input-common"],},{xtype:"button",action:"deleteItem",width:16,height:19,baseCls:"none",cls:["inventory-input-common","inventory-btn-delete"]},{xtype:"hidden",name:"totalCostNumber",value:"0"}]});Ext.define("AL.store.InventoryAdjustments",{extend:"Ext.data.Store",model:"AL.model.InventoryAdjustment",autoLoad:false,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/inventory-adjustment/retrieve-all/format/json",timeout:180000,reader:{type:"json",root:"results"}}});Ext.define("AL.view.item.FormAddPriceList",{extend:"Ext.Panel",alias:"widget.item_FormAddPriceList",layout:"hbox",border:false,width:280,items:[{xtype:"combo",width:128,name:"priceListCombo",store:"PriceListCombo",valueField:"idLocal",displayField:"name",labelAlign:"top",labelStyle:"margin-bottom:2px",editable:false,allowBlank:false,emptyText:translate("selectSimple",true),queryMode:"local",margin:"5 0 0 0",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">'+translate("newList",true)+"</a></div>"},},{xtype:"textfield",name:"priceListText",width:94,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),margin:"5 0 0 5",tooltip:translate("indicateThePriceOfYourItemInThisList",true)+" "+translate("theDiscount")+" "+translate("discount")+" "+translate("indicatedInYourList"),allowBlank:false,blankText:translate("youMustIndicateAPriceForThisList",true)},{xtype:"button",action:"deletePriceList",width:16,height:16,margin:"8 0 0 35",baseCls:"none",listeners:{click:function(b){var a=b.up("panel");a.removeAll();a.destroy()}}}]});Ext.define("AL.view.item.MoreActionsButton",{extend:"Ext.button.Split",alias:"item_MoreActionsButton",text:translate("moreActions",true),cls:"button2 sm-button-basic filling",style:"margin: 0 0.5em; padding: 0 8px 0 1em;",height:38,handler:function(){this.showMenu()},initComponent:function(){this.menu.items=[{text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile"}];if(this.hasImage=="no"){this.menu.items.push({text:"Adjuntar imagen del "+translate("item"),id:"uploadItemImageFile",action:"uploadItemImageFile"})}this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.view.item.FormAddWarehouse",{extend:"Ext.form.Panel",alias:"widget.item_FormAddWarehouse",layout:"hbox",border:false,width:800,margin:"10 0 0 20",defaults:{labelAlign:"top",labelWidth:110,labelPad:10,labelStyle:"margin: 0px 0px 4px 0px !important;",},items:[{xtype:"combo",name:"warehouseCombo",store:"WarehouseCombo",valueField:"idLocal",displayField:"name",editable:false,allowBlank:false,emptyText:translate("selectSimple",true),width:126,queryMode:"local",padding:"0px 12px 0px 0px",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'},},{xtype:"textfield",name:"initialQuantity",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",padding:"0px 10px 0px 0px",width:124},{xtype:"textfield",name:"minQuantity",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",padding:"0px 10px 0px 0px",width:124},{xtype:"textfield",name:"maxQuantity",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",padding:"0px 10px 0px 0px",width:124},{xtype:"button",action:"deleteWarehouse",width:16,height:16,margin:"4 0 0 10",baseCls:"none"}]});Ext.define("AL.view.item.ItemKitPanel",{extend:"Ext.panel.Panel",alias:"widget.item_ItemKitPanel",cls:"item-kit-panel",border:false,padding:"15 25",style:"background-color: #fff; box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.1);border-radius: 5px;",defaults:{labelAlign:"top",},items:[{xtype:"box",cls:"title",html:'<svg fill="#00C3AD" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#stock"></use></svg><span>'+translate("itemsIncluded",true)+"</span>",margin:"0 0 10 0"},{xtype:"box",html:'<div id="headersTable" class="item-kit"><table><tr><td class="tbName">'+translate("item",true)+'</td><td class="tbReference">'+translate("reference",true)+'</td><td class="tbObservations">'+translate("description",true)+'</td><td class="tbQuantity">'+translate("quantity",true)+'</td><td class="tbUnit">'+translate("unit",true)+'</td><td class="tbTotal">'+translate("cost",true)+"</td></tr></table></div>",height:48,style:"background:#F9FAFD;color:#00535E;padding-top:10px;font-weight:bold;border-bottom: 2px solid rgba(0, 83, 94, 0.5);"},{xtype:"container",name:"itemKitFormContainer",},{xtype:"container",name:"itemKitFooter",layout:"hbox",margin:"20 0 0 0",width:960,items:[{xtype:"box",html:'<a id="addOtherItemKit" class="button outline"><svg class="icon small green"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("add",true)+" "+translate("item")+"</a>"},{xtype:"box",name:"costDisplay",cls:"is-pulled-right totalCost",html:'<div class="totalCostLabel" style="text-transform: uppercase;">'+translate("totalCost",true)+" "+Ext.util.Format.usMoney(0)+"</div>"}]}]});Ext.define("AL.view.item.FormItemsKitAddItem",{extend:"Ext.form.Panel",alias:"widget.item_FormItemsKitAddItem",border:false,defaults:{labelAlign:"top"},cls:"itemKitForm",bodyPadding:"9 5 0 5",style:"border-bottom: 1px solid #eee; padding-top: 0px;",layout:"hbox",defaults:{anchor:"100%",msgTarget:"side",margin:"9 0 0 20"},getComboDependentFields:function(){var a=[];a.push(this.down("textfield[name=reference]"));a.push(this.down("textarea[name=description]"));a.push(this.down("numberfield[name=quantity]"));return a},enableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.enable()})},disableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.disable()})},disableDeleteButton:function(){if(this.disabledDeleteButton==true){this.down("button[action=deleteItem]").hide()}},listeners:{beforerender:function(a){a.disableDeleteButton();var b=this.down("combo[name=idLocal]");b.on("change",function(e,c,d){if(!e.getSelectedRecord()){e.up("form").disableFields()}})},},defaultType:"textfield",items:[{xtype:"box",name:"itemKitImageBox",margin:"0 0 0 0",width:38,html:'<div class="form-item-kit-image-zone"><svg fill="#CDD6E2" xmlns="http://www.w3.org/2000/svg" width="25" height="25"  ><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#product"></use></svg></div>'},{xtype:"fieldcontainer",layout:"anchor",defaultType:"textfield",margin:"9 0 0 20",items:[{xtype:"combo",name:"idLocal",allowBlank:false,emptyText:translate("searchBillableItem",true),displayField:"name",border:false,valueField:"idLocal",width:230,matchFieldWidth:false,triggerCls:"x-form-search-trigger",queryMode:"remote",typeAhead:true,minChars:0,forceSelection:true,listConfig:{width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list",tpl:'<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl>'}}]},{name:"reference",allowBlank:true,emptyText:translate("reference",true),width:90,cls:"itemInput"},{xtype:"textarea",name:"description",allowBlank:true,emptyText:translate("description",true),margin:"6 0 0 20",cls:"itemInput",width:160},{xtype:"numberfield",name:"quantity",allowBlank:false,emptyText:translate("quantity",true),cls:"itemInput",minValue:0,width:50,msgTarget:"side"},{xtype:"displayfield",allowBlank:true,cls:"itemInput",name:"unit",value:"",width:105,style:"text-align: center",},{xtype:"displayfield",allowBlank:true,cls:"itemInput",name:"cost",value:Ext.util.Format.usMoney(0),width:75,style:"text-align: left",fieldBodyCls:"totalAligned",listeners:{change:function(b){var a=this.up().down("combo[name=idLocal]");if(a&&this.value==="N/A"){b.setValue('<div id="tooltip-itemCombo" style="cursor:">N/A <svg style="color:orange;" class="icon info-outline"><use xlink:href="/images/smile-icons.svg#info-outline"></use></svg></div>');Ext.create("Ext.tip.ToolTip",{target:b.getEl(),width:180,html:"Este ítem no es inventariable, su costo no está definido. <b>Precio de venta: "+Ext.util.Format.usMoney(a.getSelectedRecord().get("price"))+"</b>"})}}}},{xtype:"button",action:"deleteItem",width:16,height:16,style:"margin-left: 40px",baseCls:"none"}]});Ext.define("AL.view.item.FormImage",{alias:"widget.item_FormImage",extend:"Ext.form.Panel",width:250,items:[{name:"imageBox",configs:{maxWidth:240,maxHeight:218},html:'<div class="form-add-common-image-zone form-add-item-image-zone" onselectstart="return false;"><svg fill="rgba(205, 214, 226, 0.5)" xmlns="http://www.w3.org/2000/svg" width="140" height="140"  ><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#product"></use></svg><div padding-top: 23px;">'+translate("itemImage",true)+"</div></div>"}],listeners:{beforerender:function(){if(this.url){var a=this.down("[name=imageBox]");a.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;" onselectstart="return false;"><img src="'+this.url+'" style="margin: 0 auto; max-height: 220px; max-width: 240px" /></div></div>')}}}});Ext.define("AL.store.Remissions",{extend:"Ext.data.Store",model:"AL.model.Remission",autoLoad:false,pageSize:20,remoteSort:true,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/remission/retrieve-all/format/json",timeout:240000,reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.ReferenceTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/referenceTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.CategoriesComboForItem",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",pageSize:80,autoLoad:false,proxy:{type:"cacheajax",url:"/category/retrieve-for-combo/format/json/type/income/item/true/includeFixedAsset/false/includeItems/false",cacheName:"CategoriesComboForItem",timeout:480000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.TaxTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/taxTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.UsedGoodsTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/usedGoodsTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.ItemCategory",{extend:"Ext.data.Model",fields:["idLocal",{name:"name",type:"string"},{name:"description",type:"string"},"status","editable","deletable",]});Ext.define("AL.view.itemCategory.FormAdd",{extend:"Ext.form.Panel",alias:"widget.itemCategory_FormAdd",bodyCls:"container-visible",cls:"container-visible",isEmergent:false,title:"",width:640,items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{xtype:"container",name:"topContainer",layout:"hbox",items:[{xtype:"container",name:"leftContainer",width:320,padding:"10 30",minHeight:320,border:"0 1 0 0",style:{borderColor:"#EAEAEA",borderStyle:"solid"},defaults:{labelAlign:"top",labelStyle:"margin: 0px 0px 4px 0px !important;",width:260,msgTarget:"side",margin:"15px 0px 0px 0px"},items:[{xtype:"textfield",fieldLabel:translate("itemCategoryName",true),name:"name",allowBlank:false,listeners:{change:function(c){var b=c.up("form");var a=b.down("box [name=itemCategoryLabel]");a.update(c.getValue())}}},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",allowBlank:true,margin:"15px 0px 0px 0px",rows:7,height:150},{xtype:"hidden",name:"idImageFile",},]},{xtype:"container",width:320,name:"rightContainer",style:"margin-left: 40px",padding:"20 10 0 0",defaults:{labelAlign:"top",labelWidth:125,labelPad:15,msgTarget:"side",width:360,},items:[{xtype:"box",name:"itemCategoryImageBox",margin:"0 0 15 0",configs:{maxWidth:238,maxHeight:218},html:'<div class="form-add-common-image-zone form-add-item-image-zone" onselectstart="return false;"><svg fill="rgba(205, 214, 226, 0.5)" xmlns="http://www.w3.org/2000/svg" width="140" height="140"  ><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#product"></use></svg><div padding-top: 23px;">'+translate("categoryItemImage",true)+"</div></div>"},{xtype:"box",width:230,name:"itemCategoryLabel",cls:"x-form-item-label",style:"text-align: center",}]}]},],buttons:[{xtype:"buttons_modern_CancelSave",width:600,requiredTextMargin:"0 0 0 0"}]});Ext.define("AL.view.itemCategory.FormImage",{alias:"widget.itemCategory_FormImage",extend:"Ext.form.Panel",width:250,items:[{name:"imageBox",configs:{maxWidth:240,maxHeight:218},html:'<div class="form-add-common-image-zone form-add-item-image-zone" onselectstart="return false;"><svg fill="rgba(205, 214, 226, 0.5)" xmlns="http://www.w3.org/2000/svg" width="140" height="140"  ><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#product"></use></svg><div padding-top: 23px;">'+translate("categoryItemImage")+"</div></div>"}],listeners:{beforerender:function(){if(this.url){var a=this.down("[name=imageBox]");a.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;" onselectstart="return false;"><img src="'+this.url+'" style="margin: 0 auto; max-height: 220px; max-width: 240px" /></div></div>')}}}});Ext.define("AL.view.itemCategory.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.itemCategory_MoreActionsButton",text:"Más acciones",cls:"button2 sm-button-basic filling",style:"margin: 0 0.5em; padding: 0 8px 0 1em;",height:38,handler:function(){this.showMenu()},initComponent:function(){this.menu.items=[{text:this.categorySetting.isActive,id:"toggleStatusItemCategory",action:"toggleStatusItemCategory"},{text:translate("delete",true),id:"deleteItemCategory",action:"deleteItemCategory"}];this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.view.livedemo.ChartBarsParent",{extend:"Ext.chart.Chart",animate:true,insetPadding:20,store:Ext.create("Ext.data.Store",{fields:[{name:"value",type:"float"},{name:"monthName",type:"string"}]}),cls:"chart",axes:[{type:"Numeric",position:"left",adjustMaximumByMajorUnit:true,adjustMinimumByMajorUnit:true,fields:["value"],decimals:0,label:{renderer:function(a){return"$"+Ext.util.Format.number(a,"00.0")}},title:"Total",grid:true,minimum:0},{type:"Category",position:"bottom",fields:["monthName"],title:"Mes"}],series:[{type:"column",axis:"left",shadow:false,highlight:true,xField:"monthName",yField:"value",tips:{trackMouse:true,width:130,height:28,renderer:function(b,a){this.setTitle("Total: $"+Ext.util.Format.number(b.get("value"),"0,000")+" mil")}}}]});Ext.define("AL.view.livedemo.ChartAccountsByType",{alias:"widget.livedemo_ChartAccountsByType",extend:"Ext.chart.Chart",animate:true,shadow:false,insetPadding:40,store:Ext.create("Ext.data.Store",{fields:["type","total"],proxy:{type:"ajax",url:"/labs/retrieve-number-of-accounts-by-account-type/format/json",reader:{type:"json",root:"results"}}}),series:[{type:"pie",colorSet:["#0ab396","#a2bd51","#3c948b"],angleField:"total",showInLegend:true,label:{field:"type",display:"outside",renderer:function(a){var b="";switch(a){case"bank":b="Banco";break;case"cash":b="Efectivo";break;case"credit-card":b="Tarjeta de crédito";break}return b}},highlight:true},],listeners:{afterrender:function(b){var a=b.getStore();a.load()}}});Ext.define("AL.view.livedemo.ChartInvoicingPerMonth",{extend:"AL.view.livedemo.ChartBarsParent",alias:"widget.livedemo_ChartInvoicingPerMonth",});Ext.define("AL.view.livedemo.ChartOpenBillsPerMonth",{extend:"AL.view.livedemo.ChartBarsParent",alias:"widget.livedemo_ChartOpenBillsPerMonth",animate:true,insetPadding:20,store:Ext.create("Ext.data.Store",{fields:[{name:"value",type:"float"},{name:"monthName",type:"string"}]}),axes:[{type:"Numeric",position:"left",fields:["value"],adjustMaximumByMajorUnit:true,adjustMinimumByMajorUnit:true,decimals:0,label:{renderer:function(a){return"$"+Ext.util.Format.number(a,"00.0")}},title:"Total",grid:true,minimum:0},{type:"Category",position:"bottom",fields:["monthName"],title:"Mes",tips:{trackMouse:true,width:130,height:28,renderer:function(b,a){this.setTitle("Total $"+Ext.util.Format.number(b.get("value"),"0,000")+" mil")}}}]});Ext.define("AL.view.livedemo.ChartOpenInvoicesPerMonth",{extend:"AL.view.livedemo.ChartBarsParent",alias:"widget.livedemo_ChartOpenInvoicesPerMonth"});Ext.define("AL.view.livedemo.PieChartSectorByCompany",{alias:"widget.livedemo_PieChartSectorByCompany",extend:"Ext.chart.Chart",animate:true,shadow:false,insetPadding:40,store:Ext.create("Ext.data.Store",{fields:["sector","total"],proxy:{type:"ajax",url:"/labs/retrieve-sector-by-total-companies/format/json",reader:{type:"json",root:"results"}}}),series:[{type:"pie",colorSet:["#0ab396","#326584","#3f80a8","#2ab9bb","#d8d2bc","#90e0e1","#8ad1cb","#3a8981","#61bdac","#d5c4b0"],angleField:"total",showInLegend:true,label:{field:"sector",display:"outside"},highlight:true},],listeners:{afterrender:function(b){var a=b.getStore();a.load()}}});Ext.define("AL.view.livedemo.DatesFilterButtons",{extend:"Ext.form.Panel",alias:"widget.livedemo_DatesFilterButtons",layout:{type:"hbox",pack:"center",align:"middle"},frame:false,border:false,cls:"header",defaults:{margin:"10 10 0 0",enableToggle:true},padding:20,items:[{xtype:"button",text:"Últimos tres meses",name:"last3Months",cls:"live-demo-button",pressedCls:"live-demo-button-pressed",pressed:true,style:"background-color: #10b396; border: 1px solid #10b396; color:#fff;background-image:none; padding:7px 5px"},{xtype:"button",text:"Últimos 6 meses",cls:"live-demo-button",name:"lastSixMonths",pressedCls:"live-demo-button-pressed",style:"background-color: #10b396; border: 1px solid #10b396; color:#fff;background-image:none; padding:7px 5px"},{xtype:"button",text:"Último año",cls:"live-demo-button",name:"lastYear",pressedCls:"live-demo-button-pressed",style:"background-color: #10b396; border: 1px solid #10b396; color:#fff;background-image:none; padding:7px 5px"}]});Ext.define("AL.view.livedemo.AllChartsPanel",{alias:"widget.livedemo_AllChartsPanel",extend:"Ext.container.Container",layout:{type:"vbox",align:"stretch"},items:[{margin:"10 4 0 5",border:false,items:[{xtype:"livedemo_DatesFilterButtons"}]},{xtype:"container",border:false,layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",margin:"15 25 25 5",border:true,cls:"live-demo-panel",title:"Promedio facturación",flex:1,layout:"fit",items:[{xtype:"livedemo_ChartInvoicingPerMonth",cls:"chart averageInvoicing",listeners:{afterrender:function(b){var a=b.up("livedemo_AllChartsPanel");b.store=Ext.create("Ext.data.Store",{fields:[{name:"value",type:"float"},{name:"monthName",type:"string"}],data:Ext.decode(a.averageInvoices3)});b.getStore().load()}}}]},{xtype:"panel",border:true,cls:"live-demo-panel",title:"Facturación",flex:0.8,margin:"15 5 25 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",cls:"livedemo-realtime numberInvoices",name:"numberInvoices",tpl:'<div class="label">Número de facturas creadas</div><div>{value}</div>',flex:1},{xtype:"box",cls:"livedemo-realtime",name:"totalInvoiced",tpl:'<div class="label">Total facturación</div><div>{value}</div>',flex:1}]}]},{xtype:"container",border:false,layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",border:true,title:"Sectores",margin:"0 25 25 5",cls:"live-demo-panel",flex:0.8,layout:"fit",items:[{xtype:"livedemo_PieChartSectorByCompany",cls:"live-demo-pie"},]},{xtype:"panel",border:true,title:"Tipos de cuentas",margin:"0 25 25 5",cls:"live-demo-panel",flex:0.8,layout:"fit",items:[{xtype:"livedemo_ChartAccountsByType",cls:"live-demo-pie",},]},{xtype:"panel",border:true,title:"Promedio cuentas por cobrar",cls:"live-demo-panel",margin:"0 25 25 5",flex:1,layout:"fit",items:[{xtype:"livedemo_ChartOpenInvoicesPerMonth",cls:"chart averageOpenInvoices",listeners:{afterrender:function(b){var a=b.up("livedemo_AllChartsPanel");b.store=Ext.create("Ext.data.Store",{fields:[{name:"value",type:"float"},{name:"monthName",type:"string"}],data:Ext.decode(a.averageOpenInvoices3)});b.getStore().load()}}},]},{xtype:"panel",border:true,frame:false,title:"Promedio cuentas por pagar",margin:"0 25 25 5",cls:"live-demo-panel",flex:1,layout:"fit",items:[{xtype:"livedemo_ChartOpenBillsPerMonth",cls:"chart averageOpenBills",listeners:{afterrender:function(b){var a=b.up("livedemo_AllChartsPanel");b.store=Ext.create("Ext.data.Store",{fields:[{name:"value",type:"float"},{name:"monthName",type:"string"}],data:Ext.decode(a.averageOpenBills3)});b.getStore().load()}}},]}]}]});Ext.define("AL.view.livedemo.ChartOpenBillsAndInvoices",{extend:"Ext.chart.Chart",alias:"widget.livedemo_ChartOpenBillsAndInvoices",store:Ext.create("Ext.data.Store",{fields:["month","valueInvoices","valueBills"],proxy:{type:"ajax",url:"/labs/retrieve-average-open-bills-and-invoices/format/json",reader:{type:"json",root:"results"}}}),axes:[{type:"Numeric",position:"left",fields:["valueInvoices","valueBills"],title:"Total",grid:true,label:{renderer:function(b,a){return Ext.util.Format.usMoney(b,0)}},minimum:0},{type:"Category",position:"bottom",fields:["month"],title:"Mes"}],series:[{type:"line",axis:"left",xField:"month",yField:"valueInvoices",highlight:{size:7,radius:7},markerConfig:{type:"cross",size:4,radius:4,"stroke-width":0}},{type:"line",axis:"left",xField:"month",yField:"valueBills",highlight:{size:7,radius:7},markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}}],listeners:{afterrender:function(c){var b=c.getStore();var a=new Ext.LoadMask(c,{msg:translate("loadingAction",true)});a.show();b.load({callback:function(){a.hide()}})}}});Ext.define("AL.model.Journal",{extend:"Ext.data.Model",fields:["idLocal",{name:"date",type:"date",dateFormat:"c"},"name","reference","observations","amount","numberResource","deletable","isEditable","statusResource","currencySymbol",{name:"status",type:"string",isEnum:true,values:{open:translate("openJournal",true),"void":translate("voidJournal",true)}},{name:"resourceType",type:"string"},{name:"resourceTypeOfResource",type:"string"}]});Ext.define("AL.view.journal.FormAddJournal",{extend:"Ext.form.Panel",alias:"widget.journal_FormAddJournal",title:"",bodyPadding:30,anchor:100,items:[{xtype:"hidden",name:"idLocal"},{xtype:"container",layout:"hbox",items:[{xtype:"container",defaults:{msgTarget:"side",labelAlign:"right",labelPad:15},defaultType:"textfield",items:[{xtype:"datefield",fieldLabel:translate("date",true),name:"date",width:280,allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}"},{fieldLabel:translate("reference",true),name:"reference",width:400},{xtype:"textarea",name:"observations",fieldLabel:translate("observations",true),width:400},]},{xtype:"container",items:[{xtype:"box",html:translate("theJournal",true)+" "+translate("accountingAdjustment")+" "+translate("allowYouToMakeBalanceTransfersBetweenAccounts"),cls:"journal-explanation"}]}]}]});Ext.define("AL.view.journal.InitialBalanceLayout",{extend:"Ext.form.Panel",alias:"widget.journal_InitialBalanceLayout",title:"",bodyPadding:30,anchor:100,cls:["categories-tree"],collapseDirection:"left",layout:{type:"accordion",titleCollapse:true,hideCollapseTool:false,animate:true,activeOnTop:false,multi:true,collapsible:true,},items:[{xtype:"panel",itemId:"resultsContent",cls:["float-card","initial-balance-title"],title:translate("initialBalanceAccordionOne",true),collapsed:false,items:[]},{xtype:"panel",itemId:"balanceContent",cls:["float-card","initial-balance-title"],title:translate("initialBalanceAccordionTwo",true),items:[{xtype:"container",itemId:"initialBalanceContainer",height:60,cls:"initial-balance-totals-bg",layout:{type:"hbox"},items:[{itemId:"totalBalanceLeft",margins:"0 9 5 0",xtype:"displayfield",flex:1,cls:"initial-balance-totals",labelWidth:325,value:"$0.00",fieldLabel:translate("total",true)+" "+translate("asset"),},{itemId:"totalBalanceRight",margins:"0 0 5 9",xtype:"displayfield",flex:1,cls:"initial-balance-totals",labelWidth:293,value:"$0.00",fieldLabel:translate("total",true)+" "+translate("liability")+" + "+translate("equity"),},],}]},]});Ext.define("AL.view.journal.InitialBalanceTopFields",{extend:"Ext.form.Panel",alias:"widget.journal_InitialBalanceTopFields",title:"",bodyPadding:0,anchor:100,cls:["initial-balance-top-fields-container"],items:[{xtype:"hidden",name:"idLocal"},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",labelWidth:50,blankText:"Es necesario definir la fecha",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",}]});Ext.define("AL.store.ClientsCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.Client",autoLoad:false,pageSize:20,proxy:{type:"cacheajax",url:"/client/retrieve-all/format/json",cacheName:"ClientsCombo",reader:{type:"json",root:"results"}},});Ext.define("AL.model.InvoiceMail",{extend:"Ext.data.Model",fields:["id","idCompany","recipient","sender",{name:"sentTime",type:"auto",filterField:"datetime"},"programmedTime",{name:"state",isEnum:true,values:{sent:"Enviado",error:"Error",pending:"Pendiente",bounced:"Error (Rebote)"}},"bounceReason","errorReason","mail","invoiceNumber","description"]});Ext.define("AL.model.UnsubscribableMail",{extend:"Ext.data.Model",fields:[{name:"mail",type:"string"},{name:"name",type:"string"},{name:"unsubscribed",type:"string"}]});Ext.define("AL.view.mailer.FormEditSubscriptions",{extend:"Ext.form.Panel",alias:"widget.mailer_FormEditSubscriptions",unsubscribableEmails:[],bodyPadding:30,width:850,layout:"anchor",defaults:{anchor:"70%",labelWidth:215,labelAlign:"left",width:400,labelPad:80,msgTarget:"side",allowBlank:false,defaultType:"radiofield"},defaultType:"fieldcontainer",items:[{defaults:{xtype:"box",style:"font-weight: bold; font-size: 1.1em;",width:900},layout:"hbox",items:[{html:"Correo",width:440},{html:"¿Deseas recibirlo?",}]}]});Ext.define("AL.store.InvoiceMails",{extend:"Ext.data.Store",model:"AL.model.InvoiceMail",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/mailer/retrieve-invoice-history/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.UnsubscribableMails",{extend:"Ext.data.Store",model:"AL.model.UnsubscribableMail",});Ext.define("AL.model.MembershipTransaction",{extend:"Ext.data.Model",fields:["id","dateTime","reference","authorization","p2pErrorMsg","totalAmount","status"]});Ext.define("AL.view.membership.GridMembershipTransactions",{extend:"Ext.grid.Panel",alias:"widget.membership_GridMembershipTransactions",scroll:true,layout:"fit",frame:true,minHeight:390,width:1024,store:"MembershipTransactions",cls:"grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no tienes transacciones!</div></div></div>'},listeners:{afterrender:function(b){var a=b.getStore();a.load()}},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"dateTime",renderer:this.renderDate,flex:1},{header:"Referencia",dataIndex:"reference",flex:1},{header:"Autorización",dataIndex:"authorization",flex:1},{header:"Estado",dataIndex:"p2pErrorMsg",flex:3},{header:"Valor",dataIndex:"totalAmount",renderer:"usMoney",flex:1}];this.callParent(arguments)},linkTransaction:function(e,f,b,g,d,c,a){return'<a href="/membership/view-membership-transaction/id/'+b.get("id")+'">'+e+"</a>"},renderDate:function(f,j,c,d,h,g,e){f=f.replace(/-/g,"/");var b=new Date(f);var a=Ext.Date.format(b,"d/m/Y H:i");return a}});Ext.define("AL.view.membership.FormDebitCardChooser",{extend:"Ext.form.Panel",alias:"widget.membership_FormDebitCardChooser",paymentMethods:[],idPlan:null,months:null,bodyPadding:30,width:450,layout:"anchor",defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",width:200,labelPad:15,msgTarget:"side",allowBlank:false,originalValue:""},defaultType:"textfield",items:[{xtype:"fieldcontainer",defaultType:"radiofield",renderTo:"payment-methods",padding:"5 15",width:"100%",items:[]},{xtype:"hidden",name:"className",value:"DebitCard"},{name:"payerName",renderTo:"div-name"},{name:"documentNumber",renderTo:"div-id-number"},{xtype:"combo",renderTo:"div-bank",name:"bankEntity",displayField:"bankEntity",valueField:"bankEntity",forceSelection:true,queryMode:"local",store:{fields:["bankEntity"],data:[{bankEntity:"BANCO AV VILLAS"},{bankEntity:"BANCO CAJA SOCIAL BCSC"},{bankEntity:"BANCO COLPATRIA"},{bankEntity:"BANCO CORPBANCA"},{bankEntity:"BANCO DAVIVIENDA"},{bankEntity:"BANCO DE BOGOTA"},{bankEntity:"BANCO DE OCCIDENTE"},{bankEntity:"BANCO GNB SUDAMERIS"},{bankEntity:"BANCO POPULAR"},{bankEntity:"BANCOLOMBIA"},{bankEntity:"CITIBANK"},{bankEntity:"HELM BANK"},{bankEntity:"HSBC"}]}},{xtype:"combo",renderTo:"div-account-type",name:"accountType",displayField:"title",valueField:"accountType",forceSelection:true,queryMode:"local",store:{fields:["title","accountType"],data:[{title:"CUENTA CORRIENTE",accountType:"CURRENT"},{title:"CUENTA DE AHORROS",accountType:"SAVINGS"}]}},{name:"accountNumber",renderTo:"div-account-number"},{xtype:"hidden",name:"idPlan"},{xtype:"hidden",name:"months"}],buttons:[{text:"Pagar",action:"payDebit"}],initComponent:function(){var f=this,g=null,a=function(j,l){if(l){if(j.inputValue===""){f.clearFields()}else{var h;for(var k in f.paymentMethods){if(f.paymentMethods[k].idLocal===j.inputValue){h=f.paymentMethods[k];break}}f.getForm().setValues(h)}}};if(f.paymentMethods&&f.paymentMethods.length>0){for(var c in f.paymentMethods){var b=" (Nro. "+f.paymentMethods[c].accountNumber+")";if(f.paymentMethods[c].name){b=f.paymentMethods[c].name+b}else{b=translate(f.paymentMethods[c].accountType)+b}var e=false,d={change:a};if(f.paymentMethods[c].companysDefault==="yes"){e=true;g=f.paymentMethods[c]}f.items[0].items.push({boxLabel:b,name:"idLocal",inputValue:f.paymentMethods[c].idLocal,checked:e,listeners:d})}f.items[0].items.push({boxLabel:"Otra",name:"idLocal",inputValue:"",listeners:d})}else{f.items[0].hidden=true;f.items[0].items.push({boxLabel:"Otra",name:"idLocal",inputValue:"",checked:true,listeners:{change:a}})}f.callParent(arguments);if(g){f.getForm().setValues(g)}},clearFields:function(){var a=this.down("textfield[name=payerName]"),b=this.down("textfield[name=documentNumber]"),d=this.down("combo[name=bankEntity]"),c=this.down("combo[name=accountType]"),e=this.down("textfield[name=accountNumber]");a.setRawValue("");b.setRawValue("");d.setRawValue("");c.setRawValue("");e.setRawValue("")}});Ext.define("AL.view.membership.FormEditMembership",{extend:"Ext.form.Panel",alias:"widget.membership_FormEditMembership",bodyPadding:30,width:450,layout:"anchor",defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",width:200,labelPad:15,msgTarget:"side",allowBlank:false},items:[{xtype:"container",name:"plaContainer",items:[{xtype:"combo",name:"idPlan",fieldLabel:"Seleccionar plan",store:"PlansCombo",editable:false,allowBlank:false,forceSelect:true,emptyText:"Seleccionar",queryMode:"local",displayField:"name",valueField:"id"}]},{xtype:"container",name:"extraFeaturesContainer",items:[{xtype:"numberfield",name:"extraUsers",fieldLabel:"Usuarios Extra",minValue:0,value:0}]},{xtype:"container",name:"totalContainer",items:[{xtype:"label",name:"planLabel",html:"<div><span>Plan:</span><span>0</span></div>"},{xtype:"label",name:"planLabel",html:"<div><span>Extras:</span><span>0</span></div>"},{xtype:"label",name:"planLabel",html:"<div><span>Total:</span><span>0</span></div>"}]}],buttons:[{text:"Comprar",action:"save",formBind:true}]});Ext.define("AL.store.MembershipTransactions",{extend:"Ext.data.Store",model:"AL.model.MembershipTransaction",autoLoad:false,proxy:{type:"ajax",url:"/membership/retrieve-membership-transactions/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.Payment",{extend:"Ext.data.Model",fields:["idLocal","idCategory","idClient","accountName","date","price","quantity","subTotal","total","observations","name","categoryName","decimalPrecision"],proxy:{type:"ajax",method:"POST",api:{read:"/payment/retrieve-all/format/json",update:"data/updateItems.json",create:"/account/add/format/json",destroy:"/account/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.store.Payments",{extend:"Ext.data.Store",model:"AL.model.Payment",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/payment/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.model.PaymentMethod",{extend:"Ext.data.Model",fields:["id","payerName","documentNumber","bankEntity","accountType","accountNumber","retainer"]});Ext.define("AL.view.membership.FormPayDebit",{extend:"Ext.form.Panel",alias:"widget.membership_FormPayDebit",idPlan:null,months:null,bodyPadding:30,width:450,layout:"anchor",defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",width:200,labelPad:15,msgTarget:"side",allowBlank:false},defaultType:"textfield",items:[{name:"payerName",renderTo:"div-name"},{name:"documentNumber",renderTo:"div-id-number"},{xtype:"combo",renderTo:"div-bank",name:"bankEntity",displayField:"bankEntity",valueField:"bankEntity",forceSelection:true,queryMode:"local",store:{fields:["bankEntity"],data:[{bankEntity:"BANCO AV VILLAS"},{bankEntity:"BANCO CAJA SOCIAL BCSC SA"},{bankEntity:"BANCO COLPATRIA"},{bankEntity:"BANCO CORPBANCA S.A"},{bankEntity:"BANCO DAVIVIENDA SA"},{bankEntity:"BANCO DE BOGOTA"},{bankEntity:"BANCO DE OCCIDENTE"},{bankEntity:"BANCO GNB SUDAMERIS"},{bankEntity:"BANCO POPULAR"},{bankEntity:"BANCOLOMBIA"},{bankEntity:"CITIBANK"},{bankEntity:"HELM BANK S.A"},{bankEntity:"HSBC"}]}},{xtype:"combo",renderTo:"div-account-type",name:"productType",displayField:"productType",valueField:"productType",forceSelection:true,queryMode:"local",store:{fields:["productType"],data:[{productType:"CUENTA CORRIENTE"},{productType:"CUENTA DE AHORROS"}]}},{name:"accountNumber",renderTo:"div-account-number"},{xtype:"hidden",name:"idPlan"},{xtype:"hidden",name:"months"},{xtype:"checkboxfield",name:"retainer",boxLabel:"Deseo aplicar "+translate("retention")+" en la fuente",renderTo:"div-is-retainer",checked:false,width:530,inputValue:"yes"},],buttons:[{text:"Pagar",action:"payDebit"}],listeners:{afterrender:function(b){var c=b.down("hidden[name=idPlan]");var a=b.down("hidden[name=months]");c.setValue(this.idPlan);a.setValue(this.months)}}});Ext.define("AL.view.buttons.Cancel",{extend:"Ext.Component",alias:"widget.buttons_Cancel",style:"margin-top: 12px",html:'<a href="#" class="cancel-link">'+translate("cancelAction",true)+"</a>",listeners:{afterrender:function(b){var c=this.getEl();var a=c.down("a.cancel-link");a.on("click",function(h,f,d){h.preventDefault();if(window.history.length>2){var g=b.up("window");if(g){g.close()}else{window.history.back()}}else{window.location="/"}})}}});Ext.define("AL.view.pricelist.FormAdd",{extend:"Ext.form.Panel",alias:"widget.pricelist_FormAdd",bodyPadding:40,width:650,layout:"anchor",defaults:{labelWidth:80,labelAlign:"right",width:300,labelPad:15,msgTarget:"side"},items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{xtype:"textfield",name:"name",allowBlank:false,fieldLabel:translate("name",true),tooltip:translate("nameThatWillHelpYouIdentifyYourPriceList",true)+".",labelWidth:80,labelAlign:"right",width:300,},{xtype:"radiogroup",name:"dependent",margin:"20 0 0 0",fieldLabel:translate("type",true),width:350,defaultType:"radiofield",items:[{boxLabel:translate("percentage",true)+' <div class="sublabel">'+translate("itIsCalculatedBasedOnThePriceIndicatedInTheGeneralList",true)+"</div> ",name:"dependent",inputValue:"yes",margin:"0 10 0 0",width:130},{boxLabel:translate("value",true)+' <div class="sublabel">'+translate("itIndicatesASpecificPriceForEach",true)+" "+translate("item")+"</div>",name:"dependent",inputValue:"no",width:110}],listeners:{change:function(d,h,c,e){var g=Ext.ComponentQuery.query("textfield[name=percentage]")[0];var b=Ext.ComponentQuery.query("label[name=percentageLabel]")[0];if(h&&h.dependent=="no"){g.hide();b.hide();g.allowBlank=true;g.setValue(null);var a=Ext.ComponentQuery.query("textfield[name=name]")[0];if(a.getValue()&&a.getValue()!=""){var f=d.up("form");f.isValid()}}else{g.allowBlank=false;g.show();b.show()}}}},{xtype:"container",layout:"hbox",defaults:{anchor:"100%",labelWidth:80,labelAlign:"right",width:180,labelPad:15,msgTarget:"side"},items:[{xtype:"textfield",name:"percentage",fieldLabel:translate("percentage",true),allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),hidden:true},{xtype:"label",name:"percentageLabel",text:"%",margin:4,width:100,hidden:true}]}]});Ext.define("AL.view.pricelist.GridAll",{extend:"Ext.grid.Panel",alias:"widget.pricelist_GridAll",title:"",scroll:true,minHeight:390,width:1024,border:true,frame:true,columnLines:true,cls:"grid-with-icons",initComponent:function(){this.store=Ext.create("AL.store.PriceLists",{autoLoad:true});this.columns=[{header:translate("name",true),dataIndex:"name",flex:1},{header:translate("main",true),dataIndex:"main",flex:1,renderer:this.renderDefault},{header:translate("type",true),dataIndex:"dependent",flex:1,renderer:this.renderDependent},{header:translate("actions",true),align:"center",type:"priceListActions",renderer:this.setActions,width:80}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.get("editable")){b+='<a href="/price-list/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("deletable")){b+='<a href="/price-list/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deletePriceList"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}if(c.get("status")==="active"){b+='<a href="#" title="'+translate("deactivate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="togglePriceListStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a href="#" title="'+translate("activate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="togglePriceListStatus" /></a>'}}b+="</div>";return b},renderDefault:function(e,j,b,c,g,f,d){var a=b.get("main");var h=(a=="yes")?translate("yes",true):translate("no",true);return h},renderDependent:function(d,j,a,b,g,e,c){var f=a.get("dependent");var h=(f=="yes")?translate("percentage",true)+" ("+a.get("percentage")+"%)":translate("value",true);return h}});Ext.define("AL.store.PriceLists",{extend:"Ext.data.Store",model:"AL.model.PriceList",autoLoad:false,remoteSort:true,proxy:{type:"ajax",url:"/price-list/retrieve-all/format/json/deletable/yes/editable/yes",reader:{type:"json",root:"results"}}});Ext.define("AL.view.purchaseOrder.FormAddPurchaseOrder",{extend:"Ext.form.Panel",alias:"widget.purchaseOrder_FormAddPurchaseOrder",style:"margin-bottom: 10px;",requires:["AL.view.ux.fields.Numeration"],title:"",bodyPadding:30,anchor:100,layout:"hbox",defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",defaults:{labelAlign:"right",labelPad:15,width:300,labelWidth:110},flex:1,items:[{xtype:"numerationField",name:"numerationComponent",configs:{documentType:"purchaseOrder",labelPad:15,fieldWidth:400,labelWidth:110,parent:"purchaseOrder_FormAddPurchaseOrder"},width:400},{xtype:"combo",fieldLabel:translate("supplier",true),name:"idClient",triggerAction:"all",allowBlank:false,store:"Clients",width:400,emptyText:translate("search",true),displayField:"name",valueField:"idLocal",id:"purchaseOrderClientCombo",minChars:0,labelAlign:"right",msgTarget:"side",labelPad:15,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"textarea",labelAlign:"right",fieldLabel:'Observaciones <div class="sublabel">(No visible en el documento impreso)</div>',name:"observations",id:"purchaseOrderOservationsTextarea",width:400,labelPad:15,allowBlank:true,hidden:true},{xtype:"textarea",fieldLabel:translate("notes",true)+'<div class="sublabel">('+translate("visibleInDocumentPrinting",true)+")</div>",width:400,name:"anotation",allowBlank:true,labelPad:15,tooltip:translate("notes",true)+" "+translate("visibleInDocumentPrinting"),}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,width:300,labelWidth:150},items:[{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDateOf",true)+" "+translate("theM")+" "+translate("purchaseOrder"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",id:"purchaseOrderDateDatefield"},{xtype:"datefield",fieldLabel:translate("deadline",true),name:"deliveryDate",allowBlank:false,value:Ext.Date.add(new Date(),Ext.Date.DAY,30),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheDeadlineOf",true)+" "+translate("purchaseOrder"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}"},{xtype:"textarea",fieldLabel:translate("termsConditions",true),width:400,name:"termsConditions",allowBlank:true,labelPad:15,},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("purchaseOrder"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"displayfield",fieldLabel:translate("tax",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,width:300,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}}]}]});Ext.define("AL.model.RecurringInvoice",{extend:"Ext.data.Model",fields:["idLocal","idClient","name",{name:"startDate",type:"date",dateFormat:"c"},{name:"endDate",type:"date",dateFormat:"c"},{name:"repeatEvery",type:"int"},{name:"term",type:"int"},"observations","termsConditions","total","decimalPrecision","currencySymbol",],proxy:{type:"ajax",method:"POST",api:{read:"/recurring-invoice/retrieve-all/format/json",update:"data/updateItems.json",create:"/recurringInvoice/add/format/json",destroy:"/recurringInvoice/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.model.ItemRecurring",{extend:"Ext.data.Model",fields:["idLocal","reference","name","description","price","idTax"],proxy:{type:"ajax",method:"POST",api:{read:"/itemRecurring/retrieve-all/format/json",update:"data/updateItems.json",create:"/itemRecurring/add/format/json",destroy:"/itemRecurring/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.view.recurringinvoice.FormAddRecurringInvoice",{extend:"Ext.form.Panel",alias:"widget.recurringinvoice_FormAddRecurringInvoice",requires:["AL.view.ux.form.Switch"],bodyPadding:30,style:"margin-bottom: 10px",layout:"hbox",defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldClientName"},{xtype:"hidden",name:"oldIdClient"},{xtype:"container",flex:1.2,name:"containerLeft",defaults:{labelAlign:"right",labelPad:15,msgTarget:"side"},items:[{xtype:"switch",name:"documentTypeSwitch",label:{text:"Tipo de documento"},options:[{id:"invoice",value:"invoice",text:translate("invoice",true),checked:true},{id:"saleTicket",value:"saleTicket",text:translate("saleTicket",true)},],hidden:true},{xtype:"combo",name:"resolutionCombo",fieldLabel:translate("numeration",true),blankText:translate("itIsNecessaryToSelectAF",true)+" "+translate("numeration"),width:270,allowBlank:false,forceSelection:true,displayField:"name",store:"ResolutionsComboRecurring",labelAlign:"right",valueField:"idLocal",hidden:true,queryMode:"local"},{xtype:"combo",fieldLabel:translate("clientA",true),width:400,name:"idClient",triggerAction:"all",allowBlank:false,minChars:0,typeAhead:true,emptyText:translate("search",true),store:"Clients",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},displayField:"name",valueField:"idLocal",blankText:translate("itIsNecessaryToAssignAClient",true)},{xtype:"textarea",width:400,fieldLabel:translate("observations",true),name:"observations",allowBlank:true},{xtype:"textarea",fieldLabel:translate("notes",true)+" "+translate("ofTheInvoice")+" "+translate("invoice"),name:"anotation",allowBlank:true,width:400,tooltip:translate("additionalNotesThatYouWantYourClientToSeeIn",true)+" "+translate("theInvoice")+" "+translate("invoice")},{xtype:"combo",name:"paymentType",fieldLabel:translate("paymentMethod",true),displayField:"label",valueField:"value",labelAlign:"right",allowBlank:true,hidden:true,width:275,forceSelection:false,value:"",labelPad:15,queryMode:"local",store:{fields:["label","value"],data:[{label:"Una sola exhibición",value:"PUE"},{label:"Parcialidades o Diferido",value:"PPD"}]}},{xtype:"combo",name:"paymentMethod",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("paymentMethod",true),hidden:true,store:"PaymentMethods",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["costaRica","mexico"],requires:["mexico"],isRequiredForElectronicInvoicing:["costaRica"]},]},{xtype:"container",flex:0.9,defaults:{msgTarget:"side",labelAlign:"right",width:300,labelPad:15,labelWidth:150},items:[{xtype:"datefield",fieldLabel:translate("startDate",true),tooltip:translate("dateWhenTheFirst",true)+" "+translate("invoice")+(translate("language")=="language"?" will be created":""),name:"startDate",allowBlank:false,format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheStartDate",true)+" "+translate("ofTheInvoice")+" "+translate("recurringInvoice"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",value:function(){var a=new Date();a.setDate(a.getDate()+1);return a}(),minValue:function(){var a=new Date();a.setDate(a.getDate()+1);return a}()},{xtype:"datefield",fieldLabel:translate("endDate",true),tooltip:translate("indicateTheLastDayOfTheAutomaticCreationOfThe",true)+" "+translate("invoice")+".",name:"endDate",allowBlank:true,format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",minValue:function(){var a=new Date();a.setDate(a.getDate()+1);return a}()},{xtype:"combo",name:"economicActivity",emptyText:"Buscar...",fieldLabel:"Actividad económica",allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:1,listConfig:{loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',getInnerTpl:function(){return"{id} - {value}"}},countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"],hidden:true},{xtype:"combo",name:"cr_saleCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Condición",store:"SaleConditions",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"],hidden:true},{xtype:"combo",fieldLabel:translate("deadline",true),name:"idTerm",allowBlank:false,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -274px; top: -52px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 260px;"><div class="text">'+translate("due",true)+" "+translate("ofTheInvoice")+" "+translate("invoice")+". "+translate("itIsPossibleToAddMoreOptionsIn",true)+' <a href="/configuration">'+translate("configuration")+"</a>.</div></div></div></div>",store:"Terms",displayField:"name",valueField:"idLocal",queryMode:"local",editable:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewTerm" class="createNewTerm">'+translate("newDeadline",true)+"</a></div>"}},{xtype:"numberfield",fieldLabel:translate("frequency",true),tooltip:translate("indicateHowOftenItWillGenerate",true)+" "+translate("theInvoice")+" "+translate("invoice")+", "+translate("forExampleIfYouChooseTwoItWillBeCreatedEvery2Months")+".",name:"repeatEvery",allowBlank:false,minValue:1,value:1},{xtype:"combo",name:"idPriceList",fieldLabel:translate("priceList",true),displayField:"name",valueField:"idLocal",store:"PriceListCombo",editable:false,labelAlign:"right",queryMode:"local",tooltip:translate("indicateThePriceListYouWishToUseIn",true)+" "+translate("theInvoice")+" "+translate("invoice"),labelPad:15,allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">'+translate("newList",true)+"</a></div>"},listeners:{afterrender:function(b){var a=b.getStore();a.load({callback:function(){var c=a.findRecord("main","yes");b.select(c)}})}}},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("invoice"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",value:translate("itIsAssignedAccordingToTheRateThatTheSystemHasSetTheDayTheInvoiceIsGenerated",true)+".",hidden:true,labelAlign:"right",labelPad:15,width:300},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"combo",name:"cfdiUse",fieldLabel:translate("use",true),displayField:"name",valueField:"code",store:"CFDIUseList",tooltip:translate("indicatesTheUseThatTheReceiverWillGiveToTheVentBill",true),editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:true,hidden:true,matchFieldWidth:false,listConfig:{width:350}},{xtype:"combo",name:"operationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("operationType",true),store:"OperationTypes",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["peru"],isRequiredForElectronicInvoicing:["peru"],hidden:true,labelAlign:"right",}]}],listeners:{afterrender:function(d,c){if(d.configs.country==="mexico"){var e=this.down("combo[name=paymentMethod]");e.store=Ext.create("AL.store.DocumentPaymentMethods",{country:"mexico",stampVersion:d.configs.stampVersion});e.valueField="paymentMethod";e.displayField="display";e.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{display}</tpl>');e.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{display}</div></tpl>'};e.addListener("change",function(h){var g=h.up("form");var f=h.getValue();if(f!=""&&f!=null){var j=g.down("textfield[name=accountNumber]");if(f!="cash"&&f!="other"&&f!="not-applicable"){j.enable()}else{j.disable();j.setValue(null)}}});if(d.configs.stampVersion=="3.3"&&e){e.setFieldLabel('Forma de pago<span class="req">*</span>')}var b=this.down("container[name=containerLeft]"),a={xtype:"panel",id:"paymentMethodContainer",layout:"hbox",border:false,width:440,items:[e,{xtype:"textfield",name:"accountNumber",emptyText:"Número cuenta",style:"margin-left: 15px; margin-top: 11px;",width:110,tooltip:"Ingresa aquí los últimos cuatro números de la cuenta o tarjeta",hideLabel:true,disabled:true,minLength:4},]};b.insert(6,a)}}},getFieldValuesAsMetadata:function(){var c=null;var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"peru":var d=this.down("combo[name=operationType]");c={operationType:d.getValue()};break;case"costaRica":var f=this.down("combo[name=cr_saleCondition]");var a=this.down("combo[name=paymentMethod]");var e=this.down("combo[name=economicActivity]");c={saleCondition:f.getValue(),paymentMethod:a.getValue(),economicActivity:e.getValue(),};break}return c},setFieldValuesFromMetadata:function(d){var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"peru":if(typeof d.operationType!=="undefined"){var e=this.down("combo[name=operationType]");var c=e.getStore();if(c.hasLoaded()){e.setValue(d.operationType)}else{c.on("load",function(h){e.setValue(d.operationType)})}}break;case"costaRica":if(typeof d.saleCondition!=="undefined"){var g=this.down("combo[name=cr_saleCondition]");var c=g.getStore();if(c.hasLoaded()){g.setValue(d.saleCondition)}else{c.on("load",function(h){g.setValue(d.saleCondition)})}}if(typeof d.paymentMethod!=="undefined"){var a=this.down("combo[name=paymentMethod]");var c=a.getStore();if(c.hasLoaded()){a.setValue(d.paymentMethod)}else{c.on("load",function(h){a.setValue(d.paymentMethod)})}}if(typeof d.economicActivity!=="undefined"){var f=this.down("combo[name=economicActivity]");var c=f.getStore();if(c.hasLoaded()){f.setValue(d.economicActivity)}else{c.on("load",function(h){f.setValue(d.economicActivity)})}}break}},});Ext.define("AL.store.RecurringInvoices",{extend:"Ext.data.Store",model:"AL.model.RecurringInvoice",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/recurring-invoice/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a "+translate("openInvoice",true)+"], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.ItemsRecurring",{extend:"Ext.data.Store",model:"AL.model.ItemRecurring",autoLoad:false,proxy:{type:"ajax",url:"/item/index/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ResolutionsComboRecurring",{extend:"Ext.data.Store",model:"AL.model.Resolution",autoLoad:true,proxy:{type:"ajax",url:"/resolution/retrieve-for-recurring-invoices/format/json",reader:{type:"json",root:"results"}},sorters:[{property:"name",direction:"ASC"}]});Ext.define("AL.model.RecurringPayment",{extend:"Ext.data.Model",fields:["idLocal","idCategory","idClient","amount",{name:"startDate",type:"date",dateFormat:"c"},{name:"endDate",type:"date",dateFormat:"c"},"repeatEvery","observations","name","categoryName","accountName","decimalPrecision","currencySymbol"],proxy:{type:"ajax",method:"POST",api:{read:"/recurring-payment/retrieve-all/format/json",update:"data/updateItems.json",create:"/recurring-payment/add/format/json",destroy:"/recurring-payment/delete"},reader:{type:"json",root:"results",successProperty:"success"}}});Ext.define("AL.store.RecurringPayments",{extend:"Ext.data.Store",model:"AL.model.RecurringPayment",pageSize:20,remoteSort:true,autoLoad:false,proxy:{type:"ajax",url:"/recurring-payment/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Imprimir], img[alt="+translate("seeDetail",true)+"], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt="+translate("edit",true)+"], img[alt="+translate("cancel",true)+"], img[alt="+translate("remove",true)+"]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.model.RetentionReference",{extend:"Ext.data.Model",fields:["id","name","keyRetentionReference"]});Ext.define("AL.view.common.SmileWindow",{extend:"Ext.window.Window",alias:"widget.common_SmileWindow",cls:"smile-window",initComponent:function(){this.header={height:60,cls:"smile-window-header",tools:[{type:"close",handler:function(d,c,b){this.up("window").close()},xtype:"button",cls:"close-smile-window",height:18,width:18,border:0,style:"background: transparent !important; margin-right: 10px; ",listeners:{afterrender:function(c,b){c.getEl().dom.innerHTML='                                <svg width="13" height="13" viewBox="0 0 13 14" xmlns="http://www.w3.org/2000/svg">                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.861839 1.18392C1.26475 0.806188 1.89759 0.826602 2.27532 1.22951L6.54578 5.78468L10.8162 1.22951C11.194 0.826602 11.8268 0.806188 12.2297 1.18392C12.6326 1.56165 12.653 2.19448 12.2753 2.5974L7.91651 7.24679L12.2753 11.8962C12.653 12.2991 12.6326 12.9319 12.2297 13.3097C11.8268 13.6874 11.194 13.667 10.8162 13.2641L6.54578 8.7089L2.27532 13.2641C1.89759 13.667 1.26475 13.6874 0.861839 13.3097C0.458926 12.9319 0.438512 12.2991 0.816243 11.8962L5.17505 7.24679L0.816242 2.5974C0.438512 2.19448 0.458926 1.56165 0.861839 1.18392Z" fill="#999999"/>                                </svg>                            '}}}],};if(!this.bodyPadding){this.bodyPadding="20px 5px 20px 5px"}if(this.footer){var a=[];if(this.footer.items){a=this.footer.items}if(this.footer.height==undefined){this.footer.height=50}this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",cls:"smile-window-footer",height:this.footer.height,items:a,defaults:{xtype:"button",height:40,cls:"button"},layout:{type:"hbox",pack:"end",}}];if(this.height){this.height+=50}}this.callParent(arguments)},afterRender:function(){var d=document.querySelector(".smile-window-footer");var c=document.querySelector(".smile-window-header");var b=null;if(d&&this.required){b=document.createElement("div");b.className="required-anotation window";b.style="    float: left; position: relative; top: -30px; left: 10px;";b.innerHTML=translate("requiredText",true);d.appendChild(b)}if(c&&this.smileTooltip){b=document.createElement("div");b.style=this.smileTooltip.nodeStyle?this.smileTooltip.nodeStyle:"float: right; position: relative; top: -32px; left: -140px;";var a=this.smileTooltip.style?this.smileTooltip.style:"";b.innerHTML='<span class="tooltip"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"> <span class="tooltiptext" style ="'+a+'">'+this.smileTooltip.text+"</span></span>";"";c.appendChild(b)}this.callParent(arguments)}});Ext.define("AL.view.retention.GridAll",{extend:"Ext.grid.Panel",alias:"widget.retention_GridAllRetentions",minHeight:500,width:1024,border:true,frame:true,title:translate("retentions",true),columnLines:true,scroll:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYetF",true,{document:"{{retention}}"})+'</div><div class="button-wrapper"><a href="/retention/add" class="button green"><span class="plus"></span>'+translate("newRetention",true)+"</a></div></div></div>",getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""}},initComponent:function(){this.store=Ext.create("AL.store.Retentions",{autoLoad:true,proxy:{type:"ajax",url:"/retention/retrieve-all/format/json/editable/yes/deletable/yes/includeInactive/true",reader:{type:"json",root:"results"}}});var b=this.configs.country;var a=[{header:translate("name",true),dataIndex:"name",flex:2},{header:translate("retention",true)+" (%)",dataIndex:"percentage",renderer:this.renderPercentage,align:"center",flex:1.2},{header:translate("description",true),dataIndex:"description",flex:6},{header:translate("actions",true),align:"center",type:"retentionActions",renderer:this.setActions,width:80}];a.splice(2,0,{header:b==="argentina"?"Categoría":translate("type",true),dataIndex:"retentionReference",type:"retentionType",flex:1});if(b==="argentina"){a.splice(1,1)}this.columns=a;this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.isEditable(this.configs.country)){b+='<a href="/retention/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(c.get("status")==="active"){b+='<a title="'+translate("deactivate",true)+'" href=""><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleRetentionStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a title="'+translate("activate",true)+'" href=""><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleRetentionStatus" /></a>'}else{b+='<img title="'+translate("activate",true)+'"  src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("activate",true)+'" class="disabled" />'}}if(c.get("deletable")){b+='<a href="/retention/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteRetention"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderPercentage:function(e,f,b,g,d,c,a){if(e){return AL.math.approx(e,null,4)}}});Ext.define("AL.view.retention.PanelForApplyRetentions",{extend:"Ext.panel.Panel",alias:"widget.panelForApplyRetentionsComponent",width:"100%",retentions:[],items:[{xtype:"panel",border:false,name:"retentionsList",items:[]},{xtype:"button",baseCls:"none-add-retention-button",name:"addRetention",height:18,text:"Agregar "+translate("retention"),style:"float: left; margin-left: 10px;",listeners:{click:function(b){var c=b.up("panel");var a=Ext.ComponentQuery.query(c.configs.formWithConfigs.alias)[0];Ext.create("AL.view.retention.ModalForApplyRetention",{configs:a.configs,callbackBeforeApplyRetention:function(d){c.addRetention(d)}})}}},],getRetentions:function(){return this.retentions},getRetentionsWithMetadataEncoded:function(){var a=this.getRetentions();var b=[];Ext.each(a,function(d){var c=d;if(c.metadata){c.metadata=Ext.encode(c.metadata)}b.push(c)});return b},setRetentions:function(a){a=a||[];this.retentions=a},setRetentionsForShowOnPanel:function(a){this.setRetentions(a);this.renderRetentionsList()},renderRetentionsList:function(){var e=this;var b=this.getRetentions();var a=this.down("panel[name=retentionsList]");a.removeAll();for(var c=0;c<b.length;c++){var d=b[c];a.add([{xtype:"panel",border:false,items:[{xtype:"box",html:d.nameWithPercentageAndValue,style:"float:left;margin-top:2px;"},{xtype:"button",indexRetention:c,text:'<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" title="'+translate("editRetention",true)+'" />',cls:"sm-button-primary-light",style:"width: 25px;float:left;border:none;margin-left:2px;",handler:function(){var g=this;var f=Ext.ComponentQuery.query(e.configs.formWithConfigs.alias)[0];Ext.create("AL.view.retention.ModalForApplyRetention",{configs:f.configs,retention:b[g.indexRetention],callbackBeforeApplyRetention:function(h){e.editRetention(h,g.indexRetention)}})}},{xtype:"button",indexRetention:c,text:'<img src="https://cdn1.getsoft.app/images/sm-delete.png" title="'+translate("deleteRetention",true)+'" />',cls:"sm-button-primary-light",style:"width: 25px;float:left;border:none;margin-left:2px;",handler:function(){e.deleteRetentionByIndex(this.indexRetention)}}]}])}},addRetention:function(b){var a=this.getRetentions();a.push(b);this.setRetentions(a);this.renderRetentions()},editRetention:function(c,b){var a=this.getRetentions();a[b]=c;this.setRetentions(a);this.renderRetentions()},deleteRetentionByIndex:function(b){var a=this.getRetentions();a.splice(b,1);this.setRetentions(a);this.renderRetentions()},renderRetentions:function(){this.renderRetentionsList();if(typeof this.configs.callbackForUpdateTotal=="function"){this.configs.callbackForUpdateTotal(this.getRetentions(),this)}}});Ext.define("AL.view.retention.ModalForApplyRetention",{extend:"AL.view.common.SmileWindow",alias:"widget.retention_ModalForApplyRetention",title:translate("applyRetention",true),autoShow:true,modal:true,border:false,bodyStyle:"background: transparent",padding:"5px 20px 5px 20px",items:[{xtype:"form",items:[{xtype:"combo",name:"idRetention",fieldLabel:"Concepto",allowBlank:false,displayField:"name",valueField:"idLocal",queryMode:"local",queryParam:"name",store:Ext.create("AL.store.Retentions",{autoLoadBeforeRender:true}),width:400,listConfig:{loadingText:"Buscando...",tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'},enableKeyEvents:true,listeners:{keypress:function(){this.on("change",function(){var a=this.store;a.clearFilter();if(this.getValue()){a.filter({property:this.displayField,anyMatch:true,value:AL.string.getRegexForEscapeAccents(this.getValue())})}})},select:function(){this.store.clearFilter()}}},{xtype:"textfield",name:"amount",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,width:400,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",fieldLabel:"Importe"},{xtype:"textfield",name:"certificateNumber",fieldLabel:"Certificado Nº",width:400,countries:["argentina"],hidden:true}]}],footer:{items:[{cls:"button",text:"Cancelar",handler:function(){this.up("window").close()},},{cls:"button main-button",text:translate("apply",true),handler:function(f){var j=this.up("window");var b=j.down("form");if(!b.isValid()){Ext.MessageBox.alert("Error",translate("checkTheFieldsMarkedInRed",true));return}if(typeof j.callbackBeforeApplyRetention=="function"){var h=b.getForm().getValues();var a=b.down("combo[name=idRetention]");var d=b.down("textfield[name=amount]");var c=a.getSelectedRecord();var e=c.get("name");if(c.get("calculatedBy")=="percentage"){e+="("+c.get("percentage")+"%)"}e+=": "+Ext.util.Format.usMoney(d.getValue());h.nameWithPercentageAndValue=e;var g=j.getFieldValuesAsMetadata();if(g){h.metadata=g}j.callbackBeforeApplyRetention(h)}j.close()}}]},initComponent:function(){this.callParent()},setValuesFromRetention:function(b){var d=this.down("combo[name=idRetention]"),c=this.down("textfield[name=amount]");d.setValue(b.idRetention);c.setValue(b.amount);var a=b.metadata;if(a&&typeof a!="object"){a=Ext.decode(a)}this.setFieldValuesFromMetadata(a)},getFieldValuesAsMetadata:function(){var c=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"argentina":var b=this.down("textfield[name=certificateNumber]");c={certificateNumber:b.getValue(),};break}return c},setFieldValuesFromMetadata:function(c){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"argentina":if(typeof c.certificateNumber!=="undefined"){var b=this.down("textfield[name=certificateNumber]");b.setValue(c.certificateNumber)}break}},listeners:{beforerender:function(){this.executeActionsBeforeRender();if(this.retention){this.setValuesFromRetention(this.retention)}}}});Ext.define("AL.store.RetentionsCategoriesFavorablesCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",pageSize:80,proxy:{type:"cacheajax",url:"/category/retrieve-retentions-categories-for-combo/type/asset/format/json/",cacheName:"RetentionsCategoriesFavorablesCombo",timeout:480000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.RetentionsCategoriesToBePaidCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",pageSize:80,proxy:{type:"cacheajax",url:"/category/retrieve-retentions-categories-for-combo/type/liability/format/json/",cacheName:"RetentionsCategoriesToBePaidCombo",timeout:480000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.RetentionReferences",{extend:"Ext.data.Store",model:"AL.model.RetentionReference",autoLoad:false,data:[],proxy:{type:"ajax",url:"/retention/retrieve-retention-references/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.RetentionTypes606",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/retentionTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.resolution.FormAdd",{extend:"Ext.form.Panel",alias:"widget.resolution_FormAdd",title:translate("newNumeration",true)+" "+translate("numeration"),bodyPadding:40,width:450,layout:"anchor",bodyCls:"container-visible",cls:"container-visible",requires:["AL.view.buttons.Cancel"],defaults:{anchor:"100%",labelWidth:200,labelAlign:"right",width:300,labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{xtype:"hidden",name:"xmlFileName",countries:["chile"]},{xtype:"combo",fieldLabel:translate("documentType",true),name:"documentType",allowBlank:true,hidden:true,store:"DocumentTypesForResolution",displayField:"name",valueField:"id",queryMode:"local",forceSelection:true,matchFieldWidth:false,editable:false,listConfig:{width:200,height:200,border:true},listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Selecciona el tipo de documento que usarás para esta numeración.</div></div></div></div>'}}}},{xtype:"combo",fieldLabel:translate("documentType",true),name:"subDocumentType",allowBlank:true,hidden:true,store:"SubDocumentTypesForResolution",displayField:"value",valueField:"key",queryMode:"local",forceSelection:true,matchFieldWidth:false,editable:false,listConfig:{width:200,height:200,border:true},requires:["argentina"],countries:["argentina"]},{xtype:"checkbox",fieldLabel:translate("electronicNumeration",true),inputValue:true,uncheckedValue:false,checked:true,name:"isElectronicResolution",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Selecciona esta opción si usarás esta '+translate("numeration")+" para "+translate("stamp")+" "+translate("stampDocuments")+".</div></div></div></div>",countries:["colombia","peru","costaRica","argentina","chile"],countriesStampValidate:true},{xtype:"textfield",name:"name",allowBlank:false,fieldLabel:translate("name",true),afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("nameThatWillHelpYouIdentifyYourNumber",true)+".</div></div></div></div>"},{xtype:"checkbox",fieldLabel:translate("automaticNumeration",true),inputValue:"yes",checked:true,name:"autoincrement",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("whenYouActivateThisOptionTheSystemWillGenerateTheNextNumberOfYourInvoiceAutomatically",true)+"</div></div></div></div>"},{fieldLabel:translate("prefix",true),name:"prefix",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text" id="prefixFieldHelpText">'+translate("itAllowsYouToDifferentiateBetweenSeveralNumberingsForExampleForDifferentPointsOfSale",true)+"</div></div></div></div>",listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Para NCF de 11 dígitos ingresa los 2 primeros, ejemplo: B0 (incluye el primer dígito del tipo comprobante). Para NCF de 19 dígitos ingresa los 10 primeros, ejemplo: A020010210</div></div></div></div>'}}},requires:["argentina"]},{fieldLabel:translate("inicialNumber",true),name:"nextInvoiceNumber",regex:/^[1-9]([0-9]+)?$/,allowBlank:false,maxLength:10,regexText:translate("theNumeration",true)+" "+translate("numeration")+" "+translate("mustStartWithAValueOtherThanZero"),afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("enterTheNumberThatYourNextInvoiceWillBeCreatedWith",true)+"</div></div></div></div>",listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.setFieldLabel("Secuencia");c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Comienza con el segundo dígito del tipo de comprobante y termina con el siguiente número de documento a crear, ejemplo 100000008</div></div></div></div>';c.maxLength=9}else{if(b.configs.country=="peru"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Ingresa el '+translate("number")+" con el que se creará tu próximo documento.</div></div></div></div>"}}if(b.configs.country=="colombia"){c.setFieldLabel("Próxima factura")}}},validator:function(e){var c=parseInt(e);if(e){var d=this.up("form");if(d.configs.country=="colombia"&&d.down("checkbox[name=isElectronicResolution]").checked===true){var b=parseInt(d.down("[name=minInvoiceNumber]").getValue());var a=parseInt(d.down("[name=maxInvoiceNumber]").getValue());if(e<b||e>a){return"El valor debe estar dentro del rango de la numeración electrónica"}}}return true}},{fieldLabel:"Desde el número",name:"minInvoiceNumber",regex:/^[0-9]+$/,maxLength:10,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Campo informativo para identificar desde dónde puedes facturar con esta '+translate("numeration")+".</div></div></div></div>",isRequiredForElectronicInvoicing:["colombia"],listeners:{afterrender:function(c,a){var b=c.up("resolution_FormAdd");if(!Ext.Array.contains(["colombia","chile"],b.configs.country)){c.allowBlank=true;c.hide()}}},validator:function(d){var b=parseInt(d);if(d){var c=this.up("form");if(c.configs.country=="colombia"&&c.down("checkbox[name=isElectronicResolution]").checked===true){var a=c.down("[name=nextInvoiceNumber]");a.isValid()}}return true}},{fieldLabel:translate("finalNumber",true),name:"maxInvoiceNumber",regex:/^[0-9]+$/,maxLength:10,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("informationFieldToIdentifyHowFarYouCanBillWithThisNumber",true)+"</div></div></div></div>",isRequiredForElectronicInvoicing:["colombia"],listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.maxLength=9}if(b.configs.country=="colombia"){c.setFieldLabel("Hasta el número")}}},validator:function(d){var b=parseInt(d);if(d){var c=this.up("form");if(c.configs.country=="colombia"&&c.down("checkbox[name=isElectronicResolution]").checked===true){var a=c.down("[name=nextInvoiceNumber]");a.isValid()}}return true}},{xtype:"datefield",fieldLabel:"Vigencia desde",tooltip:"Vigencia inicial de "+translate("theResolutionText")+" "+translate("resolutionText"),name:"startDate",format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true,listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.setFieldLabel("Válida desde")}}},countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],},{xtype:"datefield",fieldLabel:"Vigencia hasta",tooltip:"Vigencia final de "+translate("theResolutionText")+" "+translate("resolutionText"),name:"endDate",format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true,listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.setFieldLabel("Válida hasta")}}},countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],},{xtype:"radiogroup",name:"isDefaultGroup",defaultType:"radiofield",fieldLabel:translate("favorite",true),afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("ifYouMarkThisNumberAsPreferredItWillBeSelectedByDefaultWhenYouCreateAnInvoice",true)+".</div></div></div></div>",allowBlank:false,listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"||b.configs.country=="peru"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si marcas esta '+translate("numeration")+" como preferida será seleccionada por defecto cuando vayas a crear un documento nuevo.</div></div></div></div>"}}},items:[{boxLabel:translate("yes",true),name:"isDefault",inputValue:"yes"},{boxLabel:translate("no",true),name:"isDefault",inputValue:"no",checked:true}]},{xtype:"textarea",fieldLabel:"Sucursal",name:"do_branchOffice",allowBlank:true,hidden:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Indica el nombre de la sucursal a la que vas a asociar esta '+translate("numeration")+".</div></div></div></div>",listeners:{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Indica el nombre del punto de emisión para esta '+translate("numeration")+". Será visible en la impresión del documento.</div></div></div></div>"}}}},{xtype:"textfield",fieldLabel:"Fecha y hora resolución",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Ingresa la fecha de la resolución en el siguiente formato YYYY-MM-DD HH:MM:SS.</div></div></div></div>',name:"resolutionDate",hidden:true},{fieldLabel:"Número de resolución",name:"resolution",regex:/^[0-9]+$/,countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Indica aquí el número de '+translate("resolutionText")+" otorgado por "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+".</div></div></div></div>"},{xtype:"textarea",fieldLabel:translate("resolutionText",true),name:"resolutionText",allowBlank:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text" id="resolutionTextFieldHelpText">'+translate("indicatesAdditionalInformationThatIsRelatedToThisNumbering",true)+".</div></div></div></div>"},{xtype:"panel",name:"xmlFileContainer",renderTo:Ext.getBody(),bodyPadding:"0px",hidden:true,border:false,items:[{xtype:"panel",width:"27px",style:"float: right",name:"editResolutionXmlFile",border:false,},{xtype:"panel",style:"float: right",width:"220px",name:"getResolutionXmlFile",border:false,}]},],buttons:[{xtype:"buttons_Cancel",cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),formBind:true,disabled:true,action:"save",cls:"sm-button-primary",height:38,width:157},],isSubDocumentType:function(a){if(a.getSelectedRecord().data.key){return true}else{return false}},loadSubDocumentType:function(e,f,c){var a=e.getStore();var b=Ext.create("AL.store.SubDocumentTypesForResolution");b.load();var d=function(){Ext.each(b.getRange(),function(g){g.data.id=g.data.key;g.internalId=g.data.key;a.add(g);a.sort("name");if(c){c()}if(f){var g=a.findRecord("key",f);e.setValue(g)}})};if(b.hasLoaded()){d()}else{b.on("load",function(){d()})}},getFieldValuesAsMetadata:function(){var e=null;var c=this.configs&&this.configs.country?this.configs.country:null;switch(c){case"colombia":var f=this.down("checkbox[name=isElectronicResolution]"),d=this.down("textfield[name=minInvoiceNumber]");e={isElectronicResolution:f.getValue(),minInvoiceNumber:d.getValue()};break;case"peru":var f=this.down("checkbox[name=isElectronicResolution]");e={isElectronicResolution:f.getValue(),};break;case"chile":var f=this.down("checkbox[name=isElectronicResolution]");var b=this.down("combo[name=documentType]");e={isElectronicResolution:f.getValue(),};if(this.isSubDocumentType(b)){e.subDocumentType=b.getSelectedRecord().data.key}else{e.subDocumentType=""}break;case"costaRica":var f=this.down("checkbox[name=isElectronicResolution]");var b=this.down("combo[name=documentType]");e={isElectronicResolution:f.getValue(),};if(this.isSubDocumentType(b)){e.subDocumentType=b.getSelectedRecord().data.key}else{e.subDocumentType=""}break;case"argentina":var f=this.down("checkbox[name=isElectronicResolution]"),a=this.down("combo[name=subDocumentType]");e={isElectronicResolution:f.getValue(),subDocumentType:a.getValue()};break}return e},setFieldValuesFromMetadata:function(e){var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"colombia":if(typeof e.isElectronicResolution!=="undefined"){var f=this.down("checkbox[name=isElectronicResolution]");f.setValue(e.isElectronicResolution)}if(typeof e.minInvoiceNumber!=="undefined"){var d=this.down("textfield[name=minInvoiceNumber]");d.setValue(e.minInvoiceNumber)}break;case"peru":case"chile":if(typeof e.isElectronicResolution!=="undefined"){var f=this.down("checkbox[name=isElectronicResolution]");f.setValue(e.isElectronicResolution)}if(typeof e.subDocumentType!=="undefined"&&typeof e.subDocumentType!==""&&b=="chile"){var a=this.down("combo[name=documentType]");this.loadSubDocumentType(a,e.subDocumentType)}break;case"costaRica":if(typeof e.isElectronicResolution!=="undefined"){var f=this.down("checkbox[name=isElectronicResolution]");f.setValue(e.isElectronicResolution)}if(typeof e.subDocumentType!=="undefined"&&typeof e.subDocumentType!==""){var a=this.down("combo[name=documentType]");this.loadSubDocumentType(a,e.subDocumentType)}break;case"argentina":if(typeof e.isElectronicResolution!=="undefined"){var f=this.down("checkbox[name=isElectronicResolution]");f.setValue(e.isElectronicResolution)}if(typeof e.subDocumentType!=="undefined"){var a=this.down("combo[name=subDocumentType]");var c=a.getStore();if(c.hasLoaded()){a.setValue(e.subDocumentType)}else{c.on("load",function(g){a.setValue(e.subDocumentType)})}}break}},});Ext.define("AL.view.resolution.XmlResolutionAdd",{extend:"Ext.panel.Panel",alias:"widget.xmlResolutionAdd",width:"100%",items:[],initComponent:function(){var b=this;var a=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-resolution-file-modal",reason:"addNewResolutionFile",border:false,resizable:false,width:500,height:205,title:translate("uploadXmlResolutionFileTitle",true),bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative",items:[{xtype:"component",html:'<div class="company-currency-note">'+translate("addXMLFileFromGovernmentEntity",true)+".</div>",width:420,anchor:"100%",style:"margin: 15px auto",},{xtype:"form",id:"uploadXmlResolutionForm",fileUpload:true,standardSubmit:true,height:30,items:[{xtype:"filefield",name:"xmlResolutionFile",width:420,fieldLabel:translate("uploadXmlResolutionFileBody",true),style:"margin: 0 auto;",msgTarget:"side",allowBlank:false,regex:/^.*\.(xml)$/,regexText:translate("yourXmlResolutionFileMustHaveTheFormatSupportedByTheGovernmentEntity",true),tooltip:translate("yourXmlResolutionFileMustHaveTheFormatSupportedByTheGovernmentEntityMoreInfo",true),buttonText:translate("uploadXmlResolutionFileButton",true),listeners:{change:function(e,c){var d=c.replace(/C:\\fakepath\\/g,"");e.setRawValue(d)},afterrender:function(c){c.tooltip.hideDelay=2000}}},{xtype:"hidden",name:"xmlResolutionType"},{xtype:"hidden",name:"idLocal"}]},]}],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){a.close()}},{text:translate("load",true),cls:"button main-button",handler:function(c){var e=c.up("window");var d=e.down("form");if(d.isValid()){d.submit({url:(b.type=="upload"?"/resolution/upload-resolution-from-xml":"/resolution/update-resolution-from-xml"),waitMsg:translate("uploadingXmlResolutionFile",true),})}}}]},listeners:{afterrender:function(g){var e=g.down("button[action=save]");var h=g.down("buttons_Cancel");if(e){e.hide()}if(h){h.hide()}if(b.type=="update"){var j=g.down("hidden[name=xmlResolutionType]");var f=g.down("hidden[name=idLocal]");var d=Ext.ComponentQuery.query("resolution_FormAdd combo[name=documentType]")[0];var c=Ext.ComponentQuery.query("resolution_FormAdd hidden[name=idLocal]")[0];if(d.getSelectedRecord().data.key){j.setValue(d.getSelectedRecord().data.key)}else{j.setValue(d.getValue())}f.setValue(c.getValue())}}}});b.callParent()},});Ext.define("AL.store.Resolution",{extend:"Ext.data.Store",model:"AL.model.Resolution",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/resolution/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt="+translate("print",true)+"], img[alt="+translate("seeDetail",true)+"], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt="+translate("edit",true)+"], img[alt="+translate("cancel",true)+"], img[alt="+translate("remove",true)+"]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.DocumentTypesForResolution",{extend:"Ext.data.Store",fields:["id","name"],autoLoad:true,proxy:{type:"ajax",url:"/resolution/retrieve-document-types/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.SubDocumentTypesForResolution",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/subDocumentTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.model.ClientSales",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"int"},{name:"name",type:"string"},{name:"total",type:"float"},{name:"subTotal",type:"float"},{name:"totalInvoices",type:"int"}]});Ext.define("AL.model.ItemSales",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"int"},{name:"name",type:"string"},{name:"reference",type:"auto"},{name:"total",type:"float"},{name:"subTotal",type:"float"},{name:"totalItems",type:"float"}]});Ext.define("AL.model.ItemProfit",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"int"},{name:"name",type:"string"},{name:"reference",type:"auto"},{name:"totalSold",type:"float"},{name:"totalCost",type:"float"},{name:"profit",type:"float"},{name:"profitPercentage",type:"string"}]});Ext.define("AL.model.InventoryReport",{extend:"Ext.data.Model",fields:["idLocal","name","reference","description","quantity","minQuantity","unit","averageCost","inventoryTotal","status","warehouseQuantity"]});Ext.define("AL.model.RetentionReport",{extend:"Ext.data.Model",fields:["retentionApplied","client","total","retentionAmount","billNumber","transactionNumber","percentage","link","decimalPrecision","base","calculatedBy","supportDocumentNumber","certificateNumber","linkToSupportDocument",]});Ext.define("AL.model.Sales",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"int"},{name:"name",type:"string"},{name:"number",type:"string"},{name:"date",type:"date",dateFormat:"c"},{name:"subTotal",type:"float"},{name:"total",type:"float"},{name:"decimalPrecision",type:"auto"}]});Ext.define("AL.model.TaxReport",{extend:"Ext.data.Model",fields:["number","transactionNumber","itemName","quantity","price","discount","tax","link","total","decimalPrecision"]});Ext.define("AL.model.Purchase",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"int"},{name:"name",type:"string"},{name:"billNumber",type:"string"},{name:"date",type:"date",dateFormat:"c"},{name:"subTotal",type:"float"},{name:"total",type:"float"},{name:"decimalPrecision",type:"auto"}]});Ext.define("AL.model.DianConcept",{extend:"Ext.data.Model",fields:["code","description"]});Ext.define("AL.model.ledger.Journal",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"number",type:"string"},{name:"date",type:"date",dateFormat:"c"},{name:"currencyCode",type:"string"},{name:"currencySymbol",type:"string"},{name:"exchangeRate",type:"float"},{name:"voided",type:"bool"},{name:"totalDebit",type:"float"},{name:"totalCredit",type:"float"},{name:"companyCurrencyValues",type:"auto"},{name:"categories",type:"auto"},{name:"decimalPrecision",type:"int"},{name:"company",type:"auto"},{name:"url",type:"string"},{name:"idResource",type:"int"},{name:"resourceType",type:"string"}]});Ext.define("AL.model.ledger.JournalCategory",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"code",type:"string"},{name:"client",type:"auto",},{name:"identification",type:"string"},{name:"operation",type:"string"},{name:"amount",type:"float"},{name:"companyCurrencyValues",type:"auto"},{name:"journal",type:"auto"},{name:"idCostCenter",type:"int"},{name:"costCenterName",type:"string"},]});Ext.define("AL.model.ledger.CategorySummary",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"integer",},{name:"code",type:"string"},{name:"text",type:"string"},{name:"codeText",type:"string",convert:function(b,a){return a.convertCodeText(a)}},{name:"description",type:"string"},{name:"type",type:"string"},{name:"client",type:"auto"},{name:"previousTotals",type:"auto"},{name:"totalDebit",type:"float"},{name:"totalCredit",type:"float"},{name:"idCostCenter",type:"int"},{name:"costCenterName",type:"string"},],convertCodeText:function(a){var b=a.get("code"),c=a.get("text");if(!b){return c}return b+" - "+c},updateConvertFields:function(){this.set("codeText",this.convertCodeText(this))},getNature:function(){var a;switch(this.get("type")){case"asset":case"expense":a="D";break;case"equity":case"liability":case"income":a="C";break}return a},getPreviousBalance:function(){var b=0,a=this.get("previousTotals");if(a){switch(this.getNature()){case"D":b=AL.math.sub(a.totalDebit,a.totalCredit);break;case"C":b=AL.math.sub(a.totalCredit,a.totalDebit);break}}return b},getCurrentBalance:function(){var c=this.getPreviousBalance(),b=this.get("totalDebit"),a=this.get("totalCredit");switch(this.getNature()){case"D":c=AL.math.add(c,AL.math.sub(b,a));break;case"C":c=AL.math.add(c,AL.math.sub(a,b));break}return c}});Ext.define("AL.view.ux.window.Msg",{extend:"Ext.window.Window",alias:"widget.ux_WindowMsg",msgIcon:null,msgMsg:"",msgLineHeight:"22px",msgButtons:null,msgFn:null,msgHelpX:-506,msgHelpY:4,msgHelpTooltipX:null,msgHelpTooltipY:null,msgHelpTooltipWidth:null,msgHelpText:null,id:"custom-window-msg",style:"background: #fff",border:false,bodyPadding:"20 20 10 20",bodyStyle:"background: transparent",width:510,modal:true,autoShow:true,resizable:false,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",margin:"0 0 20 0",flex:1,layout:{type:"hbox"},items:[{xtype:"container",flex:0,hidden:true,items:[{xtype:"image"}]},{xtype:"container",flex:1,items:[{xtype:"box"}]}]},{xtype:"container",layout:{type:"hbox",pack:"center"},flex:1,items:[{xtype:"button",margin:"0 3 0 3",width:70,hidden:true},{xtype:"button",margin:"0 3 0 3",width:70,hidden:true},{xtype:"button",margin:"0 3 0 3",width:70,hidden:true}]}],initComponent:function(){if(this.msgIcon!==null){this.items[0].items[1].flex=0.9;this.items[0].items[0].flex=0.1;this.items[0].items[0].hidden=false;switch(this.msgIcon){case Ext.Msg.QUESTION:this.items[0].items[0].items[0].src="https://cdn1.getsoft.app/js/extjs2/resources/ext-theme-gray/images/shared/icon-question.gif";break;case Ext.Msg.ERROR:this.items[0].items[0].items[0].src="https://cdn1.getsoft.app/js/extjs2/resources/ext-theme-gray/images/shared/icon-error.gif";break;case Ext.Msg.INFO:this.items[0].items[0].items[0].src="https://cdn1.getsoft.app/js/extjs2/resources/ext-theme-gray/images/shared/icon-info.gif";break;case Ext.Msg.WARNING:this.items[0].items[0].items[0].src="https://cdn1.getsoft.app/js/extjs2/resources/ext-theme-gray/images/shared/icon-warning.gif";break}}this.items[0].items[1].items[0].html='<span style="line-height : '+this.msgLineHeight+';">'+this.msgMsg+"</span>";if(this.msgButtons!==null){var b=this;var a={click:function(){b.close();if(b.msgFn!==null){b.msgFn(this.msgBtn,this,b)}}};switch(this.msgButtons){case Ext.Msg.OK:this.items[1].items[0].msgBtn="ok";this.items[1].items[0].text="Aceptar";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;break;case Ext.Msg.CANCEL:this.items[1].items[0].msgBtn="cancel";this.items[1].items[0].text="Cancelar";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;break;case Ext.Msg.OKCANCEL:this.items[1].items[0].msgBtn="ok";this.items[1].items[0].text="Aceptar";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;this.items[1].items[1].msgBtn="cancel";this.items[1].items[1].text="Cancelar";this.items[1].items[1].listeners=a;this.items[1].items[1].hidden=false;break;case Ext.Msg.YES:this.items[1].items[0].msgBtn="yes";this.items[1].items[0].text="Sí";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;break;case Ext.Msg.NO:this.items[1].items[0].msgBtn="no";this.items[1].items[0].text="No";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;break;case Ext.Msg.YESNO:this.items[1].items[0].msgBtn="yes";this.items[1].items[0].text="Sí";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;this.items[1].items[1].msgBtn="no";this.items[1].items[1].text="No";this.items[1].items[1].listeners=a;this.items[1].items[1].hidden=false;break;case Ext.Msg.YESNOCANCEL:this.items[1].items[0].msgBtn="yes";this.items[1].items[0].text="Sí";this.items[1].items[0].listeners=a;this.items[1].items[0].hidden=false;this.items[1].items[1].msgBtn="no";this.items[1].items[1].text="No";this.items[1].items[1].listeners=a;this.items[1].items[1].hidden=false;this.items[1].items[2].msgBtn="cancel";this.items[1].items[2].text="Cancelar";this.items[1].items[2].listeners=a;this.items[1].items[2].hidden=false;break}}this.callParent(arguments)},listeners:{afterrender:function(){if(this.msgHelpText!==null){var b="";var a="";if(this.msgHelpTooltipX!==null){b+="left : "+this.msgHelpTooltipX+"px;"}if(this.msgHelpTooltipY!==null){b+="top : "+this.msgHelpTooltipY+"px;"}if(this.msgHelpTooltipWidth!==null){a+="width : "+this.msgHelpTooltipWidth+"px;"}if(b!=""){b=' style="'+b+'"'}if(a!=""){a=' style="'+a+'"'}Ext.create("Ext.Component",{html:'<div class="tooltip-wrapper" style="margin-left : '+this.msgHelpX+"px; top : "+this.msgHelpY+'px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"'+b+'><div class="tooltip-text-wrapper"'+a+'><div class="text">'+this.msgHelpText+"</div></div></div></div>",renderTo:"custom-window-msg"})}}}});Ext.define("AL.view.report.ItemsProfitGrid",{extend:"Ext.grid.Panel",alias:"widget.report_ItemsProfitGrid",scroll:true,width:1024,border:true,frame:true,store:"ItemsProfit",columnLines:true,cls:"grid-items-profit",viewConfig:{stripeRows:true,emptyText:'<style>.grid-items-profit .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportItemsProfit")+'!</div><div class="button-wrapper"><a href="/invoice/add" class="button green"><span class="plus"></span>'+translate("newInvoice",true)+" "+translate("invoice")+"</a></div></div></div>"},initComponent:function(){this.columns=[{header:translate("item",true),dataIndex:"name",flex:1,renderer:this.linkItem},{header:translate("reference",true),dataIndex:"reference",align:"center"},{header:"Total vendido",dataIndex:"totalSold",renderer:this.renderMoney,width:120,align:"right"},{header:"Costo Total",dataIndex:"totalCost",align:"right",renderer:this.renderMoney,width:120},{header:"Rentabilidad",dataIndex:"profit",align:"right",renderer:this.renderMoney,width:120},{header:"Porcentaje",dataIndex:"profitPercentage",align:"right",width:120,doSort:function(b){var a=this.up("grid").getStore();var c=this.getSortParam();a.sort({property:c,direction:b,sorterFn:function(e,d){e=e.get(c);d=d.get(c);e=parseFloat(e.substr(0,e.length-1));d=parseFloat(d.substr(0,d.length-1));return e>d?1:(e<d?-1:0)}})}}];this.callParent(arguments)},linkItem:function(e,f,b,g,d,c,a){return'<a href="/item/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)},});Ext.define("AL.view.report.TrialBalanceTree",{extend:"Ext.tree.Panel",alias:"widget.report_TrialBalanceTree",title:"Balance de prueba",rootVisible:false,store:"TrialBalanceCategories",height:600,columns:[{xtype:"treecolumn",text:"Nombre",flex:2,sortable:true,dataIndex:"text"},{text:"Debito",flex:1,dataIndex:"debit",renderer:function(f,g,b,h,d,c,a){var e="";if(f){e=Ext.util.Format.usMoney(f)}return e},scope:this,align:"right",sortable:true},{text:"Crédito",flex:1,dataIndex:"credit",renderer:function(f,g,b,h,d,c,a){var e="";if(f){e=Ext.util.Format.usMoney(f)}return e},align:"right",sortable:true}]});Ext.define("AL.view.report.ProfitAndLossTree",{extend:"Ext.tree.Panel",alias:"widget.report_ProfitAndLossTree",cls:"categories-tree",title:"",rootVisible:false,store:"ProfitAndLoss",section:null,border:false,showCategoriesCode:"no",columns:[{xtype:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"text",renderer:function(j,m,c,g,l,k,h){var e=this;if(h.up("treepanel").showCategoriesCode=="yes"&&c.get("code")){j=c.get("code")+" - "+j}var a='<a href="/category/view/id/'+c.get("idLocal")+'">'+j+"</a>";if(h.toDate&&h.fromDate){a='<a href="/category/view/id/'+c.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}else{var b=Ext.ComponentQuery.query("report_DatesForm")[0];if(b){var f=b.down("datefield[name=fromDate]");var d=b.down("datefield[name=toDate]");h.fromDate=Ext.Date.format(f.getValue(),"Y-m-d");h.toDate=Ext.Date.format(d.getValue(),"Y-m-d");a='<a href="/category/view/id/'+c.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}}return a}},{text:"Total",flex:1,dataIndex:"total",renderer:function(b,c,a){return Ext.util.Format.usMoney(b,2)},align:"right",sortable:true}]});Ext.define("AL.view.common.ReportTree",{extend:"Ext.tree.Panel",alias:"widget.common_ReportTree",cls:"categories-tree",rootVisible:false,moneyDataIndex:null,showCategoriesCode:"no",listeners:{beforerender:function(a){var b=a.down("[colName=money]");b.dataIndex=this.moneyDataIndex}},columns:{items:[{xtype:"treecolumn",name:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"text",renderer:function(j,m,c,g,l,k,h){var e=this;if(h.up("treepanel").showCategoriesCode=="yes"&&c.get("code")){j=c.get("code")+" - "+j}var a='<a href="/category/view/id/'+c.get("idLocal")+'">'+j+"</a>";if(h.toDate&&h.fromDate){a='<a href="/category/view/id/'+c.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}else{var b=Ext.ComponentQuery.query("report_DatesForm")[0];if(b){var f=b.down("datefield[name=fromDate]");var d=b.down("datefield[name=toDate]");h.fromDate=Ext.Date.format(f.getValue(),"Y-m-d");h.toDate=Ext.Date.format(d.getValue(),"Y-m-d");a='<a href="/category/view/id/'+c.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}}return a}},{text:"Total",colName:"money",flex:1,dataIndex:"",renderer:function(b,c,a){return Ext.util.Format.usMoney(b,2)},align:"right",sortable:true}]}});Ext.define("AL.view.common.modern.Msg",{extend:"AL.view.common.SmileWindow",alias:"widget.common_modern_Msg",modal:true,autoShow:true,draggable:false,resizable:false,border:false,layout:{type:"vbox",align:"stretch"},width:480,height:210,msgHtmlConfig:"",handlerConfig:null,items:[{xtype:"label",margin:"0 20 12 20",style:{"font-family":"Roboto",color:"#808080","font-size":"12px"}}],footer:{items:[{xtype:"button",cls:"button main-button",width:127,text:"Entendido",handler:function(a){var b=a.up("window");b.destroy();if(b.handlerConfig){b.handlerConfig(b)}}}]},initComponent:function(){this.items[0].html=this.msgHtmlConfig;this.initTranslations();this.callParent(arguments)},initTranslations:function(){this.footer.items[0].text=translate("btnUnderstood",true)},listeners:{close:function(a){if(a.handlerConfig){a.handlerConfig(a)}}}});Ext.define("AL.view.report.EditCategoriesGrid",{extend:"Ext.grid.Panel",alias:"widget.report_EditCategoriesGrid",plugins:[{ptype:"cellediting",clicksToEdit:1,pluginId:"cellEditor"}],store:Ext.create("Ext.data.Store",{model:"AL.model.Category",autoLoad:false,proxy:{type:"ajax",url:"/report/retrieve-categories-for-report-edit/format/json",reader:{type:"json",root:"results"}}}),viewConfig:{markDirty:false},listeners:{afterrender:function(c){var b=c.getStore();if(!b.hasLoaded()||c.report!==b.report){var a=c.report==="606"?"PurchaseTypes606":"IncomeTypes607";b.report=c.report;Ext.getStore(a).load({callback:function(){b.load()}})}}},initComponent:function(){var b=[{header:"Nombre",dataIndex:"name",flex:1},{header:translate("category",true),dataIndex:"category606",flex:1,colId:"category606",renderer:this.renderCategoryCombo,editor:{xtype:"combo",displayField:"label",forceSelection:true,valueField:"categoryIndex",store:"Categories606",queryMode:"local"}},{id:"purchaseType606",header:"Tipo de compra",dataIndex:"purchaseType606",flex:1,colId:"purchaseType606",renderer:this.renderPurchaseTypeCombo,editor:{xtype:"combo",displayField:"value",forceSelection:true,valueField:"id",store:Ext.create("AL.store.PurchaseTypes606",{autoLoad:true}),queryMode:"local"}}];if(typeof this.configs=="object"){if(typeof this.configs.customHeaders=="boolean"&&this.configs.customHeaders===true){b[0].header=translate("category",true);b[1].header="Categoría DGII"}}var a=this.getStore();switch(this.report){case"606":a.proxy.url="/report/retrieve-categories-for-report-edit/format/json/report/606";break;case"607":a.proxy.url="/report/retrieve-categories-for-report-edit/format/json/report/607";b=[{header:translate("category",true),dataIndex:"name",flex:1},{header:"Tipo de ingreso",dataIndex:"incomeType607",flex:1,colId:"incomeType",renderer:this.renderIncomeTypeCombo,editor:{xtype:"combo",displayField:"value",forceSelection:true,valueField:"id",queryMode:"local",store:"IncomeTypes607"}}];break;default:break}this.columns=b;this.callParent(arguments)},renderCategoryCombo:function(j,m,d,g,l,k,h){var b="";if(j){var e=this.down("gridcolumn[colId=category606]");var c=e.getEditor();var a=c.getStore();var f=a.findRecord("categoryIndex",j);if(f){b=f.get("label")}}return b},renderPurchaseTypeCombo:function(g,k,d,e,j,h,f){var b="";if(g){var a=this.down("gridcolumn[colId=purchaseType606]");var c=a.getEditor();var h=c.getStore();var d=h.findRecord("id",g);if(d){b=d.get("value")}}return b},renderIncomeTypeCombo:function(e,k,b,c,h,f,d){var g="";if(e){var j=this.down("gridcolumn[colId=incomeType]");var a=j.getEditor();var f=a.getStore();var b=f.findRecord("id",e);if(b){g=b.get("value")}}return g}});Ext.define("AL.view.report.OverdueButtons",{extend:"Ext.form.Panel",alias:"widget.report_OverdueButtons",layout:{type:"hbox",pack:"center",align:"middle"},layoutPack:"center",cls:"report-overdue-buttons",frame:false,border:false,bodyStyle:{background:"transparent",},defaults:{margin:"0 10 0 0",enableToggle:true},items:[{xtype:"button",cls:"filter-button",text:translate("overdueLessThan30",true),name:"overdue30"},{xtype:"button",cls:"filter-button",text:translate("overdueBetween30",true),name:"overdue60"},{xtype:"button",cls:"filter-button",text:translate("overdueBetween60",true),name:"overdue90"},{xtype:"button",cls:"filter-button",text:translate("overdueMore91",true),name:"overdue90Plus"},{xtype:"button",cls:"filter-button",text:translate("notOverdue",true),name:"notOverdue",margin:0},{xtype:"label",cls:"tooltip",style:"margin:0px;padding:0px;"}],initComponent:function(){this.layout.pack=this.layoutPack;this.callParent(arguments)}});Ext.define("AL.view.report.ledger.GeneralLedgerTree",{extend:"Ext.tree.Panel",alias:"widget.ledger_GeneralLedgerTree",rootVisible:false,store:"ledger.CategoriesSummary",border:false,initComponent:function(){var a=this;a.columns=[{xtype:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"codeText",renderer:function(j,m,d,g,l,k,h){var b='<a href="/category/view/id/'+d.get("idLocal")+'">'+j+"</a>";if(h.toDate&&h.fromDate){b='<a href="/category/view/id/'+d.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}else{var c=Ext.ComponentQuery.query("report_DatesForm")[0];if(c){var f=c.down("datefield[name=fromDate]");var e=c.down("datefield[name=toDate]");h.fromDate=Ext.Date.format(f.getValue(),"Y-m-d");h.toDate=Ext.Date.format(e.getValue(),"Y-m-d");b='<a href="/category/view/id/'+d.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}}return b}},{text:"Saldo anterior",flex:1,renderer:function(c,d,b){c=b.getPreviousBalance();return a.renderMoney(c)},align:"right",sortable:true},{text:translate("ledger.debit",true),flex:1,dataIndex:"totalDebit",renderer:a.renderMoney,align:"right",sortable:true},{text:translate("ledger.credit",true),flex:1,dataIndex:"totalCredit",renderer:a.renderMoney,align:"right",sortable:true},{text:"Saldo final",flex:1,renderer:function(c,d,b){c=b.getCurrentBalance();return a.renderMoney(c)},align:"right",sortable:true}];this.callParent(arguments)},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)}});Ext.define("AL.store.TotalAssetCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax"}});Ext.define("AL.store.TotalIncomeCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax"}});Ext.define("AL.store.TotalLiabilityCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax"}});Ext.define("AL.store.TotalExpenseCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",folderSort:true,sorters:[{property:"name",direction:"ASC"}],root:{children:[]},proxy:{type:"ajax"}});Ext.define("AL.store.TotalEquityCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax"}});Ext.define("AL.store.ClientsSales",{extend:"Ext.data.Store",model:"AL.model.ClientSales",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],proxy:{type:"ajax",url:"/report/retrieve-sales-by-client/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Sales",{extend:"Ext.data.Store",model:"AL.model.Sales",remoteSort:false,sorters:[{property:"total",direction:"DESC"}],proxy:{type:"ajax",url:"/report/retrieve-sales/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ItemsSales",{extend:"Ext.data.Store",model:"AL.model.ItemSales",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],proxy:{type:"ajax",url:"/report/retrieve-sales-by-item/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ItemsProfit",{extend:"Ext.data.Store",model:"AL.model.ItemProfit",remoteSort:false,sorters:[{property:"totalSold",direction:"DESC"}],proxy:{type:"ajax",timeout:720000,url:"/report/retrieve-items-profit/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.InventoriesReport",{extend:"Ext.data.Store",model:"AL.model.InventoryReport",remoteSort:false,autoLoad:false,sorters:[{property:"inventoryTotal",direction:"DESC"}],proxy:{type:"ajax",url:"/report/retrieve-item-inventory/format/json",reader:{type:"json",root:"results"},timeout:240000}});Ext.define("AL.store.TrialBalanceCategories",{extend:"Ext.data.TreeStore",model:"AL.model.Category",autoLoad:true,folderSort:true,root:{children:[]},proxy:{autoLoad:true,type:"ajax",url:"/report/retrieve-trial-balance/format/json"}});Ext.define("AL.store.ProfitAndLoss",{extend:"Ext.data.TreeStore",model:"AL.model.Category",autoLoad:false,folderSort:true,proxy:{type:"ajax",url:"/report/retrieve-profit-and-loss-section-one/format/json"}});Ext.define("AL.store.Categories606",{extend:"Ext.data.Store",fields:["categoryIndex","label"],data:[{categoryIndex:"1",label:"Gastos de personal"},{categoryIndex:"2",label:"Gastos por trabajos, suministros, y servicios"},{categoryIndex:"3",label:"Arrendamientos"},{categoryIndex:"4",label:"Gastos de activos fijos"},{categoryIndex:"5",label:"Gastos de representación"},{categoryIndex:"6",label:"Otras deducciones admitidas"},{categoryIndex:"7",label:"Gastos financieros"},{categoryIndex:"8",label:"Gastos extraordinarios"},{categoryIndex:"9",label:"Compras y gastos que hacen parte del costo de venta"},{categoryIndex:"10",label:"Adquisiciones de activos"},{categoryIndex:"11",label:"Gastos de seguro"},{categoryIndex:"0",label:"No incluir"}]});Ext.define("AL.store.PurchaseTypes606",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/purchaseTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Purchases",{extend:"Ext.data.Store",model:"AL.model.Purchase",remoteSort:false,sorters:[{property:"total",direction:"DESC"}],proxy:{type:"ajax",url:"/report/retrieve-purchases/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.IncomeTypes607",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/incomeTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ledger.Journals",{extend:"Ext.data.Store",model:"AL.model.ledger.Journal",sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/ledger/retrieve-journals/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ledger.JournalCategories",{extend:"Ext.data.Store",model:"AL.model.ledger.JournalCategory",sorters:[{property:"date",direction:"ASC"}],proxy:{type:"ajax",url:"/ledger/retrieve-journal-categories/format/json",timeout:180000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.ledger.CategoriesSummary",{extend:"Ext.data.TreeStore",model:"AL.model.ledger.CategorySummary",autoLoad:false,folderSort:true,root:{expanded:true,children:[]},proxy:{type:"ajax",url:"/ledger/retrieve-general-ledger-categories/format/json"}});Ext.define("AL.store.ledger.SubsidiaryCategoriesSummary",{extend:"Ext.data.Store",model:"AL.model.ledger.CategorySummary",autoLoad:false,proxy:{type:"ajax",url:"/ledger/retrieve-category-summary-by-client/format/json",timeout:360000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.LiabilitiesCategoriesCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",pageSize:80,autoLoad:false,proxy:{type:"cacheajax",url:"/category/retrieve-liabilities-categories-for-combo/format/json/",cacheName:"LiabilitiesCategoriesCombo",timeout:480000,reader:{type:"json",root:"results"}}});Ext.define("AL.store.ledger.ResourceTypes",{extend:"Ext.data.Store",fields:[{name:"id",type:"string"},{name:"name",type:"string"},],sorters:[{property:"name",direction:"ASC"}],data:(function(){return[{id:"item",name:translate("items",true)},{id:"account",name:translate("banks",true)},{id:"invoice",name:translate("specializedInvoices",true)},{id:"journal",name:translate("journals",true)},{id:"transaction",name:translate("transactions",true)},{id:"creditNote",name:translate("creditNotes",true)},{id:"debitNote",name:translate("debitNotes",true)},{id:"bill",name:translate("bills",true)},{id:"inventoryAdjustment",name:translate("inventoryAdjustments",true)},]})()});Ext.define("AL.view.remission.FormAdvancedOptions",{extend:"Ext.form.Panel",alias:"widget.remission_FormAdvancedOptions",layout:"hbox",width:1050,display:"none",style:"margin-top:10px",items:[{xtype:"container",style:"margin-left: 25px;",name:"containerLeft",width:534,items:[{xtype:"textarea",labelAlign:"right",fieldLabel:'Obsssservaciones <div class="sublabel">(no visible en '+translate("theRemission")+" "+translate("remission")+")</div>",name:"observations",id:"remissionObservationsTextarea",width:375,labelPad:15,allowBlank:true,hidden:true}]},{xtype:"container",defaults:{msgTarget:"side",labelAlign:"right",labelWidth:150,width:350,labelPad:15},items:[{xtype:"combo",fieldLabel:translate("seller",true),name:"idSeller",allowBlank:true,queryMode:"local",store:"SellersCombo",valueField:"idLocal",displayField:"name",emptyText:translate("selectSimple",true),matchFieldWidth:false,listConfig:{emptyText:'<div style="padding:3px 5px 5px !important; color:#666;">Aún no has registrado vendedores</div><div style="padding: 0px 0px 7px 5px;"><a id="createSeller" href="/seller/add" >'+translate("createNewSeller",true)+"</a></div>",width:200},editable:false},{xtype:"combo",name:"idPriceList",fieldLabel:translate("priceList",true),displayField:"name",valueField:"idLocal",store:"PriceListCombo",editable:false,labelAlign:"right",queryMode:"local",tooltip:translate("indicateThePriceListYouWishToUseIn",true)+" "+translate("this")+" "+translate("remission"),labelPad:15,allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="/price-list/add" class="createPriceList">Nueva lista</a></div>'}}]}]});Ext.define("AL.view.remission.BottomContainer",{extend:"Ext.panel.Panel",alias:"widget.remission_BottomContainer",xtype:"bottomcontainer",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:35,style:"width: 100%; padding-left: 30px; padding-right: 30px; left:0;",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textarea",flex:1,fieldLabel:translate("notes",true),name:"anotation",allowBlank:true,labelAlign:"top",labelStyle:"margin-bottom: 11px;",fieldStyle:"max-height: 80px !important; padding: 8px !important;",emptyText:translate("visibleInDocumentPrinting",true),msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper" style="left: 45px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -54px; top: 5px;"><div class="tooltip-text-wrapper"><div class="text">'+translate("addImportantInformationThatClientsWillSeeIn",true)+translate("theRemission")+" "+translate("remission")+"</div></div></div></div>"}]}]},{xtype:"container",style:"margin-top: 29px;",items:[{xtype:"box",name:"requiredText",cls:"bottom-container-required-fields-text",html:""}]}]});Ext.define("AL.view.seller.FormAdd",{extend:"Ext.form.Panel",alias:"widget.seller_FormAdd",bodyPadding:30,width:400,title:"",defaults:{anchor:"100%",labelWidth:100,labelAlign:"right",width:250,labelPad:15,msgTarget:"side"},items:[{xtype:"hidden",name:"idLocal"},{xtype:"textfield",name:"name",fieldLabel:translate("name",true),allowBlank:false,validate:function(){if(this.value=="0"){return false}return true}},{xtype:"textfield",name:"identification",fieldLabel:translate("identification",true),allowBlank:true},{xtype:"textarea",fieldLabel:translate("observations",true),name:"observations",allowBlank:true}]});Ext.define("AL.view.seller.GridAll",{extend:"Ext.grid.Panel",alias:"widget.seller_GridAll",scroll:true,minHeight:390,width:1024,border:true,frame:true,columnLines:true,cls:"grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-payments .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("seller")})+'</div><div class="button-wrapper"><a href="/seller/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newM",true)+" "+translate("seller")+"</a></div></div></div>"},initComponent:function(){this.store=Ext.create("AL.store.Sellers",{autoLoad:true});this.columns=[{header:translate("name",true),dataIndex:"name",flex:1},{header:translate("identification",true),dataIndex:"identification",flex:1},{header:translate("observations",true),dataIndex:"observations",flex:2},{header:translate("actions",true),align:"center",type:"sellerActions",renderer:this.setActions,width:80}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.get("editable")){b+='<a href="/seller/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("deletable")){b+='<a href="/seller/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteSeller"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}if(c.get("status")==="active"){b+='<a href="#" title="'+translate("deactivate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleSellerStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a href="#" title="'+translate("activate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleSellerStatus" /></a>'}}b+="</div>";return b},renderStatus:function(e,j,b,c,g,f,d){var a=b.get("status");var h=(a=="active")?translate("active",true):translate("inactive",true);return h}});Ext.define("AL.store.Sellers",{extend:"Ext.data.Store",model:"AL.model.Seller",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/seller/retrieve-all/format/json/deletable/yes/editable/yes",reader:{type:"json",root:"results"}}});Ext.define("AL.view.support.WindowCreateSupportTicket",{alias:"widget.support_WindowCreateSupportTicket",extend:"Ext.window.Window",modal:true,autoShow:true,border:false,frame:false,width:430,cls:"form-window-support",bodyPadding:"0 20 20 20",bodyStyle:"background: transparent",items:[{xtype:"form",border:false,frame:false,defaults:{width:360,labelWidth:70,labelPad:10,labelAlign:"top",border:false,frame:false},items:[{name:"frecuentQuestions",cls:"frequentQuestions",tpl:'<div class="title">'+translate("frequentlyAskedQuestions",true)+"</div>\n                        {questions}"},{name:"telephone-button",cls:"telephone-button",height:85,margin:"10 0 0 0",tpl:'<div class="phone-message">\n                        <div class="phone-message-icon">\n                            <svg class="icon large light"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#phone"></use></svg>\n                        </div>\n                        <p>'+translate("IfYouWantToReceiveACallFillTheFormOutAndOurSupportSuperheroesWillCallYouSoonDuringBusinessHours",true)+".</p>\n                    </div>"},{margin:"10 0 0 0",defaults:{width:350,labelWidth:70,labelPad:10,labelAlign:"top",border:false,frame:false},items:[{html:translate("howCanWeHelpYou",true),cls:"frequentQuestionsTitle"},{xtype:"textfield",fieldLabel:translate("question",true),name:"subject",allowBlank:false,emptyText:translate("briefDescription",true),blankText:translate("itIsNecessaryToWriteAQuestion",true),style:"margin-bottom: 10px;"},{xtype:"textarea",fieldLabel:translate("details",true),name:"description",allowBlank:false,emptyText:translate("tellUsALittleMoreToGiveYouAFasterResponseWithTheSpecializedTeam",true),blankText:translate("itIsNecessaryToWriteADescriptionToGiveYouAFasterResponseWithTheSpecializedTeam",true),style:"margin-bottom: 10px;"},{xtype:"textfield",fieldLabel:translate("yourName",true),name:"name",allowBlank:false,blankText:translate("itIsNecessaryToWriteYourName",true),style:"margin-bottom: 10px;"},{xtype:"button",width:80,text:translate("send",true),action:"create-ticket",style:"float : right; padding: 8px; height: 32px;",cls:"sm-button-primary"}]}]}]});Ext.define("AL.model.TaxReference",{extend:"Ext.data.Model",fields:["id","name","keyTaxReference"]});Ext.define("AL.view.tax.GridAll",{extend:"Ext.grid.Panel",alias:"widget.tax_GridAllTaxes",title:"Impuestos",scroll:true,minHeight:390,width:1024,border:true,frame:true,columnLines:true,cls:"grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("tax")})+'</div><div class="button-wrapper"><a href="/tax/add" class="button green"><span class="plus"></span>'+translate("newTax",true)+"</a></div></div></div>",getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""}},initComponent:function(){this.store=Ext.create("AL.store.Taxes",{autoLoad:true,proxy:{url:"/tax/retrieve-all/format/json/editable/yes/deletable/yes/includeInactive/true",type:"ajax",reader:{type:"json",root:"results"}}});this.columns=[{header:translate("name",true),dataIndex:"name",flex:1},{header:translate("percentage",true)+" (%)",dataIndex:"tax",flex:1},{header:translate("type",true),dataIndex:"taxReference",type:"taxType",flex:1},{header:translate("deductibleTax",true),dataIndex:"deductible",renderer:this.renderDeductible,flex:1,hidden:this.configs.multipleTaxes=="yes"?false:true},{header:translate("description",true),dataIndex:"description",flex:3},{header:translate("actions",true),align:"center",type:"taxActions",renderer:this.setActions,width:80}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.get("editable")){b+='<a title="'+translate("edit",true)+'" href="/tax/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img title="'+translate("edit",true)+'" src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("status")==="active"){b+='<a title="'+translate("deactivate",true)+'" href=""><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleTaxStatus inactiveTax" /></a>'}else{if(c.get("status")==="inactive"){b+='<a title="'+translate("activate",true)+'" href=""><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleTaxStatus activeTax" /></a>'}else{b+='<img title="'+translate("activate",true)+'"  src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("activate",true)+'" class="disabled" />'}}if(c.get("deletable")){b+='<a title="'+translate("remove",true)+'" href="/tax/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteTax"/></a>'}else{b+='<img title="'+translate("remove",true)+'" src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderDeductible:function(f,g,b,h,d,c,a){var e=translate("no",true);if(f=="yes"){e=translate("yes",true)}return e}});Ext.define("AL.view.tax.AdvancedSettingsForm",{extend:"Ext.form.Panel",alias:"widget.tax_AdvancedSettingsForm",border:false,width:600,bodyStyle:"background-color:transparent;",items:[{xtype:"checkboxfield",name:"multipletaxes",inputValue:"yes",fieldLabel:"Activar múltiples impuestos sobre items/"+translate("categories"),labelWidth:370,tooltip:"Activa esta opción si deseas seleccionar multiples impuestos sobre un item en tus documentos",}],buttons:[{text:"Guardar",action:"save",margin:"0 28 0 0",formBind:true,cls:"sm-button-primary",height:38,width:157}],initComponent:function(){this.items[0].fieldLabel=translate("advancedSettingsActivateTaxesForItemsAndCategories",false,{categories:false});this.items[0].tooltip=translate("advancedSettingsTaxesNotice");this.buttons[0].text=translate("save",true);this.callParent(arguments)}});Ext.define("AL.store.TaxReferences",{extend:"Ext.data.Store",model:"AL.model.TaxReference",autoLoad:false,data:[],proxy:{type:"ajax",url:"/tax/retrieve-tax-references/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.TaxCategoriesFavorableCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",autoLoad:false,proxy:{type:"cacheajax",url:"/category/retrieve-tax-categories-for-combo/format/json/favorable/yes",cacheName:"TaxCategoriesFavorableCombo",reader:{type:"json",root:"results"}}});Ext.define("AL.store.TaxCategoriesToBePaidCombo",{extend:"Ext.data.Store",requires:["AL.proxy.CacheAjax"],model:"AL.model.CategoryCombo",autoLoad:false,proxy:{type:"cacheajax",url:"/category/retrieve-tax-categories-for-combo/format/json/favorable/no",cacheName:"TaxCategoriesToBePaidCombo",reader:{type:"json",root:"results"}}});Ext.define("AL.store.RateTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/rateTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.term.FormAdd",{extend:"Ext.form.Panel",alias:"widget.term_FormAdd",title:"Agregar Término",bodyPadding:30,width:450,defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",width:300,labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[{fieldLabel:translate("name",true),name:"name",allowBlank:false},{fieldLabel:translate("days",true),name:"days",regex:/^[1-9]([0-9]+)?$/,regexText:translate("theValueInThisFieldMustBeAnInteger",true),allowBlank:false}]});Ext.define("AL.view.term.GridAll",{extend:"Ext.grid.Panel",alias:"widget.term_GridAllTerms",title:"Términos",scroll:true,minHeight:390,width:1024,border:true,frame:true,columnLines:true,viewConfig:{stripeRows:true},store:"Terms",initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",flex:1},{header:translate("days",true),dataIndex:"days",flex:1},{header:translate("actions",true),align:"center",type:"termActions",renderer:this.setActions,width:150,sortable:false}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(a!=0){if(c.get("editable")){b+='<a href="/term/edit/id/'+a+'" title="'+translate("edit",true)+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteTerm" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}}b+="</div>";return b}});Ext.define("AL.view.common.FormAddInvoice",{extend:"Ext.form.Panel",alias:"widget.common_FormAddInvoice",border:false,style:"border-bottom: 1px solid #eee; padding-top: 5px;",bodyPadding:5,anchor:100,layout:"hbox",defaults:{anchor:"100%",msgTarget:"side"},height:50,defaultType:"textfield",items:[{xtype:"combo",name:"number",triggerAction:"all",allowBlank:false,emptyText:translate("invoice",true),store:"",displayField:"invoiceNumber",valueField:"idLocal",queryMode:"local",width:140,style:"margin-right: 10px",matchFieldWidth:false,blankText:translate("theitIsNecessaryToSelectTheInvoiceToBeAssociatedInvoice"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">','{invoiceNumber} <tpl if="values.electronicInvoicingVersion">('+translate("version",true)+" {electronicInvoicingVersion})</tpl>","</tpl>"),listConfig:{width:200,height:200},editable:false,listeners:{afterrender:function(b){var a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(a&&a.configs.country==="costaRica"){b.blankText="Es necesario seleccionar un comprobante"}}}},{xtype:"displayfield",name:"date",width:80},{xtype:"displayfield",name:"dueDate",width:80},{xtype:"displayfield",name:"observations",width:150,height:40,style:"font-size: 11px;"},{xtype:"displayfield",name:"total",width:100},{xtype:"displayfield",name:"totalPayed",width:100},{xtype:"displayfield",name:"missingAmount",width:100},{xtype:"textfield",name:"amount",allowBlank:false,width:130,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),disabled:true,blankText:translate("itIsNecessaryToFixTheAmountToBePaid",true),listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.el,trackMouse:true,html:a.notAllowedText,listeners:{beforeshow:function b(c){if(!a.isDisabled()||!a.notAllowedText){return false}c.update(a.notAllowedText)}}})}}},{xtype:"button",action:"deleteInvoice",width:16,height:16,style:"margin-left: 20px",baseCls:"none"}]});Ext.define("AL.view.transaction.FormAddRetention",{extend:"Ext.form.Panel",alias:"widget.transaction_FormAddRetention",border:false,cls:"form-add-retention-component",layout:"hbox",defaults:{blankText:translate("thisFieldIsRequired",true),msgTarget:"side",labelAlign:"right",labelPad:10},canCreateNewRetention:"no",defaultType:"textfield",items:[{xtype:"combo",name:"idRetention",cls:"retention-combo-component",displayField:"name",valueField:"idLocal",matchFieldWidth:false,queryMode:"local",typeAhead:true,store:"Retentions",width:170,emptyText:translate("retentionType",true),editable:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>',width:250},listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.width=105}},afterrender:function(){if(!this.getStore().hasLoaded()){this.getStore().load()}}}},{name:"base",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),style:"margin-right: 10px",width:75,emptyText:"Base",hidden:true,disabled:true,listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.disabled=false;b.hidden=false}},change:function(d,e){var c=d.up("form");if(c.allowBase&&c.allowBase===true&&d.isValid()){var h=c.down("[name=idRetention]");var a=h.getSelectedRecord();if(a){var g=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var f=c.down("[name=amount]");var b=AL.math.approx(AL.math.mul(e,AL.math.div(a.get("percentage"),100)),null,g.decimalPrecision);f.setValue(b)}}}}},{name:"amount",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),style:"margin-right: 10px",width:100,emptyText:translate("valueRetained",true),listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.width=75;b.readOnly=true;b.fieldStyle="opacity: 0.5;"}}}},{xtype:"button",action:"deleteRetention",height:16,width:16,baseCls:"none",listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.style="margin-top: 2px;"}}}}]});Ext.define("AL.view.transaction.TransactionInQuestion",{extend:"Ext.form.Panel",alias:"widget.transaction_TransactionInQuestion",bodyPadding:25,cls:"transaction-in-question-component",items:[{xtype:"box",cls:"question-box",html:['<div class="question-text">'+translate("doYouWantToAssociateThisIncomeWithAnExistingSalesInvoiceInAlegra",true)+"</div>",'<div class="question-explanation">'+translate("rememberThatYouCanRegisterAnIncomeWithoutItBeingAssociatedWith",true)+" "+translate("aSalesInvoice")+" "+translate("invoice")+'</div><div class="tooltip-wrapper" style="margin-left: 205px;margin-top:3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><strong>'+translate("yesAcute",true)+".</strong> "+translate("toCancelOrPaySalesInvoices")+"<br> <strong>"+translate("no",true)+".</strong> "+translate("toRecordIncome")+"</div></div></div></div>"].join("")},{xtype:"radiogroup",defaultType:"radiofield",width:160,cls:"answer-options",allowBlank:false,defaults:{flex:1},layout:{type:"hbox"},items:[{boxLabel:translate("yesAcute",true),name:"associateTo",inputValue:"invoice",labelSeparator:""},{boxLabel:translate("no",true),name:"associateTo",inputValue:"category"}]}]});Ext.define("AL.view.transaction.TransactionOutQuestion",{extend:"Ext.form.Panel",alias:"widget.transaction_TransactionOutQuestion",bodyPadding:25,cls:"transaction-out-question-component",items:[{xtype:"box",cls:"question-box",html:['<div class="question-text">'+translate("doYouWantToAssociateThisExpenseWithAnExistingSupplierInvoiceInAlegra",true)+"</div>",'<div class="question-explanation">'+translate("rememberThatYouCanRegisterAnExpenseWithoutItBeingAssociatedWith",true)+" "+translate("aBill")+" "+translate("bill")+"</div> ",'<div class="tooltip-wrapper" style="margin-left: 220px;margin-top:3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><strong>'+translate("yes",true)+"</strong> "+translate("toCancelOrPaySupplierInvoices")+"<br> <strong>"+translate("no",true)+"</strong> "+translate("toRecordExpense")+"</div></div></div></div>"].join(""),},{xtype:"radiogroup",defaultType:"radiofield",width:160,cls:"answer-options",allowBlank:false,defaults:{flex:1},layout:{type:"hbox"},items:[{boxLabel:translate("yes",true),name:"associateTo",inputValue:"bill",labelSeparator:""},{boxLabel:translate("no",true),name:"associateTo",inputValue:"category"}]}]});Ext.define("AL.view.transaction.FormAddBill",{extend:"Ext.form.Panel",alias:"widget.transaction_FormAddBill",requires:["AL.view.retention.PanelForApplyRetentions"],hideMode:"display",border:false,style:"border-bottom: 1px solid #eee;",bodyPadding:8,anchor:100,layout:{type:"hbox"},defaults:{anchor:"100%",msgTarget:"side"},defaultType:"textfield",items:[{xtype:"hidden",name:"idBill"},{xtype:"displayfield",name:"billNumber",width:130,style:"margin-left: 10px",renderer:function(b,c){var a=c.up("form");return'<a class="transaction-invoice-link" target="_blank" href="/bill/view/id/'+a.idBill+'">'+b+"</a>"}},{xtype:"displayfield",name:"total",width:100},{xtype:"displayfield",name:"totalPayed",fieldStyle:"color: #64A574;",width:100},{xtype:"displayfield",name:"missingAmount",fieldStyle:"color: #B83F3F",width:100},{xtype:"container",title:translate("retentions",true),name:"retentionPanel",items:[{xtype:"container",width:350,items:[]},{xtype:"button",baseCls:"none-add-retention-button",height:18,name:"addRetention",text:"Agregar "+translate("retention"),style:"float: left; margin-left: 10px;",listeners:{click:function(e){var b=e.up("container");var c=b.down("container");var g=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var h=e.up("transaction_FormAddBill");var d={type:"bill",canCreateNewRetention:g.configs.canCreateNewRetention,};if(g.configs.country=="colombia"){d.allowBase=true}var a=Ext.create("AL.view.transaction.FormAddRetention",d);if(d.allowBase&&d.allowBase===true){var f=a.down("[name=base]");f.setValue(AL.math.approx(h.billSubTotal,null,h.billDecimalPrecision))}a.on("beforerender",function(){var j=this.down("combo");j.setWidth(150)});c.add(a)}}},{xtype:"button",name:"viewRetentionsApplied",baseCls:"no-style",height:18,text:"Ver "+translate("retentions")+" aplicadas",style:"float: left; margin-left: 10px;",listeners:{click:function(a){var b=a.up("transaction_FormAddBill");var c=b.bill;window.open("/bill/edit-retentions/id/"+c.idLocal)}},hidden:true}]},{xtype:"panelForApplyRetentionsComponent",name:"panelForApplyRetentions",width:353,countries:["argentina"],hidden:true,border:false,configs:{formWithConfigs:{alias:"transaction_FormTransaction"},callbackForUpdateTotal:function(a,b){var f=b.up("form");var d=f.bill;var h=f.down(" > textfield[name=amount]");if(h.calculateFromRetentions){var c=0;Ext.each(a,function(k){var j=AL.math.approx(k.amount,null,d.decimalPrecision);c=AL.math.add(c,j)});var g=f.missingAmount;var e=AL.math.sub(g,c);if(AL.math.comp(e,0)>0){h.setValue(AL.math.approx(e,null,d.decimalPrecision))}}}}},{xtype:"textfield",name:"amount",width:130,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",style:"margin-left: 18px",enableKeyEvents:true,calculateFromRetentions:true},],updateButtonAdvancesApplied:function(b){var c=this.down("button[name=applyAdvances]");var e=c.up("form");var a="apply-advances-button";var d="check-apply-advances-button";if(b){d=a;a="check-apply-advances-button"}c.removeCls(a);c.addCls(a)}});Ext.define("AL.view.displayPanel.TotalSummaryBoard",{extend:"Ext.panel.Panel",alias:"widget.displayPanel_TotalSummaryBoard",cls:"total-summary-board",width:400,bodyPadding:30,items:[],addItem:function(b){if(!b.type){b.type="money"}var c="";if(b.cls){c=b.cls}var a=Ext.create("Ext.form.field.Display",{fieldLabel:b.label,labelPad:20,labelWidth:150,labelAlign:"right",currencySign:b.currencySign?b.currencySign:null,decimalPrecision:b.decimalPrecision?b.decimalPrecision:null,value:(b.type==="money")?Ext.util.Format.usMoney(b.value,b.decimalPrecision,b.currencySign):b.value,cls:((b.important)?"important ":"")+c,selector:b.label,name:"containerTotal"});if(b.id){a.id=b.id}this.add(a)},addItems:function(a){Ext.each(a,function(b){this.addItem(b)},this)},removeItem:function(a){var b=this.down("displayfield[selector="+a+"]");if(b){this.remove(b)}},removeItems:function(a){Ext.each(a,function(b){this.removeItem(b)},this)}});Ext.define("AL.view.transaction.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.transaction_MoreActionsButton",text:translate("moreActions",true),cls:"button2 sm-button-basic filling",height:38,padding:"6 5",handler:function(){this.showMenu()},initComponent:function(){if(this.country=="mexico"&&this.status=="void"&&this.hasStamp&&this.substitutionPending==true){this.menu.items.push({text:"Sustituir",href:"/transaction/in/idTransaction/"+this.idType+"/mxReplace/true"});this.menu.items.push("-")}this.menu.items.push({text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile"});if(this.country==="republicaDominicana"&&this.canAddVoidCause){this.menu.items.push({text:"Agregar motivo de "+translate("cancelation"),href:"#",action:"addVoidCause"})}if(this.withAdvancesApplied){this.menu.items.push({text:"Editar "+translate("advances")+" aplicados",id:"editAdvancesApplied",action:"editAdvancesApplied"})}this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.model.User",{extend:"Ext.data.Model",fields:["idLocal","name","lastName","email","password","type","status","role","isAccountant","hasInvitationKey","isDisableable"]});Ext.define("AL.view.user.FormAdd",{extend:"Ext.form.Panel",alias:"widget.user_FormAdd",canShowCategoriesCode:"no",width:550,bodyPadding:35,defaults:{labelAlign:"right",labelPad:15,labelWidth:170,width:400,msgTarget:"side"},defaultType:"textfield",items:[{fieldLabel:translate("name",true),name:"name",allowBlank:false,},{fieldLabel:translate("lastName",true),name:"lastName",allowBlank:false,},{fieldLabel:translate("electronicEmail",true),name:"email",allowBlank:false,regex:/^[A-Za-z0-9!#$%&'*+-/=?^_`{|}~]+@[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?(.[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?)*$/i,regexText:translate("youMustEnterAValidEmailAccount",true)},{xtype:"combo",fieldLabel:translate("rolePosition",true),name:"position",allowBlank:false,forceSelection:true,editable:false,store:"UsersPositions",displayField:"position",valueField:"id"},{xtype:"combo",fieldLabel:translate("language",true),name:"language",allowBlank:true,forceSelection:true,editable:false,store:"Languages",displayField:"value",valueField:"key",value:"es",hidden:true},{xtype:"combo",fieldLabel:translate("profile",true),name:"role",allowBlank:false,forceSelection:true,editable:false,store:Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"user",name:translate("limited",true)},{abbr:"admin",name:translate("admin",true)}]}),displayField:"name",valueField:"abbr"},],getFieldValuesAsMetadata:function(){var b=this.down("combo[name=position]");var a=null;if(b.getValue()!=""&&b.getValue()!==null){a={position:b.getValue().toUpperCase()}}return a},setFieldValuesFromMetadata:function(a){var b=this.down("combo[name=position]");if(a.position&&b){b.setValue(a.position.toLowerCase())}}});Ext.define("AL.view.user.FormEdit",{extend:"Ext.form.Panel",alias:"widget.user_FormEdit",canShowCategoriesCode:"no",bodyPadding:35,width:550,defaults:{labelWidth:170,labelPad:15,labelAlign:"right",width:400},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{fieldLabel:translate("name",true),name:"name",allowBlank:false,},{fieldLabel:translate("lastName",true),name:"lastName",allowBlank:false,},{fieldLabel:translate("email",true),name:"email",allowBlank:false,cls:"hidden-tooltip",regex:/^[A-Za-z0-9!#$%&'*+-/=?^_`{|}~]+@[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?(.[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?)*$/i,regexText:translate("youMustEnterAValidEmailAccount",true),tooltip:translate("theEmailOfTheUserAccountantIsAutomatic",true),},{xtype:"checkbox",name:"showCategoriesCode",fieldLabel:"Habilitar códigos de "+translate("categories"),inputValue:"yes",uncheckedValue:"no",hidden:true},{xtype:"combo",fieldLabel:translate("rolePosition",true),name:"position",allowBlank:false,forceSelection:true,editable:false,store:"UsersPositions",displayField:"position",valueField:"id"},{xtype:"combo",fieldLabel:translate("language",true),name:"language",allowBlank:true,forceSelection:true,editable:false,store:"Languages",displayField:"value",valueField:"key",value:"es",hidden:true,}],getFieldValuesAsMetadata:function(){var b=this.down("combo[name=position]");var a=null;if(b.getValue()!=""&&b.getValue()!==null){a={position:b.getValue().toUpperCase()}}return a},setFieldValuesFromMetadata:function(a){var b=this.down("combo[name=position]");if(a.position&&b){b.setValue(a.position.toLowerCase())}}});Ext.define("AL.view.user.FormPasswordChange",{extend:"Ext.window.Window",alias:"widget.user_FormPasswordChange",id:"window-change-password",title:translate("changePass",true),layout:"fit",autoShow:true,bodyPadding:30,modal:true,width:390,items:[{frame:true,xtype:"form",style:"background: transparent",bodyStyle:"background: transparent",defaults:{labelAlign:"right",labelWidth:180},items:[{xtype:"textfield",name:"currentPassword",fieldLabel:translate("currentPassword",true),allowBlank:false,inputType:"password"},{xtype:"textfield",name:"password",fieldLabel:translate("newPassword",true),allowBlank:false,inputType:"password"},{xtype:"textfield",name:"confirmPassword",fieldLabel:translate("confirmPassword",true),allowBlank:false,inputType:"password",vtype:"password"}],buttons:[{text:translate("save",true),action:"save",formBind:true,disabled:true},{text:translate("cancelAction",true),action:"close"}]},{xtype:"label",style:"position : initial",html:'<div class="required-anotation window">'+translate("requiredText",true)+"</div>"}],initComponent:function(){this.callParent(arguments)}});Ext.define("AL.view.user.FormPasswordChangeAdmin",{extend:"Ext.window.Window",alias:"widget.user_FormPasswordChangeAdmin",id:"window-change-password",title:translate("changePass",true),layout:"fit",autoShow:true,bodyPadding:30,modal:true,width:390,items:[{frame:true,xtype:"form",style:"background: transparent",bodyStyle:"background: transparent",defaults:{labelAlign:"right",labelWidth:180},items:[{xtype:"hidden",name:"idLocal"},{xtype:"textfield",name:"password",fieldLabel:translate("newPassword",true),allowBlank:false,inputType:"password"},{xtype:"textfield",name:"confirmPassword",fieldLabel:translate("confirmPassword",true),allowBlank:false,inputType:"password",vtype:"password"}],buttons:[{text:translate("save",true),action:"save",formBind:true,disabled:true},{text:translate("cancelAction",true),action:"close"}],},{xtype:"label",style:"position : initial",html:'<div class="required-anotation window">'+translate("requiredText",true)+"</div>"}],initComponent:function(){this.callParent(arguments)}});Ext.define("AL.view.user.FormEditAdmin",{extend:"Ext.form.Panel",alias:"widget.user_FormEditAdmin",canShowCategoriesCode:"no",bodyPadding:35,width:550,defaults:{labelWidth:170,labelPad:15,labelAlign:"right",width:400},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{fieldLabel:translate("name",true),name:"name",allowBlank:false,},{fieldLabel:translate("lastName",true),name:"lastName",allowBlank:false,},{fieldLabel:translate("email",true),name:"email",cls:"hidden-tooltip",allowBlank:false,blankText:"Este campo es obligatorio",regex:/^[A-Za-z0-9!#$%&'*+-/=?^_`{|}~]+@[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?(.[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?)*$/i,regexText:translate("youMustEnterAValidEmailAccount",true),tooltip:translate("theEmailOfTheUserAccountantIsAutomatic",true),},{xtype:"checkbox",name:"showCategoriesCode",fieldLabel:"Habilitar códigos de "+translate("categories"),inputValue:"yes",uncheckedValue:"no",hidden:true},{xtype:"combo",fieldLabel:translate("rolePosition",true),name:"position",allowBlank:false,forceSelection:true,editable:false,store:"UsersPositions",displayField:"position",valueField:"id"},{xtype:"combo",fieldLabel:translate("language",true),name:"language",allowBlank:true,forceSelection:true,editable:false,store:"Languages",displayField:"value",valueField:"key",value:"es",hidden:true},{xtype:"combo",fieldLabel:translate("profile",true),name:"role",allowBlank:false,store:Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"user",name:translate("limited",true)},{abbr:"admin",name:translate("admin",true)}]}),displayField:"name",valueField:"abbr"}],getFieldValuesAsMetadata:function(){var b=this.down("combo[name=position]");var a=null;if(b.getValue()!=""&&b.getValue()!==null){a={position:b.getValue().toUpperCase()}}return a},setFieldValuesFromMetadata:function(a){var b=this.down("combo[name=position]");if(a.position&&b){b.setValue(a.position.toLowerCase())}}});Ext.define("AL.view.user.FormPermissions",{extend:"Ext.form.Panel",alias:"widget.user_FormPermissions",bodyPadding:35,defaults:{width:400},title:translate("permissions",true),listeners:{beforerender:function(b){if(b.keyCountry){switch(b.keyCountry){case"colombia":var a=b.down("fieldset[name=exogenous]");a.show();break}}}},items:[{xtype:"fieldset",title:"General",defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("canSeeBusinessCost",true),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"allow__userviewcosts",dependencies:["bill__edit","bill__view","bill__add","bill__index","bill__delete","client__view","report__inventory","report__optimizedprofitandloss"]},{fieldLabel:translate("viewOperationHistory",true),name:"history__index"},{fieldLabel:translate("viewGraphsAndTablesOnTheHomePage",true),name:"report__viewdashboardinfo"}]},{xtype:"fieldset",title:translate("estimates",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"estimate__add"},{fieldLabel:translate("edit",true)+" "+translate("discount")+"",name:"estimate__edit_discount"},{xtype:"label",text:translate("maximumPercentageDiscountAllowed",true,{discount:false}),name:"label_discount_estimate",style:"float: left; margin-top: 3px; margin-left: 42px; "},{xtype:"numberfield",name:"discount_estimate",style:"float:right; margin-right:90px;",width:50,minValue:0,maxValue:100,maxLength:3,enforceMaxLength:true,allowDecimals:false,value:100},{fieldLabel:translate("editItemPricesInDocuments",true,{salesItems:false,documents:translate("estimates")}),name:"estimate__edit_items_prices"},{fieldLabel:translate("edit",true),name:"estimate__edit"},{fieldLabel:translate("seeDetail",true),name:"estimate__view"},{fieldLabel:translate("seeList",true),name:"estimate__index"},{fieldLabel:translate("delete",true),name:"estimate__delete"},]},{xtype:"fieldset",title:translate("banks",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"account__add"},{fieldLabel:translate("edit",true),name:"account__edit"},{fieldLabel:translate("delete",true),name:"account__delete"},{fieldLabel:translate("reconcile",true),name:"conciliation__index"},{fieldLabel:translate("seeList",true),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"account__index"},{fieldLabel:translate("seeDetail",true),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"account__view"},{fieldLabel:translate("delete",true)+" "+translate("reconciliation"),name:"conciliation__delete"},]},{xtype:"fieldset",title:translate("supplierInvoices",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("seeDetail",true),name:"bill__view"},{fieldLabel:translate("seeList",true),name:"bill__index"},{fieldLabel:translate("add",true),name:"bill__add"},{fieldLabel:translate("edit",true),name:"bill__edit"},{fieldLabel:translate("delete",true),name:"bill__delete"},{fieldLabel:translate("export",true),name:"exportable__bills"}]},{xtype:"fieldset",title:translate("contacts",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("seeListOf",true)+" "+translate("all"),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"client__index",config:{fireChange:true},listeners:{change:function(c,d,a){if(!this.config.fireChange){this.config.fireChange=true;return}var b=c.up().down('checkbox[name="client__viewclients"]');var e=c.up().down('checkbox[name="client__viewproviders"]');if(d){b.setReadOnly(true);e.setReadOnly(true);b.addCls("x-item-disabled");e.addCls("x-item-disabled");b.setValue(true);e.setValue(true)}else{b.setReadOnly(false);e.setReadOnly(false);b.removeCls("x-item-disabled");e.removeCls("x-item-disabled");b.setValue(false);e.setValue(false)}}}},{fieldLabel:translate("seeListOf",true)+" "+translate("clientAP"),name:"client__viewclients"},{fieldLabel:translate("seeListOf",true)+" "+translate("suppliers"),name:"client__viewproviders"},{fieldLabel:translate("seeDetail",true),name:"client__view"},{fieldLabel:translate("add",true),name:"client__add"},{fieldLabel:translate("edit",true),name:"client__edit"},{fieldLabel:translate("delete",true),name:"client__delete"},{fieldLabel:translate("export",true),name:"exportable__clients"},{fieldLabel:translate("import",true),name:"client__import"}]},{xtype:"fieldset",title:translate("company",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("edit",true),name:"company__edit"},{fieldLabel:translate("editGeneralInformation",true),name:"company__editmandatory"}]},{xtype:"fieldset",title:translate("companyConfiguration",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("manageMulticurrency",true),name:"currency__index"},{fieldLabel:"Gestionar centro de costos",name:"costcenter__index"},]},{xtype:"fieldset",title:translate("creditNote",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"creditnote__add"},{fieldLabel:translate("edit",true),name:"creditnote__edit"},{fieldLabel:translate("delete",true),name:"creditnote__delete"},{fieldLabel:translate("export",true),name:"exportable__creditnotes"},{fieldLabel:translate("seeList",true),name:"creditnote__index"},{fieldLabel:translate("seeDetail",true),name:"creditnote__view"}]},{xtype:"fieldset",title:translate("invoices",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"invoice__add"},{fieldLabel:translate("edit",true)+" "+translate("discount")+"",name:"invoice__edit_discount"},{xtype:"label",text:translate("maximumPercentageDiscountAllowed",true,{discount:false}),name:"label_discount_invoice",style:"float: left; margin-top: 3px; margin-left: 42px; "},{xtype:"numberfield",name:"discount_invoice",style:"float:right; margin-right:90px;",width:50,minValue:0,maxValue:100,maxLength:3,enforceMaxLength:true,allowDecimals:false,value:100,},{fieldLabel:translate("editItemPricesInDocuments",true,{salesItems:false,documents:translate("invoices")}),name:"invoice__edit_items_prices"},{fieldLabel:translate("edit",true)+" "+translate("draftSalesInvoice",false,{invoices:false}),name:"invoice_draft__edit"},{fieldLabel:translate("edit",true)+" "+translate("openSalesInvoice",false,{invoices:false}),name:"invoice_open__edit"},{fieldLabel:translate("delete",true),name:"invoice__delete"},{fieldLabel:translate("cancel",true),name:"invoice__void"},{fieldLabel:translate("makeRecurring",true),name:"invoice__makerecurring"},{fieldLabel:translate("export",true),name:"exportable__invoices"},{fieldLabel:translate("seeList",true),name:"invoice__index"},{fieldLabel:translate("seeDetail",true),tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true}),name:"invoice__view"}]},{xtype:"fieldset",title:translate("billingSettings",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("manage",true)+" "+translate("paymentTerms"),name:"term__index"},{fieldLabel:translate("manage",true)+" "+translate("numerations"),name:"resolution__index"},{fieldLabel:translate("edit",true)+" "+translate("generalBillingInformation"),name:"company__editinvoiceinfo"},{fieldLabel:translate("edit",true)+" "+translate("printingTemplates"),name:"company__editinvoicetemplate"}]},{xtype:"fieldset",title:translate("sellers",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("addAction",true),name:"seller__add"},{fieldLabel:translate("edit",true),name:"seller__edit"},{fieldLabel:translate("delete",true),name:"seller__delete"},{fieldLabel:translate("activate",true)+"/"+translate("deactivate",true),name:"seller__changestatus"}]},{xtype:"fieldset",title:translate("inventory",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true)+" "+translate("item"),name:"item__add"},{fieldLabel:translate("edit",true)+" "+translate("item"),name:"item__edit"},{fieldLabel:translate("delete",true)+" "+translate("item"),name:"item__delete"},{fieldLabel:translate("add",true)+" "+translate("inventoryAdjustment",false,{inventory:false}),name:"inventoryadjustment__add"},{fieldLabel:translate("edit",true)+" "+translate("inventoryAdjustment",false,{inventory:false}),name:"inventoryadjustment__edit"},{fieldLabel:translate("delete",true)+" "+translate("inventoryAdjustment",false,{inventory:false}),name:"inventoryadjustment__delete"},{fieldLabel:translate("seeListOf",true)+" "+translate("inventoryAdjustments",false,{inventory:false}),name:"inventoryadjustment__index"},{fieldLabel:translate("export",true)+" "+translate("items"),name:"exportable__items"},{fieldLabel:translate("import",true)+" "+translate("items"),name:"item__import"},{fieldLabel:translate("bulkEdit",true),name:"item__bulkedit"},]},{xtype:"fieldset",title:translate("warehouses",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("addAction",true),name:"warehouse__add"},{fieldLabel:translate("edit",true),name:"warehouse__edit"},{fieldLabel:translate("delete",true),name:"warehouse__delete"}]},{xtype:"fieldset",title:translate("warehouseTransfers",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("seeDetail",true),name:"warehouse__viewtransfer"},{fieldLabel:translate("seeList",true),name:"warehouse__indextransfer"},{fieldLabel:translate("addAction",true),name:"warehouse__addtransfer"},{fieldLabel:translate("edit",true),name:"warehouse__edittransfer"},{fieldLabel:translate("delete",true),name:"warehouse__deletetransfer"}]},{xtype:"fieldset",title:translate("recurringInvoices",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"recurringinvoice__add"},{fieldLabel:translate("edit",true),name:"recurringinvoice__edit"},{fieldLabel:translate("delete",true),name:"recurringinvoice__delete"},{fieldLabel:translate("seeDetail",true),name:"recurringinvoice__view"},{fieldLabel:translate("seeList",true),name:"recurringinvoice__index"},]},{xtype:"fieldset",title:translate("recurringPayments",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"recurringpayment__add"},{fieldLabel:translate("edit",true),name:"recurringpayment__edit"},{fieldLabel:translate("delete",true),name:"recurringpayment__delete"},{fieldLabel:translate("seeDetail",true),name:"recurringpayment__view"},{fieldLabel:translate("seeList",true),name:"recurringpayment__index"}]},{xtype:"fieldset",title:"Información exógena",defaultType:"checkbox",name:"exogenous",hidden:true,defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("setUp",true)+" "+translate("reports"),name:"report__editexogenousreportcategories"},{fieldLabel:translate("export",true)+" "+translate("reports"),name:"report__exogenous"}]},{xtype:"fieldset",title:translate("salesReports",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("see",true)+" "+translate("sales"),name:"report__sales"},{fieldLabel:translate("see",true)+" "+translate("salesPerItem"),name:"report__salesbyitem"},{fieldLabel:translate("see",true)+" "+translate("salesPerClient"),name:"report__salesbyclient"},{fieldLabel:translate("see",true)+" "+translate("profitabilityPerItem"),name:"report__itemsprofit"},{fieldLabel:translate("see",true)+" "+translate("salesPerSeller"),name:"report__salesbyseller"},{fieldLabel:translate("see",true)+" "+translate("statement"),name:"report__clientstatement"},{fieldLabel:translate("export",true)+" "+translate("sales"),name:"exportable__sales"},{fieldLabel:translate("export",true)+" "+translate("salesPerItem"),name:"exportable__salesbyitem"},{fieldLabel:translate("export",true)+" "+translate("salesPerClient"),name:"exportable__salesbyclient"},{fieldLabel:translate("export",true)+" "+translate("profitabilityPerItem"),name:"exportable__itemsprofit"},{fieldLabel:translate("export",true)+" "+translate("salesPerSeller"),name:"exportable__salesbyseller"},]},{xtype:"fieldset",title:translate("administrativeReports",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("see",true)+" "+translate("invoicesOpen"),name:"report__invoicesopen"},{fieldLabel:translate("see",true)+" "+translate("billsOpen"),name:"report__billsopen"},{fieldLabel:translate("see",true)+" "+translate("incomes")+" "+translate("and")+" "+translate("expenses"),name:"report__optimizedincomeandexpense"},{fieldLabel:translate("see",true)+" "+translate("cashFlow"),name:"report__optimizedcashflow"},{fieldLabel:translate("see",true)+" "+translate("valuedInventory"),name:"report__inventory"},{fieldLabel:translate("see",true)+" "+translate("transactionsReport"),name:"report__transactions"},{fieldLabel:translate("export",true)+" "+translate("invoicesOpen"),name:"exportable__invoicesopen"},{fieldLabel:translate("export",true)+" "+translate("billsOpen"),name:"exportable__billsopen"},{fieldLabel:translate("export",true)+" "+translate("incomes")+" "+translate("and")+" "+translate("expenses"),name:"exportable__incomeandexpense"},{fieldLabel:translate("export",true)+" "+translate("cashFlow"),name:"exportable__cashflow"},{fieldLabel:translate("export",true)+" "+translate("valuedInventory"),name:"exportable__inventory"},]},{xtype:"fieldset",title:translate("accountingReports",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("see",true)+" "+translate("profitAndLoss"),name:"report__optimizedprofitandloss"},{fieldLabel:translate("see",true)+" "+translate("generalBalance"),name:"report__optimizedgeneralbalance"},{fieldLabel:translate("see",true)+" "+translate("dailySalesReport"),name:"exportable__dailysales"},{fieldLabel:translate("see",true)+" "+translate("taxes",true)+" "+translate("and")+" "+translate("retentions"),name:"report__taxesandretentions"},{fieldLabel:translate("see",true)+" "+translate("ledgerJournalCategoriesReport"),name:"report__ledgerjournalcategories"},{fieldLabel:translate("see",true)+" "+translate("ledgerJournalsReport"),name:"report__ledgerjournals"},{fieldLabel:translate("see",true)+" "+translate("subsidiaryLedgerByClientReport"),name:"report__subsidiaryledgerbyclient"},{fieldLabel:translate("see",true)+" "+translate("generalLedgerReport"),name:"report__generalledger"},{fieldLabel:translate("export",true)+" "+translate("profitAndLoss"),name:"exportable__profitandloss"},{fieldLabel:translate("export",true)+" "+translate("generalBalance"),name:"exportable__generalbalance"},{fieldLabel:translate("export",true)+" "+translate("taxes",true)+" "+translate("and")+" "+translate("retentions"),name:"exportable__taxesandretentions"},{fieldLabel:translate("export",true)+" "+translate("ledgerJournalCategoriesReport"),name:"exportable__ledgerjournalcategories"},{fieldLabel:translate("export",true)+" "+translate("ledgerJournalsReport"),name:"exportable__ledgerjournals"},{fieldLabel:translate("export",true)+" "+translate("subsidiaryLedgerByClientReport"),name:"exportable__subsidiaryledgerbyclient"},{fieldLabel:translate("export",true)+" "+translate("generalLedgerReport"),name:"exportable__generalledger"},{fieldLabel:translate("export",true)+" "+translate("salesDetail"),name:"exportable__salesdetail"},]},{xtype:"fieldset",title:translate("reportsToWork",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("export",true)+" "+translate("accountantReport"),name:"exportable__accountingreport"},]},{xtype:"fieldset",title:translate("retentions",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"retention__add"},{fieldLabel:translate("edit",true),name:"retention__edit"},{fieldLabel:translate("delete",true),name:"retention__delete"},{fieldLabel:translate("activate",true)+"/"+translate("deactivate",true),name:"retention__togglestatus"}]},{xtype:"fieldset",title:translate("taxes",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"tax__add"},{fieldLabel:translate("edit",true),name:"tax__edit"},{fieldLabel:translate("delete",true),name:"tax__delete"},{fieldLabel:translate("activate",true)+"/"+translate("deactivate",true),name:"tax__togglestatus"}]},{xtype:"fieldset",title:translate("transactions",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true)+" "+translate("transactionIn"),name:"transaction__in"},{fieldLabel:translate("add",true)+" "+translate("transactionOut"),name:"transaction__out"},{fieldLabel:translate("edit",true)+" "+translate("transactionIn"),name:"transaction__editin"},{fieldLabel:translate("edit",true)+" "+translate("transactionOut"),name:"transaction__editout"},{fieldLabel:translate("seeDetailOf",true)+" "+translate("expense"),name:"transaction__viewout"},{fieldLabel:translate("seeListOf",true)+" "+translate("expense"),name:"payment__index"},{fieldLabel:translate("delete",true),name:"transaction__delete"},{fieldLabel:translate("export",true),name:"exportable__transactions"},{fieldLabel:translate("seeListOf",true)+" "+translate("transactionsIn"),name:"transaction__retrievein"},{fieldLabel:translate("seeDetailOf",true)+" "+translate("transactionsIn"),name:"transaction__viewin"}]},{xtype:"fieldset",title:translate("priceLists",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"pricelist__add"},{fieldLabel:translate("edit",true),name:"pricelist__edit"},{fieldLabel:translate("seeDetail",true),name:"pricelist__view"},{fieldLabel:translate("delete",true),name:"pricelist__delete"},{fieldLabel:translate("seeList",true),name:"pricelist__index"},]},{xtype:"fieldset",title:translate("debitNotes",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"debitnote__add"},{fieldLabel:translate("edit",true),name:"debitnote__edit"},{fieldLabel:translate("delete",true),name:"debitnote__delete"},{fieldLabel:translate("seeDetail",true),name:"debitnote__view"},{fieldLabel:translate("seeList",true),name:"debitnote__index"}]},{xtype:"fieldset",title:translate("categories",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("seeList",true),name:"category__index",config:{fireChange:true},listeners:{change:function(e,f,b){if(!this.config.fireChange){this.config.fireChange=true;return}var a=e.up().down('checkbox[name="category__view"]');var g=e.up().down('checkbox[name="category__add"]');var d=e.up().down('checkbox[name="category__edit"]');var c=e.up().down('checkbox[name="category__delete"]');if(f){a.setReadOnly(false);g.setReadOnly(false);d.setReadOnly(false);c.setReadOnly(false);a.removeCls("x-item-disabled");g.removeCls("x-item-disabled");d.removeCls("x-item-disabled");c.removeCls("x-item-disabled");a.setValue(true);g.setValue(true);d.setValue(true);c.setValue(true)}else{a.setReadOnly(true);g.setReadOnly(true);d.setReadOnly(true);c.setReadOnly(true);a.addCls("x-item-disabled");g.addCls("x-item-disabled");d.addCls("x-item-disabled");c.addCls("x-item-disabled");a.setValue(false);g.setValue(false);d.setValue(false);c.setValue(false)}}}},{fieldLabel:translate("seeDetail",true),name:"category__view"},{fieldLabel:translate("add",true),name:"category__add"},{fieldLabel:translate("edit",true),name:"category__edit"},{fieldLabel:translate("delete",true),name:"category__delete"}]},{xtype:"fieldset",title:translate("journals",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("seeList",true),name:"journal__index",config:{fireChange:true},listeners:{change:function(f,g,c){if(!this.config.fireChange){this.config.fireChange=true;return}var d=f.up().down('checkbox[name="journal__view"]');var b=f.up().down('checkbox[name="journal__add"]');var e=f.up().down('checkbox[name="journal__edit"]');var a=f.up().down('checkbox[name="journal__delete"]');if(g){d.setReadOnly(false);b.setReadOnly(false);e.setReadOnly(false);a.setReadOnly(false);d.removeCls("x-item-disabled");b.removeCls("x-item-disabled");e.removeCls("x-item-disabled");a.removeCls("x-item-disabled");d.setValue(true);b.setValue(true);e.setValue(true);a.setValue(true)}else{d.setReadOnly(true);b.setReadOnly(true);e.setReadOnly(true);a.setReadOnly(true);d.addCls("x-item-disabled");b.addCls("x-item-disabled");e.addCls("x-item-disabled");a.addCls("x-item-disabled");d.setValue(false);b.setValue(false);e.setValue(false);a.setValue(false)}}}},{fieldLabel:translate("seeDetail",true),name:"journal__view"},{fieldLabel:translate("add",true),name:"journal__add"},{fieldLabel:translate("edit",true),name:"journal__edit"},{fieldLabel:translate("delete",true),name:"journal__delete"}]},{xtype:"fieldset",title:translate("attachedFiles",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("delete",true),name:"file__delete"}]},{xtype:"fieldset",title:translate("remissions",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"remission__add"},{fieldLabel:translate("edit",true)+" "+translate("discount")+"",name:"remission__edit_discount"},{xtype:"label",text:translate("maximumPercentageDiscountAllowed",true,{discount:false}),name:"label_discount_remission",style:"float: left; margin-top: 3px; margin-left: 42px; "},{xtype:"numberfield",name:"discount_remission",style:"float:right; margin-right:90px;",width:50,minValue:0,maxValue:100,maxLength:3,enforceMaxLength:true,allowDecimals:false,value:100,},{fieldLabel:translate("editItemPricesInDocuments",true,{salesItems:false,documents:translate("remissions")}),name:"remission__edit_items_prices"},{fieldLabel:translate("edit",true),name:"remission__edit"},{fieldLabel:translate("delete",true),name:"remission__delete"},{fieldLabel:translate("export",true),name:"remission__export"},{fieldLabel:translate("seeDetail",true),name:"remission__view"},{fieldLabel:translate("seeList",true),name:"remission__index"}]},{xtype:"fieldset",title:translate("purchaseOrders",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"purchaseorder__add"},{fieldLabel:translate("edit",true),name:"purchaseorder__edit"},{fieldLabel:translate("delete",true),name:"purchaseorder__delete"},{fieldLabel:translate("export",true),name:"exportable__purchaseorder"},{fieldLabel:translate("seeDetail",true),name:"purchaseorder__view"},{fieldLabel:translate("seeList",true),name:"purchaseorder__index"}]},{xtype:"fieldset",title:translate("pointOfSale",true)+" ("+translate("pointOfSaleAcronym")+")",defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{xtype:"fieldset",title:translate("shifts",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("open",true)+" "+translate("shiftShort"),name:"poscashier__open"},{fieldLabel:translate("close",true)+" "+translate("shiftShort"),name:"poscashier__close"},{fieldLabel:translate("seeDetail",true),name:"poscashier__view"},{fieldLabel:translate("seeList",true),name:"poscashier__index"}]},{xtype:"fieldset",title:translate("stations",true),defaultType:"checkbox",defaults:{checked:true,inputValue:"allow",labelWidth:280,labelAlign:"right",labelPad:15},items:[{fieldLabel:translate("add",true),name:"posstation__add"},{fieldLabel:translate("edit",true),name:"posstation__edit"},{fieldLabel:translate("seeDetail",true),name:"posstation__view",tooltip:translate("ifTheUserUsesThePosHeNeedsToHaveThisPermissionActive",true,{pointOfSaleAcronym:true})},{fieldLabel:translate("seeList",true),name:"posstation__index"},{fieldLabel:translate("delete",true),name:"posstation__delete"}]}]}]});Ext.define("AL.view.user.FormUserNotifications",{extend:"Ext.form.Panel",alias:"widget.user_FormUserNotifications",bodyPadding:"0 35 35 35",role:null,border:false,frame:false,defaults:{labelWidth:150,labelPad:15,labelAlign:"right",width:400},defaultType:"textfield",items:[{xtype:"fieldset",cls:"notificationsFieldset",title:"Notificaciones para "+translate("invoices")+" próximas a vencerse",contains:"companyNotifications",hidden:true,width:730,msgTarge:"side",defaults:{labelWidth:390,labelAlign:"right",labelPad:20},items:[{xtype:"checkbox",name:"notificationInvoiceAlmostOverdueStatus",fieldLabel:"Activar notificaciones antes del vencimiento",inputValue:"yes",labelAlign:"right",value:false,padding:"10 0 0 0",listeners:{change:function(e,d,b){var c=e.up("form");var a=c.down("numberfield[name=notificationInvoiceAlmostOverdueDays]");if(d){a.enable()}else{a.disable()}}}},{xtype:"numberfield",name:"notificationInvoiceAlmostOverdueDays",fieldLabel:"Días antes",disabled:true,allowBlank:false,minValue:1,width:500,allowDecimals:false,value:7},{xtype:"button",name:"configureTemplate",emailType:"invoices-almost-overdue",text:"Editar correo",margin:"10 0 0 621"},{xtype:"container",name:"almostOverdue",items:[{xtype:"box",name:"almostOverdueInvoices",queryName:"invoices-almost-overdue",holds:"email-text-almost",cls:"notifications-email-preview"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:"Notificaciones para "+translate("invoices")+" que se vencen hoy",contains:"companyNotifications",hidden:true,width:730,margin:"40 0 0 0",msgTarge:"side",defaults:{labelWidth:390,labelAlign:"right",labelPad:20},items:[{xtype:"checkbox",name:"notificationInvoiceOverdueTodayStatus",fieldLabel:"El mismo día del vencimiento",inputValue:"yes",padding:"10 0 0 0",labelAlign:"right",value:false},{xtype:"button",name:"configureTemplate",emailType:"invoices-overdue-today",text:"Editar correo",margin:"10 0 0 621"},{xtype:"container",name:"overdueToday",items:[{xtype:"box",name:"overdueTodayInvoices",holds:"email-text-almost",cls:"notifications-email-preview",queryName:"invoices-overdue-today"}]}]},{xtype:"fieldset",cls:"notificationsFieldset",title:"Notificaciones para "+translate("invoices")+" vencidas",contains:"companyNotifications",margin:"40 0 0 0",hidden:true,width:730,msgTarge:"side",defaults:{labelWidth:390,labelAlign:"right",labelPad:20},items:[{xtype:"checkbox",name:"notificationInvoiceOverdueStatus",fieldLabel:"Después del vencimiento",inputValue:"yes",padding:"10 0 0 0",labelAlign:"right",value:false,listeners:{change:function(e,d,b){var c=e.up("form");var a=c.down("numberfield[name=notificationInvoiceOverdueDays]");if(d){a.enable()}else{a.disable()}}}},{xtype:"numberfield",name:"notificationInvoiceOverdueDays",fieldLabel:"Días después",allowBlank:false,minValue:1,disabled:true,width:500,allowDecimals:false,value:7},{xtype:"button",name:"configureTemplate",emailType:"invoices-overdue",text:"Editar correo",margin:"10 0 0 621"},{xtype:"container",name:"overdue",items:[{xtype:"box",name:"overdueInvoices",holds:"email-text-overdue",cls:"notifications-email-preview",queryName:"invoices-overdue"}]}]}],listeners:{render:function(b){if(b.role&&b.role==="admin"){var a=Ext.ComponentQuery.query("fieldset[contains=companyNotifications]");Ext.each(a,function(c){c.show()})}}}});Ext.define("AL.view.user.GridAll",{extend:"Ext.grid.Panel",alias:"widget.user_GridAll",title:"Usuarios",scroll:true,minHeight:390,width:1024,border:false,store:"Users",columnLines:true,cls:"grid-with-icons",viewConfig:{stripeRows:true,loadingText:translate("loading",true),emptyText:translate("noUsersAtThisTime",true)},dockedItems:[{xtype:"pagingtoolbar",store:"Users"}],listeners:{afterrender:function(b){var a=b.getStore();a.load()}},initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",renderer:this.link,width:200},{header:translate("lastName",true),dataIndex:"lastName",width:200,renderer:this.link},{header:translate("email",true),dataIndex:"email",flex:1,renderer:this.link},{header:translate("rolePosition",true),dataIndex:"role",width:100,renderer:this.renderRole},{header:translate("status",true),dataIndex:"status",width:130,renderer:this.renderStatus},{header:translate("actions",true),type:"actions",width:100,renderer:this.setActions}];this.callParent(arguments)},link:function(f,g,b,h,d,c,a){var e="";if(f){e='<a href="/user/view/id/'+b.get("idLocal")+'">'+f+"</a>"}return e},renderStatus:function(e,k,b,c,g,f,d){var a="";var j="";switch(e){case"active":var h=b.get("hasInvitationKey")=="yes"?" ("+translate("toBeConfirmed",true)+")":"";a=translate("active",true)+h;j="active";break;case"disabled":a=translate("disabled",true);j="disabled";break;default:break}return'<span class="'+j+'">'+a+"</span>"},renderRole:function(e,j,b,c,g,f,d){var a="";switch(e){case"admin":a=translate("admin",true);break;case"user":var h=b.get("isAccountant")?" ("+translate("accountant",true)+")":"";a=translate("limited",true)+h;break;default:break}return a},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/user/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" class="viewUserDetailAction" title="'+translate("seeDetail",true)+'"/></a>';switch(c.get("status")){case"active":b+='<a href="/user/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/user_edit.png" alt="'+translate("edit",true)+'" class="editUserAction" title="'+translate("edit",true)+'"/></a>';if(c.get("isDisableable")){b+='<a href="/user/disable/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/user_delete.png" alt="'+translate("disable",true)+'" class="disableUserAction" title="'+translate("disable",true)+'"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/user_delete.png" alt="'+translate("disable",true)+'" class="disabled" title="'+translate("disable",true)+'"/>'}break;case"disabled":b+='<img src="https://cdn1.getsoft.app/images/icons/user_edit.png" alt="'+translate("edit",true)+'" class="disabled" title="'+translate("edit",true)+'" />';b+='<a href="/user/enable/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/user.png" alt="'+translate("enable",true)+'" class="enableUserAction" title="'+translate("enable",true)+'"/></a>';break;default:break}b+='<a href="/user/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteUserAction" title="'+translate("remove",true)+'"/></a>';b+="</div>";return b}});Ext.define("AL.view.user.ApiInformationPanel",{extend:"Ext.panel.Panel",alias:"widget.user_ApiInformationPanel",frame:false,border:false,width:400,margin:"0 0 0 8",style:"background: #FFFFFF; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.1); border-radius: 5px;",items:[{xtype:"displayfield",fieldLabel:"Usuario:",name:"email",cls:"apiInformationLabel",margin:"20 0 15 53",},{xtype:"container",frame:false,border:false,layout:"hbox",margin:"0 0 15 53",items:[{xtype:"displayfield",fieldLabel:"Token:",name:"token",cls:"apiInformationLabel"},{xtype:"label",name:"token",width:150,hidden:true},{xtype:"button",name:"generateToken",text:"Obtener token",margin:"0 10 10 0",width:100,hidden:true},]},{xtype:"button",name:"regenerateToken",text:"Renovar token",margin:"10 0 15 144",width:100,hidden:true},{xtype:"label",html:'<hr style="border: 0; height: 1px; color: rgba(0,0,0,0.1); background-color: rgba(0,0,0,0.1);"><div class="required-anotation" style="position: initial; margin: 0px 20px 20px 20px; font-size: 11px !important;"><span class="req no-padding">*</span> {{apiTokenRefreshHint}}</div>',},],initComponent:function(){this.items[0].fieldLabel=translate("user",true)+":";this.items[1].items[0].fieldLabel=translate("token",true)+":";this.items[1].items[2].label=translate("getToken");this.items[2].text=translate("refreshToken");this.items[3].html=this.items[3].html.replace("{{apiTokenRefreshHint}}",translate("apiTokenRefreshHint",false,{alegraBrand:true}));this.callParent(arguments)}});Ext.define("AL.view.user.FormInviteAccountant",{extend:"Ext.form.Panel",alias:"widget.user_FormInviteAccountant",width:450,defaults:{labelAlign:"right",labelPad:15,labelWidth:170,width:400,msgTarget:"side"},defaultType:"textfield",items:[{fieldLabel:translate("name",true)+" "+translate("and")+" "+translate("lastName",true),name:"name",allowBlank:false,},{name:"company_name",fieldLabel:translate("companyName",true),tooltip:translate("addThisDataIfYourAccountantWorksForACompanysignature",true)},{fieldLabel:translate("electronicEmail",true),name:"email",allowBlank:false,regex:/^[A-Za-z0-9!#$%&'*+-/=?^_`{|}~]+@[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?(.[A-Z0-9](?:[A-Z0-9-]{0,62}[A-Z0-9])?)*$/i,regexText:translate("youMustEnterAValidEmailAccount",true)},{name:"city",fieldLabel:translate("city",true),allowBlank:false,},{name:"phone",fieldLabel:translate("phone",true)}],buttons:[{text:translate("send",true),action:"save",formBind:true,margin:"10 10 0 0",height:40,hidden:true}]});Ext.define("AL.store.Users",{extend:"Ext.data.Store",model:"AL.model.User",autoLoad:false,pageSize:14,remoteSort:true,proxy:{type:"ajax",url:"/user/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.UsersPositions",{extend:"Ext.data.Store",autoLoad:true,fields:["id","position"],proxy:{type:"ajax",url:"/user/retrieve-positions/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Languages",{extend:"Ext.data.Store",fields:["key","value"],data:[{key:"es",value:translate("spanish",true)},{key:"en",value:translate("english",true)}]});Ext.define("AL.model.WarehouseTransfer",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"auto"},{name:"warehouseOrigin",type:"object"},{name:"warehouseDestination",type:"object"},{name:"date",type:"date",dateFormat:"c"},{name:"deletable",type:"bool"},{name:"editable",type:"bool"},],idProperty:"idLocal"});Ext.define("AL.view.warehouse.FormAdd",{extend:"Ext.form.Panel",alias:"widget.warehouse_FormAdd",bodyPadding:30,width:400,layout:"anchor",title:"",defaults:{anchor:"100%",labelWidth:110,labelAlign:"right",width:250,labelPad:15,msgTarget:"side"},items:[{xtype:"hidden",name:"idLocal"},{xtype:"textfield",name:"name",fieldLabel:translate("name",true),allowBlank:false},{xtype:"textfield",name:"address",fieldLabel:translate("address",true)},{xtype:"textarea",name:"observations",fieldLabel:translate("observations",true)},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,queryMode:"remote",forceSelection:true,listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},},]});Ext.define("AL.view.warehouse.FormAddTransfer",{extend:"Ext.form.Panel",alias:"widget.warehouse_FormAddTransfer",bodyPadding:"30 55",layout:"hbox",requires:["AL.view.buttons.Cancel"],title:"",items:[{xtype:"hidden",name:"idLocal"},{name:"leftContainer",width:400,border:false,defaults:{anchor:"100%",labelWidth:150,labelAlign:"right",labelPad:15,msgTarget:"side"},items:[{xtype:"combo",name:"warehouseOrigin",store:"WarehouseCombo",valueField:"idLocal",displayField:"name",editable:false,allowBlank:false,emptyText:translate("selectSimple",true),queryMode:"local",fieldLabel:translate("originWarehouse",true,{warehouse:false}),listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"datefield",name:"date",fieldLabel:translate("date",true),allowBlank:false}]},{name:"rightContainer",width:500,border:false,defaults:{anchor:"100%",labelWidth:200,labelAlign:"right",labelPad:15,msgTarget:"side"},items:[{xtype:"combo",name:"warehouseDestination",store:"WarehouseCombo",valueField:"idLocal",displayField:"name",editable:false,allowBlank:false,emptyText:translate("selectSimple",true),queryMode:"local",fieldLabel:translate("destinationWarehouse",true,{warehouse:false}),listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"textarea",name:"observations",fieldLabel:translate("observations",true),}]}]});Ext.define("AL.view.warehouse.FormAddItemTransfer",{extend:"Ext.form.Panel",alias:"widget.warehouse_FormAddItemTransfer",bodyPadding:"18 5 10 5",border:false,style:"border-bottom: 1px solid #eee; padding-top: 0px;",layout:"hbox",defaults:{anchor:"100%",msgTarget:"side"},defaultType:"textfield",items:[{xtype:"combo",name:"idItem",allowBlank:false,emptyText:translate("searchBillableItem",true),displayField:"name",valueField:"idLocal",width:235,matchFieldWidth:false,triggerCls:"x-form-search-trigger",queryMode:"remote",typeAhead:true,forceSelection:true,minChars:0,store:"",listConfig:{width:235,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list",tpl:'<tpl for="."><div class="x-boundlist-item">{name} <tpl if="reference"> - ({reference})</tpl></div></tpl><div></div>'}},{xtype:"displayfield",width:235,name:"reference",fieldStyle:"text-align:center;"},{xtype:"displayfield",margin:"0 65 0 0",width:235,name:"availableQuantity",fieldStyle:"text-align:center;"},{name:"quantity",allowBlank:false,emptyText:translate("quantity",true),regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("currencyEditRateErrorMsg",true),msgTarget:"side",width:120},{xtype:"button",action:"deleteItem",width:16,height:16,style:"margin-left: 40px",baseCls:"none"}]});Ext.define("AL.store.Warehouses",{extend:"Ext.data.Store",model:"AL.model.Warehouse",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/warehouse/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Desactivar], img[alt=Activar], img[alt=Editar], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.store.WarehouseTransfers",{extend:"Ext.data.Store",model:"AL.model.WarehouseTransfer",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/warehouse/retrieve-all-transfers/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var a=Ext.dom.Query.select("img[alt=Ver detalle], img[alt=Editar], img[alt=Eliminar]");Ext.each(a,function(b){b.title=b.alt})}}});Ext.define("AL.view.ledger.JournalDetail",{extend:"Ext.container.Container",alias:"widget.ledger_JournalDetail",width:"100%",cls:"ledger-component",journalTitle:null,initComponent:function(){var f=this.ledger,j=f.company,m="",c="",o=f.voided?' <span class="journal-status voided">'+translate("canceledMale",true)+"</span>":"",k=f.number?' <span class="journal-number">'+f.number+"</span>":"",a=Ext.util.Format.usMoney(f.totalDebit,f.decimalPrecision,f.currencySymbol),b=Ext.util.Format.usMoney(f.totalCredit,f.decimalPrecision,f.currencySymbol);if(f.currencyCode){var n=Ext.util.Format.usMoney(f.companyCurrencyValues.totalDebit,f.decimalPrecision,j.currency.symbol),e=Ext.util.Format.usMoney(f.companyCurrencyValues.totalCredit,f.decimalPrecision,j.currency.symbol),h=Ext.util.Format.round(f.exchangeRate,8);m='<div class="right" >'+translate("currency",true)+" <span>"+f.currencyCode+"</span></div>";c='<div class="right" >'+translate("rate",true)+" <span>1 "+f.currencyCode+" = "+h+" "+j.currency.code+"</span></div>";a="<b>"+j.currency.code+":</b> "+n+'<br><span class="secondary-currency-amount">'+f.currencyCode+":</b> "+a+"</span>";b="<b>"+j.currency.code+":</b> "+e+'<br><span class="secondary-currency-amount"><b>'+f.currencyCode+":</b> "+b+"</span>"}var l=translate("ledger.journal",true);if(this.journalTitle){l=this.journalTitle}var d='<div><a class="button basic small" id="printLedger" target="_blank" href="/ledger/print/id/'+this.id+"/document/"+this.documentType+'" onClick="window.open(this.href).print(); return false;"><svg class="icon small"><use xlink:href="/images/smile-icons.svg#print"></use></svg>'+translate("print",true)+"</a></div>";var g=[{html:'<div class="header"><div class="left main">'+l+" "+k+o+d+"</div>"+c+m+'<div class="right">'+translate("date",true)+" <span>"+this.formatDate(f.date)+"</span></div></div>",border:false},{html:'<div class="notification">'+translate("displaysTheAccountingTransactionForThisReceipt",true)+". "+translate("youCanCustomizeTheCategoriesAndTheirCodes",true)+' <a href="/category" target="_blank">'+translate("here")+"</a>.</div>",border:false},{xtype:"grid",store:this.gridStore,cls:"ledger-grid",columns:[{text:translate("ledgerThird",true),sortable:false,renderer:this.renderIdentification,},{text:translate("code",true),dataIndex:"code",sortable:false,renderer:this.renderCode,},{text:translate("category",true),dataIndex:"name",flex:0.8,sortable:false,renderer:this.renderName,},{text:translate("costCenter",true),renderer:this.renderCostCenter,name:"costCenter",sortable:false,align:"right",cls:"center",tdCls:"border center",hidden:true,width:140},{text:translate("ledger.debit",true),renderer:this.renderDebitTotal,sortable:false,align:"center",cls:"center",tdCls:"border center",width:140},{text:translate("ledger.credit",true),renderer:this.renderCreditTotal,sortable:false,align:"center",cls:"center",tdCls:"border center",width:140}],frame:false,border:false},{html:'<div class="footer"><div class="main">TOTAL</div><div class="total">'+a+'</div><div class="total">'+b+"</div></div>",frame:false,border:false}];this.items=g;this.callParent(arguments)},renderCategoryLink:function(b,c){var a=b?b:"";if(!c||!a){return a}return'<a href="/category/view/id/'+c+'">'+a+"</a>"},renderIdentification:function(c,e,b){var d="&mdash;",a=b.get("client");if(a&&a.identification){d=a.identification;if(a.identificationTypeAbbreviature){d=a.identificationTypeAbbreviature+". "+d}}return d},renderCode:function(f,g,b,h,d,c,a){var e=this.up("container");if(!f){f="&mdash;"}return e.renderCategoryLink(f,b.get("idCategory"))},renderName:function(f,g,b,h,d,c,a){var e=this.up("container");return e.renderCategoryLink(f,b.get("idCategory"))},renderDebitTotal:function(f,g,b,h,d,c,a){var e=this.up("container");if(b.get("operation")=="D"){return e.renderOperationTotal(b)}return""},renderCreditTotal:function(f,g,b,h,d,c,a){var e=this.up("container");if(b.get("operation")=="C"){return e.renderOperationTotal(b)}return""},renderOperationTotal:function(b){var c=b.get("companyCurrencyValues"),e=this.ledger,a=e.company,f=b.get("decimalPrecision")?b.get("decimalPrecision"):e.decimalPrecision,d=Ext.util.Format.usMoney(c.amount,f,a.currency.symbol);if(e.currencyCode){d="<b>"+a.currency.code+":</b> "+d+"</span>";if(b.get("amount")!==null){d+='<br><span class="secondary-currency-amount">'+e.currencyCode+": "+Ext.util.Format.usMoney(b.get("amount"),f,e.currencySymbol)}}return d},formatDate:function(b){var a=AL.date(b);return Ext.Date.format(a,"d/m/Y")},renderCostCenter:function(e,f,b,g,d,c,a){return b.get("costCenterName")},});Ext.define("AL.view.costCenter.FormAdd",{extend:"Ext.form.Panel",alias:"widget.costCenter_FormAdd",bodyPadding:30,width:400,layout:"anchor",title:"",cls:"cost-center-form-add",defaults:{anchor:"100%",labelWidth:100,labelAlign:"top",width:250,labelPad:15,msgTarget:"side"},items:[{xtype:"hidden",name:"idLocal"},{xtype:"textfield",name:"name",fieldLabel:translate("costCenterNameLabel",true),allowBlank:false},{xtype:"textfield",name:"code",fieldLabel:translate("code",true)},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",allowBlank:true}],buttons:[{text:'<span class="req">*</span> '+translate("requiredFields",true),disabled:true,cls:["const-center-required-fields"]},{text:translate("btnCancel",true),itemId:"cancelNewCostCenter",action:"cancel",cls:["button","basic"],width:100,height:38},{text:translate("buttonSave",true),itemId:"saveNewCostCenter",action:"save",cls:"sm-button-primary",height:38,width:100,}]});Ext.define("AL.view.costCenter.CostCenterForm",{extend:"Ext.form.Panel",alias:"widget.costCenter_CostCenterForm",border:false,bodyStyle:"background-color:transparent;",items:[{xtype:"checkboxfield",name:"costCenter",inputValue:"yes",fieldLabel:translate("costCenterActivationLabel",true),labelWidth:190},{xtype:"component",html:'<div class="tooltip-wrapper" style="left: 163px;top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="position: absolute;top:-20px;left: 5px;"><div class="tooltip-text-wrapper" style="width: 379px;"><div class="text">'+translate("costCenterActivationTooltip",true)+"</div></div></div></div>"},],buttons:[]});Ext.define("AL.store.CostCenters",{extend:"Ext.data.Store",model:"AL.model.CostCenter",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/cost-center/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{}});Ext.define("AL.view.common.IndexMainToolbar",{extend:"Ext.panel.Panel",alias:"widget.common_IndexMainToolbar",toolbarConfig:{newButtonText:"Nueva",newButtonHeight:32,newButtonWidth:120,searchEmptyText:"Buscar..."},layout:"hbox",bodyStyle:"background: #eee",border:false,bodyPadding:15,items:[{xtype:"button",text:"",action:"add",iconCls:"newIcon"},{xtype:"box",flex:0.5}],listeners:{afterrender:function(d,c){var a=d.toolbarConfig;var b=d.down("button[action=add]");var e=(a.newButtonText)?a.newButtonText:"Nueva";b.setText(e);b.action=(a.newButtonAction)?a.newButtonAction:"add";b.width=(a.newButtonWidth)?a.newButtonWidth:120;b.height=(a.newButtonHeight)?a.newButtonHeight:32}}});Ext.define("AL.plugin.grid.PageSize",{extend:"Ext.AbstractPlugin",alias:"plugin.grid_PageSize",store:null,init:function(c){var d=c.down("pagingtoolbar");d.addCls("green-background-toolbar");var a=c.getStore();this.store=a;if(d){var e=Ext.create("Ext.form.field.ComboBox",{name:"pageSize",displayField:"pageSize",valueField:"pageSize",forceSelection:true,fieldLabel:translate("resultsPerPage",true),labelWidth:120,width:180,store:Ext.create("Ext.data.Store",{fields:["pageSize"],data:(this.data)?this.data:this.getPageSizeObjects(a.pageSize)})});if(this.data){var b=this.selectDefault(e);if(b){a.pageSize=50}}else{this.selectDefault(e,a.pageSize)}e.on("select",this.reloadStore,this);setTimeout(function(){if(c.pageSizeConfig&&c.pageSizeConfig.callbackStoreLoad&&typeof c.pageSizeConfig.callbackStoreLoad==="function"){d.on("change",function(g){var f=g.getStore();c.pageSizeConfig.callbackStoreLoad(f.data.items)})}},1000);d.add("-");d.add(e)}else{console.log("Paging toolbar not found")}},reloadStore:function(e,c,d){var a=c[0];if(a){var b=this.store;b.pageSize=a.get("pageSize");b.loadPage(1)}},getPageSizeObjects:function(a){var c=[];for(var b=1;b<=4;b++){c.push({pageSize:a*b})}return c},selectDefault:function(c,b){var a=null;if(b){a=b}else{Ext.each(this.data,function(d){if(d.selected){a=d.pageSize}})}if(a){c.select(a);return a}else{console.log("Error. No default selection sent");return null}}});Ext.define("AL.view.common.AddRetention",{extend:"Ext.form.Panel",alias:"widget.common_AddRetention",border:false,bodyStyle:" padding-top:10px; border-bottom:1px solid #d0d0d0; background-color: #F9F8FD; color: #005E67; width: 990px",bodyPadding:"16px 5px 10px 10px",width:990,cls:"add-retention-panel",suggested:false,minHeight:53,canCreateNewRetention:"no",defaults:{msgTarget:"side",labelAlign:"left",labelPad:10,},defaultType:"textfield",items:[{xtype:"hidden",name:"oldIdRetention"},{xtype:"hidden",name:"oldRetentionName"},{xtype:"hidden",name:"oldRetention"},{xtype:"combo",style:"margin-right: 20px; top: 19px; display: inline;",fieldLabel:translate("retention",true),name:"idRetention",allowBlank:false,displayField:"name",valueField:"idLocal",matchFieldWidth:false,queryMode:"local",typeAhead:true,labelWidth:80,store:"Retentions",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>',width:200},emptyText:translate("select",true),editable:false,listeners:{beforeRender:function(b){var a=this.up("form");if(a.suggested){b.fieldLabel+=" Sugerida";b.labelWidth=160}}}},{xtype:"textfield",fieldLabel:translate("base",true),style:"margin-right: 20px; top: 19px; display: inline;",name:"base",labelWidth:50,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),allowBlank:false,hidden:true,disabled:true,listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.disabled=false;b.hidden=false}},change:function(g,h){var c=g.up("form");if(c.allowBase&&c.allowBase===true&&g.isValid()){var a=c.down("[name=idRetention]");var f=a.getSelectedRecord();if(f){var b=c.up("panel");var j=(b&&b.invoiceDecimalPrecision)?b.invoiceDecimalPrecision:c.decimalPrecision;var d=c.down("[name=amount]");var e=AL.math.approx(AL.math.mul(h,AL.math.div(f.get("percentage"),100)),null,j);d.setValue(e)}}}}},{xtype:"textfield",fieldLabel:translate("value",true),style:"top: 19px; display: inline;",name:"amount",labelWidth:50,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){b.readOnly=true;b.fieldStyle="opacity: 0.5;"}}}},{xtype:"container",layout:"hbox",name:"exchangeRateContainer",style:"top: 19px; display: inline-block;",margin:"0 0 0 20",width:250,items:[{xtype:"textfield",width:200,fieldLabel:translate("rate",true),name:"exchangeRate",hidden:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",labelAlign:"right",labelWidth:50,allowBlank:true},]},{xtype:"box",style:"padding-left: 32.5%; padding-top:5px;",name:"supportDocumentSection"},{xtype:"button",action:"deleteRetention",height:16,width:16,style:"position: absolute; top : 19px; right:58px; cursor:pointer; color: #B1B1B1;     background-image: url(https://cdn1.getsoft.app/images/sm-delete.png);",baseCls:"deleteIcon",handler:function(a){var b=a.up("form");if(b.configs&&["republicaDominicana","argentina"].indexOf(b.configs.country)!=-1&&b.retention&&b.retention.supportDocument){return GlobalMsg.showErrorMessage("Advertencia","Para eliminar la "+translate("retention")+", elimina el documento que la soporta.","no","warning")}b.destroy()},listeners:{beforerender:function(b){var a=b.up("form");if(a.allowBase&&a.allowBase===true){if(a.suggested){b.style="position: absolute; top : 33px; right:288px; cursor:pointer; color: #B1B1B1;     background-image: url(https://cdn1.getsoft.app/images/sm-delete.png);"}else{b.style="position: absolute; top : 33px; right:200px; cursor:pointer; color: #B1B1B1;     background-image: url(https://cdn1.getsoft.app/images/sm-delete.png);"}}}}},]});Ext.define("AL.model.City",{extend:"Ext.data.Model",fields:["id","key","value","code","abbreviature","rules","isRepeated","parentId","parentValue","idDepartment","idProvince",]});Ext.define("AL.view.ux.form.Month",{extend:"Ext.form.field.Date",alias:"widget.monthfield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthField","Ext.form.Month"],selectMonth:null,createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.picker.Month",{pickerField:a,ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,height:195,minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{select:{scope:a,fn:a.onSelect},monthdblclick:{scope:a,fn:a.onOKClick},yeardblclick:{scope:a,fn:a.onOKClick},OkClick:{scope:a,fn:a.onOKClick},CancelClick:{scope:a,fn:a.onCancelClick}},keyNavConfig:{esc:function(){a.collapse()}}})},onCancelClick:function(){var a=this;a.selectMonth=null;a.collapse()},onOKClick:function(){var a=this;if(a.selectMonth){a.setValue(a.selectMonth);a.fireEvent("select",a,a.selectMonth)}a.collapse()},onSelect:function(a,c){var b=this;b.selectMonth=new Date((c[0]+1)+"/1/"+c[1])}});Ext.define("AL.view.common.AddVoidCause",{extend:"AL.view.common.SmileWindow",alias:"widget.common_AddVoidCause",layout:"fit",title:"",width:480,style:"background: transparent",bodyStyle:"background: transparent",autoShow:true,border:false,modal:true,items:[{frame:true,xtype:"form",name:"formAddVoidCause",bodyStyle:"padding:15px; background: transparent",style:"background-color: transparent; border: none;",width:410,defaults:{labelAlign:"right",labelPad:15,msgTarget:"side"},items:[{xtype:"box",cls:"modal-subtitle",html:"<div>Esta información es necesaria para generar tus reportes correctamente.</div>"},{xtype:"datefield",style:"text-align: left",fieldLabel:"Fecha",emptyText:"Seleccionar",name:"voidDate",format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",width:300,hidden:true,listeners:{change:function(e){var d=e.up("form");var b=d.up("panel");if(b&&b.country==="republicaDominicana"){var a=d.down("container[name=alert]");var c=new Date(e.getValue());var g=new Date(c.getFullYear(),c.getMonth(),1);var f=new Date(c.getFullYear(),c.getMonth()+1,0);var h=new Date(b.documentDate);if(h>=g&&h<=f){a.hide()}else{a.show()}}}}},{xtype:"combo",name:"voidCause",fieldLabel:"Motivo",emptyText:"Seleccionar",store:"VoidCauses",displayField:"value",valueField:"id",width:300,forceSelection:true,editable:false,queryMode:"local"},{xtype:"textarea",name:"voidCause",allowBlank:true,emptyText:"Motivo de "+translate("cancelation"),maxLength:100,width:420,height:40},{xtype:"container",name:"alert",html:'<div class="alert warning" style="margin-top: 25px;"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#info-outline"></use></svg><p style="display: inline;">La fecha de la factura corresponde a un período anterior, ¿aún deseas anularla?</p></div>',hidden:true}],buttons:[{text:"Cancelar",margin:"10 10 0 0",height:40,cls:"button",action:"close",handler:function(a){var b=a.up("window");b.destroy()},hidden:true},{text:"Guardar",formBind:true,action:"save",hidden:true,margin:"10 10 0 0",height:40,cls:"button main-button",handler:function(c){c.setDisabled(true);var f=c.up("form");var e=f.up("window");var b=f.down("combo[name=voidCause]");var a=f.down("textarea[name=voidCause]");var d=f.down("datefield[name=voidDate]");if(f.isValid()){var g="void";var h={id:e.documentId};switch(e.country){case"republicaDominicana":h.voidCause=b.getValue();h.voidDate=d.getValue();if(!e.voidAction){g="add-void-cause"}break;case"peru":h.voidCause=a.getValue();break}Ext.Ajax.on("beforerequest",function(k,l){if(l.showSpinner){var j=new Ext.LoadMask(Ext.getBody(),{msg:translate("loading",true)});j.show();l.mask=j}},this);Ext.Ajax.on("requestcomplete",function(k,j,l){if(l.showSpinner){l.mask.destroy()}},this);Ext.Ajax.request({url:"/"+e.documentType+"/"+g+"/format/json",method:"POST",params:h,showSpinner:true,success:e.success?e.success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){window.location.reload()}else{Ext.MessageBox.alert("Error",l.cause)}},failure:function(){}})}}}]},],footer:{items:[{text:"Cancelar",cls:"button",handler:function(a){var c=a.up("window");var b=c.down("button[action=close]");if(b){b.fireEvent("click",b);b.fireHandler()}}},{text:"Guardar",cls:"button main-button",handler:function(a){var c=a.up("window");var b=c.down("button[action=save]");if(b){a.setDisabled(true);b.fireEvent("click",b);b.fireHandler()}},listeners:{afterrender:function(a){var c=a.up("window");var b=c.down("form[name=formAddVoidCause]");a.setDisabled(true);b.on("validitychange",function(e,d){a.setDisabled(!d)})}}}]},listeners:{afterrender:function(f){var e=f.down("form");var b=e.down("combo[name=voidCause]");var a=e.down("textarea[name=voidCause]");var d=e.down("datefield[name=voidDate]");switch(f.country){case"republicaDominicana":a.hide();b.allowBlank=false;d.show();d.allowBlank=false;d.setValue(new Date(f.documentDate));d.setMinValue(new Date(f.documentDate));if(new Date(f.documentDate)<new Date("2018-05-01")){d.setMaxValue(new Date("2018-05-01"))}var c=b.getStore();if(f.refreshVoidCauses&&f.refreshVoidCauses===true){c.proxy.extraParams={date:Ext.util.Format.date(f.documentDate,"Y-m-d")};c.load()}else{if(!c.proxy.extraParams.date){c.proxy.extraParams={date:Ext.util.Format.date(f.documentDate,"Y-m-d")};c.load()}}d.setFieldLabel('Fecha de anulación<span class="req">*</span>');b.setFieldLabel('Motivo de anulación<span class="req">*</span>');break;case"peru":b.hide();a.allowBlank=false;break}}},initComponent:function(){this.title="Indica el motivo de "+translate("cancelation")+" del documento",this.callParent(arguments)}});Ext.define("AL.view.admin.company.OriginKeywordCombo",{extend:"Ext.form.ComboBox",alias:"widget.admin_company_OriginKeywordCombo",fieldLabel:"Origen",displayField:"title",valueField:"originKeyword",queryMode:"local",editable:false,forceSelection:true,store:{fields:["originKeyword","title"],data:[{originKeyword:"acrecer",title:"Acrecer"},{originKeyword:"alegra-api",title:"Alegra API"},{originKeyword:"alegra-pos",title:"Alegra POS"},{originKeyword:"alegra-web",title:"Alegra Web"},{originKeyword:"api-camcomercio",title:"Cámara de comercio"},{originKeyword:"api-movistar",title:"Movistar"},{originKeyword:"educacion",title:"Educación"},{originKeyword:"mobile",title:"App Móvil"},{originKeyword:"partner-adopem",title:"Adopem"},{originKeyword:"partner-bancamia",title:"Bancamia"},{originKeyword:"partner-bancolombia",title:"Bancolombia"},{originKeyword:"partner-bancolombia-pymes15",title:"Bancolombia Pymes 15"},{originKeyword:"partner-bbva",title:"BBVA"},{originKeyword:"partner-carvajal",title:"Carvajal"},{originKeyword:"partner-eia",title:"Escuela de Ingeniería de Antioquia"},{originKeyword:"partner-epicentro",title:"Epicentro"},{originKeyword:"partner-estudiantes-univesitarios-mx",title:"Estudiantes universitarios MX"},{originKeyword:"partner-gulungo",title:"Gulungo"},{originKeyword:"partner-innpulsa",title:"Innpulsa"},{originKeyword:"partner-microserfin",title:"Microserfin"},{originKeyword:"partner-nodo",title:"Nodo Coworking"},{originKeyword:"special-offer",title:"Oferta especial"},{originKeyword:"vivaair-ad-2019",title:"VivaAir 2019"},{originKeyword:"google-ads",title:"Google Ads"},{originKeyword:"partner-payu",title:"PayU"},{originKeyword:"partner-claro",title:"Claro"},{originKeyword:"partner-payu-mex",title:"PayU MEX"}]}});Ext.define("AL.view.ux.graph.Settings",{extend:"Ext.panel.Panel",baseCls:"graph-settings-component",alias:"widget.graphSettings",initComponent:function(){var a=[{xtype:"button",name:"graph-settings",baseCls:"graph-settings-button"}];var b=this.groupByOptions?this.groupByOptions:[];if(b.length>0){var c="";Ext.each(b,function(d){c+='<li><input name="groupByOption" '+(d.checked?'checked="true"':"")+' value="'+d.id+'" type="radio" id="'+d.id+'" ><label for="'+d.id+'">'+d.value+"</label></li>"});a.push({xtype:"box",name:"groupByOptionList",show:false,cls:"hidden-element",html:'<ul class="graph-groupBy-radio-group radio-whitout-button-section">'+c+"</ul>"})}this.items=a;this.callParent()},getElementsGroupByOptions:function(){var b=this.down("box[name=groupByOptionList]"),a=b?b.getEl().query("[name=groupByOption]"):[];return a},getGroupByOptionChecked:function(){var a=null;var b=this.groupByOptions;var c=this.getElementsGroupByOptions();Ext.each(c,function(d){if(d.checked){var e=Ext.Array.filter(b,function(f){return f.id===d.value});if(e.length>0){a=e[0]}}});return a}});Ext.define("AL.view.common.SmileNumeration",{extend:"Ext.panel.Panel",alias:"widget.smilenumeration",border:false,configs:{},values:{},documentType:null,smStore:null,initComponent:function(){var e=this;var d=(typeof this.configs.autoload=="undefined"||this.configs.autoload===true);var c=Ext.create("AL.store.ResolutionsCombo");var a=[{xtype:"box",name:"resolutionDropdown",style:"text-align: right;",html:'<a class="form-add-invoice-header-number-dropdown" style="margin-right:0;" href="#" onclick="return false;" id="number-dropdown"><span id="number-dropdown-text">'+translate("loading",true)+'</span><svg class="icon" style="margin-right: 0px !important; color: inherit !important;"><use xlink:href="/images/smile-icons.svg#caret-down"></use></svg></a>',},{xtype:"panel",name:"nextNumberContainer",layout:{type:"hbox",pack:"end"},border:false,width:315,style:" margin: 10px 0;",items:[]}];if(d){var b="/resolution/retrieve-all-active/documentType/"+this.documentType+"/format/json";if(this.configs.onlyAutoincrement===true){b+="/onlyAutoincrement/true"}c.getProxy().url=b;c.load()}this.items=a;this.callParent(arguments)},setNumerationForDocumentsOldNumeration:function(b){var c=this.configs.parent?Ext.ComponentQuery.query(this.configs.parent)[0]:null;var a=this.documentType;var d=b.down("panel[name=nextNumberContainer]");b.removeAll();b.add(d);d.removeAll(false);if(c.type==="edit"||c.edit===true){d.add({xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",padding:"0 3 0 0",width:95,height:48,fieldCls:"form-add-invoice-header-number-left",readOnly:true,value:c.configs.documentNumber},{xtype:"box",padding:"5 0 0 0",html:'<a target="__blank" class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})}else{Ext.Ajax.request({url:"/company/retrieve-numeration-info/format/json",method:"POST",success:function(f,h){var g=Ext.decode(f.responseText);var e=a.charAt(0).toUpperCase()+a.substr(1);var j=g.results["next"+e+"Number"];d.add({xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",padding:"0 3 0 0",width:95,height:48,fieldCls:"form-add-invoice-header-number-left",readOnly:true,value:j},{xtype:"box",padding:"5 0 0 0",html:'<a target="__blank" class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})}})}},updateResolutionDropDown:function(b){if(!b){b=translate("loading",true)}var a=Ext.get("number-dropdown-text");a.dom.innerHTML=b},listeners:{beforerender:function(g){var j=this.configs.parent?Ext.ComponentQuery.query(this.configs.parent)[0]:null;var h=this.documentType;var f=this;var a=g.down("[name=nextNumberContainer]");if(j&&j.configs&&(!j.configs.resolutionModel||j.configs.resolutionModel!="new")){if(["remission","estimate"].includes(this.documentType)){this.setNumerationForDocumentsOldNumeration(g);return}else{this.hide()}}var d=Ext.create("AL.store.ResolutionsCombo");this.smStore=d;var b="/resolution/retrieve-all-active/documentType/"+h+"/format/json";var c=function(){var m=g.down("[name=resolutionDropdown]");var n=Ext.get("number-dropdown");var o=d.data.items;var l=d.findRecord("isDefault","yes");n.el.on("click",function(p,q){e.smShow()});if(o.length<=1){m.hide()}if(!l){l=o[0]}f.updateResolutionDropDown(l.get("name"));l=l.data;var k=h.charAt(0).toUpperCase()+h.substr(1);if(j["id"+k]==null&&!(j.type==="edit"||j.edit===true)){f.selectNumerationByIdLocal(l.idLocal)}};var e=Ext.create("AL.view.ux.smile.floating.DropdownList",{name:"resolutionDropdownListSmile",smTarget:"number-dropdown",smAlignXTo:1,smAlignYTo:2,smX:13,smY:8,smStore:d,smDisplayField:"name",smValueField:"idLocal",smSelectFirstByDefault:false,smIsEnable:function(){return this.smIsEnable},smEnable:function(){var k=Ext.get("number-dropdown");if(k){k.addCls("form-add-invoice-header-number-dropdown");k.removeCls("form-add-invoice-header-number-dropdown-disable")}this.smIsEnable=true},smDisable:function(){var k=Ext.get("number-dropdown");if(k){k.addCls("form-add-invoice-header-number-dropdown-disable");k.removeCls("form-add-invoice-header-number-dropdown")}this.smIsEnable=false}});e.smOnChange=function(n,u,s,q){f.updateResolutionDropDown(u);var t=f.configs.parent?Ext.ComponentQuery.query(f.configs.parent)[0]:null;var p=d.getById(s).data;a.removeAll(false);var k=63;var v=91;var r=10;var o=[{xtype:"label",padding:"4 7 0 77",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:k,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:v,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:r}];if(t.type==="edit"||t.edit===true){a.removeAll(false);a.add(o);var m=a.down("textfield[name=prefix]");var l=a.down("textfield[name=number]");if(p&&f.values.numerationIdLocal==p.idLocal){m.setValue(f.values.prefix);l.setValue(f.values.number)}else{if(p&&p.autoincrement&&p.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:p.idLocal},success:function(w,y){var x=Ext.decode(w.responseText);var z=x.results;m.setValue(z.prefix);l.setValue(z.number)}})}else{l.setValue(null)}}}else{if(t.type!=="edit"&&p){if(p.autoincrement&&p.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/documentType/"+h+"/format/json",method:"POST",params:{id:p.idLocal},success:function(w,y){var x=Ext.decode(w.responseText);var z=x.results;var z=z.prefix+(t.configs&&t.configs.country==="peru"&&h==="creditNote"&&z.prefix?"-":"")+z.number;a.removeAll(false);a.add({xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",padding:"0 3 0 0",width:95,height:48,fieldCls:"form-add-invoice-header-number-left",readOnly:true,value:z},{xtype:"box",padding:"5 0 0 0",html:'<a target="__blank" class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})}})}else{var k=63;var v=91;var r=10;a.removeAll(false);a.add({xtype:"label",padding:"4 7 0 77",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:k,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:v,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:r},{xtype:"box",padding:"5 0 0 0",html:'<a target="__blank" class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})}}}};e.smOnSelect=function(k,o,m,l,n){};d.on("load",c);d.getProxy().url=b;d.load()}},getSelectedNumeration:function(){var a=Ext.ComponentQuery.query("[name=resolutionDropdownListSmile]")[0];return a.smGetValue()},selectNumerationByIdLocal:function(d){var b=this.smStore;var a=Ext.ComponentQuery.query("[name=resolutionDropdownListSmile]")[0];var c=function(){var e=b.findRecord("idLocal",d);if(!e){return}a.smSetValue(e.data.idLocal)};if(b.hasLoaded()){c()}else{b.on("load",function(){c()})}},});Ext.define("AL.plugin.DynamoDbPaging",{extend:"Ext.toolbar.Paging",alias:"widget.dynamodbpagingtoolbar",requires:["Ext.toolbar.Paging"],displayMsg:"Mostrando {0} - {1}",movePrevious:function(){var a=this;var b=a.store.first();Ext.apply(a.store.getProxy().extraParams,{lastEvaluatedKey:b.get("datetime"),pagingDirection:"previous"});a.callParent()},moveNext:function(){var b=this;var a=b.store.last();Ext.apply(b.store.getProxy().extraParams,{lastEvaluatedKey:a.get("datetime"),pagingDirection:"next"});b.callParent()},getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",hidden:true,disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:a.movePrevious,scope:a},"-",{xtype:"tbtext",text:a.beforePageText,hidden:true},{xtype:"numberfield",itemId:"inputItem",name:"inputItem",hidden:true,cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,isFormField:false,width:a.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",hidden:true,text:Ext.String.format(a.afterPageText,1)},{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",hidden:true,disabled:true,handler:a.moveLast,scope:a},"-",{itemId:"refresh",tooltip:a.refreshText,overflowText:a.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",handler:a.doRefresh,scope:a}]},initComponent:function(){var a=this;a.callParent()}});Ext.define("AL.view.ux.smile.floating.Container",{extend:"Ext.container.Container",hidden:true,SM_ALIGN_TO_CENTER:0,SM_ALIGN_TO_LEFT:-2,SM_ALIGN_LEFT_SIDES:-1,SM_ALIGN_RIGHT_SIDES:1,SM_ALIGN_TO_RIGHT:2,SM_ALIGN_TO_TOP:-2,SM_ALIGN_TOP_SIDES:-1,SM_ALIGN_BOTTOM_SIDES:1,SM_ALIGN_TO_BOTTOM:2,smRenderTo:null,smElement:null,smTarget:null,smX:0,smY:0,smAlignXTo:0,smAlignYTo:0,initComponent:function(){this.renderTo=(this.smRenderTo)?this.smRenderTo:Ext.get(document.querySelector(".content"));this.callParent(arguments);this.smElement=Ext.get(document.createElement("div"));this.renderTo.el.dom.appendChild(this.smElement.el.dom)},afterRender:function(){this.smElement.el.dom.style.position="absolute"},smGetTarget:function(){if(!this["smTarget"]){return null}if(typeof this.smTarget=="string"||this.smTarget.getBoundingClientRect){return Ext.get(this.smTarget)}return this.smTarget},smSetTarget:function(a){this.smTarget=a;this.smAlignWithTarget()},smGetX:function(){return this.smX},smSetX:function(a){this.smSetXY(a,this.smY)},smGetY:function(){return this.smY},smSetY:function(a){this.smSetXY(this.smX,a)},smGetXY:function(){return{x:this.smX,y:this.smY}},smSetXY:function(a,b){this.smX=a;this.smY=b;this.smAlignWithTarget()},smGetAlignXTo:function(){return this.smAlignXTo},smSetAlignXTo:function(a){this.smAlignXTo=a;this.smAlignWithTarget()},smGetAlignYTo:function(){return this.smAlignYTo},smSetAlignYTo:function(a){this.smAlignYTo=a;this.smAlignWithTarget()},smCalculateAlignmentDifference:function(b,c,a){switch(b){case -2:return -c;case -1:return 0;case 1:return a-c;case 2:return a}return Math.round((a-c)/2)},smAlignWithTarget:function(){var b=this.smGetTarget();var c=this.renderTo.el.dom.getBoundingClientRect();var a=b.el.dom.getBoundingClientRect();this.smElement.el.dom.style.left=(a.left-c.left+this.smCalculateAlignmentDifference(this.smAlignXTo,this.smElement.getWidth(),b.getWidth())+this.smX)+"px";this.smElement.el.dom.style.top=(a.top-c.top+this.smCalculateAlignmentDifference(this.smAlignYTo,this.smElement.getHeight(),b.getHeight())+this.smY)+"px"},smShow:function(){this.smElement.el.dom.style.display="block";this.smAlignWithTarget()},smHide:function(){this.smElement.el.dom.style.display="none"},beforeDestroy:function(){this.renderTo.el.dom.removeChild(this.smElement.el.dom);this.smTarget=this.smElement=null}});Ext.define("AL.model.Unit",{extend:"Ext.data.Model",fields:["id","key","name","most_used",{name:"keyAndName",convert:function(a,b){return b.data.key+" - "+b.data.name}}]});Ext.define("AL.model.ProductKey",{extend:"Ext.data.Model",fields:["id","key","name",{name:"keyAndName",convert:function(a,b){return b.data.key+" - "+b.data.name}}]});Ext.define("AL.view.buttons.modern.Button",{extend:"Ext.button.Button",alias:"widget.buttons_modern_Button",type:"primary",size:"big",initComponent:function(){switch(this.type){case"secondary":this.cls="sm-button-secondary";this.disabledCls="sm-button-secondary-disabled";break;case"basic":this.cls="sm-button-basic";break;case"outline":this.cls="sm-button-outline";this.style={background:"transparent !important"};break;case"clear":this.cls="sm-button-clear";this.style={background:"transparent !important"};break;default:this.cls="sm-button-primary";this.disabledCls="sm-button-primary-disabled";break}switch(this.size){default:this.cls+=" sm-button-big";this.height=38;break}this.callParent(arguments)}});Ext.define("AL.view.common.FormAddPaymentMethod",{extend:"Ext.form.Panel",alias:"widget.common_FormAddPaymentMethod",country:null,bodyPadding:30,width:550,layout:"anchor",addAdditionalFormItems:false,availablePaymentMethodImagesPosition:0,classNameFieldHidden:false,classNameFieldDisabled:false,formItemsPosition:0,defaults:{anchor:"100%",labelWidth:265,labelAlign:"right",width:250,labelPad:15,msgTarget:"side",allowBlank:false,originalValue:"",hidden:true,disabled:true},defaultType:"textfield",additionalFormItems:[{name:"name",fieldLabel:translate("accountName",true),allowBlank:true,hidden:false,disabled:false},{xtype:"textarea",name:"description",fieldLabel:translate("description",true),allowBlank:true,hidden:false,disabled:false}],availablePaymentMethodImages:{xtype:"box",html:"",cls:"paymentMethodImages",itemId:"paymentMethodImages",hidden:false,disabled:false,height:52,style:"text-align: right; margin: 12px;"},formItems:[{xtype:"combo",name:"className",fieldLabel:translate("paymentMethodType",true),emptyText:translate("selectSimple",true),displayField:"label",valueField:"value",forceSelection:true,queryMode:"local",editable:false,store:{fields:["label","value"],data:[]}},{name:"payerName",fieldLabel:translate("owner",true),maxLength:45},{xtype:"combo",name:"documentType",fieldLabel:translate("holderIdentification",true,{holder:"{{owner}}"}),displayField:"label",valueField:"value",forceSelection:true,queryMode:"local",editable:false,store:{fields:["label","value"],data:[{label:"CC - Cédula de ciudadanía",value:"CC"},{label:"CE - Cédula de extranjería",value:"CE"},{label:"NIT - Identificación tributaria",value:"NIT"},{label:"TI - Tarjeta de identidad",value:"TI"},{label:"PP - Pasaporte",value:"PP"},{label:"RC - Registro civil de nacimiento",value:"RC"},{label:"DE - Documento de identificación extranjero",value:"DE"}]}},{name:"documentNumber",fieldLabel:translate("holderIdentification",true,{holder:"{{owner}}"}),minLength:4,maxLength:20,maskRe:/[A-z0-9]/,regex:/^[A-z0-9]+$/,regexText:translate("onlyNumbersAndLettersAreAllowed",true),afterBodyEl:(function(){var b=translate("identification",true),a=(b==="NIT"?true:false);if(a){return'<div style="color: gray; font-size: 11px; font-weight: bold;">Ingresa tu cédula o NIT sin dígito de verificación</div>'}return""})()},{name:"payerPhone",fieldLabel:translate("holderPhone",true,{holder:"{{owner}}"}),maxLength:45,maskRe:/[0-9]/,regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),},{xtype:"combo",name:"accountTypeCreditCard",fieldLabel:translate("cardType",true),displayField:"label",valueField:"value",forceSelection:true,queryMode:"local",editable:false,store:{fields:["label","value"],data:[]}},{xtype:"combo",name:"accountTypeDebitCard",fieldLabel:translate("accountType",true),displayField:"label",valueField:"value",forceSelection:true,queryMode:"local",editable:false,store:{fields:["label","value"],data:[{label:"Cuenta corriente",value:"CURRENT"},{label:"Cuenta de ahorros",value:"SAVINGS"}]}},{name:"accountNumber",fieldLabel:translate("cardNumber",true),maxLength:20,maskRe:/[0-9]/,regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),},{xtype:"fieldcontainer",itemId:"expirationDate",fieldLabel:translate("expirationDate",true),afterLabelTextTpl:'<span class="req">*</span>',labelSeparator:"",layout:"hbox",margin:"0 0 5 0",defaults:{hideLabel:true,allowBlank:false,msgTarget:"side"},items:[{xtype:"combo",name:"expirationDateMonth",itemId:"expirationDateMonth",displayField:"num",valueField:"num",queryMode:"local",emptyText:translate("month",true),store:{fields:["num"],data:(function(){var a=[];Ext.Array.forEach(Ext.Date.monthNames,function(b,c){var d=""+(c+1);if(d<10){d="0"+d}a[c]={num:d}});return a})()},width:97,forceSelection:true,editable:false},{xtype:"displayfield",value:"/",margin:"0 5 0 5"},{xtype:"numberfield",name:"expirationDateYear",itemId:"expirationDateYear",width:96,value:new Date().getFullYear().toString().slice(2),minValue:new Date().getFullYear().toString().slice(2),maxValue:99,emptyText:translate("year",true)}]},{name:"securityCode",fieldLabel:translate("securityCode",true),maxLength:4,minLength:3,maskRe:/[0-9]/,regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),},{xtype:"combo",name:"bankEntity",fieldLabel:"Entidad bancaria",displayField:"bankEntity",valueField:"bankEntity",forceSelection:true,queryMode:"local",editable:false,store:{fields:["bankEntity"],data:[{bankEntity:"BANCO AV VILLAS"},{bankEntity:"BANCO CAJA SOCIAL BCSC"},{bankEntity:"BANCO COLPATRIA"},{bankEntity:"BANCO CORPBANCA"},{bankEntity:"BANCO DAVIVIENDA"},{bankEntity:"BANCO DE BOGOTA"},{bankEntity:"BANCO DE OCCIDENTE"},{bankEntity:"BANCO GNB SUDAMERIS"},{bankEntity:"BANCO POPULAR"},{bankEntity:"BANCOLOMBIA"},{bankEntity:"CITIBANK"},{bankEntity:"HELM BANK"},{bankEntity:"HSBC"}]}}],listeners:{beforerender:function(b){b.setupCombos();var a=b.down("textfield[name=documentNumber]");a.afterBodyEl="";a.setFieldLabel(translate("holderIdentification",true,{holder:"{{owner}}"}));switch(this.country){case"colombia":a.tooltip="Ingresa tu cédula o NIT sin dígito de verificación";a.cls=["form-add-pm-doc-num-tip"];break;case"argentina":a.setFieldLabel("Número de DNI del titular");break;case"panama":a.setFieldLabel("Número de identificación del titular");break;case"peru":a.setFieldLabel("RUC o Número de DNI del titular de la tarjeta");break;case"chile":a.setFieldLabel("RUT del titular");break;case"republicaDominicana":a.setFieldLabel("Documento de identidad del titular");break}}},initComponent:function(){if(!this.items){this.items=[]}this.availablePaymentMethodImages.height=52;if(this.country==="mexico"){this.availablePaymentMethodImages.height=104}this.formItems[0].hidden=this.classNameFieldHidden;this.formItems[0].disabled=this.classNameFieldDisabled;this.items.splice(this.availablePaymentMethodImagesPosition,0,this.availablePaymentMethodImages);Array.prototype.splice.apply(this.items,[this.formItemsPosition,0].concat(this.formItems));if(this.addAdditionalFormItems){this.items=this.additionalFormItems.concat(this.items)}if(this["planKeyword"]&&this.planKeyword=="emprendedor"){this.formItems[10].store.data=[{bankEntity:"BANCOLOMBIA"}]}this.callParent(arguments)},getPaymentMethodFields:function(d){var a=this.getForm().getFields().items;var c=[];var b=["payerName","className"];switch(d){case"CreditCard":case"DebitCreditCard":if(this.creditCardFields){return this.creditCardFields}b.push("accountTypeCreditCard","expirationDateYear","expirationDateMonth","securityCode","accountNumber");if(this.country!=="mexico"){b.push("documentNumber","payerPhone")}Ext.each(a,function(f,e){if(!f.is("radio")&&b.indexOf(f.name)!==-1){c.push(f)}});c.push(this.query("[itemId=expirationDate]")[0]);this.creditCardFields=c;break;case"DebitCard":if(this.debitCardFields){return this.debitCardFields}b.push("documentNumber","documentType","accountTypeDebitCard","accountNumber","bankEntity","country");Ext.each(a,function(f,e){if(!f.is("radio")&&b.indexOf(f.name)!==-1){c.push(f)}});this.debitCardFields=c;break;default:Ext.each(a,function(f,e){if(!f.is("radio")&&b.indexOf(f.name)!==-1){c.push(f)}});break}return c},togglePaymentMethodFields:function(b){var c=this.down("combo[name=className]").getValue();var a=this.getPaymentMethodFields(c);if(typeof(b)==="undefined"){b=a[0].isHidden()}var d;if(b){d="hide"}else{d="show"}Ext.each(a,function(e){e.setDisabled(b);e[d]()})},classNameComboChange:function(f){var e=f.up("form"),b=e.down("textfield[name=accountNumber]"),d=e.down("textfield[name=documentNumber]"),a=this.getPaymentMethodFields(f.getValue()),c=[];accountNumberFieldLabel='<span class="req">*</span>';if(!b.rendered){accountNumberFieldLabel=""}switch(f.getValue()){case"DebitCard":c=e.getPaymentMethodFields("CreditCard");b.setFieldLabel(translate("accountNumber",true)+accountNumberFieldLabel);d.regex=/^[0-9]+$/;d.maskRe=/^[0-9]+$/;d.regexText="Solo se permiten números";break;case"CreditCard":case"DebitCreditCard":c=e.getPaymentMethodFields("DebitCard");b.setFieldLabel(translate("cardNumber",true)+accountNumberFieldLabel);d.regex=/^[A-z0-9]+$/;d.maskRe=/^[A-z0-9]+$/;d.regexText="Solo se permiten números y letras";break}Ext.each(c,function(g){g.setDisabled(true);g.hide()});Ext.each(a,function(g){g.setDisabled(false);g.show()})},setupCombos:function(){var h=[],a=[],e=[],j=[],c=[];switch(this.country){case"colombia":a=["DebitCard","CreditCard"];j=["VISA","MASTERCARD","AMERICAN_EXPRESS"];c=[{alt:"American express",src:"/images/payment-credit-amex.png"},{alt:"Mastercard",src:"/images/payment-credit-master.png"},{alt:"Visa",src:"/images/payment-credit-visa.png"}];break;case"mexico":a=["CreditCard","DebitCreditCard"];j=["VISA","MASTERCARD","AMERICAN_EXPRESS"];c=[{alt:"Santander",src:"/images/payment-santander.png"},{alt:"HSBC",src:"/images/payment-hsbc.png"},{alt:"Banorte",src:"/images/payment-banorte.png"},{alt:"Bancomer",src:"/images/payment-bancomer.png"},{alt:"Banamex",src:"/images/payment-banamex.png"},{alt:"American express",src:"/images/payment-credit-amex.png"},{alt:"Visa",src:"/images/payment-credit-visa.png"},{alt:"Mastercard",src:"/images/payment-credit-master.png"},];break;case"republicaDominicana":a=["CreditCard","DebitCreditCard"];j=["VISA","MASTERCARD","AMERICAN_EXPRESS"];c=[{alt:"American Express",src:"/images/payment-credit-amex.png"},{alt:"Mastercard",src:"/images/payment-credit-master.png"},{alt:"Visa",src:"/images/payment-credit-visa.png"}];break;case"usa":case"other":case"peru":case"chile":case"costaRica":case"argentina":a=["CreditCard"];j=["VISA","MASTERCARD","AMERICAN_EXPRESS"];c=[{alt:"American Express",src:"/images/payment-credit-amex.png"},{alt:"Mastercard",src:"/images/payment-credit-master.png"},{alt:"Visa",src:"/images/payment-credit-visa.png"}];break;case"panama":a=["CreditCard"];j=["VISA","MASTERCARD"];c=[{alt:"Mastercard",src:"/images/payment-credit-master.png"},{alt:"Visa",src:"/images/payment-credit-visa.png"}];break}var g="",b="https://cdn1.getsoft.app";for(var f in c){g+='<img src="'+b+c[f].src+'" alt="'+c[f].alt+'">'}this.down("box[itemId=paymentMethodImages]").html=g;for(f=0;f<a.length;f++){h.push({label:translate(a[f],true),value:a[f]})}var d=this.down("combo[name=className]");d.getStore().add(h);for(f=0;f<j.length;f++){e.push({label:translate(j[f],true),value:j[f]})}this.down("combo[name=accountTypeCreditCard]").getStore().add(e)}});Ext.define("AL.model.Plan",{extend:"Ext.data.Model",fields:["id","name","price",]});Ext.define("AL.view.common.MoreActionsButton",{extend:"Ext.button.Split",alias:"widget.common_MoreActionsButton",text:"",cls:"button2",style:"margin: 0 0.5em; padding: 0 8px 0 1em;",height:25,handler:function(){this.showMenu()},initComponent:function(){this.text=translate("moreActions",true);var a=[];a.push({text:translate("attachAFile",true),id:"uploadFile",action:"uploadFile",canUpload:this.canUpload,type:this.type,idType:this.idType});this.menu.items=a;this.callParent(arguments)},menu:{xtype:"menu",items:[]}});Ext.define("AL.model.SellerSales",{extend:"Ext.data.Model",fields:[{name:"idLocal",type:"auto"},{name:"number",type:"string"},{name:"name",type:"string"},{name:"totalPayed",type:"float"},{name:"subTotal",type:"float"},{name:"total",type:"float"},{name:"decimalPrecision",type:"auto"},{name:"totalInvoices",type:"integer"}],idProperty:"idLocal"});Ext.define("AL.plugin.grid.AbstractTriggerToolbar",{extend:"Ext.AbstractPlugin",triggerDisplayPos:0,triggerDisplay:"external-buttons",showPluginButtonQuery:"button[itemId=showPluginButton]",init:function(a){var b=this;b.grid=a;b.triggersContainerConfig={layout:"hbox",itemId:"gridplugin-triggers",items:[],triggers:[],display:function(d,c){d=(typeof d=="undefined"?true:d);if(d){c.show()}else{c.hide()}this.toggleTriggerContainer(false)},undisplay:function(c,d){c=(typeof c=="undefined"?true:c);if(c){d.hide()}else{d.show()}this.toggleTriggerContainer(true)},addNewTrigger:function(){this.triggers.push(this.add.apply(this,arguments))},toggleTriggerContainer:function(e){var c=e?"hide":"show",f=e,d=[];e=e?true:false;Ext.each(this.items.getRange(),function(h){var g=h.xtype==="label"?h.text==="":h.isHidden();d.push(g)});if((e&&d.indexOf(false)===-1)||(!e&&d.indexOf(false)!==-1)){this[c]()}}};this.callParent(arguments)},getTriggerToolbarConfig:function(){return this.triggersContainerConfig},getShowPluginButton:function(){return this.getTriggerContainer().down(this.showPluginButtonQuery)},getTriggerContainer:function(){var a=this.grid,b=this.triggersContainer?this.triggersContainer:a.down("[itemId="+this.triggersContainerConfig.itemId+"]");if(!b){if(a.triggersContainer&&a.triggersContainer[this.triggersContainerConfig.itemId]){this.triggersContainer=b=a.triggersContainer[this.triggersContainerConfig.itemId]}}return b},createTriggerContainer:function(){var b=this.grid,c=this,e=function(){c.triggersContainerConfig.dock="top";triggersContainer=Ext.create("Ext.toolbar.Toolbar",c.triggersContainerConfig);b.addDocked(triggersContainer,c.triggerDisplayPos);c.triggersContainer=triggersContainer};if(this.getTriggerContainer()){return}switch(c.triggerDisplay){case"shared-toolbar":e();break;case"toolbar":c.triggersContainerConfig.itemId="triggers-"+c.pluginId;e();break;case"external-buttons":default:var a=null;if(b.renderTo){a=Ext.get(b.renderTo)}else{e()}if(a){var d=a.insertFirst({tag:"div"});c.triggersContainerConfig.padding="2px 0";c.triggersContainer=Ext.create("Ext.container.Container",c.triggersContainerConfig);c.triggersContainer.render(d)}break}if(!b.triggersContainer){b.triggersContainer={}}b.triggersContainer[c.triggersContainerConfig.itemId]=c.triggersContainer},displayTriggerContainer:function(a){this.getTriggerContainer().display(a,this.getShowPluginButton())},undisplayTriggerContainer:function(a){this.getTriggerContainer().undisplay(a,this.getShowPluginButton())}});Ext.define("AL.plugin.SimplePaging",{extend:"Ext.toolbar.Toolbar",alias:"widget.simplepagingtoolbar",requires:["Ext.toolbar.TextItem","Ext.form.field.Number"],mixins:{bindable:"Ext.util.Bindable"},displayInfo:true,displayMsg:"Mostrando {0} - {1} de {2}",emptyMsg:"Sin {0} para mostrar",emptyObjType:"datos",afterDisplayMsg:"",getPagingItems:function(){var a=this;return[]},initComponent:function(){var a=this;this.afterDisplayMsg=(this.afterDisplayMsg)?this.afterDisplayMsg:"";this.emptyObjType=(this.emptyObjType)?this.emptyObjType:"datos";a.items=[];if(a.displayInfo){a.items.push("->");a.items.push({xtype:"tbtext",itemId:"displayItem"})}a.callParent();a.addEvents("change","beforechange");a.on("beforerender",a.onLoad,a,{single:true});a.bindStore(a.store||"ext-empty-store",true)},updateInfo:function(){var f=this,d=f.child("#displayItem"),a=f.store,c=f.getPageData(),b=f.afterDisplayMsg,e,g;if(d){e=a.getTotalCount();if(e===0){g=Ext.String.format(f.emptyMsg,f.emptyObjType)}else{g=Ext.String.format(f.displayMsg,c.fromRecord,c.toRecord,c.total);if(b!=""){g+=" "+b}}d.setText(g)}},onLoad:function(){var e=this,c,a,b,d,f;d=e.store.getTotalCount();f=d===0;if(!f){c=e.getPageData();a=c.currentPage;b=c.pageCount}else{a=0;b=0}Ext.suspendLayouts();e.updateInfo();Ext.resumeLayouts(true);if(e.rendered){e.fireEvent("change",e,c)}},getPageData:function(){var b=this.store,a=b.getTotalCount(),c=Math.max(b.getCount(),Math.min(b.currentPage*b.pageSize,a));return{total:a,currentPage:b.currentPage,pageCount:Math.ceil(a/b.pageSize),fromRecord:((b.currentPage-1)*b.pageSize)+1,toRecord:c}},getStoreListeners:function(){return{load:this.onLoad}},unbind:function(a){this.bindStore(null)},bind:function(a){this.bindStore(a)},onDestroy:function(){this.unbind();this.callParent()}});Ext.define("AL.model.admin.Plan",{extend:"Ext.data.Model",fields:["id","name","price","priceUSD","priceMXN","pricePEN","priceEUR","tax","taxUSD","taxMXN","taxPEN","taxEUR","maxInvoices","maxBills","maxEstimates","maxUsers","maxTransactions","additionalFeatures","pay","readOnly","classification","extraUsers","maxFiles","maxWarehouses","availableCountries","seller","priceList","status","maxIncome","available"],toMembershipObj:function(a){if(typeof a==="undefined"||["USD","MXN","PEN","EUR"].indexOf(a)===-1){a=""}var c=this.get("price"+a),b=this.get("tax"+a);return Ext.clone({planName:this.get("name"),planPrice:c,planTax:b,planMaxBills:this.get("maxBills"),planMaxEstimates:this.get("maxEstimates"),planMaxInvoices:this.get("maxInvoices"),planMaxTransactions:this.get("maxTransactions"),planMaxUsers:this.get("maxUsers"),readOnly:this.get("readOnly"),additionalFeatures:this.get("additionalFeatures"),pay:this.get("pay"),classification:this.get("classification"),maxFiles:this.get("maxFiles"),maxWarehouses:this.get("maxWarehouses"),sellers:this.get("seller"),priceLists:this.get("priceList")})}});Ext.define("AL.view.ux.form.AdvancedField",{extend:"Ext.panel.Panel",xtype:"advancedfield",alias:"widget.advancedfield",style:"background-color: #F5F4FA;",requires:["AL.view.ux.form.Switch"],type:"combo",height:54,border:false,mirrorElement:null,initComponent:function(){var b=this.label;var d=this.type;var a;var c="";if(b){if(this.mandatory){c+=('<div  class="" style="font-size: 11px; font-weight: 900; font-family: Roboto;">'+b.text+'<span style="font-size: 14px; height: 13px; top: 0; position: absolute; font-weight: 500;" class="req">*</span> '+((this.afTooltip)?'                <div id="advancedFieldTooltip'+this.name+'Container" style="float: right; position: relative; left: -6px; max-height: 16px;">                <span class="tooltip">                     <img class="tooltip" id="advancedFieldTooltip'+this.name+'" src="https://cdn1.getsoft.app/images/sm-help.png" style="width: 14px";>                </span>                </div>                ':"")+"</div>")}else{c+='<div  class="" style="font-size: 11px; font-weight: 900; font-family: Roboto;">'+b.text+((this.afTooltip)?'                <div id="advancedFieldTooltip'+this.name+'Container" style="float: right; position: relative; left: -6px; max-height: 16px;">                <span class="tooltip">                     <img class="tooltip" id="advancedFieldTooltip'+this.name+'" src="https://cdn1.getsoft.app/images/sm-help.png" style="width: 14px";>                </span>                </div>                ':"")+"</div>"}}if(d&&d=="switch"){var f=true;if(this.mirrorElement){f=this.mirrorElement.getValue()=="invoice";if(f){this.options[0].checked=true}else{this.options[1].checked=true}}a=[{xtype:"box",style:"background-color: #F5F4FA; font-size: 12px; margin-bottom: 0;",html:c},{xtype:"switch",name:this.name,options:this.options,style:"top: -1px;"}]}else{if(d&&d=="groupingcombobox"){a=[{xtype:"box",style:"background-color: #F5F4FA; font-size: 12px; margin-bottom: 0;",html:c},{xtype:"groupingcombobox",name:this.name,width:140,displayField:"name",displayTpl:'<tpl for=".">{[typeof values === "string" ? values : values["name"] + " (" + translate(values["pageSize"]) + ")"]}<tpl if="xindex < xcount">, </tpl></tpl>',groupField:["pageSize"],valueField:"id",listConfig:{afterTpl:'<div><a style="display: block; padding: 4px 0px 6px 8px;" href="/company/edit-invoice-template">'+translate("configTemplate",true)+"</a></div>",groupFieldPrefix:translate("size",true)+" ",},store:"InvoiceTemplates",labelAlign:"right",queryMode:"local",allowBlank:false,forceSelection:true,editable:false,style:"top: -2px;"}]}else{if(d&&d=="textfield"){a=[{xtype:"box",style:"background-color: #F5F4FA; font-size: 12px; margin-bottom: 0;",html:c},{xtype:"textfield",name:this.name,width:140,minLength:this.minLength,maxLength:this.maxLength,value:this.value,emptyText:this.empty,regex:this.regex,regexText:this.regexText}]}else{if(d&&d=="searchableCombo"){var e=[{xtype:"box",style:"background-color: #F5F4FA; font-size: 12px; margin-bottom: 0",html:c,},{xtype:"combo",width:140,name:this.name,emptyText:this.emptyText,allowBlank:this.allowBlank,store:this.store,displayField:this.displayField,displayTpl:this.displayTpl,valueField:this.valueField,queryMode:this.queryMode,queryParam:this.queryParam,forceSelection:this.forceSelection,autoSelect:this.autoSelect,minChars:this.minChars,width:140}];if(this.listConfig){e[1].listConfig=this.listConfig}if(this.value){e[1].value=this.value}a=e}else{var e=[{xtype:"box",style:"background-color: #F5F4FA; font-size: 12px; margin-bottom: 0",html:c,},{xtype:"combo",store:this.store,displayField:this.displayField,valueField:this.valueField,cls:"horizontal-label-radio-group advancedfield ",style:"background-color:#F5F4FA;font-size:12px;margin-bottom:0;",width:140,queryMode:"local",emptyText:translate("selectSimple",true),allowBlank:this.allowBlank,name:this.name,editable:false}];if(this.name=="currencyCustom"){e.push({xtype:"box",html:'<span class="edit-exchange-rate" id="edit-exchange-rate"></span>',})}if(this.listConfig){e[1].listConfig=this.listConfig}if(this.value){e[1].value=this.value}if(typeof this.matchFieldWidth!=="undefined"){e[1].matchFieldWidth=this.matchFieldWidth}a=e}}}}this.items=a;this.callParent()},listeners:{afterrender:function(e,d){if(this.name=="currencyCustom"){var a=Ext.ComponentQuery.query("displayfield[name=exchangeCurrencyDisplay]")[0];var c=Ext.get("edit-exchange-rate");if(c){c.el.dom.innerHTML=a.getValue()}}if(this.afTooltip){var b="advancedFieldTooltip"+this.name;var f=Ext.create("Ext.tip.ToolTip",{target:b,html:this.afTooltip,autoHide:false,name:b});f.on("show",function(){var g;f.getEl().on("mouseout",function(){g=window.setTimeout(function(){f.hide()},500)});f.getEl().on("mouseover",function(){window.clearTimeout(g)});Ext.get(b).on("mouseover",function(){window.clearTimeout(g)});Ext.get(b).on("mouseout",function(){g=window.setTimeout(function(){f.hide()},500)})})}}},getComboElement:function(){var a="combo";if(this.type=="textfield"){a="textfield"}var b=this.down(a+"[name="+this.name+"]");return b},getSwitchElement:function(){var a=this.down("switch[name="+this.name+"]");return a},getMirrorElement:function(){return this.mirrorElement}});Ext.define("AL.controller.CompanyWizard",{extend:"Ext.app.Controller",views:["wizard.CompanyWizard"],stores:[],models:[],init:function(){this.control({"wizard_CompanyWizard button[action=saveWizard]":{click:this.saveWizard},"wizard_CompanyWizard combo[name=sector]":{render:function(a){a.select("Otros")}},"wizard_CompanyWizard combo[name=regime]":{render:function(a){a.select("COMMON_REGIME")}},"window[reason=companyWizard]":{close:function(){window.location="/invoice"}}})},saveWizard:function(a){var b=a.up("form");if(this.validateCompanyWizard(b)){a.disable();b.submit({url:"/company/wizard/format/json",waitMsg:translate("loading",true),success:function(d,c){Ext.Msg.alert("Éxito","Tu configuración se ha guardado de forma exitosa",function(){window.location="/"})},failure:function(e,d,g){a.enable();var f=Ext.decode(d.response.responseText);Ext.MessageBox.alert("Error",f.cause)}})}else{Ext.MessageBox.alert("Error","Hay algunos errores en el formulario")}},validateCompanyWizard:function(e){var d=true;if(e.getForm().isValid()){var a=e.down("textfield[name=accountName]");var b=e.down("textfield[name=initialBalance]");var c=e.down("datefield[name=initialBalanceDate]");if(a.getValue()){if(!b.getValue()){b.markInvalid("El saldo inicial es un valor obligatorio");d=false}if(!c.getValue()){c.markInvalid("La fecha a la que es válido el saldo es obligatoria");d=false}}}else{d=false}return d}});Ext.define("AL.controller.LiveDemo",{extend:"Ext.app.Controller",views:["livedemo.ChartBarsParent","livedemo.ChartAccountsByType","livedemo.ChartInvoicingPerMonth","livedemo.ChartOpenBillsPerMonth","livedemo.ChartOpenInvoicesPerMonth","livedemo.PieChartSectorByCompany","livedemo.DatesFilterButtons","livedemo.AllChartsPanel","livedemo.ChartOpenBillsAndInvoices"],stores:[],models:[],init:function(){this.control({"livedemo_DatesFilterButtons button[name=lastSixMonths]":{click:function(e){var c=new Date();c=Ext.Date.subtract(c,Ext.Date.DAY,1);var a=Ext.Date.subtract(c,Ext.Date.MONTH,6);var d=Ext.Date.format(a,"Y-m-d");var b=Ext.Date.format(c,"Y-m-d");this.updateCharts(e,d,b)}},"livedemo_DatesFilterButtons button[name=lastYear]":{click:function(e){var c=new Date();c=Ext.Date.subtract(c,Ext.Date.DAY,1);var a=Ext.Date.subtract(c,Ext.Date.YEAR,2);var d=Ext.Date.format(a,"Y-m-d");var b=Ext.Date.format(c,"Y-m-d");this.updateCharts(e,d,b)}},"livedemo_DatesFilterButtons button[name=last3Months]":{click:function(e){var c=new Date();c=Ext.Date.subtract(c,Ext.Date.DAY,30);var a=Ext.Date.subtract(c,Ext.Date.MONTH,3);var d=Ext.Date.format(a,"Y-m-d");var b=Ext.Date.format(c,"Y-m-d");this.updateCharts(e,d,b)}},"livedemo_AllChartsPanel box[name=numberInvoices]":{afterrender:function(b){var a=this;Ext.TaskManager.start({run:function(){var c=Ext.ComponentQuery.query("box[name=numberInvoices]")[0];if(!c.requestInProgress){a.updateNumberInvoices(c)}},interval:600000})}},"livedemo_AllChartsPanel box[name=totalInvoiced]":{afterrender:function(b){var a=this;Ext.TaskManager.start({run:function(){var c=Ext.ComponentQuery.query("box[name=totalInvoiced]")[0];if(!c.requestInProgress){a.updateTotalInvoiced(c)}},interval:600000})}}})},updateCharts:function(d,j,e){var h=Ext.ComponentQuery.query("livedemo_DatesFilterButtons button");Ext.each(h,function(m){if(m.pressed&&d.id!=m.id){m.toggle(false)}});var b=Ext.ComponentQuery.query("livedemo_AllChartsPanel")[0];var g=Ext.ComponentQuery.query("livedemo_ChartInvoicingPerMonth")[0];if(g){var f=g.getStore();if(d.name=="lastSixMonths"){f.loadRawData(Ext.decode(b.averageInvoices6));g.redraw()}if(d.name=="lastYear"){f.loadRawData(Ext.decode(b.averageInvoices12));g.redraw()}if(d.name=="last3Months"){f.loadRawData(Ext.decode(b.averageInvoices3));g.redraw()}}var c=Ext.ComponentQuery.query("livedemo_ChartOpenInvoicesPerMonth")[0];if(c){var l=c.getStore();if(d.name=="lastSixMonths"){l.loadRawData(Ext.decode(b.averageOpenInvoices6));c.redraw()}if(d.name=="lastYear"){l.loadRawData(Ext.decode(b.averageOpenInvoices12));c.redraw()}if(d.name=="last3Months"){l.loadRawData(Ext.decode(b.averageOpenInvoices3));c.redraw()}}var a=Ext.ComponentQuery.query("livedemo_ChartOpenBillsPerMonth")[0];if(a){var k=a.getStore();if(d.name=="lastSixMonths"){k.loadRawData(Ext.decode(b.averageOpenBills6));a.redraw()}if(d.name=="lastYear"){k.loadRawData(Ext.decode(b.averageOpenBills12));a.redraw()}if(d.name=="last3Months"){k.loadRawData(Ext.decode(b.averageOpenBills3));a.redraw()}}},updateTotalInvoiced:function(a){a.requestInProgress=true;Ext.Ajax.request({url:"/labs/retrieve-total-invoiced-between-dates/format/json",timeout:60000,success:function(c){a.requestInProgress=false;var b=Ext.decode(c.responseText).total;a.update({value:"$ "+Ext.util.Format.number(b,"0,000")})}})},updateNumberInvoices:function(a){a.requestInProgress=true;Ext.Ajax.request({url:"/labs/retrieve-number-of-invoices-between-dates/format/json",timeout:60000,success:function(c){a.requestInProgress=false;var b=Ext.decode(c.responseText).total;a.update({value:Ext.util.Format.number(b,"0,000")})}})}});Ext.define("AL.controller.PriceList",{extend:"Ext.app.Controller",views:["pricelist.FormAdd","pricelist.GridAll"],stores:["PriceLists","PriceListCombo"],models:["PriceList"],init:function(){this.application.addListener("deletePriceList",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("priceList")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("priceList")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/price-list/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("togglePriceListStatus",function(c){var a=c.record;var b=c.initiator;Ext.Ajax.request({url:"/price-list/change-price-list-status/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(e,f){var h=Ext.decode(e.responseText);if(h.success){var d=b.getStore();d.load()}else{var g=h.cause;if(g=="acl-error"){Ext.create("AL.view.company.WindowAclError",{configs:{title:"¡Las listas de precios están disponibles para los planes Pyme y Pro!",text:'Para utilizar listas de precio te invitamos a elegir un plan.<br><strong><a href="/plan">Ver planes disponibles</a></strong>'}})}else{Ext.MessageBox.alert("Error",g)}}},failure:function(){}})},this),this.application.addListener("priceListCreated",function(c){var d=c.initiator;var a=c.record;var b=d.getStore();b.add(a);d.select(a.get("idLocal"))},this);this.control({"buttons_SubmitReset button[action=savePriceList]":{click:function(a){var b=Ext.ComponentQuery.query("pricelist_FormAdd")[0];if(b.isValid()){this.savePriceList(a)}}},pricelist_FormAdd:{afterrender:this.initialize},"pricelist_GridAll gridcolumn[type=priceListActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deletePriceList")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deletePriceList",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar la lista de precio ya que tiene asociaciones")}}if(d.hasCls("togglePriceListStatus")){h.preventDefault();l.fireEvent("togglePriceListStatus",{record:c,initiator:a})}}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"invoice_FormAdvancedOptions combo[name=idPriceList], recurringinvoice_FormAddRecurringInvoice combo[name=idPriceList], creditnote_FormAdvancedOptions combo[name=idPriceList], estimate_FormAdvancedOptions combo[name=idPriceList], remission_FormAdvancedOptions combo[name=idPriceList]":{beforerender:function(b){var a=b.up("form");if(a&&!a.configs){a=a.up("form")}if(a&&a.configs&&a.configs.canCreateNewPriceList){b.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="newPriceList" data-action="quickNewPriceList" class="createPriceList">'+translate("newList",true)+"</a></div>"}}}})},savePriceList:function(b){var c=Ext.ComponentQuery.query("pricelist_FormAdd")[0];var d=c.getValues();if(!c.callback){GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("priceList")})}else{d.showNotification=false}var a="/price-list/add/format/json/";if(c.type&&c.type=="edit"){a="/price-list/edit/format/json/"}Ext.Ajax.request({url:a,params:d,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){if(c.callback){var f=c.getValues();var e=Ext.create("AL.model.PriceList",f);e.set("name",f.name);c.callback(e)}else{window.location="/price-list"}}else{GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:j.cause,type:"error"})}},failure:function(){GlobalRedirector.close()}})},initialize:function(a){if(a.type&&a.type=="edit"){Ext.Ajax.request({url:"/price-list/retrieve-one/format/json/id/"+a.idLocal,success:function(c,e){var f=Ext.decode(c.responseText);if(f.success){var d=f.results;var k=a.down("textfield[name=name]");var b=a.down("radiogroup[name=dependent]");var g=a.down("radio[inputValue="+d.dependent+"]");var h=a.down("hidden[name=idLocal]");g.setValue(true);b.disable();k.setValue(d.name);h.setValue(d.idLocal);var j=a.down("textfield[name=percentage]");if(d.dependent&&d.dependent=="yes"){j.setValue(d.percentage);j.allowBlank=false}else{j.allowBlank=true}}},failure:function(){}})}},listClick:function(f,h){var g=f.up("combo");var a=this.application;var d=Ext.ComponentQuery.query("pricelist_FormAdd")[0];var b="";if(!d){d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!d){d=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!d){d=Ext.ComponentQuery.query("remission_FormAddRemission")[0]}if(d.configs&&d.configs.type){delete d.configs.type}if(h.target.getAttribute("data-action")=="quickNewPriceList"){h.preventDefault();if(d.emergent){window.open("/price-list/add","_blank");return}var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-pricelist-modal",reason:"addNewPriceList",border:false,resizable:false,width:500,title:translate("addNewList",true),bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative;",id:"createNewPriceList",items:[{xtype:"container",id:"addPriceList2",items:[{xtype:"pricelist_FormAdd",style:"margin-bottom: 0px;margin: 0 auto;",title:"",bodyPadding:0,configs:d.configs,country:d.configs.country,emergent:true,callback:function(e){c.close();a.fireEvent("priceListCreated"+b,{record:e,initiator:g})}}]},]}],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){c.close()}},{text:translate("save",true),cls:"button main-button",handler:function(e){var k=e.up("window");var j=k.down("button[action=save]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(e){var k=e.up("window");var j=k.down("form");e.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){e.setDisabled(!l)})}}}]},listeners:{afterrender:function(j){var e=j.down("button[action=save]");var k=j.down("buttons_Cancel");if(e){e.hide()}if(k){k.hide()}}}})}}});Ext.define("AL.controller.Seller",{extend:"Ext.app.Controller",models:["Seller"],views:["seller.FormAdd","seller.GridAll"],stores:["SellersCombo","Sellers"],init:function(){this.application.addListener("deleteSeller",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("seller")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("seller")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d==="yes"){Ext.Ajax.request({url:"/seller/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleSellerStatus",function(c){var a=c.record;var b=c.initiator;Ext.Ajax.request({url:"/seller/change-status/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){var d=b.getStore();d.load()}else{if(g.cause){Ext.MessageBox.alert("Error",g.cause)}}},failure:function(){}})},this),this.control({"buttons_SubmitReset button[action=saveSeller]":{click:this.saveSeller},seller_FormAdd:{render:this.initialize},"seller_GridAll gridcolumn[type=sellerActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteSeller")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteSeller",{record:c,initiator:a})}else{Ext.Msg.alert("Error",true,translate("theSellerCannotBeRemovedBecauseItHasAssociatedInvoices",{associatedInvoices:translate("associatedSalesInvoices")}))}}if(d.hasCls("toggleSellerStatus")){h.preventDefault();l.fireEvent("toggleSellerStatus",{record:c,initiator:a})}}}})},saveSeller:function(c){GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("seller")});var d=Ext.ComponentQuery.query("seller_FormAdd")[0];if(!d.getForm().isValid()){GlobalRedirector.close();GlobalMsg.showNotification({tpl:"formInvalidFields"})}else{var b="/seller/add/format/json";if(d.type&&d.type==="edit"){b="/seller/edit/format/json"}var a=d.getValues();Ext.Ajax.request({url:b,params:a,method:"POST",success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){var h=g.results;window.location="/seller"}else{GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:g.cause,type:"error"})}},failure:function(){GlobalRedirector.close()}})}},initialize:function(d){if(d.type&&d.type==="edit"){var c=d.down("hidden[name=idLocal]");var a=d.down("textfield[name=name]");var e=d.down("textfield[name=identification]");var b=d.down("textfield[name=observations]");Ext.Ajax.request({url:"/seller/retrieve-one/id/"+d.idLocal+"/format/json",success:function(f,h){var j=Ext.decode(f.responseText);var g=j.results;c.setValue(g.idLocal);a.setValue(g.name);e.setValue(g.identification);b.setValue(g.observations)}})}}});Ext.define("AL.controller.Support",{extend:"Ext.app.Controller",views:["support.WindowCreateSupportTicket",],init:function(){this.control({"support_WindowCreateSupportTicket button[action=create-ticket]":{click:this.save},support_WindowCreateSupportTicket:{afterrender:function(c){var b=c.down("container[name=frecuentQuestions]");var d=c.down("container[name=telephone-button]");var a='<div><a href="https://ayudas.getsoft.app/consejos-que-alegran/preguntas-generales/alegra-es-un-programa-de-contabilidad-para-gerentes-no-para-contadores" target="_blank">'+translate("itIsAlegraAnAccountingSystem",true)+'</a></div>\n                        <div><a href="https://ayuda.getsoft.app/descubre-todas-las-funciones-de-alegra-dise%C3%B1adas-para-contadores" target="_blank">'+translate("canIUseAlegraIfIAmAnAccountant",true)+'</a></div>\n                        <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/funciones-que-alegran/exporta-tu-informacion-desde-alegra" target="_blank">'+translate("canIExportMyInformation",true)+'</a></div>\n                        <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/preguntas-generales/alegra-funciona-con-las-niif" target="_blank">'+translate("doesAlegraWorkWithIfrs",true)+'</a></div>\n                        <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/funciones-que-alegran/consulta-e-imprime-tus-recibos-de-caja-y-comprobantes-de-egreso" target="_blank">'+translate("howCanIViewAndPrintCashReceiptsAndDisbursementVouchers",true)+"</a></div>";switch(c.country){case"usa":a='<div><a href="https://ayudas.getsoft.app/consejos-que-alegran/preguntas-generales/alegra-es-un-programa-de-contabilidad-para-gerentes-no-para-contadores" target="_blank">'+translate("itIsAlegraAnAccountingSystem",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/descubre-todas-las-funciones-de-alegra-dise%C3%B1adas-para-contadores" target="_blank">'+translate("canIUseAlegraIfIAmAnAccountant",true)+'</a></div>\n                                <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/funciones-que-alegran/exporta-tu-informacion-desde-alegra" target="_blank">'+translate("canIExportMyInformation",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/alegra-para-estados-unidos-en-espa%C3%B1ol" target="_blank">'+translate("canIGenerateInvoicesInEnglishInAlegra",true)+'</a></div>\n                                <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/funciones-que-alegran/consulta-e-imprime-tus-recibos-de-caja-y-comprobantes-de-egreso" target="_blank">'+translate("howCanIViewAndPrintCashReceiptsAndDisbursementVouchers",true)+"</a></div>";break;case"colombia":a='<div><a href="https://ayuda.getsoft.app/descubre-todas-las-funciones-de-alegra-dise%C3%B1adas-para-contadores" target="_blank">'+translate("whatAccountingFunctionsDoesAlegraHave",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/emite-facturas-de-venta-electr%C3%B3nicas-con-validaci%C3%B3n-previa-en-alegra-colombia" target="_blank">'+translate("canIIssueElectronicInvoicesWithAlegra",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/puedo-utilizar-alegra-para-manejar-mi-inventario" target="_blank">'+translate("canIHaveControlOfMyInventoryWithAlegra",true)+'</a></div>\n                                <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/preguntas-generales/alegra-funciona-con-las-niif" target="_blank">'+translate("doesAlegraWorkWithIfrs",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/c%C3%B3mo-usar-alegra-si-tienes-una-empresa-de-servicios" target="_blank">'+translate("canIUseAlegraIfIHaveAServiceCompany",true)+'</a></div>\n                                <div><a href="https://ayudas.getsoft.app/consejos-que-alegran/funciones-que-alegran/consulta-e-imprime-tus-recibos-de-caja-y-comprobantes-de-egreso" target="_blank">'+translate("howCanIViewAndPrintCashReceiptsAndDisbursementVouchers",true)+"</a></div>";break;case"mexico":a='<div><a href="https://ayuda.getsoft.app/timbra-tus-facturas-electr%C3%B3nicas-y-genera-tickets-de-venta-m%C3%A9xico" target="_blank">¿Puedo crear facturas electrónicas en Alegra México?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/nueva-versi%C3%B3n-3.3-para-cfdi-en-alegra-m%C3%A9xico" target="_blank">¿Alegra cumple con los requisitos del SAT Versión 3.3 para facturación electrónica?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/timbra-el-complemento-de-pago-en-parcialidades-para-tus-cfdi-en-la-versi%C3%B3n-3.3" target="_blank">¿Puedo generar con Alegra mis complementos de pago?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/facturaci%C3%B3n-%C3%A1gil-en-tu-terminal-de-punto-de-venta-tpv-m%C3%A9xico" target="_blank">¿Cómo puedo generar mis Ventas al público general (clientes que no tienen RFC)?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/crea-tus-productos-y-servicios-para-facturar-m%C3%A9xico-3.3" target="_blank">¿En Alegra puedo crear productos con clave y unidad de medida?</a></div>';break;case"peru":a='<div><a href="https://ayuda.getsoft.app/emite-documentos-electr%C3%B3nicos-en-alegra-per%C3%BA" target="_blank">¿Puedo emitir documentos electrónicos en Alegra?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/factura-sobre-formatos-preimpresos-per%C3%BA" target="_blank">¿En Alegra puedo hacer facturas tradicionales en papel?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/emite-notas-de-cr%C3%A9dito-electr%C3%B3nicas-en-alegra-per%C3%BA" target="_blank">¿Puedo emitir notas de crédito electrónicas?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/importa-tus-productos-y-servicios-con-unidad-de-medida-per%C3%BA" target="_blank">¿Puedo crear productos con unidad de medida?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/emite-boletas-de-venta-electr%C3%B3nicas-en-alegra-per%C3%BA" target="_blank">¿En Alegra puedo emitir boletas electrónicas?</a></div>';break;case"panama":a='<div><a href="https://ayuda.getsoft.app/puedo-utilizar-alegra-para-manejar-mi-inventario" target="_blank">¿Puedo utilizar Alegra para manejar mi inventario?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/descubre-todas-las-funciones-de-alegra-dise%C3%B1adas-para-contadores-paname%C3%B1os" target="_blank">'+translate("canIUseAlegraIfIAmAnAccountant",true)+'</a></div>\n                                <div><a href="https://ayuda.getsoft.app/c%C3%B3mo-crear-notas-de-cr%C3%A9dito-con-documento-fiscal-panam%C3%A1" target="_blank">¿Puedo crear notas crédito con documento fiscal?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/crea-retenciones-de-itbms-en-alegra-panam%C3%A1" target="_blank">¿Es posible crear retenciones de ITBMS?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/impresora-fiscal-integrada-con-alegra-panam%C3%A1-desde-la-nube" target="_blank">¿Alegra es compatible con la impresora fiscal?</a></div>';break;case"republicaDominicana":a='<div><a href="https://ayuda.getsoft.app/administra-la-contabilidad-de-tus-empresas-en-un-solo-lugar" target="_blank">Soy contador, ¿puedo llevar igualas en Alegra?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/genera-los-reportes-606-y-607-desde-alegra-rep%C3%BAblica-dominicana" target="_blank">¿Es fácil generar los formatos de envío en Alegra?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/configura-la-numeraci%C3%B3n-de-tus-comprobantes-ncf-en-alegra-rep.-dominicana" target="_blank">¿Alegra me permite crear NCF de 11 dígitos?</a></div>\n                                <div><a href="https://ayuda.getsoft.app/c%C3%B3mo-usar-alegra-si-tienes-una-empresa-de-servicios" target="_blank">¿Puedo llevar la contabilidad de una empresa de servicios?</a></div>';break}if(c.canSeeTelephone){d.update({telephone:c.containerTelephone})}else{d.height=0;d.margin="0 0 0 0"}b.update({questions:a})}}})},showSpinner:function(b,c){if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},save:function(a){if(this.validateForms()){a.disable();var c=a.up("window");var b=a.up("form");var d=b.getValues();d.url=window.location.href;Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.on("requestexception",this.hideSpinner,this);Ext.Ajax.request({url:"/support/create-ticket/format/json",params:d,method:"POST",showSpinner:true,timeout:60000,success:function(e,f){var h=Ext.decode(e.responseText);if(h.success){b.destroy();var g={xtype:"container",html:"<div>"+translate("weHaveReceivedYourRequestYouWillReceiveAResponseAsSoonAsPossibleDuringBusinessHours",true)+".</div>"};c.add(g);g={xtype:"button",text:translate("close",true),margin:"5 0 0 165",handler:function(){c.close()}};c.add(g)}else{GlobalMsg.showErrorMessage("Error","Ha ocurrido un error al crear el ticket, por favor inténtalo más tarde");c.close()}},failure:function(){GlobalMsg.showErrorMessage("Error","Ha ocurrido un error al crear el ticket, por favor inténtalo más tarde");c.close()}})}else{}},validateForms:function(){var b=Ext.ComponentQuery.query("support_WindowCreateSupportTicket form")[0];var a=true;if(b){if(!b.getForm().isValid()){a=false}}return a}});Ext.define("AL.view.account.AccountToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.account_AccountToolbar",toolbarConfig:{newButtonText:"Nueva cuenta",newButtonWidth:110,newButtonAction:"addAccount",searchEmptyText:"Buscar cuenta"}});Ext.define("AL.view.buttons.SubmitReset",{extend:"Ext.form.Panel",alias:"widget.buttons_SubmitReset",requires:["AL.view.buttons.Cancel"],buttonsConfig:{submitButtonAction:"save",submitButtonText:"Guardar"},items:[{xtype:"buttons_Cancel",width:150,height:38,cls:"sm-button-basic",style:"margin-left: 20px;",},{xtype:"button",width:150,height:38,text:translate("save",true),cls:"sm-button-primary",formBind:true,disabled:true,action:"save",style:"margin-left: 20px;",createAnother:false},{xtype:"button",width:150,height:38,name:"onlySaveAndStamp",text:translate("saveStamp",true),formBind:true,disabled:true,style:"margin-left: 20px;",createAnother:false,hidden:true,},{xtype:"splitbutton",text:translate("saveStamp",true),action:"stampTransaction",name:"stampTransactionSplitBtn",hidden:true,status:"open",style:"margin-left: 20px;",width:157,height:38,menu:new Ext.menu.Menu({id:"transactionSaveButtonDropDown",action:"saveTransaction",items:[{text:"Guardar sin timbrar",action:"save",id:"saveNoStamp",}]})}],cls:"buttons-form",frame:false,border:false,layout:{type:"hbox",pack:"end"},listeners:{render:function(d,c){var a=d.buttonsConfig;var b=d.down("button[action=save]");b.action=(a.submitButtonAction)?a.submitButtonAction:"save";b.text=(a.submitButtonText)?a.submitButtonText:"Guardar"}}});Ext.define("AL.controller.CurrencyAdjustment",{extend:"Ext.app.Controller",views:["currencyAdjustment.CurrencyAdjustmentForm","currencyAdjustment.GridAdjustmentAccounts","currencyAdjustment.GridAll","ux.grid.CheckColumn","buttons.SubmitReset"],models:["CurrencyAdjustmentAccount","CurrencyAdjustment"],stores:["CurrencyAdjustmentAccounts","CurrencyAdjustments"],init:function(){this.application.addListener("deleteCurrencyAdjustment",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:"Eliminar ajuste",msg:"¿Estás seguro de que deseas eliminar el ajuste? Esta operación no se puede recuperar.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/currency-adjustment/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{Ext.MessageBox.alert("Error",h.cause)}},failure:function(){}})}}})},this);this.control({currencyAdjustment_CurrencyAdjustmentForm:{afterrender:function(a){var c=a.down("label[name=currencyLabelBegin]");c.setText("1 "+a.configs.currency+" = ");var b=a.down("label[name=currencyLabelEnd]");b.setText(a.configs.companyCurrency);if(a.configs.type=="edit"){Ext.Ajax.request({url:"/currency-adjustment/retrieve-one/id/"+a.configs.id+"/format/json",success:function(g,j){var k=Ext.decode(g.responseText,true);if(k.success){var e=k.results;var h=e.account;a.getForm().setValues(e);var d=Ext.ComponentQuery.query("currencyAdjustment_GridAdjustmentAccounts")["0"];var m=d.getStore();var f=Ext.create("AL.model.CurrencyAdjustmentAccount",{idLocal:h.idLocal,name:h.name,balance:h.balance,balanceSecondaryCurrency:h.balanceSecondaryCurrency,newBalance:h.newBalance,gainOrLoss:h.gainOrLoss,adjustBalance:true,currencySymbol:h.currencySymbol});m.add(f);var l=d.down("gridcolumn[dataIndex=adjustBalance]");l.hide()}},failure:function(){}})}}},currencyAdjustment_GridAdjustmentAccounts:{afterrender:function(e){var f=Ext.ComponentQuery.query("currencyAdjustment_CurrencyAdjustmentForm")["0"];var b=f.configs.currency;var a=e.down("gridcolumn[dataIndex=balance]");var d=e.down("gridcolumn[dataIndex=balanceSecondaryCurrency]");var g=e.down("gridcolumn[dataIndex=newBalance]");var h=e.down("gridcolumn[dataIndex=gainOrLoss]");a.setText("Balance ("+f.configs.companyCurrency+")");d.setText("Balance ("+f.configs.currency+")");g.setText("Nuevo balance ("+f.configs.companyCurrency+")");h.setText("Ganancia/Pérdida ("+f.configs.companyCurrency+")");if(f.configs.type!="edit"){var c=e.getStore();c.proxy.url="/currency-adjustment/retrieve-accounts-by-code/format/json/currency/"+b;c.load()}}},"currencyAdjustment_CurrencyAdjustmentForm button[action=revalueCurrency]":{click:function(e){var f=e.up("form");var a=f.down("textfield[name=exchangeRate]");if(a.getValue()){var d=Ext.ComponentQuery.query("currencyAdjustment_GridAdjustmentAccounts")[0];var c=d.getStore();var b=c.getRange(0,c.getCount());Ext.each(b,function(g){var h=AL.math.approx(AL.math.mul(g.get("balanceSecondaryCurrency"),a.getValue()),2);var j=AL.math.sub(h,g.get("balance"));g.set("newBalance",h);g.set("gainOrLoss",j)})}else{GlobalMsg.showNotification({title:"Error",text:"Debes indicar la tasa de cambio.",type:"error"})}}},"buttons_SubmitReset button[action=save]":{click:function(f){f.disable();var c=Ext.ComponentQuery.query("currencyAdjustment_CurrencyAdjustmentForm")["0"];var k="Realizando ajuste";var b="/currency-adjustment/add/format/json";if(c.configs.type=="edit"){k="Editando ajuste";b="/currency-adjustment/edit/format/json/id/"+c.configs.id}GlobalRedirector.go({zoneTitle:k});var g=c.down("textfield[name=exchangeRate]");if(g.getValue()){var j=c.getValues();var a=Ext.ComponentQuery.query("currencyAdjustment_GridAdjustmentAccounts")[0];var h=a.getStore();var e=h.getRange(0,h.getCount());var d=[];if(c.configs.type!="edit"){Ext.each(e,function(l){if(l.get("adjustBalance")){d.push({idLocal:l.get("idLocal")})}})}j.accounts=Ext.encode(d);if(d.length>0||c.configs.type=="edit"){Ext.Ajax.request({url:b,method:"POST",params:j,success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){window.location="/currency-adjustment/view/id/"+n.id}else{f.enable();GlobalRedirector.close()}},failure:function(){f.enable();GlobalRedirector.close()}})}else{f.enable();GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:"Debes seleccionar al menos un banco que desees ajustar",type:"error"})}}else{f.enable();GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:"Debes indicar la tasa de cambio.",type:"error"})}}},currencyAdjustment_GridAll:{afterrender:function(b){var a=b.getStore();a.load()}},"currencyAdjustment_GridAll gridcolumn[type=actions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteCurrencyAdjustment")){h.preventDefault();l.fireEvent("deleteCurrencyAdjustment",{record:c,initiator:a})}}}})}});Ext.define("AL.view.advance.Window",{extend:"AL.view.common.SmileWindow",alias:"widget.advance_Window",reason:"applyAdvances",id:"window-apply-advances",border:false,type:"original",title:"",bodyPadding:"0 35 35 35",configs:{applyAdvancesWithoutTransaction:false},width:820,maxHeight:600,autoScroll:true,modal:true,advances:[],items:[{xtype:"form",items:[{xtype:"panel",border:false,height:30,layout:{type:"table",columns:5,tableAttrs:{}},items:[{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:translate("advanceNumber",true),width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:translate("applicationDate",true),width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:translate("amount",true),width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:translate("amountToApply",true),width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:translate("amountApplied",true),width:170}]},{xtype:"box",html:'<div id="advancesTable"></div>'},{xtype:"panel",name:"totalAdvancesApplied",border:false,style:"float:right; margin-left:400px; margin-top:20px; border: .2px solid #dcdcdc; padding:10px 0;",items:[{xtype:"displayfield",fieldLabel:translate("total",true)+" "+translate("advances"),name:"totalAdvances",labelPad:10,labelWidth:180,labelAlign:"right",labelStyle:"font-weight:bold;"},{xtype:"displayfield",fieldLabel:translate("balancePayableOnInvoice",true),name:"missingAmount",labelPad:10,labelWidth:180,labelAlign:"right",labelStyle:"font-weight:bold;"}]}],border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("cancelAction",true),action:"close",handler:function(a){var b=a.up("window");b.destroy()},margin:"10 10 0 0",height:40,cls:"button",hidden:true},{text:translate("apply",true)+" "+translate("advances"),action:"applyAdvances",formBind:true,disabled:true,margin:"10 10 0 0",height:40,cls:"button main-button",hidden:true}]}],footer:{items:[{text:translate("cancelAction",true),cls:"button",handler:function(a){var c=a.up("window");var b=c.down("button[action=close]");if(b){b.fireEvent("click",b);b.fireHandler()}}},{text:translate("apply",true)+" "+translate("advances"),cls:"button main-button",name:"applyAdvancesSmileButton",handler:function(a){var c=a.up("window");var b=c.down("button[action=applyAdvances]");if(b){b.fireEvent("click",b)}},listeners:{afterrender:function(a){var c=a.up("window");var b=c.down("button[action=applyAdvances]");a.setDisabled(b.disabled);b.on("disable",function(e,d){a.setDisabled(true)});b.on("enable",function(e,d){a.setDisabled(false)})}}}]},initComponent:function(){this.title=translate("apply",true)+" "+translate("advances")+" "+translate("toYourInvoice");this.callParent(arguments)}});Ext.define("AL.view.advance.EditWindow",{extend:"AL.view.common.SmileWindow",alias:"widget.advance_EditWindow",reason:"editAdvancesApplied",id:"window-edit-advances-applied",border:false,type:"original",bodyPadding:"0 35 35 35",configs:{},width:1100,modal:true,title:"",items:[{xtype:"form",items:[{xtype:"panel",border:false,height:30,layout:{type:"table",columns:2,tableAttrs:{}},items:[{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;margin-right: 10px;",html:"Factura",width:560},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px;text-align:center;",html:"Anticipo",width:450}]},{xtype:"panel",border:false,height:30,layout:{type:"table",columns:7,tableAttrs:{}},items:[{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Número",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Fecha",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Total",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center; margin-right:10px;",html:"Por pagar",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Monto",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Monto por aplicar",width:140},{xtype:"box",style:"font-weight:bold;border-bottom: .2px solid #90909a;padding:5px; text-align:center;",html:"Monto a aplicar",width:170}]},{xtype:"box",html:'<div id="advancesTable"></div>'}],border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:"Cancelar",action:"close",margin:"10 10 0 0",height:40,cls:"button",},{text:"Guardar",action:"saveAdvancesApplied",formBind:true,margin:"10 10 0 0",height:40,cls:"button main-button",}]}],initComponent:function(){this.title="Edita los "+translate("advances")+" aplicados a las facturas";this.callParent(arguments)}});Ext.define("AL.controller.Advance",{extend:"Ext.app.Controller",views:["advance.Window","advance.Form","advance.EditWindow","advance.EditForm","advance.Panel","advance.FormPanel"],stores:["Advances"],models:["Advance"],init:function(){var a=this;this.control({advance_Panel:{afterrender:function(b){b.init=function(){this.validateAdvancesForm=function(d,e){var e=e||false;var f=true;var h=Ext.ComponentQuery.query("advance_FormPanel");var g=0;if(h){Ext.each(h,function(m){if(m.validateForm()){var l=m.down("textfield[name=amountToApply]");var j=m.getValues();g=AL.math.add(j.amountToApply,g);if(g>d){var k="La suma de los "+translate("advances")+" aplicados es mayor al total de "+a.getTranslateType(b);if(e){k+=", ten en cuenta las retenciones aplicadas"}l.markInvalid(k);f=false}}else{f=false}})}return f};var c=Ext.get("addAdvance");if(!c){return}c.on("click",function(f,d){f.preventDefault();a.addFormPanel(b)})};b.init();a.addFormPanel(b)}},advance_FormPanel:{afterrender:function(b){b.init=function(){this.setTransaction=function(d){this.transaction=d;this.getForm().setValues({date:Ext.Date.format(AL.date(d.date),"d/m/Y"),amount:Ext.util.Format.usMoney(d.amount,this.getDecimalPrecision(),this.getCurrencySymbol()),amountAvailable:Ext.util.Format.usMoney(d.amountAvailable,this.getDecimalPrecision(),this.getCurrencySymbol())})};this.getTransaction=function(){return this.transaction};this.getDecimalPrecision=function(){var d=this.up("panel");if(!d){return null}return d.decimalPrecision};this.getCurrencySymbol=function(){var d=this.up("panel");if(!d||d&&!d.currency){return null}return d.currency.symbol};this.validateForm=function(){var d=this.getForm().isValid();var f=this.getTransaction();if(f){var e=this.down("textfield[name=amountToApply]");if(e&&e.getValue()>f.amountAvailable){d=false;e.markInvalid(translate("theApplyAmountCannotBeGreaterThanTheAmountToApply",true))}}else{d=false}return d};this.changeMinDateField=function(k,e){var j=k.down("datefield[name=date]");var h=k.down("combo[name=number]");var d=h.getSelectedRecord();var g=new Date(e);var f=new Date(d.get("date"));if(g>f){date=e}else{date=d.get("date")}j.setMinValue(date)};var c=this.down("button[name=destroy]");if(!c){return}c.on("click",function(d){var e=d.up("form");e.destroy()})};b.init()}},advance_Window:{afterrender:function(b){b.init=function(){this.setResource=function(d){this.resource=d};this.getResource=function(){return this.resource};this.setAdvances=function(d){this.advances=d;this.updateTotals()};this.getAdvances=function(){return this.advances};this.updateTotals=function(){var d=this.down("panel[name=totalAdvancesApplied]");var g=d.down("displayfield[name=totalAdvances]");var j=d.down("displayfield[name=missingAmount]");var h=this.getResource()?this.getResource():null;var k=h?h.missingAmount:null;var l=h?h.decimalPrecision:null;var f=h?h.currencySymbol:null;var e=this.getTotalApplied();if(h){k=AL.math.sub(k,e);j.setValue(Ext.util.Format.usMoney(k,l,f))}else{j.setVisible(false)}g.setValue(Ext.util.Format.usMoney(e,l,f))};this.getTotalApplied=function(){var d=Ext.ComponentQuery.query("button[action=applyAdvances]")[0];var f=this.getAdvances();var e=0;Ext.each(f,function(g){e=AL.math.add(e,g.amount)});if(e>0){d.setDisabled(false)}else{d.setDisabled(true)}return e};this.deleteAdvance=function(f){var e=this.getAdvances();var d=this.findAdvanceById(f.id);if(d!==-1){e.splice(d,1)}return e};this.updateAdvance=function(n){var k=this.getResource()?this.getResource().missingAmount:0;var l={title:"Error",message:"Ha ocurrido un error"};var f=n.amount;var e=n.date;var d=this.getAdvances();var j=d;var h=this.findAdvanceById(n.id);var g=f<=0||f==""?false:true;if(h===-1&&g){d.push(n)}else{if(!g){d=this.deleteAdvance(n)}else{n=d[h];n.amount=f;n.date=e;d[h]=n}}this.setAdvances(d);var m=this.getTotalApplied();if(AL.math.sub(k,m)<0){this.setAdvances(j);l.message=translate("theSumOfTheAdvancesAppliedExceedsTheBalancePayableOf",true)+" "+a.getTranslateType(this);return Ext.MessageBox.alert(l.title,l.message)}this.updateTotals();return true};this.findAdvanceById=function(e){var d=this.getAdvances();return d.map(function(f){return f.id}).indexOf(e)};this.validateForms=function(){var d=Ext.ComponentQuery.query("advance_Form");var e=true;Ext.each(d,function(f){if(!f.validateForm()){e=false}});return e};if(this.getAdvances()){this.updateTotals()}else{var c=[];this.setAdvances(c)}};b.init()},destroy:function(){var b=Ext.ComponentQuery.query("advance_Form");Ext.each(b,function(c){c.destroy()})}},advance_Form:{afterrender:function(b){b.init=function(){this.getTransaction=function(){return this.transaction};this.validateForm=function(){var d=this.getForm().isValid();var h=this.getTransaction();var c=Ext.ComponentQuery.query("advance_Window")[0];var g=c.getTotalApplied();var f=c.getResource();if(h){var e=this.down("textfield[name=amountToApply]");if(e&&e.getValue()>h.amountAvailable){d=false;e.markInvalid(translate("theApplyAmountCannotBeGreaterThanTheAmountToApply",true))}}else{d=false}return d}};b.init()}},advance_EditWindow:{afterrender:function(b){b.init=function(){};b.init()}},advance_EditForm:{afterrender:function(b){b.init=function(){};b.init()}},"advance_FormPanel combo[name=number]":{change:a.selectAdvanceFromCombo},"advance_FormPanel textfield[name=amountToApply]":{change:function(c){a.validateAmountAvailable(c);var b=c.up("form");a.changeValidationDateField(b)},blur:function(c){a.validateAmountAvailable(c);var b=c.up("form");a.changeValidationDateField(b)}},"advance_Form datefield[name=date],advance_FormPanel datefield[name=date]":{change:function(f,b,d){var e=f.up("form");this.changeValidationDateField(e);if(!(typeof d=="string"&&typeof b=="object")){var c=Ext.Date.format(AL.date(b),"d/m/Y");f.setRawValue(c)}},blur:function(d){var c=d.up("form");this.changeValidationDateField(c);var b=c.down("textfield[name=amountToApply]");b.fireEvent("change",b)}},"advance_Window form button[action=applyAdvances]":{click:function(d){var h=d.up("form");var g=h.up("window");if(g.validateForms()){var f=g.getAdvances();var j=g.getResource();var c;var b;var e;if(g.configs.type==="in"){c=Ext.ComponentQuery.query("transaction_FormAddInvoice");b="invoiceIdLocal";e="invoice"}else{c=Ext.ComponentQuery.query("transaction_FormAddBill");b="idBill";e="bill"}Ext.each(c,function(k){var l=k.down("hidden[name="+b+"]");if(l.getValue()==j.idLocal){if(e==="bill"){k.bill.advances=f}else{k.invoice.advances=f}var m=k.down("displayfield[name=missingAmount]");var n=AL.math.sub(j.missingAmount,g.getTotalApplied());m.setValue(Ext.util.Format.usMoney(n,j.decimalPrecision,j.currencySymbol));k.updateButtonAdvancesApplied(f.length>0);return}});if(g.configs.applyAdvancesWithoutTransaction){GlobalRedirector.go({zoneTitle:translate("applying",true)+" "+translate("advances")});Ext.Ajax.request({url:"/advance-applied/apply/id/"+j.idLocal+"/type/"+e+"/format/json",method:"POST",params:{advances:Ext.encode(f)},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){window.location.reload()}else{GlobalRedirector.close();GlobalMsg.showErrorMessage(translate("error",true),m.cause)}},failure:function(){GlobalRedirector.close();GlobalMsg.showErrorMessage(translate("error",true),translate("anErrorHasOccurredPleaseTryAgain",true))}})}else{g.destroy()}}else{Ext.MessageBox.alert(translate("error",true),translate("youMustCheckTheFieldsMarkedInRedToContinue",true))}}},"advance_Form textfield[name=amountToApply]":{change:function(f){var e=Ext.ComponentQuery.query("window[reason=applyAdvances]")[0];var d=f.up("form");var c=d.down("textfield[name=amountToApply]");var b=d.down("datefield[name=date]");this.changeValidationDateField(d);if(d.validateForm()){var h=d.getTransaction();var g={id:h.id,amount:f.getValue(),amountAvailable:h.amountAvailable,date:b.getValue()};if(e.updateAdvance(g)!==true){c.setValue("")}}},blur:a.validateAmountAvailable},"advance_EditWindow form button[action=close]":{click:function(b){var c=b.up("window");c.destroy()}},"advance_EditWindow form button[action=saveAdvancesApplied]":{click:function(d){var c=Ext.ComponentQuery.query("advance_EditForm");var b=[];var f=true;Ext.each(c,function(j){if(j.isValid()){var h=j.down("textfield[name=amountToApply]");b.push({id:j.advanceApplied.categoryTransaction.id,idAdvanceApplied:j.advanceApplied.id,amount:h.getValue()})}else{f=false}});if(!f){return Ext.MessageBox.alert(translate("error",true),translate("checkTheFieldsMarkedInRed",true))}GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("advances")});var e=d.up("window");var g=e.idTransaction;Ext.Ajax.request({method:"POST",params:{advancesApplied:Ext.encode(b)},url:"/advance-applied/edit/format/json",success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){window.location.reload()}else{GlobalRedirector.close();var l=k.cause?k.cause:translate("thereIsAProblemWithTheForm",true)+".";Ext.Msg.alert(translate("error",true),l)}},failure:function(){GlobalRedirector.close();Ext.Msg.alert(translate("error",true),translate("anErrorHasOccurredPleaseTryAgain",true))}})}},"advance_EditForm textfield[name=amountToApply]":{change:function(d){var c=d.up("form");if(c.configs.verifyChanges){var b=c.advanceApplied;var e=b.resource;if(d.getValue()>e.limitMissingAmount){d.setValue(e.limitMissingAmount);return Ext.MessageBox.alert(translate("error",true),"El monto aplicado no puede superar el saldo pendiente por pagar de "+a.getTranslateType(c))}if(d.getValue()>b.categoryTransaction.limitAmountAvailable){d.setValue(b.categoryTransaction.limitAmountAvailable);return Ext.MessageBox.alert(translate("error",true),"El monto aplicado no puede superar el monto pendiente por aplicar")}if(d.getValue()>b.amount){e.missingAmount=AL.math.sub(e.missingAmount,AL.math.sub(d.getValue(),b.amount));b.categoryTransaction.amountAvailable=AL.math.sub(b.categoryTransaction.amountAvailable,AL.math.sub(d.getValue(),b.amount))}else{if(d.getValue()<b.amount){e.missingAmount=AL.math.add(e.missingAmount,AL.math.sub(b.amount,d.getValue()));b.categoryTransaction.amountAvailable=AL.math.add(b.categoryTransaction.amountAvailable,AL.math.sub(b.amount,d.getValue()))}else{b.categoryTransaction.amountAvailable=0}}b.amount=d.getValue();var f=Ext.ComponentQuery.query("advance_EditForm");Ext.each(f,function(j){var g=j.down("displayfield[name=amountAvailable]");var k=j.down("displayfield[name=missingAmount]");var h=j.advanceApplied.resource;if(e.idLocal===h.idLocal){h.missingAmount=e.missingAmount;h.limitMissingAmount=AL.math.add(e.missingAmount,b.amount);k.setValue(Ext.util.Format.usMoney(h.missingAmount,h.decimalPrecision,h.currencySymbol))}j.advanceApplied.categoryTransaction.amountAvailable=b.categoryTransaction.amountAvailable;g.setValue(Ext.util.Format.usMoney(b.categoryTransaction.amountAvailable,h.decimalPrecision,h.currencySymbol))})}}},"advance_EditForm button[action=deleteAdvanceApplied]":{click:function(b){var c=b.up("form");var f="¿Estás seguro de que deseas eliminar el anticipo para esta "+a.getTranslateType(c,false,true)+"? <br> Esta operación no se puede deshacer.";var d=c.advanceApplied.resource;if(d.status==="closed"||d.state==="closed"){var e=(d.invoiceNumber?d.invoiceNumber:d.billNumber)!==""?" número: "+(d.invoiceNumber?d.invoiceNumber:d.billNumber):" con fecha: "+Ext.Date.format(AL.date(d.date),"d/m/Y");f="¿Estás seguro de que deseas eliminar el anticipo para esta "+a.getTranslateType(c,false,true)+"? <br> Esta operación abrirá nuevamente "+a.getTranslateType(c)+e}Ext.Msg.show({title:"Eliminar aplicación de anticipo",msg:f,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g=="yes"){GlobalRedirector.go({zoneTitle:"Eliminando anticipo"});Ext.Ajax.request({url:"/advance-applied/delete/format/json",method:"POST",params:{id:c.advanceApplied.id},success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){window.location.reload()}else{GlobalRedirector.close();Ext.MessageBox.alert("Error",k.cause)}},failure:function(){GlobalRedirector.close()}})}}})}},"menuitem[action=applyAdvances]":{click:function(c){var f=c.up("form");var g=c.up("button");var e=null;var d="in";if(g){d=g.typeTransaction;e=d==="in"?g.idLocal:g.idType}else{if(f){var b=f.down("hidden[name=invoiceIdLocal]")?f.down("hidden[name=invoiceIdLocal]"):f.down("hidden[name=idBill]");d=f.down("hidden[name=idBill]")?"out":"in";e=b.getValue()}}Ext.Ajax.on("beforerequest",a.showSpinner,a,translate("loading",true));Ext.Ajax.on("requestcomplete",a.hideSpinner,a);Ext.Ajax.request({showSpinner:true,url:"/advance-applied/retrieve-open-advances/type/"+d+"/id/"+e+"/format/json",success:function(l,n){var o=Ext.decode(l.responseText);if(!o.success){return g?GlobalMsg.showErrorMessage("Error",o.cause):Ext.MessageBox.alert("Error",o.cause)}if(o.results.length<=0){var h="El cliente no tiene saldo a favor disponible por aplicar";if(d==="out"){h="No tienes saldo a favor disponible"}return g?GlobalMsg.showErrorMessage("Error",h,true,"error"):Ext.MessageBox.alert("Error",h)}var k=o.resource;var j=[];if(f&&k){if(d==="out"){j=f.bill.advances?f.bill.advances.slice(0):null}else{j=f.invoice.advances?f.invoice.advances.slice(0):null}}var p=Ext.create("AL.view.advance.Window",{type:d,configs:{applyAdvancesWithoutTransaction:g?true:false,type:d,translateType:translate(d==="in"?"invoice":"bill")},resource:k,advances:j});p.show();var s=o.results;var r=p.down("form");var q=k?k.decimalPrecision:null;var m=k?k.currencySymbol:null;Ext.each(s,function(x){var A=Ext.create("AL.view.advance.Form",{renderTo:"advancesTable",transaction:x});r.setHeight(r.getHeight()+60);var t;if(j){var z=p.findAdvanceById(x.id);if(z!==-1){t=j[z]}}var v=A.down("datefield[name=date]");var y=Ext.Date.format(AL.date(x.date),"d/m/Y");var B=new Date(g.date);var w=new Date(x.date);var u=new Date();if(B>w){y=g.date}else{y=x.date}v.setMinValue(y);if(u>new Date(y)){y=u}v.setRawValue(y);A.getForm().setValues({id:x.id,number:x.number,date:Ext.Date.format(AL.date(y),"d/m/Y"),amount:Ext.util.Format.usMoney(x.total,q,m),amountAvailable:Ext.util.Format.usMoney(x.amountAvailable,q,m),amountToApply:t?t.amount:""})});p.setAdvances(j)},failure:function(){GlobalRedirector.close();GlobalMsg.showErrorMessage("Error","Ha ocurrido un error, por favor intentalo de nuevo")}})}},"menuitem[action=editAdvancesApplied]":{click:function(c){var d=c.up("menu");var b=d.up("transaction_MoreActionsButton");var e=b.idType;Ext.Ajax.on("beforerequest",a.showSpinner,a,translate("loading",true));Ext.Ajax.on("requestcomplete",a.hideSpinner,a);Ext.Ajax.request({showSpinner:true,url:"/advance-applied/retrieve-all/id/"+e+"/format/json",success:function(g,h){var k=Ext.decode(g.responseText);if(!k.success){return GlobalMsg.showErrorMessage("Error",k.cause)}var j=Ext.create("AL.view.advance.EditWindow",{idTransaction:e});j.show();var f=k.results;Ext.each(f,function(l){l.resource.limitMissingAmount=AL.math.add(l.resource.missingAmount,l.amount);l.categoryTransaction.limitAmountAvailable=AL.math.add(l.categoryTransaction.amountAvailable,l.amount);var m=Ext.create("AL.view.advance.EditForm",{renderTo:"advancesTable",type:l.type,advanceApplied:l,configs:{verifyChanges:false}});j.setHeight(j.getHeight()+60);m.getForm().setValues({number:l.resource.invoiceNumber?l.resource.invoiceNumber:l.resource.billNumber,date:Ext.Date.format(AL.date(l.resource.date),"d/m/Y"),total:Ext.util.Format.usMoney(l.resource.total,l.resource.decimalPrecision,l.resource.currencySymbol),missingAmount:Ext.util.Format.usMoney(l.resource.missingAmount,l.resource.decimalPrecision,l.resource.currencySymbol),amount:Ext.util.Format.usMoney(l.categoryTransaction.total,l.resource.decimalPrecision,l.resource.currencySymbol),amountAvailable:Ext.util.Format.usMoney(l.categoryTransaction.amountAvailable,l.resource.decimalPrecision,l.resource.currencySymbol),amountToApply:l.amount,id:l.id});m.configs.verifyChanges=true})},failure:function(){GlobalMsg.showErrorMessage("Error","Ha ocurrido un error, por favor intentalo de nuevo")}})}}})},getTranslateType:function(b,c,d){c=c||false;d=d||false;var a;if(d){a=b.type==="in"?translate("invoice",c):translate("bill",c)}else{a=b.type==="in"?translate("theInvoice")+" "+translate("invoice",c):"la "+translate("bill",c)}return a},addFormPanel:function(c){var b=Ext.ComponentQuery.query("#advancesContainer")[0];var e=Ext.create("AL.view.advance.FormPanel");var a=e.down("combo[name=number]");var d=Ext.create("AL.store.Advances");d.getProxy().url="/advance-applied/retrieve-open-advances/type/"+c.type+"/idClient/"+c.client.idLocal+"/currency/"+c.currency.code+"/format/json";d.load();a.store=d;b.add(e);a.focus(false,true)},validateAmountAvailable:function(c){var b=c.up("form");var a=false;if(b.validateForm()){a=true}return a},selectAdvanceFromCombo:function(c){var g=c.getSelectedRecord();if(g){var a=c.up("form");if(this.validateRecordByValue(g.get("id"),a)){var h=Ext.ComponentQuery.query("datefield[name=date]")[0];var d=a.down("datefield[name=date]");d.show();var j=new Date(h.getValue());var e=new Date(g.get("date"));var b=new Date();if(j>e){date=h.getValue()}else{date=g.get("date")}d.setMinValue(date);if(b>new Date(date)){date=b}d.setRawValue(date);a.setTransaction({date:date,amount:g.get("total"),amountAvailable:g.get("amountAvailable")});var f=a.down("textfield[name=amountToApply]");f.enable();f.focus(false,true)}else{a.getForm().setValues({number:"",date:"",amount:"",amountAvailable:"",amountToApply:""});var f=a.down("textfield[name=amountToApply]");f.disable();var d=a.down("datefield[name=date]");d.hide()}}},validateRecordByValue:function(e,c){var b=Ext.ComponentQuery.query("advance_FormPanel");var a=b.indexOf(c);b.splice(a,1);var d=true;Ext.each(b,function(f){var g=f.down("combo[name=number]");if(g&&g.getValue()==e){d=false}});return d},showSpinner:function(b,c,d){d=d?d:"Enviando...";if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},changeValidationDateField:function(b){var a=b.down("textfield[name=amountToApply]");var c=b.down("datefield[name=date]");if(a&&a.getValue()!=""){c.skipValidation=false}else{c.skipValidation=true;c.clearInvalid()}}});Ext.define("AL.view.advancedFunction.Panel",{extend:"Ext.form.Panel",alias:"widget.advancedFunction_Panel",border:false,width:500,height:120,bodyPadding:"5 5 5 10",requires:["AL.view.buttons.Cancel"],items:[],buttons:[{xtype:"buttons_Cancel",height:23,width:65,cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),action:"save",cls:"sm-button-primary",height:38,width:157}]});Ext.define("AL.controller.AdvancedFunction",{extend:"Ext.app.Controller",views:["advancedFunction.Panel"],init:function(){this.control({advancedFunction_Panel:{beforerender:function(a){var b=Ext.Object.getValues(a.configs.advancedFunctions);Ext.each(b,function(c,e){if(e>0){a.height+=25}var f=false;if(c.isActive){f=true}var d={xtype:"checkboxfield",boxLabel:c.name,name:"advancedFunction",checked:f};if(c.tooltipMessage){d.msgTarget="side";d.afterBodyEl='<div class="tooltip-wrapper" style="left: 140px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: 15px;top: -15px;"><div class="tooltip-text-wrapper tooltip-small" style="width : 275px;"><div class="text">'+c.tooltipMessage+"</div></div></div></div>"}a.add(d)})}},"advancedFunction_Panel button[action=save]":{click:function(d){var b=Ext.dom.Query.select(".layout")[0];var e=Ext.create("AL.LoadMask",{target:b,msg:translate("saving",true)});e.show();var c=d.up("panel");var g=Ext.Object.getValues(c.configs.advancedFunctions);var f=Ext.ComponentQuery.query("checkboxfield[name=advancedFunction]");var a=[];Ext.each(f,function(h,j){var k=false;if(h.checked){k=true}a.push({value:g[j].key,active:k})});Ext.Ajax.request({url:"/advanced-function/update-advanced-functions/format/json",method:"POST",params:{advancedFunctions:Ext.encode(a)},success:function(h){response=Ext.decode(h.responseText);if(response.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage("Error",response.cause)}}})}}})}});Ext.define("AL.view.bill.FormAddRetention",{extend:"AL.view.common.AddRetention",alias:"widget.bill_FormAddRetention"});Ext.define("AL.view.bill.FormCloseBill",{extend:"AL.view.common.SmileWindow",alias:"widget.bill_FormCloseBill",layout:"fit",style:"background: transparent",bodyStyle:"background: transparent",autoShow:true,border:false,title:"",modal:true,items:[{frame:true,xtype:"form",name:"formCloseBill",bodyStyle:"padding:15px; background: transparent",style:"background-color: transparent; border: none;",width:700,defaults:{labelAlign:"right",labelPad:32,labelWidth:240,msgTarget:"side"},items:[{xtype:"box",cls:"modal-subtitle",html:"<div>"+translate("chooseTheAccountingAccountIntoWhichYouWantToAddTheBalanceToClose",true)+" "+translate("theBill")+" "+translate("supplierInvoice")+".</div>"},{xtype:"datefield",fieldLabel:translate("date",true),style:"text-align: left;",name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",width:550,blankText:translate("itIsNecessaryToDefineTheDateOnWhichYouWantToClose",true)+" "+translate("theBill")+" "+translate("supplierInvoice"),invalidText:"{0}"+translate("itIsNotAValidDateItMust")+"{1}"},{xtype:"groupingcombobox",fieldLabel:translate("category",true)+" "+translate("thatReceivesTheBalance"),style:"text-align: left;",store:"CategoriesCombo",id:"category_FormCloseBill",name:"idCategory",style:"margin-bottom:20px;",width:550,groupField:["parentName"],valueField:"idLocal",displayField:"text",disabledField:"blocked",disabledValue:"yes",emptyText:translate("selectSimple",true)+" "+translate("category"),allowBlank:false,forceSelection:false,editable:false},{xtype:"textarea",fieldLabel:translate("observations",true),style:"text-align: left",width:550,name:"observations",allowBlank:true,}],buttons:[{text:translate("cancelAction",true),action:"close",margin:"10 10 0 0",height:40,cls:"button",hidden:true},{text:translate("save",true),formBind:true,action:"save",margin:"10 10 0 0",height:40,cls:"button main-button",hidden:true}]}],footer:{items:[{text:translate("cancelAction",true),cls:"button",handler:function(a){var c=a.up("window");var b=c.down("button[action=close]");if(b){b.fireEvent("click",b)}}},{text:translate("save",true),cls:"button main-button",handler:function(a){var c=a.up("window");var b=c.down("button[action=save]");if(b){b.fireEvent("click",b)}},listeners:{afterrender:function(a){var c=a.up("window");var b=c.down("form");a.setDisabled(b.hasInvalidField());b.on("validitychange",function(e,d){a.setDisabled(!d)})}}}]},initComponent:function(){this.title=translate("close",true)+" "+translate("supplierInvoice")+" "+translate("withOutstandingBalance");this.callParent(arguments)}});Ext.define("AL.store.EconomicActivities",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/economicActivities/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.SaleConditions",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/saleConditions/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.PaymentMethods",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/paymentMethods/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.billingdetail.FormAdd",{extend:"Ext.form.Panel",requires:["AL.view.ux.fields.Address","AL.view.ux.fields.Name"],alias:"widget.billingdetail_FormAdd",createInvoice:false,createJiraIssue:false,title:"",defaultType:"textfield",bodyPadding:25,width:550,defaults:{labelAlign:"right",labelPad:15,labelWidth:170,width:420,msgTarget:"side"},items:[{xtype:"checkboxfield",boxLabel:translate("useMyCompanysInformation",true),name:"use-company-info",checked:false,margin:"0 0 20 0",},{xtype:"nameField",name:"nameComponent",labelWidth:167.5,fullWidth:233,marginAllItems:"0 0 5 2",orders:[{colombia:4}]},{xtype:"combo",name:"identificationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("identificationType",true),store:"IdentificationTypes",valueField:"key",displayField:"value",displayTpl:'<tpl for=".">{abbreviature} - {value}</tpl>',forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{abbreviature} - {value}</div></tpl>'},queryMode:"local",editable:true,countries:["colombia"],requires:["colombia"],hidden:true,orders:[{colombia:1}]},{xtype:"panel",layout:"hbox",margin:"0 0 10 0",items:[{xtype:"container",name:"identificationLabelContainer",layout:{type:"hbox",pack:"end"},flex:1,items:[{xtype:"label",cls:"x-form-item-label",name:"labelIdentification",html:translate("identification",true)+'<span class="req">*</span>'}],},{xtype:"container",name:"identificationFieldContainer",layout:{type:"hbox"},flex:1.48,items:[{xtype:"textfield",margin:"0 0 0 15",width:150,name:"identification",allowBlank:false,allowOnlyWhitespace:false,maxLength:45,id:"clientIdentidicationTextField",orders:[{colombia:1}]}]},{xtype:"container",name:"identificationCoDvLabelContainer",layout:{type:"hbox",pack:"end"},flex:0.3,items:[{xtype:"box",cls:"x-form-item-label",html:'DV<span class="req">*</span>'}]},{xtype:"container",name:"identificationCoDvFieldContainer",layout:{type:"hbox"},flex:0.3,items:[{xtype:"textfield",margin:"0 0 0 15",width:19,name:"co_dv",regex:/^[0-9]*$/,maxLength:1,orders:[{colombia:2}]}]}]},{xtype:"combo",name:"kindOfPerson",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("kindOfPerson",true),store:"KindsOfPerson",valueField:"id",displayField:"value",queryMode:"local",editable:false,hidden:true,countries:["colombia"],requires:["colombia"],orders:[{colombia:3}]},{xtype:"combo",name:"regime",fieldLabel:translate("regime",true),store:"Regimes",valueField:"key",displayField:"display",queryMode:"local",forceSelection:true,allowBlank:true,editable:false,hidden:true,matchFieldWidth:false,displayTpl:'<tpl for=".">{display}</tpl>',listConfig:{width:300,tpl:'<tpl for="."><div class="x-boundlist-item">{display}</div></tpl>'},countries:["colombia"],requires:["colombia"],},{xtype:"addressField",name:"addressComponent",labelWidth:165,fullWidth:233,marginAllItems:"0 0 8 3",},{fieldLabel:translate("phone",true),name:"phone",allowBlank:false,allowOnlyWhitespace:false,maxLength:45},{fieldLabel:translate("email",true),name:"email",allowBlank:false,allowOnlyWhitespace:false,regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:translate("emailFormatError",true),afterBodyEl:'<div style="color: gray; font-size: 11px; font-weight: bold;">'+translate("weWillSendYourAlegraPurchaseBillToThisEmail",true)+"</div>",maxLength:100},{xtype:"label",html:'<div class="required-anotation window">'+translate("requiredText",true)+"</div>"}],buttons:[{text:translate("send",true),action:"saveBillingDetail"}],initComponent:function(){if(!this.configs){this.configs={}}if(this.configs.country!="colombia"){this.configs.originalCountry=this.configs.country;this.configs.country="other";this.items.splice(7,0,{xtype:"combo",name:"country",fieldLabel:translate("country",true),allowBlank:false,allowOnlyWhitespace:false,store:"Countries",valueField:"value",displayField:"value",queryMode:"local",forceSelection:true,})}this.callParent(arguments)},listeners:{beforerender:function(d){d.executeActionsBeforeRender();var a=d.down("addressField[name=addressComponent]");a.setCountry(d.configs.country);a.on("beforerender",function(){a.down("displayfield[name=label]").allowBlank=false;d.down("combo[name=country]").allowBlank=false;if(d.configs.country=="colombia"){var g=a.down("textfield[name=description]");d.down("combo[name=department]").allowBlank=false;d.down("combo[name=city]").allowBlank=false}else{if(d.configs.originalCountry=="costaRica"){a.down("textfield[name=address]").emptyText="Ubicación";a.down("displayfield[name=label]").fieldLabel="Ubicación"}var g=a.down("textfield[name=address]");d.down("textfield[name=city]").allowBlank=false}g.allowBlank=false;g.allowOnlyWhitespace=false});var b=null,f=140;switch(this.configs.originalCountry){case"panama":b="RUC";f=37;break;case"peru":b="RUC o Número de DNI";f=149.5;break;case"mexico":b="RFC o INE";f=74;break;case"chile":b="RUT";f=37;break;case"republicaDominicana":b="RNC o cédula";f=95;break;default:break}if(b){b+='<span class="req">*</span>';var c=d.down("label[name=labelIdentification]");c.setWidth(f);c.html=b}var e=d.down("textfield[name=identification]");e.regex=new RegExp("^[A-z0-9]*$");e.regexText="Solo se admiten letras y números";Ext.Ajax.request({url:"/billing-detail/retrieve-info/format/json",success:function(h,r){var s=Ext.decode(h.responseText),B=s.countryName;if(s.success&&s.billingDetail){var A=s.billingDetail;var D=d.down("textfield[name=name]"),C=d.down("addressField[name=addressComponent]"),n=d.down("textfield[name=phone]"),v=d.down("textfield[name=email]");if(A.identification){A.identification=A.identification.replace("-","").replace(".","")}D.setValue(A.name);e.setValue(A.identification);n.setValue(A.phone);v.setValue(A.email);if(A.country){B=A.country}var t={city:A.city,};if(d.configs.country=="colombia"){t={addressObject:{city:A.city,description:A.address,country:A.country,department:A.department,}};B=false;var o=d.down("combo[name=identificationType]"),u=o.getStore();if(A.identificationType){o.suspendEvents();if(u.hasLoaded()){o.select(A.identificationType);o.resumeEvents()}else{o.getStore().load({callback:function(){o.select(A.identificationType);o.resumeEvents()}})}}var k=d.down("combo[name=kindOfPerson]"),m=k.getStore();if(A.kindOfPerson){if(m.hasLoaded()){k.select(A.kindOfPerson)}else{m.on("load",function(){k.select(A.kindOfPerson)})}}var l=d.down("combo[name=regime]"),w=l.getStore();if(A.regime){if(w.hasLoaded()){var z=w.findRecord("key",A.regime);if(z){l.select(z)}}else{w.on("load",function(){var E=w.findRecord("key",A.regime);if(E){l.select(E)}})}}if(A.identificationType=="NIT"){k.show();l.show();var j=d.down("[name=identificationLabelContainer]");var y=d.down("[name=identificationCoDvLabelContainer]");var g=d.down("[name=identificationCoDvFieldContainer]");var q=j.up("panel");e.setWidth(150);j.flex=1.42;q.doLayout();y.show();g.show()}else{l.hide()}if(Ext.isEmpty(A.firstName)&&Ext.isEmpty(A.secondName)&&Ext.isEmpty(A.lastName)){d.down("textfield[name=firstName]").setValue(A.name)}else{d.down("textfield[name=firstName]").setValue(A.firstName)}d.down("textfield[name=secondName]").setValue(A.secondName);d.down("textfield[name=lastName]").setValue(A.lastName);d.down("textfield[name=co_dv]").setValue(A.co_dv)}else{t.address=A.address}C.setValues(t)}if(B){var p=d.down("textfield[name=country]"),x=p.getStore();if(x.hasLoaded()){p.setValue(B)}else{x.on("load",function(){p.setValue(B)})}}},failure:function(){}})},}});Ext.define("AL.view.billingdetail.WindowIncompleteInfo",{alias:"billingdetail_WindowIncompleteInfo",extend:"AL.view.common.SmileWindow",modal:true,autoShow:true,closable:false,resizable:false,draggable:true,border:false,bodyStyle:"background:#fff;",title:translate("completeTheNextInformationToContinue",true),bodyBorder:false,items:[{xtype:"box",cls:"modal-title",style:"margin-top: 15px; padding: 0px 35px; margin-bottom: 0px;",html:"<div>Para poder enviarte tu factura de compra de Alegra es necesario que completes los siguientes datos</div>"},{xtype:"billingdetail_FormAdd",createJiraIssue:true,border:false,margin:"0 35 10 35",width:620,bodyPadding:"25 25 25 45",}]});Ext.define("AL.store.IdentificationTypes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/identificationTypes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.KindsOfPerson",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/kindsOfPerson/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Regimes",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/regimes/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Countries",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/countries/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Departments",{extend:"Ext.data.Store",model:"AL.model.CountryLegalParameter",autoLoad:false,autoLoadBeforeRender:true,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/departments/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.Cities",{extend:"Ext.data.Store",model:"AL.model.City",autoLoad:false,autoLoadBeforeRender:false,proxy:{type:"ajax",url:"/country-legal-info/retrieve-parameters-by-key/key/cities/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.controller.BillingDetail",{extend:"Ext.app.Controller",stores:["IdentificationTypes","KindsOfPerson","Regimes","Countries","Departments","Cities",],models:[],views:["billingdetail.FormAdd","billingdetail.WindowIncompleteInfo","ux.fields.Address","ux.fields.Name",],init:function(){var a=this;this.control({billingdetail_FormAdd:{},"billingdetail_FormAdd textfield, billingdetail_FormAdd combobox":{change:function(h,g,d){var e=h.up("form");var f=e.getForm().findField("use-company-info"),c=e.companyInfo;if(c&&f.getValue()){var b=c[h.getName()];switch(h.getName()){case"city":switch(e.companyCountry){case"colombia":case"argentina":case"peru":b=c.addressObject.city;break;case"costaRica":b=c.addressObject.canton;break}break;case"country":b=c.countryName;break;case"department":case"description":b=c.addressObject[h.getName()];break;case"address":switch(e.companyCountry){case"colombia":case"costaRica":b=c.addressObject.description;break;case"peru":case"argentina":b=c.addressObject.address;break}break}if(g!=b&&(d==b||(!d&&!b))){f.setValue(false)}}}},"billingdetail_FormAdd checkbox[name=use-company-info]":{change:function(d,e,b,f){var c=d.up("form");if(d.getValue()){if(!c.companyInfo){Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,j){var h=Ext.decode(g.responseText);if(h.success){c.companyInfo=h.results;c.companyCountry=h.country;a.setCompanyInfo()}},failure:function(){Ext.Msg.show({title:"Error",msg:translate("anErrorHasOccurredPleaseTryAgain",true),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}else{a.setCompanyInfo()}}}},"billingdetail_FormAdd combo[name=identificationType]":{change:function(t){var d=t.up("form");switch(d.configs.country){case"colombia":var b=t.getSelectedRecord()?t.getSelectedRecord().data:null;var f=d.down("combo[name=kindOfPerson]");var g=d.down("combo[name=regime]");var l=d.down("[name=identification]");var k=d.down("[name=country]");var q=d.down("textfield[name=co_dv]");var e=d.down("[name=identificationLabelContainer]");var o=d.down("[name=identificationCoDvLabelContainer]");var c=d.down("[name=identificationCoDvFieldContainer]");var m=e.up("panel");var r="^[A-z0-9]*$",h="Solo se admiten letras y números";if(b&&b.rules){switch(b.rules.type){case"int":r="^[0-9]*$";break}}if(r){r=new RegExp(r)}l.regex=r;l.regexText=h;var u=false;if(b&&b.key=="NIT"){if(l.getValue()&&l.getValue()!==""){q.setValue(a.calculateDv(l.getValue()))}var j=f.getStore();var n=g.getStore();if(j.hasLoaded()){f.setValue("1")}else{j.on("load",{callback:function(){f.setValue("1")}})}if(n.hasLoaded()){g.setValue("COMMON_REGIME")}else{n.on("load",{callback:function(){g.setValue("COMMON_REGIME")}})}f.show();g.show();l.setWidth(150);e.flex=1.42;m.doLayout();o.show();c.show();if(k&&k.getValue()!="Colombia"){u="Colombia"}}else{var j=f.getStore();var n=g.getStore(),p=b&&b.id==42?"0-99":"2",s=b&&b.id==42?"COMMON_REGIME":"SIMPLIFIED_REGIME",u=b&&b.id==42?null:"Colombia";if(j.hasLoaded()){f.setValue(p)}else{j.on("load",{callback:function(){f.setValue(p)}})}if(n.hasLoaded()){g.setValue(s)}else{n.on("load",{callback:function(){g.setValue(s)}})}f.hide();g.hide();l.allowBlank=true;q.setValue("");q.allowBlank=true;c.hide();o.hide();e.flex=1;m.doLayout();l.setWidth(234);this.changeLabelIdentificationComponent(true)}if(k&&d.type!=="edit"&&u!==false){k.setValue(u)}d.isValid();break}}},"billingdetail_FormAdd textfield[name=identification]":{change:function(d,f,b){var c=d.up("form");if(c.configs){switch(c.configs.country){case"colombia":var g=c.down("[name=identificationType]");if(g.getValue()=="NIT"){var e=c.down("[name=co_dv]");if(d.getValue()!=""||e.getValue()!=""){d.allowBlank=false;e.allowBlank=false}else{d.allowBlank=true;e.allowBlank=true}d.isValid();e.isValid()}break}}},blur:function(c){var b=c.up("form");if(b.configs){switch(b.configs.country){case"colombia":var f=b.down("[name=identificationType]");var e=b.down("[name=identification]");var d=b.down("[name=co_dv]");if(f.getValue()=="NIT"){d.setValue(a.calculateDv(c.getValue()))}e.isValid();d.isValid();break}}}},"billingdetail_FormAdd [name=co_dv]":{render:function(f){var e=f.up("form");var h=e.down("[name=identification]");var g=e.down("[name=identificationLabelContainer]");var c=e.down("[name=identificationCoDvLabelContainer]");var b=e.down("[name=identificationCoDvFieldContainer]");var d=g.up("panel");f.allowBlank=true;b.hide();c.hide();g.flex=1;d.doLayout();h.setWidth(234)},change:function(d,f,b){var c=d.up("form");var e=c.down("[name=identification]");if(e.getValue()!=""||d.getValue()!=""){e.allowBlank=false;d.allowBlank=false}else{e.allowBlank=true;d.allowBlank=true}e.isValid();d.isValid()}},"billingdetail_FormAdd combo[name=kindOfPerson]":{change:function(j){var f=j.up("form");switch(f.configs.country){case"colombia":var g=f.down("nameField[name=nameComponent]");var b=j.getSelectedRecord()?j.getSelectedRecord().data:null;var d=f.down("combo[name=regime]");var h=d.getStore();if(b){g.changeVisibilitySpecificNameFields(b.id==2)}var c=h.findExact("key","SIMPLIFIED_REGIME");if(b&&b.id==1&&c!=-1){if(h.hasLoaded()){h.remove(h.getAt(c));d.setValue("COMMON_REGIME")}else{h.on("load",{callback:function(){h.remove(h.getAt(c));d.setValue("COMMON_REGIME")}})}}else{if(c==-1){var e={id:f.configs.electronicInvoicingVersion=="2.0"?"0":"ZY",key:"SIMPLIFIED_REGIME",display:"No responsable del IVA",value:"Régimen simplificado"};if(h.hasLoaded()){h.add(e);d.select(h.getAt(0))}else{h.on("load",{callback:function(){h.add(e);d.select(h.getAt(0))}})}}}break}}},"billingdetail_FormAdd button[action=saveBillingDetail]":{click:this.save}})},setCompanyInfo:function(){var t=Ext.ComponentQuery.query("billingdetail_FormAdd")[0],q=t.companyInfo,s="",l={},d={};if(!q){return}if(q.identification){q.identification=q.identification.replace("-","").replace(".","")}t.down("textfield[name=name]").setValue(q.name);t.down("textfield[name=identification]").setValue(q.identification);t.down("textfield[name=phone]").setValue(q.phone);t.down("textfield[name=email]").setValue(q.email);switch(t.companyCountry){case"colombia":s=q.addressObject.city;l={addressObject:{department:q.addressObject.department,city:s,description:q.addressObject.description,}};var h=t.down("combo[name=identificationType]"),m=h.getStore();if(q.identificationType){if(m.hasLoaded()){h.select(q.identificationType)}else{h.getStore().load({callback:function(){h.select(q.identificationType)}})}}var c=t.down("combo[name=kindOfPerson]"),g=c.getStore();if(q.kindOfPerson){if(g.hasLoaded()){c.select(q.kindOfPerson)}else{g.on("load",function(){c.select(q.kindOfPerson)})}}var f=t.down("combo[name=regime]"),o=f.getStore();if(q.regime){if(o.hasLoaded()){var p=o.findRecord("key",q.regime);if(p){f.select(p)}}else{o.on("load",function(){var u=o.findRecord("key",q.regime);if(u){f.select(u)}})}}if(q.identificationType=="NIT"){c.show();f.show();var j=t.down("[name=identification]");var b=t.down("[name=identificationLabelContainer]");var r=t.down("[name=identificationCoDvLabelContainer]");var a=t.down("[name=identificationCoDvFieldContainer]");var k=b.up("panel");j.setWidth(150);b.flex=1.42;k.doLayout();r.show();a.show()}else{f.hide()}if(Ext.isEmpty(q.firstName)&&Ext.isEmpty(q.secondName)&&Ext.isEmpty(q.lastName)){t.down("textfield[name=firstName]").setValue(q.name)}else{t.down("textfield[name=firstName]").setValue(q.firstName)}t.down("textfield[name=secondName]").setValue(q.secondName);t.down("textfield[name=lastName]").setValue(q.lastName);t.down("textfield[name=co_dv]").setValue(q.co_dv);break;case"costaRica":s=q.addressObject.canton;l={city:s,};d={department:q.addressObject.province,city:s,district:q.addressObject.district,neighborhood:q.addressObject.neighborhood,address:q.addressObject.description,};break;case"mexico":if(q.mx_locality){s=q.mx_locality}else{s=""}l={city:s,};d={address:q.address};if(q.mx_street){d={mx_street:Ext.String.trim(q.mx_street)?"Calle "+Ext.String.trim(q.mx_street):null,mx_exteriorNumber:Ext.String.trim(q.mx_exteriorNumber)?" "+Ext.String.trim(q.mx_exteriorNumber):null,mx_interiorNumber:Ext.String.trim(q.mx_interiorNumber)?" No interior: "+Ext.String.trim(q.mx_interiorNumber):null,mx_colony:Ext.String.trim(q.mx_colony)?" "+Ext.String.trim(q.mx_colony):null,mx_municipality:Ext.String.trim(q.mx_municipality)?" "+Ext.String.trim(q.mx_municipality):null,mx_locality:Ext.String.trim(q.mx_locality)?" "+Ext.String.trim(q.mx_locality):null,mx_state:Ext.String.trim(q.mx_state)?" "+Ext.String.trim(q.mx_state):null,mx_zipCode:Ext.String.trim(q.mx_zipCode)?" "+Ext.String.trim(q.mx_zipCode):null,mx_country:Ext.String.trim(q.mx_country)?" "+Ext.String.trim(q.mx_country):null,}}break;case"peru":s=q.addressObject.city;l={city:s,};d={department:q.addressObject.state,city:s,district:q.addressObject.district,urbanization:q.addressObject.urbanization,ubigeoCode:q.addressObject.ubigeoCode,address:q.addressObject.address,};break;case"argentina":s=q.addressObject.city;l={city:s,};d={department:q.addressObject.province,city:s,postalCode:q.addressObject.postalCode,address:q.address,};break;case"chile":s=q.addressObject.city;l={city:s,};d={description:q.addressObject.description,region:q.addressObject.region,commune:q.addressObject.commune,city:s,};break;default:s=q.city;l={city:s,address:q.address,};break}if(!Ext.Object.isEmpty(d)){var n=[];for(var e in d){if(!d[e]){continue}n.push(d[e])}l.address=n.join(", ")}t.down("combo[name=country]").setValue(q.countryName);t.down("addressField[name=addressComponent]").setValues(l)},isFormValid:function(){var a=Ext.ComponentQuery.query("billingdetail_FormAdd")[0];var b=a.isValid();b=a.down("addressField[name=addressComponent]").isValid()&&b;if(a.configs.country=="colombia"){var c=a.down("[name=identificationType]");if(c.getValue()&&c.getValue()!=""&&!c.getSelectedRecord()){c.markInvalid("Selecciona un "+translate("identificationType")+" de la lista");b=false}}return b},save:function(d){d.disable();var a=Ext.ComponentQuery.query("billingdetail_FormAdd")[0];var e=a.up("window");var j=a.getValues();delete j["use-company-info"];if(this.isFormValid()){var g="/billing-detail/edit/format/json";if(a.createJiraIssue){g+="/createJiraIssue/yes"}else{if(a.createInvoice){g+="/createInvoice/yes"}}if(["colombia"].indexOf(a.configs.country)!==-1){var b=a.down("addressField[name=addressComponent]"),f=b.getValues();for(var h in f){switch(h){case"description":j.address=f[h];break;case"address":case"country":case"department":case"city":default:j[h]=f[h];break}}}var c=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});c.show();Ext.Ajax.request({url:g,params:j,success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){var n=Ext.emptyFn;if(e){e.close()}else{n=function(){window.location="/"}}Ext.Msg.show({title:translate("success",true),msg:translate("theInformationForYourAlegraPurchaseInvoiceHasBeenProcessedSuccessfully",true)+". "+translate("ifYouHaveNotReceivedYourInvoiceYouWillSoonReceiveItInTheMailYouEntered",true),width:300,buttons:Ext.Msg.OK,listeners:{close:n},fn:function(o){n()}})}else{d.enable()}c.destroy()},failure:function(){d.enable();c.destroy()}})}else{d.enable()}},calculateDv:function(f){if(isNaN(f)||f.length>15){return}var c;var e=[3,7,13,17,19,23,29,37,41,43,47,53,59,67,71];var d=0;for(var a=0;a<f.length;a++){d+=(f[a]*e[f.length-a-1])}var b=d%11;c=[0,1].indexOf(b)!==-1?b:11-b;return(c||c==0)?c:null},changeLabelIdentificationComponent:function(a){var b=Ext.ComponentQuery.query("billingdetail_FormAdd label[name=labelIdentification]")[0];if(b){if(a){b.getEl().dom.innerHTML=translate("identification",true)}else{b.getEl().dom.innerHTML=translate("identification",true)+'<span class="req">*</span>'}}},});Ext.define("AL.view.category.CategoryToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.category_InvoiceToolbar",toolbarConfig:{newButtonText:"Nueva "+translate("category"),newButtonWidth:140,newButtonAction:"addCategory",searchEmptyText:"Buscar "+translate("category")}});Ext.define("AL.view.category.GridTransactions",{extend:"Ext.grid.Panel",alias:"widget.category_GridTransactions",requires:["AL.plugin.grid.PageSize"],title:"",style:"margin:10px  0px 10px;",scroll:true,width:1024,border:true,frame:true,minHeight:390,store:"Transactions",columnLines:true,cls:"grid-category-transactions grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene transacciones asociadas!</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:"Beneficiario",dataIndex:"name",flex:1,renderer:this.renderLink,sortable:false},{header:"Estado",dataIndex:"status",renderer:this.renderStatus,width:100,align:"center",sortable:false},{header:"Detalle",dataIndex:"associations",width:250,sortable:false},{header:"Antes de impuestos",dataIndex:"subTotal",align:"right",width:120,sortable:false,renderer:this.renderSubTotal},{header:"Después de impuestos",dataIndex:"total",align:"right",width:120,sortable:false,renderer:this.renderTotal}];this.callParent(arguments)},renderStatus:function(e,h,b,c,g,f,d){var j="invoiceOpen";var a="";if(e=="void"){j="invoiceVoid";a=translate("canceledMale",true)}return'<span class="'+j+'">'+a+"</span>"},renderSubTotal:function(e,j,b,c,g,f,d){var a=b.get("hasCategories")?b.get("subTotal"):b.get("proportionalPayment");var h="";if(b.get("type")==="out"){h="money-out";a=AL.math.mul(-1,a)}return"<span class="+h+">"+Ext.util.Format.usMoney(a,b.get("decimalPrecision"))+"</span>"},renderTotal:function(e,j,b,c,g,f,d){var a=b.get("proportionalPayment");var h="";if(b.get("type")==="out"){h="money-out";a=AL.math.mul(-1,a)}return"<span class="+h+">"+Ext.util.Format.usMoney(a,b.get("decimalPrecision"))+"</span>"},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/transaction/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/transaction/view/id/'+b+'">'+f+"</a>"}return a}});Ext.define("AL.view.category.CrudForm",{extend:"AL.view.common.SmileWindow",id:"window-new-category-modal",alias:"widget.category_CrudForm",style:"background: transparent",bodyStyle:"background: transparent",autoShow:true,border:false,modal:true,boxTitle:"",width:450,accountType:null,items:[{frame:true,xtype:"form",bodyStyle:"padding:0px 15px 0px 0px; background: transparent",style:"padding:0px 0px 0px 0px;",defaults:{labelAlign:"right",labelPad:15,msgTarget:"side",width:400,labelWidth:140},items:[{xtype:"container",name:"parent",html:"<div></div>",cls:"category-field-content",countries:["mexico"],},{xtype:"textfield",name:"name",fieldLabel:translate("name",true),allowBlank:false,cls:"category-field-content",},{xtype:"textfield",name:"code",fieldLabel:translate("code",true),hidden:true,maxLength:15,cls:"category-field-content",},{xtype:"textarea",name:"description",fieldLabel:translate("description",true),cls:"category-field-content",},{xtype:"displayfield",name:"nature",fieldLabel:"Naturaleza",value:" ",countries:["mexico"],only:["mexico"],cls:"category-field-content",},{xtype:"box",autoEl:{tag:"div",style:"border-top: 1px solid #F2F2F2;margin:10px 0px 15px 0px;width:120%"},countries:["mexico"],only:["mexico"]},{xtype:"container",name:"parent",html:'<div class="category-accounting">Contabilidad electrónica</div>',countries:["mexico"],only:["mexico"],cls:"category-field-content",},{xtype:"combo",fieldLabel:'Agrupador SAT <img id="satGroupingCodeTooltip2" class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png" style="position: relative; top: 3px;">',name:"groupingCode",triggerAction:"all",allowBlank:true,hidden:false,store:"GroupingCodes",emptyText:"Buscar...",displayField:"keyAndName",valueField:"key",id:"groupingCodeCombo",minChars:0,blankText:"Debes seleccionar una clave del agrupador",msgTarget:"side",validateOnBlur:true,validateOnChange:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{key} - {name}</div></tpl>',width:282,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list"},validator:function(a){if(this.getSelectedRecord()||a==""){return true}return"Debes seleccionar una opción"},countries:["mexico"],only:["mexico"],cls:"category-field-content",},{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"accountType"},{xtype:"hidden",name:"groupingText"}],buttons:[{text:translate("cancelAction",true),action:"close",margin:"10 10 0 0",height:40,hidden:true},{text:translate("save",true),action:"save",margin:"10 10 0 0",height:40,hidden:true,}]},],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),name:"btnSave",cls:"button main-button",handler:function(a){var c=a.up("window");var b=c.down("button[action=save]");if(b){b.fireEvent("click",b)}},listeners:{afterrender:function(a){var c=a.up("window");var b=c.down("form");a.setDisabled(b.hasInvalidField());b.on("validitychange",function(e,d){a.setDisabled(!d)});if(c.editRecord){a.setText(translate("save",true))}else{a.setText(translate("add",true))}}}}]},listeners:{beforerender:function(){var c=this.down("form");if(c){var a=c.items.getRange();if(a){for(var b=0;b<a.length;b++){if(a[b].only&&typeof a[b].only==="object"){if(a[b].only.indexOf(this.country)!==-1){a[b].show()}else{a[b].hide()}}else{a[b].show()}}}}},afterrender:function(){var e=this.down("container[name=parent]");var c=this.down("displayfield[name=nature]");var a=this.down("form");var g=this.down("combo[name=groupingCode]");var j=this.down("hidden[name=accountType]");var f=this.down("hidden[name=groupingText]");if(this.parentRecord){f.setValue("");record=this.parentRecord}else{record=this.editRecord.parentNode;if(record.get("text")=="Root"){record=this.editRecord}if(this.country&&this.country=="mexico"){var h=record.get("metadata");var f=this.down("hidden[name=groupingText]");if(h.satGroupingText&&f){f.setValue(h.satGroupingText)}}}if(e){e.getEl().dom.innerHTML='<div class="category-parent">'+translate("itBelongsTo",true)+' <span class="category-parent-name">'+record.get("text")+"</span></div>"}if(a){var d=a.getForm().getFields();if(d){d.each(function(l){if(l.name=="code"){l.labelEl.dom.innerHTML=translate("accountNumber",true)}Ext.apply(l,{labelAlign:"left"})});a.updateLayout()}}if(this.country&&this.country=="mexico"){if(c&&j){var k=record.getPath("text");var b=k.split("/");if(this.setAccountType&&this.setAccountType!="NA"){b[2]=this.setAccountType}if(this.setAccountType&&this.setAccountType!="NA"){b[2]=this.setAccountType}if(b[2]){switch(b[2].toLowerCase()){case"activos":c.setValue("Deudora");j.setValue(100);break;case"pasivos":c.setValue("Acreedora");j.setValue(200);break;case"patrimonio":c.setValue("Acreedora");j.setValue(300);break;case"ingresos":c.setValue("Acreedora");j.setValue(400);break;case"egresos":c.setValue("Deudora");j.setValue(500);break;default:c.hide();g.setDisabled(true);j.setValue(1000);break}}}g.getStore().on("beforeload",function(l,m){var n=m.params&&m.params.query;if(m.params){m.params.accountType=j.getValue()}})}}},initComponent:function(){this.callParent(arguments)},getFieldValuesAsMetadata:function(){var c=null;var b=this.country?this.country:null;switch(b){case"mexico":var d=this.down("combo[name=groupingCode]");var a=this.down("hidden[name=groupingText]");c={};if(d){c.satGroupingCode=d.getValue()}if(a){c.satGroupingText=a.getValue()}break}return c},setFieldValuesFromMetadata:function(d){var a=this.country?this.country:null;switch(a){case"mexico":if(d.satGroupingCode&&typeof d.satGroupingCode!=="undefined"){var e=this.down("combo[name=groupingCode]");var c=this.down("hidden[name=groupingText]");if(e){var b=e.getStore();b.load({params:{query:d.satGroupingCode},callback:function(){e.select(d.satGroupingCode);c.setValue(d.satGroupingText)}})}}}}});Ext.define("AL.view.category.GridCreditNotes",{extend:"Ext.grid.Panel",alias:"widget.category_GridCreditNotes",requires:["AL.plugin.grid.PageSize"],title:"",scroll:true,style:"margin: 10px 0px;",width:1024,border:true,frame:true,minHeight:390,columnLines:true,cls:"grid-category-transactions grid-with-icons",store:"CreditNotes",dockedItems:[{xtype:"pagingtoolbar",store:"CreditNotes"}],viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene "+translate("creditNote")+" asociadas!</div></div></div>"},plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:translate("creditNote",true),dataIndex:"creditNoteNumber",align:"center",width:90,renderer:this.renderLink},{header:"Cliente",dataIndex:"name",flex:2,renderer:this.renderLink,sortable:false},{header:"Fecha",dataIndex:"date",align:"center",width:90,renderer:this.renderDate},{header:"Total antes de impuestos",dataIndex:"subTotal",align:"right",flex:1,sortable:false,renderer:this.renderMoney},{header:"Total después de impuestos",dataIndex:"total",align:"right",flex:1,sortable:false,renderer:this.renderMoney},];this.callParent(arguments)},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/credit-note/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/credit-note/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.category.GridBills",{extend:"Ext.grid.Panel",alias:"widget.category_GridBills",requires:["AL.plugin.grid.PageSize"],title:"",scroll:true,style:"margin: 10px 0px;",width:1024,border:true,frame:true,minHeight:390,store:"Bills",columnLines:true,cls:"grid-category-transactions grid-with-icons",dockedItems:[{xtype:"pagingtoolbar",store:"Bills"}],viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene facturas de compra asociadas!</div></div></div>"},plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Factura",dataIndex:"billNumber",align:"center",name:"billNumber",width:90,renderer:this.renderLink},{header:"Proveedor",name:"name",dataIndex:"name",flex:2,renderer:this.renderLink,sortable:false},{header:"Fecha",dataIndex:"date",align:"center",width:90,renderer:this.renderDate},{header:"Total antes de impuestos",dataIndex:"subTotal",align:"right",flex:1,sortable:false,renderer:this.renderMoney},{header:"Total después de impuestos",dataIndex:"total",align:"right",flex:1,sortable:false,renderer:this.renderMoney},];this.callParent(arguments)},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/bill/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/bill/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.category.GridInvoices",{extend:"Ext.grid.Panel",alias:"widget.category_GridInvoices",requires:["AL.plugin.grid.PageSize"],title:"",scroll:true,style:"margin: 10px 0px;",width:1024,border:true,frame:true,minHeight:390,columnLines:true,cls:"grid-category-transactions grid-with-icons",store:"Invoices",dockedItems:[{xtype:"pagingtoolbar",store:"Invoices"}],viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene "+translate("invoices")+" asociadas!</div></div></div>"},plugins:[{ptype:"grid_PageSize"}],country:null,initComponent:function(){var a;switch(this.country){case"costaRica":a=110;break;case"republicaDominicana":default:a=90;break}this.columns=[{header:translate("invoice",true),dataIndex:"invoiceNumber",align:"center",width:a,sortable:false,renderer:this.renderNumber},{header:"Cliente",dataIndex:"name",flex:3,renderer:this.renderLink,sortable:false},{header:"Fecha",dataIndex:"date",align:"center",width:90,renderer:this.renderDate},{header:"Total antes de impuestos",dataIndex:"subTotal",align:"right",flex:2,sortable:false,renderer:this.renderMoney},{header:"Total después de impuestos",dataIndex:"total",align:"right",flex:2,sortable:false,renderer:this.renderMoney},];this.callParent(arguments)},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return this.recordLink(b,Ext.Date.format(d,"d/m/Y"))},renderNumber:function(e,j,b,c,g,f,d){var a=d.up("grid"),h=e;if(a.country=="costaRica"){h=AL.format.ellipsis(h,16,5);j.tdAttr='data-qtip="'+b.get("invoiceNumber")+'"'}return this.recordLink(b,h)},renderLink:function(f,g,b,h,d,c,a){var e="";if(f){e=this.recordLink(b,f)}return e},recordLink:function(a,c,b){b=typeof(b)==="undefined"?"/invoice/view/id/"+a.get("idLocal"):b;return'<a href="'+b+'">'+c+"</a>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.category.GridDebitNotes",{extend:"Ext.grid.Panel",alias:"widget.category_GridDebitNotes",requires:["AL.plugin.grid.PageSize"],title:"",scroll:true,style:"margin: 10px 0px;",width:1024,border:true,frame:true,minHeight:390,columnLines:true,cls:"grid-category-transactions grid-with-icons",store:"DebitNotes",dockedItems:[{xtype:"pagingtoolbar",store:"DebitNotes"}],viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene notas débito asociadas!</div></div></div>"},plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Nota débito",dataIndex:"idLocal",align:"center",width:90,renderer:this.renderCode},{header:"Proveedor",dataIndex:"name",flex:2,renderer:this.renderLink,sortable:false},{header:"Fecha",dataIndex:"date",align:"center",width:90,renderer:this.renderDate},{header:"Total antes de impuestos",dataIndex:"subTotal",align:"right",flex:1,sortable:false,renderer:this.renderMoney},{header:"Total después de impuestos",dataIndex:"total",align:"right",flex:1,sortable:false,renderer:this.renderMoney},];this.callParent(arguments)},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/debit-note/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderCode:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/debit-note/view/id/'+b+'">'+c.get("debitNoteNumber")+"</a>"}return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/debit-note/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.category.GridJournals",{extend:"Ext.grid.Panel",alias:"widget.category_GridJournals",requires:["AL.plugin.grid.PageSize"],title:"",style:"margin:10px  0px 10px;",scroll:true,width:1024,border:true,frame:true,minHeight:390,store:"Journals",columnLines:true,cls:"grid-category-journals grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-category-journals .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡Esta '+translate("category")+" aún no tiene "+translate("journals")+" "+translate("associatedJournals")+"!</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Journals"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Número",dataIndex:"idLocal",renderer:this.renderLink,},{header:"Fecha",dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:"Referencia",dataIndex:"reference"},{header:"Observaciones",width:250,dataIndex:"observations",flex:1,renderer:this.renderObservations,sortable:false},{header:"Monto",dataIndex:"total",renderer:this.renderTotal,width:100,align:"right",sortable:false}];this.callParent(arguments)},renderObservations:function(e,f,b,h,d,c,a){var g=b.get("observations");return"<span>"+g+"</span>"},renderTotal:function(e,j,b,c,g,f,d){var a=b.get("amount");var h="";if(b.get("type")==="out"){h="money-out";a=AL.math.mul(-1,a)}return"<span class="+h+">"+Ext.util.Format.usMoney(a,b.get("decimalPrecision"))+"</span>"},renderLink:function(c,d,a){var b="";if(c){b='<a href="/journal/view/id/'+a.get("idLocal")+'">'+c+"</a>"}return b},renderDate:function(f,j,b,c,h,g,d){var a=AL.date(f),e=Ext.Date.format(a,"d/m/Y");return this.renderLink(e,j,b)},});Ext.define("AL.store.Journals",{extend:"Ext.data.Store",model:"AL.model.Journal",autoLoad:false,sorters:[{property:"date",direction:"DESC"}],proxy:{type:"ajax",url:"/journal/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.controller.Category",{extend:"Ext.app.Controller",views:["category.Tree","category.FormAdd","category.CategoryToolbar","category.GridTransactions","category.CrudTree","category.CrudForm","category.GridRetentionsApplied","category.GridTaxesApplied","category.GridCreditNotes","category.GridBills","category.GridInvoices","category.GridDebitNotes","category.GridJournals"],stores:["Categories","Transactions","RetentionsApplied","TaxesApplied","CreditNotes","Bills","Invoices","DebitNotes","Journals","GroupingCodes"],models:["Category","Transaction","RetentionApplied","TaxApplied","CreditNote","Bill","Invoice","DebitNote","GroupingCode"],init:function(){this.control({"buttons_SubmitReset button[action=saveCategory]":{click:this.saveCategory},"category_InvoiceToolbar button[action=addCategory]":{click:function(){window.location="/category/add"}},"report_DatesForm button[action=renderCategories]":{click:function(a){if(this.validateDateForm()){var b=a.up("form");var w=b.down("datefield[name=fromDate]");var k=b.down("datefield[name=toDate]");var p=w.getValue();var v=k.getValue();var q=p.getFullYear()+"-"+(p.getMonth()+1)+"-"+p.getDate();var l=v.getFullYear()+"-"+(v.getMonth()+1)+"-"+v.getDate();var t=b.configs.idCategory,n=b.configs.idCategoryDebtsToPayProviders,m=b.configs.idCategoryReceivableAccounts,o=b.configs.idCategorySalesReturns,r=b.configs.idCategoryDebtsToPayReturns,f=b.configs.idCategoryReceivableAccountReturns,d=b.configs.idCategoryItemPurchasesReturns,j=b.configs.idCategoryAdvanceIn,u=b.configs.idCategoryAdvanceOut;var c=Ext.get("exportBtn");var e=Ext.ComponentQuery.query("panel[name=categoryTabPanel]")[0];if(e){e.destroy()}var g;var s;var h=Ext.create("Ext.tab.Panel",{name:"categoryTabPanel",border:false,renderTo:"categoryTransactionsHolder",style:"background: transparent; margin-top:20px;",bodyStyle:"background: transparent;",minTabWidth:168,tabBar:{style:"background: transparent;"},items:[{title:"Transacciones",border:false,id:"transactions",bodyStyle:"background: transparent; ",style:"background: transparent",items:[{xtype:"category_GridTransactions"},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value" id="subTotalTransactions"></div><div class="value" id="totalTransac"></div></div><div id="category-anotation" class="anotation"></div></div>',height:74}],listeners:{activate:function(){c.show()},afterrender:function(x){var y=x.down("category_GridTransactions");g=y.getStore();s=g.getProxy();s.url="/category/retrieve-associations-by-type/type/transactions/id/"+t+"/format/json/fromDate/"+q+"/toDate/"+l;g.remoteSort=true;s.extraParams={fromDate:q,toDate:l};g.load({callback:function(){var A=0;var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/transactions/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(C,D){var B=Ext.decode(C.responseText);if(B.success){A=B.subTotal;z=B.total;Ext.get("subTotalTransactions").setHTML(Ext.util.Format.usMoney(A,2));Ext.get("totalTransac").setHTML(Ext.util.Format.usMoney(z,2));Ext.get("category-anotation").setHTML("**No incluye las transacciones "+translate("canceledFemalePlural"))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales de las transacciones no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}},{title:"Facturas de compra",border:false,id:"bills",bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"category_GridBills"},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value" id="subTotalBills"></div><div class="value" id="totalBills"></div></div></div>'}],listeners:{activate:function(){c.hide()},afterrender:function(x){var y=x.down("category_GridBills");if(t==n){y.view.emptyText='<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message" >¡Puedes consultar el reporte de cuentas por pagar <a style = "color: #888888;" href="/report/bills-open">aquí</a>!</div></div></div>'}else{g=y.getStore();g.remoteSort=true;s=g.getProxy();s.url="/category/retrieve-associations-by-type/format/json/type/bills/id/"+t+"/fromDate/"+q+"/toDate/"+l;g.load({callback:function(){var A=0;var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/bills/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(C,D){var B=Ext.decode(C.responseText);if(B.success){A=B.total;z=B.subTotal;Ext.get("subTotalBills").setHTML(Ext.util.Format.usMoney(z,2));Ext.get("totalBills").setHTML(Ext.util.Format.usMoney(A,2))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}}},{title:translate("invoices",true),border:false,id:"invoices",bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"category_GridInvoices",country:b.configs.country},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value" id="subTotalInvoices"></div><div class="value" id="totalInvoices"></div></div></div>'}],listeners:{activate:function(){c.hide()},afterrender:function(x){var y=x.down("category_GridInvoices");if(t==m){y.view.emptyText='<style>.grid-category-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message" >¡Puedes consultar el reporte de cuentas por cobrar <a style = "color: #888888;" href="/report/invoices-open">aquí</a>!</div></div></div>'}else{g=y.getStore();g.remoteSort=true;s=g.getProxy();s.url="/category/retrieve-associations-by-type/format/json/type/invoices/id/"+t+"/fromDate/"+q+"/toDate/"+l;g.load({callback:function(){var A=0;var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/invoices/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(C,D){var B=Ext.decode(C.responseText);if(B.success){A=B.total;z=B.subTotal;Ext.get("subTotalInvoices").setHTML(Ext.util.Format.usMoney(z,2));Ext.get("totalInvoices").setHTML(Ext.util.Format.usMoney(A,2))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}}},{title:"Notas débito",id:"debitNotes",border:false,bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"category_GridDebitNotes"},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value" id="subTotalDebitNotes"></div><div class="value" id="totalDebitNotes"></div></div></div>'}],listeners:{activate:function(){c.hide()},afterrender:function(x){var y=x.down("category_GridDebitNotes");g=y.getStore();g.remoteSort=true;s=g.getProxy();s.url="/category/retrieve-associations-by-type/format/json/type/debitNotes/id/"+t+"/fromDate/"+q+"/toDate/"+l;g.load({callback:function(){var A=0;var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/debitNotes/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(C,D){var B=Ext.decode(C.responseText);if(B.success){A=B.total;z=B.subTotal;Ext.get("subTotalDebitNotes").setHTML(Ext.util.Format.usMoney(z,2));Ext.get("totalDebitNotes").setHTML(Ext.util.Format.usMoney(A,2))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales  no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}},{title:translate("journals",true),id:"journals",border:false,borderStyle:"background: transparent",style:"background: transparent",items:[{xtype:"category_GridJournals",},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value right" id="totalJournals"></div></div></div>',}],listeners:{activate:function(){c.hide()},afterrender:function(y){var x=y.down("category_GridJournals");g=x.getStore();g.remoteSort=true;s=g.getProxy();s.url="/category/retrieve-associations-by-type/format/json/type/journals/id/"+t+"/fromDate/"+q+"/toDate/"+l;g.load({callback:function(){var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/journals/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(B,C){var A=Ext.decode(B.responseText);if(A.success){z=A.total;Ext.get("totalJournals").setHTML(Ext.util.Format.usMoney(z,2))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}}],listeners:{beforerender:function(A){var y=A.down("#invoices");var z=A.down("#bills");var B=A.down("#debitNotes");if(b.configs.taxCategory=="yes"||b.configs.retentionCategory=="yes"){y.destroy();z.destroy();B.destroy()}if(t==o){z.destroy();B.destroy()}if(t==m){z.destroy();B.destroy()}if(t==n){y.destroy();B.destroy()}if(t==r){y.destroy();B.destroy();z.destroy()}if(t==f){y.destroy();z.destroy()}if(t==d){y.destroy();z.destroy();var x=A.down("#transactions");x.destroy()}if(t==u||t==j){y.destroy();z.destroy();B.destroy()}}}});if(t==o||t==r){h.add({title:translate("creditNote",true),border:false,bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"category_GridCreditNotes"},{xtype:"box",html:'<div id="total-subtotal"><div class="total-row"><div class="label">Totales</div><div class="value" id="subTotalCreditNotes"></div><div class="value" id="totalCreditNotes"></div></div></div>'}],listeners:{afterrender:function(x){c.hide();var y=x.down("category_GridCreditNotes");g=y.getStore();g.remoteSort=true;s=g.getProxy();s.url="/category/retrieve-associations-by-type/format/json/type/creditNotes/id/"+t+"/fromDate/"+q+"/toDate/"+l;g.load({callback:function(){var A=0;var z=0;if(g.count()>0){Ext.Ajax.request({url:"/category/retrieve-associations-total-by-type/type/creditNotes/format/json/id/"+t+"/fromDate/"+q+"/toDate/"+l,success:function(C,D){var B=Ext.decode(C.responseText);if(B.success){A=B.total;z=B.subTotal;Ext.get("subTotalCreditNotes").setHTML(Ext.util.Format.usMoney(z,2));Ext.get("totalCreditNotes").setHTML(Ext.util.Format.usMoney(A,2))}},failure:function(){Ext.Msg.show({title:"Ocurrio un error",msg:"Los totales  no se pudieron cargar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}})}}})}}}},"category_GridTaxesApplied, category_GridRetentionsApplied":{render:function(c){var a=c.getStore();var b=Ext.get("total-wrapper");if(b){a.on("load",function(e,d){var f=0;Ext.each(d,function(g){f+=parseFloat(g.get("amount"))});b.setHTML(Ext.util.Format.usMoney(f))})}}},category_CrudTree:{render:this.initialize},"category_CrudTree gridcolumn[type=actions]":{click:function(g,l,q,p,s,d){var r=Ext.get(s.target),c=g.up("treepanel");if(!r.hasCls("viewCategoryDetails")){s.preventDefault()}var b=c.getSelectionModel().getSelection()[0];var n="";if(b.get("keyCountry")){n=b.get("keyCountry")}else{if(c.country){n=c.country}else{if(c.configs.country){n=c.configs.country}}}var u=translate("add",true)+" "+translate("category");var t="NA";if(c.setAccountType){t=c.setAccountType}var t="NA";if(c.setAccountType){t=c.setAccountType}if(r.hasCls("addCategoryAction")){Ext.create("AL.view.category.CrudForm",{parentRecord:b,boxTitle:u,title:u,setAccountType:t,showCategoriesCode:c.showCategoriesCode,emergent:c.emergent,country:n})}else{if(r.hasCls("editCategoryAction")){u="Editar "+translate("category");var f=Ext.create("AL.view.category.CrudForm",{editRecord:b,boxTitle:u,title:u,setAccountType:t,showCategoriesCode:c.showCategoriesCode,emergent:c.emergent,country:n});var m=f.down("textfield[name=name]"),k=f.down("textfield[name=description]"),a=f.down("textfield[name=code]"),o=f.down("hidden[name=idLocal]");m.setValue(b.get("text"));k.setValue(b.get("description"));a.setValue(b.get("code"));f.setFieldValuesFromMetadata(b.get("metadata"));o.setValue(b.get("idLocal"))}else{if(r.hasCls("toggleCategoryBlocked")){if(!r.hasCls("disabled")){Ext.Ajax.request({url:"/category/toggle-blocked/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(e,j){var w=Ext.decode(e.responseText);if(w.success){b.set("blocked",w.blocked);b.commit();c.doLayout()}else{var v=w.cause?w.cause:"No se pudo cambiar el estado de la "+translate("category")+", vuelve a intentarlo";if(c.emergent){Ext.MessageBox.alert("Error",v)}else{GlobalMsg.showErrorMessage("Error",v)}}},failure:function(){var e="No se pudo cambiar el estado de la "+translate("category")+", vuelve a intentarlo";if(c.emergent){Ext.MessageBox.alert("Error",e)}else{GlobalMsg.showErrorMessage("Error",e)}}})}}else{if(r.hasCls("deleteCategoryAction")){if(b.hasChildNodes()){var h="Para borrar la "+translate("category")+" tiene que eliminar o mover primero sus categorías hijas";if(c.emergent){Ext.MessageBox.alert("Error",h)}else{Ext.Msg.alert("Error",h)}}else{if(!b.get("isDeletable")){Ext.MessageBox.alert("Error","Esta "+translate("category")+" no puede ser eliminada o editada")}else{Ext.Msg.show({title:translate("remove",true)+" "+translate("category"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+translate("category")+' "'+b.get("text")+'"? '+translate("thisOperationCannotBeUndone",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/category/check-association/id/"+b.get("idLocal")+"/format/json",success:function(j,w){var x=Ext.decode(j.responseText);if(x.success){var v=x.results;if(x.isDeletable){if(v){Ext.create("AL.view.common.SmileWindow",{autoShow:true,id:"window-category-transactions-transfer",width:780,laytout:"fit",modal:true,reason:"selectCategoryForDelete",border:false,title:"Elije la "+translate("category")+" a la que deseas trasladar las transacciones existentes",items:[{xtype:"category_Tree",store:Ext.create("AL.store.Categories"),preventHeader:true,deleteCategory:b},],footer:{items:[{text:translate("save",true),cls:"button main-button",action:"confirmDeleteCategory",}]}})}else{Ext.Ajax.request({url:"/category/delete"+(c.emergent?"/emergent/true":"")+"/format/json",method:"POST",params:{idDelete:b.get("idLocal")},success:function(y,z){var B=Ext.decode(y.responseText);if(B.success){if(c.emergent){Ext.MessageBox.alert("Éxito","Se borró exitosamente la "+translate("category")+" "+b.get("text"))}b.remove()}else{var A=B.cause;if(c.emergent){Ext.MessageBox.alert("Error",A)}else{Ext.Msg.alert("Error",A)}}},failure:function(){}})}}else{Ext.MessageBox.alert("Error","La "+translate("category")+" no puede ser eliminada")}}},failure:function(){}})}}})}}}}}}}},"window button[action=confirmDeleteCategory]":{click:function(c){var e=c.up("window");var a=e.down("category_Tree");var d=a.deleteCategory;if(a.getSelectionModel().getSelection()[0]){var f=a.getSelectionModel().getSelection()[0].data;if(f.parentId!=="root"){if(f&&d){if(f!=d.get("idLocal")){var b={idDelete:d.get("idLocal"),idReplace:f.idLocal};Ext.Ajax.request({url:"/category/delete/format/json",params:b,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){d.remove();e.destroy()}else{Ext.Msg.alert("Error",j.cause)}},failure:function(){}})}else{Ext.Msg.alert("Error","No se puede transferir los datos a la misma "+translate("category")+" que se desea eliminar")}}else{}}else{Ext.MessageBox.alert("Error","La "+translate("category")+" "+f.text+" no puede ser seleccionada, por favor elije otra.")}}else{Ext.Msg.alert("Error","Se debe indicar la "+translate("category")+" a la cual se van a transferir todos los datos asociados a la "+translate("category")+" que se desea eliminar")}}},"category_CrudTree treeview":{beforedrop:function(c,d,h,k,l,e){l.wait=true;var g="Editar "+translate("category");var m="Error, esta "+translate("category")+" no puede ser eliminada o editada";var j={};var a="/category/edit/format/json";var b="¿Está seguro de que desea mover esta "+translate("category")+"?";j.position=k;var f=this;if(k!="append"){var a="/category/move/format/json";var g="Ordenar "+translate("category");var b="¿Está seguro de que desea cambiar el orden de esta "+translate("category")+"?"}Ext.Msg.show({title:g,msg:b,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(t){if(t=="yes"){var o=d.records[0];if(!o.get("isEditable")){Ext.MessageBox.alert(m)}else{j.idLocal=o.get("idLocal");j.name=o.get("text");j.code=o.get("code");j.description=o.get("description");j.idParent=h.get("idLocal");if(o.get("keyCountry")=="mexico"){var s=o.get("groupingCode"),p=o.get("accountType");if(s&&p){j.groupingCode=o.get("groupingCode");j.accountType=o.get("accountType")}else{var n=o.get("metadata");if(n.satGroupingCode){var r=o.getPath("text");var q=r.split("/");if(q[2]){switch(q[2].toLowerCase()){case"activos":j.accountType=100;break;case"pasivos":j.accountType=200;break;case"patrimonio":j.accountType=300;break;case"ingresos":j.accountType=400;break;case"egresos":j.accountType=500;break;default:j.accountType=1000;break}}j.groupingCode=n.satGroupingCode}}}Ext.Ajax.request({url:a,params:j,success:function(u,v){var w=Ext.decode(u.responseText);if(w.success){l.processDrop()}else{Ext.Msg.show({title:"Error",msg:w.cause,buttons:Ext.Msg.OK,width:350});l.cancelDrop()}}})}}}})}},category_CrudForm:{beforerender:function(b){var a=b.editRecord||null;if(b.showCategoriesCode=="yes"){b.down("textfield[name=code]").show()}},render:function(a){a.tt=Ext.create("Ext.tip.ToolTip",{target:"satGroupingCodeTooltip2",itemId:"satGroupingCodeTooltip2",hideDelay:2000,constrain:true,closeAction:"hide",html:'Para saber más sobre el agrupador SAT, haz clic <a target="_blank" style="font-weight: bold;" href="https://ayudas.getsoft.app/es/articles/3547528">aquí</a>.'})},close:function(a){if(a.tt){a.tt.destroy()}}},"category_CrudForm combo[name=groupingCode]":{select:function(f,b){var a=b[0];var e=f.up("window");if(e.country=="mexico"){var d=f.up("form");var c=d.down("hidden[name=groupingText]");if(c){c.setValue(a.data.name);d.getForm().isValid()}}}},"category_CrudForm button[action=save]":{click:function(e){var g=e.up("form");var h=g.up("window");if(g.getForm().isValid()){var c=g.getValues();var f;var d="";var a=Ext.ComponentQuery.query("category_CrudTree")[0];c.text=c.name;var b;if(h.editRecord){b=h.editRecord;d="/category/edit/format/json"}else{b=Ext.create("AL.model.Category");f=h.parentRecord;c.idLocal=f.get("idLocal");d="/category/add/format/json";c.children=[]}Ext.Ajax.request({url:d,params:c,success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){b.set(c);b.set("metadata",h.getFieldValuesAsMetadata());b.set("keyCountry",h.country);if(l.categoryProperties){b.set(l.categoryProperties)}if(f){b.set("idLocal",l.results);b.set("iconCls","categoryIcon");f.insertChild(0,b);a.update();f.expand()}b.updateConvertFields();b.commit();h.close();a.doLayout();if(g.emergent){Ext.MessageBox.alert("Éxito","Se creó exitosamente la "+translate("category")+" "+b.get("text"))}}else{Ext.MessageBox.alert("Error",l.cause)}}})}else{Ext.MessageBox.alert("Error","Hay errores en el formulario")}}},"category_CrudForm button[action=close]":{click:function(a){var b=a.up("window");b.close()}}})},showCategoriesOrderNotif:function(a){var b=null;var c=function(){if(b){b.close();var d={metadata:Ext.encode({hasSeenSortableCategoriesNotification:true})};Ext.Ajax.request({url:"/user/update-metadata/format/json",method:"POST",params:d,success:function(e,f){},failure:function(f){}});a.showCategoriesOrderNotif=false}};b=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact","modal-tooltip-order"],title:"Ordena tu catálogo de cuentas",targetEl:a,targetImg:"https://cdn1.getsoft.app/images/categories-tree-collapsed.jpg",offsetsImg:[1,40],position:"c-c",positionBy:"setPosition",layout:"fit",modal:false,offsets:[200,-150],closeCallback:c,items:[{xtype:"container",cls:"modal-tooltip-order-container",html:'<div class="notification-container-img"><img src="https://cdn1.getsoft.app/images/categories_tree_interactions.gif" alt="" /></div><div class="notification-contact-text"> '+translate("customizeTheOrderOfYourAccountingAccountsThatWillBeVisibleInYourReports")+"</div>"}],footerItems:["->",{xtype:"button",hrefTarget:"blank",text:"Ver más",cls:["sm-button-view-more"],href:"https://ayudas.getsoft.app/es/articles/1853323"},{xtype:"button",text:"Entendido",cls:"sm-button-primary",padding:"4 18",handler:function(){c(this.up("window"))}},],autoShow:false,repositionOnWindowResize:false,});b.queueToShow();setTimeout(function(){Ext.dom.Query.select(".app")[0].scrollBy(0,0,true);b.setNewPosition(b)},100);Ext.EventManager.onWindowResize(function(){Ext.dom.Query.select(".app")[0].scrollBy(0,0,true);b.setNewPosition(b)},this,{buffer:1})},saveCategory:function(c){var e=Ext.ComponentQuery.query("category_FormAdd")[0];var b=e.getValues();var a=Ext.ComponentQuery.query("category_Tree")[0];var f=a.getSelectionModel().getSelection()[0].raw.idLocal;var d={name:b.name,code:b.code,description:b.description,idLocal:f};Ext.Ajax.request({url:"/category/add/format/json",params:d,success:function(g){var j=Ext.decode(g.responseText);if(j.success){var k=j.results;if(e.emergent){Ext.MessageBox.alert("Éxito","Se creó exitosamente la "+translate("category")+" "+b.name)}window.location="/category"}else{var h=j.cause;if(e.emergent){Ext.MessageBox.alert("Error",h)}else{GlobalMsg.showErrorMessage("Error",h)}}}})},initialize:function(a){var f=this;var d=Ext.create("Ext.tip.ToolTip",{target:"satGroupingCodeTooltip",itemId:"satGroupingCodeTooltip",hideDelay:2000,constrain:true,closeAction:"hide",html:'Para saber más sobre el agrupador SAT, haz clic <a target="_blank" style="font-weight: bold;" href="https://ayudas.getsoft.app/es/articles/3547528">aquí</a>.'});a.getStore().on("load",function(){});var c=a.getView();c.on("itemcontextmenu",function(h,g,n,k,m,j){m.preventDefault();var l=g;Ext.create("Ext.menu.Menu",{width:134,height:100,margin:"0 0 10 0",record:g,listeners:{click:function(s,E,w,x){var p="",C,u=E.record,t=u,r,o=h.up("treepanel");var z="";if(t.get("keyCountry")){z=t.get("keyCountry")}else{if(o.country){z=o.country}else{if(o.configs.country){z=o.configs.country}}}var q="NA";if(o.setAccountType){q=o.setAccountType}switch(E.action){case"new":var A=translate("add",true)+" "+translate("category");Ext.create("AL.view.category.CrudForm",{parentRecord:l,boxTitle:A,title:A,showCategoriesCode:a.showCategoriesCode,country:z,setAccountType:q,showCategoriesCode:o.showCategoriesCode,});break;case"edit":if(!l.get("isEditable")){Ext.MessageBox.alert("Error","Esta "+translate("category")+" no puede ser eliminada o editada")}else{var A="Editar "+translate("category");r=Ext.create("AL.view.category.CrudForm",{editRecord:l,boxTitle:A,title:A,showCategoriesCode:a.showCategoriesCode,country:z,setAccountType:q,showCategoriesCode:o.showCategoriesCode});var B=r.down("textfield[name=name]"),D=r.down("textfield[name=code]"),v=r.down("textfield[name=description]"),y=r.down("hidden[name=idLocal]");B.setValue(u.get("text"));D.setValue(t.get("code"));v.setValue(u.get("description"));y.setValue(u.get("idLocal"));r.setFieldValuesFromMetadata(t.get("metadata"))}break;case"delete":if(!l.get("isEditable")){Ext.MessageBox.alert("Error","Esta "+translate("category")+" no puede ser eliminada o editada")}else{Ext.Msg.show({title:translate("remove",true)+" "+translate("category"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+translate("category")+' "'+t.get("text")+'"? '+translate("thisOperationCannotBeUndone",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(F){if(F=="yes"){Ext.Ajax.request({url:"/category/check-association/id/"+t.get("idLocal")+"/format/json",success:function(G,I){var J=Ext.decode(G.responseText);if(J.success){var H=J.results;if(J.isDeletable){if(H){Ext.create("AL.view.common.SmileWindow",{autoShow:true,id:"window-category-transactions-transfer",width:780,laytout:"fit",modal:true,reason:"selectCategoryForDelete",border:false,title:"Elije la "+translate("category")+" a la que deseas trasladar las transacciones existentes",items:[{xtype:"category_Tree",store:Ext.create("AL.store.Categories"),preventHeader:true,deleteCategory:t}],footer:{items:[{text:translate("save",true),cls:"button main-button",action:"confirmDeleteCategory",}]}})}else{Ext.Ajax.request({url:"/category/delete/format/json",method:"POST",params:{idDelete:t.get("idLocal")},success:function(K,L){var N=Ext.decode(K.responseText);if(N.success){t.remove()}else{var M=N.cause;if(r.emergent){Ext.MessageBox.alert("Error",M)}else{Ext.Msg.alert("Error",M)}}},failure:function(){}})}}else{Ext.MessageBox.alert("Error","La "+translate("category")+" no puede ser eliminada")}}},failure:function(){}})}}})}break;default:break}}},items:[{text:translate("new",true),iconCls:"newIcon",action:"new",record:g},{text:translate("edit",true),iconCls:"editIcon",action:"edit",record:g},{text:translate("remove",true),iconCls:"deleteIcon",action:"delete",record:g}]}).showAt(m.getXY())});c.on("resize",function(){var j=Ext.dom.Query.select(".x-grid-row");for(var h=0;h<j.length;h++){if((h%2)!=0){var g=Ext.get(j[h]);g.addCls("dark-row")}}});var b=Ext.get("exportBtn");if(b){b.on("click",function(){f.excelExport(b)})}var e=Ext.get("exportXmlBtn");if(e){e.on("click",function(){f.xmlExport(e)})}if(a.showCategoriesOrderNotif){this.showCategoriesOrderNotif(a)}},validateDateForm:function(){var b=Ext.ComponentQuery.query("report_DatesForm")[0];var a=b.down("datefield[name=fromDate]");var d=b.down("datefield[name=toDate]");var c=true;if(a.getValue()>d.getValue()){c=false;GlobalMsg.showNotification({title:"Error",text:"La fecha inicial debe ser menor o igual a la fecha final",type:"error"})}return c},excelExport:function(b){var c=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos."].join("");if(b){var a=b.down("svg");if(!a.hasCls("icon-spin")){a.update('<use xlink:href="/images/smile-icons.svg#loading"></use>');a.dom.classList.add("icon-spin");requestParams=[];Ext.Ajax.request({url:"/category/categories-excel/format/json",params:requestParams,binary:true,success:function(k,p){try{var l=String.fromCharCode.apply(null,new Uint8Array(k.responseBytes));l=l.replace(/Already running.../gi,"");var g=Ext.decode(l);if(!g.success){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(g.cause){c=g.cause}Ext.Msg.show({title:translate("generatingExcelFile",true),msg:c,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}catch(o){var f="";var h=k.getResponseHeader("Content-Disposition");if(h&&h.indexOf("attachment")!==-1){var j=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var n=j.exec(h);if(n!=null&&n[1]){f=n[1].replace(/['"]/g,"")}}var r=k.getResponseHeader("Content-Type");var d=typeof File==="function"?new File([k.responseBytes],f,{type:r}):new Blob([k.responseBytes],{type:r});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(d,f)}else{var q=window.URL||window.webkitURL;var m=q.createObjectURL(d);if(f){var s=document.createElement("a");if(typeof s.download==="undefined"){window.location=m}else{s.href=m;s.download=f;document.body.appendChild(s);s.click()}}else{window.location=m}setTimeout(function(){q.revokeObjectURL(m)},100)}}finally{a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}},failure:function(d){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}})}}},xmlExport:function(b){var c=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos."].join("");if(b){var a=b.down("svg");if(!a.hasCls("icon-spin")){a.update('<use xlink:href="/images/smile-icons.svg#loading"></use>');a.dom.classList.add("icon-spin");requestParams=[];Ext.Ajax.request({url:"/category/download-xml/type/CT/format/json",params:requestParams,binary:true,success:function(k,p){try{var l=String.fromCharCode.apply(null,new Uint8Array(k.responseBytes));l=l.replace(/Already running.../gi,"");var g=Ext.decode(l);if(!g.success){c='Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>';if(g.cause){c=g.cause}Ext.Msg.show({title:"Ocurrió un error",msg:c,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(g.cause){c=g.cause}Ext.Msg.show({title:translate("generatingExcelFile",true),msg:c,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}catch(o){var f="";var h=k.getResponseHeader("Content-Disposition");if(h&&h.indexOf("attachment")!==-1){var j=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var n=j.exec(h);if(n!=null&&n[1]){f=n[1].replace(/['"]/g,"")}}var r=k.getResponseHeader("Content-Type");var d=typeof File==="function"?new File([k.responseBytes],f,{type:r}):new Blob([k.responseBytes],{type:r});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(d,f)}else{var q=window.URL||window.webkitURL;var m=q.createObjectURL(d);if(f){var s=document.createElement("a");if(typeof s.download==="undefined"){window.location=m}else{s.href=m;s.download=f;document.body.appendChild(s);s.click()}}else{window.location=m}setTimeout(function(){q.revokeObjectURL(m)},100)}}finally{a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}},failure:function(d){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}})}}}});Ext.define("AL.view.buttons.SubmitCreate",{extend:"Ext.form.Panel",alias:"widget.buttons_SubmitCreate",requires:["AL.view.buttons.Cancel"],buttonsConfig:{submitButtonAction:"save",submitButtonText:translate("save",true),createButtonAction:"saveCreate",createButtonText:translate("saveAndCreateNew",true)},items:[{xtype:"buttons_Cancel",width:150,height:38,cls:"sm-button-basic",style:"margin-left: 20px;",},{xtype:"button",width:200,height:38,text:translate("saveAndCreateNew",true),cls:"sm-button-basic",action:"saveCreate",style:"margin-left: 20px;",createAnother:true},{xtype:"button",width:150,height:38,cls:"sm-button-primary",text:translate("save",true),style:"margin-left: 20px;",action:"save",createAnother:false}],cls:"buttons-form",frame:false,border:false,layout:{type:"hbox",pack:"end"},listeners:{afterrender:function(e,d){var b=e.buttonsConfig;var c=e.down("button[action=save]");c.action=(b.submitButtonAction)?b.submitButtonAction:"save";c.text=(b.submitButtonText)?b.submitButtonText:translate("save",true);var a=e.down("button[action=saveCreate]");a.action=(b.createButtonAction)?b.createButtonAction:"saveCreate";a.setText((b.createButtonText)?b.createButtonText:translate("saveAndCreateNew",true));a;if(e.type=="addBill"){e.insert(1,{xtype:"button",width:150,height:38,text:translate("saveAndAddPayment",true),style:"margin-left: 20px;",action:"saveAddPayment",afterSave:"addPayment",createAnother:false})}}}});Ext.define("AL.view.comment.WindowDeleteComment",{extend:"AL.view.common.SmileWindow",alias:"widget.comment_WindowDeleteComment",title:translate("removeComment"),layout:"form",modal:true,frame:false,resizable:false,cls:"delete-comment-window",width:550,bodyStyle:{background:"#FFFFFF"},data:null,initComponent:function(){this.items=[{xtype:"textarea",readOnly:true,fieldLabel:translate("removeCommentQuestion",true),labelAlign:"top",value:this.data.comment}];this.callParent(arguments)},buttons:[{text:translate("cancelAction",true),action:"cancel",handler:function(a){a.up("window").close()}},{text:translate("remove",true),action:"delete"}]});Ext.define("AL.controller.Comment",{extend:"Ext.app.Controller",views:["comment.Header","comment.Detail","comment.FormAddComment","comment.WindowDeleteComment"],stores:["Comments"],models:["Comment"],container:null,header:null,commentList:null,formLoaded:false,idLocalResource:null,resourceType:null,userName:null,idUser:null,init:function(){var b=this;this.application.addListener("saveComment",this.saveComment,this);this.application.addListener("editComment",this.editComment,this);this.application.addListener("deleteComment",this.deleteComment,this);this.application.addListener("focusOnCommentForm",function(){var c=Ext.get("new-comment");if(c){c.focus()}else{var d=Ext.get("addNewCommentButton");if(d){d.dom.dispatchEvent(new Event("click"));b.application.fireEvent("focusOnCommentForm")}}},this);var a=Ext.get("comments");if(a){this.idLocalResource=a.getAttribute("data-id");this.resourceType=a.getAttribute("data-resource-type");this.userName=a.getAttribute("data-user-name");this.idUser=a.getAttribute("data-user-id");if(!this.userName){this.userName=translate("user",true)}this.container=Ext.create("Ext.container.Container",{renderTo:"commentList"});this.header=Ext.create("AL.view.comment.Header");this.commentList=Ext.create("AL.view.comment.Detail");if(b.idLocalResource!=="new"){this.commentList.on({itemclick:function(h,d,k,f,j){j.preventDefault();var e=j.target.className;switch(e){case"comment-action-delete":Ext.create("AL.view.comment.WindowDeleteComment",{data:d.getData(),listeners:{afterrender:function(l){var m=l.down("button[action=delete]");if(m){m.on("click",function(n){n.up("window").close();if(b.idLocalResource!=="new"){b.application.fireEvent("deleteComment",{idComment:d.get("id"),comment:d.get("comment")})}},this)}}}}).show();break;case"comment-action-edit":d.set("isEditing",true);h.refreshNode(f);break;case"button outline cancel-comment":d.set("isEditing",false);h.refreshNode(f);break;case"button primary add-comment":var g=Ext.get(k);var c=g.down("textarea");d.set("comment",c.getValue());if(b.idLocalResource!=="new"){b.application.fireEvent("editComment",{idComment:d.get("id"),comment:d.get("comment")})}break}}})}this.container.add([this.header,this.commentList]);this.loadComments()}},showErrorMessage:function(b){b=typeof b==="undefined"?"Ha ocurrido un error, por favor inténtalo de nuevo más tarde":b;var a=Ext.create("Ext.Component",{name:"error-message",html:'<section class="alert-wrapper"><div class="alert danger"><p class="alert-content">'+b+"</p></div></section>"});this.container.add(a)},loadComments:function(){var a=this;var b=Ext.get("comments");GlobalLoadMask.show(b);if(a.idLocalResource==="new"){var d=Ext.getStore("Comments");if(d.count()===0){var c=a.getNewCommentForm();a.container.add(c)}GlobalLoadMask.hide(b)}else{Ext.Ajax.request({url:"/comment/retrieve-comments/format/json",method:"POST",params:{idLocalResource:a.idLocalResource,resourceType:a.resourceType},success:function(e){var h=Ext.decode(e.responseText);if(h.success&&h.results){var j=h.results.length;if(j){a.updateHeader(j);var g=Ext.getStore("Comments");g.loadData(h.results);a.commentList.bindStore(g)}else{var f=a.getNewCommentForm();a.container.add(f)}GlobalLoadMask.hide(b)}else{GlobalLoadMask.hide(b);if(h.error){a.showErrorMessage(h.error)}else{a.showErrorMessage()}}},failure:function(){GlobalLoadMask.hide(b);a.showErrorMessage()}})}},saveComment:function(c){var a=this;var b=Ext.get("comments");GlobalLoadMask.show(b);Ext.Ajax.request({url:"/comment/add/format/json",method:"POST",params:{idLocalResource:c.idLocalResource,resourceType:c.resourceType,comment:c.comment},success:function(d){var e=Ext.decode(d.responseText);if(e.success&&e.results){a.container.remove(c.form,true);a.formLoaded=false;a.loadComments(c.idLocalResource,c.resourceType)}else{GlobalLoadMask.hide(b);if(e.error){a.showErrorMessage(e.error)}else{a.showErrorMessage()}}},failure:function(){GlobalLoadMask.hide(b);a.showErrorMessage()}})},editComment:function(c){var a=this;var b=Ext.get("comments");GlobalLoadMask.show(b);Ext.Ajax.request({url:"/comment/edit/format/json",method:"POST",params:{idLocalResource:a.idLocalResource,resourceType:a.resourceType,idComment:c.idComment,comment:c.comment},success:function(d){var e=Ext.decode(d.responseText);if(e.success&&e.results){a.loadComments()}else{if(e.error){GlobalLoadMask.hide(b);a.showErrorMessage(e.error)}else{a.showErrorMessage()}}},failure:function(){GlobalLoadMask.hide(b);a.showErrorMessage()}})},deleteComment:function(c){var a=this;var b=Ext.get("comments");GlobalLoadMask.show(b);Ext.Ajax.request({url:"/comment/delete/format/json",method:"POST",params:{idLocalResource:a.idLocalResource,resourceType:a.resourceType,idComment:c.idComment,comment:c.comment},success:function(d){var e=Ext.decode(d.responseText);if(e.success&&e.results){a.loadComments()}else{if(e.error){GlobalLoadMask.hide(b);a.showErrorMessage(e.error)}else{a.showErrorMessage()}}},failure:function(){GlobalLoadMask.hide(b);a.showErrorMessage()}})},getNewCommentForm:function(){var a=this;var b=Ext.create("AL.view.comment.FormAddComment",{comment:{userName:a.userName,userInitial:a.userName.charAt(0).toUpperCase()},listeners:{afterrender:function(){var c=Ext.get("new-comment");if(c){var e=Ext.get("add-comment");var d=Ext.get("cancel-comment");if(a.idLocalResource==="new"){e.hide()}else{c.on("input",function(){if(e&&d){var f=c.getValue();if(f===""){e.dom.disabled=true;d.hide()}else{e.dom.disabled=false;d.show()}}},this);e.on("click",function(){a.application.fireEvent("saveComment",{idLocalResource:a.idLocalResource,resourceType:a.resourceType,comment:c.getValue(),form:b})},this);d.on("click",function(){c.dom.value="";c.dom.dispatchEvent(new Event("input"))},this)}}}}});a.formLoaded=true;return b},updateHeader:function(b){this.header.update({quantity:b});var c=Ext.get("addNewCommentButton");if(c){var a=this;c.on("click",function(e){e.preventDefault();if(!a.formLoaded){var d=a.getNewCommentForm();a.container.add(d)}},this)}},formatDate:function(b){var a=AL.date(b);return Ext.Date.format(a,"d/m/Y")}});Ext.define("AL.view.company.FormInvoiceTemplateEdit",{extend:"Ext.form.Panel",alias:"widget.company_FormInvoiceTemplateEdit",title:"Plantilla de facturación",border:false,bodyStyle:{background:"transparent",color:"#9A9A9A",padding:"5px 35px"},requires:["AL.view.buttons.Cancel","AL.view.admin.company.CountriesCombo"],width:1024,defaultType:"textfield",defaults:{labelWidth:210,labelAlign:"left",labelStyle:"font-size: 14px",width:350,labelPad:15},invoiceTemplatePickerRecordValue:"idLocal",initComponent:function(){this.items[0].recordValue=this.invoiceTemplatePickerRecordValue;if(this.country=="peru"){this.items[0].label='Plantilla de impresión<div class="tooltip-wrapper invoiceTemplate"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">Selecciona la plantilla predeterminada para tus '+translate("invoices")+'. <a target="_blank" href="https://ayuda.getsoft.app/factura-sobre-formatos-preimpresos-per%C3%BA">Ver más</a>.</div></div></div></div>'}if(this.isTest=="yes"&&this.canTestOtherCountries=="yes"){this.width="100%";this.items[1].items[1].items[1].height=800}if(this.country=="usa"){this.items[1].items[0].items[2].hidden=true}if(this.signatureUrl==""){this.items[1].items[0].items[2].items[0].hidden=true}else{this.items[1].items[0].items[2].items[0].html='<div style="width: 100%; margin-top: 10px; margin-bottom: 10px; overflow: hidden;"><div style="float: left; width: 92px; color: black;">Firma actual</div><div style="float: right; width: 276px; height: 276px; line-height: 276px; background-color: #e3e3e3; border: 1px solid #e3e3e3;"><img src="'+this.signatureUrl+'" alt="Firma actual" style="margin: 0 auto; max-width: 274px; max-height: 274px; vertical-align: middle;"></div></div>'}this.callParent(arguments)},items:[{xtype:"company_InvoiceTemplatePicker",width:"100%",name:"idInvoiceTemplate",store:"InvoiceTemplates",containerStyle:"margin-bottom: 15px; border-bottom: 1px solid;",label:'Plantilla de impresión<div class="tooltip-wrapper invoiceTemplate"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">Selecciona la plantilla predeterminada para tus '+translate("invoices")+'. <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/206445995">Ver más</a>.</div></div></div></div>',labelStyle:"font-size: 14px; color: #1A5E53; position: relative;",itemsContainerStyle:"margin: 5px 10px 20px;",collapsable:false,useItemsGroup:false,showPreviewButton:false,useRadioAsSelector:false},{xtype:"container",width:"100%",margin:"0 0 25 0",layout:{type:"hbox"},items:[{xtype:"container",width:400,items:[{xtype:"fieldset",title:'<b style="font-size: 14px;">Configuración general</b>',itemId:"generalInvoiceParameters",padding:15,layout:"anchor",defaultType:"checkboxfield",fieldDefaults:{checked:false,inputValue:"yes",layout:"100%",labelWidth:315},items:[{fieldLabel:"Mostrar el total "+translate("ofTheInvoice")+" "+translate("invoice")+" en letras",name:"showInvoiceTotalInWords",tooltip:"Indica si deseas que se muestre en "+translate("theInvoice")+" "+translate("invoice")+" el valor total en letras"},{fieldLabel:"Mostrar "+translate("retentions")+" sugeridas "+translate("ofTheInvoice")+" "+translate("invoice"),name:"showRetentionInvoice",tooltip:"Esta opción muestra las "+translate("retentions")+" sugeridas en tus "+translate("invoices")},{fieldLabel:"Mostrar saltos de línea en la descripción de los "+translate("items"),name:"showNewLineCharOnPdf",tooltip:"Activando esta opción puedes organizar la descripción de tus "+translate("items")+" usando enter para dar saltos de línea"},{xtype:"box",html:'<div style="text-align: center; margin: 12px 0 5px;">Los parámetros que actives aplican para todas las plantillas.</div>'},]},{xtype:"fieldset",title:'<b style="font-size: 14px;">Configuración de la plantilla</b>',itemId:"invoiceTemplateParameters",padding:15,layout:"anchor",fieldDefaults:{layout:"100%",labelWidth:210},items:[{xtype:"displayfield",name:"templateName",fieldLabel:translate("template",true),allowBlank:false,submitValue:false},{xtype:"combo",name:"font",fieldLabel:"Tipo de letra",displayField:"label",valueField:"value",allowBlank:false,forceSelection:true,editable:false,store:{fields:["label","value"],data:[{label:"Helvetica",value:"HELVETICA"},{label:"Times New Roman",value:"TIMES"}]}},{xtype:"combo",name:"fontSize",fieldLabel:"Tamaño de letra",displayField:"label",valueField:"value",allowBlank:false,forceSelection:true,editable:false,store:{fields:["label","value"],data:[{label:translate("font.big",true),value:"BIG"},{label:translate("font.normal",true),value:"NORMAL"},{label:translate("font.small",true),value:"SMALL"}]}},{xtype:"numberfield",name:"itemsSpacing",fieldLabel:"Espaciado entre "+translate("items"),allowBlank:false,minValue:0,decimalPrecision:2,allowExponential:false,allowOnlyWhitespace:false},{xtype:"checkboxfield",fieldLabel:"Mostrar total de "+translate("items")+" facturados",name:"showItemsCount",inputValue:"yes",style:"margin-bottom: 15px;"}]},{xtype:"fieldset",title:'<b style="font-size: 14px;">Opciones de usuario</b>',itemId:"userInvoiceParameters",padding:15,layout:"anchor",items:[{xtype:"box"},{xtype:"filefield",fieldLabel:"Imagen de firma",name:"signature",msgTarget:"side",afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -350px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -236px;top: 0px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si necesitas ayuda para agregar la firma, haz <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115003239466">clic aquí</a>.</div></div></div></div>',listeners:{afterrender:function(){window.lastSignatureValue="";var a=this;setInterval(function(){var c=a.getValue();if(c!=window.lastSignatureValue){window.lastSignatureValue=c;var b=Ext.ComponentQuery.query("company_FormInvoiceTemplateEdit button[itemId=showPreviewButton]")[0];b.fireEvent("click",b)}},1000)}}},{xtype:"box",html:'<div style="margin-left: 10px">Agrega una imagen de tu firma (archivo .png, .jpg o .jpeg de tamaño inferior a 2 MB)</div>'},{xtype:"filefield",name:"signatureToPreview",hidden:true,disabled:true}]},{xtype:"fieldset",title:'<b style="font-size: 14px;">Parámetros para pruebas</b>',itemId:"testParameters",padding:15,layout:"anchor",hidden:true,disabled:true,fieldDefaults:{layout:"100%",labelWidth:210},items:[{xtype:"admin_company_CountriesCombo",name:"keyCountry",allowBlank:true,fieldLabel:"País para previsualizar"},{xtype:"checkboxfield",name:"multicurrency",fieldLabel:"Activar multimoneda",checked:false,inputValue:"yes",},{xtype:"checkboxfield",name:"showPlanText",fieldLabel:"Mostrar legenda de versión educativa",checked:false,inputValue:"yes",},]},{xtype:"container",defaults:{style:"float: right; margin-top: 10px;",},items:[{xtype:"button",text:translate("save",true),action:"saveInvoiceTemplate",margin:"10 0 0 10",formBind:true,disabled:true},{xtype:"button",itemId:"showPreviewButton",text:translate("preview",true),formBind:true,disabled:true}]}]},{xtype:"container",flex:1,margin:"0 0 5 30",items:[{xtype:"box",itemId:"previewText",html:"Vista previa",width:"100%",style:"font-size: 14px; text-align: center; color: #333; font-weight: bold"},{xtype:"box",itemId:"previewBox",height:600,width:"100%",style:"background-color: #e3e3e3; border: 0;",autoEl:{tag:"iframe"}},{xtype:"box",itemId:"anotationText",html:'<div style="text-align: center; margin: 20px 60px;">La imagen es una representación de cómo se verán tus facturas de acuerdo a los parámetros elegidos.</div>'},{xtype:"box",itemId:"anotationTextMexico",html:'<div style="text-align: center; margin: 20px 60px;">La imagen es una representación de cómo se verán tus facturas de acuerdo a los parámetros elegidos, el espacio en blanco debajo de los '+translate("items")+" está destinado para la información del timbre.</div>",hidden:true},]}]}],buttons:[],canUseKeyCountryField:function(){return this.isTest=="yes"&&this.canTestOtherCountries=="yes"}});Ext.define("AL.view.company.WindowIncompleteInfo",{id:"window-incomplete-company-info",extend:"AL.view.common.SmileWindow",title:"",reason:"incompleteCompanyInfo",resourceTrigger:null,style:"background: #fff",y:30,bodyStyle:"background:#fff;",autoScroll:true,width:550,height:500,modal:true,autoShow:true,required:true,initComponent:function(){this.footer={items:[{cls:"button main-button",text:translate("save",true),margin:"0 28 0 0",name:"handlerIncompleteInfo",handler:function(a){var c=a.up("window");var b=c.down("button[action=saveMandatoryCompanyInfo]");if(b){b.fireEvent("click",b)}},}]};this.callParent(arguments)},listeners:{afterrender:function(){var a=document.querySelector(".smile-window .x-window-body");if(a){a.scroll(0,0);setTimeout(function(){a.scroll(0,0)},100)}}}});Ext.define("AL.view.company.FormEditDocumentsNumber",{extend:"Ext.form.Panel",alias:"widget.company_FormEditDocumentsNumber",title:"",bodyPadding:"0 20 20 20",requires:["AL.view.buttons.Cancel"],width:1024,border:false,frame:false,defaultType:"textfield",defaults:{labelWidth:250,labelAlign:"right",width:300,labelPad:15,margin:"10 0 0 0"},items:[{xtype:"container",width:850,layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("transactionsIn")})+'<span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0",name:"transactionIn"},{xtype:"textfield",name:"transactionInPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:"Numeración registro único de ingreso (12)"},{xtype:"textfield",name:"nextTransactionInNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:"Numeración registro único de ingreso (12)"},]},{xtype:"container",width:850,layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("transactionsOut")})+'<span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0",name:"transactionOut"},{xtype:"textfield",name:"transactionOutPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:"Numeración gastos menores (13)"},{xtype:"textfield",fieldLabel:"",name:"nextTransactionOutNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:"Numeración gastos menores (13)"},]},{xtype:"container",cls:"container-visible",width:850,layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("creditNote")})+' <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0",name:"creditNotes"},{xtype:"textfield",name:"creditNotePrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:"Numeración "+translate("creditNotes")+" (04)"},{xtype:"textfield",fieldLabel:"",name:"nextCreditNoteNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,blankText:"Es necesario indicar el siguiente "+translate("number")+" de "+translate("creditNote"),msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:"Numeración "+translate("creditNotes")+" (04)"},]},{xtype:"container",width:850,name:"remissions",layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("remissions")})+' <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0"},{xtype:"textfield",name:"remissionPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:translate("number")+" de "+translate("remissions")},{xtype:"textfield",fieldLabel:"",name:"nextRemissionNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:translate("number")+" de "+translate("remissions")},]},{xtype:"container",name:"estimates",width:850,layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("estimates")})+' <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0"},{xtype:"textfield",name:"estimatePrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:translate("number")+" de "+translate("estimates")+""},{xtype:"textfield",fieldLabel:"",name:"nextEstimateNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:translate("number")+" de "+translate("estimates")+""},]},{xtype:"container",name:"purchaseOrder",width:850,layout:"hbox",items:[{xtype:"label",html:translate("nextNumberOfDocument",true,{document:translate("purchaseOrders")})+' <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0"},{xtype:"textfield",name:"purchaseOrderPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",hidden:true,errorMsg:translate("number")+" de "+translate("purchaseOrders")},{xtype:"textfield",fieldLabel:"",name:"nextPurchaseOrderNumber",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:false,msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:translate("number")+" de "+translate("purchaseOrders")},]},{xtype:"container",name:"eventDocumentsReceived",width:850,layout:"hbox",hidden:true,items:[{xtype:"label",html:translate("next",true)+" "+translate("number")+' de respuesta a proveedores <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0",countries:["colombia"]},{xtype:"textfield",fieldLabel:"",name:"nextNumberEventForDocumentsReceived",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),requires:["colombia"],blankText:"Es necesario indicar el siguiente "+translate("number")+" de evento a enviar en las respuestas a los proveedores en tu buzón electrónico ",msgTarget:"side",emptyText:translate("next",true)+" "+translate("number"),errorMsg:translate("number")+" de evento a enviar en las respuestas a los proveedores en tu buzón electrónico ",countries:["colombia"]},]},{xtype:"container",name:"acceptDocumentsReceived",width:850,layout:"hbox",items:[{xtype:"label",html:"Siguiente "+translate("consecutive")+" de aceptación",width:300,style:"text-align:right;",margin:"0 15 0 0",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},{xtype:"textfield",fieldLabel:"",name:"nextNumberAcceptForDocumentsReceived",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:true,blankText:"Es necesario indicar el siguiente "+translate("consecutive")+" para la aceptación de documentos recibidos en tu buzón electrónico ",msgTarget:"side",emptyText:"Siguiente "+translate("consecutive"),errorMsg:translate("consecutive")+" para la aceptación de documentos recibidos en tu buzón electrónico ",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},]},{xtype:"container",name:"partiallAcceptDocumentsReceived",width:850,layout:"hbox",items:[{xtype:"label",html:"Siguiente "+translate("consecutive")+" de aceptación parcial",width:300,style:"text-align:right;",margin:"0 15 0 0",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},{xtype:"textfield",fieldLabel:"",name:"nextNumberPartiallAcceptForDocumentsReceived",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:true,blankText:"Es necesario indicar el siguiente "+translate("consecutive")+" para la aceptación parcial de documentos recibidos en tu buzón electrónico ",msgTarget:"side",emptyText:"Siguiente "+translate("consecutive"),errorMsg:translate("consecutive")+" para la aceptación parcial de documentos recibidos en tu buzón electrónico ",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},]},{xtype:"container",name:"rejectDocumentsReceived",width:850,layout:"hbox",items:[{xtype:"label",html:"Siguiente "+translate("consecutive")+" de rechazo",width:300,style:"text-align:right;",margin:"0 15 0 0",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},{xtype:"textfield",fieldLabel:"",name:"nextNumberRejectForDocumentsReceived",regex:/^[0-9]+$/,regexText:translate("onlyNumericalValues",true),allowBlank:true,blankText:"Es necesario indicar el siguiente "+translate("consecutive")+" para el rechazo de documentos recibidos en tu buzón electrónico ",msgTarget:"side",emptyText:"Siguiente "+translate("consecutive"),errorMsg:translate("consecutive")+" para el rechazo de documentos recibidos en tu buzón electrónico ",countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"]},]}],buttons:[{xtype:"buttons_Cancel",cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),action:"savePrefixAndNumbersInfo",cls:"sm-button-primary",height:38,width:157}],getFieldValuesAsMetadata:function(){var c=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":var e=this.down("textfield[name=nextNumberAcceptForDocumentsReceived]"),b=this.down("textfield[name=nextNumberPartiallAcceptForDocumentsReceived]"),d=this.down("textfield[name=nextNumberRejectForDocumentsReceived]");c={nextNumberAcceptForDocumentsReceived:e.getValue(),nextNumberPartiallAcceptForDocumentsReceived:b.getValue(),nextNumberRejectForDocumentsReceived:d.getValue()};break;case"colombia":c={nextNumberEventForDocumentsReceived:this.down("textfield[name=nextNumberEventForDocumentsReceived]").getValue(),};break}return c},setFieldValuesFromMetadata:function(c){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":if(typeof c.nextNumberAcceptForDocumentsReceived!=="undefined"){var e=this.down("textfield[name=nextNumberAcceptForDocumentsReceived]");e.setValue(c.nextNumberAcceptForDocumentsReceived)}if(typeof c.nextNumberPartiallAcceptForDocumentsReceived!=="undefined"){var b=this.down("textfield[name=nextNumberPartiallAcceptForDocumentsReceived]");b.setValue(c.nextNumberPartiallAcceptForDocumentsReceived)}if(typeof c.nextNumberRejectForDocumentsReceived!=="undefined"){var d=this.down("textfield[name=nextNumberRejectForDocumentsReceived]");d.setValue(c.nextNumberRejectForDocumentsReceived)}break;case"colombia":var f=this.down("textfield[name=nextNumberEventForDocumentsReceived]");if(typeof c.nextNumberEventForDocumentsReceived!=="undefined"){f.setValue(c.nextNumberEventForDocumentsReceived>0?c.nextNumberEventForDocumentsReceived:1)}else{f.setValue(1)}break}},});Ext.define("AL.view.company.FormEditEmailTemplate",{extend:"Ext.form.Panel",alias:"widget.company_FormEditEmailTemplate",title:"",requires:["AL.view.buttons.Cancel"],style:"margin: 0",border:false,frame:false,defaultType:"textfield",defaults:{labelWidth:70,labelAlign:"right",width:550,labelPad:15,margin:"10 0 0 0"},items:[{xtype:"hidden",name:"emailType",margin:0},{xtype:"label",name:"emailTypeSubtitle",margin:0},{xtype:"textfield",fieldLabel:translate("fromEmail",true)+": ",name:"fromAddress",margin:"20 0 0 0",allowBlank:false,readOnly:true,disabled:true},{xtype:"textfield",fieldLabel:translate("subject",true)+": ",name:"subject",allowBlank:false,maxLength:250,enforceMaxLength:true,},{xtype:"splitbutton",name:"placeHolderButton",text:translate("variableText",true),width:125,margin:"10 0 0 425",handler:function(){this.showMenu()}},{xtype:"label",html:translate("theDoubleKeyedTextMustNotBeChangedItWillBeChangedToTheRespectiveValue",true)+" . "+translate("exampleDoubleKeyedEmailTemplate",true)+" .",style:"float: left; color: #888888; font-size: 83%;",margin:"10 0 10 90",width:450,name:"alert"},{xtype:"htmleditor",fieldLabel:translate("message",true)+" ",name:"message",margin:"0 0 0 0",enableSourceEdit:false,height:250}],buttons:[{text:translate("save",true),action:"save",formBind:true,disabled:true,margin:"10 10 0 0",height:40,cls:"button main-button",hidden:true}]});Ext.define("AL.view.company.FormExternalPaymentsEdit",{extend:"Ext.form.Panel",alias:"widget.company_FormExternalPaymentsEdit",title:"",requires:["AL.view.buttons.Cancel"],bodyPadding:35,width:1024,defaults:{labelWidth:350,labelAlign:"right",width:650,labelPad:15},items:[{xtype:"box",width:"100%",style:"padding-left: 20px;text-align: center;margin: 0 auto 20px auto;color:#1a5e53;font-size:16px",html:"<div>Gana tiempo y tranquilidad con la integración entre "+translate("providerPayments",true)+" y "+translate("alegraBrand")+", puedes crear una cuenta en "+translate("providerPayments",true),listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.style="padding-left: 20px;text-align: center;margin: 0 auto 0px auto;color:#1a5e53;font-size:16px";b.update("<div>Recibe tus pagos con "+translate("providerPayments",true)+". Si aún no estás afiliado a "+translate("providerPayments",true)+', haz clic <a href="https://visanetdominicana.com/solicitudes-online" target="_blank" style="font-weight: bold;">aquí</a>.')}else{if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.update('<div>Gana tiempo y tranquilidad con la integración entre Nequi y Alegra, puedes crear una cuenta en Nequi <a style="font-weight:bold;" href="https://conecta.nequi.com.co/content/formulario-de-registro" target="_blank">aquí</a>.</div>')}if(a.country&&a.country==="colombia"){b.hide()}}}}},{xtype:"box",style:"width: 400px;text-align: center;margin: 0 auto 30px auto;color:#888;",html:translate("alegraBrand")+" te ofrece la integración con "+translate("providerPayments",true)+" que es un servicio independiente, "+translate("alegraBrand")+" no es responsable por los pagos realizados por esta plataforma.",listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.update("Configura tus parámetros de perfil de acceso.")}else{if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.update("Alegra te ofrece la integración con Nequi que es un servicio independiente, Alegra no es responsable por los pagos realizados por esta plataforma.")}if(a.country&&a.country==="colombia"){b.hide()}}}}},{xtype:"checkboxfield",fieldLabel:"Permitir "+translate("externalPayments"),name:"canReceiveExternalPayments",inputValue:"yes",uncheckedValue:"no"},{xtype:"combo",fieldLabel:"Proveedor de pagos",displayField:"label",valueField:"value",name:"externalPaymentsProvider",emptyText:"Seleccionar",editable:false,forceSelection:false,allowBlank:true,store:{fields:["label","value"],data:[{label:"PayU",value:"payu"},{label:"Nequi",value:"nequi"}]},listeners:{beforerender:function(b){var a=b.up("form");if(a.country){if(a.country!=="colombia"){b.hide()}else{if(a.externalPaymentsProvider){b.setValue(a.externalPaymentsProvider)}}}},select:function(a){if(a.getValue()=="nequi"){window.location="/company/edit-external-payments-info/provider/nequi"}else{window.location="/company/edit-external-payments-info/provider/payu"}}}},{margin:"0 0 0 236",xtype:"box",name:"help1",html:'<div style="margin-bottom: 4px;"><span style="font-size: 11px;">Gana tiempo y tranquilidad con la integración entre '+translate("providerPayments",true)+"<br>y Alegra, puedes crear una cuenta en "+translate("providerPayments",true)+' <a style="font-weight:bold;" href="https://www.payulatam.com/co/abre-tu-cuenta-aliado-soluciones-alegra/" target="_blank">aquí</a></span></div>',listeners:{beforerender:function(b){var a=b.up("form");if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.update('<div style="margin-bottom: 4px;"><span style="font-size: 11px;">Para recibir pagos con Nequi, regístrate como <span style="font-weight: bold;">Negocio<br>Nequi</span> <a style="font-weight:bold;" href="https://negocios.nequi.co/registro/alegra?utm_source=alegra%20app&utm_medium=organic" target="_blank">aquí</a>.<br>Si ya eres un <span style="font-weight: bold;">Negocio Nequi</span> haz clic en <span style="font-weight: bold;">Guardar</span>.</span></div>')}if(a.country&&a.country!="colombia"){b.hide()}}}},{xtype:"textfield",fieldLabel:translate("apiKey",true),name:"apiKey",tooltip:"Puedes encontrarla en el panel de configuración/información técnica de "+translate("providerPayments",true),allowBlank:false,listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.tooltip="Ingresa la llave Web/Mobile entregada por VisaNet."}else{if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.fieldLabel="API Key";b.tooltip='Puedes encontrarla accediendo a tu cuenta de Nequi Conecta y consultando la sección de "API Key"'}}}}},{xtype:"textfield",fieldLabel:translate("merchantId",true),name:"merchantId",tooltip:"Puedes encontrarla en el panel de configuración/información técnica de "+translate("providerPayments",true),allowBlank:false,maxLength:12,regex:/^([0-9]+(\.[0-9]+)?)$/,minValue:0,listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.tooltip="Agrega la identificación de comercio asignada por VisaNet."}}}},{xtype:"textfield",fieldLabel:translate("accountId",true),name:"accountId",tooltip:"Puedes encontrarla en el panel de cuentas de "+translate("providerPayments",true),allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,maxLength:6,minValue:0,listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.tooltip="Registra la identificación de tu perfil con VisaNet."}else{if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.fieldLabel="Access Key";b.tooltip='Puedes encontrarla accediendo a tu cuenta de Nequi Conecta y consultando la sección de "API Key"'}}}}},{xtype:"textfield",fieldLabel:"Secret key",name:"secretKey",tooltip:"Puedes encontrarla en el panel de cuentas de "+translate("providerPayments",true),maxLength:512,hidden:true,listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.tooltip="Agrega la llave privada de acceso a VisaNet."}else{if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.fieldLabel="Secret Key";b.tooltip='Puedes encontrarla accediendo a tu cuenta de Nequi Conecta y consultando la sección de "API Key"'}}}}},{xtype:"checkboxfield",fieldLabel:"Permitir "+translate("retentions"),name:"canApplyRetentions",tooltip:"Activando esta opción, permites a tus clientes agregar "+translate("retentions")+" al pagar",inputValue:"yes",uncheckedValue:"no",hidden:true},{xtype:"checkboxfield",fieldLabel:"Monto mínimo de pago",name:"restrictMinimumPayment",tooltip:"Activando esta opción, estableces un monto mínimo para recibir pagos de tus clientes",inputValue:"yes",uncheckedValue:"no",listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country==="republicaDominicana"){b.tooltip="Activa esta opción para definir un monto mínimo al recibir pagos por este medio."}}}},{xtype:"textfield",regex:/^([0-9]+(\.[0-9]+)?)$/,fieldLabel:"Establecer monto mínimo de pago",name:"minimumAmount",minValue:0,disabled:true},{xtype:"box",html:'<div style="margin-top: 25px;"><span class="req">*</span> Alegra no tiene responsabilidad por los pagos efectuados por '+translate("providerPayments",true)+".</div>",listeners:{beforerender:function(b){var a=b.up("form");if(a.country&&a.country!=="republicaDominicana"){b.hide()}}}},{padding:"0 0 0 236",xtype:"box",name:"help2",html:'<div style="margin-bottom: 4px;"><span style="font-size: 11px;">Alegra te ofrece la integración con '+translate("providerPayments",true)+" que es un servicio<br>independiente, Alegra no es responsable por los pagos<br>realizados por esta plataforma.</span></div>",listeners:{beforerender:function(b){var a=b.up("form");if(a.externalPaymentsProvider&&a.externalPaymentsProvider==="nequi"){b.update('<div style="margin-bottom: 4px;"><span style="font-size: 11px;">Alegra te ofrece la integración con Nequi que es un<br>servicio independiente, Alegra no es responsable por los<br>pagos realizados por esta plataforma.</span></div>')}if(a.country&&a.country!="colombia"){b.hide()}}}},],buttons:[{xtype:"buttons_Cancel",height:23,width:65,listeners:{afterrender:function(b){var c=this.getEl();var a=c.down("a.cancel-link");a.on("click",function(g,f,d){g.preventDefault();window.location="/configuration"})}}},{text:"Guardar",action:"saveExternalPaymentsInfo",formBind:true}],initComponent:function(){var a=".</div>";switch(this.country){case"colombia":a=' <a style="font-weight:bold;" href="https://www.payulatam.com/co/abre-tu-cuenta-aliado-soluciones-alegra/" target="_blank">aquí</a>.</div>';this.width=620;this.defaults.labelWidth=220;this.defaults.width=520;break;case"mexico":a=' <a style="font-weight:bold;" href="https://www.payulatam.com/mx/abre-tu-cuenta-aliado-soluciones-alegra/" target="_blank">aquí</a>.</div>';break}this.items[0].html+=a;this.callParent(arguments)},disabledControls:function(d){var h=this.down("[name=externalPaymentsProvider]");var e=this.down("textfield[name=apiKey]");var j=this.down("textfield[name=merchantId]");var f=this.down("textfield[name=accountId]");var a=this.down("textfield[name=secretKey]");var c=this.down("checkboxfield[name=canApplyRetentions]");var g=this.down("checkboxfield[name=restrictMinimumPayment]");var b=this.down("textfield[name=minimumAmount]");var l=this.down("[name=help1]");var k=this.down("[name=help2]");if(d){h.enable();e.enable();j.enable();f.enable();a.enable();c.enable();g.enable();l.enable();k.enable();if(g.getValue()){b.enable()}}else{h.getSubmitData=this.getSubmitDataDisabled;e.getSubmitData=this.getSubmitDataDisabled;j.getSubmitData=this.getSubmitDataDisabled;f.getSubmitData=this.getSubmitDataDisabled;a.getSubmitData=this.getSubmitDataDisabled;c.getSubmitData=this.getSubmitDataDisabled;h.disable();e.disable();j.disable();f.disable();a.disable();c.disable();g.disable();b.disable();l.disable();k.disable()}},getSubmitDataDisabled:function(){var a=this,b=null,c;if(a.submitValue&&!a.isFileUpload()){c=a.getSubmitValue();if(c!==null){b={};b[a.getName()]=c}}return b}});Ext.define("AL.view.company.FormTemplatePdfEdit",{extend:"Ext.form.Panel",alias:"widget.company_FormTemplatePdfEdit",border:false,bodyStyle:{background:"transparent",color:"#9A9A9A",padding:"5px 35px"},requires:["AL.view.buttons.Cancel","AL.view.admin.company.CountriesCombo"],width:1024,defaultType:"textfield",defaults:{labelWidth:210,labelAlign:"left",labelStyle:"font-size: 14px",width:350,labelPad:15},TemplatePickerRecordValue:"idLocal",initComponent:function(){this.items[0].recordValue=this.TemplatePickerRecordValue;if(this.isTest=="yes"&&this.canTestOtherCountries=="yes"){this.width="100%";this.items[1].items[1].items[1].height=800}this.items[0].resource=this.resource;this.items[0].country=this.country;if(this.resource=="estimate"){this.items[0].label='Plantilla de impresión<div class="tooltip-wrapper invoiceTemplate"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">Selecciona la plantilla predeterminada para tus '+translate("estimates")+'. <a href="http://ayuda.getsoft.app/hc/es/articles/115002542183" target="_blank">Ver más</a>.</div></div></div></div>'}else{this.items[0].label='Plantilla de impresión<div class="tooltip-wrapper invoiceTemplate"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">Selecciona la plantilla predeterminada para tus '+translate("remissions")+'. <a href="http://ayuda.getsoft.app/hc/es/articles/115002542183#remisiones" target="_blank">Ver más</a>.</div></div></div></div>'}this.callParent(arguments)},items:[{xtype:"company_InvoiceTemplatePicker",width:"100%",name:"idTemplatePdf",store:"TemplatesPdf",containerStyle:"margin-bottom: 15px; border-bottom: 1px solid;",labelStyle:"font-size: 14px; color: #1A5E53; position: relative;",itemsContainerStyle:"margin: 5px 10px 20px;",collapsable:false,useItemsGroup:false,showPreviewButton:false,useRadioAsSelector:false},{xtype:"container",width:"100%",margin:"0 0 25 0",layout:{type:"hbox"},items:[{xtype:"container",width:400,items:[{xtype:"fieldset",title:"",padding:15,layout:"anchor",items:[{xtype:"box",itemId:"anotationText",html:'<div style="text-align: center; margin: 20px 60px;">La imagen es una representación de cómo se verá tu documento.</div>'},{xtype:"container",defaults:{style:"float: right; margin-top: 10px;",},items:[{xtype:"button",text:"Guardar",action:"saveTemplatePdf",margin:"10 10 0 0",formBind:true,disabled:true},{xtype:"button",itemId:"showPreviewButton",text:translate("preview",true),formBind:true,disabled:true}]}]},{xtype:"fieldset",title:'<b style="font-size: 14px;">Parámetros para pruebas</b>',itemId:"testParameters",padding:15,layout:"anchor",hidden:true,disabled:true,fieldDefaults:{layout:"100%",labelWidth:210},items:[{xtype:"admin_company_CountriesCombo",name:"keyCountry",value:"colombia",allowBlank:true,fieldLabel:"País para previsualizar"},{xtype:"checkboxfield",name:"multicurrency",fieldLabel:"Activar multimoneda",checked:false,inputValue:"yes",},{xtype:"checkboxfield",name:"showPlanText",fieldLabel:"Mostrar legenda de versión educativa",checked:false,inputValue:"yes",},]}]},{xtype:"container",flex:1,margin:"0 0 5 30",items:[{xtype:"box",itemId:"previewText",html:"Vista previa",width:"100%",style:"font-size: 14px; text-align: center; color: #333; font-weight: bold"},{xtype:"box",itemId:"previewBox",height:600,width:"100%",style:"background-color: #e3e3e3; border: 0;",autoEl:{tag:"iframe"}}]}]}],buttons:[],canUseKeyCountryField:function(){return this.isTest=="yes"&&this.canTestOtherCountries=="yes"}});Ext.define("AL.view.company.FileUploadWindow",{extend:"AL.view.common.SmileWindow",alias:"widget.company_FileUploadWindow",xtype:"fileuploadwindow",id:"window-file-upload",bodyPadding:20,title:"Ja",layout:"anchor",autoShow:true,autoScroll:true,width:380,height:320,modal:true,border:false,listeners:{close:function(a){if(a.onClose){a.onClose(a)}}},initComponent:function(){var c=this;this.footer={items:[{text:translate("send",true),cls:"button main-button",handler:function(d){var f=d.up("window");var e=f.down("button[name=main-action]");if(e){e.fireEvent("click",e);e.fireHandler()}},listeners:{afterrender:function(d){var g=d.up("window");var f=g.down("form");var e=g.down("button[name=main-action]");if(e){e.hide()}d.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){d.setDisabled(!h)})}}}]};this.callParent(arguments);var b=c.down("[xtype=box]");var a=c.down("[xtype=filefield]");b.update(c.helpText);a.name=c.fieldName;a.buttonText=c.buttonText;a.setFieldLabel(c.fieldLabel)},items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},bodyPadding:5,items:[{xtype:"box",style:"margin-bottom: 10px;"},{xtype:"filefield",labelWidth:50,allowBlank:false,labelPad:15,listeners:{change:function(d,c,a){var b=Ext.DomQuery.selectNode("input[id="+d.getInputId()+"]");b.value=c.replace("C:\\fakepath\\","")}}}],buttons:[{text:translate("send",true),disabled:true,formBind:true,margin:"10 10 0 0",height:40,name:"main-action",cls:"button main-button",handler:function(){var e=this.up("[xtype=fileuploadwindow]");var c=this.up("form");if(c.getForm().isValid()){if(e.asyncUpload){var a=c.down("filefield[name="+e.fieldName+"]");var b=a.fileInputEl.dom.files[0];var d=new FormData();var f=new XMLHttpRequest();d.append(e.fieldName,b);if(e.forceUploadEmptyResource){d.append("forceUploadEmptyResource",e.forceUploadEmptyResource)}if(e.hideFileSuccessMessage){d.append("hideFileSuccessMessage",e.hideFileSuccessMessage)}if(e.url=="/file/upload/format/json"){d.append("type",e.attachmentType)}f.open("POST",e.url);f.onreadystatechange=function(j){if(f.readyState==4){var g;try{g=JSON.parse(f.responseText)}catch(h){if(e.onFailure){e.onFailure(e,f.responseText,f)}return}if(g.success){if(e.onSuccess){e.onSuccess(e,g,f)}}else{if(e.onFailure){e.onFailure(e,g,f)}}}};if(e.onSubmit){e.onSubmit(e,f)}f.send(d)}else{c.submit({url:e.url,waitMsg:translate("loading",true),success:function(j,h){var g=h.response;var k=Ext.decode(g.responseText);if(k.success){window.location.reload()}else{Ext.MessageBox.alert("Error",k.cause)}},failure:function(j,g,k){var h=Ext.decode(g.response.responseText);if(h){Ext.MessageBox.alert(translate("error",true),h.cause)}else{Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}}})}}}}]}]});Ext.define("AL.view.company.FileUploadWindowLogo",{extend:"AL.view.common.SmileWindow",alias:"widget.company_FileUploadWindowLogo",xtype:"fileuploadwindowlogo",id:"window-file-upload-logo",bodyPadding:20,title:"Ja",layout:"anchor",autoShow:true,autoScroll:true,width:380,height:380,modal:true,border:false,listeners:{close:function(a){if(a.onClose){a.onClose(a)}}},initComponent:function(){var c=this;this.footer={items:[{text:translate("send",true),cls:"button main-button",handler:function(d){var f=d.up("window");var e=f.down("button[name=main-action]");if(e){e.fireEvent("click",e);e.fireHandler()}},listeners:{afterrender:function(d){var g=d.up("window");var f=g.down("form");var e=g.down("button[name=main-action]");if(e){e.hide()}d.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){d.setDisabled(!h)})}}}]};this.callParent(arguments);var b=c.down("[xtype=box]");var a=c.down("[xtype=filefield]");b.update(c.helpText);a.name=c.fieldName;a.buttonText=c.buttonText;a.setFieldLabel(c.fieldLabel)},items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},bodyPadding:5,items:[{xtype:"box",style:"margin-bottom: 10px;"},{xtype:"resizableimage",name:"resizableimage",style:"text-align: center",acceptedWidthImage:300,acceptedHeightImage:90,nameField:"logo",textFieldLabel:" ",id:"resizableimage-modal",textButtonText:"Examinar ...",htmlAfterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -236px;top: -57px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si necesitas ayuda para agregar el logo, haz <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/208577146">clic aquí</a>.</div></div></div></div>'},],buttons:[{text:translate("send",true),disabled:true,formBind:true,margin:"10 10 0 0",height:40,name:"main-action",cls:"button main-button",handler:function(){var d=Ext.ComponentQuery.query("filefield[name=logo]")[0];if(!d||!d.value&&d.value==""||typeof d.value==="undefined"){Ext.MessageBox.alert(translate("error",true),translate("youMustUploadAnImage",true)+".");return false}var g=this.up("[xtype=fileuploadwindowlogo]");var e=this.up("form");if(e.getForm().isValid()){if(g.asyncUpload){var b=e.down("filefield[name="+g.fieldName+"]");var c=b.fileInputEl.dom.files[0];var f=new FormData();var h=new XMLHttpRequest();f.append(g.fieldName,c);f.append("pngImageDataLogo",d.value);if(g.forceUploadEmptyResource){f.append("forceUploadEmptyResource",g.forceUploadEmptyResource)}if(g.hideFileSuccessMessage){f.append("hideFileSuccessMessage",g.hideFileSuccessMessage)}if(g.url=="/file/upload/format/json"){f.append("type",g.attachmentType)}h.open("POST",g.url);h.onreadystatechange=function(l){if(h.readyState==4){var j;try{j=JSON.parse(h.responseText)}catch(k){if(g.onFailure){g.onFailure(g,h.responseText,h)}return}if(j.success){if(g.onSuccess){g.onSuccess(g,j,h)}}else{if(g.onFailure){g.onFailure(g,j,h)}}}};if(g.onSubmit){g.onSubmit(g,h)}h.send(f)}else{var a={pngImageDataLogo:d.value};e.submit({url:g.url,params:a,waitMsg:translate("loading",true),success:function(l,k){var j=k.response;var m=Ext.decode(j.responseText);if(m.success){window.location.reload()}else{Ext.MessageBox.alert(translate("error",true),m.cause)}},failure:function(l,j,m){var k=Ext.decode(j.response.responseText);if(k){Ext.MessageBox.alert(translate("error",true),k.cause)}else{Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}}})}}}}]}]});Ext.define("AL.view.payroll.PlansSelectionWindow",{extend:"AL.view.common.SmileWindow",alias:"widget.payroll_PlansSelectionWindow",modal:true,draggable:false,resizable:false,border:false,layout:{type:"vbox",align:"stretch"},padding:0,width:1047,height:565,isSavingConfig:false,plansConfig:[],items:[{xtype:"container",flex:90,layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",margin:"7 0 30 0",style:{color:"#00535e !important","font-family":"'Roboto', sans-serif !important","font-size":"20px !important","font-weight":"lighter !important","text-align":"center !important"}},{xtype:"container",layout:{type:"hbox",align:"stretch",pack:"center"},items:[{xtype:"box"}]}]},{xtype:"container",border:"1 0 0 0",flex:10,layout:{type:"hbox",align:"stretch",pack:"center"},style:{borderColor:"#f2f2f2",borderStyle:"solid"},items:[{xtype:"label",margin:"21 0 0 0",style:{color:"#949494 !important","font-family":"'Roboto', sans-serif !important","font-size":"14px !important"}}]}],initComponent:function(){this.initTranslations();this.initPlansOptions();this.callParent(arguments)},initTranslations:function(){this.title=translate("alegraPayrollPlans",true);this.items[0].items[0].text=translate("payrollPlansSelectionWindowHeaderMessage");this.items[1].items[0].text=translate("payrollPlansSelectionWindowFooterMessage")},initPlansOptions:function(){var f=this.plansConfig;var d=f.length;var c="";var b,e,a;for(b=0;b<d;b++){e=f[b];if(e.hidden){continue}a=e.maxEmployees==1?translate("oneEmployee",true):translate("upToEmployeesNumberEmployees",true,{employeesNumber:e.maxEmployees});c+='<div class="plans-modal-option-container" id="alegra-nominapp-container"><ul class="plans-container"><li style="background-color: '+e.color+';"><section class="content plans-modal-option-content"><div class="highlight plans-modal-option-highlight" style="color: '+e.color+';">'+e.name+'</div><div class="plans-modal-option-employees">'+a+'</div><div class="plans-modal-option-discount">'+translate("payrollPlansSelectionWindowPlanDiscountMessage")+'</div><div class="text-green-dark plans-modal-option-price-container"><span class="plans-modal-option-price">'+e.price+'</span> / <span style="text-transform: uppercase;">'+translate("month",true)+'</span></div><div class="plan-button plans-modal-option-play-button" data-plankey="'+e.name+'"style="background-color: '+e.color+';">'+translate("choosePlan",true)+"</div></section></li></ul></div>"}this.items[0].items[1].items[0].html=c},listeners:{afterrender:function(a){a.addClickEvents()},beforeclose:function(a){if(a.isSavingConfig){return false}return true}},addClickEvents:function(){var b=this;var a=Ext.select("#alegra-nominapp-container .plans-container .plan-button");if(a){a.on("click",function(c){b.save(c.target.getAttribute("data-plankey"))})}},save:function(b){var c=this;if(c.isSavingConfig){return}c.isSavingConfig=true;var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("loadingAction",true)});a.show();Ext.Ajax.request({url:"/payroll/subscribe-to-nominapp/format/json",method:"POST",params:{plan:b},success:function(e){a.hide();var d=Ext.decode(e.responseText);if(d.success){b=b.charAt(0).toUpperCase()+b.slice(1);Ext.create("AL.view.common.modern.Msg",{title:translate("payrollPlanActivation",true),height:150,msgHtmlConfig:translate("payrollPlanSubscriptionSuccessMessage",true,{planName:b}),handlerConfig:function(f){window.location.reload()}})}else{GlobalMsg.showNotification({title:translate("errorTitle",true),text:translate("payrollPlanActivationErrorMessage",true),type:"error"});c.isSavingConfig=false}},failure:function(){a.hide();Ext.create("AL.view.common.modern.Msg",{title:translate("errorTitle",true),height:150,msgHtmlConfig:translate("payrollPlanIntegrationErrorMessage",true)});GlobalMsg.showNotification({title:translate("errorTitle",true),text:translate("payrollPlanAccessErrorMessage",true),type:"error"});c.isSavingConfig=false}})}});Ext.define("AL.store.CurrenciesAll",{extend:"Ext.data.Store",model:"AL.model.Currency",proxy:{type:"ajax",url:"/currency/retrieve-currencies-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.conciliation.ConciliationGrid",{extend:"Ext.grid.Panel",alias:"widget.conciliation_ConciliationGrid",requires:["AL.view.ux.grid.CheckColumn","AL.plugin.grid.PageSize"],title:"",frame:true,border:true,minHeight:380,holds:"transactions",cls:"grid-conciliation-transactions",viewConfig:{markDirty:false,stripeRows:true,emptyText:'<style>.grid-conciliation-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes transacciones por conciliar!</div></div></div>'},autoScroll:true,scroll:"vertical",emptyText:"No tiene cuentas registradas",store:"Transactions",dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{xtype:"checkcolumn",header:"Conciliar",dataIndex:"draftConciliated",width:60,sortable:false,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"}},{header:"Fecha",dataIndex:"date",align:"center",width:90,renderer:this.renderDate},{header:"Beneficiario",dataIndex:"name",sortable:false,flex:2},{header:"Detalle",dataIndex:"associations",sortable:false,flex:3},{header:"Salidas",dataIndex:"amount",flex:1,renderer:this.renderPayment,align:"right"},{header:"Entradas",dataIndex:"amount",flex:1,renderer:this.renderDeposit,sortable:false,align:"right"}];this.callParent(arguments)},renderDeposit:function(f,g,b,h,d,c,a){var e="";if(b.get("type")==="in"){e=Ext.util.Format.usMoney(b.get("amount"),b.get("decimalPrecision"),b.get("currencySymbol"))}return e},renderDate:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b=new AL.date(f);return'<a href="/transaction/view/id/'+a+'" target="_blank">'+Ext.Date.format(b,"d/m/Y")+"</a>"},renderPayment:function(f,g,b,h,d,c,a){var e="";if(b.get("type")==="out"){e=Ext.util.Format.usMoney(b.get("amount"),b.get("decimalPrecision"),b.get("currencySymbol"))}return e}});Ext.define("AL.view.creditnote.AddVoidCause",{extend:"AL.view.common.AddVoidCause",alias:"widget.creditnote_AddVoidCause"});Ext.define("AL.view.creditnote.CreditNoteToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.creditnote_CreditNoteToolbar",toolbarConfig:{newButtonText:"Nueva "+translate("creditNote"),newButtonAction:"addCreditNote",newButtonWidth:150,searchEmptyText:"Buscar "+translate("creditNote")}});Ext.define("AL.view.creditnote.FormAddInvoice",{extend:"AL.view.common.FormAddInvoice",alias:"widget.creditnote_FormAddInvoice"});Ext.define("AL.view.currency.GridAll",{extend:"Ext.grid.Panel",alias:"widget.currency_GridAll",requires:["AL.plugin.grid.PageSize"],scroll:true,layout:"fit",frame:true,minHeight:390,width:1024,store:"CompanyCurrencies",cls:"grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">{{youHaventAssociatedCurrenciesYet}}</div></div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"CompanyCurrencies"}],hiddenColumns:{},plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.viewConfig.emptyText=this.viewConfig.emptyText.replace("{{youHaventAssociatedCurrenciesYet}}",translate("youHaventAssociatedCurrenciesYet",true));this.columns=[{header:translate("currency",true),dataIndex:"name",flex:1,sortable:false},{header:translate("code",true),dataIndex:"code",flex:1,sortable:false},{header:translate("symbol",true),dataIndex:"symbol",flex:1,sortable:false},{header:translate("rate",true),dataIndex:"exchangeRate",flex:1,renderer:this.renderTotal,sortable:false},{header:translate("actions",true),align:"center",type:"actions",renderer:this.setActions,width:80}];this.callParent(arguments)},setActions:function(e,f,b,h,d,c,a){var g='<div class="action-icons">';if(b.get("status")==="active"){g+='<a href="" title="'+translate("editRate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("activate",true)+'" class="addExchangeRate" /></a>'}else{if(b.get("status")==="inactive"){g+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("editRate",true)+'" class="disabled" />'}}if(b.get("deletable")){g+='<a href="/currency/delete/id/'+b.get("id")+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="deleteCurrency"/></a>'}else{g+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="disabled deleteCurrency" />'}if(b.get("canBeInactive")){if(b.get("status")==="active"){g+='<a href="#" title="'+translate("deactivate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleCurrencyStatus canBeInactive" /></a>'}else{if(b.get("status")==="inactive"){g+='<a href="#" title="'+translate("activate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleCurrencyStatus canBeInactive" /></a>'}}}else{g+='<img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="disabled toggleCurrencyStatus" />'}g+="</div>";return g},renderTotal:function(a){return Ext.util.Format.round(a,8)}});Ext.define("AL.controller.Currency",{extend:"Ext.app.Controller",views:["currency.FormAdd","currency.GridAll","currency.MulticurrencyForm"],models:["Currency","CompanyCurrency"],stores:["Currencies","CompanyCurrencies"],init:function(){var a=Ext.get("addCurrency");if(a){a.on("click",function(d){d.preventDefault();var c=a.getAttribute("data-currency");var b=a.getAttribute("data-show-cbx-auto");Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:350,title:translate("add",true)+" "+translate("currency"),bodyStyle:"background: transparent",items:[{xtype:"currency_FormAdd",currency:c,showCbxExchangeRateAuto:b},],footer:{items:[{text:translate("save",true),cls:"button main-button",handler:function(e){var g=e.up("window");var f=g.down("button[action=save]");if(f){f.fireEvent("click",f)}},listeners:{afterrender:function(e){var g=e.up("window");var f=g.down("form");e.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){e.setDisabled(!h)})}}}]}})})}this.application.addListener("deleteCurrency",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("deleteCurrency",true),msg:translate("multicurrencyDeletionConfirmationMsg").replace("{{name}}",b.get("name")).replace("{{code}}",b.get("code")),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/currency/delete/format/json",method:"POST",params:{id:b.get("id")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("editExchangeRate",function(h){var g=h.initiator;var d=translate("rate",true);var e="";if(g){var f=g.up("form");var j=f.down("combo[name=currency]");e=f.configs.currency?f.configs.currency:"";if(h.currency){var c=h.currency;d="1 "+c+" = "}else{if(f&&j){var b=j.getSelectedRecord();d="1 "+b.get("code")+" = "}}}Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:290,currencyCode:h.currency,initiator:h.initiator,currencyRecord:h.currencyRecord,fireChangeEvent:h.fireChangeEvent,title:translate("edit",true)+" "+translate("rate"),bodyStyle:"background: transparent",items:[{xtype:"form",border:false,frame:false,items:[{xtype:"container",layout:"hbox",name:"exchangeRateContainer",items:[{xtype:"label",text:d,width:80,style:"text-align: right;",margin:"3 10 0 7"},{width:90,labelWidth:80,xtype:"textfield",labelAlign:"right",fieldLabel:"",name:"exchangeRate",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",allowBlank:false,labelPad:15},{xtype:"label",text:e,margin:"3 0 0 7"}]},{xtype:"checkbox",name:"updateCurrency",boxLabel:translate("useThisRateFromNowOn",true),inputValue:"yes",tooltip:translate("selectThisIfYouWantAlegraToHandleThisRateForYourNewDocuments",true)},],}],footer:{items:[{cls:"button main-button",text:translate("save",true),action:"saveExchangeRate",margin:"0 28 0 0",listeners:{afterrender:function(k){var m=k.up("window");var l=m.down("form");k.setDisabled(l.hasInvalidField());l.on("validitychange",function(o,n){k.setDisabled(!n)})}}}]},listeners:{afterrender:function(l){var k=l.currencyRecord;if(k){if(!k.get("status")||k.get("status")=="inactive"){l.down("checkbox[name=updateCurrency]").hide()}}}}})},this);this.application.addListener("toggleCurrencyStatus",function(d){var b=d.record;var c=d.initiator;Ext.Ajax.request({url:"/currency/toggle-status/format/json",method:"POST",params:{id:b.get("id")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=c.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})},this);this.application.addListener("addExchangeRate",function(f){var c=f.record;var d=f.initiator;var e=Ext.get("addCurrency");var b=e.getAttribute("data-show-cbx-auto");Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:290,title:translate("edit",true)+" "+translate("rate"),bodyStyle:"background: transparent",items:[{xtype:"currency_FormAdd",loadDefaultCurrency:false,listeners:{beforerender:function(h){var g=h.down("checkbox[name=updateExchangeRateAuto]");g.margin="10 0 0 20";g.width=300;g.setValue(c.get("autoUpdate"))},afterrender:function(l){var m=l.down("combo[name=currency]");m.setValue(c.get("code"));m.hide();var h=l.down("textfield[name=exchangeRate]");var j=l.down("container[name=exchangeRateContainer]");h.setFieldLabel("1 "+c.get("code")+" = ");j.add({xtype:"label",text:d.currency,margin:"3 0 0 7"});var k=l.down("button[action=save]");k.action="addExchangeRate";var g=l.down("checkbox[name=updateExchangeRateAuto]");if(b){g.show()}else{g.hide()}}}}],footer:{items:[{text:translate("save",true),cls:"button main-button",handler:function(g){var j=g.up("window");var h=j.down("button[action=addExchangeRate]");if(h){h.fireEvent("click",h)}},listeners:{afterrender:function(g){var j=g.up("window");var h=j.down("form");g.setDisabled(h.hasInvalidField());h.on("validitychange",function(l,k){g.setDisabled(!k)})}}}]}})},this);this.application.addListener("currencyCreated",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();if(b&&b.get("code")){b.data.splitCodeName=b.get("code")+" - "+b.get("name");c.add(b);e.select(b.get("code"))}},this);this.control({"currency_FormAdd combo[name=currency]":{afterrender:function(d){var b=d.getStore();var c=d.up("form");b.load({callback:function(){if(c.loadDefaultCurrency!==false){var e=b.findRecord("code","USD");if(e&&e.get("code")){d.select(e);d.fireEvent("select",d)}}}})},keypress:function(c,b){c.on("change",function(){var d=c.store;d.clearFilter();d.filter({property:"comboName",anyMatch:true,value:c.getValue()});if(c.getValue()==null){c.store.clearFilter()}})},select:function(g){var f=g.up("form");var b=f.down("textfield[name=exchangeRate]");var d=f.down("container[name=exchangeRateContainer]");g.store.clearFilter();var c=g.getSelectedRecord();if(c){b.setFieldLabel("1 "+c.get("code")+" = ");var e=f.down("label[name=currencyLabel]");Ext.each(e,function(h){e.destroy()});d.add({xtype:"label",name:"currencyLabel",text:f.currency,margin:"3 0 0 7"})}}},"currency_FormAdd checkbox[name=updateExchangeRateAuto]":{beforerender:function(c){var b=c.up("form");if(b.showCbxExchangeRateAuto){c.show()}else{c.hide()}}},currency_GridAll:{afterrender:function(c){var b=c.getStore();b.load()}},"currency_GridAll gridcolumn[type=actions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteCurrency")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteCurrency",{record:d,initiator:b})}else{Ext.Msg.alert(translate("error",true),translate("multicurrencyCantBeDeletedMsg1"))}}else{if(f.hasCls("toggleCurrencyStatus")){k.preventDefault();if(f.hasCls("canBeInactive")){m.fireEvent("toggleCurrencyStatus",{record:d,initiator:b})}else{Ext.Msg.alert(translate("error",true),translate("multicurrencyCantBeDeletedMsg2"))}}else{if(f.hasCls("addExchangeRate")){k.preventDefault();m.fireEvent("addExchangeRate",{record:d,initiator:b.up("grid")})}}}}},"currency_FormAdd button[action=save]":{click:function(f){var h=f.up("form");var g=h.up("window");var c=h.down("combo[name=currency]");var b=c.getSelectedRecord();var e=b.data.name;if(b){var d=h.getValues();Ext.Ajax.request({url:"/currency/add/format/json",method:"POST",params:d,success:function(l,n){var o=Ext.decode(l.responseText,true);if(o.success){g.close();var m=Ext.ComponentQuery.query("currency_GridAll")[0];if(m){var k=m.getStore();k.reload()}if(h.callback){d.code=d.currency;var j=Ext.create("AL.model.Currency",d);j.set("code",d.code);j.set("name",e);j.set("exchangeRate",d.exchangeRate);j.set("autoUpdate",d.updateExchangeRateAuto);h.callback(j)}}else{if(o.cause){GlobalMsg.showNotification({title:"Error",text:o.cause,type:"error"})}}},failure:function(j,k){var l=Ext.decode(j.responseText,true);GlobalMsg.showNotification({title:"Error",text:l.cause,type:"error"})}})}else{c.markInvalid(translate("youMustSelectACurrencyFromTheList",true));c.store.clearFilter()}}},"currency_FormAdd button[action=addExchangeRate]":{click:function(b){var d=b.up("form");var c=d.up("window");this.saveExchangeRate(d.getValues(),c)}},"button[action=saveExchangeRate]":{click:function(l){var n=l.up("window");var m=n.down("checkbox[name=updateCurrency]");var h=n.down("checkbox[name=updateExchangeRateAuto]");var o=n.down("textfield[name=exchangeRate]");var r={};var g=n.initiator;r.currency=n.currencyCode;r.exchangeRate=o.getValue();if(h){r.autoUpdate=h.getValue()}var q=this.application;if(m.getValue()){this.saveExchangeRate(r,n,g)}else{n.close();var s=r.exchangeRate;var c=g.up("form");var e=c.down("combo[name=currency]");var k=e?e.getSelectedRecord():null;var d=n.fireChangeEvent;var p;if(c&&e&&!n.currencyCode){p=k.get("code")}else{p=n.currencyCode}var j=this.getImageEditExchangeRate();s="1 "+p+"="+Ext.util.Format.round(r.exchangeRate,8)+" "+c.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#">'+j+"</a></div>";g.setValue(s);var b=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];b.setValue(Ext.util.Format.round(r.exchangeRate,8));var f=Ext.get("editExchangeRate");if(f){f.on("click",function(u){u.preventDefault();var t={};t.currency=p;t.initiator=g;t.currencyRecord=k;t.fireChangeEvent=d;q.fireEvent("editExchangeRate",t)})}if(n.fireChangeEvent){q.fireEvent("hiddenExchangeRateChanged",Ext.util.Format.round(r.exchangeRate,8))}}}},"checkbox[name=multicurrency]":{change:function(d){var b=d.up("form");var e=Ext.get("hideable");var c=Ext.get("title_hide");if(d.getValue()){if(b.canMulticurrency){Ext.Msg.show({title:"",msg:translate("multicurrencyActivationMsg1")+" "+translate("multicurrencyActivationMsg2")+" <br>"+translate("wouldYouLikeToContinue",true),buttons:Ext.Msg.YESNO,buttonText:{no:translate("cancelAction",true),yes:translate("accept",true)},fn:function(f){if(f=="yes"){if(b.isValid()){b.submit({url:"/currency/multicurrency/format/json",waitMsg:translate("loading",true),success:function(j,h){var g=h.response;var k=Ext.decode(g.responseText);if(k.success){window.location.reload()}else{GlobalMsg.showErrorMessage("Error",k.cause,"no")}}})}}else{if(f=="no"){d.setValue(false)}}},closable:false})}else{Ext.create("AL.view.company.WindowAclError",{configs:{title:translate("actionNotAvailableForCurrentPlan",true),text:translate("chooseNewPlanText",true),extraInfo:'<strong><a href="/plan">'+translate("seeAvailablePlans",true)+"</a></strong>"}});d.setValue(false)}}}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"invoice_FormAddInvoice combo[name=currency], invoice_FormAdvancedOptions combo[name=currency], recurringinvoice_FormAddRecurringInvoice combo[name=currency], creditnote_FormAddCreditNote combo[name=currency], estimate_FormAddEstimate combo[name=currency], remission_FormAddRemission combo[name=currency], bill_FormAddBill combo[name=currency], debitnote_FormAddDebitNote combo[name=currency], purchaseOrder_FormAddPurchaseOrder combo[name=currency], account_FormAdd combo[name=currency], transaction_FormTransaction combo[name=currency], recurringpayment_FormAdd combo[name=currency]":{beforerender:function(c){var b=c.up("form");if(b&&b.configs&&b.configs.canCreateNewCurrency&&b.xtype!="currency_FormAdd"){c.matchFieldWidth=false;c.listConfig.tpl='<tpl for="."><div if="code != \'null\'" class="x-boundlist-item">{splitCodeName}</div></tpl><div><a href="#" id="newCurrency" data-action="quickNewCurrency" class="createCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>";c.listConfig.width="auto"}}}})},saveExchangeRate:function(a,d,e){var c=this;var b=this.application;Ext.Ajax.request({url:"/currency/add-exchange-rate/format/json",method:"POST",params:a,success:function(l,q){var r=Ext.decode(l.responseText,true);if(r.success){d.close();var g=Ext.ComponentQuery.query("currency_GridAll")[0];if(g){var t=g.getStore();t.reload();g.getSelectionModel().clearSelections()}else{GlobalMsg.showNotification({title:translate("success",true),text:translate("currencyHasBeenUpdatedSuccessfully",true),type:"success"});if(e){var u=a.exchangeRate;var h=e.up("form");var j=h.down("combo[name=currency]");var s;var n=null;if(h&&j){n=j.getSelectedRecord();s=n.get("code");var o=j.getStore();var p=n;p.set("exchangeRate",a.exchangeRate);o.remove(n);o.add(p)}else{s=d.currencyCode}var m=c.getImageEditExchangeRate();u="1 "+s+"="+Ext.util.Format.round(a.exchangeRate,8)+" "+h.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#">'+m+"</a></div>";e.setValue(u);var f=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];f.setValue(Ext.util.Format.round(a.exchangeRate,8));var k=Ext.get("editExchangeRate");if(k){k.on("click",function(w){w.preventDefault();var v={};v.currency=s;v.initiator=e;v.currencyRecord=n;b.fireEvent("editExchangeRate",v)})}}}}else{GlobalMsg.showNotification({title:translate("error",true),text:r.cause,type:"error"})}},failure:function(f,g){var h=Ext.decode(f.responseText,true);GlobalMsg.showNotification({title:translate("error",true),text:h.cause,type:"error"})}})},listClick:function(f,h){var g=f.up("combo");var a=this.application;var d=Ext.ComponentQuery.query("currency_FormAdd")[0];var b="";if(!d){d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0]}if(!d){d=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!d){d=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(d){b="Bill"}}if(!d){d=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(d){b="DebitNote"}}if(!d){d=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!d){d=Ext.ComponentQuery.query("remission_FormAddRemission")[0]}if(!d){d=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];if(d){b="PurchaseOrder"}}if(!d){d=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("account_FormAdd")[0]}if(!d){d=Ext.ComponentQuery.query("transaction_FormTransaction")[0]}if(!d){return}if(d.configs&&d.configs.type){delete d.configs.type}if(h.target.getAttribute("data-action")=="quickNewCurrency"){h.preventDefault();if(d.emergent){window.open("/currency/add","_blank");return}var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-currency-modal",reason:"addNewCurrency",border:false,resizable:false,width:350,title:translate("add",true)+" "+translate("newF")+" "+translate("currency"),bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative;",id:"createNewCurrency",items:[{xtype:"container",id:"addCurrency2",items:[{xtype:"currency_FormAdd",style:"margin-bottom: 0px;margin: 0 auto;",title:"",bodyPadding:0,configs:d.configs,country:d.configs.country,emergent:true,callback:function(e){c.close();a.fireEvent("currencyCreated",{record:e,initiator:g})}}]},]}],required:true,footer:{items:[{text:translate("save",true),cls:"button main-button",handler:function(e){var k=e.up("window");var j=k.down("button[action=save]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(e){var k=e.up("window");var j=k.down("form");e.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){e.setDisabled(!l)})}}}]},listeners:{afterrender:function(j){var e=j.down("button[action=save]");var k=j.down("buttons_Cancel");if(e){e.hide()}if(k){k.hide()}}}})}},getImageEditExchangeRate:function(){var a='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" />';if(Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]){a='<svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use></svg>'}return a}});Ext.define("AL.view.customField.Panel",{extend:"Ext.form.Panel",alias:"widget.customField_Panel",border:false,width:500,height:120,bodyPadding:5,requires:["AL.view.buttons.Cancel"],items:[],buttons:[{xtype:"buttons_Cancel",height:23,width:65,cls:"sm-button-basic",height:38,width:157},{text:translate("save",true),action:"save",cls:"sm-button-primary",height:38,width:157}]});Ext.define("AL.controller.CustomField",{extend:"Ext.app.Controller",views:["AL.view.customField.Panel","AL.view.customField.FormAdd",],models:["CustomField"],stores:[],init:function(){this.control({customField_Panel:{afterrender:function(a){Ext.Ajax.request({url:"/custom-field/retrieve-all/format/json",method:"POST",params:{resource:a.configs.resource},success:function(d){var b=Ext.decode(d.responseText);if(b.success){var c=b.results;Ext.each(c,function(e){var g=false;if(e.status=="active"){g=true}var f={xtype:"checkboxfield",boxLabel:e.name,name:"customField",idField:e.id,checked:g};if(e.key=="barcode"){f.msgTarget="side";f.afterBodyEl='<div class="tooltip-wrapper" style="left: 140px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: 15px;top: -15px;"><div class="tooltip-text-wrapper tooltip-small" style="width : 275px;"><div class="text">Activa la funcionalidad de código de barras. <a target="_blank" href="https://ayuda.getsoft.app/crea-e-imprime-c%C3%B3digos-de-barras-para-tus-productos">Ver más</a>.</div></div></div></div>'}if(e.key=="importRequest"){f.msgTarget="side";f.afterBodyEl='<div class="tooltip-wrapper" style="left: 125px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: 15px;top: -15px;"><div class="tooltip-text-wrapper tooltip-small" style="width : 275px;"><div class="text">Activa esta función si vendes productos importados de primera mano. <a target="_blank" href="https://ayuda.getsoft.app/articles/3123763">Ver más</a>.</div></div></div></div>'}a.add(f)})}else{GlobalMsg.showErrorMessage("Error",b.cause)}}})}},"customField_Panel button[action=save]":{click:function(a){var c=Ext.ComponentQuery.query("checkboxfield[name=customField]");var b=[];Ext.each(c,function(d){var e=false;if(d.checked){e=true}b.push({id:d.idField,active:e})});Ext.Ajax.request({url:"/custom-field/update-custom-fields/format/json",method:"POST",params:{customFields:Ext.encode(b)},success:function(e){var d=Ext.decode(e.responseText);if(d.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage("Error",d.cause)}}})}},"customField_FormAdd button[action=save]":{click:function(a){var c=a.up("customField_FormAdd");var d=c.getValues();d.resourceType=c.configs.resourceType;var b=c.up("window");Ext.Ajax.request({url:"/customfield/add/format/json",method:"POST",params:d,success:function(f){var e=Ext.decode(f.responseText);if(e.success){b.destroy();window.location.reload();GlobalMsg.showNotification({title:"Éxito",text:"El "+translate("customfield")+" se ha creado exitosamente",type:"success"})}else{GlobalMsg.showErrorMessage("Error",e.cause)}}})}}})}});Ext.define("AL.view.dashboard.GraphIncomeExpensePanel",{extend:"Ext.panel.Panel",alias:"widget.dashboard_GraphIncomeExpensePanel",requires:["AL.view.ux.graph.Settings"],style:"overflow:visible;",bodyStyle:"overflow: visible;",border:false,width:550,height:240,items:[{xtype:"container",items:[{xtype:"box",name:"radioGroup",cls:"horizontal-label-radio-group",style:"margin-left   : 34%;",html:'<form><input value="accrued" type="radio" id="optionAccrued" name="selector" checked="true"><label for="optionAccrued">'+translate("unpaidCaused",true)+'</label><input value="payed" type="radio" id="optionPayed" name="selector"><label for="optionPayed">'+translate("paid",true)+"</label></form>"},{xtype:"graphSettings",name:"graphSettings",groupByOptions:[{id:"day",value:translate("week",true)},{id:"quarter",value:translate("quarter",true)},{id:"month",value:translate("semester",true),checked:true}]},{xtype:"box",name:"reloadButton",html:'<div class="graph-reload-button"></div>'},{xtype:"dashboard_GraphIncomeExpense"}]}],});Ext.define("AL.controller.Dashboard",{extend:"Ext.app.Controller",views:["dashboard.GridAccounts","dashboard.GridIncomeExpense","dashboard.DateOptions","dashboard.GraphExpense","dashboard.GraphExpensePanel","dashboard.GraphIncomeExpense","dashboard.GraphIncomeExpensePanel","dashboard.GraphOpenInvoices","dashboard.GraphOpenInvoicesPanel","dashboard.GraphSalesPanel","dashboard.GraphSales","dashboard.GridUserHistory","dashboard.OldGraphIncomeExpense","dashboard.OldGraphIncomeExpensePanel",],stores:["DashboardAccounts","DashboardIncome","DashboardExpense","DashboardUserHistory","ExpenseGraph","IncomeExpenseGraph","OpenInvoicesGraph","SalesGraph"],models:["Account","IncomeExpense","IncomeExpenseGraphPoint","OverdueGraphPoint","SimpleGraphPoint","UserHistory"],init:function(){this.control({"dashboard_DateOptions button":{toggle:function(a,e){if(e){Ext.Ajax.request({url:"/invoice/has-invoice/format/json",method:"GET",params:{format:"json"},success:function(w){var y=Ext.decode(w.responseText);if(!y.hasInvoice){var x=Ext.ComponentQuery.query("box[itemId=firstInvoiceButton]")[0];x.show()}},failure:function(w){console.log("Error"+w)}});var s=new Date();var k=Ext.Date.format(s,"N");var j=Ext.Date.getDayOfYear(s);var f=null;var r=null;var t="";switch(a.dateRange){case"today":f=s;r=f;t="Hoy";break;case"thisWeek":f=Ext.Date.add(s,Ext.Date.DAY,-1*k+1);r=Ext.Date.add(f,Ext.Date.DAY,6);t="Semana";break;case"thisMonth":f=Ext.Date.getFirstDateOfMonth(s);r=Ext.Date.getLastDateOfMonth(s);t="Mes";break;default:break}if(f&&r){var v=this;var p=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate();var l=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate();var o=Ext.ComponentQuery.query("dashboard_GridIncomeExpense")[0];var q=Ext.ComponentQuery.query("dashboard_GridIncomeExpense")[1];var m=o.getStore();var b=m.getProxy();b.setExtraParam("from-date",p);b.setExtraParam("to-date",l);m.load({callback:function(x,w,B,y){var A=v.getTotalFromRecords(x);var z=Ext.get("total-income-board");z.setHTML(Ext.util.Format.usMoney(AL.math.approx(A,null,2),2))}});var n=q.getStore();var c=n.getProxy();c.setExtraParam("from-date",p);c.setExtraParam("to-date",l);n.load({callback:function(x,w,B,y){var A=v.getTotalFromRecords(x);var z=Ext.get("total-expense-board");z.setHTML(Ext.util.Format.usMoney(AL.math.approx(A,null,2),2))}});var d=Ext.ComponentQuery.query("dashboard_OldGraphIncomeExpense")[0];var g=Ext.ComponentQuery.query("dashboard_OldGraphIncomeExpensePanel radiogroup")[0];var u=d.getStore();var h=u.getProxy();h.setExtraParam("range",a.dateRange);h.setExtraParam("type",g.getValue());u.load({callback:function(){var z=d.axes.get("bottom");z.setTitle(t);var x=false;Ext.each(this.getRange(),function(A){if(A.data["in"]!=0||A.data.out!=0){x=true}});var y=Ext.get("income-expense-graph");var w=Ext.get("graph-blank-state-message");if(!x){if(y){y.addCls("blank-state")}if(w){w.addCls("reveal")}}else{if(y){y.removeCls("blank-state")}if(w){w.removeCls("reveal")}}}})}}}},company_WindowReactiveDemo:{close:function(a){var b=a;var d=b.idCompany;var c=new Date();c.setTime(c.getTime()+(3600*1000));Ext.util.Cookies.set("hide-msg-reactive"+d,c)}},"dashboard_OldGraphIncomeExpensePanel radiogroup":{change:function(d,b,a){var o=Ext.ComponentQuery.query("dashboard_OldGraphIncomeExpense")[0];var e=Ext.ComponentQuery.query("dashboard_DateOptions")[0];var h=e.getPressedButton();var n=new Date();var l=Ext.Date.format(n,"N");var f=Ext.Date.getDayOfYear(n);var c=null;var j=null;var m="";switch(h.dateRange){case"today":c=n;j=c;m="Hoy";break;case"thisWeek":c=Ext.Date.add(n,Ext.Date.DAY,-1*l+1);j=Ext.Date.add(c,Ext.Date.DAY,6);m="Semana";break;case"thisMonth":c=Ext.Date.getFirstDateOfMonth(n);j=Ext.Date.getLastDateOfMonth(n);m="Mes";break;default:break}if(c&&j){var k=o.getStore();var g=k.getProxy();g.setExtraParam("range",h.dateRange);g.setExtraParam("type",b);k.load({callback:function(){var s=o.axes.get("bottom");s.setTitle(m);var q=false;Ext.each(this.getRange(),function(t){if(t.data["in"]!=0||t.data.out!=0){q=true}});var r=Ext.get("income-expense-graph");var p=Ext.get("graph-blank-state-message");if(!q){if(r){r.addCls("blank-state")}if(p){p.addCls("reveal")}}else{if(r){r.removeCls("blank-state")}if(p){p.removeCls("reveal")}}}})}}},"dashboard_GraphIncomeExpensePanel, dashboard_GraphExpensePanel, dashboard_GraphSalesPanel, dashboard_GraphOpenInvoicesPanel":{afterrender:function(a){var o=a.down("chart"),n=o.getStore(),e=6,b=new Date(),l=new Date(b.getFullYear(),b.getMonth(),1),k=Ext.Date.subtract(l,Ext.Date.MONTH,e-1),h=Ext.Date.subtract(Ext.Date.add(l,Ext.Date.MONTH,1),Ext.Date.DAY,1),f=a.down("box[name=radioGroup]"),c=f?f.getEl().query("[name=selector]"):[],d=a.down("graphSettings"),m=d?d.getElementsGroupByOptions():[];var j=function(){o.setLoading({msg:translate("loading",true)},true);var p=d?d.getGroupByOptionChecked():{id:"month"};if(p){switch(p.id){case"quarter":e=4;k=new Date(b.getFullYear(),0,1);break;case"day":e=7;k=Ext.Date.subtract(b,Ext.Date.DAY,b.getDay()-1);h=Ext.Date.add(k,Ext.Date.DAY,6);break;case"month":e=6;k=Ext.Date.subtract(l,Ext.Date.MONTH,e-1);break}}n.proxy.extraParams={fromDate:Ext.Date.format(k,"Y-m-d"),toDate:Ext.Date.format(h,"Y-m-d"),limit:e};Ext.each(c,function(q){if(q.checked){n.proxy.extraParams.filter=q.value}});if(p){n.proxy.extraParams.groupBy=p.id}n.load({callback:function(I,B,z){o.setLoading(false);if(a.renderTo==="expense-graph"){document.getElementById(a.id).style.overflow="visible";a.setBodyStyle("overflow: visible;")}if(z){var A=Ext.decode(B.response.responseText);var H=A.results?A.results:[];var q=A.useOptimizedGraph;var t=n.data.items;var C=H.length<=0;if(!C){C=true;verifyValue:for(var y=0;y<H.length;y++){var u=H[y];for(attr in u){if(u[attr]>0){C=false;break verifyValue}}}}var F=Ext.get(a.renderTo);var w=Ext.get("graph-blank-state-message-"+a.renderTo);var D=Ext.get("dashboard-blank-state-"+a.renderTo);if(C){if(a.renderTo==="open-invoices-graph"){var J=Ext.ComponentQuery.query("box[itemId=firstInvoiceButton]")[0];J.show()}if(w&&F){F.addCls("graph-blank-state");w.addCls("reveal")}if(D){D.addCls("dashboard-blank-state-graph")}if(o.configs.type==="pie"){n.add([Ext.create("AL.model.SimpleGraphPoint",{name:"Dato inicial",value:250000}),Ext.create("AL.model.SimpleGraphPoint",{name:"Dato inicial",value:250000})])}}else{if(w&&F){F.removeCls("graph-blank-state");w.removeCls("reveal")}if(D){D.removeCls("dashboard-blank-state-graph")}}if(((q&&C)||(!q&&H.length<e))&&o.configs&&o.configs.completeLimit){if(q){n.removeAll()}var s=[];var x=null;var G=n.proxy.extraParams.groupBy?n.proxy.extraParams.groupBy:"month";switch(G){case"quarter":x=Math.floor(k.getMonth()/3);break;case"month":x=k.getMonth();break;case"day":x=k;break}for(var y=0;y<e;y++){var M=null;switch(G){case"quarter":M=AL.util.date.getQuarterName(x);break;case"month":x=x>11?(x-12):x;M=AL.util.date.getMonthName(x);break;case"day":M=Ext.Date.format(x,"Y-m-d");break}var K=Ext.Array.filter(t,function(N){return N.get("name")===M});if(G==="day"){M=AL.util.date.getDayName(x.getDay())}var E=null;if(!q){E=K.length>0?K[0]:null}if(E){if(G==="day"){E.set("name",M)}}else{if(n.storeId=="IncomeExpenseGraph"){E=Ext.create("AL.model.IncomeExpenseGraphPoint",{name:M,"in":C?Math.floor((Math.random()*500000)+1):0,out:C?Math.floor((Math.random()*500000)+1):0})}else{if(n.storeId=="OpenInvoicesGraph"){E=Ext.create("AL.model.OverdueGraphPoint",{name:M,overdueLess30:C?Math.floor((Math.random()*500000)+1):0,overdue30To60:C?Math.floor((Math.random()*500000)+100000):0,overduePlus60:C?Math.floor((Math.random()*500000)+5000):0})}}}s.push(E);if(G==="day"){x=Ext.Date.add(x,Ext.Date.DAY,1)}else{x++}}n.add(s)}if(o.configs.type==="pie"){var L=n.sum("value"),r=0;for(var y=0;y<n.data.items.length;y++){var v=n.data.items[y];percentage=Math.round(AL.math.approx(v.get("value"),null,0)/L*100);r=AL.math.add(r,percentage);if(y==n.data.items.length-1){if(r<100){n.data.items[0].set("percentage",AL.math.add(n.data.items[0].get("percentage"),AL.math.sub(100,r)))}else{if(r>100){percentage=AL.math.sub(percentage,AL.math.sub(r,100))}}}v.set("percentage",percentage)}}}}})};Ext.each(c.concat(m),function(p){p.onchange=j});var g=a.down("box[name=reloadButton]");if(g){g.getEl().on("click",j)}j()}}})},getTotalFromRecords:function(a){var b=0;Ext.each(a,function(c){b=AL.math.add(b,c.get("amount"));if(c.get("amountAdvancesApplied")>0){b=AL.math.sub(b,c.get("amountAdvancesApplied"))}});return b}});Ext.define("AL.view.estimate.FormAddEstimate",{extend:"Ext.form.Panel",alias:"widget.estimate_FormAddEstimate",requires:["AL.view.ux.fields.Numeration","AL.view.ux.form.Switch","AL.view.common.SmileNumeration"],style:"margin-bottom: 10px; padding-left: 30px; padding-right: 30px;",title:"",anchor:100,layout:{type:"vbox",align:"stretch"},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",flex:1,padding:"0 0 27 0",style:"border-bottom: 1px rgba(151, 151, 151, 0.2) solid",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:33,layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",name:"logoBox",configs:{maxWidth:300,maxHeight:86},html:'<div class="form-add-invoice-image-zone" onselectstart="return false;"><div style="font-size: 24px; font-weight: bold; padding-top: 23px;">'+translate("useMyLogo",true)+'</div><div style="font-size: 12px;">178 x 51 '+translate("pixels")+"</div></div>"}]},{xtype:"container",flex:33,id:"companyInfoInvoice",layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",id:"labelInvoiceCompanyName",name:"companyName",style:"padding-top: 10px; padding-bottom: 2px; font-family: Roboto; font-size: 20px; font-weight: bold; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyIdentification",name:"companyIdentification",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyEmail",name:"companyEmail",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"companyEditInvoice",name:"companyEdit",style:"height: 16px; font-family: Roboto; text-align: center; line-height: normal; word-wrap: break-word; margin-top: 5px; cursor: pointer;",html:'<svg class="icon small" id="editIcon" style="color: #00B19D; display: none;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use></svg><a href="#" id="editHref" style="color: #00B19D; display: none;">'+translate("edit",true)+"</a>",text:""},],listeners:{el:{mouseover:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","inline-block");a.setStyle("display","inline-block")},mouseout:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","none");a.setStyle("display","none")}}}},{xtype:"container",flex:33,layout:{type:"hbox",align:"stretch"},items:[{xtype:"smilenumeration",name:"numerationComponent",documentType:"estimate",configs:{documentType:"estimate",parent:"estimate_FormAddEstimate"},flex:33},]}]},{xtype:"container",style:"margin-top:  25px",layout:{type:"hbox",},items:[{xtype:"container",defaults:{labelAlign:"right",labelPad:15,width:600,labelWidth:110},flex:1,items:[{xtype:"container",id:"containerLeft",flex:1.5,items:[{xtype:"container",layout:"hbox",items:[{xtype:"combo",fieldLabel:translate("clientA",true),name:"idClient",triggerAction:"all",allowBlank:false,store:"Clients",width:400,emptyText:translate("search",true),displayField:"name",valueField:"idLocal",id:"estimateClientCombo",style:"margin-bottom:5px",minChars:0,labelAlign:"right",blankText:translate("itIsNecessaryToAssignAClientTo",true)+" "+translate("theEstimate")+" "+translate("estimate")+".",msgTarget:"side",labelPad:15,labelWidth:123,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"box",width:170,style:"margin-left: 10px;",html:'<a href="#" title="'+translate("registerHereNewContactToAssociateWith2",true)+" "+translate("asClient")+'." data-tooltip-title="Crear nuevo cliente" class="addAnother" id="createOtherContact">'+translate("newContact",true)+"</a>"}]},{xtype:"textfield",fieldLabel:translate("identification",true),name:"clientIdentification",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},{xtype:"textfield",fieldLabel:translate("phone",true),name:"clientPhone",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},]},]},{xtype:"container",flex:0.7,defaults:{labelAlign:"right",labelPad:15,width:350,labelWidth:150,msgTarget:"side",},items:[{xtype:"datefield",fieldLabel:translate("creation",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDateOf",true)+" "+translate("theEstimate")+" "+translate("estimate")+"",invalidText:"{0} "+translate("itIsNotAValidDateItMust")+" {1}",id:"estimateDateDatefield"},{xtype:"combo",id:"estimateTermCombo",fieldLabel:translate("deadline",true),name:"days",allowBlank:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 5px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -274px; top: -52px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 260px;"><div class="text">'+translate("selectThePaymentDueDateYouCanAdd",true)+'<a href="/term" target="_blank">'+translate("here")+"</a>.</div></div></div></div>",store:"Terms",displayField:"name",valueField:"idLocal",queryMode:"local",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewTerm" class="createNewTerm">'+translate("newTerm")+"</a></div>"},hidden:true},{xtype:"datefield",id:"estimateDueDateDateField",fieldLabel:translate("due",true),name:"dueDate",allowBlank:false,value:Ext.Date.add(new Date(),Ext.Date.DAY,30),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineADateWhen",true)+" "+translate("theEstimate",true)+" "+translate("estimate")+" "+translate("expiresItself"),invalidText:"{0} "+translate("itIsNotAValidDateItMust")+" {1}"},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("estimate")+".",emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:350},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}}]}],},{xtype:"container",flex:1,name:"advancedOptionsContainer",allowBlank:true,msgTarget:"side",labelAlign:"right",labelPad:15,items:[{xtype:"label",html:'<span id="advancedOptionsLink" href="#">'+translate("moreOptions",true)+"</span>"},{xtype:"estimate_FormAdvancedOptions",hidden:true}]}]});Ext.define("AL.view.globalInvoice.SaleTicketGrid",{extend:"Ext.grid.Panel",alias:"widget.globalInvoice_SaleTicketGrid",requires:["AL.view.ux.grid.CheckColumn","AL.plugin.grid.PageSize"],title:"",frame:true,border:true,minHeight:380,holds:"saleTickets",cls:"grid-conciliation-transactions",viewConfig:{markDirty:false,stripeRows:true,deferEmptyText:false,},autoScroll:true,scroll:"vertical",emptyText:"No tienes "+translate("saleTickets")+" por timbrar",store:"SaleTickets",dockedItems:[{xtype:"pagingtoolbar",store:"SaleTickets"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){var b=Ext.define("AL.store.SaleTickets",{extend:"Ext.data.Store",model:"AL.model.SaleTicket",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/invoice/retrieve-all/format/json",reader:{type:"json",root:"results"}},listeners:{load:function(){var c=Ext.dom.Query.select("img[alt=Imprimir], img[alt=Ver detalle], img[alt=Agregar Pago], img[alt=Convertir a Abierta], img[alt=Editar], img[alt="+translate("cancel",true)+"], img[alt=Eliminar]");Ext.each(c,function(d){d.title=d.alt})}}});this.columns=[{xtype:"checkcolumn",header:"Timbrar",dataIndex:"previouslyChecked",id:"stampColumnHeader",columnHeaderCheckbox:true,sortable:false,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},html:'<div id="headerCheckbox" class="tooltip-wrapper add-invoice" style="margin-left: -45px; margin-top: 8px;"><img src="https://cdn1.getsoft.app/images/unchecked.gif" style="cursor: default;"></div>',},{header:translate("number",true),dataIndex:"number",renderer:this.linkCode,align:"center"},{header:"Fecha",dataIndex:"date",align:"center",renderer:this.renderDate},{header:"Total",dataIndex:"total",sortable:false,flex:1,renderer:this.renderMoney},{header:"Observaciones",dataIndex:"observations",sortable:false,flex:2,},];var a="/invoice/add/dt/saleTicket";this.viewConfig.emptyText='<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes '+translate("saleTickets")+' por timbrar!</div><div class="button-wrapper"><a href="'+a+'" class="button green"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newSaleTicket",true)+"</a></div></div></div>";this.callParent(arguments)},linkCode:function(f,g,b,h,d,c,a){var e="";if(b.get("status")!=="draft"){e='<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("invoiceNumber")+"</a>"}return e},renderDate:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b=new AL.date(f);return Ext.Date.format(b,"d/m/Y")},renderPayment:function(f,g,b,h,d,c,a){var e="";if(b.get("type")==="out"){e=Ext.util.Format.usMoney(b.get("amount"),b.get("decimalPrecision"),b.get("currencySymbol"))}return e},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.controller.GlobalInvoice",{extend:"Ext.app.Controller",views:["globalInvoice.FormAddGlobalInvoice","globalInvoice.SaleTicketGrid","globalInvoice.Buttons","ux.grid.CheckColumn"],stores:["SaleTickets","ResolutionsCombo"],models:["SaleTicket","Resolution"],init:function(){var c=this;var b=Ext.select("a[data-action=voidGlobalInvoice]");if(b.elements.length>0){b.on("click",function(h,j){h.preventDefault();var f=Ext.get(j);var k=f.getAttribute("data-idGlobalInvoice");var d=Ext.create("AL.model.GlobalInvoice",{idLocal:k,});var g={country:f.getAttribute("current-country"),target:b};this.application.fireEvent("voidGlobalInvoice",{initiator:g,record:d})},this)}this.application.addListener("nextInvoiceNumberEdited",function(j){var g=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];if(g){var e=g.down("#nextInvoiceNumberContainer");e.removeAll(false);if(j.autoincrement==="yes"){var h=j.prefix?new String(j.prefix):"";var d=h+(g.configs&&g.configs.country==="peru"&&h?"-":"")+new String(j.nextInvoiceNumber);e.add({xtype:"box",html:'<div style="display:inline-block; text-align:right; min-width:100px;">'+translate("number",true)+'</div><div id="next-invoice-number">'+d+'</div> <a style="font-size:10px;color:#888" href="/resolution" id="editInvoiceInfo">Configurar</a>'})}else{var f=[{xtype:"textfield",name:"prefix",width:170,labelWidth:105,fieldLabel:translate("number",true),emptyText:translate("prefix",true),labelAlign:"right",labelPad:12},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,hideLabel:true,allowBlank:false,width:125,style:"margin-left:5px",msgTarget:"side",blankText:"Debe ingresar el "+translate("number")+" "+translate("ofTheInvoice")+" "+translate("invoice")},{xtype:"box",style:"font-size:10px;margin-left:10px",html:'<a href="#" style="color:#999; line-height:19px" id="editInvoiceInfo">Configurar</a>'}];e.add(f)}}},this);this.application.addListener("voidGlobalInvoice",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("globalInvoice"),msg:translate("areYouSureYouWantTo",true)+" "+translate("cancel")+" "+translate("theGlobalInvoice")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){if(e.target){target=e.target}else{target=e}var g=Ext.create("AL.LoadMask",{target:target,msg:translate("loading",true)});g.show();g.addDependantTask();Ext.Ajax.request({url:"/global-invoice/void/format/json",method:"POST",params:{id:d.get("idLocal")},timeout:120000,success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){if(e.getStore){var j=e.getStore();j.load()}else{window.location.reload()}}else{Ext.MessageBox.alert("Error",m.cause)}g.hide()},failure:function(){g.hide()}})}}})},this);var a=Ext.get("stampGlobalInvoice");if(a){a.on("click",function(f,d){var g=d.getAttribute("data-idLocal");f.preventDefault();GlobalRedirector.go({zoneTitle:"Timbrando "+translate("globalInvoice")});Ext.Ajax.request({url:"/global-invoice/stamp/format/json/id/"+g,success:function(e){var h=Ext.decode(e.responseText);if(h.success){window.location.reload()}else{GlobalRedirector.close();if(h.cause){GlobalMsg.showNotification({title:"Error",text:h.cause,type:"error"})}else{GlobalMsg.showNotification({title:"Error",text:translate("theGlobalInvoice")+" no se pudo "+translate("stamp"),type:"error"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:translate("theGlobalInvoice")+" no se pudo "+translate("stamp"),type:"error"})}})})}this.control({globalInvoice_FormAddGlobalInvoice:{render:this.initialize,afterlayout:function(r,q,o,m,l,k){var p=this;var g=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];var h=g.down("combo[name=resolutionCombo]");var n=Ext.get("editInvoiceInfo");if(n){var j=h.getSelectedRecord().data;n.removeAllListeners();n.on("click",function(d){d.preventDefault();p.application.fireEvent("editInvoiceNumberWindow",{idLocal:j.idLocal,country:g.configs?g.configs.country:null,isActiveElectronicInvoicing:g.configs?g.configs.isActiveElectronicInvoicing:null})})}}},"globalInvoice_SaleTicketGrid checkcolumn":{checkchange:this.checkColumnChange},globalInvoice_SaleTicketGrid:{render:function(d){var e=this;e.loadSaleTicketsGrid(d)}},"globalInvoice_Buttons #saveGlobalInvoiceButton":{click:function(d){var f=this;var e=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];if(e.mxReplace===true){Ext.Msg.show({title:"Sustitución de "+translate("globalInvoice"),msg:"¿Estás seguro que deseas sustituir "+translate("theGlobalInvoice")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g==="yes"){f.saveGlobalInvoice(d,false)}}})}else{f.saveGlobalInvoice(d,false)}}},"button[action=saveAndStamp]":{click:function(d){var f=this;var e=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];if(e.mxReplace===true){Ext.Msg.show({title:"Sustitución de "+translate("globalInvoice"),msg:"¿Estás seguro que deseas sustituir "+translate("theGlobalInvoice")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g==="yes"){f.saveGlobalInvoice(d,true)}}})}else{f.saveGlobalInvoice(d,true)}}},"button[action=cancel]":{click:function(d){var f=this;var e=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];if(e.type==="edit"){window.location="/global-invoice/view/id/"+e.globalInvoiceInfo.idLocal}else{window.location="/global-invoice"}}},"globalInvoice_FormAddGlobalInvoice combo[name=resolutionCombo]":{afterrender:function(g){var f=g.up("form");var e=g.getStore();if(!e.hasLoaded()){e.on("load",function(j){var h=e.findRecord("isDefault","yes");if(!h){h=j.getAt(0)}if(h){g.select(h.data.idLocal)}if(e.count()>1&&f.type!="edit"){g.show()}})}else{var d=e.findRecord("isDefault","yes");if(!d){d=data.getAt(0)}if(d){g.select(d.data.idLocal)}if(e.count()>1&&f.type!="edit"){g.show()}}if(f.type==="edit"){g.hide()}},select:function(h){var f=h.up("form");if(f.type==="edit"){var e=h.getSelectedRecord().data;var d=f.down("textfield[name=prefix]");var k=f.down("textfield[name=number]");var j=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];var g=j.down("textarea[name=resolutionText]");if(f.invoice.resolutionIdLocal==e.idLocal){if(g){g.setValue(f.invoice.resolution)}d.setValue(f.invoice.prefix);k.setValue(f.invoice.number)}else{if(g){g.setValue(f.invoice.resolution)}if(e.autoincrement&&e.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:e.idLocal},success:function(l,n){var m=Ext.decode(l.responseText);var o=m.results;d.setValue(o.prefix);k.setValue(o.number)},failure:function(){}})}else{k.setValue(null)}}}},change:function(f){var d=f.up("form");var l=f.getSelectedRecord().data;var j=d.down("#nextInvoiceNumberContainer");if(d.type!="edit"){if(l.autoincrement&&l.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:l.idLocal},success:function(n,p){var o=Ext.decode(n.responseText);var q=o.results;var r=q.prefix+q.number;j.removeAll(false);j.add({xtype:"box",html:'<div style="display: inline-block; text-align: right; min-width: 100px;">'+translate("number",true)+'</div><div id="next-invoice-number">'+r+'</div> <a style="font-size: 10px; color: #888" href="/resolution" id="editInvoiceInfo">Configurar</a>'});j.add({xtype:"box",html:'<div class="tooltip-wrapper add-invoice" style="top: 7px; left: 5px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper" style="width: 255px; margin-left: -5px; margin-top: -25px;"><div class="text">Descubre cómo configurar tus '+translate("numerations")+' <a target="_blank" href="https://ayuda.getsoft.app/configura-series-y-folios-de-documentos-y-facturas-m%C3%A9xico">aquí</a>.</div></div></div></div>'})},failure:function(){}})}else{j.removeAll(false);var m=[{xtype:"textfield",name:"prefix",width:170,labelWidth:105,fieldLabel:translate("number",true),emptyText:translate("prefix",true),labelAlign:"right",labelPad:12},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[0-9]+$/,hideLabel:true,allowBlank:false,width:125,style:"margin-left:5px",msgTarget:"side",blankText:"Debe ingresar el "+translate("number",true)+" "+translate("ofTheInvoice")+" "+translate("invoices")},{xtype:"box",style:"font-size:10px;margin-left:10px",html:'<a href="#" style="color:#999; line-height:19px" id="editInvoiceInfo">Configurar</a>'}];j.add(m)}}else{j.removeAll(false);var m=[{xtype:"textfield",name:"prefixEdit",width:170,labelWidth:105,fieldLabel:translate("number",true),emptyText:translate("prefix",true),text:"ok",labelAlign:"right",labelPad:12},{xtype:"textfield",name:"numberEdit",emptyText:translate("number",true),regex:/^[0-9]+$/,hideLabel:true,allowBlank:false,width:125,style:"margin-left:5px",msgTarget:"side",blankText:"Debe ingresar el "+translate("number",true)+" "+translate("ofTheInvoice")+" "+translate("invoices")}];j.add(m);var h=d.down("[name=prefixEdit]");var e=d.down("[name=numberEdit]");var g=d.down("[name=date]");var k=Ext.ComponentQuery.query("button[action=saveAndStamp]")[0];if(d.globalInvoiceInfo.prefix){h.setValue(d.globalInvoiceInfo.prefix)}e.setValue(d.globalInvoiceInfo.number);g.setValue(d.globalInvoiceInfo.date);k.setText("Guardar")}}},})},initialize:function(b){var c=b.down("combo[name=resolutionCombo]");var a=c.getStore();if(!a.hasLoaded()){a.load()}},saveGlobalInvoice:function(j,a){var d=Ext.ComponentQuery.query("globalInvoice_FormAddGlobalInvoice")[0];j.disable();if(d.type==="edit"){GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("globalInvoice")})}else{GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("globalInvoice")})}var b=Ext.ComponentQuery.query("globalInvoice_SaleTicketGrid")[0];var k=b.getStore();var g=k.checkedRecords;var h=[];Ext.each(g,function(m){h.push(m.get("idLocal"))});var f=d.down("textfield[name=prefix]");var e=d.down("textfield[name=number]");var l={saleTickets:""};l.saleTickets=Ext.encode(h);l.resolution=d.getValues().resolutionCombo;l.date=d.getValues().date;if(f&&e){l.prefix=f.getValue();l.number=e.getValue()}var c="/global-invoice/add/format/json";if(d.type==="edit"){c="/global-invoice/edit/format/json";var f=d.down("textfield[name=prefixEdit]");var e=d.down("textfield[name=numberEdit]");l.idLocal=d.globalInvoiceInfo.idLocal;l.prefix=f.getValue();l.number=e.getValue()}else{if(d.mxReplace===true){l.invoiceToReplace=d.invoiceToReplace}}l.stamp=a;Ext.Ajax.request({url:c,method:"POST",params:l,timeout:120000,success:function(m,n){var o=Ext.decode(m.responseText);if(o.idLocal){window.location="/global-invoice/view/id/"+o.idLocal}else{j.enable();GlobalRedirector.close()}},failure:function(){GlobalRedirector.close()}})},loadSaleTicketsGrid:function(e){var g=this;var d=Ext.ComponentQuery.query("globalInvoice_SaleTicketGrid")[0];var f=d;var b=d.getStore();var c=b.getProxy();if(f.type==="edit"){c.url="/invoice/retrieve-all-tickets/idLocal/"+f.idLocal+"/format/json"}else{if(f.mxReplace===true){c.url="/invoice/retrieve-all-tickets/idLocal/"+f.idLocal+"/mxReplace/true/format/json"}else{c.url="/invoice/retrieve-all-tickets/format/json"}}b.remoteSort=true;if(!b.checkedRecords){b.checkedRecords=[]}b.removeListener("load",g.checkRecordsPreviuslyChecked,g);b.addListener("load",g.checkRecordsPreviuslyChecked,g);b.load({callback:function(){gridLoaded=true}});var a=Ext.get("stampColumnHeader");a.addListener("click",g.bulkColumnChange,g)},checkRecordsPreviuslyChecked:function(c,b){for(var d in b){var a=b[d].getData();if(a.idGlobalInvoice!==null){b[d].set("previouslyChecked",true);this.checkColumnChange(null,d,true);b[d].set("Checked",true)}}},checkColumnChange:function(a,b,k){var l=Ext.ComponentQuery.query("globalInvoice_SaleTicketGrid")[0].getStore();var e=l.getAt(b);var h=l.getCount();var j={idLocal:e.get("idLocal"),};var d=Ext.ComponentQuery.query("button[action=saveAndStamp]")[0];if(k){l.checkedRecords.push(e);var g=l.checkedRecords.length;d.enable();if(g==h){var f=document.getElementById("headerCheckbox");f.innerHTML='<img class="" src="https://cdn1.getsoft.app/images/checked.gif" style="cursor: default;">'}}else{for(var c in l.checkedRecords){if(l.checkedRecords[c].get("idLocal")===j.idLocal){l.checkedRecords.splice(c,1);break}}var f=document.getElementById("headerCheckbox");f.innerHTML='<img class="" src="https://cdn1.getsoft.app/images/unchecked.gif" style="cursor: default;">';if(l.checkedRecords.length==0){d.disable()}}},bulkColumnChange:function(){var m=Ext.ComponentQuery.query("globalInvoice_SaleTicketGrid")[0].getStore();var k=m.getCount();var f=m.checkedRecords.length;var g=document.getElementById("headerCheckbox");var l;if(f==k){l=false;g.innerHTML='<img class="" src="https://cdn1.getsoft.app/images/unchecked.gif" style="cursor: default;">'}else{l=true;g.innerHTML='<img class="" src="https://cdn1.getsoft.app/images/checked.gif" style="cursor: default;">'}for(var c=0;c<k;c++){var b=c;var e=m.getAt(b);var h={idLocal:e.get("idLocal"),};var d=Ext.ComponentQuery.query("button[action=saveAndStamp]")[0];if(l){var o=false;for(var a in m.checkedRecords){if(m.checkedRecords[a].get("idLocal")===h.idLocal){o=true;break}}if(!o){m.checkedRecords.push(e);d.enable()}}else{for(var n in m.checkedRecords){if(m.checkedRecords[n].get("idLocal")===h.idLocal){m.checkedRecords.splice(n,1);break}}if(m.checkedRecords.length==0){d.disable()}}}},stampGlobalInvoice:function(a,b){var c=a.getAttribute("data-idLocal");b.preventDefault();GlobalRedirector.go({zoneTitle:"Timbrando "+translate("globalInvoice")});Ext.Ajax.request({url:"/global-invoice/stamp/format/json/id/"+c,success:function(d){var e=Ext.decode(d.responseText);if(e.success){window.location.reload()}else{GlobalRedirector.close();if(e.cause){GlobalMsg.showNotification({title:"Error",text:e.cause,type:"error"})}else{GlobalMsg.showNotification({title:"Error",text:translate("theGlobalInvoice")+" no se pudo "+translate("stamp"),type:"error"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:translate("theGlobalInvoice")+" no se pudo "+translate("stamp"),type:"error"})}})},});Ext.define("AL.view.invoice.FormAddRetention",{extend:"AL.view.common.AddRetention",alias:"widget.invoice_FormAddRetention"});Ext.define("AL.view.invoice.FormAddAutoRetention",{extend:"AL.view.common.AddRetention",alias:"widget.invoice_FormAddAutoRetention",border:false,style:"border-bottom: 1px solid #d0d0d0",bodyStyle:" padding-top:10px; border-bottom:1px solid #d0d0d0",bodyPadding:"16px 5px 10px 10px",width:350,defaults:{blankText:"Este campo es obligatorio",msgTarget:"side",labelAlign:"right",labelPad:10},defaultType:"textfield",items:[{xtype:"combo",fieldLabel:translate("retention",true),name:"idAutoRetention",allowBlank:false,displayField:"name",valueField:"idLocal",matchFieldWidth:false,queryMode:"local",typeAhead:true,store:"AutoRetentions",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name} - ({[Ext.util.Format.round(values.retention, 1)]}%)</div></tpl>',width:250},emptyText:"Seleccionar...",editable:false,listeners:{render:function(b){var a=b.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load()}}}},{fieldLabel:"Valor",name:"amount",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),allowBlank:false},{xtype:"button",action:"deleteRetention",height:16,width:16,style:"margin-left: 40px; float: right; position: absolute; right: 26px; top:30px",baseCls:"none",handler:function(a){var b=a.up("form");b.destroy()}}]});Ext.define("AL.view.invoice.FormAddRetentionSuggested",{extend:"AL.view.common.AddRetention",alias:"widget.invoice_FormAddRetentionSuggested"});Ext.define("AL.view.invoice.FormCloseInvoice",{extend:"AL.view.common.SmileWindow",alias:"widget.invoice_FormCloseInvoice",layout:"fit",style:"background: transparent",bodyStyle:"background: transparent",autoShow:true,border:false,modal:true,title:"",items:[{frame:true,xtype:"form",name:"formCloseInvoice",bodyStyle:"padding:15px; background: transparent",style:"background-color: transparent; border: none;",width:700,defaults:{labelAlign:"right",labelPad:15,labelWidth:240,msgTarget:"side"},items:[{xtype:"box",cls:"modal-subtitle",html:"<div>"+translate("closeInvoicesWithOutstandingBalances",true)+". <br>"+translate("chooseTheF",true)+" "+translate("category")+" "+translate("toWhichYouWantToTakeTheBalance")+".</div>"},{xtype:"datefield",fieldLabel:translate("date",true),style:"text-align: left;",name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",width:550,blankText:translate("itIsNecessaryToDefineTheDateOnWhichYouWantToClose",true)+" "+translate("theInvoice")+" "+translate("invoice"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}"},{xtype:"combo",fieldLabel:translate("category",true)+" "+translate("thatAssumesTheBalance"),style:"text-align: left;",allowBlank:false,store:"",id:"options_FormCloseInvoice",name:"idOptions",width:550,valueField:"idLocal",emptyText:translate("chooseTheF",true)+" "+translate("category")+" "+translate("thatAssumesTheBalance"),forceSelection:true,editable:false},{xtype:"box",name:"help-category",cls:"sublabel",html:'<div style="width: 229px; display: inline-block; margin-right: 27px;"></div><div style="width: 60%; display: inline-block; margin-bottom: 20px;">'+translate("theInvoiceIsClosedWithoutPaymentAndAnExpenseIsGenerated",true)+"</div>"},{xtype:"groupingcombobox",fieldLabel:translate("otherCategories",true)+" "+translate("categories")+' <span class="req">*</span>',style:"text-align: left;",store:"CategoriesCombo",id:"category_FormCloseInvoice",name:"idCategory",width:550,groupField:["parentName"],valueField:"idLocal",displayField:"text",disabledField:"blocked",disabledValue:"yes",hidden:true,emptyText:translate("selectAnotherF",true)+" "+translate("category")+" "+translate("toWhichYouWantToTakeTheBalance")},{xtype:"textarea",fieldLabel:translate("observations",true),style:"text-align: left;",width:550,name:"observations",allowBlank:true,}],buttons:[{text:translate("cancelAction",true),action:"close",margin:"10 10 0 0",height:40,cls:"button ",hidden:true,},{text:translate("save",true),formBind:true,action:"save",margin:"10 10 0 0",height:40,cls:"button main-button",hidden:true}]}],footer:{items:[{text:translate("cancelAction",true),cls:"button",handler:function(a){var c=a.up("window");var b=c.down("button[action=close]");if(b){b.fireEvent("click",b)}}},{text:translate("save",true),cls:"button main-button",handler:function(a){var c=a.up("window");var b=c.down("button[action=save]");if(b){b.fireEvent("click",b)}},listeners:{afterrender:function(a){var c=a.up("window");var b=c.down("form");a.setDisabled(b.hasInvalidField());b.on("validitychange",function(e,d){a.setDisabled(!d)})}}}]},initComponent:function(){this.title=translate("close",true)+" "+translate("invoice")+" "+translate("withOutstandingBalance");this.callParent(arguments)}});Ext.define("AL.view.invoice.AddVoidCause",{extend:"AL.view.common.AddVoidCause",alias:"widget.invoice_AddVoidCause"});Ext.define("AL.view.ux.smile.floating.DropdownList",{extend:"AL.view.ux.smile.floating.Container",xtype:"dropdownlist",smOptions:[],smIgnoreHide:false,smStore:null,smDisplayField:"text",smValueField:"",smSelectFirstByDefault:true,smOnChange:null,smOnSelect:null,smWindowOnClickEvent:null,smForcedMain:false,initComponent:function(){var a=this;this.callParent(arguments);this.smHide();this.smElement.el.dom.className="smile-floating-dropdown-container";this.smWindowOnClickEvent=function(b){if(!a.smIgnoringHiding()){a.smHide()}a.smSetIgnoreHide(false)};window.addEventListener("click",this.smWindowOnClickEvent,false);this.smSetStore(this.smStore);this.smUpdate()},afterRender:function(){this.callParent(arguments)},smGetOptions:function(){return this.smOptions},smGetIgnoreHide:function(){return this.smIgnoreHide},smSetIgnoreHide:function(a){this.smIgnoreHide=a},smGetStore:function(){return this.smStore},smSetStore:function(a){var b=this;if(typeof a=="object"||a===null){this.smStore=a}else{this.smStore=Ext.getStore(a)}if(this.smStore){this.smStore.on("load",function(){b.smSyncWithStore()})}},smGetDisplayField:function(){return this.smDisplayField},smSetDisplayField:function(a){this.smDisplayField=a},smGetValueField:function(){return this.smValueField},smSetValueField:function(a){this.smValueField=a},smGetSelectFirstByDefault:function(){return this.smSelectFirstByDefault},smIgnoringHiding:function(){return this.smIgnoreHide},smShow:function(){this.smSetIgnoreHide(true);this.callParent(arguments)},smGetSelectedOption:function(){var c=this.smOptions.length;var a,b;for(a=0;a<c;a++){b=this.smOptions[a];if(b.selected){return b}}return null},smGetSelectedOptionProperty:function(b){var a=this.smGetSelectedOption();if(a){return a[b]}return null},smGetText:function(){return this.smGetSelectedOptionProperty("text")},smGetValue:function(){return this.smGetSelectedOptionProperty("value")},smSelectIndex:function(c){var f=this.smOptions.length;var e=this.smElement.el.dom.children[0];var d,b;for(d=0;d<f;d++){b=e.children[d].children[0];if(d==c){this.smOptions[d].selected=true;b.className="active"}else{this.smOptions[d].selected=false;b.className=""}}},smSetValue:function(f){var a=this.smGetValue();var e=this.smOptions.length;var d=false;var b,c;for(b=0;b<e;b++){c=this.smOptions[b];if(c.value==f){this.smSelectIndex(b);d=true;break}}if(!d){this.smSelectIndex(-1)}if(typeof this["smOnChange"]=="function"){if(f!=a){if(d){this.smOnChange(this,c.text,c.value,b)}else{this.smOnChange(this,null,null,-1)}}}},smGetSelectedRecord:function(){var b=this;var a=false;this.smStore.each(function(c){if(c.get(b.smValueField)==b.smGetValue()){a=c;return false}});return a},smSyncWithStore:function(){var g=this;var e=this.smGetValue();var a=0;var c=[];var d=0;var h=null;if(g.smForcedMain){var b=g.smStore.findRecord("isDefault","yes");if(b){h=b.data.idLocal}else{g.smSelectFirstByDefault=true}}g.smStore.each(function(j){var k=false;if(h!=null){if(h==j.get(g.smValueField)){k=true}}if(g.smSelectFirstByDefault){g.smSelectFirstByDefault=false;k=true;a=d}if(j.get(g.smValueField)==e){if(!k){a=d}k=true}c.push({text:j.get(g.smDisplayField),value:j.get(g.smValueField),selected:k});d++});this.smOptions=c;this.smUpdate();var f=this.smGetSelectedOption();if(!f){f={text:null,value:null}}if(f.value!=e&&typeof this["smOnChange"]=="function"){this.smOnChange(this,f.text,f.value,a)}},smUpdate:function(){var f=this;var e=document.createElement("ul");e.className="smile-floating-dropdown-list";var j=this.smOptions.length-1;var c,d,b,g,k,h;for(c=0;c<=j;c++){d=this.smOptions[c];b=g="";k=document.createElement("li");h=document.createElement("a");h.href="#";h.setAttribute("data-value",d.value);h.setAttribute("data-index",c);h.innerText=d.text;h.onclick=function(n){var a=f.smGetValue();var m=this.getAttribute("data-value");var l=this.getAttribute("data-index");n.preventDefault();n.stopPropagation();f.smSelectIndex(l);f.smHide();if(m!=a){if(typeof f.smOnChange=="function"){f.smOnChange(f,this.innerText,m,l,n)}if(typeof f.smOnSelect=="function"){f.smOnSelect(f,this.innerText,m,l,n)}}};if(c==0){b+="first "}if(c==j){b+="last "}if(d.selected){g="active "}b=b.substring(0,b.length-1);g=g.substring(0,g.length-1);if(b!=""){k.className=b}if(g!=""){h.className=g}k.appendChild(h);e.appendChild(k)}if(this.smElement.el.dom.childNodes.length==0){this.smElement.el.dom.appendChild(e)}else{this.smElement.el.dom.replaceChild(e,this.smElement.el.dom.childNodes[0])}},beforeDestroy:function(){window.removeEventListener("click",this.smWindowOnClickEvent,false);this.smWindowOnClickEvent=null;this.callParent(arguments)}});Ext.define("AL.view.common.CustomizeOptionsDropdownList",{extend:"AL.view.ux.smile.floating.Container",xtype:"customizeoptionsdropdownlist",smOptions:[],smOptionsSelected:[],smIgnoreHide:false,smStore:null,smDisplayField:"text",smValueField:"",smSelectFirstByDefault:true,smWindowOnClickEvent:null,smVisible:false,initComponent:function(){var a=this;this.callParent(arguments);this.smElement.el.dom.style="z-index:100;";this.smHide();this.smVisible=false;this.smElement.el.dom.className="smile-floating-dropdown-container";this.smWindowOnClickEvent=function(b){if(!a.smIgnoringHiding()){a.smHide();a.smVisible=false}a.smSetIgnoreHide(false)};window.addEventListener("click",this.smWindowOnClickEvent,false);this.smSetStore(this.smStore);this.smUpdate()},afterRender:function(){this.callParent(arguments)},smGetOptions:function(){return this.smOptions},smGetIgnoreHide:function(){return this.smIgnoreHide},smSetIgnoreHide:function(a){this.smIgnoreHide=a},smGetStore:function(){return this.smStore},smSetStore:function(a){var b=this;if(typeof a=="object"||a===null){this.smStore=a}else{this.smStore=Ext.getStore(a)}if(this.smStore){if(typeof a=="object"){b.smSyncWithStore(true);return}if(this.smStore.hasLoaded()){b.smSyncWithStore(false)}else{this.smStore.on("load",function(c){b.smSyncWithStore(false)})}}},smGetDisplayField:function(){return this.smDisplayField},smSetDisplayField:function(a){this.smDisplayField=a},smGetValueField:function(){return this.smValueField},smSetValueField:function(a){this.smValueField=a},smGetSelectFirstByDefault:function(){return this.smSelectFirstByDefault},smIgnoringHiding:function(){return this.smIgnoreHide},smShow:function(){this.smSetIgnoreHide(true);this.smVisible=true;this.callParent(arguments)},smGetSelectedOption:function(){var c=this.smOptions.length;var a,b;for(a=0;a<c;a++){b=this.smOptions[a];if(b.selected){return b}}return null},smGetSelectedOptionProperty:function(b){var a=this.smGetSelectedOption();if(a){return a[b]}return null},smGetText:function(){return this.smGetSelectedOptionProperty("text")},smGetValue:function(){return this.smGetSelectedOptionProperty("value")},smSelectIndex:function(c){var e=this.smOptions.length;var d=this.smElement.el.dom.children[0];var b;b=d.children[c].children[0];if(this.smOptions[c].selected){this.smOptions[c].selected=false;b.className="";if(typeof this["smOnChange"]=="function"){this.smOnChange(this,this.smOptions[c],c,false)}}else{this.smOptions[c].selected=true;b.className="active";if(typeof this["smOnChange"]=="function"){this.smOnChange(this,this.smOptions[c],c,true)}if(typeof this["smOnSelect"]=="function"){this.smOnSelect(this,this.smOptions[c],c)}}},smSetValue:function(f){var a=this.smGetValue();var e=this.smOptions.length;var d=false;var b,c;for(b=0;b<e;b++){c=this.smOptions[b];if(c.value==f){this.smSelectIndex(b);d=true;break}}if(!d){this.smSelectIndex(-1)}if(typeof this["smOnChange"]=="function"){if(f!=a){if(d){this.smOnChange(this,c.text,c.value,b)}else{this.smOnChange(this,null,null,-1)}}}},smGetSelectedRecord:function(){var b=this;var a=false;this.smStore.each(function(c){if(c.get(b.smValueField)==b.smGetValue()){a=c;return false}});return a},smSyncWithStore:function(d){var h=this;var f=this.smGetValue();var b=0;var c=[];var e=0;var a=function(j){var k=false;if(j.enable){k=true}c.push({text:j.label.text,value:j.name,selected:k});e++};if(d){h.smStore.forEach(a)}else{h.smStore.each(a)}this.smOptions=c;this.smUpdate();var g=this.smGetSelectedOption();if(!g){g={text:null,value:null}}if(g.value!=f&&typeof this["smOnChange"]=="function"){this.smOnChange(this,g.text,g.value,b)}},smUpdate:function(){var g=this;var f=document.createElement("ul");f.className="smile-floating-dropdown-list";f.style="    max-height: 184000px;     min-width: 295px;";var l=this.smOptions.length-1;var c,d,b,h,m,k,e,j;m=document.createElement("li");k=document.createElement("h1");k.innerHTML=translate("availableOptions",true);k.className="unselectable";k.onclick=function(a){a.preventDefault();a.stopPropagation()};m.className="first";m.appendChild(k);f.appendChild(m);for(c=0;c<=l;c++){d=this.smOptions[c];b=h="";m=document.createElement("li");if(d.hidden){m.style="display:none;"}k=document.createElement("a");k.setAttribute("class","container-checkbox");e=document.createElement("span");e.setAttribute("class","checkmark");k.setAttribute("data-value",d.value);k.setAttribute("data-index",c);k.innerText=d.text;j=document.createElement("input");j.type="checkbox";j.checked=false;k.onclick=function(p){var a=g.smGetValue();var o=this.getAttribute("data-value");var n=this.getAttribute("data-index");p.preventDefault();p.stopPropagation();g.smSelectIndex(n);g.smUpdate()};if(d.selected){h="active container-checkbox ";j.checked=true}b=b.substring(0,b.length-1);h=h.substring(0,h.length-1);if(b!=""){m.className=b}if(h!=""){k.className=h}k.appendChild(j);k.appendChild(e);m.appendChild(k);f.appendChild(m)}if(this.smElement.el.dom.childNodes.length==0){this.smElement.el.dom.appendChild(f)}else{this.smElement.el.dom.replaceChild(f,this.smElement.el.dom.childNodes[0]);this.smAlignWithTarget()}},beforeDestroy:function(){window.removeEventListener("click",this.smWindowOnClickEvent,false);this.smWindowOnClickEvent=null;this.callParent(arguments)},smIsEnable:function(){return this.smIsEnable},smEnable:function(){var a=Ext.get("customizeoptionsdropdownlisttrigger");if(a){a.addCls("form-add-invoice-header-number-dropdown");a.removeCls("form-add-invoice-header-number-dropdown-disable")}this.smIsEnable=true},smDisable:function(){var a=Ext.get("customizeoptionsdropdownlisttrigger");if(a){a.addCls("form-add-invoice-header-number-dropdown-disable");a.removeCls("form-add-invoice-header-number-dropdown")}this.smIsEnable=false},editStore:function(c,a,e){var d=null;for(var b=0;b<this.smOptions.length;b++){var d=this.smOptions[b];if(d.text==c){this.smOptions[b][a]=e;break}}}});Ext.define("AL.view.item.ItemToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.item_ItemToolbar",toolbarConfig:{newButtonText:"Nuevo ítem",newButtonWidth:110,newButtonAction:"addItem",searchEmptyText:"Buscar item"}});Ext.define("AL.store.Units",{extend:"Ext.data.Store",model:"AL.model.Unit",autoLoad:false,proxy:{type:"ajax",url:"/item/retrieve-units/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ProductKeys",{extend:"Ext.data.Store",model:"AL.model.ProductKey",autoLoad:false,proxy:{type:"ajax",url:"/item/retrieve-product-keys/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.store.ItemCategories",{extend:"Ext.data.Store",model:"AL.model.ItemCategory",autoLoad:false,pageSize:20,remoteSort:true,proxy:{type:"ajax",url:"/item-category/retrieve-all/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.membership.FormPaymentMethodChooser",{extend:"AL.view.common.FormAddPaymentMethod",alias:"widget.membership_FormPaymentMethodChooser",selectedPaymentMethod:null,paymentMethods:[],deviceSessionId:null,idPlan:null,months:null,classNameFieldHidden:true,classNameFieldDisabled:true,availablePaymentMethodImagesPosition:2,formItemsPosition:1,items:[{xtype:"fieldcontainer",itemId:"totalAmountContainer",padding:"5px 0px 5px auto",width:"100%",items:[{xtype:"displayfield",name:"totalAmount",fieldLabel:"Total a pagar",disabled:false,hidden:false,allowBlank:true,labelWidth:170,labelStyle:"font-weight: bold;text-align:right;padding-right:15px;",style:"margin: 20px 0px 20px auto;text-align:right;font-size:1.25em;",cls:"payment-method-chooser-form"}],hidden:false,disabled:false},{xtype:"fieldcontainer",itemId:"paymentMethodRadios",defaultType:"radiofield",padding:"5 15",width:"100%",items:[],hidden:false,disabled:false},{xtype:"button",text:"Otro método de pago",itemId:"otherPaymentMethodBtn",hidden:false,disabled:false,anchor:"40%",margin:"10"},{xtype:"box",html:'<span class="membership-choose-payment-method-blue-txt">¿Necesitas otro medio de pago?</span> Escríbenos <a href="#" id="paymentSupportLink">aquí</a> y te daremos más opciones.',hidden:false,disabled:false,margin:"5 10",cls:["membership-notes-text"]},{xtype:"hidden",name:"deviceSessionId"},{xtype:"hidden",name:"idPlan",disabled:false},{xtype:"hidden",name:"months",disabled:false}],buttons:[{xtype:"button",text:"Regresar",hidden:false,disabled:false,anchor:"30%",margin:"10 20 10 10",cls:"button-size",handler:function(){history.back()}},{text:"Pagar",action:"pay",margin:"0 30 0 0",cls:["sm-button-primary","button-size"]}],togglePaymentMethodRadios:function(a){var b=this.query("[itemId=paymentMethodRadios]")[0];if(typeof(a)==="undefined"){a=b.isHidden()}var c;if(a){c="hide"}else{c="show"}b.setDisabled(a);b[c]()}});Ext.define("AL.store.PlansCombo",{extend:"Ext.data.Store",model:"AL.model.Plan",proxy:{type:"ajax",url:"/plan/retrieve-pay-for-combo/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.controller.Membership",{extend:"Ext.app.Controller",stores:["MembershipTransactions","PlansCombo"],models:["MembershipTransaction"],views:["membership.GridMembershipTransactions","membership.FormPaymentMethodChooser","membership.FormDebitCardChooser","membership.FormEditMembership"],init:function(){this.control({membership_FormPaymentMethodChooser:{beforerender:function(e){var a=[];if(e.paymentMethods&&e.paymentMethods.length){for(var c in e.paymentMethods){var f=(e.paymentMethods[c].maskedAccountNumber)?e.paymentMethods[c].maskedAccountNumber:e.paymentMethods[c].accountNumber,b=" (Nro. "+f+")";if(e.paymentMethods[c].name){b=e.paymentMethods[c].name+b}else{b=translate(e.paymentMethods[c].accountType)+b}switch(e.paymentMethods[c].className){case"CreditCard":case"DebitCreditCard":e.paymentMethods[c].accountTypeCreditCard=e.paymentMethods[c].accountType;break;case"DebitCard":e.paymentMethods[c].accountTypeDebitCard=e.paymentMethods[c].accountType;break}var d=false;if(e.paymentMethods[c].companysDefault==="yes"){d=true;e.selectedPaymentMethod=e.paymentMethods[c]}a.push({boxLabel:b,name:"idLocal",inputValue:e.paymentMethods[c].idLocal,checked:d})}e.query("[itemId=paymentMethodRadios]")[0].add(a)}else{e.togglePaymentMethodRadios(true);e.getComponent("otherPaymentMethodBtn").hide();e.togglePaymentMethodFields(false)}if(e.deviceSessionId){e.down("hidden[name=deviceSessionId]").setValue(e.deviceSessionId)}if(e.idPlan){e.down("hidden[name=idPlan]").setValue(e.idPlan)}if(e.months){e.down("hidden[name=months]").setValue(e.months)}if(e.totalAmount){e.down("displayfield[name=totalAmount]").setValue(e.totalAmount)}},afterrender:function(b){if(b.selectedPaymentMethod){var a=b.down("radio[checked=true]");a.fireEvent("change",a)}}},"membership_FormPaymentMethodChooser [itemId=paymentMethodRadios] radiofield":{change:function(h){var b=h.up("form");if(h.getValue()){var g;for(var d in b.paymentMethods){if(b.paymentMethods[d].idLocal===h.inputValue){g=b.paymentMethods[d];break}}if(b.selectedPaymentMethod&&b.selectedPaymentMethod.className!==g.className){var c=b.getPaymentMethodFields(b.selectedPaymentMethod.className);Ext.each(c,function(l,k){l.setDisabled(true);l.hide()})}b.selectedPaymentMethod=g;if(g){var e=b.getPaymentMethodFields(g.className),f=!(typeof g.hasExpired==="undefined"||!g.hasExpired),a=f?"show":"hide";var j=["expirationDate","expirationDateYear","expirationDateMonth"];Ext.each(j,function(k){var l=b.down("[itemId="+k+"]");l.setDisabled(!f);l[a]()},this);Ext.each(e,function(l,k){if(l.name&&typeof g[l.name]!=="undefined"){if(Ext.isEmpty(g[l.name])){l.setDisabled(false);l.show()}else{l.setDisabled(true);l.hide()}}})}}}},"membership_FormPaymentMethodChooser button[itemId=otherPaymentMethodBtn]":{click:function(d){var e=d.up("form");if(e.selectedPaymentMethod){var c=e.getPaymentMethodFields(e.selectedPaymentMethod.className);var b=["expirationDate","expirationDateYear","expirationDateMonth"];Ext.each(b,function(f){var g=e.down("[itemId="+f+"]");g.setDisabled(true);g.hide()},this);Ext.each(c,function(g,f){if(g.name&&typeof e.selectedPaymentMethod[g.name]!=="undefined"){if(Ext.isEmpty(e.selectedPaymentMethod[g.name])){g.setDisabled(true);g.hide()}}})}e.togglePaymentMethodRadios(true);d.hide();e.togglePaymentMethodFields(false);var a=Ext.ComponentQuery.query("[itemId=showPaymentMethodsBtn]");if(a[0]){a[0].show()}}},"membership_FormPaymentMethodChooser combo[name=className]":{change:function(b){var a=b.up("form");a.classNameComboChange.apply(a,arguments)}},"membership_FormPaymentMethodChooser textfield[name=documentNumber]":{change:function(a,b){a.setValue(b.toUpperCase())}},"membership_FormPaymentMethodChooser button[itemId=showPaymentMethodsBtn]":{click:function(d){var e=d.up("form");e.togglePaymentMethodRadios(false);e.getComponent("otherPaymentMethodBtn").show();e.togglePaymentMethodFields(true);if(e.selectedPaymentMethod){var c=e.getPaymentMethodFields(e.selectedPaymentMethod.className),a=!(typeof e.selectedPaymentMethod.hasExpired==="undefined"||!e.selectedPaymentMethod.hasExpired),f=a?"show":"hide";var b=["expirationDate","expirationDateYear","expirationDateMonth"];Ext.each(b,function(g){var h=e.down("[itemId="+g+"]");h.setDisabled(!a);h[f]()},this);Ext.each(c,function(h,g){if(h.name&&typeof e.selectedPaymentMethod[h.name]!=="undefined"){if(Ext.isEmpty(e.selectedPaymentMethod[h.name])){h.setDisabled(false);h.show()}}})}d.hide()}},"membership_FormPaymentMethodChooser button[action=pay]":{click:function(d){d.disable();var a=d.up("form");var e=a.getForm();if(this.validateFormPaymentMethodChooser()){var c=e.getValues();if(c.expirationDateYear||c.expirationDateMonth){c.expirationDate="20"+c.expirationDateYear+"/"+c.expirationDateMonth;delete c.expirationDateYear;delete c.expirationDateMonth}if(a.includeFe===true){c.includeFe=true}var b=Ext.MessageBox.show({msg:translate("loadingAction",true),width:160,wait:true,waitConfig:{interval:200}});Ext.Ajax.request({url:"/membership/choose-payment-method/format/json",method:"POST",params:c,timeout:140000,success:function(g,h){var j=Ext.decode(g.responseText,true);if(j){if(j.success){if(j.id){var k=j.id;var f=j.monthsPayed;window.location="/membership/view-membership-transaction/id/"+k+"/monthsPayed/"+f}else{window.location="/membership/debit-payment-success"}}else{if(j.refresh){window.location.reload()}else{d.enable();b.hide()}}}else{d.enable();b.hide()}},failure:function(){}})}d.enable()}},"membership_FormDebitCardChooser button[action=payDebit]":{click:function(d){d.disable();if(this.validateDebitPaymentForm()){var e=d.up("form");var f=e.down("hidden[name=idPlan]");var b=e.down("hidden[name=months]");f.setValue(e.idPlan);b.setValue(e.months);var c=e.getValues();if(!e.submitted){var a=Ext.MessageBox.show({msg:translate("loadingAction",true),width:160,wait:true,waitConfig:{interval:200}});Ext.Ajax.request({url:"/membership/pay-debit/format/json",method:"POST",params:c,success:function(g,h){var j=Ext.decode(g.responseText,true);if(j){if(j.success){window.location="/membership/debit-payment-success"}else{d.enable()}}else{d.enable();a.hide()}},failure:function(){}})}e.submitted=true}else{d.enable();GlobalMsg.showErrorMessage("Error")}}},membership_FormEditMembership:{afterrender:function(a){Ext.Ajax.request({url:"/membership/retrieve-membership-info/format/json",method:"POST",success:function(d){var e=Ext.decode(d.responseText);a.currentMembership=e.currentMembership;a.membershipInfo=e.memberships;var f=a.down("combo[name=idPlan]");var c=a.down("numberfield[name=extraUsers]");c.setValue(e.currentMembership.totalExtraUsers);var b=f.findRecord("id",e.currentMembership.plan.id);f.select(b)},failure:function(){}})}},"membership_FormEditMembership combo[name=idPlan]":{afterrender:function(b){var a=b.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load()}},change:this.updateMembershipTotal},"membership_FormEditMembership numberfield[name=extraUsers]":{change:this.updateMembershipTotal},"membership_FormEditMembership button[action=save]":{click:function(a){var b=a.up("form");if(b.isValid){Ext.Ajax.request({url:"/membership/update-membership/format/json",params:b.getValues(),method:"POST",success:function(c){var d=Ext.decode(c.responseText);if(d.success){Ext.MessageBox.alert("Exito","Membresia actualizada")}else{Ext.MessageBox.alert("Error",d.cause)}},failure:function(){}})}}}})},validateFormPaymentMethodChooser:function(){var d=Ext.ComponentQuery.query("membership_FormPaymentMethodChooser")[0];var g=d.getForm();var c=g.findField("expirationDateMonth");var a=g.findField("expirationDateYear");var f=g.isValid();if(!c.isDisabled()&&c.isValid()){var b=new Date().getFullYear().toString().slice(2);if(a.isValid()&&a.getValue().toString()===b){var e=new Date().getMonth()+1;if(c.getValue()<e){f=false;c.markInvalid(translate("expirationDateMustBeLaterThanToday",true))}}}return f},validateDebitPaymentForm:function(){var c=Ext.ComponentQuery.query("membership_FormDebitCardChooser")[0];var a=c.down("combo[name=bankEntity]");var d=c.down("combo[name=accountType]");var b=true;try{if(!c.getForm().isValid()){b=false}else{if(!a.getSelectedRecord()){b=false;a.markInvalid("Debes seleccionar una de las entidades bancarias de la lista")}if(!d.getSelectedRecord()){b=false;d.markInvalid("Debes seleccionar un tipo de cuenta de la lista")}}}catch(f){b=false}return b},updateMembershipTotal:function(e){var b=e.up("form");var f=b.down("combo[name=idPlan]");var j=b.down("numberfield[name=extraUsers]");var a=f.getSelectedRecord();var h=0;if(a){Ext.each(b.membershipInfo.plans,function(l){if(l.id==a.data.id){h=l.price}})}var c=0;var d=j.getValue();var g=0;if(d){Ext.each(b.currentMembership.extras,function(l){if(l.name=="extraUsers"){if(g!=d){if(AL.math.add(g,l.quantity)>d){c=AL.math.add(c,AL.math.mul(AL.math.sub(d,g),l.price));g=d;return false}else{c=AL.math.add(c,AL.math.mul(l.quantity,l.price));g=AL.math.add(g,l.quantity)}}else{return false}}})}if(g<d){c=AL.math.add(c,AL.math.mul(b.membershipInfo.extras.extraUsers,AL.math.sub(d,g)))}var k=b.down("container[name=totalContainer]");k.destroy();k=[{xtype:"container",name:"totalContainer",items:[{xtype:"label",name:"planLabel",html:"<div><span>Plan: </span><span>"+Ext.util.Format.usMoney(h)+"</span></div>"},{xtype:"label",name:"planLabel",html:"<div><span>Extras: </span><span>"+Ext.util.Format.usMoney(c)+"</span></div>"},{xtype:"label",name:"planLabel",html:"<div><span>Total:</span><span>"+Ext.util.Format.usMoney(AL.math.add(h,c))+"</span></div>"}]}];b.add(k)}});Ext.define("AL.view.payment.PaymentToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.payment_PaymentToolbar",toolbarConfig:{newButtonText:"Nuevo pago",newButtonWidth:110,newButtonAction:"addPayment",searchEmptyText:"Buscar pago"}});Ext.define("AL.view.payment.FormAddRetention",{extend:"AL.view.common.AddRetention",alias:"widget.payment_FormAddRetention"});Ext.define("AL.view.paymentmethod.FormAdd",{extend:"AL.view.common.FormAddPaymentMethod",alias:"widget.paymentmethod_FormAdd",paymentMethod:null,type:"add",addAdditionalFormItems:true,items:[{xtype:"box",html:'<span class="membership-choose-payment-method-blue-txt">'+translate("needAHandPaymentMethod",true)+'</span> <a href="#" id="paymentSupportLink">'+translate("contactUs")+"</a> "+translate("andWellGiveYouMoreOptions",true)+".",hidden:false,disabled:false,margin:"5 10",cls:["membership-notes-text"]}],buttons:[{xtype:"buttons_Cancel",margin:"10 20 10 10",cls:["x-btn","button-size","btn-spacing","x-unselectable","x-box-item","x-toolbar-item","x-btn-default-small","x-noicon","x-btn-noicon","x-btn-default-small-noicon"]},{text:translate("save",true),action:"save",margin:"0 30 0 0",cls:["sm-button-primary","button-size"]}]});Ext.define("AL.controller.PaymentMethod",{extend:"Ext.app.Controller",models:["PaymentMethod"],views:["membership.FormPayDebit","paymentmethod.FormAdd","buttons.Cancel"],init:function(){this.control({paymentmethod_FormAdd:{beforerender:function(c){if(c.type&&c.type==="edit"&&c.paymentMethod){var e=c.getForm();var a=c.paymentMethod;for(var g in a){if(!a[g]){continue}switch(g){case"accountType":if(a.className==="CreditCard"||a.className==="DebitCreditCard"){e.findField("accountTypeCreditCard").select(a[g]);var b=c.down("textfield[name=accountNumber]");b.emptyText=c.paymentMethod.accountNumber}else{if(a.className==="DebitCard"){e.findField("accountTypeDebitCard").select(a[g])}}break;case"accountNumber":if(a.className==="CreditCard"||a.className==="DebitCreditCard"){break}case"className":case"description":case"documentType":case"documentNumber":case"name":case"payerName":case"payerPhone":case"bankEntity":var f=e.findField(g);if(f){f.setValue(a[g])}break}}var d=c.down("combo[name=className]");d.select(c.paymentMethod.className)}}},"paymentmethod_FormAdd combo[name=className]":{change:function(c){var b=c.up("form");if(b.type&&b.type==="edit"&&b.paymentMethod){var a=b.down("textfield[name=accountNumber]");if(b.paymentMethod.className===c.getValue()){a.emptyText=b.paymentMethod.accountNumber}else{a.emptyText=""}if(a.rendered){var d=a.getRawValue().length<1&&!a.hasFocus;if(Ext.supports.Placeholder){a.inputEl.dom.placeholder=a.emptyText}else{if(d){a.setRawValue(a.emptyText);a.valueContainsPlaceholder=true}}if(d){a.inputEl.addCls(a.emptyCls)}}}b.classNameComboChange.apply(b,arguments)}},"paymentmethod_FormAdd textfield[name=documentNumber]":{change:function(a,b){a.setValue(b.toUpperCase())}},"paymentmethod_FormAdd button[action=save]":{click:function(a){this.save(a)}},"membership_FormPayDebit button[action=edit-method]":{click:function(b){b.disable();if(this.validateDebitPaymentForm()){var c=b.up("form");var a=c.getValues();Ext.Ajax.request({url:"/payment-method/edit/format/json",method:"POST",params:a,success:function(d,e){var f=Ext.decode(d.responseText,true);if(f){if(f.success){Ext.MessageBox.alert("Éxito","Tu método de pago se ha guardado exitosamente",function(){window.location="/configuration"})}else{b.enable()}}else{b.enable()}},failure:function(){}})}else{b.enable();GlobalMsg.showErrorMessage("Error")}}}})},validateFormAdd:function(){var d=Ext.ComponentQuery.query("paymentmethod_FormAdd")[0];var g=d.getForm();var c=g.findField("expirationDateMonth");var a=g.findField("expirationDateYear");var f=g.isValid();if(!c.isDisabled()&&c.isValid()){var b=new Date().getFullYear().toString().slice(2);if(a.isValid()&&a.getValue().toString()===b){var e=new Date().getMonth()+1;if(c.getValue()<e){f=false;c.markInvalid(translate("expirationDateMustBeLaterThanToday",true))}}}return f},save:function(c){c.disable();var e=c.up("form");var g=e.type;var f=e.getForm();if(this.validateFormAdd()){var b=f.getValues();if(b.expirationDateYear||b.expirationDateMonth){b.expirationDate="20"+b.expirationDateYear+"/"+b.expirationDateMonth;delete b.expirationDateYear;delete b.expirationDateMonth}var d="/payment-method/";if(g==="edit"){d+="edit/id/"+e.paymentMethod.idLocal+"/format/json"}else{d+="add/format/json"}var a=Ext.MessageBox.show({msg:translate("loadingAction",true),width:160,wait:true,waitConfig:{interval:200}});Ext.Ajax.request({url:d,method:"POST",params:b,timeout:60000,success:function(k,l){var n=Ext.decode(k.responseText,true);if(n){if(n.success){window.location=n.redirectUrl}else{if(n.errors){var p=n.errors;for(var j in p){var m=f.findField(j);if(m){var h=[];for(var o in p[j]){h.push(p[j][o])}m.markInvalid(h.join(", "))}}}c.enable();a.hide()}}else{c.enable();a.hide()}},failure:function(){}})}else{c.enable()}},validateDebitPaymentForm:function(){var c=Ext.ComponentQuery.query("membership_FormPayDebit")[0],a=c.down("combo[name=bankEntity]"),d=c.down("combo[name=productType]");var b=true;if(!c.getForm().isValid()){b=false}else{if(!a.getSelectedRecord()){b=false;a.markInvalid("Debes seleccionar una de las entidades bancarias de la lista")}if(!d.getSelectedRecord()){b=false;d.markInvalid("Debes seleccionar un tipo de cuenta de la lista")}}return b}});Ext.define("AL.view.purchaseOrder.MoreActionsButton",{extend:"AL.view.common.MoreActionsButton",alias:"widget.purchaseOrder_MoreActionsButton",canUpload:this.canUpload,type:this.type,idType:this.idType});Ext.define("AL.view.recurringpayment.RecurringPaymentToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.recurringpayment_RecurringPaymentToolbar",toolbarConfig:{newButtonText:"Nuevo pago "+translate("recurring"),newButtonWidth:165,newButtonAction:"addRecurringPayment",searchEmptyText:"Buscar pago "+translate("recurring")}});Ext.define("AL.view.retention.RetentionToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.retention_RetentionToolbar",toolbarConfig:{newButtonText:"Nueva "+translate("retention"),newButtonWidth:130,newButtonAction:"addRetention",searchEmptyText:"Buscar "+translate("retention")}});Ext.define("AL.view.buttons.modern.Cancel",{extend:"AL.view.buttons.modern.Button",alias:"widget.buttons_modern_Cancel",type:"basic",listeners:{click:function(b,d,a){if(window.history.length>2){var c=b.up("window");if(c){c.close()}else{window.history.back()}}else{window.location="/"}}}});Ext.define("AL.view.buttons.modern.CancelSave",{extend:"Ext.container.Container",requires:["AL.view.buttons.modern.Button","AL.view.buttons.modern.Cancel"],alias:"widget.buttons_modern_CancelSave",layout:"hbox",margin:"30 0 30 0",width:670,requiredText:"",requiredTextMargin:null,items:[{xtype:"container",layout:"vbox",flex:50,items:[{xtype:"box",html:""}]},{xtype:"container",layout:{type:"hbox",pack:"end"},flex:50,items:[{xtype:"buttons_modern_Cancel",text:translate("cancelAction",true),margin:"0 17 0 0",width:100},{xtype:"buttons_modern_Button",action:"save",text:translate("save",true),formBind:true,disabled:true,width:129,type:"primary"}]}],initComponent:function(){this.items[0].items[0].html='<span style="color: #888;">'+this.requiredText+"</span>";if(this.requiredTextMargin!==null){this.items[0].items[0].margin=this.requiredTextMargin}this.callParent(arguments)}});Ext.define("AL.view.report.IncomeTree",{extend:"AL.view.common.ReportTree",alias:"widget.report_IncomeTree",title:"Ingresos",store:"TotalIncomeCategories",moneyDataIndex:"credit"});Ext.define("AL.view.report.ExpenseTree",{extend:"AL.view.common.ReportTree",alias:"widget.report_ExpenseTree",title:"Egresos",store:"TotalExpenseCategories",moneyDataIndex:"debit"});Ext.define("AL.view.report.EquityTree",{extend:"AL.view.common.ReportTree",alias:"widget.report_EquityTree",title:"Patrimonio",store:"TotalEquityCategories",moneyDataIndex:"credit"});Ext.define("AL.view.report.LiabilityTree",{extend:"AL.view.common.ReportTree",alias:"widget.report_LiabilityTree",title:"Pasivos",store:"TotalLiabilityCategories",moneyDataIndex:"credit"});Ext.define("AL.view.report.AssetTree",{extend:"AL.view.common.ReportTree",alias:"widget.report_AssetTree",title:"Activos",store:"TotalAssetCategories",moneyDataIndex:"debit"});Ext.define("AL.view.report.InventoryGrid",{extend:"Ext.grid.Panel",alias:"widget.report_InventoryGrid",title:"Reporte de inventarios",scroll:true,width:1024,border:true,frame:true,store:"InventoriesReport",columnLines:true,cls:"grid-inventory",viewConfig:{stripeRows:true,emptyText:'<style>.grid-inventory .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has creado tu primer '+translate("item")+' inventariable!</div><div class="button-wrapper"><a href="/item/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>Nuevo '+translate("item")+" de "+translate("inventory")+"</a></div></div></div>",enableTextSelection:true},requires:["AL.plugin.grid.PageSize",],initComponent:function(){this.columns=[{header:translate("item",true),dataIndex:"name",flex:1.5,renderer:this.linkItem},{header:translate("reference",true),dataIndex:"reference",flex:1},{header:translate("description",true),dataIndex:"description",flex:1.5,renderer:this.renderLongTitle},{header:translate("quantity",true),dataIndex:"warehouseQuantity",align:"center",flex:1.5,hidden:true},{header:translate("quantity",true),dataIndex:"quantity",align:"center",flex:1},{header:"Cantidad mínima",dataIndex:"minQuantity",align:"center",flex:1.3,hidden:true},{header:"Unidad",dataIndex:"unit",align:"center",renderer:this.renderUnit,flex:0.8},{header:"Estado",dataIndex:"status",align:"center",renderer:this.renderStatus,flex:0.7},{header:"Costo promedio",dataIndex:"averageCost",align:"right",renderer:this.renderCost,flex:1.3},{header:"Total",dataIndex:"inventoryTotal",align:"right",renderer:this.renderPositive,flex:1}];this.callParent(arguments);var a=null;this.getView().on("uievent",function(b,f,e,h,d,c){if(b=="mouseover"){var g=f.getHeaderAtIndex(d);if(g&&g.dataIndex=="averageCost"){if(a!=null){a.hide()}a=Ext.create("Ext.tip.ToolTip",{html:'Haz clic aquí para recibir el correo con el historial de este producto. <a href="http://ayuda.getsoft.app/hc/es/articles/115001012643" target="_blank">Ver más</a>.',dismissDelay:3500});a.show();a.setPosition(c.browserEvent.clientX+pageXOffset-150,c.browserEvent.clientY+pageYOffset+15)}}},this)},renderPositive:function(e,f,b,g,d,c,a){if(b.get("quantity")<0||b.get("averageCost")<0||b.get("inventoryTotal")<0){e=0}return Ext.util.Format.usMoney(e,2)},linkItem:function(e,f,b,g,d,c,a){return'<a href="/item/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderStatus:function(e,f,b,h,d,c,a){var g="Activo";switch(e){case"active":g="Activo";break;case"inactive":g="Inactivo";break}return g},renderUnit:function(e,h,a,c,g,f,d){if(this.country==="mexico"){return a.get("unit")}else{var j=Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:[{unitType:"",unit:"notApplicable",text:"No aplica"},{unitType:"Unidad",unit:"unit",text:"Unidad"},{unitType:"Unidad",unit:"service",text:"Servicio"},{unitType:"Unidad",unit:"piece",text:"Pieza"},{unitType:"Unidad",unit:"box",text:"Caja"},{unitType:"Unidad",unit:"sack",text:"Saco"},{unitType:"Unidad",unit:"lot",text:"Lote"},{unitType:"Unidad",unit:"set",text:"Conjunto"},{unitType:"Unidad",unit:"pair",text:"Par"},{unitType:"Unidad",unit:"kit",text:"Kit"},{unitType:"Unidad",unit:"activity",text:"Actividad"},{unitType:"Unidad",unit:"million",text:"Millon",},{unitType:"Unidad",unit:"shipping",text:"Envío",},{unitType:"Unidad",unit:"thousand",text:"Mil",},{unitType:"Unidad",unit:"thousand",text:"Millar",},{unitType:"Unidad",unit:"vehicle",text:"Vehículo",},{unitType:"Unidad",unit:"rollMetricMeasure",text:"Medida métrica de rollo",},{unitType:"Unidad",unit:"voyage",text:"Viaje",},{unitType:"Unidad",unit:"package",text:"Paquete",},{unitType:"Unidad",unit:"one",text:"Uno",},{unitType:"Unidad",unit:"bunch",text:"Manojo",},{unitType:"Unidad",unit:"element",text:"Elemento"},{unitType:"Longitud",unit:"centimeter",text:"Centímetro (cm)"},{unitType:"Longitud",unit:"meter",text:"Metro (m)"},{unitType:"Longitud",unit:"inch",text:"Pulgada"},{unitType:"Longitud",unit:"foot",text:"Pie"},{unitType:"Longitud",unit:"linealMeter",text:"Metro lineal"},{unitType:"Área",unit:"centimeterSquared",text:"Centímetro cuadrado (cm<sup>2</sup>)"},{unitType:"Área",unit:"meterSquared",text:"Metro cuadrado (m<sup>2</sup>)"},{unitType:"Área",unit:"inchSquared",text:"Pulgada cuadrada"},{unitType:"Volumen",unit:"mililiter",text:"Mililitro (mL)"},{unitType:"Volumen",unit:"liter",text:"Litro (L)"},{unitType:"Volumen",unit:"gallon",text:"Galón"},{unitType:"Volumen",unit:"cubicMeter",text:"Metro cúbico (m3)"},{unitType:"Peso",unit:"gram",text:"Gramo (g)"},{unitType:"Peso",unit:"kilogram",text:"Kilogramo (Kg)"},{unitType:"Peso",unit:"ton",text:"Tonelada"},{unitType:"Peso",unit:"pound",text:"Libra"},{unitType:"Tiempo",unit:"minute",text:"Minuto"},{unitType:"Tiempo",unit:"hour",text:"Hora"},{unitType:"Tiempo",unit:"day",text:"Día"},{unitType:"Tiempo",unit:"month",text:"Mes"}]});var b=j.findRecord("unit",a.get("unit"));return b.get("text")}},renderLongTitle:function(e,f,b,g,d,c,a){return(e)?'<span title="'+e+'">'+e+"</span>":""},renderCost:function(e,f,b,g,d,c,a){if(b.get("quantity")<0||b.get("averageCost")<0||b.get("inventoryTotal")<0){e=0}return'<a class="downloadInventoryReport">'+Ext.util.Format.usMoney(e,2)+"</a>"}});Ext.define("AL.view.report.GridTaxes",{extend:"Ext.grid.Panel",alias:"widget.report_GridTaxes",title:"",scroll:true,minHeight:250,width:1024,border:true,frame:true,columnLines:true,requires:["AL.plugin.grid.PageSize"],dockedItems:[{xtype:"pagingtoolbar"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Factura",dataIndex:"number",name:"number",align:"center",renderer:this.renderNumber,flex:1.5},{header:"Comprobante",dataIndex:"transactionNumber",name:"transactionNumber",align:"center",renderer:this.renderNumber},{header:"Concepto",dataIndex:"itemName",name:"itemName",flex:3},{header:translate("item",true)+" - Cantidad",dataIndex:"quantity",align:"center",flex:1.5},{header:translate("item",true)+" - Precio",dataIndex:"price",align:"right",renderer:this.renderMoney},{header:translate("discount",true),dataIndex:"discount",name:"discount",align:"right",renderer:this.renderMoney},{header:"Impuesto (%)",dataIndex:"tax",align:"center"},{header:"Impuesto (Valor)",dataIndex:"total",name:"total",renderer:this.renderMoney,align:"right",flex:2}];this.callParent(arguments)},renderNumber:function(e,f,b,h,d,c,a){var g=e;if(e){g='<a href="'+b.get("link")+'">'+e+"</a>"}if(!b.get("transactionNumber")&&!b.get("number")&&d===0){g='<a href="'+b.get("link")+'">Factura</a>'}return g},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.report.GridRetentions",{extend:"Ext.grid.Panel",alias:"widget.report_GridRetentions",title:"",scroll:true,minHeight:250,width:1024,border:true,frame:true,columnLines:true,requires:["AL.plugin.grid.PageSize"],dockedItems:[{xtype:"pagingtoolbar"}],plugins:[{ptype:"grid_PageSize"}],initComponent:function(){var e=this.configs&&this.configs.allowBase&&this.configs.allowBase===true;var c=[];c.push({header:"Factura",dataIndex:"billNumber",name:"number",align:"center",renderer:this.renderNumber,sortable:false,flex:1.5});c.push({header:"Comprobante",dataIndex:"transactionNumber",name:"transactionNumber",align:"center",renderer:this.renderNumber,sortable:false});if(e){c.push({header:"Tercero",dataIndex:"client",flex:3,sortable:false});c.push({header:"Total del comprobante",dataIndex:"total",align:"right",flex:1.3,renderer:this.renderMoney,sortable:false});c.push({header:"Base",dataIndex:"base",align:"center",sortable:false,flex:1.3,renderer:this.renderMoney});c.push({header:"Valor retenido",dataIndex:"retentionAmount",renderer:this.renderMoney,align:"right",flex:1.3,sortable:false})}else{c.push({header:"Beneficiario",dataIndex:"client",flex:3,sortable:false});c.push({header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,sortable:false});c.push({header:translate("retention",true)+" (%)",dataIndex:"percentage",align:"center",sortable:false,renderer:this.renderPercentage});c.push({header:translate("retention",true)+" (Valor)",dataIndex:"retentionAmount",renderer:this.renderMoney,align:"right",flex:2,sortable:false})}if(AL.config.currentKeyCountry==="argentina"){for(var b=0;b<c.length;b++){var d=c[b];switch(d.dataIndex){case"billNumber":d.header="Comprobante";break;case"client":d.header="Tercero";d.flex=2;break;case"total":d.header="Total comprobante";d.flex=1.5;break;case"retentionAmount":d.header="Importe retenido";break}}c.splice(1,1,{header:"Cobranza",dataIndex:"supportDocumentNumber",name:"supportDocumentNumber",align:"center",sortable:false,renderer:this.renderSupportDocumentNumber,flex:1.5});var a=c[0];c[0]=c[1];c[1]=a;c.splice(3,0,{header:"Certificado Nº",dataIndex:"certificateNumber",name:"certificateNumber",align:"center",sortable:false,flex:2})}this.columns=c;this.callParent(arguments)},renderNumber:function(e,f,b,h,d,c,a){var g=e;if(e){g='<a href="'+b.get("link")+'">'+e+"</a>"}if(!b.get("transactionNumber")&&!b.get("billNumber")&&d===0){g='<a href="'+b.get("link")+'">Factura</a>'}return g},renderSupportDocumentNumber:function(b,c,a){var d=b;if(d){d='<a href="'+a.get("linkToSupportDocument")+'">'+d+"</a>"}return d},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))},renderPercentage:function(e,f,b,g,d,c,a){if(b.get("calculatedBy")!="percentage"&&!this.columns[d].hidden){this.columns[d].hide()}if(e){return AL.math.approx(e,null,4)}}});Ext.define("AL.store.SellerSales",{extend:"Ext.data.Store",model:"AL.model.SellerSales",autoLoad:false,remoteSort:true,sorters:[{property:"name",direction:"ASC"}],proxy:{type:"ajax",url:"/report/retrieve-sales-by-seller/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.remission.FormAddRemission",{extend:"Ext.form.Panel",alias:"widget.remission_FormAddRemission",requires:["AL.view.ux.fields.Numeration","AL.view.ux.form.Switch","AL.view.common.SmileNumeration"],style:"margin-bottom: 10px;",title:"",style:"margin-bottom: 10px; padding-left: 30px; padding-right: 30px;",anchor:100,layout:{type:"vbox",align:"stretch"},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",flex:1,padding:"0 0 27 0",style:"border-bottom: 1px rgba(151, 151, 151, 0.2) solid",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:33,layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",name:"logoBox",configs:{maxWidth:300,maxHeight:86},html:'<div class="form-add-invoice-image-zone" onselectstart="return false;"><div style="font-size: 24px; font-weight: bold; padding-top: 23px;">'+translate("useMyLogo",true)+'</div><div style="font-size: 12px;">178 x 51 '+translate("pixels")+"</div></div>"}]},{xtype:"container",flex:33,id:"companyInfoInvoice",layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",id:"labelInvoiceCompanyName",name:"companyName",style:"padding-top: 10px; padding-bottom: 2px; font-family: Roboto; font-size: 20px; font-weight: bold; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyIdentification",name:"companyIdentification",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyEmail",name:"companyEmail",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"companyEditInvoice",name:"companyEdit",style:"height: 16px; font-family: Roboto; text-align: center; line-height: normal; word-wrap: break-word; margin-top: 5px; cursor: pointer;",html:'<svg class="icon small" id="editIcon" style="color: #00B19D; display: none;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use></svg><a href="#" id="editHref" style="color: #00B19D; display: none;">'+translate("edit",true)+"</a>",text:""},],listeners:{el:{mouseover:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","inline-block");a.setStyle("display","inline-block")},mouseout:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","none");a.setStyle("display","none")}}}},{xtype:"container",flex:33,layout:{type:"hbox",align:"stretch"},items:[{xtype:"smilenumeration",name:"numerationComponent",documentType:"remission",configs:{documentType:"remission",parent:"remission_FormAddRemission"},flex:33},]}]},{xtype:"container",style:"margin-top:  25px",layout:{type:"hbox",},items:[{xtype:"container",defaults:{labelAlign:"right",labelPad:15,width:600,labelWidth:110},flex:1,items:[{xtype:"container",id:"containerLeft",flex:1.5,items:[{xtype:"combo",name:"documentName",fieldLabel:translate("documentType",true),displayField:"label",valueField:"value",editable:false,labelAlign:"right",value:"remission",width:400,queryMode:"local",tooltip:translate("chooseTheNameYouWantToGiveToYourDocuments",true),labelPad:5,labelWidth:132,labelStyle:"font-size: 13px; padding-right: 9px;",store:Ext.create("Ext.data.Store",{fields:["label","value"],data:[{label:translate("remission",true),value:"remission",selected:true},{label:translate("serviceOrder",true),value:"serviceOrder"}]}),allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"combo",fieldLabel:translate("clientA",true),name:"idClient",triggerAction:"all",allowBlank:false,store:"Clients",width:400,emptyText:translate("search",true),displayField:"name",valueField:"idLocal",id:"remissionClientCombo",minChars:0,labelAlign:"right",blankText:translate("itIsNecessaryToAssignAClientTo",true)+" "+translate("theRemission")+" "+translate("remission")+".",msgTarget:"side",style:"margin-bottom:5px",labelPad:15,labelWidth:123,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"box",width:170,style:"margin-left: 10px;",html:'<a href="#" title="'+translate("registerHereNewContactToAssociateWith2",true)+" "+translate("asClient")+'" data-tooltip-title="Crear nuevo cliente" class="addAnother" id="createOtherContact">'+translate("newContact",true)+"</a>"}]},{xtype:"textfield",fieldLabel:translate("identification",true),name:"clientIdentification",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},{xtype:"textfield",fieldLabel:translate("phone",true),name:"clientPhone",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},]},]},{xtype:"container",flex:0.7,defaults:{labelAlign:"right",labelPad:15,width:350,labelWidth:150,msgTarget:"side",},items:[{xtype:"datefield",fieldLabel:translate("creation",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:"Es necesario definir la fecha de emisión "+translate("ofTheRemission")+" "+translate("remission"),invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",id:"remissionDateDatefield"},{xtype:"combo",id:"remissionTermCombo",fieldLabel:translate("deadline",true),name:"days",allowBlank:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 5px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -274px; top: -52px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 260px;"><div class="text">'+translate("selectThePaymentDueDateYouCanAdd",true)+'<a href="/term" target="_blank">'+translate("here")+"</a>.</div></div></div></div>",store:"Terms",displayField:"name",valueField:"idLocal",queryMode:"local",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewTerm" class="createNewTerm">'+translate("newTerm")+"</a></div>"},hidden:true},{xtype:"datefield",id:"remissionDueDateDateField",fieldLabel:translate("due",true),name:"dueDate",allowBlank:false,value:Ext.Date.add(new Date(),Ext.Date.DAY,30),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineADateWhen",true)+" "+translate("theRemission",true)+" "+translate("remission")+" "+translate("expiresItself"),invalidText:"{0} "+translate("itIsNotAValidDateItMust")+" {1}"},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("remission"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:350},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:"Seleccionar",allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"combo",fieldLabel:"Concepto",name:"saleConcept",tooltip:"Indica el concepto de "+translate("theRemission")+" "+translate("remission"),emptyText:"Seleccionar",allowBlank:true,hidden:true,store:"SalesConcepts",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["argentina"],isRequiredForElectronicInvoicing:["argentina"],},{xtype:"datefield",fieldLabel:"Fecha inicio de servicio",name:"startDateService",tooltip:"Indica la fecha en la que se inició la prestación del servicio",allowBlank:true,format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true},{xtype:"datefield",fieldLabel:"Fecha fin de servicio",name:"endDateService",tooltip:"Indica la fecha en la que se terminó la prestación del servicio",allowBlank:true,format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true},]}]},{xtype:"container",flex:1,name:"advancedOptionsContainer",allowBlank:true,msgTarget:"side",labelAlign:"right",labelPad:15,items:[{xtype:"label",html:'<span id="advancedOptionsLink" href="#">'+translate("moreOptions",true)+"</span>"},{xtype:"remission_FormAdvancedOptions",hidden:true}]}],getFieldValuesAsMetadata:function(){var c=null;var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"argentina":var a=this.down("combo[name=saleConcept]"),d=this.down("datefield[name=startDateService]"),e=this.down("datefield[name=endDateService]");c={saleConcept:a.getValue(),startDateService:Ext.Date.format(d.getValue(),"Y-m-d"),endDateService:Ext.Date.format(e.getValue(),"Y-m-d"),};break}return c},setFieldValuesFromMetadata:function(d){var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"argentina":if(typeof d.saleConcept!=="undefined"){var a=this.down("combo[name=saleConcept]");var c=a.getStore();if(c.hasLoaded()){a.setValue(d.saleConcept)}else{c.on("load",function(g){a.setValue(d.saleConcept)})}}if(typeof d.startDateService!=="undefined"&&d.startDateService!=""){var e=this.down("datefield[name=startDateService]");e.setValue(d.startDateService)}if(typeof d.endDateService!=="undefined"&&d.startDateService!=""){var f=this.down("datefield[name=endDateService]");f.setValue(d.endDateService)}break}}});Ext.define("AL.view.remission.MoreActionsButton",{extend:"AL.view.common.MoreActionsButton",alias:"widget.remission_MoreActionsButton",height:38,cls:"sm-button-basic filling button2",canUpload:this.canUpload,type:this.type,idType:this.idType});Ext.define("AL.view.tax.TaxToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.tax_TaxToolbar",toolbarConfig:{newButtonText:translate("newTax",true),newButtonWidth:140,newButtonAction:"addTax",searchEmptyText:translate("searchTax",true)}});Ext.define("AL.view.term.TermToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.term_TermToolbar",toolbarConfig:{newButtonText:"Nuevo Término",newButtonWidth:140,newButtonAction:"addTerm",searchEmptyText:"Buscar término"}});Ext.define("AL.controller.Term",{extend:"Ext.app.Controller",views:["term.FormAdd","term.GridAll","term.TermToolbar"],stores:["Terms"],models:["Term"],init:function(){this.application.addListener("deleteTerm",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("term")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("thisM")+" "+translate("term")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/term/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{Ext.MessageBox.alert("Error",h.cause)}},failure:function(){}})}}})},this);this.control({term_FormAdd:{render:this.initialize},"buttons_SubmitReset button[action=saveTerm]":{click:this.saveTerm},"term_TermToolbar button[action=addTerm]":{click:function(){window.location="/term/add"}},"term_GridAllTerms gridcolumn[type=termActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteTerm")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteTerm",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar términso que ya están asociados a clientes")}}}},term_GridAllTerms:{render:function(c){var a=c.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes"};a.load()}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick}})},saveTerm:function(c){c.disable();GlobalRedirector.go({zoneTitle:translate("savingTerm",true)});var d=Ext.ComponentQuery.query("term_FormAdd")[0];if(!d.getForm().isValid()){GlobalRedirector.close();GlobalMsg.showNotification({tpl:"formInvalidFields"});c.enable()}else{var a=d.getValues();var b="/term/add/format/json";if(d.type&&d.type==="edit"){b="/term/edit/format/json";a.id=d.idLocal}Ext.Ajax.request({url:b,method:"POST",params:a,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var k=j.results;if(d.callback){var f=d.getValues();var e=Ext.create("AL.model.Term",f);e.set("idLocal",k);d.callback(e)}else{window.location="/term"}if(d.emergent){GlobalRedirector.close()}}else{c.enable();GlobalRedirector.close();if(d.emergent){Ext.MessageBox.alert("Error",j.cause)}else{GlobalMsg.showErrorMessage("Error",j.cause)}}},failure:function(){GlobalRedirector.close()}})}},initialize:function(a){if(a.type&&a.type==="edit"){var b=a.idLocal;Ext.Ajax.request({url:"/term/retrieve-one/id/"+b+"/format/json",success:function(d,f){var h=Ext.decode(d.responseText);if(h.success){var e=h.results;var c=a.down("textfield[name=name]");var g=a.down("textfield[name=days]");c.setValue(e.name);g.setValue(e.days)}else{GlobalMsg.showErrorMessage("Error",h.cause)}},failure:function(){}})}},listClick:function(f,h){var g=f.up("combo");var a=this.application;var d=Ext.ComponentQuery.query("client_FormAdd")[0];var b="";if(d){b="Client"}if(!d){d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!d){return}if(d.configs&&d.configs.type){delete d.configs.type}if(h.target.getAttribute("data-action")=="quickNewTerm"){h.preventDefault();if(d.emergent){window.open("/term/add","_blank");return}var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-term-modal",reason:"addNewTerm",border:false,resizable:false,title:translate("addNewPaymentTerm",true),width:520,bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative;",id:"createNewTerm",items:[{xtype:"container",id:"addTerm",items:[{xtype:"term_FormAdd",style:"margin-bottom: 0px;",title:"",bodyPadding:"0 30 0 0",configs:d.configs,country:d.configs.country,emergent:true,callback:function(e){c.close();a.fireEvent("termCreated"+b,{record:e,initiator:g})}}]},]}],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){c.close()}},{text:translate("save",true),cls:"button main-button",handler:function(e){var k=e.up("window");var j=k.down("button[action=save]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(e){var k=e.up("window");var j=k.down("form");e.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){e.setDisabled(!l)})}}}]},listeners:{afterrender:function(j){var e=j.down("button[action=save]");var k=j.down("buttons_Cancel");if(e){e.hide()}if(k){k.hide()}}}})}}});Ext.define("AL.view.transaction.FormAddInvoice",{extend:"Ext.form.Panel",alias:"widget.transaction_FormAddInvoice",requires:["AL.view.transaction.FormAddRetention","AL.view.retention.PanelForApplyRetentions"],invoice:null,retentionsSuggested:[],hasRetentions:false,retentionsAreEditable:false,canCreateNewRetention:"no",isAddManual:false,setInvoice:function(a){this.invoice=a;this.retentionsSuggested=a.retentionsSuggested?a.retentionsSuggested:[];this.hasRetentions=a.hasRetentions?a.hasRetentions:false;this.retentionsAreEditable=a.retentionsAreEditable?a.retentionsAreEditable:false;this.renderRetentionFields()},updateButtonAdvancesApplied:function(b){var c=this.down("button[name=applyAdvances]");var e=c.up("form");var a="apply-advances-button";var d="check-apply-advances-button";if(b){d=a;a="check-apply-advances-button"}c.removeCls(a);c.addCls(a)},renderRetentionFields:function(){var d=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(d.configs&&d.configs.country=="argentina"){var g=this.down("container[name=retentionPanel]");g.hide();if(this.invoice.retentionsSupported&&d.edit==true&&this.invoice.amount){var e=[];for(var c=0;c<this.invoice.retentionsSupported.length;c++){var f=this.invoice.retentionsSupported[c];if(f.supportDocument&&f.supportDocument.idLocal==d.id){e.push(f)}}var j=this.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");j.setRetentionsForShowOnPanel(e)}return}var a=this.down("button[action=apply-retentions-suggested]");var b=this.down("button[action=view-retentions-applied-to-invoice]");var h=this.down("button[name=addRetention]");if(this.retentionsSuggested.length>0&&!this.hasRetentions){b.hide();a.show()}else{a.hide();if(!this.hasRetentions||!this.retentionsAreEditable){b.hide()}else{if(d&&d.configs&&d.configs.country==="republicaDominicana"){if(this.invoice.retentionsSupported&&this.invoice.retentionsSupported.length>0){b.show()}else{b.hide()}}else{b.show()}}}if(d&&d.configs&&d.configs.country==="republicaDominicana"&&this.invoice.retentions&&this.invoice.retentions.length>0){h.hide()}else{if(!this.retentionsAreEditable){h.hide()}else{h.show()}}if(d&&d.configs&&d.configs.country==="republicaDominicana"){if(this.invoice.retentionsSupported&&this.invoice.retentionsSupported.length>0){b.show()}else{b.hide()}}else{if(!this.retentionsAreEditable){b.hide()}}},border:false,style:"border-bottom: 1px solid #eee; padding-top: 5px;",bodyPadding:5,anchor:100,layout:"hbox",defaults:{anchor:"100%",msgTarget:"side"},defaultType:"textfield",initComponent:function(){var e=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var a=[{xtype:"hidden",name:"number"},{xtype:"hidden",name:"invoiceIdLocal"}];var c={};if(this.isAddManual){c={xtype:"combo",name:"number",triggerAction:"all",allowBlank:false,emptyText:"Buscar "+translate("invoice",true)+"...",store:"",displayField:"invoiceNumber",valueField:"idLocal",queryMode:"local",width:130,style:"margin-right: 10px",matchFieldWidth:false,blankText:"Es necesario seleccionar "+translate("theInvoice")+" "+translate("invoice")+" que se va asociar",listConfig:{width:200,height:200},editable:true,listeners:{afterrender:function(g){var f=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(f&&f.configs.country==="costaRica"){g.blankText="Es necesario seleccionar un comprobante"}}}}}else{c={xtype:"displayfield",name:"invoiceNumber",width:130,style:"margin-left: 10px",renderer:function(g,h){var f=h.up("form");var k=g;var j="";if(e.configs.country=="costaRica"){k=AL.format.ellipsis(k,16,5);j='data-qtip="'+g+'"'}return'<a class="transaction-invoice-link" '+j+' target="_blank" href="/invoice/view/id/'+f.idInvoice+'">'+k+"</a>"}}}a.push(c);var b=[{xtype:"displayfield",name:"total",width:100},{xtype:"displayfield",name:"totalPayed",fieldStyle:"color: #64A574;",width:100},{xtype:"displayfield",name:"missingAmount",fieldStyle:"color: #B83F3F",width:100},{xtype:"container",title:translate("retentions",true),name:"retentionPanel",items:[{xtype:"container",width:350,items:[]},{xtype:"button",baseCls:"none-add-retention-button",name:"addRetention",height:18,text:translate("add",true)+" "+translate("retention"),style:"float: left; margin-left: 10px;",hidden:this.isAddManual?true:false,listeners:{click:function(k){var g=k.up("container");var h=g.down("container");var m=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var n=k.up("transaction_FormAddInvoice");var j={type:"invoice",canCreateNewRetention:m.configs.canCreateNewRetention,};if(m.configs.country=="colombia"){j.allowBase=true}var f=Ext.create("AL.view.transaction.FormAddRetention",j);if(j.allowBase&&j.allowBase===true){var l=f.down("[name=base]");l.setValue(AL.math.approx(n.invoiceSubTotal,null,n.invoiceDecimalPrecision))}h.add(f)}}},{xtype:"button",baseCls:"no-style",action:"apply-retentions-suggested",height:18,text:"Aplicar "+translate("retentions")+" sugeridas",style:"float: left; margin-left: 10px;",hidden:this.isAddManual?true:false,listeners:{click:function(h){var j=h.up("transaction_FormAddInvoice");var l=j.retentionsSuggested;var f=h.up("container");var g=f.down("container");var k=false;Ext.each(l,function(s){if(s.status==="inactive"){k=true}var p=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var r={type:"invoice"};if(p.configs.country==="colombia"){r.allowBase=true}var n=Ext.create("AL.view.transaction.FormAddRetention",r);if(r.allowBase&&r.allowBase===true&&s.calculatedBy=="percentage"){var v=n.down("[name=base]");var m=AL.math.approx(AL.math.div(AL.math.mul(s.amount,100),s.percentage),null,p.decimalPrecision);v.setValue(m)}var o=n.down("combo");var q=n.down("textfield[name=amount]");var u=o.getStore();var t=function(){if(s.status!=="inactive"){o.select(s.idRetention);q.setValue(s.amount)}};if(u.hasLoaded()){t()}else{u.on("load",t)}g.add(n)});if(k){GlobalMsg.showNotification({title:"Advertencia",type:"warning",text:"Algunas "+translate("retentions")+" sugeridas se encuentran inactivas, actívalas si deseas aplicarlas"})}h.hide()}}},{xtype:"button",name:"viewRetentionsApplied",action:"view-retentions-applied-to-invoice",baseCls:"no-style",height:18,text:"Ver "+translate("retentions")+" aplicadas",style:"float: left; margin-left: 10px;",hidden:this.isAddManual?true:false,listeners:{click:function(f){var g=f.up("transaction_FormAddInvoice");var h=g.invoice;window.open("/invoice/edit-retentions/id/"+h.idLocal)}}}]},{xtype:"panelForApplyRetentionsComponent",name:"panelForApplyRetentions",width:353,countries:["argentina"],hidden:true,border:false,configs:{formWithConfigs:{alias:"transaction_FormTransaction"},callbackForUpdateTotal:function(f,g){var l=g.up("form");var j=l.invoice;var n=l.down(" > textfield[name=amount]");if(n.calculateFromRetentions){var h=0;Ext.each(f,function(p){var o=AL.math.approx(p.amount,null,j.decimalPrecision);h=AL.math.add(h,o)});var m=l.missingAmount;var k=AL.math.sub(m,h);if(AL.math.comp(k,0)>0){n.setValue(AL.math.approx(k,null,j.decimalPrecision))}}}}},{xtype:"textfield",name:"amount",width:130,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",blankText:"Es necesario fijar el monto a pagar",style:"margin-left: 18px",enableKeyEvents:true,calculateFromRetentions:true,disabled:this.isAddManual?true:false,},];a=a.concat(b);if(this.isAddManual){var d={xtype:"button",action:"deleteInvoice",height:16,width:16,baseCls:"none",listeners:{beforerender:function(g){var f=g.up("form");if(f.allowBase&&f.allowBase===true){g.style="margin-top: 2px;"}}}};a.push(d)}this.items=a;this.callParent()}});Ext.define("AL.view.transaction.AddVoidCause",{extend:"AL.view.common.AddVoidCause",alias:"widget.transaction_AddVoidCause"});Ext.define("AL.view.user.UserToolbar",{extend:"AL.view.common.IndexMainToolbar",alias:"widget.user_UserToolbar",toolbarConfig:{newButtonText:"Nuevo usuario",newButtonWidth:130,newButtonAction:"addUser",searchEmptyText:"Buscar usuario"}});Ext.define("AL.controller.User",{extend:"Ext.app.Controller",views:["user.FormAdd","user.FormEdit","user.FormPasswordChange","user.UserToolbar","user.FormPasswordChangeAdmin","user.FormEditAdmin","user.FormPermissions","user.FormUserNotifications","user.GridAll","user.ApiInformationPanel","user.FormInviteAccountant"],stores:["Users","UsersPositions","Languages"],models:["User"],init:function(){Ext.apply(Ext.form.VTypes,{password:function(g,f){var d=f.up("form");var e=d.down("textfield[name=password]");return(g==e.getValue())},passwordText:translate("thePasswordsDontMatch",true)});var a=Ext.get("invite-accountant");if(a){var c=this;a.on("click",function(d){d.preventDefault();c.application.fireEvent("inviteAccountant")})}this.application.addListener("inviteAccountant",function(){var d=Ext.create("AL.view.common.SmileWindow",{title:translate("enterYourAccountantData",true),bodyPadding:"0 35 35 35",width:500,modal:true,border:false,items:[{xtype:"component",width:450,cls:"modal-title",style:"margin-bottom: 20px; font-size: 16px",name:"title",html:'<div class="modal-subtitle" style="margin:13px auto 18px auto;">'+translate("theAccountantYouInviteWillHaveAccessToYourAccountAsALimitedUserWithAllActivePermissions",true)+"</div>"},{xtype:"user_FormInviteAccountant",}],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),cls:"button main-button",handler:function(e){var g=e.up("window");var f=g.down("button[action=save]");if(f){f.fireEvent("click",f)}},listeners:{afterrender:function(e){var g=e.up("window");var f=g.down("form");e.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){e.setDisabled(!h)})}}}]},});d.show()},this);var c=this;var b=Ext.get("userResendInvitation");if(b){b.on("click",function(f,g){f.preventDefault(0);GlobalLoadMask.show("viewUserInfo");var d=Ext.get(g);var h=d.getAttribute("data-id");c.resendUserInvitationLink(h)})}this.control({"buttons_SubmitReset button[action=saveNotifications]":{click:function(e){var f=Ext.ComponentQuery.query("user_FormUserNotifications")[0];if(f.getForm().isValid()){GlobalRedirector.go({zoneTitle:"Editando notificaciones"});e.disable();var d=f.getValues();Ext.Ajax.request({url:"/user/edit-notifications/format/json",method:"POST",params:d,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){Ext.MessageBox.alert("Éxito","Las notificaciones se han guardado exitosamente",function(){window.location="/configuration"})}else{e.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",j.cause)}},failure:function(){e.enable();GlobalRedirector.close()}})}else{GlobalMsg.showErrorMessage("Error")}}},user_FormUserNotifications:{render:function(d){Ext.Ajax.request({url:"/user/retrieve-user-notifications/format/json",success:function(g,k){var l=Ext.decode(g.responseText);if(l.success){var h=l.results.notifications;if(d.role&&d.role==="admin"){var o=d.down("checkbox[name=notificationInvoiceAlmostOverdueStatus]");var j=d.down("checkbox[name=notificationInvoiceOverdueTodayStatus]");var r=d.down("checkbox[name=notificationInvoiceOverdueStatus]");var n=d.down("numberfield[name=notificationInvoiceAlmostOverdueDays]");var f=d.down("numberfield[name=notificationInvoiceOverdueDays]");if(h.notificationsInvoiceAlmostOverdueStatus==="yes"){o.setValue(true)}if(h.notificationsInvoiceOverdueTodayStatus==="yes"){j.setValue(true)}if(h.notificationsInvoiceOverdueStatus==="yes"){r.setValue(true)}n.setValue(h.notificationsInvoiceAlmostOverdueDays);f.setValue(h.notificationsInvoiceOverdueDays);var m=d.down("box[name=almostOverdueInvoices]");var q='<div class="noifications-email-preview"><strong>De:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>Para:</strong> nombre@micliente.com<br /><strong>Asunto:</strong> "+l.results.almostOverdueTemplate.subject+"<hr /><br />";if(d.country=="usa"){q='<div class="noifications-email-preview"><strong>From:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>To:</strong> client@myclient.com<br /><strong>Subject:</strong> "+l.results.almostOverdueTemplate.subject+"<hr /><br />"}m.update(q+l.results.almostOverdueTemplate.message+"</div>");var p=d.down("box[name=overdueTodayInvoices]");q='<div class="noifications-email-preview"><strong>De:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>Para:</strong> nombre@micliente.com<br /><strong>Asunto:</strong> "+l.results.overdueTodayTemplate.subject+"<hr /><br />";if(d.country=="usa"){q='<div class="noifications-email-preview"><strong>From:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>To:</strong> client@myclient.com<br /><strong>Subject:</strong> "+l.results.overdueTodayTemplate.subject+"<hr /><br />"}p.update(q+l.results.overdueTodayTemplate.message+"</div>");var e=d.down("box[name=overdueInvoices]");q='<div class="noifications-email-preview"><strong>De:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>Para:</strong> nombre@micliente.com<br /><strong>Asunto:</strong> "+l.results.overdueTemplate.subject+"<hr /><br />";if(d.country=="usa"){q='<div class="noifications-email-preview"><strong>From:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>To:</strong> client@myclient.com<br /><strong>Subject:</strong> "+l.results.overdueTemplate.subject+"<hr /><br />"}e.update(q+l.results.overdueTemplate.message+"</div>")}}else{GlobalMsg.showErrorMessage("Error",l.cause)}},failure:function(){}})}},"buttons_SubmitReset button[action=saveUser]":{click:this.saveUser},user_FormEdit:{render:function(d){Ext.Ajax.request({url:"/user/retrieve-edit/format/json",success:function(j,f){var l=Ext.decode(j.responseText);if(l.success){var k=l.results,g=d.down("hidden[name=idLocal]"),o=d.down("textfield[name=name]"),h=d.down("textfield[name=lastName]"),p=d.down("textfield[name=email]"),m=d.down("combo[name=position]");languageField=d.down("combo[name=language]");if(k.metadata.position){var n=m.getStore();if(!n.hasLoaded()&&!n.isLoading()){n.load({callback:function(){d.setFieldValuesFromMetadata(k.metadata)}})}else{d.setFieldValuesFromMetadata(k.metadata)}}g.setValue(k.idLocal);o.setValue(k.name);h.setValue(k.lastName);p.setValue(k.email);languageField.setValue(k.language);if(d.enableMultiLanguage){languageField.show()}if(!k.emailEditable){p.addClass("input-readonly");p.setReadOnly(true)}}}});var e=Ext.get("changePassword");if(e){e.on("click",this.showChangePasswordForm)}}},user_FormEditAdmin:{render:function(d){Ext.Ajax.request({url:"/user/retrieve-edit/id/"+d.idLocal+"/format/json",success:function(k,f){var m=Ext.decode(k.responseText);if(m.success){var l=m.results,g=d.down("hidden[name=idLocal]"),p=d.down("textfield[name=name]"),h=d.down("textfield[name=lastName]"),q=d.down("textfield[name=email]"),n=d.down("combo[name=position]"),j=d.down("combo[name=role]");languageField=d.down("combo[name=language]");g.setValue(l.idLocal);p.setValue(l.name);h.setValue(l.lastName);q.setValue(l.email);languageField.setValue(l.language);if(d.enableMultiLanguage){languageField.show()}if(l.metadata.position){var o=n.getStore();if(!o.hasLoaded()&&!o.isLoading()){o.load({callback:function(){d.setFieldValuesFromMetadata(l.metadata)}})}else{d.setFieldValuesFromMetadata(l.metadata)}}j.setValue(l.role);if(!l.emailEditable){q.addClass("input-readonly");q.setReadOnly(true);q.setBorder(false)}}}});var e=Ext.get("changePassword");if(e){e.on("click",this.showChangePasswordFormAdmin)}}},"buttons_SubmitReset button[action=editUser]":{click:this.editUser},"user_FormPasswordChange button[action=save]":{click:function(e){var g=e.up("form");var d=g.getValues();var f=g.up("window");Ext.Ajax.request({url:"/user/change-password/format/json",method:"POST",params:d,success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){f.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("yourPasswordHasBeenChangedSuccessfully",true),type:"success"})}else{Ext.Msg.alert("Error",k.cause)}}})}},"user_FormPasswordChange button[action=close]":{click:function(d){var e=d.up("window");e.close()}},"user_FormEditAdmin combo[name=role]":{change:this.handleRoleChange},"user_FormAdd combo[name=role]":{change:this.handleRoleChange},user_FormPermissions:{render:function(d){if(d.idLocal){Ext.Ajax.request({url:"/user/retrieve-permissions/id/"+d.idLocal+"/format/json",success:function(h,m){var n=Ext.decode(h.responseText);if(n.success){var k=n.results;if(n.estimate!==null){var o=d.down("numberfield[name=discount_estimate]");o.setValue(n.estimate)}if(n.invoice!==null){var g=d.down("numberfield[name=discount_invoice]");g.setValue(n.invoice)}if(n.remission!==null){var e=d.down("numberfield[name=discount_remission]");e.setValue(n.remission)}var l=true;Ext.each(k,function(p){var r="checkbox[name="+p.resource+"__"+p.privilege+"]",q=d.down(r);if(q){if(p.resource=="client"&&p.privilege=="index"&&p.access=="deny"){l=false;q.config.fireChange=false}switch(p.access){case"deny":q.setValue(false);break;case"allow":break;default:break}}else{}});if(l){var f=d.down('checkbox[name="client__viewclients"]');var j=d.down('checkbox[name="client__viewproviders"]');f.setReadOnly(true);j.setReadOnly(true);f.addCls("x-item-disabled");j.addCls("x-item-disabled")}}else{}},failure:function(){}})}}},"user_FormPasswordChangeAdmin button[action=save]":{click:function(e){var g=e.up("form");var d=g.getValues();var f=g.up("window");Ext.Ajax.request({url:"/user/change-password/format/json",method:"POST",params:d,success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){f.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("yourPasswordHasBeenChangedSuccessfully",true),type:"success"})}else{Ext.Msg.alert("Error",k.cause)}}})}},"user_FormPasswordChangeAdmin button[action=close]":{click:function(d){var e=d.up("window");e.close()}},"user_UserToolbar button[action=addUser]":{click:function(){window.location="/user/add"}},user_GridAll:{itemdblclick:function(f,d,j,g,k,h){var l=d.get("idLocal");window.location="/user/view/id/"+l}},"user_GridAll gridcolumn[type=actions]":{click:function(k,n,h,f,l,g){var m=Ext.get(l.target);var d=k.up("grid").getSelectionModel().getSelection()[0];if(m.hasCls("viewUserDetailAction")){}else{if(m.hasCls("editUserAction")){}else{if(m.hasCls("disableUserAction")){l.preventDefault();Ext.Ajax.request({url:"/user/disable/id/"+d.get("idLocal")+"/format/json",success:function(j,o){var p=Ext.decode(j.responseText);if(p.success){var e=k.getStore();e.load()}else{Ext.Msg.alert("Error",p.cause)}}})}else{if(m.hasCls("deleteUserAction")){l.preventDefault();Ext.Msg.show({title:translate("deleteUser",true),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("user")+' "'+d.get("email")+'"? '+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/user/delete/id/"+d.get("idLocal")+"/format/json",success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){var j=k.getStore();j.load()}else{GlobalMsg.showErrorMessage("Error",q.cause)}}})}}})}else{if(m.hasCls("enableUserAction")){l.preventDefault();Ext.Ajax.request({url:"/user/enable/format/json",method:"post",params:{id:d.get("idLocal")},success:function(j,o){var p=Ext.decode(j.responseText);if(p.success){var e=k.getStore();e.load()}else{Ext.Msg.alert("Error",p.cause)}}})}}}}}}},"user_FormPermissions checkbox[name=estimate__edit_discount]":{change:function(h,j,e){if(h.getValue()>100){h.markInvalid(translate("theDiscount",true)+" "+translate("discount")+" no debe ser más del 100%")}var g=h.up("form");var f=g.down("numberfield[name=discount_estimate]");var d=g.down("label[name=label_discount_estimate]");if(e){d.hide(true);f.hide(true)}else{d.show(true);f.show(true)}}},"user_FormPermissions checkbox[name=invoice__edit_discount]":{change:function(h,j,e){if(h.getValue()>100){h.markInvalid(translate("theDiscount",true)+" "+translate("discount")+" no debe ser más del 100%")}var g=h.up("form");var f=g.down("numberfield[name=discount_invoice]");var d=g.down("label[name=label_discount_invoice]");if(e){d.hide(true);f.hide(true)}else{d.show(true);f.show(true)}}},"user_FormPermissions checkbox[name=remission__edit_discount]":{change:function(h,j,e){if(h.getValue()>100){h.markInvalid(translate("theDiscount",true)+" "+translate("discount")+" no debe ser más del 100%")}var g=h.up("form");var f=g.down("numberfield[name=discount_remission]");var d=g.down("label[name=label_discount_remission]");if(e){d.hide(true);f.hide(true)}else{d.show(true);f.show(true)}}},"user_FormPermissions checkbox[name=allow__userviewcosts]":{change:function(f,g,d){var e=f.up("form");if(g){Ext.each(f.dependencies,function(h){var j=e.down("checkbox[name="+h+"]");j.setValue(true);j.enable()})}else{Ext.each(f.dependencies,function(h){var j=e.down("checkbox[name="+h+"]");j.setValue(false);j.disable()})}}},user_ApiInformationPanel:{afterrender:function(d){Ext.Ajax.request({url:"/user/retrieve-api-information/format/json",success:function(e){var j=Ext.decode(e.responseText);if(j.success){d.down("displayfield[name=email]").setValue(j.results.email);var g=d.down("label[name=token]");var h=d.down("button[name=generateToken]");var f=d.down("button[name=regenerateToken]");if(j.results.token){g.show();g.update(j.results.token);h.hide();f.show()}else{h.show()}}},failure:function(){}})}},"user_ApiInformationPanel button[name=generateToken]":{click:function(d){var e=d.up("panel");GlobalLoadMask.show(e);Ext.Ajax.request({url:"/user/generate-api-token/format/json",success:function(f){var h=Ext.decode(f.responseText);if(h.success){if(h.success&&h.token){d.hide();var g=e.down("label[name=token]");g.show();g.update(h.token)}}},failure:function(){}});GlobalLoadMask.hide(e)}},"user_ApiInformationPanel button[name=regenerateToken]":{click:function(d){var e=d.up("panel");Ext.Msg.show({title:translate("apiRefreshTokenForExternalConnections"),msg:translate("apiTokenRenovationActionInfo")+" <br> "+translate("wouldYouLikeToContinue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(f){if(f=="yes"){GlobalLoadMask.show(e);Ext.Ajax.request({url:"/user/generate-api-token/format/json",success:function(g){var j=Ext.decode(g.responseText);if(j.success){if(j.success&&j.token){var h=e.down("label[name=token]");h.show();h.update(j.token)}}},failure:function(){}});GlobalLoadMask.hide(e)}}})}},"user_FormInviteAccountant button[action=save]":{click:function(e){var f=e.up("form");GlobalLoadMask.show(f);var d=f.getValues();Ext.Ajax.request({url:"/user/invite-accountant/format/json",method:"POST",params:d,success:function(g){var h=Ext.decode(g.responseText);if(h.success){GlobalLoadMask.hide(f);e.up("window").close();GlobalMsg.showNotification({title:translate("success",true),text:translate("weHaveSentTheInvitationToYourAccountant",true),type:"success"})}else{GlobalLoadMask.hide(f);GlobalMsg.showErrorMessage("Error",h.cause)}},failure:function(){GlobalLoadMask.hide(f);GlobalMsg.showErrorMessage("Error",translate("anErrorHasOccurredPleaseTryAgainLater",true))}})}}})},saveUser:function(d){d.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("user")});var f=Ext.ComponentQuery.query("user_FormAdd")[0];if(!f.getForm().isValid()){GlobalRedirector.close();GlobalMsg.showNotification({tpl:"formInvalidFields"});d.enable()}else{var b=f.getValues();var e=[];if(b.role==="user"){var a=Ext.ComponentQuery.query("user_FormPermissions")[0];e=a.getValues()}b.permissions=Ext.encode(e);var c=f.getFieldValuesAsMetadata();if(c){b.metadata=Ext.encode(c)}Ext.Ajax.request({url:"/user/add/format/json",method:"POST",params:b,success:function(g,h){var j=Ext.decode(g.responseText);var k=j.results;if(j.success){window.location="/user"}else{d.enable();GlobalRedirector.close()}},failure:function(){d.enable();GlobalRedirector.close()}})}},editUser:function(d){d.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("user")});var f=Ext.ComponentQuery.query("user_FormEditAdmin")[0];if(!f){f=Ext.ComponentQuery.query("user_FormEdit")[0]}if(!f.getForm().isValid()){GlobalRedirector.close();GlobalMsg.showNotification({tpl:"formInvalidFields"});d.enable()}else{var b=f.getValues();var e=[];if(b.role==="user"){var a=Ext.ComponentQuery.query("user_FormPermissions")[0];e=a.getValues()}b.permissions=Ext.encode(e);var c=f.getFieldValuesAsMetadata();if(c){b.metadata=Ext.encode(c)}Ext.Ajax.request({url:"/user/edit/format/json",method:"POST",params:b,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){window.location=j.redirectIn}else{d.enable();GlobalRedirector.close()}},failure:function(){GlobalRedirector.close()}})}},showChangePasswordForm:function(a){a.preventDefault();Ext.create("AL.view.user.FormPasswordChange",{})},showChangePasswordFormAdmin:function(c){c.preventDefault();var b=Ext.ComponentQuery.query("user_FormEditAdmin")[0];var d=Ext.create("AL.view.user.FormPasswordChangeAdmin",{});var a=d.down("hidden[name=idLocal]");a.setValue(b.idLocal)},handleRoleChange:function(f,e,b){var c=f.up("form");var d=Ext.ComponentQuery.query("user_FormPermissions")[0];var g=c.idLocal;var a=c.keyCountry;if(d){d.destroy()}if(e==="user"){Ext.create("AL.view.user.FormPermissions",{renderTo:"changePermissions",idLocal:g,keyCountry:a})}},resendUserInvitationLink:function(a){if(a){var b={id:a};Ext.Ajax.request({url:"/user/resend-invitation/format/json",method:"POST",params:b,success:function(c,d){var e=Ext.decode(c.responseText);GlobalLoadMask.hide("viewUserInfo");if(e.success){GlobalMsg.showNotification({title:translate("success",true),text:translate("weHaveForwardedTheInvitationMailToTheUser",true),type:"success"})}else{GlobalMsg.showNotification({title:"Error",text:translate("anErrorHasOccurredPleaseTryAgainLater",true),type:"error"})}},failure:function(){GlobalMsg.showNotification({title:"Error",text:translate("anErrorHasOccurredPleaseTryAgainLater",true),type:"error"})}})}else{GlobalLoadMask.hide("viewUserInfo");GlobalMsg.showNotification({title:"Error",text:translate("userNotFound",true),type:"error"})}}});Ext.define("AL.view.costCenter.GridAll",{extend:"Ext.grid.Panel",alias:"widget.costCenter_GridAll",requires:["AL.plugin.grid.PageSize"],scroll:true,layout:"fit",frame:true,minHeight:390,width:1024,store:"CostCenters",cls:"grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("costCenterNoExists",true)+'</div><div class="button-wrapper"><a href="/cost-center/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg> '+translate("costCenterNewButton",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"CostCenters"}],hiddenColumns:{},plugins:[{ptype:"grid_PageSize"}],initComponent:function(){this.columns=[{header:"Id",dataIndex:"idLocal",flex:0,hidden:true,sortable:false},{header:translate("code",true),dataIndex:"code",flex:1,sortable:false},{header:translate("costCenterNameLabel",true),dataIndex:"name",flex:2,sortable:false},{header:translate("creation",true),dataIndex:"created",flex:2,sortable:false},{header:translate("description",true),dataIndex:"description",flex:2,sortable:false},{header:translate("actions",true),align:"center",type:"actions",renderer:this.setActions,width:80}];this.callParent(arguments)},setActions:function(e,f,b,h,d,c,a){var g='<div class="action-icons">';if(b.get("status")==="active"){g+='<a href="/cost-center/edit/id/'+b.get("idLocal")+'" title="'+translate("edit",true)+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{if(b.get("status")==="inactive"){g+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}}if(b.get("deletable")){g+='<a href="#" title="'+translate("delete",true)+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="deleteCostCenter"/></a>'}else{g+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="disabled" />'}if(b.get("status")==="active"){g+='<a href="#" title="'+translate("disable",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("disable",true)+'" class="toggleCostCenterStatus"/></a>'}else{if(b.get("status")==="inactive"){g+='<a href="#" title="'+translate("enable",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("enable",true)+'" class="toggleCostCenterStatus"/></a>'}}g+="</div>";return g}});Ext.define("AL.controller.CostCenter",{extend:"Ext.app.Controller",views:["costCenter.FormAdd","costCenter.GridAll","costCenter.CostCenterForm","ux.form.Switch"],models:["CostCenter"],stores:["CostCenters","CostCentersCombo"],init:function(){var c=Ext.get("deactivateCostCenter");var a=this;var b=Ext.get("configurateCostCenter");var a=this;if(b){b.on("click",function(d){d.preventDefault();a.configurationWindow()})}this.application.addListener("deleteCostCenter",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:translate("costCenterDeleteTitle",true),msg:translate("costCenterDeleteConfirm").replace("{name}",d.get("name")),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g=="yes"){Ext.Ajax.request({url:"/cost-center/delete/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var h=e.getStore();h.load()}else{if(l.cause){Ext.MessageBox.alert("Error",l.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleCostCenterStatus",function(f){var d=f.record;var e=f.initiator;Ext.Ajax.request({url:"/cost-center/toggle-status/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){var g=e.getStore();g.load()}else{if(k.cause){Ext.MessageBox.alert("Error",k.cause)}}},failure:function(){}})},this);this.control({"costCenter_FormAdd button[action=cancel]":{click:function(d){window.location="/cost-center"}},"costCenter_FormAdd button[action=save]":{click:function(d){this.saveCostCenter(d)}},costCenter_FormAdd:{afterrender:this.initialize},costCenter_GridAll:{afterrender:function(e){var d=e.getStore();d.load()}},"costCenter_GridAll gridcolumn[type=actions]":{click:function(d,f,l,k,m,n){var o=this.application;var h=Ext.get(m.target);var g=d.up("grid").getSelectionModel().getSelection()[0];if(h.hasCls("deleteCostCenter")){m.preventDefault();if(g.get("deletable")){o.fireEvent("deleteCostCenter",{record:g,initiator:d})}else{Ext.Msg.alert("Error",translate("costCenterDeleteError",true))}}else{if(h.hasCls("toggleCostCenterStatus")){m.preventDefault();o.fireEvent("toggleCostCenterStatus",{record:g,initiator:d})}}}},"costCenter_CostCenterForm checkbox[name=costCenter]":{change:function(j,h,f){var g=j.up("form");if(j&&h){if(g.isValid()){var d=new Ext.LoadMask(Ext.getBody(),{msg:translate("costCenterActivationAction",true)});d.show();var e=g.getValues();Ext.Ajax.request({url:"/cost-center/settings/format/json",method:"POST",params:e,success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){window.location.reload()}else{win.close();d.hide();GlobalMsg.showErrorMessage("Error",m.cause,"no")}}})}}}},})},saveCostCenter:function(c){var d=c.up("form");c.disable();if(d.isValid()){GlobalRedirector.go({zoneTitle:"Guardando "+translate("costCenter")});var b="/cost-center/add/format/json";if(d.configs.type&&d.configs.type==="edit"){b="/cost-center/edit/format/json"}var a=d.getValues();var d=Ext.ComponentQuery.query("costCenter_FormAdd")[0];Ext.Ajax.request({url:b,params:a,method:"POST",success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){var h=g.results;window.location="/cost-center"}else{c.enable();GlobalRedirector.close()}},failure:function(){c.enable();GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:translate("costCenterErrorUnknow",true),type:"error"})}})}else{c.enable();GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(f){if(f.configs.type&&f.configs.type=="edit"){var e=f.down("hidden[name=idLocal]");var c=f.down("textfield[name=name]");var a=f.down("textfield[name=code]");var d=f.down("textfield[name=description]");var g=f.down("box[itemId=costCenterRequiredFields]");var b=new Ext.LoadMask(f,{msg:translate("loading",true)});b.show();Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+f.configs.idLocal+"/format/json",success:function(h,k){var l=Ext.decode(h.responseText);if(l.success){var j=l.results;e.setValue(j.idLocal);c.setValue(j.name);a.setValue(j.code);d.setValue(j.description);b.hide()}else{b.hide();GlobalMsg.showErrorMessage("Error",l.cause)}}})}},deactivateWindow:function(){var a=this;var b=Ext.create("AL.view.common.SmileWindow",{id:"confirm-window-deactivate-cost-centers",title:translate("costCenter",true),width:600,modal:true,items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 13px 0px 13px; position: relative; text-align: justify; line-height: 18px;",html:"<div>"+translate("costCenterDeactivateConfirmTxt",true)+"</div>"}],footer:{items:[{text:translate("btnCancel",true),cls:"button",handler:function(c){b.close()}},{text:translate("buttonOk",true),cls:"button main-button",handler:function(d){var e=d.up("window");var c=new Ext.LoadMask(e,{msg:translate("costCenterDeactivationAction",true)});c.show();Ext.Ajax.request({url:"/cost-center/activation/format/json",method:"POST",params:{costcenter:"no"},showSpinner:true,success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){window.location.reload()}else{b.close();c.hide();GlobalMsg.showErrorMessage("Error",h.cause)}}})}}]}});b.show()},configurationWindow:function(){var e=this,b=Ext.ComponentQuery.query("costCenter_GridAll")[0],d=false;if(b){d=b.configs.costCenterPerLineEnabled}var a={bills:translate("bills"),debitNotes:translate("debitNotes")};var c='<div class="tooltip-wrapper add-invoice" style="top:6px;left:325px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-18px;width:200px!important"><div class="tooltip-text-wrapper" style="width:200px;padding:5px!important;"><div class="text">'+translate("costCenterHelpPerLine",true,a)+"</div></div></div></div>";var f=Ext.create("AL.view.common.SmileWindow",{id:"window-configuration-cost-centers",title:translate("costCenterConfigutationTitle",true),width:600,modal:true,style:"padding:18px 18px 0px 18px",items:[{xtype:"switch",name:"costCenterEnableSwitch",height:50,label:{text:translate("costCenterStatus",true)},options:[{id:"active",value:"yes",text:translate("costCenterEnable",true),checked:true,name:"costCenterStatus",},{id:"inactive",value:"no",text:translate("costCenterDisable",true),name:"costCenterStatus",},],hidden:false,afterBodyEl:null},{xtype:"switch",name:"costCenterPerLineSwitch",height:70,label:{text:translate("costCenterPerLine",true)},options:[{id:"costCenterPerLineYes",value:"yes",text:translate("costCenterPerLineYes",true),checked:d,name:"costCenterPerLine",},{id:"costCenterPerLineNo",value:"no",text:translate("costCenterPerLineNo",true),checked:!d,name:"costCenterPerLine",},],hidden:false,afterBodyEl:c}],footer:{items:[{text:translate("btnCancel",true),cls:"button",handler:function(g){f.close()}},{text:translate("save",true),cls:"button main-button",handler:function(l){var o=l.up("window");var g=Ext.ComponentQuery.query("costCenter_GridAll")[0];var p=false;if(g){p=g.configs.costCenterPerLineEnabled?"yes":"no"}var h=new Ext.LoadMask(o,{msg:translate("costCenterSettingsAction",true)});h.show();var m=f.down("switch[name=costCenterPerLineSwitch]");var n=p?"yes":"no";if(m){n=m.getOptionSelected().value}var k={};if(p!=n){k.costCenterPerLine=n}var j=f.down("switch[name=costCenterEnableSwitch]");if(j){if(j.getOptionSelected().value=="no"){k.costCenter="no"}}if(!Ext.Object.isEmpty(k)){Ext.Ajax.request({url:"/cost-center/settings/format/json",method:"POST",params:k,showSpinner:true,success:function(q,r){var s=Ext.decode(q.responseText);if(s.success){window.location.reload()}else{f.close();h.hide();GlobalMsg.showErrorMessage("Error",s.cause)}}})}else{f.close();h.hide()}}}]}});f.show()},});Ext.define("AL.plugin.grid.ColumnFilter",{require:["AL.plugin.grid.AbstractTriggerToolbar"],extend:"AL.plugin.grid.AbstractTriggerToolbar",alias:"plugin.grid_ColumnFilter",pluginId:"columnfilter",filtersToolbarPos:null,initialValues:{},filterEmptyText:"",init:function(c){var d=this;if(!d.filterEmptyText){d.filterEmptyText='<div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("emptyRecordsWithFilters",true)+"</div></div>"}d.showPluginButtonQuery="button[itemId=showFiltersButton]";if(c.columnFilterConfig){Ext.apply(d,c.columnFilterConfig)}if(!d.gridEmptyText){d.gridEmptyText=c.getView().emptyText}d.callParent(arguments);if(!d.filtersToHide){d.filtersToHide=[]}d.filters=[];d.hasFilters=false;d.createFiltersToolbar();d.createTriggerContainer();if(!Ext.Object.isEmpty(d.initialValues)){d.filtersToolbar.show();for(var f in d.initialValues){var e=d.initialValues[f],b=d.getFilterField(f);if(!b){Ext.Error.raise("Invalid initial filter value. Filter field not found or not valid to apply filters")}if(Ext.isArray(e)){Ext.each(e,function(h,g){b.select(e)})}else{b.setValue(e)}}d.applyFilters();d.displayTriggerContainer(false)}var a=c.disableColumnFilter&&c.disableColumnFilter===true;if(c.isHidden()||a){d.undisplayTriggerContainer()}c.on("columnschanged",function(g){d.createFiltersToolbar()});c.headerCt.on("add",function(j,h,g){d.getColumnDefs(d.grid,true);d.createFiltersToolbar()});if(!a){c.on("show",function(){d.displayTriggerContainer()});c.on("hide",function(){d.undisplayTriggerContainer()})}},createFiltersToolbar:function(){var e=this,c=e.grid,d=true,f=e.filtersToolbarPos;if(e.filtersToolbar){d=e.filtersToolbar.isHidden();e.grid.removeDocked(e.filtersToolbar,true);e.filtersToolbar=null}var h=[e.getFiltersForm(c)];var b=null;var a=[{xtype:"button",text:translate("filter",true),action:"filtrate",margin:"0 0 0 10",overCls:"filterButton-over",listeners:{scope:this,click:function(k,l,j){var m=true;this.applyFilters(m)}}},{xtype:"button",html:translate("close",true),overCls:"filterButton-over",listeners:{click:function(k,l,j){e.updateActiveFiltersText("");e.clearFilters();e.filtersToolbar.hide();e.displayTriggerContainer(true)}}}];var g="hbox";if(this.allColumnsWithFilters){g={type:"column",columns:1};b=[{xtype:"container",items:h},{xtype:"container",layout:{type:"hbox",pack:"end"},width:"100%",cls:"filter-buttons-container",items:[a[0],a[1]]}]}else{b=h.concat(["->",a[0],a[1]])}delete this.allColumnsWithFilters;e.filtersToolbar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",hidden:d,cls:"filters-toolbar gridplugintoolbar",items:b,layout:g});if(f===null){f=c.dockedItems.getRange().length}c.addDocked(e.filtersToolbar,f)},createTriggerContainer:function(){var a=this;a.callParent(arguments);a.getTriggerContainer().add({xtype:"label",cls:"active-filters-label",itemId:"activeFiltersLabel",emptyHtml:"",notEmptyHtml:"<b>"+translate("activeFilters",true)+": </b>",style:"text-align: right; line-height: 22px; color: #777;",text:"",flex:1});a.getTriggerContainer().addNewTrigger({xtype:"button",icon:"https://cdn1.getsoft.app/images/icons/bullet_arrow_down.png",iconAlign:"right",cls:"show-plugin-button",text:translate("filter",true),itemId:"showFiltersButton",listeners:{click:function(c,d,b){a.filtersToolbar.show();a.undisplayTriggerContainer()}}})},getFiltersForm:function(a){var f=this.getColumnDefs(a),c=[],e={allowBlank:true,msgTarget:"side",hideLabel:true,margin:0,listeners:{scope:this,validitychange:function(h,g){var j=h.up("toolbar").down("button[action=filtrate]");if(this.filterFieldsAreValid()&&j.isDisabled()){j.enable()}else{if(!this.filterFieldsAreValid()&&!j.isDisabled()){j.disable()}}}}},b=this,d=f.length-1;Ext.each(f,function(h,j){var l={},k;Ext.apply(l,e);l.name=h.name;l.emptyText=h.header;l.gridcolumn=h.gridcolumn;l.hidden=h.gridcolumn.hidden;l.filterField=h.filterField;l.specialName=h.specialName;k=b.getColumnWidthForFilter(l.gridcolumn,j,d);if(k){l.width=k}var g={};if(h.filterField){if(Ext.isString(h.filterField)){h.dataType=h.filterField}else{g=h.filterField}}if(h.gridcolumn.filterField){if(Ext.isString(h.gridcolumn.filterField)){h.dataType=h.gridcolumn.filterField}else{g=h.gridcolumn.filterField}}if(g.dataType){h.dataType=g.dataType}Ext.apply(l,g);if(!l.xtype){switch(h.dataType){case"enum":Ext.apply(l,b.generateEnumField(h));break;case"date":case"datetime":Ext.apply(l,b.generateDateField());break;case"int":case"integer":case"number":case"float":Ext.apply(l,b.generateNumberField(h.dataType));break;case"display":Ext.apply(l,b.generateDisplayField());break;case"string":case"auto":default:Ext.apply(l,b.generateStringField());break}}if(h.dataType&&h.dataType!=="display"){l.listeners={specialkey:function(m,n){if(n.getKey()==n.ENTER){if(m.$className!=="Ext.form.field.ComboBox"||!m.isExpanded){b.applyFilters();b.displayTriggerContainer(false)}}}}}c.push(l)});return{xtype:"form",layout:"column",formType:"filterForm",cls:"grid-filter-form",bodyStyle:"background-color: transparent;",border:false,height:22,items:[{xtype:"fieldcontainer",layout:"hbox",items:c}],listeners:{scope:b,beforerender:function(h){var g=h.form.getFields().items,k=g.length-1,j=this;Ext.each(g,function(m,l){m.gridcolumn.on("resize",function(o,n){m.setWidth(j.getColumnWidthForFilter(o,l))})})}}}},getColumnDefs:function(c,a){var d=this;a=(typeof a!=="undefined"&&a)?a:false;if(typeof this.columnDefs==="undefined"||a===true){var b=this.getModelFieldsTypes(c),e=[];Ext.each(c.columns,function(g){if(g.getGridColumns().length){e=e.concat(d.getColumnDefsByColumns(c,g.getGridColumns()));return}if(g.filter===false){return}var f={name:g.dataIndex,header:g.text.replace(/<br[ ]*\/?>/g," "),dataType:null,values:null,gridcolumn:g};if(b[g.dataIndex]){if(b[g.dataIndex].filterEmptyText){f.header=b[g.dataIndex].filterEmptyText}if(b[g.dataIndex].filterField){f.filterField=b[g.dataIndex].filterField}if(b[g.dataIndex].specialName){f.specialName=b[g.dataIndex].specialName}}if((g.sortable===true||g.filter===true)&&d.filtersToHide.indexOf(f.name)===-1){if(Ext.isObject(b[g.dataIndex])){f.dataType=b[g.dataIndex].type;f.values=b[g.dataIndex].values;f.valuesStore=b[g.dataIndex].valuesStore}else{f.dataType=b[g.dataIndex]}}else{f.dataType="display"}e.push(f)});Ext.each(e,function(f,g){if(f.dataType==="display"||f.gridcolumn.hidden){e.splice(g,1)}else{return false}},this,true);if(e.length===c.columns.length){this.allColumnsWithFilters=true}else{this.allColumnsWithFilters=false}this.columnDefs=e}return this.columnDefs},getModelFieldsTypes:function(c){var a=c.getStore().model.getFields();var b={};Ext.each(a,function(h){if(h.isEnum){var d={},f=null;if(h.valuesStore){f=h.valuesStore}else{for(var e in h.values){var g=h.values[e];if(typeof g==="object"){if(!c.configs){return console.warn("Grid configs is not defined")}if(!c.configs.country){return console.warn("Country is not defined in grid configs")}if(g.country){if(g.country.indexOf(c.configs.country)!==-1){d[e]=g.name}}else{d[e]=g.name}}else{d[e]=g}}}b[h.name]={type:"enum",values:d,valuesStore:f,filterEmptyText:h.filterEmptyText,filterField:h.filterField,specialName:h.specialName}}else{b[h.name]={type:h.type.type,filterEmptyText:h.filterEmptyText,filterField:h.filterField,specialName:h.specialName}}});return b},generateDisplayField:function(){return{xtype:"displayfield"}},generateStringField:function(){return{xtype:"textfield"}},generateNumberField:function(a){var b={xtype:"numberfield",hideTrigger:true};if(["int","integer"].indexOf(a)>-1){b.allowDecimals=false}return b},generateDateField:function(){return{xtype:"datefield"}},generateEnumField:function(b){var c,e={xtype:"combobox",queryMode:"local",valueField:"value",displayField:"displayValue",multiSelect:true,forceSelection:true,autoSelect:false,editable:false,matchFieldWidth:false,listConfig:{itemTpl:'<tpl><span class="checkbox"></span> {displayValue}</tpl>',maxHeight:400}};if(c=b.valuesStore){e.store=c.storeName;if(c.valueField){e.valueField=c.valueField}if(c.displayField){e.displayField=c.displayField;e.listConfig.itemTpl='<tpl><span class="checkbox"></span> {'+e.displayField+"}</tpl>"}return e}var a=b.values,d={fields:["value","displayValue"],data:[]};Ext.Object.each(a,function(f,g,h){d.data.push({value:f,displayValue:g})},this);e.store=d;return e},applyFilters:function(f,d){d=d||false;var a=this.grid,l=this,b=a.down("form[formType=filterForm]").getForm();if(b.isValid()){var h=b.getValues(),k=this.getFilterFields(),e=[],m="",o=false;if(!d){Ext.each(k,function(p){var s={property:p.specialName?p.specialName:p.getName(),type:"contains",value:h[p.getName()]};if(!Ext.isEmpty(s.value)){o=true;var t=p.emptyText+": ";if(p.xtype==="datefield"){t+=Ext.Date.format(p.getValue(),p.format)}else{if(Ext.isArray(s.value)){var u=[],q=p.valueField,r=p.displayField;Ext.each(s.value,function(x,w){var v=p.getStore().findRecord(q,x);u.push(v.get(r).toLowerCase())});t+=u.join(" - ")}else{if(p.isXType("combobox")){t+=p.getDisplayValue()}else{t+=s.value}}}if(m===""){m+='<span class="active-filter">'}else{t=", "+t}m+=t}switch(p.getXType()){case"combo":case"combobox":s.type="enum";break;case"datefield":if(p.filterField&&p.filterField==="datetime"){s.type="containsDate"}else{s.type="equalsDate"}break;case"numberfield":case"textfield":default:break}e.push(s)});if(m!==""){m+='<img style="cursor: pointer; vertical-align: middle;margin-left: 8px; width: 12px; height: 12px;" src="https://cdn1.getsoft.app/images/welcome-wizard/welcome-wizard-close_icon.png"></span>'}}if(f||o||o!==l.hasFilters){var n=a.getStore(),j=n.getProxy();if(j.type!=="memory"){j.setExtraParam("filters",Ext.encode(e))}l.disableFilterFields();l.disableFilterToolbarButtons();var g=function(p){l.filters=e;l.hasFilters=o;if(o===true){a.fireEvent("filtersapplied",a,Ext.encode(e))}else{a.fireEvent("filterscleared",a)}l.updateActiveFiltersText(p);l.enableFilterFields();l.enableFilterToolbarButtons();if(l.getTriggerContainer().isHidden()){l.displayTriggerContainer(false)}};if(o===true){a.getView().emptyText=l.filterEmptyText}else{a.getView().emptyText=l.gridEmptyText}if(j.type==="memory"){n.clearFilter();var c=[];Ext.each(e,function(r,q){if(!r.value){return}var s=r.property,t=r.value,p;if(Ext.isArray(r.value)){t=t.join("|")}t="("+t+")";switch(e[q].type){case"contains":p=t;break;case"containsDate":p="^"+t;break;case"enum":case"equalsDate":p="^"+t+"$";break}c.push(Ext.create("Ext.util.Filter",{filterFn:function(u){var v=new RegExp(p,"gi");return u.data[s].toString().match(v)}}))});if(c.length){n.addFilter(c)}g(m)}else{n.loadPage(1,{callback:function(p){g(m);if(a.columnFilterConfig&&a.columnFilterConfig.callbackStoreLoad&&typeof a.columnFilterConfig.callbackStoreLoad==="function"){a.columnFilterConfig.callbackStoreLoad(p)}}})}}}},clearFilters:function(){var b=this.grid,c=false,a=this.getFilterFields();Ext.each(a,function(e){if(!Ext.isEmpty(e.getValue())){e.reset();c=true}});if(this.hasFilters===true||c===true){var d=true;this.applyFilters(d,true)}},getActiveFiltersLabel:function(){return this.getTriggerContainer().down("label[itemId=activeFiltersLabel]")},getShowFiltersButton:function(){return this.getShowPluginButton()},getFilterFields:function(){return this.grid.query("form[formType=filterForm] field:not(displayfield)")},getFilterField:function(a){return this.grid.down("form[formType=filterForm] field:not(displayfield)[name="+a+"]")},disableFilterFields:function(){var a=this.getFilterFields();Ext.each(a,function(b){b.setDisabled(true)})},enableFilterFields:function(){var a=this.getFilterFields();Ext.each(a,function(b){b.setDisabled(false)})},disableFilterToolbarButtons:function(){var a=this.filtersToolbar.query("button");Ext.each(a,function(b){b.disable()})},enableFilterToolbarButtons:function(){var a=this.filtersToolbar.query("button");Ext.each(a,function(b){b.enable()})},filterFieldsAreValid:function(){var a=this.getFilterFields(),b=true;Ext.each(a,function(c){if(!c.isValid()){b=false;return false}});return b},updateActiveFiltersText:function(f){var d=this,a=d.grid,e=d.getActiveFiltersLabel();closingFilters=false;if(!f){e.setText(e.emptyHtml);closingFilters=true}else{e.setText(e.notEmptyHtml+f,false);var c=Ext.query(".active-filter img",e.getEl().dom);if(c.length>0){c=Ext.get(c[0]);c.on("click",function(){d.clearFilters()})}}var b=Ext.get("conciliated-tooltip");if(b){if(!closingFilters){b.addCls("conciliated-tooltip-fix")}else{b.removeCls("conciliated-tooltip-fix")}}},getSubmitFilters:function(){return Ext.encode(this.filters)},getColumnWidthForFilter:function(e,d,a){var f,c=this.grid,b=0;Ext.each(c.columns,function(h,g){if(h.isVisible()){b=g;return false}});if(e.rendered){f=e.getWidth();if(d===b||d===a){f-=2}}else{if(e.width){f=e.width}}return f}});Ext.define("AL.view.account.GridAllConciliations",{extend:"Ext.grid.Panel",alias:"widget.account_GridAllConciliations",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],currencySymbol:null,frame:false,cls:"grid-accounts grid-with-icons",minHeight:390,width:1024,columnLines:true,store:"Conciliations",viewConfig:{stripeRows:true,emptyText:'<style>.grid-accounts .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has conciliado esta cuenta!</div></div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"Conciliations"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",flex:1,align:"center",renderer:this.renderDate},{header:"Gastos bancarios",dataIndex:"accountExpenses",width:150,align:"right",renderer:this.renderMoney},{header:"Impuestos bancarios",dataIndex:"accountTaxes",width:150,align:"right",renderer:this.renderMoney},{header:"Entradas bancarias",dataIndex:"accountInterests",width:150,align:"right",renderer:this.renderMoney},{header:"Saldo final",dataIndex:"realBalance",width:150,align:"right",renderer:this.renderMoney},{header:"Estado",dataIndex:"state",flex:1,align:"center",renderer:this.renderStatus},{header:"Acciones",align:"center",type:"conciliationActions",renderer:this.setActions,width:150,filter:false,sortable:false}];this.callParent(arguments)},renderDate:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b=AL.date(f);return'<a href="/account/view-conciliation/idConciliation/'+a+'">'+Ext.Date.format(b,"d/m/Y")+"</a>"},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";switch(e){case"draft":j="conciliationDraft";a="Borrador";break;case"open":j="conciliationOpen";a="Abierta";break;default:break}return'<span class="'+j+'">'+a+"</span>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2,this.currencySymbol)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/account/view-conciliation/idConciliation/'+a+'" title="Ver detalle de la conciliación"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle" /></a>';if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Deshacer conciliación" class="deleteConciliation" title="Deshacer conciliación" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Deshacer conciliación" class="disabled" title="Deshacer conciliación" />'}b+="</div>";return b}});Ext.define("AL.controller.Account",{extend:"Ext.app.Controller",views:["account.FormAdd","account.GridAll","account.AccountToolbar","buttons.SubmitReset","account.GridAccount","account.FormAccountTransfer","account.GridAllConciliations","account.GridConciliationTransactions","account.MoreActionsButton"],stores:["Accounts","Transactions","Conciliations","CompanyCurrenciesCombo"],models:["Account","Transaction","Conciliation","CompanyCurrency"],init:function(){var c=this;var b=Ext.select("a[data-action=toggle-activateAccount]");if(b.elements.length>0){b.on("click",function(j,k){j.preventDefault();var g=Ext.get(k);var h=g.getAttribute("data-idAccount"),d=g.getAttribute("data-accountStatus"),f=g.getAttribute("data-accountName");this.application.fireEvent("toggleAccountStatus",{idAccount:h,status:d,accountName:f,initiator:null})},this)}this.application.addListener("toggleAccountStatus",function(j){var g=j.idAccount;var d=j.status;var e=j.accountName;var f=j.initiator;var k="";var h="";if(d==="active"){if(e&&e.match(/Efectivo POS/g)){k=translate("deactivateAccountAssociatedToThe",true)+" "+translate("station")+" "+translate("ofThePointOfSale")+" "+translate("pointOfSale",true)+" ("+translate("pointOfSaleAcronym")+")";h=translate("thisAccountIsAssociatedWithOneOfYour",true)+" "+translate("stations")+" "+translate("ofThePointOfSale")+" "+translate("pointOfSaleAcronym")+". "}else{k=translate("deactivate",true)+" "+translate("account")}h+=translate("areYouSureYouWantToAction",true,{action:[translate("deactivate"),translate("this"),translate("account")].join(" ")});h+=" "+translate("byPerformingThisAction",true)+" "+translate("youWillNotBeAbleToMakeTransactionsInThisAccount")+", ";h+=translate("butYouCanStillCheckThisAccount")}else{k=translate("activate",true)+" "+translate("account");h+=translate("areYouSureYouWantToAction",true,{action:[translate("activate"),translate("this"),translate("account")].join(" ")});h+=" "+translate("byPerformingThisAction",true)+" "+translate("youWillBeAbleToMakeTransactionsInThisAccountAgain")}Ext.Msg.show({title:k,msg:h,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(l){if(l=="yes"){Ext.Ajax.request({url:"/account/toggle-account-status/format/json",method:"POST",params:{id:g},success:function(n,o){var p=Ext.decode(n.responseText);if(p.success){if(f){var m=f.getStore();m.load()}else{window.location.reload()}}else{GlobalMsg.showErrorMessage("Error",p.cause)}},failure:function(){}})}}})},this);var a=Ext.select("a[data-action=transfer-between-accounts]");if(a){a.on("click",function(j,k){var g=Ext.get(k);var h=g.getAttribute("data-idAccount");var d=g.getAttribute("data-currency");var f=Ext.ComponentQuery.query("grid[holds=transactions]")[0];this.application.fireEvent("transfer-between-accounts",{idOrigin:h,grid:f,currency:d})},this)}this.application.addListener("transfer-between-accounts",function(g){var e=g.idOrigin;var d=g.currency;var h=g.idDestination;var f=g.grid;Ext.create("AL.view.common.SmileWindow",{title:translate("newF",true)+" "+translate("accountTransfer"),layout:"anchor",border:false,frame:false,smileTooltip:{text:'<div class="text" style="font-weight: normal;">'+translate("ifYouNeedHelp",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205801449">'+translate("clickHere")+"</a>.",style:"top: -10px;height: 50px;width: 300px;left: -240px;"},autoShow:true,autoScroll:true,width:500,bodyStyle:{background:"#fff"},required:true,modal:true,grid:f,items:[{xtype:"account_FormAccountTransfer",idOrigin:e,idDestination:h,configs:{currency:d}},],footer:{items:[{cls:"button main-button",text:translate("save",true),margin:"0 28 0 0",handler:function(j){var l=j.up("window");var k=l.down("button[action=save]");if(k){k.fireEvent("click",k);j.setDisabled(true)}},listeners:{afterrender:function(j){var l=j.up("window");var k=l.down("form");j.setDisabled(k.hasInvalidField());k.on("validitychange",function(n,m){j.setDisabled(!m)})}}}]},listeners:{afterrender:function(k){var j=k.down("button[action=save]");if(j){j.hide()}}}})});this.application.addListener("deleteAccount",function(j){var d=j.record,g=j.initiator,f=d.get("name"),e=translate("remove",true)+" "+translate("account")+"",h=translate("areYouSureYouWantToDelete",true)+" "+translate("this")+" "+translate("account")+"? "+translate("thisOperationCannotBeUndone",true)+".";if(f&&f.match(/Efectivo POS/g)){e=translate("removeAccountAssociatedToThe",true)+" "+translate("station")+" "+translate("ofThePointOfSale")+" "+translate("pointOfSale",true)+" ("+translate("pointOfSaleAcronym")+")";h=translate("thisAccountIsAssociatedWithOneOfYour",true)+" "+translate("stations")+" "+translate("ofThePointOfSale")+" "+translate("pointOfSaleAcronym")+". "+translate("areYouSureYouWantToDelete",true)+" "+translate("this")+" "+translate("account")+"? "+translate("thisOperationCannotBeUndone",true)}Ext.Msg.show({title:e,msg:h,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(k){if(k=="yes"){Ext.Ajax.request({url:"/account/delete/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(m,n){var o=Ext.decode(m.responseText);if(o.success){var l=g.getStore();l.load();if(o.categoryError){Ext.MessageBox.alert("Advertencia",o.categoryError)}}else{if(o.cause){Ext.MessageBox.alert("Error",o.cause)}}},failure:function(){}})}}})},this);this.application.addListener("deleteConciliation",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:"Eliminar conciliación",msg:"¿Estás seguro de que deseas eliminar la conciliación? Esta operación no se puede deshacer.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g=="yes"){Ext.Ajax.request({url:"/conciliation/delete/format/json",method:"POST",params:{id:d.get("idLocal")},timeout:240000,success:function(j,k){var m=Ext.decode(j.responseText);if(m.success){var h=e.getStore();h.load()}else{var n=m.notification;var l=n.text=="No cuentas con permisos para acceder"?"No cuentas con permisos para eliminar conciliaciones.":n.text;Ext.MessageBox.alert("Error",l)}},failure:function(){}})}}})},this);this.control({"account_FormAdd button[action=save]":{click:this.saveAccount},account_FormAdd:{render:this.initialize},"account_FormAdd combo[name=type]":{change:function(h,g,d,e){var f=h.up("form");var j=f.down("textfield[name=number]");if(g==="cash"){j.disable()}else{j.enable()}}},"account_AccountToolbar button[action=addAccount]":{click:function(){window.location="/account/add"}},account_FormAccountTransfer:{beforerender:function(g){var f=g.down("combo[name=idOrigin]");var e=this;var d=f.getStore();var h=function(){var j=d.getRange(0,d.getCount());g.accounts=j;e.accountComboChanged(f)};if(!d.hasLoaded()&&!d.isLoading()){d.load({callback:function(){h()}})}else{h()}}},"account_FormAccountTransfer combo[name=idOrigin]":{beforerender:function(f){var e=f.up("form");var d=f.getStore();if(e.idOrigin){if(!d.hasLoaded()&&!d.isLoading()){d.load({callback:function(){f.select(e.idOrigin)}})}else{f.select(e.idOrigin)}}},select:function(d){this.accountComboChanged(d)}},"account_FormAccountTransfer combo[name=idDestination]":{beforerender:function(f){var e=f.up("form");var d=f.getStore();if(e.idDestination){if(!d.hasLoaded()&&!d.isLoading()){d.load({callback:function(){f.select(e.idDestination)}})}else{f.select(e.idOrigin)}}},select:function(d){this.accountComboChanged(d)}},"account_FormAccountTransfer button[action=save]":{click:function(f){var h=this,g=f.up("form"),e=g.getValues(),d=g.down("hidden[name=exchangeCurrency]");f.disable();if(d&&d.getValue()){e.exchangeRate=d.getValue()}Ext.Ajax.request({url:"/account/transfer/format/json",method:"POST",params:e,success:function(k,n){f.enable();var o=Ext.decode(k.responseText);f.enable();if(o.success){var m=g.up("window");if(m){if(m.grid){var l=m.grid;var j=l.getStore();j.load();h.updateBalance(l)}m.close()}}else{Ext.MessageBox.alert("Error",o.cause)}},failure:function(){f.enable()}})}},account_GridAccount:{render:function(f){var g=this,d=f.getStore(),e=d.getProxy();d.remoteSort=true;e.url="/account/retrieve-transactions/id/"+f.idAccount+"/format/json";d.load()},itemdblclick:function(h,d,j,f,k,g){window.location="/transaction/view/id/"+d.get("idLocal")},filtersapplied:function(d,e){c.updateBalance(d,e)},filterscleared:function(d){c.updateBalance(d)}},"account_GridAccount pagingtoolbar button[itemId=refresh]":{click:function(d){c.updateBalance(d.up("grid"))}},"account_GridAccount gridcolumn[type=transactionActions]":{click:function(d,g,n,l,o,p){var q=this.application;var k=Ext.get(o.target);var h=d.up("grid").getSelectionModel().getSelection()[0];if(k.hasCls("editTransaction")){o.preventDefault();q.fireEvent("editTransaction",{record:h,initiator:d})}else{if(k.hasCls("deleteTransaction")){o.preventDefault();q.fireEvent("deleteTransaction",{record:h,initiator:d})}else{if(k.hasCls("voidTransaction")){o.preventDefault();q.fireEvent("voidTransaction",{record:h,initiator:d})}else{if(k.hasCls("convertTransactionToOpen")){o.preventDefault();q.fireEvent("convertTransactionToOpen",{record:h,initiator:d})}else{if(k.hasCls("printTransaction")){o.preventDefault();var f=h.get("idLocal");var m=window.open("/transaction/print/id/"+f);m.print()}else{if(k.hasCls("deleteCurrencyAdjustment")){o.preventDefault();q.fireEvent("deleteCurrencyAdjustment",{record:h,initiator:d})}}}}}}}},"account_GridAccount button[action=conciliateAccount]":{click:function(e){var d=e.up("account_GridAccount");window.location="/conciliation/index/id/"+d.idAccount}},"account_GridAllConciliations gridcolumn[type=conciliationActions]":{click:function(d,f,l,k,m,n){var o=this.application;var h=Ext.get(m.target);var g=d.up("grid").getSelectionModel().getSelection()[0];if(h.hasCls("deleteConciliation")){m.preventDefault();if(g.get("deletable")){o.fireEvent("deleteConciliation",{record:g,initiator:d})}else{Ext.Msg.alert("Error","No se puede eliminar cnciliaciones anteriores a la última.")}}}},"account_GridAllAccounts gridcolumn[type=actions]":{click:function(d,f,m,l,n,o){var p=this.application;var k=Ext.get(n.target);var g=d.up("grid").getSelectionModel().getSelection()[0];if(k.hasCls("deleteAccount")){n.preventDefault();if(g.get("deletable")){p.fireEvent("deleteAccount",{record:g,initiator:d})}else{Ext.Msg.alert("Error","No se puede eliminar la cuenta seleccionada")}}else{if(k.hasCls("toggleAccountStatus")){n.preventDefault();var q=g.get("idLocal");var h=g.get("status");p.fireEvent("toggleAccountStatus",{idAccount:q,status:h,accountName:g.get("name"),initiator:d,})}}}},account_GridAllAccounts:{itemdblclick:this.goAccountDetails,render:function(f){var d=f.getStore();var e=d.getProxy();e.extraParams={includeInactive:"true",deletable:"yes",includeBalance:"true"};d.load({callback:function(h,g,k){var j=0;Ext.each(h,function(l){if(l.get("type")==="credit-card"){l.set("balance",AL.math.mul(-1,l.get("balance")));l.set("balanceSecondaryCurrency",AL.math.mul(-1,l.get("balanceSecondaryCurrency")))}j=AL.math.add(j,l.get("balance"))});j=AL.math.approx(j);Ext.get("total").setHTML(Ext.util.Format.usMoney(j,2))}})}},account_GridAllConciliations:{afterrender:function(f){var g=f.idAccount;var d=f.getStore();var e=d.getProxy();e.url="/account/retrieve-conciliations/id/"+g+"/format/json";d.load()}},account_GridConciliationTransactions:{afterrender:function(f){var d=f.getStore();var e=d.getProxy();e.url="/transaction/retrieve-by-conciliation/idConciliation/"+f.idConciliation+"/format/json";d.remoteSort=true;d.load()}},"account_FormAdd combo[name=currency]":{change:function(k){var j=k.up("form");var g=j.down("displayfield[name=exchangeCurrencyDisplay]");var f=j.down("hidden[name=exchangeCurrency]");var d=k.getSelectedRecord();var e=this.application;if(d.get("code")&&d.get("code")!=j.configs.currency){g.show();g.setValue("1 "+d.get("code")+" = "+Ext.util.Format.round(d.get("exchangeRate"),8)+" "+j.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');f.setValue(Ext.util.Format.round(d.get("exchangeRate"),8));var h=Ext.get("editExchangeRate");if(h){h.on("click",function(m){m.preventDefault();var l={};l.currency=d.get("code");l.currencyRecord=d;l.initiator=g;e.fireEvent("editExchangeRate",l)})}}else{g.hide();f.setValue(null)}}},"menuitem[action=toggleActivateAccount]":{click:function(d,f){f.preventDefault();var g=d.up("splitbutton");this.application.fireEvent("toggleAccountStatus",{idAccount:g.idLocal,status:g.status,accountName:g.accountName,initiator:null})}}})},saveAccount:function(d){if(this.validateForms()){d.disable();GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("bank")});var e=d.up("form");var b=e.getValues();var c="";if(e.type&&e.type=="edit"){c="/account/edit/format/json"}else{c="/account/add/format/json"}var a=e.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){b.exchangeRate=a.getValue()}Ext.Ajax.request({url:c,method:"POST",params:b,success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var j=h.results;window.location="/account"}else{GlobalMsg.showErrorMessage("Error",h.cause);d.enable();GlobalRedirector.close()}},failure:function(){GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(c){if(c.type!="edit"){var a=c.down("combo[name=currency]");var d=a.getStore();d.load({callback:function(){var h=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});d.add(h);a.select(c.configs.currency)}});if(c.configs.multicurrency=="yes"){a.show()}}if(c.type&&c.type=="edit"){var g=c.idLocal,f=c.down("textfield[name=initialBalance]"),b=c.down("textfield[name=initialBalanceDate]"),e=c.down("combo[name=type]");e.disable();if(!c.initialBalanceEditable){f.disable();b.disable()}Ext.Ajax.request({url:"/account/retrieve-one/id/"+g+"/format/json",success:function(n,h){var p=Ext.decode(n.responseText);var o=p.results;var j=c.down("hidden[name=idLocal]");var k=c.down("textfield[name=name]");var q=c.down("combo[name=type]");var m=c.down("textfield[name=number]");var t=c.down("textarea[name=description]");q.select(o.type);k.setValue(o.name);j.setValue(o.idLocal);m.setValue(o.number);t.setValue(o.description);f.setValue(o.initialBalance);var l=AL.date(o.initialBalanceDate);l=Ext.Date.format(l,"d/m/Y");b.setValue(l);var r=c.down("combo[name=currency]");var s=r.getStore();s.load({callback:function(){var u=s.findRecord("code",o.currencyCode);if(u){u.set("exchangeRate",o.exchangeRate)}else{u=Ext.create("AL.model.CompanyCurrency",{code:o.currencyCode,exchangeRate:o.exchangeRate});if(currencyRecord&&currencyRecord.code){s.add(currencyRecord)}}r.select(u)}});if(c.configs.multicurrency=="yes"&&o.currencyCode){c.down("displayfield[name=exchangeCurrencyDisplay]").show()}},failure:function(){}})}},goAccountDetails:function(d,a,f,b,g,c){var h=a.get("idLocal");window.location="/account/view/id/"+h},validateForms:function(){var b=Ext.ComponentQuery.query("account_FormAdd")[0];var a=true;if(b){if(!b.getForm().isValid()){a=false}}return a},updateBalance:function(b,c){var d={},a="";if(c){d.filters=c;a=' <span class="filters-indicator">(con filtros)</span>'}Ext.Ajax.request({url:"/account/retrieve-balance/id/"+b.idAccount+"/format/json",method:"POST",params:d,success:function(e,f){var k=Ext.decode(e.responseText);if(k.success){var g=k.accountBalance,h=k.mainCurrencyBalance,j=Ext.ComponentQuery.query("displayfield[name=accountBalanceField]");Ext.each(j,function(l){l.setFieldLabel(l.initialConfig.fieldLabel+a);if(l.type=="mainCurrency"){l.setValue(Ext.util.Format.usMoney(h,2))}else{l.setValue(Ext.util.Format.usMoney(g,2))}})}else{Ext.MessageBox.alert("Error",k.cause)}},failure:function(){}})},accountComboChanged:function(d){var h=d.getSelectedRecord();var k=this.application;var b=d.up("form");var o=b.down("displayfield[name=exchangeCurrencyDisplay]");var j=b.down("hidden[name=exchangeCurrency]");var e=b.down("textfield[name=amount]");if(h&&h.get("currencyCode")){var g=b.down("combo[name=idOrigin]");var n=g.getSelectedRecord();if(d.name=="idOrigin"){var c=b.accounts;var m=d.getStore();m.removeAll();m.loadData(c);e.setFieldLabel(translate("amount",true)+' <span style="color:#888888; font-size: 10px;">('+n.get("currencyCode")+')</span><span class="req">*</span>');var l=b.down("combo[name=idDestination]");var a=l.getSelectedRecord();m.each(function(p){if(p&&p.get("currencyCode")&&h.get("currencyCode")!=p.get("currencyCode")){m.remove(p)}})}o.show();o.setValue("1 "+h.get("currencyCode")+" = "+Ext.util.Format.round(h.get("currentExchangeRate"),8)+" "+b.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');o.updateLayout();j.setValue(h.get("currentExchangeRate"));var f=Ext.get("editExchangeRate");if(f){f.on("click",function(q){q.preventDefault();var p={};p.currency=h.get("currencyCode");p.initiator=o;k.fireEvent("editExchangeRate",p)})}}else{if(h&&!h.get("currencyCode")){var g=b.down("combo[name=idOrigin]");var n=g.getSelectedRecord();if(a&&n&&!a.get("currencyCode")&&!n.get("currencyCode")){o.hide();j.setValue(null)}if(!a&&n&&!n.get("currencyCode")){o.hide();j.setValue(null)}if(d.name=="idOrigin"){e.setFieldLabel(translate("amount",true)+'<span class="req">*</span>');var m=d.getStore();var c=b.accounts;m.removeAll();m.loadData(c)}}else{if(!h){o.hide();j.setValue(null);if(d.name=="idOrigin"){var m=d.getStore();var c=b.accounts;m.removeAll();m.loadData(c)}}}}}});Ext.define("AL.view.common.GridAllBills",{extend:"Ext.grid.Panel",alias:"widget.common_GridAllBills",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:"Facturas",scroll:true,layout:"fit",frame:true,minHeight:390,width:1024,store:"Bills",cls:"grid-bills grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+[translate("youHaventCreatedYour",true),translate("firstFemale"),translate("supplierInvoice")].join(" ")+'!</div><div class="button-wrapper"><a href="/bill/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+[translate("newF",true),translate("supplierInvoice")].join(" ")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Bills"}],hiddenColumns:{},plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(b){var a=b.getStore();var c=b.configs&&b.configs.parentGridAutoLoad===false?false:true;if(c){a.load()}}},initComponent:function(){if(["costaRica"].indexOf(this.country)===-1||this.isActiveElectronicInvoicing==false){this.hiddenColumns.legalStatus=true}this.columns=[{header:translate("number",true),dataIndex:"billNumber",renderer:this.linkValue,width:120,align:"center"},{header:translate("supplier",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("creation",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate,hidden:this.hiddenColumns.date},{header:translate("due",true),dataIndex:"dueDate",align:"center",width:90,renderer:this.renderDueDate,hidden:this.hiddenColumns.dueDate},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,sortable:false,width:100,hidden:this.hiddenColumns.total},{header:translate("paid",true),dataIndex:"totalPayed",align:"right",renderer:this.renderMoney,sortable:false,width:100,hidden:this.hiddenColumns.totalPayed,filter:false},{header:translate("toPay",true),dataIndex:"missingAmount",align:"right",renderer:this.renderMoney,sortable:false,width:100,hidden:this.hiddenColumns.missingAmount,filter:false},{header:translate("emission",true),dataIndex:"legalStatus",align:"center",width:75,sortable:false,renderer:this.renderLegalStatus,hidden:this.hiddenColumns.legalStatus},{header:translate("actions",true),align:"center",type:"billActions",renderer:this.setActions,width:150,hidden:this.hiddenColumns.actions,filter:false,sortable:false}];this.callParent(arguments)},linkCode:function(e,f,b,g,d,c,a){return'<a href="/bill/view/id/'+b.get("idLocal")+'">'+b.get("idLocal")+"</a>"},linkValue:function(f,j,b,d,h,g,e){var c=b.get("prefix")?b.get("prefix"):"";var a=e.up("grid");text=c+f;if(a.country=="costaRica"){text=AL.format.ellipsis(text,16,5);j.tdAttr='data-qtip="'+c+f+'"'}return'<a href="/bill/view/id/'+b.get("idLocal")+'">'+text+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/bill/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderDueDate:function(f,g,b,h,e,c,a){if(b.get("isOverdue")){g.tdCls="overdue-date"}var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderLegalStatus:function(f,j,b,d,h,g,e){var c="";var a=e.up("grid");switch(f){case"ACCEPTED":case"ACCEPTED_WITH_OBSERVATIONS":c="Aceptada";break;case"PENDING":c="En proceso";break;case"REJECTED":c="Rechazada";break;default:c="Ninguna";break}return c},setActions:function(j,n,f,g,m,k,h){var b=f.get("idLocal");var d=f.get("canPrintOrDownload");var l=f.get("hasResolution");var a=h.up("grid");var c=a.canPrint;var e='<div class="action-icons">';e+='<a href="/bill/view/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';if(a.country=="republicaDominicana"&&l){if(d){e+='<a target="_blank" href="/bill/print/id/'+b+'" title="'+translate("print",true)+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="printBill" data-canPrint="'+c+'" data-idLocal="'+b+'"></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}}if(a.country=="costaRica"){if(d){e+='<a target="_blank" href="/bill/print/id/'+b+'" title="'+translate("print",true)+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="printBill" data-canPrint="'+c+'" data-idLocal="'+b+'"></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}}if(f.get("state")==="open"){e+='<a href="/transaction/out/idBill/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="'+translate("addPayment",true)+'" /></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="'+translate("addPayment",true)+'" class="disabled"/>'}if(f.get("editable")){e+='<a href="/bill/edit/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'"/></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(f.get("deletable")){e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("cancel",true)+'" class="deleteBill" />'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("cancel",true)+'" class="disabled deleteBill" />'}e+="</div>";return e},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.bill.GridAll",{extend:"AL.view.common.GridAllBills",alias:"widget.bill_GridAll"});Ext.define("AL.view.stampDocumentReceived.GridAll",{extend:"Ext.grid.Panel",alias:"widget.stampDocumentReceived_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],minHeight:390,layout:"fit",store:"StampDocumentsReceived",width:1024,scroll:false,frame:true,viewConfig:{deferEmptyText:false,emptyText:'<style>.grid-items .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has subido ningún archivo XML!<div></div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"StampDocumentsReceived"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){var a=["costaRica","colombia"];this.columns=[{header:this.configs&&Ext.Array.indexOf(a,this.configs.country)>-1?"Emisor":"Proveedor",dataIndex:"name",align:"center",flex:this.configs&&Ext.Array.indexOf(a,this.configs.country)>-1?0.5:3,renderer:this.renderProvider,},{header:translate("identification",true),dataIndex:"identification",align:"center",width:150},{header:this.configs.country==="colombia"?"Emisión":"Fecha",dataIndex:"date",align:"center",width:80,renderer:this.renderDate},{header:"Total",dataIndex:"total",align:"center",renderer:this.renderMoney,width:80},{header:"Acciones",type:"actions",align:"center",filter:false,sortable:false,renderer:this.renderActions,width:this.configs.country==="colombia"?212:(this.configs.country==="costaRica"?(AL.config.regime=="SIMPLIFIED_REGIME"?140:200):140),html:'<a target="_blank" href="'+(this.configs.country==="colombia"?"https://ayudas.getsoft.app/es/articles/3754081":"https://ayuda.getsoft.app/consulta-tu-buz%C3%B3n-de-correo-de-alegra-costa-rica#proceso-aceptacion-rechazo")+'"><div class="tooltip-wrapper" style="margin-left: -440px; margin-top:-15px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"></div></a>'}];if(this.configs){switch(this.configs.country){case"costaRica":this.columns.splice(1,1);this.columns.splice(1,0,{header:"Tipo de comprobante",dataIndex:"resourceType",align:"center",width:150,renderer:this.renderResourceType});this.columns.splice(3,0,{header:"Número de comprobante",dataIndex:"number",align:"center",width:150,sortable:false});this.columns.splice(5,0,{header:"Respuesta",dataIndex:"response",align:"center",width:140,renderer:this.renderResponse,sortable:false});this.columns.splice(6,0,{header:"Estado DGT",dataIndex:"legalStatus",align:"center",width:90,sortable:false,renderer:this.renderLegalStatus});break;case"colombia":this.columns.splice(1,1);this.columns.splice(1,0,{header:"Tipo de documento",dataIndex:"resourceType",align:"center",width:115,renderer:this.renderResourceType});this.columns.splice(2,0,{header:"Fecha",dataIndex:"datetime",align:"center",width:80,renderer:this.renderDate});this.columns.splice(4,0,{header:"Número de documento",dataIndex:"number",align:"center",width:140,sortable:false});this.columns.splice(6,0,{header:"Evento",dataIndex:"response",align:"center",width:110,renderer:this.renderResponse,sortable:false});this.columns.splice(7,0,{header:"Estado Dian",dataIndex:"legalStatus",align:"center",width:90,sortable:false,renderer:this.renderLegalStatus});break}}this.callParent(arguments)},renderMoney:function(b,c,a){return Ext.util.Format.usMoney(b,2,a.get("currencySymbol"))},renderLink:function(b,c,a){if(a.get("billIdLocal")&&b){b='<a href="/bill/view/id/'+a.get("billIdLocal")+'">'+b+"</a>"}return b},renderIntegrated:function(b,c,a){if(b){b='<a href="/bill/view/id/'+a.get("billIdLocal")+'">Si</a>'}else{b="No"}return b},renderActions:function(m,q,g,j,p,n,k){var b=g.get("idLocal");var o=g.get("idBill");var f='<div class="action-icons">';var r="icon green ";switch(this.configs.country){case"costaRica":var h=g.get("legalStatus")?true:false;if(h){r+="disabled "}if(AL.config.regime!="SIMPLIFIED_REGIME"){f+='<a href="#"><svg class="'+r+(h?"":"acceptDocumentReceived")+'" style="background:transparent;"><title>Aceptar</title><use xlink:href="/images/smile-icons.svg#success"></use></svg></a>';f+='<a href="#"><svg class="'+r+(h?"":"partiallyAcceptDocumentReceived")+'" style="background:transparent;"><title>Aceptar parcialmente</title><use xlink:href="/images/smile-icons.svg#success-outline"></use></svg></a>';f+='<a href="#"><svg class="'+r+(h?"":"rejectDocumentReceived")+'" style="background:transparent;"><title>Rechazar</title><use xlink:href="/images/smile-icons.svg#close"></use></svg></a>'}f+='<a target="_blank" href="/stamp-reception-mail/view/id/'+g.get("idStampReceptionMail")+'"><svg class="icon green" style="background:transparent;"><title>Ver correo original</title><use xlink:href="/images/smile-icons.svg#email"></use></svg></a>';f+='<a href="/stamp-document-received/download/id/'+b+'"><svg class="icon green" style="background:transparent;"><title>Descargar archivos asociados</title><use xlink:href="/images/smile-icons.svg#export"></use></svg></a>';f+='<a href="#"><svg class="'+r+(h?"":"deleteStampDocumentReceived")+'" style="background:transparent;"><title>Eliminar</title><use xlink:href="/images/smile-icons.svg#delete"></use></svg></a>';break;case"mexico":if(!o){f+='<a href="/bill/add-from-xml/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/layout_delete.png" alt="Convertir a factura de compra" class="convertXmlToBill"/></a>'}else{f+='<img src="https://cdn1.getsoft.app/images/icons/layout_delete.png" alt="Convertir a factura de compra" class="disabled"/>'}f+='<a target="_blank" href="/stamp-reception-mail/view/id/'+g.get("idStampReceptionMail")+'"><svg class="'+r+'" style="background:transparent;"><title>Ver correo original</title><use xlink:href="/images/smile-icons.svg#email"></use></svg></a>';f+='<a href="/stamp-document-received/download/id/'+b+'"><svg class="'+r+'" style="background:transparent;"><title>Descargar archivos asociados</title><use xlink:href="/images/smile-icons.svg#export"></use></svg></a>';f+='<a href="#"><svg class="'+r+'deleteStampDocumentReceived" style="background:transparent;"><title>Eliminar</title><use xlink:href="/images/smile-icons.svg#delete"></use></svg></a>';break;case"colombia":var h=g.get("legalStatus")?true:false;var e=g.get("response");var a=g.get("resourceType");var c=false;var d=r;var l=r;if(this.configs.isActiveElectronicInvoicing&&this.configs.electronicInvoicingVersion=="2.1"){if(h){r+="disabled ";l+="disabled "}if(e=="ACKNOWLEDGMENT"||e==""){c=true}else{d+="disabled "}}else{r+="disabled ";c=true;d+="disabled "}if(a=="bill"){f+='<a href="/bill/add-from-xml/id/'+b+'" style="vertical-align: middle;"><img src="https://cdn1.getsoft.app/images/icons/layout_delete.png" alt="Registrar comprobante" title="Registrar comprobante" class="convertXmlToBill"/></a>'}else{f+='<img src="https://cdn1.getsoft.app/images/icons/layout_delete.png" alt="Registrar comprobante" title="Registrar comprobante" class="disabled" style="vertical-align: middle;"/>'}f+='<a href="#"><svg class="'+(!h&&e=="ACCEPT"?r+"disabled ":(r+(h?"":"acknowledgmentReceipt")))+'" style="background:transparent;"><title>Acuse de recibo</title><use xlink:href="/images/smile-icons.svg#inbox"></use></svg></a>';f+='<a href="#"><svg class="'+d+(c?"acceptDocumentReceived":"")+'" style="background:transparent;"><title>Aceptar</title><use xlink:href="/images/smile-icons.svg#success"></use></svg></a>';f+='<a href="#"><svg class="'+d+(c?"rejectDocumentReceived":"")+'" style="background:transparent;"><title>Rechazar</title><use xlink:href="/images/smile-icons.svg#close"></use></svg></a>';f+='<a target="_blank" href="/stamp-reception-mail/view/id/'+g.get("idStampReceptionMail")+'"><svg class="icon green" style="background:transparent;"><title>Ver correo original</title><use xlink:href="/images/smile-icons.svg#email"></use></svg></a>';f+='<a href="/stamp-document-received/download/id/'+b+'"><svg class="icon green" style="background:transparent;"><title>Descargar archivos asociados</title><use xlink:href="/images/smile-icons.svg#export"></use></svg></a>';f+='<a href="#"><svg class="'+l+(h?"":"deleteStampDocumentReceived")+'" style="background:transparent;"><title>Eliminar</title><use xlink:href="/images/smile-icons.svg#delete"></use></svg></a>';break}f=f+"</div>";return f},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderOrigin:function(e,f,b,g,d,c,a){if(e=="email"){e="Correo"}else{e="Aplicación"}return e},renderResponse:function(e,j,b,c,g,f,d){var a=null;switch(e){case"ACKNOWLEDGMENT":a="Acusado";break;case"ACCEPT":a="Aceptado";break;case"PARTIALL_ACCEPT":a="Aceptado parcialmente";break;case"REJECT":a="Rechazado";break}if(this.configs.country=="colombia"&&e&&e!="ACKNOWLEDGMENT"){if(b.get("accusedId")){a=("Acusado, "+a)}}var h="";if(b.get("message")&&b.get("message")!=""){h+="<strong>Mensaje:</strong> "+b.get("message")}j.tdAttr='data-qtip="'+h+'"';return a},renderLegalStatus:function(g,l,b,d,j,h,e){var c=null;switch(g){case"ACKNOWLEDGMENT":c="Acusada";break;case"ACCEPTED":c="Aceptada";break;case"ACCEPTED_WITH_OBSERVACTIONS":c="Aceptada con observaciones";break;case"REJECTED":c="Rechazada";break;case"PENDING":c="En proceso";break;case"ACCEPT_DEFAULT":c="Aceptación tácita";break}if(c){if(this.configs.country=="colombia"){var a=b.get("response");var f=a=="ACCEPT"?"Aceptación":(a=="REJECT"?"Rechazo":null);if(g!="ACCEPT_DEFAULT"){if(g!="ACKNOWLEDGMENT"&&b.get("accusedId")){var k="<strong>Acuse:</strong><br />Número de respuesta: "+b.get("accusedId")+"<br /><strong>"+f+"</strong><br />Número de respuesta: "+b.get("responseNumber")}else{var k="<strong>Número de respuesta:</strong> "+b.get("responseNumber")}}}else{var k="<strong>Número de respuesta:</strong> "+b.get("responseNumber");if(b.get("uuid")){k+="<br><strong>Clave:</strong> "+b.get("uuid")}}if(k){l.tdAttr='data-qtip="'+k+'"'}}return c},renderProvider:function(e,f,b,g,d,c,a){if(this.configs&&this.configs.country==="costaRica"){f.tdAttr='data-qtip="'+e+" ("+b.get("identification")+')"'}return e},renderResourceType:function(f,g,b,h,d,c,a){var e=null;switch(f){case"bill":e="Factura";break;case"debitNote":e="Nota crédito";break}return e}});Ext.define("AL.controller.StampDocumentReceived",{extend:"Ext.app.Controller",views:["stampDocumentReceived.GridAll",],stores:["StampDocumentsReceived",],models:["StampDocumentReceived"],init:function(){var a=this;this.application.addListener("responseToDocumentReceived",function(d){var g=Ext.ComponentQuery.query("stampDocumentReceived_GridAll")[0];var f=d.record;var b=d.initiator;var j="factura";var c="";switch(f.get("resourceType")){case"debitNote":j="nota crédito";break}if(g.configs.country=="colombia"&&(g.configs.isActiveElectronicInvoicing!==true||g.configs.electronicInvoicingVersion!="2.1")){c="Te invitamos a activar facturación electrónica para que puedas";switch(d.response){case"ACKNOWLEDGMENT":c+=" realizar el acuse de recibo de";break;case"ACCEPT":c+=" aceptar";break;case"REJECT":c+=" rechazar";break}c+=' tus comprobantes, <a href="https://ayudas.getsoft.app/es/articles/1939968">conoce el proceso aquí.</a>';Ext.MessageBox.alert("Error",c);return}var e=j+" #"+f.get("number")+" de "+f.get("name")+" por "+Ext.util.Format.usMoney(f.get("total"),2,f.get("currencySymbol"));var k="";var h=[];var m=400;switch(d.response){case"ACKNOWLEDGMENT":k="¿Deseas acusar el comprobante?";c="Estás enviando el acuse de recibo de la "+e+".";break;case"ACCEPT":k="¿Deseas aceptar el comprobante?";c="Estás aceptando la "+e+".";break;case"REJECT":case"PARTIALL_ACCEPT":if(g.configs&&g.configs.country!="colombia"){h.push({xtype:"textarea",name:"cause",emptyText:"Indica el motivo de "+(d.response==="PARTIALL_ACCEPT"?"aceptación parcial":"rechazo")+".",maxLength:80,maxLengthText:"El tamaño máximo de este campo es de 80 caracteres",allowBlank:false,})}if(d.response==="PARTIALL_ACCEPT"){k="¿Deseas aceptar parcialmente el comprobante?";c='Para aceptar <strong style="font-family:Roboto;">parcialmente</strong> la '+e+" debes indicar el motivo.";m=500}else{k="¿Deseas rechazar el comprobante?";c="Estás rechazando la "+e+".";if(g.configs&&g.configs.country!="colombia"){c='Para <strong style="font-family:Roboto;">rechazar</strong> la '+e+" debes indicar el motivo."}}break}h.splice(0,0,{xtype:"box",html:'<div style="padding:10px 0;font-family:Roboto;color:#1A1A1A;">'+c+" <br><br> Notificaremos tu respuesta a "+f.get("name")+".</div>"});var l=Ext.create("AL.view.common.SmileWindow",{reason:"responseToDocumentReceived",data:d,title:k,bodyPadding:"10 35",border:false,width:m,modal:true,items:{xtype:"form",items:h,border:false,anchor:100,layout:"anchor",defaults:{anchor:"100%",align:"center"},bodyPadding:5,cls:"buttons-form",buttons:[{text:"No",handler:function(n){var o=n.up("form");l.destroy()},hidden:true},{text:"Si",cls:"sm-button-primary",formBind:true,name:"acceptButton",hidden:true,handler:function(r){var n=r.up("form");var t=n.down("textarea[name=cause]");var u=n.up("window");var q=u.data;var s=q.record;var p={id:s.get("idLocal"),response:q.response};if(t){p.cause=t.getValue()}u.destroy();var v=function(z,w){var y="";if(g.configs&&g.configs.country=="colombia"){y="proveedores"}else{switch(z.response){case"ACKNOWLEDGMENT":y="acuse de recibo";break;case"ACCEPT":y="aceptación";break;case"PARTIALL_ACCEPT":y="aceptación parcial";break;case"REJECT":y="rechazo";break}}var x=Ext.create("AL.view.common.SmileWindow",{reason:"editNumberInfo",title:"Configuración de consecutivo",bodyPadding:"10 35",border:false,width:500,modal:true,items:{xtype:"form",items:[{xtype:"box",html:'<div style="padding: 10px 0;">Aún no has configurado tus consecutivos de respuesta, configura el consecutivo numérico con el que se comenzarán a '+translate("stamp")+" tus respuestas de "+y+"</div>"},{xtype:"textfield",fieldLabel:"",name:"nextNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el consecutivo numérico de "+y,msgTarget:"side",emptyText:"Consecutivo numérico para respuestas de "+y}],border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:"Guardar",action:"save",formBind:true,handler:function(A){var C=A.up("form");var B=C.up("window");var D=C.down("textfield[name=nextNumber]");z.number=D.getValue();B.destroy();w(z)},hidden:true},{text:"Cancelar",action:"close",hidden:true,handler:function(A){var B=A.up("window");B.destroy()},}]},footer:{items:[{text:"Cancelar",cls:"button",handler:function(A){var C=A.up("window");var B=C.down("button[action=close]");if(B){B.fireEvent("click",B);B.fireHandler()}}},{text:"Guardar",cls:"button main-button",handler:function(A){var C=A.up("window");var B=C.down("button[action=save]");if(B){B.fireEvent("click",B);B.fireHandler()}},listeners:{afterrender:function(A){var C=A.up("window");var B=C.down("form");A.setDisabled(B.hasInvalidField());B.on("validitychange",function(E,D){A.setDisabled(!D)})}}}]},});x.show()};var o=function(w){Ext.Ajax.on("beforerequest",a.showSpinner,a);Ext.Ajax.on("requestcomplete",a.hideSpinner,a);Ext.Ajax.request({url:"/stamp-document-received/response/format/json",method:"POST",showSpinner:true,params:w,success:function(y,z){var B=Ext.decode(y.responseText);if(B.success){var x=b.getStore();x.load()}else{if(B.errorCode==7003){v(w,o)}else{if(B.errorCode==23004){var A=Ext.create("AL.modal.PlanLimit",{configs:{message:"Has generado las 5 aceptaciones o rechazos disponibles en tu plan actual. Elige un nuevo plan para realizar esta acción y seguir creciendo con Alegra."}});A.init()}else{Ext.MessageBox.alert("Error",B.cause)}}}},failure:function(){}})};o(p)}}]},footer:{items:[{text:"No",cls:"button",handler:function(n){l.destroy()}},{text:"Si",cls:"button main-button",handler:function(n){var p=n.up("window");var o=p.down("button[name=acceptButton]");if(o){o.fireEvent("click",o);o.fireHandler()}},listeners:{afterrender:function(n){var p=n.up("window");var o=p.down("form");n.setDisabled(o.hasInvalidField());o.on("validitychange",function(r,q){n.setDisabled(!q)})}}}]},});l.show()},this);this.application.addListener("deleteStampDocumentReceived",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:"Eliminar XML",msg:"¿Estás seguro de eliminar el archivo? Esta operación no se puede deshacer.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/stamp-document-received/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=c.getStore();f.load()}else{Ext.MessageBox.alert("Error",j.cause)}},failure:function(){}})}}})},this);this.application.addListener("convertXmlToBill",function(d){var b=d.record;var c=d.initiator;Ext.Ajax.request({url:"/bill/find-mx-xml-duplicate/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(e,f){var j=Ext.decode(e.responseText);var l=j.idLocal;if(j.hasDuplicate){var h=j.resultArray;var k="Las siguientes "+translate("bills")+" en Alegra coinciden con el XML que intentas crear: <br> ";for(i=0;i<h.length;i++){var g=h[i].prefix?h[i].prefix:"";k+='<li> <a href="/bill/view/id/'+h[i].idLocal+'" target="_blank">'+translate("bill",true)+" "+g+h[i].billNumber+"</a> </li> "}k+="¿Deseas continuar?";Ext.Msg.show({msg:k,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Aceptar",no:"Cancelar"},icon:Ext.Msg.QUESTION,fn:function(m){if(m=="yes"){window.location="/bill/add-from-xml/id/"+l}}})}else{window.location="/bill/add-from-xml/id/"+l}},failure:function(){}})},this);this.control({stampDocumentReceived_GridAll:{beforerender:function(e){var b=e.getStore();if(!b.hasLoaded()&&!b.isLoading()){var d=b.getProxy();var c="/stamp-document-received/retrieve-all/noIdResource/true/format/json";if(e.configs&&e.configs.country=="colombia"){d.url="/stamp-document-received/retrieve-all/format/json"}b.load()}}},"stampDocumentReceived_GridAll gridcolumn[type=actions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteStampDocumentReceived")||f.parent().hasCls("deleteStampDocumentReceived")){k.preventDefault();m.fireEvent("deleteStampDocumentReceived",{record:d,initiator:b})}if(f.hasCls("convertXmlToBill")||f.parent().hasCls("convertXmlToBill")){k.preventDefault();m.fireEvent("convertXmlToBill",{record:d,initiator:b})}if(f.hasCls("acknowledgmentReceipt")||f.parent().hasCls("acknowledgmentReceipt")){k.preventDefault();m.fireEvent("responseToDocumentReceived",{record:d,initiator:b,response:"ACKNOWLEDGMENT"})}if(f.hasCls("partiallyAcceptDocumentReceived")||f.parent().hasCls("partiallyAcceptDocumentReceived")){k.preventDefault();m.fireEvent("responseToDocumentReceived",{record:d,initiator:b,response:"PARTIALL_ACCEPT"})}if(f.hasCls("acceptDocumentReceived")||f.parent().hasCls("acceptDocumentReceived")){k.preventDefault();m.fireEvent("responseToDocumentReceived",{record:d,initiator:b,response:"ACCEPT"})}if(f.hasCls("rejectDocumentReceived")||f.parent().hasCls("rejectDocumentReceived")){k.preventDefault();m.fireEvent("responseToDocumentReceived",{record:d,initiator:b,response:"REJECT"})}}}})},showSpinner:function(b,c,d){d=d?d:"Enviando...";if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}}});Ext.define("AL.view.client.GridTransactions",{extend:"Ext.grid.Panel",alias:"widget.client_GridTransactions",requires:["AL.plugin.grid.ColumnFilter","AL.plugin.grid.PageSize"],title:"",border:true,frame:true,scroll:true,layout:"fit",height:400,store:"Transactions",plugins:[{ptype:"grid_ColumnFilter"},{ptype:"grid_PageSize"}],dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],cls:"grid-client-transactions grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-client-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotRegisteredDocumentYet",true,{document:translate("transactions")})+"!</div></div></div>"},initComponent:function(){this.columns=[{header:translate("date",true),dataIndex:"date",width:90,renderer:this.renderDate},{header:translate("status",true),renderer:this.renderConciliated,dataIndex:"conciliated",width:100},{header:translate("detail",true),dataIndex:"associations",flex:1},{header:translate("expenses",true),dataIndex:"amount",align:"right",width:130,renderer:this.renderPayment,sortable:false},{header:translate("incomes",true),dataIndex:"amount",align:"right",width:130,renderer:this.renderDeposit,sortable:false},];this.callParent(arguments)},renderConciliated:function(f,g,b,h,d,c,a){var e=(b.get("conciliated"))?translate("reconciledF",true):translate("notReconciled",true);return e},renderDeposit:function(f,j,b,d,h,g,e){var a="";var c=b.get("currencySymbol")?b.get("currencySymbol"):null;if(b.get("type")==="in"){a=Ext.util.Format.usMoney(b.get("amount"),b.get("decimalPrecision"),c)}return a},renderPayment:function(f,j,b,d,h,g,e){var a="";var c=b.get("currencySymbol")?b.get("currencySymbol"):null;if(b.get("type")==="out"){a=Ext.util.Format.usMoney(b.get("amount"),b.get("decimalPrecision"),c)}return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/transaction/view/id/'+b+'">'+f+"</a>"}return a},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return this.renderLink(Ext.Date.format(d,"d/m/Y"),g,b,h,e,c,a)}});Ext.define("AL.view.client.GridBills",{extend:"AL.view.common.GridAllBills",alias:"widget.client_GridBills",title:"Facturas de compra",columnFilterConfig:{filtersToHide:["name"]}});Ext.define("AL.view.client.GridStatement",{extend:"Ext.grid.Panel",alias:"widget.client_GridStatement",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],minHeight:900,scroll:false,style:"min-width:100%;overflow:visible;height:100%;",border:true,cls:"grid-wallets grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false},plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterlayout:function(a){if(a.country==="republicaDominicana"){var b=Ext.dom.Query.select(".tooltip-dom");Ext.each(b,function(c){Ext.create("Ext.tip.ToolTip",{target:Ext.get(c),anchor:"top",html:"Los pagos a través de VisaNet solo pueden ser realizados a facturas en pesos dominicanos (DOP)."})})}}},initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"number",align:"center",flex:0.8},{header:translate("documentType",true),dataIndex:"documentType",flex:1.2,renderer:this.renderLink},{header:translate("creation",true),dataIndex:"date",flex:0.7,align:"center",renderer:this.renderDate},{header:translate("due",true),dataIndex:"dueDate",align:"center",flex:0.7,renderer:this.renderDueDate},{header:translate("overdueDays",true),align:"center",dataIndex:"overdueDays",flex:0.8,renderer:this.renderDays},{header:translate("status",true),align:"center",dataIndex:"status",flex:1,renderer:this.renderStatus},{header:translate("total",true),dataIndex:"total",align:"right",renderer:this.renderMoney,flex:1,sortable:false},{header:translate("amountPaid",true),dataIndex:"totalPaid",align:"right",renderer:this.renderMoney,flex:1,sortable:false},{header:translate("missingAmount",true),dataIndex:"missingAmount",align:"right",renderer:this.renderMoney,flex:1,sortable:false},{header:translate("actions",true),align:"center",type:"actions",filter:false,renderer:this.setActions,flex:this.canReceiveExternalPayments==="yes"?2.5:1,sortable:false},];if(this.country=="colombia"&&!this.user){this.columns[9].flex=1;this.columns.push({header:translate("pay",true),align:"center",renderer:this.setOnlinePayments,filter:false,type:"actions",flex:1.8})}this.viewConfig.emptyText='<style>.grid-wallets .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("messageWithoutResults",true)+"</div></div></div>";this.callParent(arguments)},setOnlinePayments:function(o,r,g,m,q,p,n){var b=g.get("idLocal"),j=g.get("type"),h=g.get("currency"),d=g.get("hasStamp"),a=n.up("client_GridStatement"),f=a.user,l=a.canReceiveExternalPayments,k=a.country,c=a.nequiState;var e='<div class="action-icons" style="height: 26px;">';if((k=="colombia"&&h==="COP")&&g.get("status")!=="closed"&&g.get("status")!=="checkingPayment"&&j==="invoice"){if(l==="yes"){e+='<a href="#" title="'+translate("pay",true)+'"><img style="max-height:100%" src="http://cdn1.getsoft.app/images/payu_btn.png" class="addInvoicePayment" name="pay" /></a>'}else{e+='<img style="max-height:100%" src="http://cdn1.getsoft.app/images/payu_btn.png" name="requestActivationOfOnlinePayments"  alt="Pagar" class="disabled" />'}if(c=="active"){e+='<a href="#" title="'+translate("pay",true)+'"><img style="max-height:100%" src="https://cdn1.getsoft.app/images/boton-nequi.png" class="addInvoicePayment" name="payWithNequi" data-idInvoice="'+b+'" /></a>'}else{e+='<img style="max-height:100%" src="https://cdn1.getsoft.app/images/boton-nequi.png" name="requestActivationOfOnlinePayments" alt="Pagar" class="disabled" />'}}else{if(Ext.Array.contains(["colombia"],k)){e+='<img style="max-height:100%;" src="http://cdn1.getsoft.app/images/payu_btn.png" alt="Pagar" class="disabled" />';e+='<img style="max-height:100%;" src="https://cdn1.getsoft.app/images/boton-nequi.png" alt="Pagar" class="disabled" />'}}e+="</div>";return e},setActions:function(o,r,g,m,q,p,n){var c=g.get("idLocal"),j=g.get("type"),h=g.get("currency"),d=g.get("hasStamp"),a=n.up("client_GridStatement"),f=a.user,l=a.canReceiveExternalPayments,k=a.country,b=a.url;if(j==="advance"){j="transaction"}var e='<div class="action-icons" style="height: 26px;">';if(f){e+='<a href="/'+j+"/view/id/"+c+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle"/></a>';e+='<a href="/'+j+"/print/id/"+c+'" title="Imprimir" target="_blank"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="Imprimir" class="printInvoice"></a>';if(j==="invoice"){e+='<a href="/transaction/in/number/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="Agregar Pago" class="addInvoicePayment"/></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="Agregar Pago" class="disabled"/>'}}else{e+='<a  href="" title="'+translate("notifyPayment",true)+'" ><img height="20" src="https://cdn1.getsoft.app/images/icons/bell.png" name="notification" /></a>';e+='<a href="/client/download-document/idDocument/'+c+"/documentType/"+j+b+'" title="'+translate("downloadPdf",true)+'" target="_blank"><img height="20" src="https://cdn1.getsoft.app/images/icons/ico_pdf.png" name="downloadDocument" alt="'+translate("downloadPdf",true)+'" /></a>';if((a.isActiveElectronicInvoicing&&Ext.Array.contains(["peru","colombia","costaRica"],k))||k==="mexico"){if(d=="yes"){e+='<a href="/client/download-xml/idDocument/'+c+"/documentType/"+j+b+'" title="'+translate("downloadXml",true)+'" target="_blank"><img height="20" src="https://cdn1.getsoft.app/images/icons/ico_xml.png" name="downloadXml" alt="'+translate("downloadXml",true)+'" /></a>'}else{e+='<img height="20" src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="'+translate("downloadXml",true)+'" class="disabled" />'}}if(l==="yes"&&k=="mexico"&&h==="MXN"&&g.get("status")!=="closed"&&g.get("status")!=="checkingPayment"&&j==="invoice"){e+='<a href="#" title="'+translate("pay",true)+'"><img style="width:100px" src="https://cdn1.getsoft.app/images/boton_pagar_payu.png" class="addInvoicePayment" name="pay" /></a>'}else{if(l==="yes"&&Ext.Array.contains(["mexico"],k)){e+='<img style="width:100px" src="https://cdn1.getsoft.app/images/boton_pagar_payu.png" alt="Pagar" class="disabled" />'}}if(l==="yes"&&((k=="republicaDominicana"&&h==="DOP"))&&g.get("status")!=="closed"&&g.get("status")!=="checkingPayment"&&j==="invoice"){e+='<a href="#" title="'+translate("pay",true)+'"><img src="https://cdn1.getsoft.app/images/boton_pagar_cybs.png" class="addInvoicePayment" name="payWithCybs" /></a>'}else{if(l==="yes"&&Ext.Array.contains(["republicaDominicana"],k)){e+='<img src="https://cdn1.getsoft.app/images/boton_pagar_cybs.png" alt="Pagar" class="disabled '+(h!=="DOP"&&g.get("status")==="open"?"tooltip-dom":"")+'" />'}}}e+="</div>";return e},renderStatus:function(e,h,b,c,g,f,d){var j="invoiceOpen",a=e;switch(e){case"open":a="unpaid";if(b.data.documentType=="transactionIn"){a=""}break;case"apply":a="unapplied";break;case"checkingPayment":j="transactionPending";break;case"closed":j="invoiceClosed";a="paid";break;case"void":j="invoiceVoid";a=translate("canceledMale",true);break}return'<span class="'+j+'">'+translate(a,true)+"</span>"},renderLink:function(h,l,d,f,k,j,g){var b=d.get("idLocal");var e=d.get("type");var c=g.up("client_GridStatement").user;if(e==="advance"){e="transaction"}var a="";if(h&&c){a='<a href="/'+e+"/view/id/"+b+'">'+translate(h,true)+"</a>"}else{if(h&&!c){a="<span>"+translate(h,true)+"</span>"}}return a},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderDueDate:function(f,g,b,h,e,c,a){if(!f){return""}var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderDays:function(f,g,c,h,e,d,b){var a="";if(f>0){a="class=overdue-date"}return"<span "+a+" >"+f+"</span>"}});Ext.define("AL.view.company.GridAllStampReceptionMails",{extend:"Ext.grid.Panel",alias:"widget.company_GridAllStampReceptionMails",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],minHeight:390,layout:"fit",store:"StampReceptionMails",width:1024,scroll:false,dockedItems:[{xtype:"pagingtoolbar",store:"StampReceptionMails"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:"Remitente",dataIndex:"fromName",align:"center",renderer:this.renderFromName,flex:3},{header:"Destinatario",dataIndex:"toAddress",align:"center",width:150},{header:"Asunto",dataIndex:"subject",align:"center",width:150},{header:"Mensaje",dataIndex:"message",align:"center",width:150,renderer:this.renderMessage},{header:"Fecha",dataIndex:"datetime",align:"center",width:130,renderer:this.renderDate},{header:"Acciones",type:"actions",align:"center",filter:false,sortable:false,renderer:this.setActions,width:150}];this.callParent(arguments)},renderLink:function(b,c,a){if(a.get("billIdLocal")&&b){b='<a href="/bill/view/id/'+a.get("billIdLocal")+'">'+b+"</a>"}return b},renderFromName:function(b,c,a){return b+" ("+a.get("fromAddress")+")"},setActions:function(f,j,b,c,h,g,d){var e=this.configs&&this.configs.country?this.configs.country:null;var a='<div class="action-icons">';a+='<a href="/stamp-reception-mail/view/id/'+b.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle" /></a>';if(e=="colombia"){a+='<a href="#"><title>Eliminar</title><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="deleteStampReceptionMail" /></a>'}a=a+"</div>";return a},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y H:i:s")},renderMessage:function(e,f,b,g,d,c,a){return Ext.util.Format.htmlEncode(e)}});Ext.define("AL.view.distributor.GridCompanies",{extend:"Ext.grid.Panel",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],dockedItems:[{xtype:"pagingtoolbar",store:"DistributorCompanies"}],columnFilterConfig:{},alias:"widget.distributor_GridCompanies",title:"Compañías referidas",scroll:true,layout:"fit",frame:true,minHeight:360,store:"DistributorCompanies",viewConfig:{stripeRows:true,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no hay usuarios referidos por tu cuenta!</div><div style="color: #aaa;font-size: 12px;">Recuerda compartir tu dirección única de registro</div></div></div>'},hiddenColumns:{},listeners:{afterrender:function(b){var a=b.getStore();a.load()}},initComponent:function(){this.columns=[{header:"Empresa",dataIndex:"name",flex:1},{header:"Fecha de registro",dataIndex:"registryDate",align:"center",width:110,renderer:this.renderDate},{header:"Plan",dataIndex:"planName",filter:false,align:"center",renderer:function(c,b,a){if(a.get("trialMode")=="yes"){return"Prueba"}else{return c}},width:110},{header:"Inicio de plan",dataIndex:"dateStart",filter:false,align:"center",width:110,renderer:this.renderDate},{header:"Vencimiento de <br />plan",width:115,align:"center",dataIndex:"dateEnd",filter:false,renderer:this.renderDate}];this.callParent(arguments)},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return(f)?Ext.Date.format(d,"d/m/Y"):""},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+="</div>";return b}});Ext.define("AL.controller.Distributor",{extend:"Ext.app.Controller",views:["distributor.GridCompanies"],stores:["DistributorCompanies"],models:["DistributorCompany"],init:function(){this.control({})}});Ext.define("AL.view.estimate.GridAll",{extend:"Ext.grid.Panel",alias:"widget.estimate_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],columnLines:true,store:"Estimate",title:translate("estimates",true),minHeight:400,width:1024,frame:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-credit-notes .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("exclamationSentence")+translate("youHaventCreatedYour",true)+" "+translate("firstEstimate")+" "+translate("estimate")+'!</div><div class="button-wrapper"><a href="/estimate/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newEstimate",true)+" "+translate("estimate")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Estimate"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(){var a=this.getStore();a.load()}},initComponent:function(){var a=[];switch(this.country){case"argentina":a.push({header:"Tipo",dataIndex:"subDocumentTypeLetter",width:50,align:"center !important",sortable:false});break}a=a.concat([{header:translate("number",true),dataIndex:"estimateNumber",renderer:this.linkCode,width:100,align:"center"},{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("creation",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:translate("total",true),dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("actions",true),align:"center",type:"estimateActions",renderer:this.setActions,width:105,filter:false,sortable:false}]);this.columns=a;this.callParent(arguments)},linkCode:function(e,f,b,g,d,c,a){return'<a href="/estimate/view/id/'+b.get("idLocal")+'">'+b.get("estimateNumber")+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/estimate/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(g,k,d,e,j,h,f){var a=d.get("idLocal");var b=d.get("canPrintOrDownload");var c='<div class="action-icons">';c+='<a href="/estimate/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(b){c+='<a target="_blank" href="/estimate/print/id/'+d.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" title="'+translate("print",true)+'" class="printEstimate"></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}if(d.get("editable")){c+='<a href="/estimate/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled"/>'}if(d.get("deletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteEstimate"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled"/>'}c+="</div>";return c},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.client.GridEstimates",{extend:"AL.view.estimate.GridAll",alias:"widget.client_GridEstimates"});Ext.define("AL.view.item.GridEstimates",{extend:"AL.view.estimate.GridAll",alias:"widget.item_GridEstimates"});Ext.define("AL.view.history.GridAllHistory",{extend:"Ext.grid.Panel",alias:"widget.history_GridAllHistory",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.DynamoDbPaging",],columnLines:true,store:"HistoryGridAll",title:"Historial",minHeight:300,scroll:true,frame:true,dockedItems:[{xtype:"dynamodbpagingtoolbar",store:"HistoryGridAll"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(){var a=this.getStore();a.load()}},initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"datetime",align:"center",width:120,renderer:this.renderDate},{header:"Detalle",dataIndex:"resourceTitle",flex:2,sortable:false,filter:true,renderer:this.renderDetail},{header:"Usuario",dataIndex:"userEmail",sortable:false,filter:true,flex:1}];this.callParent(arguments)},renderDetail:function(f,j,c,d,h,g,e){var a=c.get("url");var b="";if(f){if(a){b='<a href = "'+a+'">'+f+"</a>"}else{b=f}}return b},renderDate:function(f,j,c,d,h,g,e){f=f.replace(/-/g,"/");var b=new Date(f);var a=Ext.Date.format(b,"d/m/Y H:i");return a}});Ext.define("AL.controller.History",{extend:"Ext.app.Controller",views:["history.GridAllHistory"],models:["UserHistory"],stores:["HistoryGridAll"],init:function(){this.control()}});Ext.define("AL.view.invoice.GridAllGlobalInvoices",{extend:"Ext.grid.Panel",alias:"widget.invoice_GridAllGlobalInvoices",title:translate("invoice",true),requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,minHeight:390,border:true,frame:false,store:"GlobalInvoices",columnLines:true,cls:"grid-invoices grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""}},hiddenColumns:{},dockedItems:[{xtype:"pagingtoolbar",store:"GlobalInvoices"}],columnFilterConfig:{},listeners:{afterrender:function(b){var a=b.getStore();if(!a.isLoading()&&!a.hasLoaded()){var c=b.configs&&b.configs.parentGridAutoLoad===false?false:true;if(c){a.load()}}}},initComponent:function(){var b="";var a=170;if(this.country==="mexico"){b="-440px";a=190}else{b="-395px"}this.columns=[{header:translate("number",true),dataIndex:"number",renderer:this.linkCode,width:70,align:"center"},{header:"Creación",dataIndex:"date",flex:1,align:"center",renderer:this.renderDate,hidden:this.hiddenColumns.date},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,flex:2,sortable:false,hidden:this.hiddenColumns.total},{header:"Estado",dataIndex:"status",align:"center",flex:3,renderer:this.renderStatus,hidden:this.hiddenColumns.status},{header:"Acciones",align:"center",type:"invoiceActions",filter:false,renderer:this.setActions,width:a,sortable:false,hidden:this.hiddenColumns.actions,rsDisable:true,html:'<a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/206509865"><div class="tooltip-wrapper" style="margin-left:'+b+'; margin-top:-15px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"></div></a>'}];var c="/global-invoice/add";this.viewConfig.emptyText='<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has creado tu primera '+translate("globalInvoice")+'!</div><div class="button-wrapper"><a href="'+c+'" class="button green"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newGlobalInvoice",true)+"</a></div></div></div>";this.callParent(arguments)},linkCode:function(f,g,b,h,d,c,a){var e="";e='<a href="/global-invoice/view/id/'+b.get("idLocal")+'">'+b.get("invoiceNumber")+"</a>";return e},linkClient:function(e,f,b,g,d,c,a){return'<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderStatus:function(c,d,b){var a=b.get("uuid")&&b.get("uuid")!==""?"Timbrada":"Por timbrar";switch(c){case"draft":a="Borrador";break;case"void":a="Cancelada";break}return a},setActions:function(j,m,f,g,l,k,h){var d=f.get("invoiceNumber");var c=f.get("idLocal");var b=h.up("grid");var e='<div class="action-icons">';e+='<a href="/global-invoice/view/id/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle"/></a>';var a=f.get("uuid");if(a){e+='<a href="/global-invoice/print/id/'+c+'" target="_blank" title="Imprimir"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="Imprimir" class="printInvoice"></a>';e+='<a href="/global-invoice/generate-xml/id/'+c+'" title="Descargar XML"><img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="Descargar XML" class="downloadXml"></a>';e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="Convertir a abierta y timbrar" class="disabled"/>';e+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar" class="disabled"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="Imprimir" class="printInvoice disabled">';e+='<img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="Descargar XML" class="disabled">';if(f.get("status")==="open"){e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" title="Timbrar" class="openGlobalInvoice"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" title="Convertir a abierta y timbrar" class="openGlobalInvoice"/>'}e+='<a href="/global-invoice/edit/id/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar" title="Editar"/></a>'}if(f.get("voidable")){e+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="voidGlobalInvoice"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="disabled voidGlobalInvoice"/>'}if(f.get("deletable")){e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="deleteGlobalInvoice"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="disabled deleteGlobalInvoice"/>'}e+="</div>";return e},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.inventoryadjustment.GridAll",{extend:"Ext.grid.Panel",alias:"widget.inventoryadjustment_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:"",scroll:true,frame:true,minHeight:390,layout:"fit",store:"InventoryAdjustments",cls:"grid-items grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-items .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("inventoryAdjustment")})+'</div><div class="button-wrapper"><a href="/inventory-adjustment/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newM",true)+" "+translate("inventoryAdjustment")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"InventoryAdjustments"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(b){var a=b.getStore();a.remoteSort=true;if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"idLocal",flex:1,width:100,sortable:true,renderer:this.renderLink},{header:translate("date",true),dataIndex:"date",flex:1,align:"center",renderer:this.renderDate},{header:translate("warehouse",true),dataIndex:"warehouseName",flex:2},{header:translate("adjustedTotal",true),dataIndex:"totalCost",flex:1,renderer:this.renderMoney,align:"right",filter:true,sortable:false},{header:translate("observations",true),dataIndex:"observations",width:100,flex:4},{header:translate("actions",true),align:"center",type:"inventoryAdjustmentActions",renderer:this.setActions,width:125,filter:false,sortable:false}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/inventory-adjustment/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';if(c.get("editable")){b+='<a href="/inventory-adjustment/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="editInventoryAdjustment" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteInventoryAdjustment" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/inventory-adjustment/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)}});Ext.define("AL.controller.InventoryAdjustment",{extend:"Ext.app.Controller",views:["inventoryadjustment.BottomContainer","inventoryadjustment.FormInventoryAdjustment","inventoryadjustment.InventoryFormAddItem","inventoryadjustment.GridAll"],stores:["InventoryAdjustments","WarehouseCombo","ItemsCombo"],models:["InventoryAdjustment","Warehouse"],itemCount:0,totalCost:null,selectedItems:[],oldValueItem:null,init:function(){this.application.addListener("deleteAdjustment",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("inventoryAdjustment")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("this")+" "+translate("inventoryAdjustment")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/inventory-adjustment/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("warehouseCreatedInventoryAdjustment",function(c){var d=c.initiator;var a=c.record;var b=d.getStore();b.add(a);d.select(a.get("idLocal"));d.fireEvent("select",d)},this);this.control({"inventoryadjustment_BottomContainer button[action=save]":{click:this.saveInventoryAdjustment},"inventoryadjustment_BottomContainer button[action=cancel]":{click:function(){window.location="/inventory-adjustment"}},"inventoryadjustment_InventoryFormAddItem combo[name=idItem]":{beforerender:function(g){var e=g.up("form");var f=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var c=Ext.create("AL.store.ItemsCombo",{proxy:{type:"cacheajax",url:"/item/retrieve-all-inventariable/format/json",cacheName:"ItemsCombo",forceRequest:true,reader:{type:"json",root:"results"}}});var b=c.getProxy();var a=f.down("combo[name=idWarehouse]");var h=null;if(a.getValue()){if(typeof a.getValue()=="string"){h=a.getValue()}else{h=a.getValue().get("idLocal")}b.extraParams={idWarehouse:h};g.store=c;c.load()}else{var d=a.getStore();d.on("load",function(){var j=d.findRecord("isMain","yes");h=j.get("idLocal");b.extraParams={idWarehouse:h};g.store=c;c.load()})}if(!f.configs.showWarehouses){f.down("combo[name=idWarehouse]").hide()}},change:function(c,b,a){if(b!=this.oldValueItem&&typeof b==="number"&&!this.isItemSelectedPrevious(b)){var d=this.oldValueItem;this.selectedItems=this.selectedItems.filter(function(g,f,e){return g!=d})}},focus:function(a){this.oldValueItem=null;if(typeof a.getValue()==="number"){this.oldValueItem=a.getValue()}},blur:function(d){if(typeof d.getValue()!=="number"){var b=d.up("form");var e=b.down("displayfield[name=availableQuantity]");var a=b.down("textfield[name=cost]");var c=b.down("numberfield[name=quantity]");var f=this.oldValueItem;this.selectedItems=this.selectedItems.filter(function(j,h,g){return j!=f});this.oldValueItem=null;a.setValue(0);e.setValue(0);c.setValue(0);this.updateFields(d)}},afterrender:function(b){var g=b;var c=g.store;var e=g.getPicker();if(e.pagingToolbar.items.keys){var j=e.pagingToolbar.items.keys;for(var d=0;d<j.length;d++){if(j[d]=="next"||j[d]=="refresh"||j[d]=="displayItem"){continue}if(e.pagingToolbar.down("#"+j[d])){e.pagingToolbar.down("#"+j[d]).hide()}}}var f=e.pagingToolbar.down("#displayItem"),a=e.pagingToolbar.down("#next"),h=e.pagingToolbar.down("#refresh");if(h){h.addCls("combo-item-btn-refresh");h.on("click",function(k){c.clearOnPageLoad=false})}if(a){a.addCls("combo-item-btn-next");a.on("click",function(k){c.clearOnPageLoad=false})}if(f){f.addCls("combo-item-display-msg")}c.on("load",function(m,l,n){if(f){var k=m.getTotalCount();var q=1;var p=Math.min(m.currentPage*c.pageSize,k);var o=Ext.String.format("Mostrando {0} - {1} de {2}",q,p,k);f.setText(o)}c.clearOnPageLoad=true})},beforequery:function(e,c){var d=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var f=e.combo;if(!f){return}var b=f.getRawValue();if(b){var a=f.getStore();a.load({params:{query:b},callback:function(){}})}},render:function(c){var a=c.up("form");var b=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];if(a.idItem&&typeof a.idItem=="number"){Ext.Ajax.request({url:"/item/retrieve-one/id/"+a.idItem+"/format/json",success:function(e,g){var h=Ext.decode(e.responseText);if(h.success){var f=h.results;var d=Ext.create("AL.model.Item",f);if(c.store.isLoading()){c.store.on("load",function(){c.store.insert(0,d);c.select(d)})}else{c.store.insert(0,d);c.select(d)}}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})}},select:function(s,o,a){var d=o[0];var b=s.up("form");var m=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var g=b.down("textfield[name=cost]");var l=b.down("displayfield[name=availableQuantity]");var j=b.down("numberfield[name=quantity]");var p=b.down("displayfield[name=finalQuantity]");var r=b.down("textfield[name=cost]");var q=b.down("displayfield[name=totalCost]");var f=b.down("combo[name=type]");var u=b.down("#imageContent");var e="";var k=m.down("combo[name=idWarehouse]");if(typeof k.getValue()=="string"){e=k.getValue()}else{e=k.getValue().get("idLocal")}var h=m.down("datefield[name=date]");var c="";if(h){c="/date/"+Ext.Date.format(h.getValue(),"Y-m-d")}var n=d.get("idLocal");var t=this;if(!this.isItemSelectedPrevious(n)){this.selectedItems.push(n);this.oldValueItem=n;Ext.Ajax.request({url:"/item/retrieve-for-adjustment/id/"+n+"/format/json/idWarehouse/"+e+c,success:function(v,x){var y=Ext.decode(v.responseText);if(y.success){var w=y.results;g.setValue(w.averageCost);l.setValue(w.availableQuantity);if(w.image){u.update('<div class="inventory-thumbnail-content"><img src="'+w.image+'" alt="" class="inventory-adjustment-thumbnail" /></div>')}else{u.update('<svg fill="rgba(197, 208, 222, 1)" xmlns="http://www.w3.org/2000/svg" width="44" height="44"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#priceTag"></use></svg>')}t.updateFields(s)}else{GlobalMsg.showErrorMessage("Error",y.cause)}},failure:function(){}})}else{if(this.oldValueItem==n){s.setValue(this.oldValueItem)}else{s.setValue(this.oldValueItem);GlobalMsg.showErrorMessage("Error","No puedes selecionar más de una vez el mismo "+translate("item"))}}}},"inventoryadjustment_InventoryFormAddItem numberfield[name=quantity]":{change:this.updateFields},"inventoryadjustment_InventoryFormAddItem combo[name=type]":{change:this.updateFields},"inventoryadjustment_InventoryFormAddItem textfield[name=cost]":{change:this.updateFields},"inventoryadjustment_InventoryFormAddItem button[action=deleteItem]":{click:function(b){var c=b.up("form");var a=c.down("combo[name=idItem]");if(a){var d=a.getValue();this.selectedItems=this.selectedItems.filter(function(g,f,e){return g!=d})}b.up("form").destroy();this.updateTotal()}},inventoryadjustment_FormInventoryAdjustment:{render:this.initialize,afterrender:function(a){totalCost=Ext.ComponentQuery.query("#inventory-total-cost")[0]}},"inventoryadjustment_GridAll gridcolumn[type=inventoryAdjustmentActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteInventoryAdjustment")){h.preventDefault();l.fireEvent("deleteAdjustment",{record:c,initiator:a})}}},"inventoryadjustment_FormInventoryAdjustment datefield[name=date]":{change:function(e,c,a){if(c!=a){var l=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var g=Ext.ComponentQuery.query("inventoryadjustment_InventoryFormAddItem");var f="/date/"+Ext.Date.format(c,"Y-m-d");var j="";var h=this;var k="";var d=l.down("combo[name=idWarehouse]");if(typeof d.getValue()=="string"){k=d.getValue()}else{k=d.getValue().get("idLocal")}if(l.edit){var b=l.down("hidden[name=idLocal]");if(b){j="/idInventoryAdjustment/"+b.getValue()}}Ext.each(g,function(n){var m=n.getValues();if(m.idItem){Ext.Ajax.request({url:"/item/retrieve-for-adjustment/id/"+m.idItem+"/format/json/idWarehouse/"+k+j+f,success:function(o,q){var r=Ext.decode(o.responseText);if(r.success){var p=r.results;n.down("displayfield[name=availableQuantity]").setValue(p.availableQuantity);h.updateFields(n.down("combo[name=idItem]"))}else{GlobalMsg.showErrorMessage("Error",r.cause)}},failure:function(){}})}})}}},"inventoryadjustment_FormInventoryAdjustment combo[name=idWarehouse]":{afterrender:function(c){var b=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var a=c.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load({callback:function(){if(!b.edit){var d=a.findRecord("isMain","yes");if(d){c.select(d)}}}})}},beforeselect:function(d,a,b){var c=this;if(c.hasItemSelected()){Ext.Msg.show({title:"",msg:translate("byPerformingThisAction",true)+" "+translate("youWillHaveToChooseAgainTheAssociatedProducts")+". <br>"+translate("wouldYouLikeToContinue",true),buttons:Ext.Msg.YESNO,buttonText:{yes:translate("cancelAction",true),no:translate("changeDocument",true,{document:translate("warehouse")})},fn:function(e){if(e=="no"){c.refreshForm(d,a)}},closable:false})}else{c.refreshForm(d,a)}return false}}})},isItemSelectedPrevious:function(a){return this.selectedItems.indexOf(a)!=-1},saveInventoryAdjustment:function(e){var c=Ext.ComponentQuery.query("inventoryadjustment_InventoryFormAddItem");var b=[];var f=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];e.disable();var d="/inventory-adjustment/add/format/json";if(f.edit){d="/inventory-adjustment/edit/format/json"}GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("inventoryAdjustment")});Ext.each(c,function(h){var g=h.getValues();if(g.idItem){b.push(g)}});var a=f.getValues();a.items=Ext.encode(b);if(c.length>0){if(f.getForm().isValid()&&c[0].getForm().isValid()){Ext.Ajax.request({url:d,method:"POST",timeout:120000,params:a,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){window.location="/inventory-adjustment/view/id/"+j.id}else{GlobalMsg.showErrorMessage("Error",j.cause);e.enable();GlobalRedirector.close()}},failure:function(g){var h=Ext.decode(g.responseText);GlobalMsg.showErrorMessage("Error",h.cause);e.enable();GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"});e.enable();GlobalRedirector.close()}}else{GlobalMsg.showNotification({title:"Error",text:"Debes ingresar al menos un "+translate("item"),type:"error"});e.enable();GlobalRedirector.close()}},updateFields:function(j){var b=j.up("form");var k=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var e=b.down("textfield[name=cost]");var f=b.down("displayfield[name=availableQuantity]");var d=b.down("numberfield[name=quantity]");var l=b.down("displayfield[name=finalQuantity]");var c=b.down("textfield[name=cost]");var a=b.down("displayfield[name=totalCost]");var h=b.down("hidden[name=totalCostNumber]");var g=b.down("combo[name=type]");if(d.isValid()&&f.isValid()){h.setValue(AL.math.approx(AL.math.mul(d.getValue(),e.getValue()),null,k.configs.decimalPrecision));if(g.getValue()=="in"){l.setValue(AL.math.approx(AL.math.add(f.getValue(),d.getValue()),null,2));a.setValue(Ext.util.Format.usMoney(h.getValue(),k.configs.decimalPrecision,k.configs.currencySymbol))}else{l.setValue(AL.math.approx(AL.math.sub(f.getValue(),d.getValue()),null,2));a.setValue(Ext.util.Format.usMoney(-1*h.getValue(),k.configs.decimalPrecision,k.configs.currencySymbol))}}this.updateTotal()},updateTotal:function(){var c=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var b=Ext.get("inventory-total-cost");var a=Ext.ComponentQuery.query("inventoryadjustment_InventoryFormAddItem");var d=0;if(b){Ext.each(a,function(f){var e=f.down("hidden[name=totalCostNumber]");var g=f.down("combo[name=type]");if(g.getValue()=="out"){d=AL.math.approx(AL.math.sub(d,e.getValue()),null,2)}else{d=AL.math.approx(AL.math.add(d,e.getValue()),null,2)}})}b.dom.innerHTML=Ext.util.Format.usMoney(d,c.configs.decimalPrecision,c.configs.currencySymbol)},initialize:function(b){var a=this;var c=Ext.get("addOtherItem");c.on("click",function(){this.addItemForm()},this);if(!b.configs.showWarehouses){b.down("combo[name=idWarehouse]").hide()}if(b.edit){Ext.Ajax.request({url:"/inventory-adjustment/retrieve-one/id/"+b.idLocal+"/format/json",success:function(j,n){var p=Ext.decode(j.responseText);if(p.success){var k=p.results;var g=AL.date(k.date);g=Ext.Date.format(g,"d/m/Y");var q=b.down("hidden[name=idLocal]");var f=b.down("datefield[name=date]");var d=b.down("textarea[name=observations]");var e=b.down("combo[name=idWarehouse]");var m=Ext.ComponentQuery.query("#addItemPanel")[0];q.setValue(b.idLocal);d.setValue(k.observations);f.setRawValue(g);var h=Ext.create("AL.store.ItemsCombo");var o=h.getProxy();if(k.warehouse&&k.warehouse.idLocal){var r=e.getStore();if(!r.hasLoaded()&&!r.isLoading()){r.on("load",function(){var t=Ext.create("AL.model.Warehouse",k.warehouse);r.add(t);e.select(t)})}else{var l=Ext.create("AL.model.Warehouse",k.warehouse);r.add(l);e.select(l)}}if(m){var s=b.configs.decimalPrecision?b.configs.decimalPrecision:2;Ext.each(k.items,function(B){var A=Ext.create("AL.view.inventoryadjustment.InventoryFormAddItem",{idItem:B.idItem,canCreateNewWarehouse:"true",canCreateNewItem:"true",});var u=A.down("combo[name=idItem]");var x=A.down("displayfield[name=availableQuantity]");var z=A.down("combo[name=type]");var w=A.down("numberfield[name=quantity]");var v=A.down("textfield[name=cost]");var t=A.down("#imageContent");if(B.image){t.update('<div class="inventory-thumbnail-content"><img src="'+B.image+'" alt="" class="inventory-adjustment-thumbnail" /></div>')}else{t.update('<svg fill="rgba(197, 208, 222, 1)" xmlns="http://www.w3.org/2000/svg" width="44" height="44"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#priceTag"></use></svg>')}var y=Ext.create("AL.model.Item",B);u.store=h;u.setValue(B.idItem);if(B.type=="in"){x.setValue(AL.math.approx(AL.math.sub(B.itemAvailableQuantity,B.quantity),null,2))}else{x.setValue(AL.math.approx(AL.math.add(B.itemAvailableQuantity,B.quantity),null,2))}z.setValue(B.type);w.setValue(B.quantity);v.setValue(AL.math.approx(B.cost,null,s));a.selectedItems.push(B.idItem);m.add(A)})}}},failure:function(){}})}},addItemForm:function(){var b=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var c=Ext.create("AL.view.inventoryadjustment.InventoryFormAddItem",{idItem:"null",itemCount:++this.itemCount,canCreateNewWarehouse:b.configs.canCreateNewWarehouse,canCreateNewItem:b.configs.canCreateNewItem});a.add(c)},hasItemSelected:function(){var b=Ext.ComponentQuery.query("inventoryadjustment_InventoryFormAddItem");var a=[];Ext.each(b,function(d){var c=d.getValues();if(c.idItem){a.push(c);return}});return a.length>0},refreshForm:function(g,b){var f=g.up("form");f=f.up("form");var a=Ext.ComponentQuery.query("inventoryadjustment_InventoryFormAddItem");var c=Ext.ComponentQuery.query("#addItemPanel")[0];for(var d=a.length;d>=0;d--){c.remove(a[d],true)}var e=Ext.get("inventory-total-cost");e.dom.innerHTML=Ext.util.Format.usMoney(0,f.configs.decimalPrecision,f.configs.currencySymbol);g.setValue(b.data.idLocal);this.selectedItems=[];this.addItemForm()}});Ext.define("AL.view.item.GridBills",{extend:"AL.view.common.GridAllBills",alias:"widget.item_GridBills",title:"Facturas de compra"});Ext.define("AL.view.itemCategory.GridAll",{extend:"Ext.grid.Panel",alias:"widget.itemCategory_GridAll",title:translate("itemCategories",true),requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,minHeight:390,width:1024,border:true,store:"ItemCategories",frame:true,columnLines:true,cls:"grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstCategoryYet",true)+'!</div><div class="button-wrapper"><a href="/item-category/add" class="button green"><span class="plus"></span>'+translate("newCategoryItem",true)+"</a></div></div></div>",getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""}},dockedItems:[{xtype:"pagingtoolbar",store:"ItemCategories"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes"};if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){this.columns=[{header:translate("itemCategoryName",true),dataIndex:"name",flex:2,renderer:this.renderLink},{header:translate("description",true),dataIndex:"description",flex:4},{header:translate("actions",true),align:"center",type:"itemCategoriesActions",renderer:this.setActions,flex:1,width:80,rsDisable:true,filter:false,sortable:false,}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/item-category/view/id/'+a+'" title="'+translate("seeDetail",true)+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';if(c.get("editable")){b+='<a title="'+translate("edit",true)+'" href="/item-category/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img title="'+translate("edit",true)+'" src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("status")==="active"){b+='<a title="'+translate("deactivate",true)+'" href="#"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleItemCategoryStatus "/></a>'}else{if(c.get("status")==="inactive"){b+='<a title="'+translate("activate",true)+'"  href="#"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="disabled toggleItemCategoryStatus" /></a>'}}if(c.get("deletable")){b+='<a title="'+translate("delete",true)+'" href="/item-category/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="deleteItemCategory"/></a>'}else{b+='<img title="'+translate("delete",true)+'" src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="disabled deleteItemCategory" />'}b+="</div>";return b},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/item-category/view/id/'+b+'">'+f+"</a>"}return a},});Ext.define("AL.controller.ItemCategory",{extend:"Ext.app.Controller",views:["itemCategory.GridAll","itemCategory.FormAdd","buttons.modern.CancelSave","itemCategory.FormImage","itemCategory.MoreActionsButton"],stores:["ItemCategories",],models:["ItemCategory",],itemCategories:{},init:function(){this.application.addListener("deleteItemCategory",function(a){this.deleteItemCategory(a)},this);this.application.addListener("toggleItemCategoryStatus",function(a){this.updateItemCategoryStatus(a)},this);this.control({itemCategory_FormAdd:{afterrender:this.initialize,},"itemCategory_FormAdd button[action=save]":{click:function(a){var c=this;var b=a.up("form");var d=false;b.getForm().findField("name").setValue(b.getValues().name.trim());if(b.isValid()){Ext.each(b.itemCategories,function(e){if(e.name.toLowerCase().trim()==b.getValues().name.toLowerCase()){d=true;return false}});if(d){Ext.Msg.show({title:translate("duplicatedItemCategory",true),msg:b.type=="edit"?translate("anItemCategoryWithTheSameNameExistEdit",true):translate("anItemCategoryWithTheSameNameExist",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){c.saveCategory(b)}}})}else{c.saveCategory(b)}}}},"itemCategory_FormAdd box[name=itemCategoryImageBox]":{render:function(b){var a=b.up("form");this.promptFileUploadWindowOnClick(b,"fileUrl",{asyncUpload:true,title:translate("categoryItemImage",true),url:"/file/upload/format/json",fieldName:"file",fieldLabel:translate("file",true),buttonText:translate("selectSimple",true),forceUploadEmptyResource:true,hideFileSuccessMessage:true},function(c){var e=a.down("hidden[name=idImageFile]");e.setValue(c.idResource);var d=a.getValues();url="/item-category/edit-image/format/json";d.idLocal=a.idLocal;if(a.idImageFile){d.idImageFile=a.idImageFile}Ext.Ajax.request({url:url,params:d})})}},"itemCategory_FormImage box[name=imageBox]":{render:function(b){var a=b.up("form");this.promptFileUploadWindowOnClick(b,"fileUrl",{asyncUpload:true,title:translate("categoryItemImage",true),url:"/file/upload/format/json",fieldName:"file",fieldLabel:translate("file",true),buttonText:translate("selectSimple",true),forceUploadEmptyResource:true,hideFileSuccessMessage:true,},function(c){var d=a.getValues();url="/item-category/edit-image/format/json";d.idLocal=a.idLocal;d.idImageFile=c.idResource;if(a.idImageFile){d.idImageFile=a.idImageFile}Ext.Ajax.request({url:url,params:d})})}},"itemCategory_GridAll gridcolumn[type=itemCategoriesActions]":{click:function(a,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=a.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteItemCategory")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteItemCategory",{record:d,initiator:a})}else{var b=translate("theItemCategoryCanNotBeDeleted",true);var a=a.up("grid");GlobalMsg.showNotification({title:translate("remember",true),text:b,type:"notice"})}}if(f.hasCls("toggleItemCategoryStatus")){k.preventDefault();m.fireEvent("toggleItemCategoryStatus",{record:d,initiator:a})}}},"menuitem[action=toggleStatusItemCategory]":{click:function(b){var c=b.up("splitbutton");var a={};a.idLocal=c.idType;a.menuItem=b;this.application.fireEvent("toggleItemCategoryStatus",a)}},"menuitem[action=deleteItemCategory]":{click:function(b){var c=b.up("splitbutton");var a={};a.idLocal=c.idType;a.menuItem=b;this.application.fireEvent("deleteItemCategory",a)}},"item_GridAll[name=itemGridInCategories]":{beforerender:function(b){var c=b.idLocalCategoryItem;var a=b.getStore();a.setProxy({type:"ajax",url:"/item/retrieve-all-by-item-category/format/json/id/"+c,reader:{type:"json",root:"results"}})}},boundlist:{containerclick:function(c,b){var d=Ext.ComponentQuery.query("item_FormAdd")[0];if(b.target.getAttribute("data-action")=="quickNewItemCategory"){b.preventDefault();if(d.emergent){window.open("/item-category/add","_blank");return}var a=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-tax-modal",reason:"addNewItemCategory",title:translate("createNewCategoryItem",true),border:false,resizable:false,width:650,height:400,bodyStyle:"overflow-y: auto;",bodyPadding:"0 5px 0 5px",items:[{xtype:"container",style:"position: relative;",id:"createNewTax",items:[{xtype:"container",id:"addTax",items:[{xtype:"itemCategory_FormAdd",style:"margin-bottom: 0px;",isWindow:true,bodyPadding:0,isEmergent:true,title:"",configs:d.configs,emergent:true,height:300,callback:function(f){a.close();var g=Ext.ComponentQuery.query("item_FormAdd combo[name=idItemCategory]")[0];var e=g.getStore();e.load({callback:function(){var h=e.findRecord("idLocal",f.idLocalItemCategory);g.select(h)}})}}]},]}],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),cls:"button main-button",handler:function(e){var g=e.up("window");var f=g.down("button[action=save]");if(f){f.fireEvent("click",f)}},listeners:{afterrender:function(e){var g=e.up("window");var f=g.down("form");e.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){e.setDisabled(!h)})}}}]},listeners:{afterrender:function(f){var e=f.down("button[action=save]");var g=f.down("buttons_modern_Cancel");if(e){e.hide()}if(g){g.hide()}}}})}}}})},initialize:function(b){var a=Ext.create("AL.LoadMask",{target:b,msg:translate("loading",true)});b.on("afterrender",function(){a.show()});a.show();a.addDependantTask();Ext.Ajax.request({url:"/item-category/retrieve-all/format/json",success:function(c){var g=Ext.decode(c.responseText);var e=g.results;b.itemCategories=e;if(b.type&&b.type=="edit"){var h=b.down("hidden[name=idLocal]");var d=b.down("textfield[name=name]");var f=b.down("textarea[name=description]");Ext.Ajax.request({url:"/item-category/retrieve-one/id/"+b.idLocal+"/format/json",success:function(k){var m=Ext.decode(k.responseText);var l=m.results;h.setValue(l.idLocal);d.setValue(l.name);f.setValue(l.description);a.endDependantTask();if(l.image){var j=b.down("box[name=itemCategoryImageBox]");j.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;" onselectstart="return false;"><img src="'+l.image.url+'" style="margin: 0 auto; max-height: 220px; max-width: 240px" /></div></div>')}b.itemCategories=b.itemCategories.filter(function(n){return n.name!=l.name})}})}else{a.endDependantTask()}}})},saveCategory:function(c){var b="/item-category/add/format/json";var a=c.isEmergent;if(c.type&&c.type==="edit"){b="/item-category/edit/format/json"}c.submit({url:b,waitMsg:translate("saving",true),success:function(g,e){var d=e.response;var f=Ext.decode(d.responseText);if(f.success){if(a){c.callback(f)}else{window.location="/item-category"}}else{GlobalMsg.showErrorMessage("Error",f.cause,"no")}}})},updateItemCategoryStatus:function(e){var f;var a=Ext.dom.Query.select(".content-area")[0];var d=Ext.create("AL.LoadMask",{target:a,msg:translate("loading")});if(e.idLocal){var c=e.menuItem;f=e.idLocal;d.show()}else{f=e.record.data.idLocal}if(e.initiator){var b=e.initiator}Ext.Ajax.request({url:"/item-category/toggle-status/format/json",method:"POST",params:{id:f},success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){if(b){var g=b.getStore();g.load()}else{if(c){d.hide();c.setText((c.text==translate("activate",true)?translate("deactivate",true):translate("activate",true)))}}}else{if(k.cause){GlobalMsg.showErrorMessage("Error",k.cause)}}},failure:function(){}})},deleteItemCategory:function(f){var b=f.record;if(f.initiator){var d=f.initiator}var g="";var c=false;if(b){g=b.get("idLocal")}else{g=f.idLocal;c=true;var a=Ext.dom.Query.select(".content-area")[0];var e=Ext.create("AL.LoadMask",{target:a,msg:translate("loading")});e.show()}Ext.Msg.show({title:translate("delete",true)+" "+translate("categoryItem"),msg:translate("areYouSureYouWantToDeleteTheCategory",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/item-category/delete/format/json",method:"POST",params:{id:g},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){if(c){window.location="/item-category"}else{if(d){var j=d.getStore();j.load()}}}else{if(m.cause){if(e){e.hide()}var n=m.cause;GlobalMsg.showNotification({title:translate("errorTitle",true),text:n,type:"error"})}}},failure:function(){}})}}})},promptFileUploadWindowOnClick:function(b,a,e,d){var c=false;b.getEl().on("click",function(g,k){if(c){return}c=true;var j=false;var f=b.getEl().getHTML();var h=Ext.create("AL.view.company.FileUploadWindow",{asyncUpload:e.asyncUpload,title:e.title,url:e.url,fieldName:e.fieldName,fieldLabel:e.fieldLabel,buttonText:e.buttonText,helpText:e.helpText,forceUploadEmptyResource:true,hideFileSuccessMessage:true,attachmentType:"item-category-gallery",height:170,onSubmit:function(l,m){j=true;Ext.create("Ext.fx.Anim",{target:l,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){l.close()}});Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){b.update('<div class="form-add-invoice-image-zone-loading" style="width: 240px; height: 220px;"></div>');Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(m,l,n){c=false;Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var o=new Image;o.onload=function(r){var q=(o.width*Math.min(b.configs.maxHeight,o.height))/o.height;var p="";if(q<b.configs.maxWidth){p="width: auto; max-height: "+b.configs.maxHeight+"px;"}else{p="height: auto; max-width: "+b.configs.maxWidth+"px;"}b.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;"  onselectstart="return false;"><img src="'+l[a]+'" style="margin: 0 auto; '+p+'" /></div></div>');if(d){d(l)}Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})};o.src=l[a]}})},onFailure:function(m,l,o){c=false;Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){b.update(f);Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof l=="string"||!l.cause){Ext.MessageBox.alert("Error","Ha ocurrido un error. Lo resolveremos lo más pronto posible")}else{var n=l.title?l.title:"Error";Ext.MessageBox.alert(n,l.cause)}},onClose:function(l){if(!j){c=false}}});h.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:h,duration:300,from:{opacity:0},to:{opacity:1}})},b)},});Ext.define("AL.view.journal.GridAll",{extend:"Ext.grid.Panel",alias:"widget.journal_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],minHeight:390,width:1024,border:true,frame:true,title:translate("journal",true),columnLines:true,scroll:true,store:"Journals",dockedItems:[{xtype:"pagingtoolbar",store:"Journals"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],viewConfig:{stripeRows:true,emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("journal")})+'</div><div class="button-wrapper"><a href="/journal/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newJournal",true)+'</a> <a href="/journal/add-opening-balance" class="button basic"><svg class="icon small"><use xlink:href="/images/smile-icons.svg#accounting"></use></svg>'+translate("newBtnInitialBalance",true)+"</a></div></div></div>"},listeners:{afterrender:function(){var a=this.getStore();a.remoteSort=true;if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){var a=[{header:translate("number",true),dataIndex:"idLocal",renderer:this.renderLink,},{header:translate("date",true),dataIndex:"date",renderer:this.renderDate},{header:translate("reference",true),dataIndex:"reference"},{header:translate("observations",true),dataIndex:"observations",flex:1.5},{header:"Total",dataIndex:"amount",renderer:this.renderMoney,align:"right",sortable:false},{header:translate("actions",true),align:"center",type:"journalActions",renderer:this.setActions,width:80,sortable:false}];if(this.configs&&this.configs.country==="peru"){a.splice(5,0,{header:translate("status",true),dataIndex:"status",flex:0.5,renderer:this.renderStatus})}this.columns=a;this.callParent(arguments)},renderDate:function(f,j,b,c,h,g,d){var a=AL.date(f);var e=Ext.Date.format(a,"d/m/Y");return this.renderLink(e,j,b)},setActions:function(h,l,e,f,k,j,g){var c=e.get("idLocal");var d='<div class="action-icons">';var a="view";var b="edit";if(c==0){a="view-opening-balance";b="edit-opening-balance";d+='<a href="/journal/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("edit",true)+'"/></a>'}else{d+='<a href="/journal/'+a+"/id/"+c+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("edit",true)+'" /></a>'}if(e.get("isEditable")){if(c==0){d+='<a href="/journal/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'"/></a>'}else{d+='<a href="/journal/'+b+"/id/"+c+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'"/></a>'}}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(e.get("deletable")){d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteJournal" />'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}d+="</div>";return d},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,2,d)},renderLink:function(c,d,a){var b="";if(c){if(a.get("idLocal")==0){b='<a href="/journal/view-opening-balance">'+c+"</a>"}else{b='<a href="/journal/view/id/'+a.get("idLocal")+'">'+c+"</a>"}}return b},renderStatus:function(d,e,c){var b="";var a="";switch(d){case"open":b="invoiceOpen";a=translate("openJournal",true);break;case"void":b="invoiceVoid";a=translate("voidJournal",true);break}return'<span class="'+b+'">'+a+"</span>"}});Ext.define("AL.view.client.GridJournals",{extend:"AL.view.journal.GridAll",alias:"widget.client_GridJournals"});Ext.define("AL.view.mailer.GridHistoryInvoices",{extend:"Ext.grid.Panel",alias:"widget.mailer_GridAllInvoices",title:"Historial Correos",scroll:true,requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],border:true,frame:true,layout:"fit",store:"InvoiceMails",minHeight:300,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-bills .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has enviado correos desde Alegra!</div></div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"InvoiceMails"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(d,c){var a=this.getStore();if(!a.isLoading()&&!a.hasLoaded()){a.load()}d.tip=Ext.create("Ext.tip.ToolTip",{target:d.view.el,delegate:"img.email-tooltip",dismissDelay:15000,listeners:{beforeshow:function b(e){e.update(e.triggerElement.getAttribute("data-tooltip"))}}})}},initComponent:function(){this.columns=[{header:"Fecha de envío",dataIndex:"sentTime",align:"center",width:130,renderer:this.renderDate},{header:"De",dataIndex:"sender",width:170},{header:"Descripción",dataIndex:"description",flex:3,sortable:false,renderer:this.renderLinkInvoice},{header:"Estado",dataIndex:"state",align:"center",width:150,renderer:this.renderState}];this.callParent(arguments)},renderState:function(h,b,d,e,k,j,f){var a="";switch(h){case"sent":a="Enviado";break;case"pending":a="Pendiente";break;case"error":case"bounced":var g="Error";var c=d.get("errorReason");if(h=="bounced"){g+=" (Rebote)";c=d.get("bounceReason")}a=g+'<img style="vertical-align: middle; margin: 0 3px;" class="email-tooltip" id="email'+d.get("id")+'" data-tooltip="'+c+'" src="https://cdn1.getsoft.app/images/sm-help.png">';break;default:a="";break}return a},renderLinkInvoice:function(g,c,b,h,e,d,a){var f='<a href="/invoice/view/id/'+b.get("id")+'">'+g+"</a>";return f},renderDate:function(f,j,c,d,h,g,e){f=f.replace(/-/g,"/");var b=new Date(f);var a=Ext.Date.format(b,"d/m/Y");return a}});Ext.define("AL.controller.Mailer",{extend:"Ext.app.Controller",views:["mailer.GridHistoryInvoices","mailer.FormEditSubscriptions"],stores:["InvoiceMails","UnsubscribableMails"],models:["InvoiceMail","UnsubscribableMail"],init:function(){this.control({mailer_FormEditSubscriptions:{beforerender:function(d){var e=[];for(var c=0;c<d.unsubscribableEmails.length;c++){var b={xtype:"radiofield",boxLabel:"Sí",name:d.unsubscribableEmails[c].mail,inputValue:"yes"},a={xtype:"radiofield",boxLabel:"No",name:d.unsubscribableEmails[c].mail,inputValue:"no"},f={itemId:d.unsubscribableEmails[c].mail,fieldLabel:d.unsubscribableEmails[c].name,defaultType:"radiofield",layout:"hbox",labelWidth:380,defaults:{flex:1}};if(d.unsubscribableEmails[c].tooltip){f.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: -5px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left: 5px; top: -45px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+d.unsubscribableEmails[c].tooltip+"</div></div></div></div>"}if(d.unsubscribableEmails[c].unsubscribed=="yes"){a.checked=true}else{b.checked=true}f.items=[b,a];e.push(f)}e.push({xtype:"box",html:"Para que no pierdas contacto con nuestro equipo de soporte recibe siempre <b>Correos de Soporte y ayuda sobre Alegra</b>",style:"margin-left: -20px; margin-top:40px;font-size: 10px;"});d.add(e)}},"buttons_SubmitReset button[action=saveSubscriptions]":{click:function(b){var c=Ext.ComponentQuery.query("mailer_FormEditSubscriptions")[0],a=c.getValues();if(c.isValid()){var f=Ext.MessageBox.show({msg:translate("saving",true),wait:true}),e="/mailer/edit-subscriptions/format/json",d="/configuration";if(c.noSession){e="/mailer/edit-subscriptions-no-session/format/json/id/"+c.idEmail+"/hash/"+c.hash;d="/mailer/confirm-edit-subscriptions-no-session/id/"+c.idEmail+"/hash/"+c.hash}Ext.Ajax.request({url:e,params:a,success:function(g){var j=Ext.decode(g.responseText);if(!j.success){f.close();Ext.Msg.show({title:"Ocurrió un error",msg:'Las preferencias de correo no se pudieron aplicar, inténtalo de nuevo más tarde o comunícate a <a class="appsupport-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});var h=Ext.get(Ext.query(".appsupport-link"));h.on("click",function(k){k.preventDefault();Ext.create("AL.view.support.WindowCreateSupportTicket")})}else{window.location=d}},failure:function(){f.close()}})}}}})}});Ext.define("AL.view.purchaseOrder.GridAll",{extend:"Ext.grid.Panel",alias:"widget.purchaseOrder_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],columnLines:true,store:"PurchaseOrders",title:"",minHeight:400,width:1024,frame:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-credit-notes .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYetF",true,{document:translate("purchaseOrder")})+'</div><div class="button-wrapper"><a href="/purchase-order/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newPurchaseOrder",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"PurchaseOrders"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(){var a=this.getStore();a.sort("date","DESC")}},initComponent:function(){this.columns=[{header:translate("code",true),dataIndex:"purchaseOrderNumber",renderer:this.linkCode,width:100,align:"center"},{header:translate("client",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("date",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:translate("deadline",true),dataIndex:"deliveryDate",width:110,align:"center",renderer:this.renderDate},{header:translate("status",true),dataIndex:"status",width:90,align:"center",renderer:this.renderStatus},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("actions",true),align:"center",type:"purchaseOrderActions",renderer:this.setActions,width:125,filter:false,sortable:false}];this.callParent(arguments)},linkCode:function(e,f,b,g,d,c,a){return'<a href="/purchase-order/view/id/'+b.get("id")+'">'+b.get("purchaseOrderNumber")+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/purchase-order/view/id/'+b.get("id")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(g,k,d,e,j,h,f){var a=d.get("id");var b=d.get("canPrintOrDownload");var c='<div class="action-icons">';c+='<a href="/purchase-order/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(b){c+='<a target="_blank" href="/purchase-order/print/id/'+d.get("id")+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" title="'+translate("print",true)+'" class="printPurchaseOrder"></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}if(d.get("editable")){c+='<a href="/purchase-order/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled editDisabled"/>'}if(d.get("voidable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" title="'+translate("cancel",true)+'" class="voidPurchaseOrder"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" title="'+translate("cancel",true)+'" class="disabled"/>'}if(d.get("deletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deletePurchaseOrder"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled"/>'}c+="</div>";return c},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";switch(e){case"open":j="";a="";break;case"closed":j="remissionClosed";a=translate("billed",true);break;case"void":j="remissionVoid";a=translate("canceledFemale",true);break}return'<span class="'+j+'">'+a+"</span>"}});Ext.define("AL.view.client.GridPurchaseOrder",{extend:"AL.view.purchaseOrder.GridAll",alias:"widget.client_GridPurchaseOrder"});Ext.define("AL.view.item.GridPurchaseOrders",{extend:"AL.view.purchaseOrder.GridAll",alias:"widget.item_GridPurchaseOrders"});Ext.define("AL.view.recurringinvoice.GridAll",{extend:"Ext.grid.Panel",alias:"widget.recurringinvoice_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:translate("invoices",true)+" "+translate("recurring"),scroll:true,width:1024,minHeight:390,frame:true,store:"RecurringInvoices",columnLines:true,cls:"grid-recurring-invoices grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-recurring-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirst",true)+" "+translate("recurringInvoice")+(translate("language")=="language"?" yet":"")+'!</div><div class="button-wrapper"><a href="/recurring-invoice/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newInvoice",true)+" "+translate("recurringInvoice")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"RecurringInvoices"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(b){var a=b.getStore();if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){this.columns=[{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.linkValue},{header:translate("startDate",true),dataIndex:"startDate",width:110,align:"center",renderer:this.renderDate},{header:translate("endDate",true),dataIndex:"endDate",align:"center",width:130,renderer:this.renderDate},{header:translate("total",true),dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("frequencyMonths",true),dataIndex:"repeatEvery",align:"center",width:120},{header:translate("termDays",true),dataIndex:"term",align:"center",width:108},{header:translate("actions",true),align:"center",renderer:this.setActions,type:"recurringInvoiceActions",width:150,filter:false,sortable:false}];this.callParent(arguments)},linkValue:function(e,f,b,g,d,c,a){return'<a href="/recurring-invoice/view/id/'+b.get("idLocal")+'">'+e+"</a>"},renderDate:function(f,j,c,d,h,g,e){var a=null;if(f){var b=AL.date(f);a=Ext.Date.format(b,"d/m/Y")}return a},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/recurring-invoice/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'"/></a>';b+='<a href="/recurring-invoice/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'"/></a>';b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteRecurringInvoice"/>';b+="</div>";return b},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.recurringpayment.GridAll",{extend:"Ext.grid.Panel",alias:"widget.recurringpayment_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:translate("recurringPayments",true),scroll:true,width:1024,minHeight:390,frame:true,border:true,store:"RecurringPayments",columnLines:true,cls:"grid-recurring-payments grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-recurring-payments .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("recurringPayment")})+'</div><div class="button-wrapper"><a href="/recurring-payment/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newM",true)+"  "+translate("recurringPayment")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"RecurringPayments"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(b){var a=b.getStore();if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"idLocal",renderer:this.linkValue,width:70,align:"center"},{header:translate("supplier",true),dataIndex:"name",flex:1,sortable:false},{header:translate("account",true),dataIndex:"accountName",width:200,sortable:false},{header:translate("startDate",true),dataIndex:"startDate",width:120,align:"center",renderer:this.renderDate},{header:translate("endDate",true),dataIndex:"endDate",width:120,align:"center",renderer:this.renderDate},{header:translate("amount",true),dataIndex:"amount",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("actions",true),align:"center",type:"recurringPaymentActions",renderer:this.setActions,width:150,filter:false,sortable:false}];this.callParent(arguments)},linkValue:function(e,f,b,g,d,c,a){return'<a href="/recurring-payment/view/id/'+b.get("idLocal")+'">'+e+"</a>"},renderDate:function(f,j,c,d,h,g,e){var a=null;if(f){var b=AL.date(f);a=Ext.Date.format(b,"d/m/Y")}return a},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/recurring-payment/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';b+='<a href="/recurring-payment/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>';b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" class="deleteRecurringPayment" alt="'+translate("remove",true)+'"/>';b+="</div>";return b},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.resolution.GridAll",{extend:"Ext.grid.Panel",alias:"widget.resolution_GridAll",title:translate("resolution",true),scroll:true,minHeight:390,width:1024,border:true,frame:true,columnLines:true,cls:"grid-with-icons",requires:["AL.plugin.grid.ColumnFilter"],plugins:[{ptype:"grid_ColumnFilter"}],initComponent:function(){this.store=Ext.create("AL.store.Resolution",{autoLoad:true,sorters:{property:"documentType",direction:"ASC"}});var b,c;if(this.configs&&this.configs.country=="republicaDominicana"){b={header:translate("endDate",true),dataIndex:"endDate",flex:0.8,renderer:this.renderEndDate}}else{b={header:translate("status",true),dataIndex:"status",flex:0.8,renderer:this.renderStatus}}if(!this.configs||(this.configs&&this.configs.country!="argentina")){c={header:translate("resolutionText",true),dataIndex:"resolutionText",flex:this.configs&&this.configs.country==="peru"||this.configs.country==="mexico"?1.5:3}}var a=[{header:translate("name",true),dataIndex:"name",flex:this.configs&&(this.configs.country==="republicaDominicana"||this.configs.country==="peru")?1.8:1,},{header:translate("favorite",true),dataIndex:"isDefault",flex:0.8,renderer:this.renderDefault},b,{header:translate("prefix",true),dataIndex:"prefix",flex:1},{header:translate("next",true)+" "+translate("number"),dataIndex:"nextInvoiceNumber",flex:this.configs&&this.configs.country==="peru"?2:1,sortable:false},{header:translate("actions",true),align:"center",type:"resolutionActions",renderer:this.setActions,width:100,sortable:false}];if(c){a.splice(3,0,c)}if(this.configs&&["peru","republicaDominicana","mexico","argentina","chile","costaRica"].indexOf(this.configs.country)!==-1){a.splice(0,0,{header:translate("documentType",true),dataIndex:"documentType",flex:Ext.Array.contains(["peru","argentina","chile"],this.configs.country)?2.1:1,renderer:this.renderDocumentType});switch(this.configs.country){case"republicaDominicana":a.splice(4,1);break;case"costaRica":a.splice(3,2);break}}this.columns=a;this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.get("editable")){b+='<a href="/resolution/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled" />'}if(c.get("deletable")){b+='<a href="/resolution/delete/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteResolution"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}if(c.get("status")==="active"){b+='<a href="#" title="'+translate("deactivate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleResolutionStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a href="#" title="'+translate("activate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleResolutionStatus" /></a>'}}b+="</div>";return b},renderStatus:function(e,j,b,c,g,f,d){var a=b.get("status");var h=(a=="active")?translate("active",true):translate("inactive",true);return h},renderEndDate:function(e,f,b,g,d,c,a){if(!e){return e}return Ext.Date.format(AL.date(e),"d/m/Y")},renderDefault:function(e,j,b,c,g,f,d){var a=b.get("isDefault");var h=(a=="yes")?translate("yes",true):translate("no",true);return h},renderDocumentType:function(f,g,c,h,e,d,b){var a=c.get("documentType")==="invoice"?"specializedInvoice":c.get("documentType");if(this.configs&&this.configs.country=="peru"&&a==="creditNote"){a="creditNoteInvoice"}if(c.data.metadata.subDocumentType&&c.data.metadata.subDocumentType){a=c.data.metadata.subDocumentType;if(this.configs&&this.configs.country=="argentina"){a="resolution."+c.data.metadata.subDocumentType}}return translate(a,true)}});Ext.define("AL.controller.Resolution",{extend:"Ext.app.Controller",views:["resolution.GridAll","resolution.FormAdd","resolution.XmlResolutionAdd"],stores:["Resolution","DocumentTypesForResolution","SubDocumentTypesForResolution",],models:["Resolution","CountryLegalParameter",],itemCount:0,errorAlertDisplayed:false,init:function(){this.application.addListener("deleteResolution",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("numeration")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("numeration")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/resolution/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{Ext.MessageBox.alert("Error",h.cause)}},failure:function(){}})}}})},this);this.application.addListener("toggleResolutionStatus",function(c){var a=c.record;var b=c.initiator;Ext.Ajax.request({url:"/resolution/change-resolution-status/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){var d=b.getStore();d.load()}else{Ext.MessageBox.alert("Error",g.cause)}},failure:function(){}})},this),this.control({"resolution_FormAdd button[action=save]":{click:this.saveResolution},"resolution_FormAdd buttons_Cancel":{afterrender:function(b){var c=b.up("form");switch(c.configs.country){case"chile":if(c.configs.fileLoaded!=null){var d=b.getEl();var a=d.down("a.cancel-link");a.on("click",function(h,g,f){h.preventDefault();window.location="/resolution"})}break}}},resolution_GridAll:{render:function(a){this.uploadXmlResolutionFile(country);a.getStore().load()}},resolution_FormAdd:{render:this.initialize,beforerender:function(f){f.executeActionsBeforeRender();switch(f.configs.country){case"peru":var b=f.down("textfield[name=prefix]");b.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text" id="prefixFieldHelpText">Para '+translate("stamp")+" "+translate("invoices")+" electrónicos, la "+translate("prefix")+' debe contener 4 caracteres y empezar por "F" para '+translate("specializedInvoices")+' y "B" para '+translate("saleTickets")+'. <a href="http://ayuda.getsoft.app/hc/es/articles/115002451263" target="_blank">Ver más</a>.</div></div></div></div>';var a=f.down("combo[name=documentType]");a.setValue(f.configs.regime==="NEW_RUS"?"saleTicket":"invoice");break;case"costaRica":var e=f.down("textfield[name=resolution]");var h=f.down("checkbox[name=isElectronicResolution]");var a=f.down("combo[name=documentType]");var d=a.getStore();e.tooltip="Indica el número de resolución de la siguiente manera DGT-R-48-2016";e.regex="";if(f.type!=="edit"){h.suspendEvents();h.setValue(false);h.resumeEvents()}h.disable();break;case"argentina":var a=f.down("combo[name=documentType]");a.setValue("invoice");var g=f.down("textfield[name=maxInvoiceNumber]");g.hide();var h=f.down("checkbox[name=isElectronicResolution]");var c=f.down("textfield[name=nextInvoiceNumber]");if(h.hidden){c.setValue("")}else{c.setValue(1)}break;case"chile":if(!f.type){this.chargeInfoWhenItComesFromXmlFile(f)}break}},afterrender:function(c){switch(c.configs.country){case"chile":var b=c.down("textfield[name=minInvoiceNumber]");var d=c.down("textfield[name=maxInvoiceNumber]");var a=c.down("textfield[name=nextInvoiceNumber]");a.setFieldLabel('Siguiente folio <span class="req">*</span>');b.setFieldLabel("Rango inicio");d.setFieldLabel("Rango fin");break}}},"resolution_FormAdd combo[name=documentType]":{change:function(p,j,k){var b=p.up("form");var c=p.getSelectedRecord();var m=c?c.get("id"):"";var q=b.down("textfield[name=prefix]");var a=b.down("textfield[name=nextInvoiceNumber]");var g=b.down("textfield[name=maxInvoiceNumber]");var f=b.down("checkbox[name=isElectronicResolution]");var s=b.down("textarea[name=resolutionText]");switch(b.configs.country){case"peru":if(Ext.Array.contains(["invoice","saleTicket","creditNote","creditNoteSaleTicket"],m)&&f.checked===true){a.maxLength=8;g.maxLength=8;q.allowBlank=false;q.minLength=4;q.maxLength=4;switch(m){case"invoice":q.regex=/[F]([A-Za-z0-9]{3})/;break;case"saleTicket":q.regex=/[B]([A-Za-z0-9]{3})/;break}s.show();s.setReadOnly(true);s.setValue("Autorizado mediante resolución Nº 034-005-0004781")}else{a.maxLength=11;g.maxLength=11;q.allowBlank=true;q.minLength=0;q.maxLength=100;q.regex=/^([A-Za-z0-9]+)$/;s.setReadOnly(false);if(s.originalValue){s.setValue(s.originalValue)}else{s.setValue(null)}}var h=Ext.get("prefixFieldHelpText");if(Ext.Array.contains(["invoice","saleTicket"],m)){if(h){h.update("Para "+translate("stamp")+" "+translate("invoices")+" electrónicos, la "+translate("prefix")+' debe contener 4 caracteres y empezar por "F" para '+translate("specializedInvoices")+' y "B" para '+translate("saleTickets")+'. <a href="http://ayuda.getsoft.app/hc/es/articles/115002451263" target="_blank">Ver más</a>.')}s.setFieldLabel("Pie de "+(m=="saleTicket"?"boleta":"factura"))}else{if(h){h.update("Te permite diferenciar entre varias "+translate("numerations")+", por ejemplo para distintos puntos de venta.")}s.setFieldLabel("Pie de "+translate(m))}if(b.configs&&b.configs.isActiveElectronicInvoicing===true&&Ext.Array.contains(["invoice","saleTicket","creditNote","creditNoteSaleTicket"],m)){f.show()}else{f.setValue(false);f.hide()}b.getForm().isValid();break;case"republicaDominicana":var n=b.down("datefield[name=startDate]");var o=b.down("datefield[name=endDate]");var d=b.down("textarea[name=do_branchOffice]");switch(m){case"invoice":n.show();o.show();s.show();g.show();break;case"bill":n.show();o.show();s.setValue(null);s.hide();g.show();break;default:n.hide();o.hide();s.setValue(null);s.hide();g.setValue(null);g.hide();break}if(["invoice","creditNote","bill"].indexOf(m)!==-1){d.allowBlank=false;d.show()}else{d.allowBlank=true;d.hide();d.setValue(null)}break;case"colombia":if(f.checked===true){q.regex=/^([A-Za-z0-9]+)$/;if(q.getValue()){q.isValid()}}else{q.regex=""}break;case"chile":if(Ext.Array.contains(["invoice","EXEMPT_INVOICE"],m)&&!b.configs.isElectronicResolution&&!b.configs.fileLoaded){s.show();s.enable()}else{s.hide();s.disable()}break;case"costaRica":if(Ext.Array.contains(["invoice","saleTicket","bill"],m)&&f.checked===true&&k!="EXPORT_INVOICE"){s.show();s.setReadOnly(true);s.setValue("Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019")}else{s.setReadOnly(false);if(s.originalValue){s.setValue(s.originalValue)}else{s.setValue(null)}if(m=="EXPORT_INVOICE"){if(!b.configs.hasElectronicExportInvoiceActive){q.setDisabled(false);s.setReadOnly(false);f.setDisabled(false)}else{if(f.checked===true){s.setReadOnly(true)}f.setDisabled(true)}}else{f.setReadOnly(false);q.setDisabled(false);s.setValue("");s.setReadOnly(false);f.setDisabled(true);f.setValue(false);if(b.type=="edit"&&b.configs.isElectronicResolution){f.setValue(true);q.disable()}}}q.regex="";break;case"argentina":var r=b.down("combo[name=subDocumentType]");if(["invoice","creditNote","debitNote","estimate"].indexOf(m)!==-1){var e=r.getStore(),l=e.getProxy();if(l.filters){l.filters.documentType=m}else{l.filters={documentType:m}}l.url="/country-legal-info/retrieve-parameters-by-key/key/subDocumentTypes/format/json?filters="+Ext.encode(l.filters);e.load();r.show();r.allowBlank=false}else{r.setValue(null);r.hide();r.allowBlank=true}if(m==="invoice"){s.show()}else{s.setValue(null);s.hide()}if(b.configs&&b.configs.isActiveElectronicInvoicing===true&&["invoice","creditNote"].indexOf(m)!==-1){f.setValue(true);f.show()}else{f.setValue(false);f.hide()}break;default:q.regex="";break}},afterrender:function(e){var d=this;var c=e.up("form");if(Ext.Array.contains(["chile","costaRica"],c.configs.country)){var b=Ext.create("AL.LoadMask",{target:c,msg:"Cargando...",});b.show();b.addDependantTask();var a=e.getStore();if(a.hasLoaded()){c.loadSubDocumentType(e,"",function(){b.endDependantTask()})}else{a.on("load",function(){c.loadSubDocumentType(e,"",function(){b.endDependantTask()})})}}}},"resolution_FormAdd checkbox[name=isElectronicResolution]":{change:function(h){var a=h.up("form");var c=a.down("textfield[name=prefix]");var d=a.down("textfield[name=nextInvoiceNumber]");var k=a.down("textfield[name=maxInvoiceNumber]");var o=a.down("combo[name=documentType]");var e=a.down("datefield[name=startDate]");var b=a.down("datefield[name=endDate]");var n=a.down("textarea[name=resolutionText]");var m=a.down("checkbox[name=autoincrement]");var g=a.down("textfield[name=resolution]");if(h.checked===true){m.setValue(true);m.disable()}else{m.enable()}if(a.configs){switch(a.configs.country){case"peru":var f=o.getSelectedRecord();if(!f){break}var l=f.get("id");if(Ext.Array.contains(["invoice","saleTicket"],l)&&h.checked===true){d.maxLength=8;k.maxLength=8;c.allowBlank=false;c.minLength=4;c.maxLength=4;if(a.configs&&a.configs.country==="peru"&&a.configs.regime==="NEW_RUS"){o.setValue("saleTicket");o.disable()}switch(l){case"invoice":c.regex=/[F]([A-Za-z0-9]{3})/;break;case"saleTicket":c.regex=/[B]([A-Za-z0-9]{3})/;break}m.setValue(true);m.disable();n.show();n.setReadOnly(true);n.setValue("Autorizado mediante resolución Nº 034-005-0004781")}else{if(a.configs&&a.configs.isEditableDocumentType===true){o.enable()}d.maxLength=11;k.maxLength=11;c.allowBlank=true;c.minLength=0;c.maxLength=100;c.regex=/^([A-Za-z0-9]+)$/;m.enable();n.setReadOnly(false);if(n.originalValue){n.setValue(n.originalValue)}else{n.setValue(null)}}a.getForm().isValid();break;case"republicaDominicana":break;case"colombia":var j=a.down("textfield[name=minInvoiceNumber]");if(h.checked===true){c.regex=/^([A-Za-z0-9]+)$/;if(c.getValue()){c.isValid()}m.setValue(true);m.disable();e.show();e.allowBlank=false;b.show();b.allowBlank=false;g.show();g.allowBlank=false;j.allowBlank=false;j.setFieldLabel('Desde el número <span class="req">*</span>');k.allowBlank=false;k.setFieldLabel('Hasta el número <span class="req">*</span>')}else{c.regex="";m.enable();e.hide();e.allowBlank=true;b.hide();b.allowBlank=true;g.hide();g.allowBlank=true;j.allowBlank=true;j.setFieldLabel("Desde el número");k.allowBlank=true;k.setFieldLabel("Hasta el número")}break;case"costaRica":if(h.checked===true){c.allowBlank=false;c.minLength=10;c.maxLength=10}else{c.allowBlank=true;c.minLength=0;c.maxLength=100}var f=o.getSelectedRecord();if(!f){break}var l=f.get("id");if(Ext.Array.contains(["invoice","saleTicket","EXPORT_INVOICE"],l)&&h.checked===true){n.show();n.setReadOnly(true);n.setValue("Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019");if(l=="EXPORT_INVOICE"){c.setValue("0010000109");c.setDisabled(true)}}else{if(Ext.Array.contains(["invoice","saleTicket","EXPORT_INVOICE"],l)&&h.checked===true){n.setReadOnly(false);c.setValue("");c.setDisabled(false);if(n.originalValue){n.setValue(n.originalValue)}else{n.setValue(null)}}}break;case"argentina":m.setValue(true);m.disable();if(h.checked===true){d.setValue(1);d.hide();d.allowBlank=true}else{d.setValue("");d.show();d.allowBlank=false}break;default:c.regex="";break}}if(h.hidden==false){a.getForm().isValid()}this.updateResolutionText(h)}},"resolution_FormAdd checkbox[name=autoincrement]":{beforerender:function(c,a){var b=c.up("resolution_FormAdd");if(b.configs.country=="republicaDominicana"||b.configs.country=="peru"){c.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Al activar esta opción el sistema generará el siguiente '+translate("number")+" del documento de forma automática.</div></div></div></div>"}},change:function(f,b,a,g){var c=f.up("form");var j=c.down("combo[name=documentType]");var d=c.down("textfield[name=prefix]");var e=c.down("textfield[name=nextInvoiceNumber]");var h=c.down("textfield[name=maxInvoiceNumber]");if(b){d.enable();d.show();e.allowBlank=false;e.enable();e.show();h.enable();if(c.configs.country!=="republicaDominicana"||!j||(j&&j.getValue()==="invoice")){if(c.configs.country!="peru"||!Ext.Array.contains(["","0"],h.getValue())){h.show()}}}else{d.disable();d.hide();e.allowBlank=true;e.disable();e.hide();h.disable();h.hide()}c.getForm().isValid()}},"resolution_FormAdd textarea[name=resolutionText]":{beforerender:function(b){var a=b.up("form");if(a.configs){switch(a.configs.country){case"colombia":b.emptyText="Ejemplo: Resolución Facturación por Computador N°. 22000002222 de 2015/01/01 Rango del 1 al 100";b.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Indica aquí la información relacionada con la autorización otorgada por la DIAN, será visible en el pie de factura. <a href="https://ayuda.getsoft.app/hc/es/articles/205801859" target="_blank">Ver más</a>.</div></div></div></div>';break;case"peru":b.readOnlyCls="x-item-disabled";break;case"costaRica":b.readOnlyCls="x-item-disabled";break}}},afterrender:function(c){var b=c.up("form");if(b.configs){switch(b.configs.country){case"peru":var a=Ext.get("resolutionTextFieldHelpText");if(a){a.update("Alegra está autorizado para facturación electrónica con resolución N. 034-005-0004781 por medio de BIZLINKS S.A.C.")}break;case"costaRica":var a=Ext.get("resolutionTextFieldHelpText");if(a){a.update("Alegra está autorizado para facturación electrónica por medio de Cybefuel - DGT-R-48-2016 del 7 de octubre de 2016")}break}}}},"resolution_FormAdd datefield[name=startDate]":{change:function(c){var b=c.up("form");var a=b.down("datefield[name=endDate]");a.setMinValue(new Date(c.getValue()))}},"resolution_FormAdd textfield[name=nextInvoiceNumber]":{change:function(b){var a=b.up("form");if(a.configs.country!="colombia"){this.updateResolutionText(b)}},focus:function(b){var a=b.up("form");var c=a.down("checkbox[name=isElectronicResolution]");if(a.type&&a.type=="edit"&&a.configs&&["colombia","peru"].indexOf(a.configs.country)!==-1&&c.getValue()===true){GlobalMsg.showNotification({type:"warning",title:"Advertencia",text:"Estás usando una numeración electrónica, te recomendamos no editar el siguiente número de "+translate("invoice")})}}},"resolution_FormAdd textfield[name=minInvoiceNumber]":{change:function(a){this.updateResolutionText(a)}},"resolution_FormAdd datefield[name=startDate], resolution_FormAdd datefield[name=endDate], resolution_FormAdd textfield[name=resolution], resolution_FormAdd textfield[name=maxInvoiceNumber], resolution_FormAdd textfield[name=prefix]":{change:function(a){this.updateResolutionText(a)}},"resolution_GridAll gridcolumn[type=resolutionActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteResolution")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteResolution",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar la "+translate("numeration")+" ya que se ha utilizado en "+translate("invoices"))}}if(d.hasCls("toggleResolutionStatus")){h.preventDefault();l.fireEvent("toggleResolutionStatus",{record:c,initiator:a})}}}})},saveResolution:function(f){var g=f.up("form");var d="/resolution/add/format/json";if(g.type&&g.type==="edit"){d="/resolution/edit/format/json"}var c=g.getValues();if(c.startDate){var h=g.down("datefield[name=startDate]");c.startDate=Ext.Date.format(h.getValue(),"Y-m-d")}if(Ext.Array.contains(["costaRica","chile"],g.configs.country)){var b=g.down("combo[name=documentType]");if(b.getSelectedRecord().raw.documentType){c.documentType=b.getSelectedRecord().raw.documentType}}if(c.endDate){var a=g.down("datefield[name=endDate]");c.endDate=Ext.Date.format(a.getValue(),"Y-m-d")}var e=g.getFieldValuesAsMetadata();if(e){c.metadata=Ext.encode(e)}f.disable();GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("numeration")+"..."});Ext.Ajax.request({url:d,method:"POST",params:c,success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var m=l.results;window.location="/resolution"}else{if(l.redirect){window.location=l.redirect}GlobalRedirector.close();f.enable()}},failure:function(){GlobalRedirector.close();f.enable()}})},initialize:function(c){var p=this;var f=c.down("checkbox[name=isElectronicResolution]");var q=c.down("textfield[name=prefix]");var a=c.down("textfield[name=nextInvoiceNumber]");var k=c.down("textfield[name=maxInvoiceNumber]");var g=c.down("textfield[name=minInvoiceNumber]");var d=c.down("combo[name=documentType]");var j=d.getStore();var l=c.down("datefield[name=startDate]");var n=c.down("datefield[name=endDate]");var e=c.down("textarea[name=do_branchOffice]");var t=c.down("textarea[name=resolutionText]");var h=c.down("textfield[name=resolution]");var b=c.down("checkbox[name=autoincrement]");var m=c.down("textfield[name=resolutionDate]");q.getSubmitData=this.getSubmitDataDisabled;f.getSubmitData=this.getSubmitDataDisabled;b.getSubmitData=this.getSubmitDataDisabled;d.getSubmitData=this.getSubmitDataDisabled;a.getSubmitData=this.getSubmitDataDisabled;k.getSubmitData=this.getSubmitDataDisabled;if(c.configs&&["peru","republicaDominicana","mexico","argentina","costaRica","chile"].indexOf(c.configs.country)!==-1){d.allowBlank=false;d.show();if(c.configs.country==="republicaDominicana"){e.allowBlank=false;t.hide();k.hide();q.regex=/^([A-Za-z0-9]+)$/;if(j.hasLoaded()){d.setValue("invoice")}else{j.on("load",function(){d.setValue("invoice")})}}}switch(c.configs.country){case"colombia":if(f.checked===true){q.regex=/^([A-Za-z0-9]+)$/;if(q.getValue()){q.isValid()}}else{q.regex=""}break;case"argentina":b.setValue(true);b.disable();q.regex=/^[0-9]*$/;q.maxLength=5;a.maxLength=8;d.fieldLabel="Documento";break;case"republicaDominicana":t.maxLength=9;break;case"costaRica":k.hide();break}if(c.configs&&c.configs.isActiveElectronicInvoicing===true){switch(c.configs.country){case"peru":a.maxLength=8;k.maxLength=8;q.allowBlank=false;q.minLength=4;q.maxLength=4;f.show();if(c.configs.regime==="NEW_RUS"){if(j.hasLoaded()){d.setValue("saleTicket")}else{j.on("load",function(){d.setValue("saleTicket")})}d.disable()}b.setValue(true);b.disable();break;case"colombia":b.setValue(true);b.disable();break;case"argentina":a.hide();a.setValue(1);a.allowBlank=true;break}}else{f.setValue(false)}if(c.type&&c.type=="edit"){var r=c.down("textarea[name=resolutionText]");var o=c.down("hidden[name=idLocal]");var s=c.down("textfield[name=name]");var b=c.down("checkbox[name=autoincrement]");Ext.Ajax.request({url:"/resolution/retrieve-one/id/"+c.idLocal+"/format/json",success:function(u){var B=Ext.decode(u.responseText);var y=B.results;o.setValue(y.idLocal);s.setValue(y.name);var x=c.configs.isActiveElectronicInvoicing;var v=function(){if(c.configs.country==="republicaDominicana"&&y.documentType==="bill"){j.add({id:"bill",name:translate("bill",true)});d.disable()}if(Ext.Array.contains(["costaRica","chile"],c.configs.country)&&y.metadata.subDocumentType){if(c.configs.country==="costaRica"){if(x&&y.metadata.isElectronicResolution){f.setValue(true);f.disable();d.disable();q.disable()}}}else{d.setValue(y.documentType)}};if(j.hasLoaded()){v()}else{j.on("load",function(){v()})}if(c.configs&&c.configs.isEditableDocumentType===false){c.configs.originalDocumentType=y.documentType;d.disable()}q.setValue(y.prefix);a.suspendEvents();a.setValue(y.nextInvoiceNumber);a.resumeEvents();k.setValue(y.maxInvoiceNumber);r.setValue(y.resolutionText);l.setValue(y.startDate);n.setValue(y.endDate);b.setValue(y.autoincrement);l.setValue(y.startDate);n.setValue(y.endDate);var z=y.metadata&&x&&y.metadata.isElectronicResolution;var w=y.metadata;if(!w||w.length===0){w={isElectronicResolution:false}}if(!x&&z){w.isElectronicResolution=false}if(w){c.setFieldValuesFromMetadata(w)}e.setValue(y.do_branchOffice);h.setValue(y.resolution);m.setValue(y.resolutionDate);var A=c.down("radio[inputValue="+y.isDefault+"]");A.setValue(true);if(x==true&&z===true){if(c.configs.hasDocuments){f.disable()}b.disable()}if(c.configs){switch(c.configs.country){case"costaRica":if(x===true&&z===true){f.disable();if(y.documentType!="bill"){q.disable()}}r.originalValue=y.resolutionText;if(Ext.Array.contains(["invoice","saleTicket","bill"],y.documentType)&&x===true&&z===true){r.setReadOnly(true);r.setValue("Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019")}else{r.setReadOnly(false);if(r.originalValue){r.setValue(r.originalValue)}else{r.setValue(null)}}if(y.documentType=="bill"){d.disable();q.setValue(y.prefix);q.disable()}if(y.documentType=="creditNote"&&y.isElectronicResolution){r.hide();q.disable()}break;case"peru":r.originalValue=y.resolutionText;if(Ext.Array.contains(["invoice","saleTicket"],y.documentType)&&x===true&&z===true){r.show();r.setReadOnly(true);r.setValue("Autorizado mediante resolución Nº 034-005-0004781")}else{r.setReadOnly(false);if(r.originalValue){r.setValue(r.originalValue)}else{r.setValue(null)}}break}}if(c.configs&&c.configs.country=="peru"&&Ext.Array.contains(["","0"],k.getValue())){k.hide()}if(c.configs.country=="chile"){p.chargeInfoWhenItComesFromXmlFile(c)}}})}else{if(c.configs.country=="peru"&&Ext.Array.contains(["","0"],k.getValue())){k.hide()}if(c.configs.country=="costaRica"){filter=Ext.util.Filter({filterFn:function(u){return u.data.id!="bill"}});j.filter(filter)}}},updateResolutionText:function(k){var c=k.up(c);if(c.type&&c.type==="edit"){return}var a=c.down("checkbox[name=isElectronicResolution]");var f=c.configs.isActiveElectronicInvoicing;var e=c.down("textfield[name=prefix]");var g=c.down("textfield[name=nextInvoiceNumber]");var m=c.down("textfield[name=minInvoiceNumber]");var n=c.down("textfield[name=maxInvoiceNumber]");var h=c.down("datefield[name=startDate]");var b=c.down("datefield[name=endDate]");var l=c.down("textfield[name=resolution]");var o=c.down("textfield[name=resolutionText]");if(c.configs&&c.configs.country==="colombia"&&m.getValue()&&n.getValue()&&h.getValue()&&b.getValue()&&l.getValue()){var j=Ext.Date.format(h.getValue(),"Y-m-d");var d=Ext.Date.format(b.getValue(),"Y-m-d");o.setValue("Autorización de numeración de facturación N°"+l.getValue()+" de "+j+" "+(f===true&&a.getValue()===true?"Modalidad Factura Electrónica":"")+" Desde N° "+e.getValue()+""+m.getValue()+" hasta "+e.getValue()+""+n.getValue()+" con vigencia hasta "+d)}},getSubmitDataDisabled:function(){var a=null,b;if(this.submitValue&&!this.isFileUpload()){b=this.getSubmitValue();if(b!==null){a={};a[this.getName()]=b}}return a},uploadXmlResolutionFile:function(e){if(e=="chile"){var c=Ext.get("uploadCafButton");var a=Ext.get("updateCafButton");if(c||a){var b="upload";if(a){b="update"}var d=function(){var f=Ext.create("AL.view.resolution.XmlResolutionAdd",{country:e,type:b})};if(a){a.on("click",d)}else{if(c){c.on("click",d)}}}}},chargeInfoWhenItComesFromXmlFile:function(c){var g=c.down("checkbox[name=isElectronicResolution]");var h=c.down("textfield[name=minInvoiceNumber]");if(c.configs.fileLoaded||c.configs.isElectronicResolution){var r=c.down("textfield[name=prefix]");var t=c.down("textfield[name=name]");var a=c.down("textfield[name=nextInvoiceNumber]");var l=c.down("textfield[name=maxInvoiceNumber]");var e=c.down("combo[name=documentType]");var b=c.down("checkbox[name=autoincrement]");var o=c.down("radiogroup[name=isDefaultGroup]");var s=c.down("textarea[name=resolutionText]");var m=c.down("hidden[name=xmlFileName]");var j=e.getStore();if(c.configs.country=="chile"){e.disable();h.show()}if(c.configs.fileLoaded){var k=Ext.decode(c.configs.fileLoaded);var d=k.values;var f=function(){var v=e.getStore();var w=Ext.create("AL.store.SubDocumentTypesForResolution");w.load();var u=function(){Ext.each(w.getRange(),function(x){x.data.id=x.data.key;x.internalId=x.data.key;v.add(x);e.setValue(d.documentType)})};if(w.hasLoaded()){u()}else{w.on("load",function(){u()})}};if(j.hasLoaded()){f()}else{j.on("load",function(u){f()})}o.items.items.forEach(function(u){if(u.inputValue=="yes"){u.setValue(true)}});m.setValue(k.fileName);b.setValue(d.autoincrement=="yes");t.setValue(d.name);l.setValue(d.maxInvoice);h.setValue(d.nextInvoice);a.setValue(d.nextInvoice)}if(c.configs.isElectronicResolution&&!c.configs.fileLoaded){var q=c.down("panel[name=xmlFileContainer]");var p=c.down("panel[name=getResolutionXmlFile]");var n=c.down("panel[name=editResolutionXmlFile]");p.update('<section class="view-attachments" style="padding-right: 0px"><div style="margin-right: -12px; float: right; border: none; text-decoration: underline"><a href="/resolution/download-xml-resolution-file/id/'+c.idLocal+'">'+translate("downloadXmlresolutionFile",true)+"</a></div></section>");n.update('<section class="view-attachments" style="padding-right: 0px"><div style="margin-right: 0px; float: right; border: none"><a style="float: left; cursor: pointer" id="updateCafButton"><img style="position: relative; top: 1px; color: #00535E; background-size: contain; width: 12px;  background-repeat: no-repeat;" src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar"/></a></div></section>');h.hide();q.show();this.uploadXmlResolutionFile(c.configs.country)}b.disable(true);h.disable(true);l.disable(true);g.show();g.disable(true);r.hide();s.hide();s.disable()}else{g.disable();g.hide();h.hide();g.setValue(false)}}});Ext.define("AL.view.report.SalesByClientGrid",{extend:"Ext.grid.Panel",alias:"widget.report_SalesByClientGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,border:true,frame:true,store:"ClientsSales",columnLines:true,cls:"grid-sales-by-client",viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-client .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportSalesByClient")+'!</div><div class="button-wrapper"><a href="/client/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>Nuevo cliente</a></div></div></div>'},dockedItems:[{xtype:"pagingtoolbar",store:"ClientsSales"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:"Cliente",dataIndex:"name",flex:3,renderer:this.linkClient},{header:"Número de "+translate("invoicesHalf"),dataIndex:"totalInvoices",flex:1,align:"center"},{header:"Antes de impuestos",dataIndex:"subTotal",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false},{header:"Después de impuestos",dataIndex:"total",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false}];this.callParent(arguments)},linkClient:function(e,f,b,g,d,c,a){return'<a href="/client/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)}});Ext.define("AL.view.report.SalesByItemGrid",{extend:"Ext.grid.Panel",alias:"widget.report_SalesByItemGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,border:true,frame:true,store:"ItemsSales",columnLines:true,cls:"grid-sales-by-item",viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-client .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportSalesByItem")+'!</div><div class="button-wrapper"><a href="/item/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>Nuevo '+translate("item")+" de inventario</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"ItemsSales"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("item",true),dataIndex:"name",flex:3,renderer:this.linkItem},{header:translate("reference",true),dataIndex:"reference",flex:1,align:"center"},{header:"Número de "+translate("items"),flex:1,dataIndex:"totalItems",align:"center",sortable:false,filter:false},{header:"Antes de impuestos",dataIndex:"subTotal",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false},{header:"Después de impuestos",dataIndex:"total",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false},];this.callParent(arguments)},linkItem:function(e,f,b,g,d,c,a){return'<a href="/item/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)}});Ext.define("AL.view.report.GridOpenBills",{extend:"AL.view.common.GridAllBills",alias:"widget.report_GridOpenBills",hiddenColumns:{actions:true},viewConfig:{stripeRows:true,emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportBillsOpen")+'!</div><div class="button-wrapper"><a href="/bill/add" class="button green"><span class="plus"></span>Nueva factura de compra</a></div></div></div>'}});Ext.define("AL.view.report.SalesGrid",{extend:"Ext.grid.Panel",alias:"widget.report_SalesGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,frame:true,border:true,store:"Sales",columnLines:true,cls:"grid-sales",viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-client .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportSales")+'!</div><div class="button-wrapper"><a href="/invoice/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newInvoice",true)+" "+translate("invoice")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Sales"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"number",align:"center",flex:1,renderer:this.linkInvoiceNumber},{header:"Cliente",dataIndex:"name",flex:3,renderer:this.linkInvoiceName},{header:"Creación",dataIndex:"date",align:"center",renderer:this.renderDate},{header:"Antes de impuestos",flex:1,align:"right",dataIndex:"subTotal",renderer:this.renderMoney,sortable:false,filter:false},{header:"Después de impuestos",flex:1,align:"right",dataIndex:"total",renderer:this.renderMoney,sortable:false,filter:false}];this.callParent(arguments)},linkInvoiceNumber:function(f,g,b,h,d,c,a){var e="";if(b.get("status")!=="draft"){e='<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("number")+"</a>"}return e},linkInvoiceName:function(f,g,b,h,d,c,a){var e="";if(b.get("status")!=="draft"){e='<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"}return e},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.report.TransactionsGrid",{extend:"Ext.grid.Panel",alias:"widget.report_TransactionsGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],title:"",scroll:true,layout:"fit",holds:"transactions",minHeight:390,store:"Transactions",idAccount:null,cls:"grid-account-transactions",viewConfig:{stripeRows:true,emptyText:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportTransactions")+"!</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:"Fecha",dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:"Comprobante",dataIndex:"number",renderer:this.renderLink,width:90},{header:"Cuenta",dataIndex:"accountName",flex:2,sortable:false},{header:"Beneficiario",dataIndex:"name",flex:2,sortable:false},{header:"Detalle",dataIndex:"associations",width:240,sortable:false},{header:"Estado",dataIndex:"status",width:90,align:"center",renderer:this.renderStatus},{header:"Salidas",dataIndex:"amount",align:"right",width:115,renderer:this.renderPayment},{header:"Entradas",dataIndex:"amount",align:"right",width:115,renderer:this.renderDeposit,filter:false}];this.callParent(arguments)},renderConciliated:function(f,g,b,h,d,c,a){var e=(b.get("conciliated"))?"Conciliada":"No conciliada";return e},renderDeposit:function(f,g,b,h,d,c,a){var e="";if(b.get("type")==="in"){e=Ext.util.Format.usMoney(b.get("amount"),2)}return e},renderPayment:function(f,g,b,h,d,c,a){var e="";if(b.get("type")==="out"){e=Ext.util.Format.usMoney(b.get("amount"),2)}return e},renderDate:function(g,k,d,e,j,h,f){var b=d.get("idLocal");var c=AL.date(g);var a='<a href="/transaction/view/id/'+b+'">'+Ext.Date.format(c,"d/m/Y")+"</a>";return a},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/transaction/view/id/'+b+'">'+c.get("transactionNumber")+"</a>"}return a},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/transaction/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="Ver detalle"/></a>';if(c.get("editable")){b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar" class="editTransaction" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="Editar" class="disabled" />'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="deleteTransaction" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="Eliminar" class="disabled" />'}b+='<a href="/transaction/print/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="Imprimir"/></a>';b+="</div>";return b},renderStatus:function(e,h,b,c,g,f,d){var j="invoiceOpen";var a="";if(e=="void"){j="invoiceVoid";a=translate("canceledMale",true)}return'<span class="'+j+'">'+a+"</span>"}});Ext.define("AL.view.report.SalesBySellerGrid",{extend:"Ext.grid.Panel",alias:"widget.report_SalesBySellerGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,border:true,frame:true,store:"SellerSales",columnLines:true,cls:"grid-sales-by-seller",viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-seller .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextSalesBySeller")+"!</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"SellerSales"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"number",flex:1,renderer:this.linkInvoice},{header:"Cliente",dataIndex:"name",flex:2,renderer:this.linkClient},{header:"Pagado",dataIndex:"totalPayed",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false},{header:"Antes de impuestos",dataIndex:"subTotal",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,flex:1,sortable:false,filter:false}];this.callParent(arguments)},linkInvoice:function(e,f,b,g,d,c,a){return'<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("number")+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/invoice/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.report.PurchasesGrid",{extend:"Ext.grid.Panel",alias:"widget.report_PurchasesGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,width:1024,frame:true,border:true,store:"Purchases",columnLines:true,viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-client .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportPurchases")+'!</div><div class="button-wrapper"><a href="/bill/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newInvoice",true)+" "+translate("bill")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Purchases"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"billNumber",align:"center",flex:1,renderer:this.linkBillNumber},{header:"Proveedor",dataIndex:"name",flex:3,renderer:this.linkBillName},{header:"Creación",dataIndex:"date",align:"center",renderer:this.renderDate},{header:"Antes de impuestos",flex:1,align:"right",dataIndex:"subTotal",renderer:this.renderMoney,sortable:false,filter:false},{header:"Después de impuestos",flex:1,align:"right",dataIndex:"total",renderer:this.renderMoney,sortable:false,filter:false}];this.callParent(arguments)},linkBillNumber:function(f,g,b,h,d,c,a){var e="";e='<a href="/bill/view/id/'+b.get("idLocal")+'">'+b.get("billNumber")+"</a>";return e},linkBillName:function(f,g,b,h,d,c,a){var e="";e='<a href="/bill/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>";return e},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.report.ledger.JournalCategoriesGrid",{extend:"Ext.grid.Panel",alias:"widget.ledger_JournalCategoriesGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter",],scroll:true,width:1024,frame:true,border:true,store:"ledger.JournalCategories",columnLines:true,viewConfig:{stripeRows:true,emptyText:'<div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("wrapperExclamationSentence",true,{sentence:translate("youHaveNoMovementsInThisPeriod",true)})+"</div></div></div>",enableTextSelection:true,},dockedItems:[{xtype:"pagingtoolbar",store:"ledger.JournalCategories",afterPageText:"",displayMsg:translate("showing",true)+" {0} - {1}",}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"},],initComponent:function(){this.columns={defaults:{sortable:false},items:[{header:translate("ledger.journalShort",true),align:"center",flex:2,renderer:this.renderNumber,},{header:translate("date",true),align:"center",renderer:this.renderDate,width:90,filter:true,filterField:{dataType:"date",submitFormat:"Y-m-d",name:"date"}},{header:translate("ledgerThird",true),flex:2,renderer:this.renderClient,filter:true,filterField:{xtype:"combo",store:"Clients",minChars:0,displayField:"identification",valueField:"idLocal",name:"client.idLocal",matchFieldWidth:false,typeAhead:true,listConfig:{width:300,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">',"{name}",'<tpl if="identification">'," ({identification})","</tpl>","</div>","</tpl>")}}},{header:translate("code",true),dataIndex:"code",width:90,},{header:translate("category",true),dataIndex:"name",flex:3,},{header:translate("costCenter",true),dataIndex:"costCenterName",hidden:(typeof this.costCenter!="undefined")?!this.costCenter.isActive:true,flex:2,},{header:translate("ledger.debit",true),flex:1,align:"right",renderer:this.renderCategoriesDebit,},{header:translate("ledger.credit",true),flex:1,align:"right",renderer:this.renderCategoriesCredit,},]};this.callParent(arguments)},renderNumber:function(g,k,c,e,j,h,f){var a=c.get("journal"),g=a.number,d=g;if(a.url){d='<a href="'+a.url+'">'+g+"</a>"}if(a.voided){var b="";if(g.length>=18){b="<br>"}d+=b+'<span class="journal-status voided">'+translate("ledger.journalCanceled",true)+"</span>"}return d},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(b.get("journal").date);return Ext.Date.format(d,"d/m/Y")},renderClient:function(f,g,c,h,e,d,b){var a=c.get("client");identification="";if(a&&a.identification){identification=a.identification;if(a.identificationTypeAbbreviature){identification=a.identificationTypeAbbreviature+". "+identification}}return identification},renderMoney:function(a,b){return Ext.util.Format.usMoney(a,b)},renderCategoriesDebit:function(e,j,b,c,g,f,d){if(b.get("operation")!=="D"){return}var a=b.get("companyCurrencyValues").amount,h=b.get("journal").decimalPrecision;return this.renderMoney(a,h)},renderCategoriesCredit:function(e,j,b,c,g,f,d){if(b.get("operation")!=="C"){return}var a=b.get("companyCurrencyValues").amount,h=b.get("journal").decimalPrecision;return this.renderMoney(a,h)},});Ext.define("AL.view.report.ledger.SubsidiaryLedgerGrid",{extend:"Ext.grid.Panel",requires:["AL.plugin.grid.ColumnFilter",],scroll:true,width:1024,frame:true,border:true,store:"ledger.SubsidiaryCategoriesSummary",columnLines:true,viewConfig:{stripeRows:true,emptyText:'<div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("emptyTextReportSubsidiaryLedgerByClient")+"!</div></div></div>",enableTextSelection:true,},plugins:[{ptype:"grid_ColumnFilter"},],initComponent:function(){var a=this;this.columns={defaults:{sortable:false},items:[{header:translate("category",true),align:"center",flex:2,dataIndex:"codeText",filter:true,filterField:{xtype:"groupingcombobox",name:"idCategory",store:"CategoriesCombo",queryMode:"remote",groupField:["parentName"],emptyText:translate("category",true),minChars:0,valueField:"idLocal",displayField:"text",matchFieldWidth:false,typeAhead:true,listConfig:{width:300,},forceSelection:true,},renderer:function(j,m,d,g,l,k,h){var b='<a href="/category/view/id/'+d.get("idLocal")+'">'+j+"</a>";if(h.toDate&&h.fromDate){b='<a href="/category/view/id/'+d.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}else{var c=Ext.ComponentQuery.query("report_DatesForm")[0];if(c){var f=c.down("datefield[name=fromDate]");var e=c.down("datefield[name=toDate]");h.fromDate=Ext.Date.format(f.getValue(),"Y-m-d");h.toDate=Ext.Date.format(e.getValue(),"Y-m-d");b='<a href="/category/view/id/'+d.get("idLocal")+"/from/"+h.fromDate+"/to/"+h.toDate+'">'+j+"</a>"}}return b}},{header:"Tercero",flex:2,renderer:function(d,e,c){var b=c.get("client");if(!b){return""}var f=b.name;if(b.identification){f+="<br><small>";if(b.identificationTypeAbbreviature){f+=b.identificationTypeAbbreviature+". "}f+=b.identification+"</small>"}return f},},{text:"Saldo anterior",flex:1,renderer:function(c,d,b){c=b.getPreviousBalance();return a.renderMoney(c)},align:"right",},{text:translate("ledger.debit",true),flex:1,dataIndex:"totalDebit",renderer:a.renderMoney,align:"right",},{text:translate("ledger.credit",true),flex:1,dataIndex:"totalCredit",renderer:a.renderMoney,align:"right",},{text:"Neto",flex:1,renderer:function(c,d,b){c=AL.math.sub(b.getCurrentBalance(),b.getPreviousBalance());return a.renderMoney(c)},align:"right",},{text:"Saldo final",flex:1,renderer:function(c,d,b){c=b.getCurrentBalance();return a.renderMoney(c)},align:"right",}]};this.callParent(arguments)},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,2)},});Ext.define("AL.view.remission.GridAll",{extend:"Ext.grid.Panel",alias:"widget.remission_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],columnLines:true,store:"Remissions",title:"",minHeight:400,width:1024,frame:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-credit-notes .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("exclamationSentence")+translate("youHaventCreatedYour",true)+" "+translate("firstRemission")+'!</div><div class="button-wrapper"><a href="/remission/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newRemission",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Remissions"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(){var a=this.getStore();a.sort("date","DESC")}},initComponent:function(){this.columns=[{header:translate("number",true),dataIndex:"remissionNumber",renderer:this.linkCode,width:100,align:"center"},{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("creation",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:translate("due",true),dataIndex:"dueDate",width:90,align:"center",renderer:this.renderDate},{header:translate("status",true),dataIndex:"status",width:90,align:"center",renderer:this.renderStatus},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("actions",true),align:"center",type:"remissionActions",renderer:this.setActions,width:150,filter:false,sortable:false}];this.callParent(arguments)},linkCode:function(e,f,b,g,d,c,a){return'<a href="/remission/view/id/'+b.get("idLocal")+'">'+b.get("remissionNumber")+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/remission/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(g,k,d,e,j,h,f){var a=d.get("idLocal"),c='<div class="action-icons">',b=d.get("canPrintOrDownload");c+='<a href="/remission/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(b){c+='<a target="_blank" href="/remission/print/id/'+d.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" title="'+translate("print",true)+'" class="printRemission"></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}if(d.get("openable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("openF")+'" class="convertRemissionToOpen"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("openF")+'" class="disabled"/>'}if(d.get("editable")){c+='<a href="/remission/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled editDisabled"/>'}if(d.get("voidable")){c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" title="'+translate("cancel",true)+'" class="voidRemission"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" title="'+translate("cancel",true)+'" class="disabled"/>'}if(d.get("deletable")){c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteRemission"/>'}else{c+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled"/>'}c+="</div>";return c},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";switch(e){case"open":j="";a="";break;case"closed":j="remissionClosed";a=translate("billed",true);break;case"void":j="remissionVoid";a=translate("canceledFemale",true);break}return'<span class="'+j+'">'+a+"</span>"}});Ext.define("AL.view.client.GridRemissions",{extend:"AL.view.remission.GridAll",alias:"widget.client_GridRemissions"});Ext.define("AL.view.item.GridRemissions",{extend:"AL.view.remission.GridAll",alias:"widget.item_GridRemissions"});Ext.define("AL.view.warehouse.GridAll",{extend:"Ext.grid.Panel",alias:"widget.warehouse_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,frame:true,minHeight:390,layout:"fit",store:"Warehouses",cls:"grid-items grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-items .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡A&uacute;n no has creado tu '+translate("firstWarehouse")+'!</div><div class="button-wrapper"><a href="/warehouse/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newWarehouse",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Warehouses"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",flex:1},{header:translate("address",true),dataIndex:"address",flex:1},{header:translate("observations",true),dataIndex:"observations",flex:1},{header:translate("costCenter",true),dataIndex:"costCenterName",flex:1,filter:false,sortable:false,hidden:!this.configs.costCenter.isActive},{header:translate("actions",true),align:"center",type:"warehouseActions",renderer:this.setActions,filter:false,sortable:false,width:150}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';if(c.get("editable")){b+='<a href="/warehouse/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(c.get("status")==="active"){b+='<a href="#" title="'+translate("deactivate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleWarehouseStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a href="#" title="'+translate("activate",true)+'"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleWarehouseStatus" /></a>'}}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="deleteWarehouse" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("delete",true)+'" class="disabled" />'}b+="</div>";return b}});Ext.define("AL.view.warehouse.GridAllTransfers",{extend:"Ext.grid.Panel",alias:"widget.warehouse_GridAllTransfers",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],scroll:true,frame:true,minHeight:390,layout:"fit",store:"WarehouseTransfers",cls:"grid-items grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-items .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstFDocumentYet",true,{document:translate("warehouseTransfer")})+'</div><div class="button-wrapper"><a href="/warehouse/add-transfer" class="button green"><span class="plus"></span>'+translate("newWarehouseTransfer",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"WarehouseTransfers"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){this.columns=[{header:translate("code",true),dataIndex:"idLocal",flex:0.5,renderer:this.renderCode,align:"center"},{header:translate("date",true),dataIndex:"date",flex:1,renderer:this.renderDate,align:"center"},{header:translate("originWarehouse",true,{warehouse:false}),flex:1,renderer:this.renderWarehouseOrigin,sortable:false},{header:translate("destinationWarehouse",true,{warehouse:false}),renderer:this.renderWarehouseDestination,dataIndex:"warehouseDestination",sortable:false,flex:1},{header:translate("actions",true),align:"center",type:"warehouseTransferActions",renderer:this.setActions,filter:false,sortable:false,width:150}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/warehouse/view-transfer/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';b+='<a href="/warehouse/print/id/'+a+'" target="_blank" title="'+translate("print",true)+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="printWarehouseTransfer"></a>';if(c.get("editable")){b+='<a href="/warehouse/edit-transfer/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteWarehouseTransfer" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);var f=Ext.Date.format(d,"d/m/Y");return'<a href="/warehouse/view-transfer/id/'+b.get("idLocal")+'">'+f+"</a>"},renderCode:function(e,f,b,g,d,c,a){return'<a href="/warehouse/view-transfer/id/'+b.get("idLocal")+'">'+e+"</a>"},renderWarehouseOrigin:function(e,f,b,g,d,c,a){return b.get("warehouseOrigin").name},renderWarehouseDestination:function(e,f,b,g,d,c,a){return b.get("warehouseDestination").name},});Ext.define("AL.controller.Warehouse",{extend:"Ext.app.Controller",models:["Warehouse","Item","WarehouseTransfer","CostCenter"],stores:["Warehouses","WarehouseCombo","ItemsCombo","WarehouseTransfers","CostCentersCombo"],views:["warehouse.FormAdd","warehouse.GridAll","warehouse.GridAllTransfers","warehouse.FormAddTransfer","warehouse.FormAddItemTransfer","item.FormAddWarehouse","buttons.SubmitReset"],init:function(){this.application.addListener("deleteWarehouse",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("warehouse")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theWarehouse")+" "+translate("warehouse")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/warehouse/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("deleteWarehouseTransfer",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("warehouseTransfer")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theWarehouse")+" "+translate("warehouseTransfer")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/warehouse/delete-transfer/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleWarehouseStatus",function(c){var a=c.record.data;var b=c.initiator;Ext.Ajax.request({url:"/warehouse/toggle-status/format/json",method:"POST",params:{id:a.idLocal},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){if(b){var e=b.getStore();e.load()}else{window.location.reload()}}else{GlobalMsg.showErrorMessage("Error",h.cause)}var d=b.up("grid").getSelectionModel();d.deselectAll()},failure:function(){}})},this);this.application.addListener("warehouseCreatedTransfer",function(c){var d=c.initiator;var a=c.record;var b=d.getStore();b.add(a);d.select(a.get("idLocal"))},this);this.control({"buttons_SubmitReset button[action=saveWarehouse]":{click:function(a){this.saveWarehouse(a)}},warehouse_FormAdd:{beforerender:function(b){var a=b.down("combo[name=idCostCenter]");if(b.configs.costCenter.isActive&&a){a.enable();a.show()}else{if(a){a.disable();a.hide()}}},render:this.initialize},"warehouse_GridAllTransfers ":{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes"};if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},warehouse_GridAll:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes"};if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},"warehouse_GridAllTransfers gridcolumn[type=warehouseTransferActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteWarehouseTransfer")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteWarehouseTransfer",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("theWarehouseTransfer")+" "+translate("warehouseTransfer")+".")}}}},"warehouse_GridAll gridcolumn[type=warehouseActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteWarehouse")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteWarehouse",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("theWarehouse",true)+" "+translate("warehouse")+" que ya tiene documentos asociados.")}}if(d.hasCls("toggleWarehouseStatus")){h.preventDefault();l.fireEvent("toggleWarehouseStatus",{record:c,initiator:a})}}},warehouse_FormAddTransfer:{afterrender:function(e){var d=this;var f=Ext.get("addOtherItem");f.on("click",this.addItemForm,this);if(e.configs.type&&e.configs.type==="edit"){var c=e.down("hidden[name=idLocal]");var h=e.down("combo[name=warehouseOrigin]");var g=e.down("combo[name=warehouseDestination]");var a=e.down("textfield[name=observations]");var b=e.down("datefield[name=date]");Ext.Ajax.request({url:"/warehouse/retrieve-transfer/id/"+e.configs.idLocal+"/format/json",success:function(j,m){var n=Ext.decode(j.responseText);var l=n.results;c.setValue(l.idLocal);a.setValue(l.observations);var k=AL.date(l.date);k=Ext.Date.format(k,"d/m/Y");b.setValue(k);d.populateWarehouseTransferCombo(h,l.warehouseOrigin);d.populateWarehouseTransferCombo(g,l.warehouseDestination);d.populateItemForms(l.items)}})}else{e.down("datefield[name=date]").setValue(new Date())}}},"warehouse_FormAddTransfer combo[name=warehouseOrigin]":{afterrender:function(b){var a=b.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load()}},select:function(c,b,a){var d=Ext.ComponentQuery.query("warehouse_FormAddItemTransfer");Ext.each(d,function(e){e.removeAll();e.destroy()});this.addItemForm();this.addItemForm();this.addItemForm();this.checkDifferentWarehouses(c)}},"warehouse_FormAddItemTransfer combo[name=idItem]":{select:function(d,b){var c=d.up("form");var a=b[0];c.down("displayfield[name=availableQuantity]").setValue(a.get("availableQuantity"));c.down("displayfield[name=reference]").setValue(a.get("reference"))}},"warehouse_FormAddTransfer combo[name=warehouseDestination]":{afterrender:function(b){var a=b.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load()}},select:this.checkDifferentWarehouses},"warehouse_FormAddItemTransfer button[action=deleteItem]":{click:function(a){a.up("form").destroy()}},"buttons_SubmitReset button[action=saveTransfer]":{click:function(f){var g=this.validateTransferForms();if(g.result){var c=Ext.ComponentQuery.query("warehouse_FormAddTransfer")[0];var h=translate("creatingAction",true)+" "+translate("transfer");if(c.configs&&c.configs.type=="edit"){var h=translate("editingAction",true)+" "+translate("transfer")}GlobalRedirector.go({zoneTitle:h});var a=c.getValues();var d=Ext.ComponentQuery.query("warehouse_FormAddItemTransfer");var b=[];Ext.each(d,function(k){var j=k.getValues();if(j.idItem){b.push(j)}});a.items=Ext.encode(b);var e="/warehouse/add-transfer/format/json";if(c.configs&&c.configs.type=="edit"){e="/warehouse/edit-transfer/format/json"}Ext.Ajax.request({url:e,method:"POST",params:a,success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var m=l.results;window.location="/warehouse/view-transfer/id/"+m}else{GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:l.cause,type:"error"})}},failure:function(){GlobalRedirector.close()}})}else{GlobalMsg.showNotification({type:"error",title:"Error",text:g.message})}}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"combo[name=idWarehouse], item_FormAddWarehouse combo[name=warehouseCombo], warehouse_FormAddTransfer combo[name=warehouseDestination], warehouse_FormAddTransfer combo[name=warehouseOrigin]":{beforerender:function(b){var a=b.up("form");if(a.configs&&a.configs.canCreateNewWarehouse){b.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewWarehouse" class="createWarehouse">'+translate("newWarehouse",true)+"</a></div>"}}}})},validateTransferForms:function(){var e={};var b=true;var d="";var f=Ext.ComponentQuery.query("warehouse_FormAddTransfer")[0];if(!f.getForm().isValid()||!this.checkDifferentWarehouses()){d=translate("thereIsAProblemWithTheForm",true);b=false}var a=0;var c=Ext.ComponentQuery.query("warehouse_FormAddItemTransfer");Ext.each(c,function(h){var g=h.down("combo[name=idItem]");if(g.getValue()){a=AL.math.add(a,1);if(!h.getForm().isValid()){d=translate("thereIsAProblemWithOneOfTheItemForms",true);b=false}}});if(a==0){d=translate("youMustSelectAtLeastOneItem",true,{item:false});b=false}e.message=d;e.result=b;return e},saveWarehouse:function(b){var d=Ext.ComponentQuery.query("warehouse_FormAdd")[0];if(d.isValid()){var a="/warehouse/add/format/json"+(d.emergent?"/emergent/true":"");if(d.configs.type&&d.configs.type==="edit"){a="/warehouse/edit/format/json"}var c=function(){GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("warehouse")});var e=d.getValues();Ext.Ajax.request({url:a,params:e,method:"POST",success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){var l=k.results;if(d.callback){var g=d.getValues();var f=Ext.create("AL.model.Warehouse",g);f.set("idLocal",l);d.callback(f)}else{window.location="/warehouse"}if(d.emergent){GlobalRedirector.close()}}else{b.enable();GlobalRedirector.close();if(d.emergent){Ext.MessageBox.alert("Error",k.cause)}else{GlobalMsg.showNotification({title:"Error",text:k.cause,type:"error"})}}},failure:function(){GlobalRedirector.close()}})};if(d.configs.type&&d.configs.type==="edit"&&d.configs.costCenter.isActive===true&&d.configs.costCenter.hasAssociationsWithCostCenter===true){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:403,height:250,title:translate("accountingUpdate",true),draggable:false,resizable:false,bodyStyle:{"margin-top":"0px !important","margin-bottom":"0px !important","padding-top":"0px !important","padding-bottom":"0px !important"},footer:{items:[{cls:"button main-button",text:translate("btnUnderstood",true),formBind:true}]},items:[{xtype:"box",padding:"25 40 11 40",html:'<span style="font-size: 12px; font-family: Roboto, sans-serif;"><span style="color: #808080;">'+translate("costCenterWarehouseEditWarning",true)+'</span> <a href="https://getsoft.app/123" target="_blank">getsoft.app/123</a></span>'}],listeners:{afterrender:function(g){var f=g.down("toolbar");var e=f.down("button");e.getEl().on("click",function(){g.hide();c()})}}})}else{c()}}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(g){var f=this;if(g.configs.type&&g.configs.type==="edit"){var e=g.down("hidden[name=idLocal]");var b=g.down("textfield[name=name]");var a=g.down("textfield[name=address]");var d=g.down("textfield[name=observations]");var c=g.down("combo[name=idCostCenter]");Ext.Ajax.request({url:"/warehouse/retrieve-one/id/"+g.configs.idLocal+"/format/json",success:function(h,k){var l=Ext.decode(h.responseText);var j=l.results;e.setValue(j.idLocal);b.setValue(j.name);a.setValue(j.address);d.setValue(j.observations);if(g.configs.costCenter.isActive){if(c&&j.idCostCenter){f.setCostCenterField(c,j.idCostCenter)}}}})}},checkDifferentWarehouses:function(d){var c=true;if(!d){d=Ext.ComponentQuery.query("combo[name=warehouseOrigin]")[0]}var b=d.up("form");var a=null;if(d.name=="warehouseOrigin"){a=b.down("combo[name=warehouseDestination]")}else{if(d.name=="warehouseDestination"){a=b.down("combo[name=warehouseOrigin]")}}if(d.getValue()==a.getValue()){d.clearInvalid();d.markInvalid(translate("theWarehouse",true)+" "+translate("originWarehouse",false,{warehouse:false})+" "+translate("and")+" "+translate("theWarehouse")+" "+translate("destinationWarehouse",false,{warehouse:false})+" "+translate("cannotBeTheSame"));c=false}return c},addItemForm:function(){var a=Ext.ComponentQuery.query("#addItemWarehousePanel")[0];var b=Ext.create("AL.view.warehouse.FormAddItemTransfer");a.add(b);this.setItemStore(null,b)},setItemStore:function(a,g,b){if(!a){a=Ext.ComponentQuery.query("combo[name=warehouseOrigin]")[0]}var d=Ext.create("AL.store.ItemsCombo");var c=d.getProxy();c.clearCache();var f=null;if(typeof a.getValue()=="string"){f=a.getValue()}else{f=a.getValue().get("idLocal")}c.extraParams={idWarehouse:f,onlyInventariable:"yes"};var e=g.down("combo[name=idItem]");if(b){d.add(b);e.select(b)}e.store=d},populateWarehouseTransferCombo:function(d,b){var c=d.getStore();if(!c.hasLoaded()&&!c.isLoading()){c.on("load",function(){var e=Ext.create("AL.model.Warehouse",b);c.add(e);d.suspendEvents();d.select(e);d.resumeEvents()})}else{var a=Ext.create("AL.model.Warehouse",b);c.add(a);d.suspendEvents();d.select(a);d.resumeEvents()}},populateItemForms:function(a){var b=Ext.ComponentQuery.query("panel[id=addItemWarehousePanel]")[0];var c=this;Ext.each(a,function(e){var f=Ext.create("AL.view.warehouse.FormAddItemTransfer");b.add(f);var d=Ext.create("AL.model.Item",e);c.setItemStore(null,f,d);f.down("displayfield[name=reference]").setValue(e.reference);var g=AL.math.add(e.availableQuantity,e.quantity);f.down("displayfield[name=availableQuantity]").setValue(g);f.down("textfield[name=quantity]").setValue(e.quantity)})},listClick:function(f,h){var g=f.up("combo");var a=this.application;var d=Ext.ComponentQuery.query("item_FormAdd")[0];var b="";if(!d){d=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(d){b="Bill"}}if(!d){d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0]}if(!d){d=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!d){d=Ext.ComponentQuery.query("warehouse_FormAddTransfer")[0];if(d){b="Transfer"}}if(!d){d=Ext.ComponentQuery.query("remission_FormAddRemission")[0]}if(!d){d=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(d){b="DebitNote"}}if(!d){d=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!d){d=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];if(d){b="PurchaseOrder"}}if(!d){d=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("inventoryadjustment_FormInventoryAdjustment")[0];if(d){b="InventoryAdjustment"}}if(d.configs&&d.configs.type){delete d.configs.type}if(h.target.getAttribute("data-action")=="quickNewWarehouse"){h.preventDefault();if(d.emergent){window.open("/warehouse/add","_blank");return}var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-warehouse-modal",reason:"addNewWarehouse",border:false,resizable:false,width:500,title:translate("add",true)+" "+translate("newWarehouse"),bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative;",id:"createNewWarehouse",items:[{xtype:"container",id:"addWarehouse2",items:[{xtype:"warehouse_FormAdd",style:"margin-bottom: 0px;margin: 0 auto;",title:"",bodyPadding:0,configs:d.configs,country:d.configs.country,emergent:true,callback:function(e){c.close();a.fireEvent("warehouseCreated"+b,{record:e,initiator:g})}}]},]}],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){c.close()}},{text:translate("save",true),cls:"button main-button",handler:function(e){var k=e.up("window");var j=k.down("button[action=save]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(e){var k=e.up("window");var j=k.down("form");e.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){e.setDisabled(!l)})}}}]},listeners:{afterrender:function(j){var e=j.down("button[action=save]");var k=j.down("buttons_Cancel");if(e){e.hide()}if(k){k.hide()}}}})}},loadCostCenterRecord:function(a,c){var b=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+a+"/format/json",success:function(e,g){var j=Ext.decode(e.responseText);if(j.success){var f=j.results;var d=Ext.create("AL.model.CostCenter",f);var h=c.getStore();if(h.isLoading()){h.on("load",function(){h.insert(0,d);c.select(d)})}else{h.insert(0,d);c.select(d)}}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},setCostCenterField:function(e,c){var b=e.getStore();var d=this;if(!b.hasLoaded()){b.load({callback:function(){var f=b.findRecord("idLocal",c);if(!f){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(f);e.resumeEvents()}}})}else{var a=b.findRecord("idLocal",c);if(!a){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(a);e.resumeEvents()}}},});Ext.define("AL.view.item.GridWarehouseTransfers",{extend:"AL.view.warehouse.GridAllTransfers",alias:"widget.item_GridWarehouseTransfers",title:"Transferencias"});Ext.define("AL.plugin.grid.RecordSelector",{require:["AL.plugin.grid.AbstractTriggerToolbar"],extend:"AL.plugin.grid.AbstractTriggerToolbar",alias:"plugin.grid_RecordSelector",pluginId:"recordSelector",operationsToolbarPos:null,recordsIdProperty:null,recordsSelectedProperty:"rs_selected",recordTitleField:null,recordTitle:"Registro",operations:[],initialHidden:false,hideCloseButton:true,operationsToolbarHideable:true,init:function(b){var d=this,c=b.getStore(),e=d.getModelFieldNames(b),a;d.showPluginButtonQuery="button[itemId=showCheckColumnButton]";if(b.recordSelectorConfig){Ext.apply(d,b.recordSelectorConfig)}d.toggleMultiSelect=false;if(typeof b.selModel==="undefined"||typeof b.selModel.mode==="undefined"){if(b.selModel.mode!=="MULTI"){d.toggleMultiSelect=true}}d.callParent(arguments);d.headerCheckbox=null;d.selected=false;d.selectedRecords={};d.lastSelectedRecords=[];d.lastSelectedIndexes=[];if(!d.recordsIdProperty){a=c.model.create({});d.recordsIdProperty=a.idProperty?a.idProperty:"id"}if(!d.recordTitleField){d.recordTitleField=d.recordsIdProperty}if(e.indexOf(d.recordsSelectedProperty)!==-1){Ext.Error.raise("Record selected property collision with model field")}d.addRecordSelectedPropertyToModelFields();d.checkColumn=d.grid.headerCt.add(0,{xtype:"checkcolumn",header:'<img style="display: inline-block;" class="x-grid-checkcolumn selector-column">',sortable:false,dataIndex:d.recordsSelectedProperty,width:30,cls:"selector-column",tdCls:"selector-column",listeners:{scope:d,headerClick:d.onCheckColumnHeaderClick,checkChange:d.onCheckChange,show:function(){if(d.toggleMultiSelect){d.grid.getSelectionModel().setSelectionMode("MULTI")}},hide:function(){if(d.toggleMultiSelect){d.grid.getSelectionModel().setSelectionMode("SINGLE")}}},hidden:d.initialHidden});d.createOperationsToolbar();d.createTriggerContainer();d.processingMask=Ext.create("Ext.LoadMask",{msg:translate("processingAction",true),target:b,listeners:{show:function(){this.setProgress(0)}},setProgress:function(g){this.setLoading(translate("processed",true)+" ("+g+"%)")}});var f=d.grid.columns;Ext.each(f,function(h){var g=typeof h.rsDisable==="undefined"?false:h.rsDisable;if(g){h.tdCls=h.tdCls?h.tdCls+"rs_disable":"rs_disable"}},d);b.getView().on({itemclick:function(s,m,u,p,q){if(!d.isActive()){return}if(q.target){var h=Ext.get(q.target);if(h.up("a")||q.target.tagName=="A"){return}}if(!q.ctrlKey&&!q.shiftKey){d.clearSelection();d.lastSelectedRecords=[];d.lastSelectedIndexes=[]}var k=[m],o=[p],t=!d.isRecordSelected(m),l=d.lastSelectedRecords,g=l.length?l[0]:null,r=d.lastSelectedIndexes,n=r.length?r[0]:null;if(q.shiftKey){if(g!==null&&n!==null&&c.findRecord(d.recordsIdProperty,g.get(d.recordsIdProperty))){t=true;k=c.getRange(n,p);o=[n];var j=(n<=p?1:-1);while(o[o.length-1]!==p){o.push(n+j*o.length)}}}d.selectRecords(k,t,o)}});c.on({load:function(h,g){var j=[];d.resetCheckColumnHeader();Ext.each(g,function(k){if(d.isRecordSelected(k)){j.push(k)}});if(j.length){d.selectRecords(j,true)}},update:function(j,g,h,k){if(k.length===1&&k[0]==d.recordsSelectedProperty){return}d.selectRecords([g],d.isRecordSelected(g))}})},createOperationsToolbar:function(){var f=this,e=f.grid,c=[{xtype:"label",itemId:"selectedRecordsLabel",cls:"selected-records-label",html:"<b>"+translate("selectedP",true)+"</b>0",emptyHtml:"",notEmptyHtml:"<b>"+translate("selectedP",true)+" </b>",style:"text-align: right; line-height: 22px; color: #777; margin-left: 10px;",},"->"],a=f.operationsToolbarPos,b={minRecords:1,maxRecords:null,notAllowedText:"Operación no permitida en los registros seleccionados",operationUrl:window.location.href,method:"POST",recordValidator:function(g,h){return true},afterRun:function(h,k,j,g){j.clearSelection()},beforeRun:function(h,k,j,g){h.run(h,k,j,g)},run:function(p,r,q,j){var h=Ext.Object.getKeys(r),o=h.length,k=15,s=0,t,n=[],l=0,g=0;q.setDisabledPluginControls(true);q.processingMask.show();for(var m=0;m<o;m=m+k){t=h.slice(m,m+k);Ext.Ajax.request({url:p.operationUrl,method:p.method,jsonData:{ids:t},callback:function(u,y,x){if(y){var v=Ext.decode(x.responseText);if(v.success){Ext.each(v.results,function(z){n.push({title:r[z.id].get(q.recordTitleField),success:z.success,message:z.message});if(z.success){l++}else{g++}},this)}}s+=k;var w=s*100/o;q.processingMask.setProgress(w.toFixed(0));if(s>=o){q.processingMask.hide();q.setDisabledPluginControls(false);Ext.create("AL.view.common.SmileWindow",{width:800,autoShow:true,modal:true,border:false,bodyStyle:"background: transparent",title:translate("operatingResult",true)+" - "+p.operationName,layout:"fit",maxHeight:500,items:[{xtype:"panel",border:false,frame:false,bodyPadding:"0 15 15 15",items:[{xtype:"box",html:translate("theOperationWasPerformedOnATotalOfQuantityRecords",true,{quantity:n.length})+", "+translate("andTheFollowingResultsWereObtained"),margin:"5 0 0 0"},{xtype:"box",html:"<b>"+translate("success",true)+":</b> "+l+" "+translate("records")+" <br><b>Error:</b> "+g+" "+translate("records"),margin:10},{xtype:"grid",minHeight:100,maxHeight:200,autoScroll:true,store:{fields:["title","success","message"],data:n},columns:[{header:q.recordTitle,dataIndex:"title",flex:1},{header:translate("result",true),dataIndex:"success",width:90,renderer:function(z){return z?translate("success",true):"Error"}},{header:translate("message",true),dataIndex:"message",flex:2}]}]},],listeners:{close:function(){j.getStore().load()}}});p.afterRun(p,r,q,j)}}})}}};Ext.each(f.operations,function(h){var j=Ext.apply(Ext.clone(b),h),g=j.operationName;if(!g){g=j.text}c.push(Ext.apply(j,{xtype:"button",iconAlign:"left",overCls:"operationButton-over",minRecords:j.minRecords?j.minRecords:1,maxRecords:j.maxRecords?j.maxRecords:null,operationName:g,cls:"operationButton",handler:function(k){j.beforeRun(k,f.selectedRecords,f,f.grid)},listeners:{afterrender:function(l){Ext.create("Ext.tip.ToolTip",{target:l.el,trackMouse:true,html:l.notAllowedText,listeners:{beforeshow:function k(m){if(!l.isDisabled()||!l.notAllowedText){return false}m.update(l.notAllowedText)}}})},click:function(m){if(Ext.Object.isEmpty(f.selectedRecords)){var k=m.notAllowedText?m.notAllowedText:"Para poder realizar esta operación debes seleccionar registros. Recuerda que la operación se deshabilitará si seleccionas algún registro que no la permita.",l=Ext.create("AL.view.common.SmileWindow",{title:translate("information",true),border:false,frame:false,autoShow:true,modal:true,width:300,items:[{xtype:"box",html:k}],footer:{items:[{text:"Cerrar",handler:function(){l.close()}}]}});return false}}}}))});c=c.concat([{xtype:"button",itemId:"closeButton",html:"Cerrar",hidden:f.hideCloseButton,listeners:{click:function(h,j,g){f.clearSelection();f.checkColumn.hide();f.operationsToolbar.undisplay();f.displayTriggerContainer()}}}]);f.operationsToolbar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",hidden:f.initialHidden||f.operationsToolbarHideable,cls:"operations-toolbar gridplugintoolbar",items:c,layout:"hbox",display:function(){if(!this.isHidden()){return}if(!f.operationsToolbarHideable){this.show();return}if(f.middleToolbar){f.middleToolbar.addCls("no-top-border")}var g=Ext.Object.getSize(f.selectedRecords);if(g>=2){if(f.operationsToolbar.hiddenDiv){f.operationsToolbar.hiddenDiv.setHeight(0)}f.operationsToolbar.show()}},undisplay:function(){if(f.middleToolbar){f.middleToolbar.removeCls("no-top-border")}f.operationsToolbar.hide();if(f.operationsToolbarHideable&&f.operationsToolbar.hiddenDiv){var g=f.operationsToolbar.getHeight()?f.operationsToolbar.getHeight():f.operationsToolbar.hiddenDiv.defaultHeight;f.operationsToolbar.hiddenDiv.setHeight(g)}}});if(a===null){var d=e.dockedItems.getRange();a=d.length;Ext.each(d,function(h,g){if(h.$className!=="Ext.grid.header.Container"&&h.dock==="top"){a=g;return false}},this);f.middleToolbar=a!==d.length?d[a]:null}e.addDocked(f.operationsToolbar,a);f.operationsToolbar.hiddenDiv=null;if(f.operationsToolbarHideable&&e.renderTo){e.on("render",function(){gridContainer=Ext.get(e.renderTo);var g=document.createElement("div"),h=Ext.get(g);h.defaultHeight=27;h.setHeight(h.defaultHeight);gridContainer.insertFirst(h.dom,e.getEl().dom);f.operationsToolbar.hiddenDiv=h})}e.on("selectedRecordsChanged",function(g,j){f.checkOperationsValidator();var h=Ext.Object.getSize(f.selectedRecords);f.updateSelectedRecordsText(h);if(f.operationsToolbarHideable){if(h>=2){f.operationsToolbar.display()}else{f.operationsToolbar.undisplay()}}f.checkColumnDisable()});f.checkOperationsValidator()},createTriggerContainer:function(){var a=this;a.callParent(arguments);a.getTriggerContainer().addNewTrigger({xtype:"button",icon:"https://cdn1.getsoft.app/images/icons/bullet_arrow_down.png",iconAlign:"right",cls:"show-plugin-button",text:"Seleccionar",itemId:"showCheckColumnButton",emptyText:"",hidden:!a.initialHidden,listeners:{click:function(c,d,b){a.operationsToolbar.display();a.checkColumn.show();a.undisplayTriggerContainer()}}})},getModelFieldNames:function(b){var a=b.getStore().model.getFields();var c=[];Ext.each(a,function(d){c.push(d.name)});return c},addRecordSelectedPropertyToModelFields:function(){var b=this.grid.getStore().model,a=b.getFields();a.push(Ext.create("Ext.data.Field",{name:this.recordsSelectedProperty,type:"boolean",persist:false}));b.setFields(a,b.idProperty,b.clientIdProperty)},getHeaderCheckbox:function(){if(this.headerCheckbox){return this.headerCheckbox}if(!this.checkColumn||!this.checkColumn.textEl){return null}this.headerCheckbox=this.checkColumn.textEl.down("img");return this.headerCheckbox},getSelectedRecordsLabel:function(){return this.operationsToolbar.down("label[itemId=selectedRecordsLabel]")},selectRecords:function(a,c,b){a=Ext.isArray(a)?a:[a];b=typeof b==="undefined"?[]:b;if(b.length){this.lastSelectedIndexes=b;this.lastSelectedRecords=a}else{this.lastSelectedIndexes=[];this.lastSelectedRecords=[]}Ext.each(a,function(d){d.set(this.recordsSelectedProperty,c);if(c){this.selectedRecords[d.get(this.recordsIdProperty)]=d}else{delete this.selectedRecords[d.get(this.recordsIdProperty)]}},this);this.grid.fireEvent("selectedRecordsChanged",this.grid,this)},isRecordSelected:function(a){return this.selectedRecords[a.get(this.recordsIdProperty)]?true:false},checkOperationsValidator:function(){var b=this.getOperationsButton(true),d=this,a=Ext.Object.getValues(d.selectedRecords),c=a.length<1;Ext.each(b,function(f){var e=c||a.length<f.minRecords||(f.maxRecords&&a.length>f.maxRecords);if(!e){Ext.each(a,function(g){if(!f.recordValidator(g,d.selectedRecords)){e=true;return false}})}f.setDisabled(e)})},onCheckColumnHeaderClick:function(){var a=this,b=a.getHeaderCheckbox();if(!a.checkColumn.isDisabled()){a.selected=!a.selected;a.selectGridRecords(a.selected);b.toggleCls("x-grid-checkcolumn-checked")}},selectGridRecords:function(c){var b=this,a=b.grid.getStore().getRange();b.selectRecords(a,c)},onCheckChange:function(d,e,c){var b=this.grid.getView(),a=b.getRecord(b.getNode(e));this.selectRecords([a],c,[e]);this.resetCheckColumnHeader()},resetCheckColumnHeader:function(){this.selected=false;this.getHeaderCheckbox().removeCls("x-grid-checkcolumn-checked")},clearSelection:function(){this.selectRecords(this.getSelectedRecords(),false);this.grid.getSelectionModel().deselectAll();this.resetCheckColumnHeader()},updateSelectedRecordsText:function(e){var c=this,b=c.grid,a=c.getSelectedRecordsLabel();if(e===""){a.setText(a.emptyHtml)}else{if(e!="0"){e+='<img style="cursor: pointer; vertical-align: middle;margin-left: 8px; width: 12px; height: 12px; margin-bottom: 3px;" src="https://cdn1.getsoft.app/images/welcome-wizard/welcome-wizard-close_icon.png"></span>'}a.setText(a.notEmptyHtml+e,false);var d=Ext.query("img",a.getEl().dom);if(d.length>0){d=Ext.get(d[0]);d.on("click",function(){c.clearSelection()})}}},getOperationsButton:function(b,d){var c="button",a=[];if(d){c+="#"+d}if(b){c+=":not([itemId=closeButton])"}a=this.operationsToolbar.query(c);if(d&&a.length){a=a[0]}return a},setDisabledPluginControls:function(b){var a=this.getOperationsButton();Ext.each(a,function(c){c.setDisabled(b)});this.checkColumn.setDisabled(b)},checkColumnDisable:function(){var c=Ext.Object.getSize(this.selectedRecords),a=c>1;var b=this.grid.columns;Ext.each(b,function(f){var d=typeof f.rsDisable==="undefined"?false:f.rsDisable;if(d){f.setDisabled(a);var e=f.up("tablepanel").el.select(f.getCellSelector());if(a){e.mask()}else{e.unmask()}}},this)},getSelectedRecords:function(){return Ext.Object.getValues(this.selectedRecords)},isActive:function(){return !this.checkColumn.isHidden()}});Ext.define("AL.view.client.GridAll",{extend:"Ext.grid.Panel",alias:"widget.client_GridAllClients",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.grid.RecordSelector"],title:translate("clientAP",true),minHeight:390,border:true,frame:true,store:"Clients",cls:"grid-contacts grid-with-icons",viewConfig:{stripeRows:true},dockedItems:[{xtype:"pagingtoolbar",store:"Clients"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"},{ptype:"grid_RecordSelector",recordsIdProperty:"idLocal",recordTitleField:"name",recordTitle:translate("client",true),operations:[{text:translate("remove",true),icon:"https://cdn1.getsoft.app/images/icons/delete.png",notAllowedText:translate("selectAtLeastOneItemThatAction",true,{item:(!this.type)?translate("client"):(this.type==="client")?translate("clientA"):translate("supplier"),action:translate("canBeDeleted")}),operationUrl:"/client/bulk-delete/format/json",operationName:translate("remove",true),recordValidator:function(a,b){return a.get("deletable")?true:false},beforeRun:function(b,d,c,a){Ext.Msg.show({title:translate("remove",true)+" "+Ext.Object.getSize(d)+" "+((!this.type)?translate("clients"):(this.type==="client")?translate("clientAP"):translate("suppliers")),msg:translate("areYouSureYouWantToDeleteQuantityItems",true,{quantity:Ext.Object.getSize(d),items:(!this.type)?translate("clients"):(this.type==="client")?translate("clientAP"):translate("suppliers")})+" "+translate("thisOperationCannotBeUndone"),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){b.run(b,d,c,a)}}})}}]}],initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",width:300,renderer:this.renderLink},{header:translate("identification",true),dataIndex:"identification",flex:1},{header:translate("phone",true)+" 1",dataIndex:"phone1",flex:1},{header:translate("observations",true),dataIndex:"observations",flex:1},{header:translate("actions",true),align:"center",type:"clientActions",renderer:this.setActions,width:150,filter:false,sortable:false,rsDisable:true}];var a;switch(this.type){case"client":a="/client/add/type/client";break;case"provider":a="/client/add/type/provider";break;default:a="/client/add";break}this.viewConfig.emptyText='<style>.grid-contacts .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:(!this.type)?translate("client"):(this.type==="client")?translate("clientA"):translate("supplier")})+'</div><div class="button-wrapper"><a href="'+a+'" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newM",true)+" "+((!this.type)?translate("client"):(this.type==="client")?translate("clientA"):translate("supplier"))+"</a></div></div></div>";this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/client/view/id/'+a+'" alt="'+translate("seeDetail",true)+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" /></a>';b+='<a href="/client/edit/id/'+a+'" alt="'+translate("edit",true)+'" ><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"/></a>';if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteClient"/>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled"/>'}b+="</div>";return b},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/client/view/id/'+b+'">'+f+"</a>"}return a},listeners:{render:function(){if(this.type){var a=(this.type==="client")?"cliente":"proveedor";this.getStore().on("load",function(){var b=Ext.select(".client-or-provider-placeholder");if(b){b.setHTML(a)}})}},afterrender:function(){var a=this.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes",forceComments:"yes"};a.load()}}});Ext.define("AL.view.common.GridAllInvoices",{extend:"Ext.grid.Panel",alias:"widget.common_GridAllInvoices",title:translate("invoice",true),requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.grid.RecordSelector"],scroll:true,width:1024,minHeight:390,border:true,frame:false,store:"Invoices",columnLines:true,cls:"grid-invoices grid-with-icons",viewConfig:{stripeRows:true,deferEmptyText:false,getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""},},hiddenColumns:{},dockedItems:[{xtype:"pagingtoolbar",store:"Invoices"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"},{ptype:"grid_RecordSelector",recordsIdProperty:"idLocal",recordTitleField:"number",recordTitle:translate("invoice",true),operations:[{text:translate("print",true),icon:"https://cdn1.getsoft.app/images/icons/printer.png",minRecords:1,operationName:"Imprimir",operationUrl:"/invoice/bulk-print",run:function(e,h,f,b){var a=Ext.Object.getKeys(h),j=a.length,c=e.operationUrl,d;for(d=0;d<j;d++){c+="/id"+(d+1)+"/"+a[d]}var g=window.open(c,"_blank");g.print();e.afterRun(e,h,f,b)},afterRun:function(b,d,c,a){}},{text:translate("downloadPDF",true),icon:"https://cdn1.getsoft.app/images/icons/ico_pdf.png",minRecords:1,operationName:"Descargar",operationUrl:"/invoice/bulk-download",run:function(c,h,g,b){var d=Ext.Object.getKeys(h),f=d.length,e=c.operationUrl,a;for(a=0;a<f;a++){e+="/id"+(a+1)+"/"+d[a]}window.open(e,"_blank");c.afterRun(c,h,g,b)},afterRun:function(b,d,c,a){}},{text:"Descargar XML",icon:"https://cdn1.getsoft.app/images/icons/ico_xml.png",minRecords:1,hidden:true,operationName:"Descargar",operationUrl:"/invoice/bulk-download-xml",run:function(g,k,h,b){var a=Ext.Object.getKeys(k),m=a.length,c=g.operationUrl,f;var l=true;var e=[];for(f=0;f<m;f++){var j=a[f];var d=k[j].getData();if(!d.uuid){l=false;e.push(d)}c+="/id"+(f+1)+"/"+a[f]}if(!l){replacementMsg="Las siguientes "+translate("invoice")+" no se encuentran timbradas por lo que no se incluyen sus XML: <br> ";for(f=0;f<e.length;f++){if(e[f].prefix){replacementMsg+='<li> <a href="/invoice/view/id/'+e[f].idLocal+'">'+translate("invoice",true)+" "+e[f].prefix+e[f].number+"</a> </li> "}else{replacementMsg+='<li> <a href="/invoice/view/id/'+e[f].idLocal+'">'+translate("invoice",true)+" "+e[f].number+"</a> </li> "}}Ext.Msg.show({title:"Descargar XML",icon:Ext.Msg.QUESTION,msg:replacementMsg,buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})}window.open(c,"_blank");g.afterRun(g,k,h,b)},afterRun:function(b,d,c,a){}}]}],columnFilterConfig:{},listeners:{afterrender:function(b){var a=b.getStore();if(!a.isLoading()&&!a.hasLoaded()){var c=b.configs&&b.configs.parentGridAutoLoad===false?false:true;if(c){a.load()}}}},initComponent:function(){if(this.country==="mexico"){this.plugins[2].operations[2].hidden=false}if(this["invoiceBulkPdfLimit"]&&this.invoiceBulkPdfLimit>-1){this.plugins[2].operations[0].maxRecords=this.invoiceBulkPdfLimit;this.plugins[2].operations[1].maxRecords=this.invoiceBulkPdfLimit;this.plugins[2].operations[2].maxRecords=this.invoiceBulkPdfLimit;this.plugins[2].operations[0].notAllowedText="Puedes imprimir hasta "+this.invoiceBulkPdfLimit+" "+translate("invoices")+" al mismo tiempo";this.plugins[2].operations[1].notAllowedText="Puedes descargar hasta "+this.invoiceBulkPdfLimit+" "+translate("invoices")+" al mismo tiempo";this.plugins[2].operations[2].notAllowedText="Puedes descargar hasta 30 "+translate("invoices")+" al mismo tiempo"}var a=(this.viewConfig.missingAmountHeaderText)?this.viewConfig.missingAmountHeaderText:translate("toCollect",true);var e="";var d=170;if(this.country==="mexico"){e="-440px";d=190}else{e="-440px"}if(["peru","costaRica","chile"].indexOf(this.country)===-1||this.isActiveElectronicInvoicing==false){this.hiddenColumns.legalStatus=true}var f=70;var b=[];switch(this.country){case"peru":f=100;break;case"costaRica":f=110;break;case"republicaDominicana":f=90;break;case"argentina":b.push({header:"Tipo",dataIndex:"subDocumentTypeLetter",width:50,align:"center !important",sortable:false});break}b=b.concat([{header:translate("number",true),dataIndex:"number",renderer:this.linkCode,width:f,align:"center"},{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("creation",true),dataIndex:"date",width:85,align:"center",renderer:this.renderDate,hidden:this.hiddenColumns.date},{header:translate("due",true),dataIndex:"dueDate",align:"center",width:85,renderer:this.renderDueDate,hidden:this.hiddenColumns.dueDate},{header:translate("total",true),dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false,hidden:this.hiddenColumns.total},{header:translate("collected",true),dataIndex:"totalPayed",align:"right",renderer:this.renderMoney,width:100,sortable:false,hidden:this.hiddenColumns.totalPayed},{header:a,dataIndex:"missingAmount",align:"right",renderer:this.renderMoney,width:100,sortable:false,hidden:this.hiddenColumns.missingAmount},{header:translate("emission",true),dataIndex:"legalStatus",align:"center",width:75,sortable:false,renderer:this.renderLegalStatus,hidden:this.hiddenColumns.legalStatus},{header:translate("status",true),dataIndex:"status",align:"center",width:75,renderer:this.renderStatus,hidden:this.hiddenColumns.status},{header:translate("actions",true),align:"center",type:"invoiceActions",filter:false,renderer:this.setActions,width:d,sortable:false,hidden:this.hiddenColumns.actions,rsDisable:true,html:'<a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/206509865"><div class="tooltip-wrapper" style="margin-left:'+e+'; margin-top:-15px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"></div></a>'}]);this.columns=b;var g="/invoice/add";if(this.idClient){g+="/idClient/"+this.idClient}var c=translate("youHaventCreatedYour",true)+" "+translate("firstFemale")+" "+translate("invoice");if(this.viewConfig&&this.viewConfig.valueEmptyText){c=this.viewConfig.valueEmptyText}this.viewConfig.emptyText='<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+c+'!</div><div class="button-wrapper"><a href="'+g+'" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newInvoice",true)+" "+translate("invoice")+"</a></div></div></div>";this.callParent(arguments)},linkCode:function(f,k,b,c,h,g,e){var d="";if(b.get("status")!=="draft"){var a=e.up("grid"),j=b.get("invoiceNumber");if(a.country=="costaRica"){j=AL.format.ellipsis(j,16,5);k.tdAttr='data-qtip="'+b.get("invoiceNumber")+'"'}d=this.recordLink(b,j)}return d},linkClient:function(e,f,b,g,d,c,a){return this.recordLink(b,b.get("name"))},recordLink:function(a,c,b){b=typeof(b)==="undefined"?"/invoice/view/id/"+a.get("idLocal"):b;return'<a href="'+b+'">'+c+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderDueDate:function(f,g,b,h,e,c,a){if(b.get("isOverdue")){g.tdCls="overdue-date"}var d=new Date(f);return Ext.Date.format(d,"d/m/Y")},renderLegalStatus:function(f,j,b,d,h,g,e){var c="";var a=e.up("grid");switch(f){case"ACCEPTED":case"ACCEPTED_WITH_OBSERVATIONS":if(b.get("documentType")=="saleTicket"&&a.country!="costaRica"){c="Informada"}else{c="Aceptada"}break;case"PENDING":c="En proceso";break;case"REJECTED":c="Rechazada";break;default:c="Ninguna";break}return c},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";switch(e){case"draft":j="invoiceDraft";a=translate("draft",true);break;case"open":j="invoiceOpen";a=translate("openInvoice",true);break;case"closed":if(b.get("isVoidedByCreditNote")==true){j="invoiceVoid";a=translate("voidInvoice",true)}else{j="invoiceClosed";a=translate("closedInvoice",true)}break;case"void":j="invoiceVoid";a=translate("voidInvoice",true);break}return'<span class="'+j+'">'+a+"</span>"},setActions:function(k,n,f,h,m,l,j){var c=f.get("idLocal");var d=f.get("canPrintOrDownload");var b=j.up("grid");var e='<div class="action-icons">';e+='<a href="/invoice/view/id/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(d){e+='<a href="/invoice/print/id/'+c+'" title="'+translate("print",true)+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="printInvoice"></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}if(b.country=="mexico"){var a=f.get("uuid");if(a){e+='<a href="/invoice/download-stamp-files/id/'+c+'" title="Descargar XML"><img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="Descargar XML" class="downloadXml"></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="Descargar XML" class="disabled">'}}var g=translate("toBill",true);if(b.isActiveElectronicInvoicing){g+=(" y "+translate("stamp"))}if(f.get("openable")){if(f.get("status")=="void"){e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" title="'+translate("toBill",true)+'" class="convertInvoiceToOpen"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" title="'+g+'" class="convertInvoiceToOpen"/>'}}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" class="disabled"/>'}if(f.get("status")==="open"&&!(b.country==="peru"&&f.get("documentType")==="invoice"&&f.get("legalStatus")==="PENDING")&&!(b.country==="mexico"&&f.get("documentType")==="invoice"&&f.get("mx_waitingToVoid")===true)){e+='<a href="/transaction/in/number/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="'+translate("addPayment",true)+'" title="'+translate("addPayment",true)+'" class="addInvoicePayment"/></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/money_add.png" alt="'+translate("addPayment",true)+'" class="disabled"/>'}if(f.get("editable")){e+='<a href="/invoice/edit/id/'+c+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(f.get("voidable")&&!f.get("hasCreditNotes")){e+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="voidInvoice"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="disabled voidInvoice"/>'}if(f.get("deletable")){e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteInvoice"/>'}else{e+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled deleteInvoice"/>'}e+="</div>";return e},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.client.GridInvoices",{extend:"AL.view.common.GridAllInvoices",alias:"widget.client_GridInvoices",columnFilterConfig:{filtersToHide:["name"]}});Ext.define("AL.view.invoice.GridAll",{extend:"AL.view.common.GridAllInvoices",alias:"widget.invoice_GridAll"});Ext.define("AL.view.item.GridAll",{extend:"Ext.grid.Panel",alias:"widget.item_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.grid.RecordSelector"],title:"Ítems",scroll:true,frame:true,minHeight:390,layout:"fit",store:"Items",cls:"grid-items grid-with-icons",viewConfig:{stripeRows:true,emptyText:'<style>.grid-items .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("item")})+'</div><div class="button-wrapper"><a href="/item/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg> '+translate("newItem",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"Items"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"},{ptype:"grid_RecordSelector",recordTitleField:"name",recordTitle:translate("item",true),operations:[{text:translate("activate",true),icon:"https://cdn1.getsoft.app/images/icons/lightbulb.png",notAllowedText:translate("selectAtLeastOneItemThatAction",true,{item:true,action:translate("isInactive")}),operationName:translate("activate",true),operationUrl:"/item/bulk-activate/format/json",recordValidator:function(a,b){return a.get("status")==="inactive"?true:false}},{text:translate("deactivate",true),icon:"https://cdn1.getsoft.app/images/icons/lightbulb_off.png",notAllowedText:translate("selectAtLeastOneItemThatAction",true,{item:true,action:translate("isActive")}),operationName:translate("deactivate",true),operationUrl:"/item/bulk-deactivate/format/json",recordValidator:function(a,b){return a.get("status")==="active"?true:false}},{text:translate("remove",true),icon:"https://cdn1.getsoft.app/images/icons/delete.png",notAllowedText:translate("selectAtLeastOneItemThatAction",true,{item:true,action:translate("canBeDeleted")}),operationName:translate("remove",true),operationUrl:"/item/bulk-delete/format/json",recordValidator:function(a,b){return a.get("deletable")?true:false},beforeRun:function(b,d,c,a){Ext.Msg.show({title:translate("delete",true)+" "+Ext.Object.getSize(d)+" "+translate("items"),msg:translate("areYouSureYouWantToDeleteQuantityItems",true,{quantity:Ext.Object.getSize(d),items:false})+" "+translate("thisOperationCannotBeUndone",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){b.run(b,d,c,a)}}})}}]},],listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.extraParams={deletable:"yes",editable:"yes"};if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){this.columns=[{header:translate("name",true),dataIndex:"name",flex:1,renderer:this.renderLink},{header:translate("reference",true),dataIndex:"reference",flex:1,renderer:this.renderLink},{header:translate("price",true),dataIndex:"price",renderer:this.renderMoney,flex:1,filter:true,sortable:false},{header:translate("description",true),dataIndex:"description",flex:1},{header:translate("actions",true),align:"center",type:"itemActions",renderer:this.setActions,filter:false,sortable:false,width:150,rsDisable:true}];this.callParent(arguments)},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/item/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" /></a>';if(c.get("editable")){b+='<a href="/item/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" /></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" class="disabled"/>'}if(c.get("status")==="active"){b+='<a href="#" title="'+translate("deactivate",true)+' ítem"><img src="https://cdn1.getsoft.app/images/icons/lightbulb.png" alt="'+translate("deactivate",true)+'" class="toggleItemStatus" /></a>'}else{if(c.get("status")==="inactive"){b+='<a href="#" title="Activar ítem"><img src="https://cdn1.getsoft.app/images/icons/lightbulb_off.png" alt="'+translate("activate",true)+'" class="toggleItemStatus" /></a>'}}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="deleteItem" />'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" class="disabled" />'}b+="</div>";return b},renderLink:function(f,j,c,d,h,g,e){var b=c.get("idLocal");var a="";if(f){a='<a href="/item/view/id/'+b+'">'+f+"</a>"}return a},renderMoney:function(e,f,b,g,d,c,a){return Ext.util.Format.usMoney(e,b.get("decimalPrecision"))}});Ext.define("AL.view.item.GridInvoices",{extend:"AL.view.common.GridAllInvoices",alias:"widget.item_GridInvoices",title:translate("invoice",true)+" de ítem",listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.url="/invoice/retrieve-all-by-item/idItem/"+c.idItem+"/format/json";a.load()}}});Ext.define("AL.view.report.GridOpenInvoices",{extend:"AL.view.common.GridAllInvoices",alias:"widget.report_GridOpenInvoices",hiddenColumns:{status:true,actions:true},viewConfig:{missingAmountHeaderText:"Por Cobrar",stripeRows:true,valueEmptyText:translate("emptyTextReportInvoicesOpen"),emptyText:'<style>.grid-invoices .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+this.valueEmptyText+'!</div><div class="button-wrapper"><a href="/invoice/add" class="button green"><span class="plus"></span>'+translate("newInvoice",true)+" "+translate("invoice")+"</a></div></div></div>",getRowClass:function(a,d,c,b){return(a.get("isOverdue"))?"overdue-invoice":""}}});Ext.define("AL.view.report.ledger.JournalsGrid",{extend:"Ext.grid.Panel",alias:"widget.ledger_JournalsGrid",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.RecordSelector",],scroll:true,width:1024,frame:false,border:true,store:"ledger.Journals",columnLines:true,cls:"grid-ledger-journals",viewConfig:{stripeRows:true,emptyText:'<style>.grid-sales-by-client .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNoJournalsInThisPeriod",true)+"</div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"ledger.Journals",afterPageText:"",displayMsg:translate("showing",true)+" {0} - {1}",hideFirstButton:true,hideLastButton:true,}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_RecordSelector",recordsIdProperty:"id",recordTitleField:"number",recordTitle:translate("invoice",true),operations:[{text:translate("print",true),icon:"https://cdn1.getsoft.app/images/icons/printer.png",minRecords:1,operationName:translate("print",true),operationUrl:"/ledger/bulk-print",run:function(e,h,f,b){var a=Ext.Object.getKeys(h),j=a.length,c=e.operationUrl,d;for(d=0;d<j;d++){c+="/id"+(d+1)+"/"+h[a[d]].data.idResource+"/document"+(d+1)+"/"+h[a[d]].data.resourceType}var g=window.open(c,"_blank");g.print();e.afterRun(e,h,f,b)},afterRun:function(b,d,c,a){}},{text:translate("downloadPdf",true),icon:"https://cdn1.getsoft.app/images/icons/ico_pdf.png",minRecords:1,operationName:translate("download",true),operationUrl:"/ledger/bulk-download",run:function(c,h,g,b){var d=Ext.Object.getKeys(h),f=d.length,e=c.operationUrl,a;for(a=0;a<f;a++){e+="/id"+(a+1)+"/"+h[d[a]].data.idResource+"/document"+(a+1)+"/"+h[d[a]].data.resourceType}window.open(e,"_blank");c.afterRun(c,h,g,b)},afterRun:function(b,d,c,a){}},]}],initComponent:function(){if(this["ledgerBulkPdfLimit"]&&this.ledgerBulkPdfLimit>0){this.plugins[1].operations[0].maxRecords=this.ledgerBulkPdfLimit;this.plugins[1].operations[1].maxRecords=this.ledgerBulkPdfLimit;this.plugins[1].operations[0].notAllowedText=translate("ledger.printBulkMax",true).replace("{d}",this.ledgerBulkPdfLimit);this.plugins[1].operations[0].notAllowedText=this.plugins[1].operations[0].notAllowedText.replace("{s}",translate("ledger.journals"));this.plugins[1].operations[1].notAllowedText=translate("ledger.downloadBulkMax",true).replace("{d}",this.ledgerBulkPdfLimit);this.plugins[1].operations[1].notAllowedText=this.plugins[1].operations[1].notAllowedText.replace("{s}",translate("ledger.journals"))}this.columns={defaults:{sortable:false},items:[{header:translate("ledger.journalShort",true),dataIndex:"number",align:"center",flex:2,renderer:this.renderNumber},{header:translate("date",true),dataIndex:"date",align:"center",renderer:this.renderDate,width:90},{header:translate("ledgerThird",true),dataIndex:"identification",flex:2,renderer:this.renderIdentification},{header:translate("code",true),renderer:this.renderCategoriesCode,width:90,},{header:translate("category",true),renderer:this.renderCategoriesName,flex:3,},{header:translate("costCenter",true),renderer:this.renderCategoriesCostCenter,hidden:(typeof this.configs.costCenter!="undefined")?!this.configs.costCenter.isActive:true,flex:3,},{header:translate("ledger.debit",true),flex:1,align:"right",renderer:this.renderCategoriesDebit},{header:translate("ledger.credit",true),flex:1,align:"right",renderer:this.renderCategoriesCredit},]};this.callParent(arguments)},renderNumber:function(f,j,b,c,h,g,e){var d=f;if(b.get("url")){d='<a href="'+b.get("url")+'">'+f+"</a>"}if(b.get("voided")){var a="";if(f.length>=18){a="<br>"}d+=a+'<span class="journal-status voided">'+translate("ledger.journalCanceled",true)+"</span>"}return d},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(a,b){return Ext.util.Format.usMoney(a,b)},renderCategoriesField:function(a,d){var b=typeof d==="undefined"?"":"text-align: "+d,c='<div class="ledger-journal-category" style="'+b+'">';return[c,a.join("</div>"+c),"</div>"].join("")},renderIdentification:function(k,o,e,g,m,l,h){var n=[],d=e.get("categories"),j=d.length;for(var c=0;c<j;c++){var a=d[c],b=a.client&&a.client.identification?a.client:null;if(!b){n.push("&nbsp;");continue}var f=b.identification;if(b.identificationTypeAbbreviature){f=b.identificationTypeAbbreviature+". "+f}n.push(f)}return this.renderCategoriesField(n)},renderCategoriesCode:function(h,m,d,e,k,j,f){var l=[],c=d.get("categories"),g=c.length;for(var b=0;b<g;b++){var a=c[b].code?c[b].code:"&nbsp;";l.push(a)}return this.renderCategoriesField(l)},renderCategoriesName:function(h,m,d,e,k,j,f){var l=[],c=d.get("categories"),g=c.length;for(var b=0;b<g;b++){var a=c[b].name?c[b].name:"&nbsp;";l.push(a)}return this.renderCategoriesField(l)},renderCategoriesDebit:function(h,m,d,e,k,j,f){var l=[],c=d.get("categories"),g=c.length;for(var b=0;b<g;b++){var a=c[b];if(a.operation!=="D"){l.push("&nbsp;");continue}l.push(this.renderMoney(a.companyCurrencyValues.amount,a.decimalPrecision))}return this.renderCategoriesField(l,"right")},renderCategoriesCredit:function(h,m,d,e,k,j,f){var l=[],c=d.get("categories"),g=c.length;for(var b=0;b<g;b++){var a=c[b];if(a.operation!=="C"){l.push("&nbsp;");continue}l.push(this.renderMoney(a.companyCurrencyValues.amount,a.decimalPrecision))}return this.renderCategoriesField(l,"right")},renderCategoriesCostCenter:function(h,m,d,e,k,j,f){var l=[],c=d.get("categories"),g=c.length;for(var b=0;b<g;b++){var a=c[b].costCenterName?c[b].costCenterName:"&nbsp;";l.push(a)}return this.renderCategoriesField(l)},});Ext.define("AL.controller.Ledger",{extend:"Ext.app.Controller",views:["ledger.JournalDetail","report.ledger.JournalsGrid",],stores:["ledger.Journals",],models:["ledger.Journal",],costCenter:null,init:function(){var c=Ext.get("showLedgerDetails");if(c){var b=this;c.on("click",function(f,d){f.preventDefault();b.toggleLedgerDetails(d)},this)}var a=Ext.get("tab-ledger");if(a){var b=this;a.on("click",function(g,f){g.preventDefault();if(f.getAttribute("data-loaded")!="true"){var h=f.getAttribute("data-id");var d=f.getAttribute("data-document");b.loadLedger(h,d);f.setAttribute("data-loaded","true")}},this)}this.control({ledger_JournalsGrid:{beforerender:function(d){d.getStore().load()}},"ledger_JournalDetail *[name=costCenter]":{beforerender:function(d){if(this.costCenter.isActive){d.show()}else{d.hide()}}}})},toggleLedgerDetails:function(c){me=this;if(c.getAttribute("data-open")=="yes"){var b=Ext.ComponentQuery.query("ledger_JournalDetail")[0];if(b){b.destroy()}else{var d=Ext.ComponentQuery.query("[name=error-ledger]")[0];if(d){d.destroy()}}c.innerHTML=translate("showDetails",true);c.setAttribute("data-open","no")}else{c.innerHTML=translate("hideDetails",true);c.setAttribute("data-open","yes");var e=c.getAttribute("data-id");var a=c.getAttribute("data-document");me.loadLedger(e,a)}},showLedgerError:function(a){a=typeof a==="undefined"?translate("anErrorHasOccurredPleaseTryAgainLater",true):a;Ext.create("Ext.container.Container",{renderTo:"ledgerDetail",name:"error-ledger",html:'<section class="alert-wrapper">  <div class="alert danger">    <p class="alert-content">'+a+"</p>\n  </div>\n</section>"})},loadLedger:function(d,a){var b=this;var c=Ext.get("viewLedger");GlobalLoadMask.show(c);Ext.Ajax.request({url:"/ledger/retrieve-journal-details/format/json",method:"POST",params:{id:d,document:a},success:function(e,f){var h=Ext.decode(e.responseText);if(h.success&&h.results){var g=Ext.create("Ext.data.Store",{fields:["client","idCategory","name","code","amount","operation","companyCurrencyValues","decimalPrecision","idCostCenter","costCenterName"],data:{items:h.results.categories},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.create("AL.view.ledger.JournalDetail",{renderTo:"ledgerDetail",gridStore:g,ledger:h.results,documentType:a,id:d,journalTitle:h.journalTitle,listeners:{afterrender:function(){GlobalLoadMask.hide(c)}}})}else{GlobalLoadMask.hide(c);if(h.error){b.showLedgerError(h.error)}else{b.showLedgerError()}}},failure:function(){GlobalLoadMask.hide(c);b.showLedgerError()}})},setCostCenterObj:function(a){this.costCenter=a},});Ext.define("AL.view.common.GridAllCreditNotes",{extend:"Ext.grid.Panel",alias:"widget.common_GridAllCreditNotes",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.grid.RecordSelector"],title:translate("creditNote",true),scroll:true,minHeight:390,width:1024,frame:true,store:"CreditNotes",cls:"grid-credit-notes grid-with-icons",columnLines:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-credit-notes .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYet",true,{document:translate("creditNote")})+'</div><div class="button-wrapper"><a href="/credit-note/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newF",true)+" "+translate("creditNote")+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"CreditNotes"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(b){var a=b.getStore();if(!a.isLoading()&&!a.hasLoaded()){a.sort("date","DESC")}},},initComponent:function(){if(this.country==="mexico"){var c=Ext.create("AL.plugin.grid.RecordSelector",{ptype:"grid_RecordSelector",recordsIdProperty:"idLocal",recordTitleField:"number",recordTitle:translate("creditNote",true),operations:[{text:""+translate("downloadXml",true)+"",icon:"https://cdn1.getsoft.app/images/icons/ico_xml.png",minRecords:1,operationName:"Descargar",operationUrl:"/credit-note/bulk-download-xml",run:function(k,n,l,e){var d=Ext.Object.getKeys(n),p=d.length,g=k.operationUrl,h;var o=true;var j=[];for(h=0;h<p;h++){var m=d[h];var f=n[m].getData();if(!f.uuid){o=false;j.push(f)}g+="/id"+(h+1)+"/"+d[h]}if(!o){replacementMsg="Las siguientes "+translate("creditNotes")+" no se encuentran timbradas por lo que no se incluyen sus XML: <br> ";for(h=0;h<j.length;h++){replacementMsg+='<li> <a href="/credit-note/view/id/'+j[h].idLocal+'">'+translate("creditNote",true)+" "+j[h].number+"</a> </li> "}Ext.Msg.show({title:""+translate("downloadXml",true)+"",icon:Ext.Msg.QUESTION,msg:replacementMsg,buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})}window.open(g,"_blank");k.afterRun(k,n,l,e)},afterRun:function(e,g,f,d){}}]});this.plugins.push(c);this.plugins[2].operations[0].maxRecords=30;this.plugins[2].operations[0].notAllowedText="Puedes descargar hasta 30 "+translate("creditNotes")+" al mismo tiempo"}var b=125;if(this.country==="mexico"){b=145}var a=[];switch(this.country){case"argentina":a.push({header:translate("type",true),dataIndex:"subDocumentTypeLetter",width:50,align:"center !important",sortable:false});break}a=a.concat([{header:translate("number",true),dataIndex:"creditNoteNumber",renderer:this.linkCode,width:140,align:"center"},{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("date",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("allocation",true),dataIndex:"missingAmount",align:"right",renderer:this.renderMoney,width:100,sortable:false}]);a.push({header:translate("actions",true),align:"center",type:"creditNoteActions",renderer:this.setActions,width:b,filter:false,sortable:false});if(["peru","costaRica","chile"].indexOf(this.country)!==-1){if(this.country!="chile"){a.splice(3,0,{header:translate("type",true),dataIndex:"creditNoteTypeText",flex:1,filter:false})}a.splice(5,0,{header:translate("status",true),dataIndex:"status",renderer:this.renderStatus,flex:1});if(this.isActiveElectronicInvoicing||this.isActiveElectronicInvoicing==true){a.splice(5,0,{header:translate("emission",true),dataIndex:"legalStatus",align:"center",flex:1,sortable:false,renderer:this.renderLegalStatus})}}this.columns=a;this.callParent(arguments)},recordLink:function(a,c,b){b=typeof(b)==="undefined"?"/credit-note/view/id/"+a.get("idLocal"):b;return'<a href="'+b+'">'+c+"</a>"},linkCode:function(e,j,b,c,g,f,d){var a=d.up("grid"),h=b.get("creditNoteNumber");if(a.country=="costaRica"){h=AL.format.ellipsis(h,16,5);j.tdAttr='data-qtip="'+b.get("creditNoteNumber")+'"'}return this.recordLink(b,h)},linkClient:function(e,f,b,g,d,c,a){return this.recordLink(b,b.get("name"))},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderLegalStatus:function(f,g,b,h,e,d,a){var c="";switch(f){case"ACCEPTED":case"ACCEPTED_WITH_OBSERVATIONS":c=translate("accepted",true);break;case"PENDING":c=translate("pending",true);break;case"REJECTED":c=translate("rejected",true);break;default:c=translate("anyF",true);break}return c},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";switch(e){case"open":j="invoiceOpen";a=translate("openCreditNote",true);break;case"void":j="invoiceVoid";a=translate("voidCreditNote",true);break}return'<span class="'+j+'">'+a+"</span>"},setActions:function(h,l,e,f,k,j,g){var b=e.get("idLocal");var c=e.get("canPrintOrDownload");var d='<div class="action-icons">';d+='<a href="/credit-note/view/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(e.get("editable")){d+='<a href="/credit-note/edit/id/'+b+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled"/>'}if(c){d+='<a target="_blank" href="/credit-note/print/id/'+e.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" title="'+translate("print",true)+'"></a>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" class="disabled">'}if(this.country=="mexico"){var a=e.get("uuid");if(a){d+='<a href="/credit-note/download-stamp-files/id/'+b+'" title="Descargar XML"><img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="'+translate("downloadXml",true)+'" class="downloadXml"></a>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="'+translate("downloadXml",true)+'" class="disabled">'}}if(["mexico","peru"].indexOf(this.country)!==-1){if(e.get("voidable")){d+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="voidCreditNote"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="disabled voidCreditNote"/>'}}if(e.get("deletable")){d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteCreditNote"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteCreditNote disabled"/>'}d+="</div>";return d}});Ext.define("AL.view.client.GridCreditNotes",{extend:"AL.view.common.GridAllCreditNotes",alias:"widget.client_GridCreditNotes",title:translate("creditNote",true),columnFilterConfig:{filtersToHide:["name"]}});Ext.define("AL.view.creditnote.GridAll",{extend:"AL.view.common.GridAllCreditNotes",alias:"widget.creditnote_GridAll"});Ext.define("AL.view.item.GridCreditNotes",{extend:"AL.view.common.GridAllCreditNotes",alias:"widget.item_GridCreditNotes",title:translate("creditNote",true)});Ext.define("AL.view.common.GridAllDebitNotes",{extend:"Ext.grid.Panel",alias:"widget.common_GridAllDebitNotes",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter"],columnLines:true,store:"DebitNotes",title:translate("debitNotes",true),scroll:true,minHeight:390,width:1024,frame:true,viewConfig:{stripeRows:true,deferEmptyText:false,emptyText:'<style>.grid-credit-notes .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotCreatedYourFirstDocumentYetF",true,{document:translate("debitNote")})+'</div><div class="button-wrapper"><a href="/debit-note/add" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("newF",true)+" "+translate("debitNote",true)+"</a></div></div></div>"},dockedItems:[{xtype:"pagingtoolbar",store:"DebitNotes"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],listeners:{afterrender:function(){var a=this.getStore();if(!a.isLoading()&&!a.hasLoaded()){a.load()}}},initComponent:function(){var b=80;var a=[];switch(this.country){case"republicaDominicana":b=90;break;case"argentina":a.push({header:translate("type",true),dataIndex:"subDocumentTypeLetter",width:50,align:"center !important",sortable:false});break}a=a.concat([{header:translate("number",true),dataIndex:"idLocal",renderer:this.linkCode,width:b,align:"center"},{header:translate("supplier",true),dataIndex:"name",flex:1,renderer:this.linkClient},{header:translate("date",true),dataIndex:"date",width:90,align:"center",renderer:this.renderDate},{header:"Total",dataIndex:"total",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("allocation",true),dataIndex:"missingAmount",align:"right",renderer:this.renderMoney,width:100,sortable:false},{header:translate("actions",true),align:"center",type:"debitNoteActions",renderer:this.setActions,width:110,filter:false,sortable:false}]);this.columns=a;this.callParent(arguments)},linkCode:function(e,f,b,g,d,c,a){return'<a href="/debit-note/view/id/'+b.get("idLocal")+'">'+b.get("debitNoteNumber")+"</a>"},linkClient:function(e,f,b,g,d,c,a){return'<a href="/debit-note/view/id/'+b.get("idLocal")+'">'+b.get("name")+"</a>"},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(f,j,c,d,h,g,e){var a=c.get("idLocal");var b='<div class="action-icons">';b+='<a href="/debit-note/view/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/zoom.png" alt="'+translate("seeDetail",true)+'" title="'+translate("seeDetail",true)+'"/></a>';if(c.get("editable")){b+='<a href="/debit-note/edit/id/'+a+'"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'"/></a>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled"/>'}if(c.get("deletable")){b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteDebitNote"/>'}else{b+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled"/>'}b+="</div>";return b},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)}});Ext.define("AL.view.client.GridDebitNotes",{extend:"AL.view.common.GridAllDebitNotes",alias:"widget.client_GridDebitNotes",title:"Notas débito",columnFilterConfig:{filtersToHide:["name"]}});Ext.define("AL.controller.Client",{extend:"Ext.app.Controller",views:["client.FormAdd","client.GridAll","client.FormAddContact","client.GridTransactions","client.GridCreditNotes","invoice.WindowPrint","client.GridInvoices","client.GridBills","client.GridDebitNotes","client.GridEstimates","buttons.SubmitCreate","client.GridInvoices","client.GridRemissions","client.GridPurchaseOrder","client.MoreActionsButton","client.GridStatement","client.FormAddRetentions","client.PositiveBalances","client.GridJournals","client.NequiPaymentWindow","ux.fields.Address","ux.fields.Name","ux.fields.EditableListModal",],stores:["Clients","Contacts","Terms","Transactions","Invoices","Bills","CreditNotes","PriceListCombo","SellersCombo","PurchaseOrders","ClientStatement","Journals","IdentificationTypes","CountriesList","CFDIUseList","Regimes","KindsOfPerson","ExonerationDocumentTypes","Departments","Provinces","Regions","Communes","Cantons","Districts","Neighborhoods","Cities","Countries","IvaConditions","DocumentPaymentMethods","FiscalResponsabilities","TypeOfThirdsCombo","OperationTypes",],models:["Client","Contact","Term","Transaction","Invoice","Bill","CreditNote","PriceList","Seller","PurchaseOrder","ClientStatement","CountryLegalParameter",],init:function(){var a=this;this.application.addListener("deleteClient",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("client"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("client")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/client/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){c.up("gridpanel").getPlugin("recordSelector").selectRecords([b],false);var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("notifyPayment",function(h){var b=h.record;var e=Ext.ComponentQuery.query("client_GridStatement")[0];if(!e){return}var c=[];var g="Cordial saludo "+e.name+",<br><br> Notificamos que la "+translate(b.get("documentType"))+" "+translate("number",true)+" "+b.get("number")+" ha sido pagada. <br><br> Saludos.";var d=translate("notificationPaid",true)+" "+translate(b.get("documentType"))+" "+translate("number")+" "+b.get("number");if(e.country==="usa"){d=translate(b.get("documentType"),true)+" "+translate("number")+" "+b.get("number")+" "+translate("notificationPaid");g="Dear "+e.name+"<br><br> The "+translate(b.get("documentType"))+" "+translate("number")+" "+b.get("number")+" has already been paid. <br><br> Yours sincerely."}c.push({xtype:"textfield",fieldLabel:translate("subject",true),name:"emailSubject",labelWidth:70,value:d,allowBlank:false});c.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",labelWidth:70,enableSourceEdit:false,margin:"0 0 10 0",height:250,value:g,allowBlank:false});c.push({xtype:"textfield",name:"email",labelWidth:70,fieldLabel:translate("yourEmail",true),emptyText:translate("emailSendNotification",true),allowBlank:false,regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:'Este campo debe ser una dirección de correo electrónico con el formato "usuario@dominio.com"'});var f=Ext.create("AL.view.common.SmileWindow",{reason:"confirmNotificationEmail",id:"window-notification-send-to-email",title:translate("alreadyPaid",true),documentId:b.get("idLocal"),documentType:b.get("documentType"),width:600,modal:true,items:{xtype:"form",items:c,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",formBind:true,cls:"button main-button",hidden:true,}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(j){var l=j.up("window");var k=l.down("button[action=confirmEmail]");if(k){k.fireEvent("click",k)}},listeners:{afterrender:function(j){var l=j.up("window");var k=l.down("form");j.setDisabled(k.hasInvalidField());k.on("validitychange",function(n,m){j.setDisabled(!m)})}}}]}});f.show()},this);this.application.addListener("deleteJournal",function(d){var b=d.record;var c=d.initiator;var e="¿Estás seguro de que deseas eliminar "+translate("theJournal")+" "+translate("journal")+"? <br> Esta operación no se puede deshacer.";if(b.get("numberResource")&&b.get("statusResource")==="closed"){e="¿Estás seguro de que deseas eliminar "+translate("theJournal")+" "+translate("journal")+"? <br> Esta operación abrirá nuevamente "+translate("theInvoice")+" "+translate("invoice")+" número: "+b.get("numberResource")}Ext.Msg.show({title:"Eliminar "+translate("journal"),msg:e,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f){if(f=="yes"){Ext.Ajax.request({url:"/journal/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){var g=c.getStore();g.load()}else{if(k.cause){Ext.MessageBox.alert("Error",k.cause)}}},failure:function(){}})}}})},this);this.application.addListener("pay",function(b){this.pay(this,b)},this);this.application.addListener("requestActivationOfOnlinePayments",function(c){var d=Ext.ComponentQuery.query("client_GridStatement")[0];if(!d){return}var b=d.name;var e=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,resizable:false,border:false,style:"overflow:visible",bodyStyle:"background: transparent; overflow: visible;",width:403,title:translate("pay",true),items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 39px 20px 39px; position: relative; text-align: justify; line-height: 18px;",html:"<div>"+b+" aún no tiene la opción de recibir pagos electrónicos</div>"},{xtype:"box",cls:"modal-subtitle",style:"margin: 0 39px 0 39px; position: relative; text-align: justify; line-height: 18px;   ",html:"<div>Envíale un correo contándole que te gustaría pagarle por canales digitales, así le ayudarás a crecer.</div>"},],footer:{items:[{text:"Omitir",cls:"button",handler:function(f){e.close()}},{text:"Enviar correo",cls:"button main-button",handler:function(f){var g="/company/request-activation-of-online-payments/format/json";Ext.Ajax.on("beforerequest",a.showSpinner,a);Ext.Ajax.on("requestcomplete",a.hideSpinner,a);Ext.Ajax.request({url:g,method:"POST",params:{origin:window.location.href},showSpinner:true,success:function(h,k){var l=Ext.decode(h.responseText);if(l.success){e.close();var j=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,resizable:false,border:false,style:"overflow:visible",bodyStyle:"background: transparent; overflow: visible;",width:403,title:"Correo enviado",items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 39px 0 39px; position: relative;",html:'<div><svg class="icon" style="margin-right: 0px !important;  width:82px; height: 82px; color: #47B39D"><use xlink:href="/images/smile-icons.svg#success-outline"></use></svg></div>'},{xtype:"box",cls:"modal-subtitle",style:"margin: 0 39px 0 39px; position: relative; text-align: justify; line-height: 18px;   ",html:"<div>Hemos enviado un correo a "+b+" para que comience a recibir pagos en línea. Esperamos que lo active muy pronto.</div>"},],footer:{items:[{text:"Entendido",cls:"button main-button",handler:function(m){j.close()}}]}})}else{e.close();Ext.Msg.alert("Error",l.cause)}}})}}]}})},this);this.application.addListener("payWithCybs",function(b){this.pay(this,b,"cybs")},this);this.application.addListener("payWithNequi",function(b){this.payWithNequi(b.idInvoice)},this);var a=this;this.application.addListener("setNewClientEvent",function(b){a.setNewClientEvent(b.combo,null,b.link)});this.application.addListener("termCreatedClient",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"))},this);this.control({"buttons_SubmitCreate button[action=saveClient]":{click:this.saveClient},"buttons_SubmitCreate button[action=saveCreateClient]":{click:this.saveClient},client_FormAdd:{render:this.initialize,beforerender:function(d){d.executeActionsBeforeRender();var C=Ext.ComponentQuery.query("client_FormAdd addressField[name=addressComponent]")[0];if(C){C.setCountry(d.country)}var e=d.down("textfield[name=fiscalId]");if(e){e.allowBlank=true}switch(d.country){case"mexico":var n=translate("address",true);if(d.address){n=translate("address",true)+" 1"}var o=d.down("container[name=leftContainer]");var y=d.down("textfield[name=state]");if(e){e.allowBlank=true;e.hide()}var k=d.down("combo[name=operationType]");if(k){var j=k.getStore();if(!j.hasLoaded()&&!j.isLoading()){j.load()}}if(d.stampVersion!="3.3"){var g=Ext.ComponentQuery.query("client_FormAdd combo[name=country]")[0];g.disabled=false;var y=d.down("textfield[name=state]");y.allowBlank=false}break;case"peru":var w=d.down("combo[name=identificationType]");d.down("textfield[name=identification]").allowBlank=false;w.allowBlank=false;w.show();break;case"colombia":if(d.configs.isActiveElectronicInvoicing&&d.configs.electronicInvoicingVersion=="2.1"){d.down("displayfield[id=labelNameAddress]").setFieldLabel(translate("address",true)+'<span class="req">*</span>');var x=d.down("textfield[name=email]");x.tooltip="Si no incluyes este dato, las facturas electrónicas que generes a su nombre serán aprobadas con notificación.";var A=d.down("panel[name=responsabilitiesPanel]");A.show()}var B=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(B&&d.client){d.down("textfield[name=email]").setValue(d.client.email);if(C){C.setValues(d.client)}var m=d.down("combo[name=identificationType]");m.getStore().load({callback:function(){m.select(d.client.identificationType);m.resumeEvents()}})}break;case"argentina":var m=d.down("combo[name=identificationType]");if(m){m.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');m.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'}}break;case"costaRica":var m=d.down("combo[name=identificationType]");if(m){m.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');m.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'}}if(d.configs.isActiveElectronicInvoicing&&d.configs.electronicInvoicingVersion==="4.3"){var r=m.getStore();if(!d.documentType||(d.documentType&&d.documentType==="invoice")){var p=function(){if(!d.documentType){return}var F=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var H=F.smGetSelectedRecord().data;if(H.metadata.subDocumentType=="EXPORT_INVOICE"){var E=r.findExact("key","PE");if(E==-1){var G={id:"00",value:"Identificación extranjero",abbreviature:"Identificación extranjero",key:"PE"};r.add(G)}m.store.filter("key","PE")}else{if(H.documentType=="invoice"){m.store.clearFilter();var E=r.findExact("key","PE");if(E!=-1){r.remove(r.getAt(E))}}}};if(!r.hasLoaded()&&r.isLoading()){r.on("load",function(){p()})}else{p()}m.allowBlank=false;d.down("textfield[name=identification]").allowBlank=false;var c=false}else{m.store.clearFilter();var p=function(){var E=r.findExact("key","PE");if(E==-1){var F={id:"00",value:"Pasaporte extranjero",abbreviature:"Pasaporte extranjero",key:"PE"};r.add(F)}};if(!r.hasLoaded()&&r.isLoading()){r.on("load",function(){p()})}else{p()}var c=true}var C=d.down("addressField[name=addressComponent]");var v=["province","canton","district","neighborhood","description"];Ext.each(v,function(F){var E=C.down("[name="+F+"]");if(E){E.allowBlank=c}});this.changeLabelAddressComponent(c)}break;case"chile":if(d.configs.isActiveElectronicInvoicing){var h=d.down("textfield[name=identification]");h.allowBlank=false;h.regex=/^\d{6,8}[\-][0-9kK]$/;h.regexText="Este campo debe tener el siguiente formato: 10545454-5 ó 154545-k"}break}if(d.client){var D=Ext.ComponentQuery.query("client_FormAdd textfield[name=name]")[0];var h=Ext.ComponentQuery.query("client_FormAdd textfield[name=identification]")[0];D.setValue(d.client.name);h.setValue(d.client.identification);if(d.country=="mexico"&&d.client.address){var q=d.down("textfield[name=street]");var l=d.down("textfield[name=exteriorNumber]");var b=d.down("textfield[name=interiorNumber]");var t=d.down("textfield[name=colony]");var f=d.down("textfield[name=locality]");var s=d.down("textfield[name=municipality]");var y=d.down("textfield[name=state]");var u=d.down("combo[name=country]");var z=d.down("textfield[name=zipCode]");q.setValue(d.client.address.street);l.setValue(d.client.address.exteriorNumber);b.setValue(d.client.address.interiorNumber);t.setValue(d.client.address.colony);f.setValue(d.client.address.locality);s.setValue(d.client.address.municipality);z.setValue(d.client.address.zipCode);u.setValue(d.client.address.country);y.setValue(d.client.address.state)}}},afterrender:function(b){switch(b.country){case"mexico":try{if(!b.configs.hasSeenContactPayment){this.showLastestNews(b)}}catch(c){console.log(c.message)}break}}},"client_FormAdd combo[name=thirdsType]":{change:function(f){var e=f.up("form");switch(e.country){case"mexico":var b=f.getSelectedRecord()?f.getSelectedRecord().data:null;var c=e.down("textfield[name=fiscalId]");var g=e.down("textfield[name=identification]");var d=e.down("combo[name=country]");if(b&&b.key=="FOREIGN"){g.disable();g.setValue("XEXX010101000");if(c){c.allowBlank=false;c.setFieldLabel('Id fiscal<span class="req">*</span>');c.show()}if(d){d.enable();if(d.getValue()=="MEX"){d.setValue("")}}}else{g.enable();if(g.getValue()=="XEXX010101000"){g.setValue("")}if(c){c.allowBlank=true;c.setValue("");c.setFieldLabel("Id fiscal");c.hide();if(d){d.setValue("MEX");d.disable()}}}break}}},"client_FormAdd combo[name=paymentType]":{change:function(d){var c=d.up("form");if(c.country=="mexico"&&c.stampVersion=="3.3"){var b=c.down("combo[name=paymentMethod]");if(b){if(d.getValue()=="PPD"){b.store.clearFilter();b.store.filter("type","ppd");b.setValue("other");b.matchFieldWidth=true}else{b.store.clearFilter();b.store.filter("type","pue");b.setValue("cash");b.matchFieldWidth=false}}}},},"client_FormAdd combo[name=identificationType]":{change:function(y){var d=y.up("form");switch(d.country){case"peru":case"costaRica":case"argentina":var g=y.getSelectedRecord().data;var n=d.down("textfield[name=identification]");var j=100;var z=0;var v=null;if(g&&g.rules){j=g.rules.maxLength?g.rules.maxLength:j;z=g.rules.minLength?g.rules.minLength:z;var h=g.rules.regex;if(h){v=h.regex;if(h.invalidRegexText){n.invalidText=h.invalidRegexText}}switch(g.rules.type){case"int":v="^[0-9]*$";break}if(v){v=new RegExp(v)}}n.minLength=z;n.maxLength=j;n.regex=v;switch(d.country){case"costaRica":if(d.configs.electronicInvoicingVersion==="4.3"){var x=d.down("addressField[name=addressComponent]");var r=["province","canton","district","neighborhood","description"];var B=x.down("displayfield[name=label]");Ext.each(r,function(E){B.setFieldLabel("Dirección");var D=x.down("[name="+E+"]");if(g.key==="PE"){if(E!="description"){D.hide()}else{D.emptyText="Otras señas extranjero";D.applyEmptyText()}D.allowBlank=true;changeLabel=true}else{B.setFieldLabel("Ubicación");if(E=="description"){D.emptyText="Otras señas";D.applyEmptyText()}D.show();if(!d.documentType||(d.documentType&&d.documentType!=="saleTicket")){D.allowBlank=false;changeLabel=false}}});this.changeLabelIdentificationComponent(false)}break;case"argentina":var x=d.down("addressField[name=addressComponent]"),r=["province","city","address"],B=x.down("displayfield[name=label]"),p=false;Ext.each(r,function(E){var D=x.down("[name="+E+"]");if(g.key==="CI"){D.applyEmptyText();D.allowBlank=true;p=true}else{D.applyEmptyText();D.allowBlank=false;p=false}});this.changeLabelAddressComponent(p);break}d.isValid();break;case"colombia":var b=y.getSelectedRecord()?y.getSelectedRecord().data:null;var f=d.down("combo[name=kindOfPerson]");var k=d.down("combo[name=regime]");var n=d.down("[name=identification]");var o=d.down("[name=country]");var u=d.down("textfield[name=co_dv]");var e=d.down("[name=identificationLabelContainer]");var s=d.down("[name=identificationCoDvLabelContainer]");var c=d.down("[name=identificationCoDvFieldContainer]");var m=e.up("panel");var v=null;if(b&&b.rules){switch(b.rules.type){case"int":v="^[0-9]*$";break}}if(v){v=new RegExp(v)}n.regex=v;var A=["FOREIGN_NIT","DIE","CE","TE"].indexOf(b.key)!==-1;var C=false;if(["NIT"].indexOf(b.key)!==-1){if(n.getValue()&&n.getValue()!==""){u.setValue(this.calculateDv(n.getValue()))}var l=f.getStore();var q=k.getStore();if(l.hasLoaded()){f.setValue("1")}else{l.on("load",{callback:function(){f.setValue("1")}})}if(d.configs.isActiveElectronicInvoicing&&d.configs.electronicInvoicingVersion=="2.1"){if(k.getValue()==null){if(q.hasLoaded()){k.setValue("COMMON_REGIME")}else{q.on("load",{callback:function(){k.setValue("COMMON_REGIME")}})}}}else{if(q.hasLoaded()){k.setValue("COMMON_REGIME")}else{q.on("load",{callback:function(){k.setValue("COMMON_REGIME")}})}}f.show();k.show();n.setWidth(150);e.flex=1.15;m.doLayout();s.show();c.show();if(o&&o.getValue()!="Colombia"){C="Colombia"}this.changeLabelIdentificationComponent(false)}else{var l=f.getStore();var q=k.getStore(),t="2",w="SIMPLIFIED_REGIME",C="Colombia";if(A){w=null;C=null;switch(b.key){case"DIE":if(d.configs.isActiveElectronicInvoicing&&d.configs.electronicInvoicingVersion=="2.0"){t="0-99"}break;case"FOREIGN_NIT":t="1";break}}if(l.hasLoaded()){f.setValue(t)}else{l.on("load",{callback:function(){f.setValue(t)}})}if(q.hasLoaded()){k.setValue(w)}else{q.on("load",{callback:function(){k.setValue(w)}})}f.hide();k.hide();n.allowBlank=true;u.setValue("");u.allowBlank=true;c.hide();s.hide();e.flex=0.81;m.doLayout();n.setWidth(239);this.changeLabelIdentificationComponent(true)}if(o&&d.type!=="edit"&&C!==false){o.setValue(C)}break}}},"client_FormAdd combo[name=kindOfPerson]":{change:function(j){var f=j.up("form");switch(f.configs.country){case"colombia":var g=f.down("nameField[name=nameComponent]");var b=j.getSelectedRecord()?j.getSelectedRecord().data:null;var d=f.down("combo[name=regime]");var h=d.getStore();if(b){g.changeVisibilitySpecificNameFields(b.id==2)}if(f.configs.isActiveElectronicInvoicing&&f.configs.electronicInvoicingVersion=="2.1"){h.on("load",{callback:function(){d.select(h.getAt(0))}})}else{var c=h.findExact("key","SIMPLIFIED_REGIME");if(b&&b.id==1&&c!=-1){if(h.hasLoaded()){h.remove(h.getAt(c));d.setValue("COMMON_REGIME")}else{h.on("load",{callback:function(){h.remove(h.getAt(c));d.setValue("COMMON_REGIME")}})}}else{if(c==-1){var e={id:f.configs.electronicInvoicingVersion=="2.0"?"0":"ZY",key:"SIMPLIFIED_REGIME",display:"No responsable del IVA",value:"Régimen simplificado"};if(h.hasLoaded()){h.add(e);d.select(h.getAt(0))}else{h.on("load",{callback:function(){h.add(e);d.select(h.getAt(0))}})}}}}break}}},"client_FormAdd combo[name=operationType]":{beforerender:function(d){var c=d.up("form");var b=c.down("checkboxfield[name=isProvider]");if(c.configs.country==="mexico"){if(b.getValue()){d.show()}else{d.setValue("");d.hide()}}},},"client_FormAdd checkboxfield[name=isProvider]":{change:function(d,c){var b=d.up("form");if(b.configs.country==="mexico"){var e=b.down("combo[name=operationType]");if(e){if(c){if(e){e.show()}}else{e.setValue("");e.hide()}}}}},"client_FormAdd checkboxfield[name=cr_isBeneficiaryOfExoneration]":{change:function(e,d){var b=e.up("form");if(!b.configs||b.configs&&b.configs.country!=="costaRica"){return}var c=[{type:"combo",name:"cr_exonerationDocumentType"},{type:"textfield",name:"cr_exonerationDocumentNumber"},{type:"datefield",name:"cr_exonerationDocumentDate"}];Ext.each(c,function(f){var f=b.down(f.type+"[name="+f.name+"]");if(d){f.allowBlank=false;f.show()}else{f.allowBlank=true;f.hide()}})},afterrender:function(c){var b=c.up("form");var d=[{type:"combo",name:"cr_exonerationDocumentType"},{type:"textfield",name:"cr_exonerationDocumentNumber"},{type:"datefield",name:"cr_exonerationDocumentDate"}];Ext.each(d,function(e){var e=b.down(e.type+"[name="+e.name+"]");e.allowBlank=true;e.hide()})}},"window[reason=addNewClient]":{beforeclose:function(c){var b=c.down("client_FormAdd")}},"textfield[name=email]":{change:function(c,d,b){c.setValue(d.trim())}},"client_FormAdd textfield[name=identification]":{change:function(e,h,c){var d=e.up("form");if(d.country=="mexico"&&d.stampVersion=="3.3"){var b=Ext.ComponentQuery.query("client_FormAdd combo[name=country]")[0];var g=document.getElementById("countryCombo");if(h.length==12){Ext.getStore("CFDIUseList").filter("personType","both")}else{Ext.getStore("CFDIUseList").clearFilter()}if(h=="XEXX010101000"){b.disabled=false;g.classList.remove("x-item-disabled")}else{b.disabled=true;g.className+=" x-item-disabled"}}if(d.configs){switch(d.configs.country){case"colombia":var j=d.down("[name=identificationType]");if(j.getValue()=="NIT"){var f=d.down("[name=co_dv]");if(e.getValue()!=""||f.getValue()!=""){e.allowBlank=false;f.allowBlank=false}else{e.allowBlank=true;f.allowBlank=true}e.isValid();f.isValid()}break;case"costaRica":if(d.configs.electronicInvoicingVersion!="4.3"||(d.documentType&&d.documentType=="saleTicket")){var j=d.down("combo[name=identificationType]");if(e.getValue()||j.getValue()){e.allowBlank=false;j.allowBlank=false;this.changeLabelIdentificationComponent(false)}else{e.allowBlank=true;j.allowBlank=true;this.changeLabelIdentificationComponent(true)}e.isValid();j.isValid()}break}}},blur:function(c){var b=c.up("form");if(b.configs){switch(b.configs.country){case"colombia":var f=b.down("[name=identificationType]");var e=b.down("[name=identification]");var d=b.down("[name=co_dv]");if(f.getValue()=="NIT"){d.setValue(this.calculateDv(c.getValue()))}e.isValid();d.isValid();break}}}},"client_FormAdd [name=co_dv]":{render:function(f){var e=f.up("form");var h=e.down("[name=identification]");var g=e.down("[name=identificationLabelContainer]");var c=e.down("[name=identificationCoDvLabelContainer]");var b=e.down("[name=identificationCoDvFieldContainer]");var d=g.up("panel");f.allowBlank=true;b.hide();c.hide();g.flex=0.81;d.doLayout();h.setWidth(239)},change:function(d,f,b){var c=d.up("form");var e=c.down("[name=identification]");var g=c.down("[name=identificationType]");if(g.getValue()=="NIT"||e.getValue()!=""||d.getValue()!=""){e.allowBlank=false;d.allowBlank=false;this.changeLabelIdentificationComponent(false)}else{e.allowBlank=true;d.allowBlank=true;this.changeLabelIdentificationComponent(true)}e.isValid();d.isValid()}},boundlist:{containerclick:this.listClick},"combo[name=idClient]":{expand:function(d,b){var c=this;d.getStore().on("load",function(){var e=Ext.get("createNewContact");c.setNewClientEvent(d,b,e)})},render:function(e,b){var d=this;var c=Ext.get("createOtherContact");if(c){d.setNewClientEvent(e,b,c)}if(c){d.setNewClientEvent(e,b,c)}}},"client_FormAdd combo[name=idTerm]":{afterrender:function(c){var b=c.getStore();if(!b.hasLoaded()||b.isLoading()){b.on("load",function(){c.select(b.findRecord("idLocal",1))})}else{c.select(b.findRecord("idLocal",1))}if(!b.hasLoaded()&&!b.isLoading()){b.load()}}},"client_FormAdd combo[name=CFDIuse]":{beforerender:function(d){var c=this;var b=d.up("form");if(b.country=="mexico"){d.hidden=false}},},"client_FormAdd combo[name=idPriceList]":{afterrender:function(d){var b=d.getStore();var c=Ext.create("AL.model.PriceList",{name:"Ninguna",idLocal:null,dependent:"no",status:"active"});if(!b.hasLoaded()&&!b.isLoading()){b.load({callback:function(){b.add(c)}})}}},"client_FormAdd combo[name=idSeller]":{afterrender:function(d){var b=d.getStore();var c=function(){var e=d.findRecord("idLocal",null);if(!e){e=Ext.create("AL.model.Seller",{name:translate("anySeller",true),idLocal:null});b.add(e)}};if(b.hasLoaded()){c()}else{b.load({callback:function(){c()}})}}},"buttons_SubmitReset button[action=saveClient]":{click:this.saveClient},"client_ClientToolbar button[action=addClient]":{click:function(){window.location="/client/add"}},"client_GridJournals gridcolumn[type=journalActions]":{click:function(g,l,f,d,h){var c=this.application;var k=Ext.get(h.target);var b=g.up("grid").getSelectionModel().getSelection()[0];if(k.hasCls("deleteJournal")){h.preventDefault();if(b.get("deletable")){c.fireEvent("deleteJournal",{record:b,initiator:g})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("thisJournal")+" "+translate("journal"))}}}},client_GridAllClients:{itemdblclick:this.goClientDetails,render:function(d){if(d.type){var b="/client/retrieve-all/format/json";if(d.type==="client"){b="/client/retrieve-by-type/type/client/format/json"}else{if(d.type==="provider"){b="/client/retrieve-by-type/type/provider/format/json"}}var c=d.getStore().getProxy();c.url=b}},selectedRecordsChanged:function(b,d){var c=d.getSelectedRecords().length;if(c>=2){document.getElementById("tooltip-many-selections").style.display="block"}else{document.getElementById("tooltip-many-selections").style.display="none"}}},"client_FormAddContact button[action=deleteContact]":{click:this.deleteContact},client_GridTransactions:{afterrender:function(d){d.columnFilterConfig={callbackStoreLoad:function(e){a.updateTotalTransactions(e)}};d.pageSizeConfig=d.columnFilterConfig;var b=d.getStore();var c=b.getProxy();c.url="/client/retrieve-transactions/id/"+d.idClient+"/format/json";b.load({scope:this,callback:function(f,e,g){a.updateTotalTransactions(f)}})}},"client_GridAllClients gridcolumn[type=clientActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteClient")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteClient",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar clientes que tienen algo asociado")}}}},"client_GridBills gridcolumn[type=billActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteBill")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteBill",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar compras que ya tienen pagos asociados")}}}},"client_GridCreditNotes gridcolumn[type=creditNoteActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteCreditNote")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteCreditNote",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar compras que ya tienen pagos asociados")}}}},"client_GridDebitNotes gridcolumn[type=debitNoteActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteDebitNote")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteDebitNote",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar notas débito que tengan devolución de dinero conciliadas")}}}},"client_GridEstimates gridcolumn[type=estimateActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteEstimate")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteEstimate",{record:d,initiator:b})}else{Ext.Msg.alert("Error","Esta "+translate("estimate")+" no se puede eliminar")}}}},"client_GridInvoices gridcolumn[type=invoiceActions]":{click:function(b,c,k,g,l,m){var o=this.application;var f=Ext.get(l.target);var d=b.up("grid").getSelectionModel().getSelection()[0];var n=this;if(f.hasCls("convertInvoiceToOpen")){l.preventDefault();o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(e){b.getStore().load()}})}else{if(f.hasCls("addInvoicePayment")){if(d.get("status")==="draft"){l.preventDefault();o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(e){window.location="/transaction/in/number/"+e},showWarning:"yes"})}}else{if(f.hasCls("printInvoice")){l.preventDefault();if(d.get("status")==="draft"){o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(j){var e=b.getStore();e.load();Ext.create("AL.view.invoice.WindowPrint",{idLocal:j})},showWarning:"yes"})}else{var h=window.open("/invoice/print/id/"+d.get("idLocal"));h.print()}}else{if(f.hasCls("deleteInvoice")){l.preventDefault();if(d.get("status")==="draft"){o.fireEvent("deleteInvoice",{record:d,initiator:b})}else{Ext.Msg.alert("Error","Solo se puede eliminar "+translate("theInvoices")+" "+translate("invoices")+" en estado borrador")}}else{if(f.hasCls("voidInvoice")){l.preventDefault();if(d.get("voidable")&&!d.get("hasCreditNotes")){o.fireEvent("voidInvoice",{record:d,initiator:b.up("grid"),refreshVoidCauses:true})}else{var p="Solo puedes "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+", que no tengan "+translate("creditNotes")+" "+translate("appliedCreditNotes")+" o cierres sin pago asociados. ";switch(b.up("grid").country){case"mexico":p="Solo puedes "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+" que hayas timbrado en Alegra, sin "+translate("creditNotes")+" y complementos de pago asociados.";if(d.get("status")==="void"&&d.get("mx_waitingToVoid")!==true){p=translate("theInvoice",true)+" "+translate("invoice")+" ya fue cancelada y no es necesario cancelarla de nuevo."}else{if(d.get("mx_waitingToVoid")===true){p=translate("theInvoice",true)+" "+translate("invoice")+" está en proceso de cancelación, se ha enviado la solicitud de cancelación al cliente. Recibirás un correo con su respuesta en máximo 72 horas."}}break;case"peru":p+="Para "+translate("cancel")+" "+translate("invoices")+" "+translate("stampedInvoices")+", emite una "+translate("creditNote");break}GlobalMsg.showNotification({title:"Recuerda",text:p,type:"notice"})}}}}}}}},client_GridStatement:{beforerender:function(c){var b=Ext.get("send-statement");if(b){b.on("click",this.sendStatement);if(c.action==="send-statement"){b.dom.click()}}var d=Ext.get("export-statement");if(d){d.on("click",this.exportStatement)}}},"client_GridStatement gridcolumn[type=actions]":{click:function(b,f,l,k,m,o){var p=this.application;var n=Ext.get(m.target);var d=n.getAttribute("name");if(!d){return}var h=b.up("grid").getSelectionModel().getSelection()[0];var c="";var g={record:h,initiator:b};if(d==="notification"){c="notifyPayment"}else{if(d==="pay"){c="pay"}else{if(d==="payWithCybs"){c="payWithCybs"}else{if(d==="payWithNequi"){c="payWithNequi";g.idInvoice=n.getAttribute("data-idInvoice")}else{if(d==="requestActivationOfOnlinePayments"){c="requestActivationOfOnlinePayments"}}}}}if(d!=="downloadDocument"&&d!=="downloadXml"){m.preventDefault()}p.fireEvent(c,g)}},"window[reason=confirmStatementEmail] form button[action=confirmEmail]":{click:function(h){var c=h.up("form");var l=c.up("window");var g=Ext.ComponentQuery.query("window[reason=confirmStatementEmail] checkbox[name=email]");var j=c.down("textfield[name=email]");var e=c.down("checkbox[name=sendCopyToUser]");var n=[];var o;if(g){Ext.each(g,function(s){if(s.getValue()){var p=s.record;var q="";if(p.name){q=p.name;if(p.lastName){q=q+" "+p.lastName}}var r={name:q,email:p.email};n.push(r)}})}if(j.getValue()&&j.getValue()!==""){o={name:"",email:j.getValue()};n.push(o)}var f=c.down("htmleditor[name=emailMessage]");var b=c.down("textfield[name=emailSubject]");var d={subject:b.getValue(),message:f.getValue()};var m={id:l.idLocal,emails:Ext.encode(n),sendCopyToUser:e.getValue(),emailTemplate:Ext.encode(d)};var k="/client/send-statement/format/json";Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:k,method:"POST",params:m,showSpinner:true,success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){l.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("theM",true)+" "+translate("statement")+" "+translate("hasBeenSentsuccessfullyM"),type:"success"})}else{Ext.Msg.alert("Error",r.cause)}}})}},"window[reason=confirmNotificationEmail] form button[action=confirmEmail]":{click:function(h){var d=h.up("form");var l=d.up("window");var f="Enviando...";var b=Ext.ComponentQuery.query("client_GridStatement")[0];if(b.country==="usa"){f="Sending..."}var j=d.down("textfield[name=email]");var g=d.down("htmleditor[name=emailMessage]");var c=d.down("textfield[name=emailSubject]");var e={subject:c.getValue(),message:g.getValue()};var m={origin:window.location.href,email:Ext.encode(j.getValue()),documentId:Ext.encode(l.documentId),documentType:Ext.encode(l.documentType),emailTemplate:Ext.encode(e)};var k="/client/notify-payment/format/json";Ext.Ajax.on("beforerequest",this.showSpinner,this,f);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:k,method:"POST",params:m,showSpinner:true,success:function(n,o){var r=Ext.decode(n.responseText);if(r.success){l.close();var s="Notificación envíada con éxito";var q="Se ha envíado un correo a la compañia con la notificación";var p="Aceptar";if(r.country==="usa"){s="Success";q="We have sent an email to the company with the notification";p="Ok"}Ext.Msg.show({title:s,msg:q,buttons:Ext.Msg.YES,buttonText:{yes:p}})}else{Ext.Msg.alert("Error","Ha ocurrido un error inesperado, por favor intentalo de nuevo")}}})}},"window[reason=payDocument] form button[action=payDocument]":{click:this.payDocument},"window[reason=payDocument] form combo[name=paymentMethod]":{change:function(h){var e=h.up("form");if(!e){return}var b=e.down("panel[name=retentionsPanel]");if(!b){return}var d=e.down("panel[name=infoPay]");var f=d.items.getAt(3);var g=d.items.getAt(4);f.setVisible(false);g.setVisible(false);var j=false;if(h.getValue()==="Other"){j=true;f.setVisible(true);g.setVisible(true)}else{var c=Ext.ComponentQuery.query("client_FormAddRetentions");Ext.each(c,function(l){l.destroy();var m=e.down("panel[name=retentionsPanel]");e.setHeight(e.getHeight()-40);m.setHeight(m.getHeight()-40)});this.updatePayInfo();var k=Ext.get("retentions");k.setStyle("visibility","hidden")}b.setVisible(j)}},"client_FormAddRetentions button[action=deleteRetention]":{click:function(e,d){var f=Ext.ComponentQuery.query("window[reason=payDocument] form")[0];var c=f.down("panel[name=retentionsPanel]");f.setHeight(f.getHeight()-40);c.setHeight(c.getHeight()-40);this.updatePayInfo(e);var g=Ext.ComponentQuery.query("client_FormAddRetentions");if(g.length===1){var b=Ext.get("retentions");b.setStyle("visibility","hidden")}}},"client_FormAddRetentions textfield[name=amount]":{change:this.updatePayInfo},"client_FormAddRetentions textfield[name=retention]":{change:this.updatePayInfo},client_PositiveBalances:{afterrender:function(b){b.init=function(){this.setClient=function(c,e){this.client=c;e=e||false;if(e){if(!this.getType()){return}var h=this.down("displayfield[name=title]");var g=false;var f=this.configs;var d=this.getCurrency()?this.getCurrency().symbol:null;switch(this.getType()){case"out":text="Con el proveedor seleccionado tienes un saldo a favor de ";if(f.showBalanceAdvances===true&&c.balanceAdvancesPayments>0){text+="<strong>"+Ext.util.Format.usMoney(c.balanceAdvancesPayments,null,d)+"</strong> en anticipos entregados";g=true}if(f.showBalanceCreditNotes===true&&c.balanceDebitNotes>0){text+=(f.showBalanceAdvances===true&&c.balanceAdvancesPayments>0?" y ":"")+"<strong>"+Ext.util.Format.usMoney(c.balanceDebitNotes)+"</strong> en "+translate("debitNotes");g=true}break;case"in":text=translate("theSelectedClientHasABalanceOf",true)+" ";if(f.showBalanceAdvances===true&&c.balanceAdvances>0){text+="<strong>"+Ext.util.Format.usMoney(c.balanceAdvances,null,d)+"</strong> "+translate("in")+" "+translate("advancesReceived",true);g=true}if(f.showBalanceCreditNotes===true&&c.balanceCreditNotes>0){text+=(f.showBalanceAdvances===true&&c.balanceAdvances>0?" "+translate("and")+" ":"")+"<strong>"+Ext.util.Format.usMoney(c.balanceCreditNotes)+"</strong> "+translate("in")+" "+translate("creditNotes");g=true}}h.setValue(text);this.setVisible(g)}};this.getClient=function(){return this.client};this.setCurrency=function(c,d){this.currency=c;d=d||true;if(d){this.updateBalances()}};this.getCurrency=function(){return this.currency};this.setDecimalPrecision=function(c){this.decimalPrecision=c};this.setType=function(c){this.type=c};this.getType=function(){return this.type};this.getDecimalPrecision=function(){return this.decimalPrecision};this.updateBalances=function(){var e=this;var d=this.getClient();var c=this.getCurrency();if(!d||!c){return null}Ext.Ajax.request({url:"/client/retrieve-one/id/"+d.idLocal+"/currency/"+c.code+"/format/json",success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=j.results;e.setClient(f,true)}},failure:function(){}})};this.hideButtonForAdvances=function(){var c=this.down("button[name=associateAdvances]");if(c){c.hide()}};this.showButtonForAdvances=function(){var c=this.down("button[name=associateAdvances]");if(c){c.show()}};if(this.configs.canAssociated){this.add({xtype:"button",baseCls:"btn-view",cls:"btn-link-gray",name:"associateAdvances",style:"text-align: center; padding-bottom: 10px;",text:translate("associateAdvancesTo",true)+" "+(this.getType()==="in"?translate("invoice"):translate("supplierInvoice")),listeners:{click:function(){if(Ext.ComponentQuery.query("advance_Panel")[0]){return}Ext.create("AL.view.advance.Panel",{renderTo:"advancesPanel",type:b.getType(),client:b.getClient(),currency:b.getCurrency(),decimalPrecision:b.getDecimalPrecision()})}}})}};b.init()}},"button[name=viewLinkStatement]":{click:function(c){var b=c.client;Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,resizable:false,border:false,style:"overflow:visible",bodyStyle:"background: transparent; overflow: visible;",width:620,frame:false,smileTooltip:{text:'<div class="text" style="font-weight: normal;">'+translate("ifYouNeedHelp",true)+' <a href="http://ayuda.getsoft.app/hc/es/articles/115000270906" target="_blank">'+translate("clickHere")+"</a>.</div>",style:"top: -10px;height: 50px;width: 150px;left: -90px;"},title:translate("generateLinkToStatement",true),items:[{xtype:"form",style:"overflow:visible",bodyStyle:"overflow: visible;",border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 auto 20px auto; position: relative;",html:"<div>"+translate("enterTheEmailYouWishToShareTheLinkWithHeWillBeAbleToRenewItIfItExpires",true)+"</div>"},{xtype:"panel",border:false,height:30,layout:{type:"table",columns:3,tableAttrs:{}},items:[{xtype:"textfield",vtype:"email",fieldLabel:translate("email",true),allowBlank:false,name:"email",labelStyle:"text-align:right;",width:380,value:b.email},{xtype:"button",action:"viewLinkStatement",style:"margin-left: 10px;",width:62,text:translate("generate",true),formBind:true,handler:function(d){var f=d.up("form");var e=f.down("textfield[name=email]");Ext.Ajax.request({url:"/client/get-link-statement/id/"+b.idLocal+"/format/json",method:"POST",params:{email:e.getValue()},success:function(h){var k=Ext.decode(h.responseText);if(k.success){var g=f.down("panel[name=panelStatementLink]");var j=g.down("textfield[name=linkStatement]");j.setValue(k.result);g.setVisible(true)}else{Ext.MessageBox.alert("Error",k.cause)}}})}}]},{xtype:"panel",name:"panelStatementLink",style:"overflow:visible",bodyStyle:"overflow: visible;",border:false,hidden:true,height:20,width:520,layout:{type:"table",columns:4,tableAttrs:{style:{position:"relative"}}},items:[{xtype:"textfield",name:"linkStatement",labelStyle:"text-align:right;",fieldLabel:translate("link",true),style:"margin-top:4px",width:380,listeners:{afterrender:function(d){d.inputEl.dom.readOnly=true}}},{xtype:"button",style:"padding: 3px; margin-left: 10px",iconCls:"icon-send",text:translate("send",true),href:"/client/statement/id/"+b.idLocal+"/act/send-statement"},{xtype:"button",style:"padding: 3px 5px; margin-left: 5px",action:"viewLinkStatement",iconCls:"icon-copy",text:translate("copy",true),handler:function(d){var e=document.getElementsByName("linkStatement")[0];e.select();document.execCommand("copy");e.blur();var f=Ext.get("notificationCopied");f.setStyle("opacity","1");setTimeout(function(){f.setStyle("opacity","0")},1500)}},{xtype:"box",html:'<div id="notificationCopied" class="notificationCopied">'+translate("wrapperExclamationSentence",true,{sentence:translate("linkCopied",true)})+"</div>"}]}]}]})}}})},updateTotalTransactions:function(c){var e=Ext.get("total-out");var d=Ext.get("total-in");if(d&&e){var b=0;var a=0;Ext.each(c,function(f){if(f.get("type")=="in"){b=AL.math.add(b,f.get("amountTotal"))}else{a=AL.math.add(a,f.get("amountTotal"))}});d.setHTML(Ext.util.Format.usMoney(AL.math.approx(b)));e.setHTML(Ext.util.Format.usMoney(AL.math.approx(a)))}},payDocument:function(c){var e=c.up("form");var f=Ext.ComponentQuery.query("client_FormAddRetentions");var b=[];var d=true;Ext.each(f,function(h){if(h.isValid()){var g=h.getValues();b.push(g)}else{d=false}});if(!d){return Ext.Msg.show({title:"",msg:"Recuerda completar todos los campos y establecer montos númericos",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}var a=e.getValues();a.retentions=Ext.encode(b);a.origin=window.location.href;Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/client/pay/id/"+e.idLocal+"/format/json",method:"POST",params:a,showSpinner:true,success:function(g,j){var l=Ext.decode(g.responseText);if(l.success){var k=document.createElement("form");k.setAttribute("method","post");k.setAttribute("action",l.url);for(var h in l.params){var m=document.createElement("input");m.setAttribute("name",h);m.setAttribute("value",l.params[h]);m.setAttribute("type","hidden");k.appendChild(m)}document.body.appendChild(k);k.submit();e.up("panel").close()}else{Ext.Msg.alert("",l.cause);c.setDisabled(false)}}});c.setDisabled(true)},updatePayInfo:function(f){var a=true;var d=Ext.get("retentions");var l=parseInt(d.getAttribute("total"));var m=parseInt(d.getAttribute("subtotal"));var g=parseInt(d.getAttribute("retentions"));var e=parseInt(d.getAttribute("tax"));var j=d.getAttribute("currencySymbol");var o=parseInt(d.getAttribute("decimalPrecision"));var b=Ext.ComponentQuery.query("client_FormAddRetentions");var k=Ext.get("totalSpan");var n=Ext.get("retentionsSpan");if(f&&f.action=="deleteRetention"){var c=f.up("form");var h=b.indexOf(c);if(h>-1){b.splice(h,1)}}Ext.each(b,function(q){if(q.isValid()){var p=q.getValues();l=AL.math.sub(l,p.amount);g=AL.math.add(g,p.amount)}});if(g>=m){Ext.Msg.show({title:"",msg:"La suma de las "+translate("retentions")+" no puede igualar o exceder el subtotal de "+translate("theInvoice")+" "+translate("invoice"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});a=false}if(AL.math.sub(m,g)<=e){Ext.Msg.show({title:"",msg:"El valor base debe ser mayor al valor del impuesto por pagar",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});a=false}k.setHTML(Ext.util.Format.usMoney(l,o,j));if(n){n.setHTML(Ext.util.Format.usMoney(g,o,j))}return a},exportStatement:function(h,d){var c=Ext.ComponentQuery.query("client_GridStatement")[0];if(typeof h.preventDefault==="function"){h.preventDefault()}if(!c||(c&&!c.idContact)){return Ext.MessageBox.alert("Error","Selecciona un cliente para exportar su "+translate("statement"))}var g=c.getPlugin("columnfilter").getSubmitFilters();if(c.overdueDaysFilter){var b=Ext.decode(g);b.push(c.overdueDaysFilter);g=Ext.encode(b)}var f=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");var a=this.down("svg");if(!a.hasCls("icon-spin")){a.update('<use xlink:href="/images/smile-icons.svg#loading"></use>');a.dom.classList.add("icon-spin");Ext.Ajax.request({url:"/labs/test11/exportable-type/client-statement/id/"+c.idContact+"/format/json",params:{filters:g},binary:true,success:function(o,t){a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin");try{var p=String.fromCharCode.apply(null,new Uint8Array(o.responseBytes));p=p.replace(/Already running.../gi,"");var l=Ext.decode(p);if(!l.success){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(l.rowsCount==0){f=translate("sorryNoRecordsFoundToExport",true)}Ext.Msg.show({title:translate("generatingExcelFile",true),msg:f,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}catch(s){var k="";var m=o.getResponseHeader("Content-Disposition");if(m&&m.indexOf("attachment")!==-1){var n=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var r=n.exec(m);if(r!=null&&r[1]){k=r[1].replace(/['"]/g,"")}}var v=o.getResponseHeader("Content-Type");var j=typeof File==="function"?new File([o.responseBytes],k,{type:v}):new Blob([o.responseBytes],{type:v});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(j,k)}else{var u=window.URL||window.webkitURL;var q=u.createObjectURL(j);if(k){var w=document.createElement("a");if(typeof w.download==="undefined"){window.location=q}else{w.href=q;w.download=k;document.body.appendChild(w);w.click()}}else{window.location=q}setTimeout(function(){u.revokeObjectURL(q)},100)}}finally{a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}},failure:function(j){console.log(j);Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});a.update('<use xlink:href="/images/smile-icons.svg#export"></use>');a.dom.classList.remove("icon-spin")}})}},sendStatement:function(f,c){if(typeof f.preventDefault==="function"){f.preventDefault()}var b=Ext.ComponentQuery.query("client_GridStatement")[0];if(!b||(b&&!b.idContact)){return Ext.MessageBox.alert("Error","Selecciona un cliente para enviar su "+translate("statement"))}var g=b.idContact;var d=b.canEmail;var a=function(){var e=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(e){e.destroy();if(typeof c.setAttribute==="function"){c.setAttribute("data-canEmail","yes")}b.canEmail="yes"}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+g+"/statement/no/format/json/email-template/statement",success:function(j,l){var j=Ext.decode(j.responseText);if(j.success){var h=[];if(j.results){var k=j.results;if(j.emailTemplate){h.push({xtype:"textfield",fieldLabel:"Asunto:",name:"emailSubject",labelWidth:50,value:j.emailTemplate.subject});h.push({xtype:"htmleditor",fieldLabel:"Mensaje",name:"emailMessage",labelWidth:50,enableSourceEdit:false,margin:"0 0 10 0",height:250,value:j.emailTemplate.message})}h.push({xtype:"box",style:"color: #67948E; margin-bottom:10px; ",html:"Este correo se enviará a las siguientes direcciones de correo electrónico asociadas al cliente"});if(j.clientEmail){h.push({boxLabel:j.clientEmail+" - ("+j.clientName+")",name:"email",record:{name:j.clientName,email:j.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(k.length==0){h.push({xtype:"box",style:"color: #999; font-size:11px",html:"No hay direcciones de correo asociadas a este cliente"})}}Ext.each(k,function(n){h.push({boxLabel:n.email+" - ("+n.name+" "+n.lastName+")",name:"email",record:n,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}h.push({xtype:"box",style:"color: #67948E; margin-bottom:2px; margin-top:20px",html:"También puedes enviar el "+translate("statement")+" a un correo en particular"},{xtype:"box",style:"color: #67948E; font-size:11px; padding-bottom: 10px;",html:"o enviar a múltiples destinatarios separando las direcciones por coma o punto y coma.<br>"},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:"Dirección de correo"},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:"Enviar una copia a mi correo",margin:"0 0 0 130"});var m=Ext.create("AL.view.common.SmileWindow",{reason:"confirmStatementEmail",id:"window-statement-send-to-emails",title:"Enviar "+translate("statement"),idLocal:g,type:"original",width:600,height:500,modal:true,items:{xtype:"form",items:h,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{margin:"10 10 0 0",height:40,cls:"button main-button",text:"Enviar",action:"confirmEmail",hidden:true}]},footer:{items:[{text:"Enviar",cls:"button main-button",handler:function(n){var p=n.up("window");var o=p.down("button[action=confirmEmail]");if(o){o.fireEvent("click",o)}},listeners:{afterrender:function(n){var p=n.up("window");var o=p.down("form");n.setDisabled(o.hasInvalidField());o.on("validitychange",function(r,q){n.setDisabled(!q)})}}}]},});m.show()}else{if(j.code===2015){window.location="/client/edit/id/"+g}else{Ext.Msg.alert("Error",j.cause)}}},failure:function(h){Ext.Msg.alert("Error","Ha ocurrido un error inesperado, por favor intentalo de nuevo")}})};if(d==="yes"){a()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",title:"Completa la siguiente información para continuar",infoTitle:"¡Para enviar el "+translate("statement")+" debes ingresar los siguientes datos de tu empresa!",forEmail:true,callback:a})}},showSpinner:function(b,c,d){d=d?d:"Enviando...";if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},saveClient:function(a){if(this.validateForms()){GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("client")});var o=a.up("form");var q=o.query("button");Ext.each(q,function(t){t.disable()});var d=Ext.ComponentQuery.query("client_FormAddContact");var l=[];var e;Ext.each(d,function(t){e=t.getForm().getValues();if(e.name||e.lastName||e.phone||e.mobile||e.email){e.sendNotifications=(e.sendNotifications)?e.sendNotifications:"no";l.push(e)}});var c=Ext.ComponentQuery.query("client_FormAdd")[0];if(c.country=="mexico"){var g=Ext.ComponentQuery.query("client_FormAdd combo[name=country]")[0];g.disabled=false}var j=c.getValues();var k=Ext.get("new-comment");if(k&&k.getValue()){var b=k.getValue();j.comment=Ext.encode(b)}var f=null;var r=null;if(!j.idTerm||j.idTerm===0){delete j.idTerm}else{var n=c.down("combo[name=idTerm]");var p=n.findRecordByValue(j.idTerm);f=p.get("days");r=p.get("name")}if(!j.idPriceList||j.idPriceList==0||j.idPriceList==""){delete j.idPriceList}if(["costaRica","colombia","argentina","peru","mexico","chile"].indexOf(c.configs.country)!==-1){var s=c.down("addressField[name=addressComponent]");j.address=Ext.encode(s.getValues())}j.contacts=Ext.encode(l);var h="/client/add/format/json";if(c.type&&c.type=="edit"&&c.idLocal){j.idLocal=c.idLocal;h="/client/edit/format/json"}var m=c.getFieldValuesAsMetadata();if(m){j.metadata=Ext.encode(m)}Ext.Ajax.request({url:h,method:"POST",params:j,success:function(w,y){var z=Ext.decode(w.responseText);if(z.success){var A=z.results;if(c.callback){var v=c.getValues();var u=Ext.create("AL.model.Client",v);u.set("idLocal",A);switch(c.country){case"colombia":if(v.kindOfPerson==2&&v.firstName&&v.firstName!=" "&&v.lastName&&v.lastName!=" "){var x=v.firstName;if(v.secondName&&v.secondName!=" "){x+=" "+v.secondName}x+=" "+v.lastName;u.set("name",x)}break;case"mexico":var t=j.CFDIuse?j.CFDIuse:"";u.set("cfdiUse",t);break}if(f&&r){u.set("termName",r);u.set("termDays",f)}if(m){u.set("metadata",m)}c.callback(u)}else{if(a.createAnother){window.location="/client/add"}else{if(z.viewNotPermitted){GlobalMsg.showNotification({title:"Éxito",text:"El contacto ha sido creado de manera exitosa",type:"success"});setTimeout(function(){window.location="/client"},1500)}else{window.location="/client/view/id/"+A}}}if(c.emergent){GlobalRedirector.close()}}else{if(z.repeatedValue){Ext.Msg.show({title:translate("identification",true)+" duplicado",msg:z.cause,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(B){if(B=="yes"){j.ignoreRepeated="yes";Ext.Ajax.request({url:h,method:"POST",params:j,success:function(E,G){var H=Ext.decode(E.responseText);if(H.success){var I=H.results;if(c.callback){var D=c.getValues();var C=Ext.create("AL.model.Client",D);C.set("idLocal",I);if(c.country=="colombia"){if(D.kindOfPerson==2&&D.firstName&&D.firstName!=" "&&D.lastName&&D.lastName!=" "){var F=D.firstName;if(D.secondName&&D.secondName!=" "){F+=" "+D.secondName}F+=" "+D.lastName;C.set("name",F)}}if(f&&r){C.set("termName",r);C.set("termDays",f)}c.callback(C)}else{if(a.createAnother){window.location="/client/add"}else{window.location="/client/view/id/"+I}}}else{GlobalRedirector.close();if(c.emergent){Ext.MessageBox.alert("Error",H.cause)}else{GlobalMsg.showErrorMessage("Error",H.cause)}Ext.each(q,function(J){J.enable()})}},failure:function(){GlobalRedirector.close();Ext.each(q,function(C){C.enable()})}})}}})}else{GlobalRedirector.close();if(c.emergent){Ext.MessageBox.alert("Error",z.cause)}else{GlobalMsg.showErrorMessage("Error",z.cause)}}Ext.each(q,function(B){B.enable()})}},failure:function(){GlobalRedirector.close();Ext.each(q,function(t){t.enable()})}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},deleteContact:function(b){var c=Ext.ComponentQuery.query("client_FormAdd")[0];var a=b.up("form");if(c.type&&c.type=="edit"&&a.down("hidden[name=idLocal]").value){Ext.Msg.show({title:translate("remove",true)+" "+translate("client"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("client")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f){if(f=="yes"){var e=a.down("hidden[name=idLocal]").value;var d={id:e};Ext.Ajax.request({url:"/contact/delete/format/json",method:"POST",params:d,success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){a.destroy();var g=Ext.ComponentQuery.query("#addContactPanel")[0];g.doLayout()}else{GlobalMsg.showErrorMessage("Error",k.cause)}},failure:function(){}})}}})}else{a.destroy()}},initialize:function(a){var b=Ext.get("addOtherContact");if(b){b.on("click",this.addContactForm)}if(a.type&&a.type=="edit"){Ext.Ajax.request({url:"/client/retrieve-one/id/"+a.idLocal+"/format/json",success:function(h){var o=Ext.decode(h.responseText);var z=o.results;var w=z.contacts;var t=a.down("textfield[name=name]");var f=a.down("combo[name=identificationType]");var R=a.down("textfield[name=identification]");var N=a.down("textfield[name=phone1]");var L=a.down("textfield[name=phone2]");var s=a.down("textfield[name=fax]");var K=a.down("textfield[name=mobile]");var c=a.down("addressField[name=addressComponent]");var C=a.down("textfield[name=email]");var Q=a.down("combo[name=idTerm]");var m=a.down("textarea[name=observations]");var P=a.down("checkbox[name=isClient]");var O=a.down("checkbox[name=isProvider]");var I=a.down("combo[name=idPriceList]");var p=a.down("combo[name=idSeller]");var r=a.down("checkbox[name=statementAttached]");if(r){r.setValue(z.statementAttached)}t.setValue(z.name);R.setValue(z.identification);N.setValue(z.phone1);L.setValue(z.phone2);s.setValue(z.fax);K.setValue(z.mobile);c.setValues(z);C.setValue(z.email);m.setValue(z.observations);var aa=f.getStore();if(z.identificationType){if(aa.hasLoaded()){f.select(z.identificationType)}else{f.getStore().load({callback:function(){f.select(z.identificationType)}})}}if(z.metadata){a.setFieldValuesFromMetadata(z.metadata)}switch(a.country){case"mexico":var T=a.down("textfield[name=street]");var d=a.down("textfield[name=exteriorNumber]");var Z=a.down("textfield[name=interiorNumber]");var v=a.down("textfield[name=colony]");var H=a.down("textfield[name=locality]");var g=a.down("textfield[name=municipality]");var Y=a.down("textfield[name=state]");var E=a.down("combo[name=country]");var G=a.down("textfield[name=zipCode]");var X=a.down("combo[name=CFDIuse]");T.setValue(z.addressObject.street);d.setValue(z.addressObject.exteriorNumber);Z.setValue(z.addressObject.interiorNumber);v.setValue(z.addressObject.colony);H.setValue(z.addressObject.locality);g.setValue(z.addressObject.municipality);G.setValue(z.addressObject.zipCode);E.setValue(z.addressObject.country);Y.setValue(z.addressObject.state);if(z.cfdiUse){if(z.identification.length==12){Ext.getStore("CFDIUseList").filter("personType","both");if(z.cfdiUse[0]!="D"){X.setValue(z.cfdiUse)}}else{X.setValue(z.cfdiUse)}}if(z.identification){R.setValue(z.identification)}break;case"colombia":var W=a.down("textfield[name=firstName]");var n=a.down("textfield[name=secondName]");var B=a.down("textfield[name=lastName]");var u=a.down("combo[name=kindOfPerson]");var q=a.down("combo[name=regime]");var x=a.down("[name=identification]");var y=a.down("[name=co_dv]");var l=a.down("[name=identificationLabelContainer]");var S=a.down("[name=identificationCoDvLabelContainer]");var j=a.down("[name=identificationCoDvFieldContainer]");var M=l.up("panel");var k=u.getStore();if(z.kindOfPerson){if(k.hasLoaded()){u.select(z.kindOfPerson)}else{k.on("load",function(){u.select(z.kindOfPerson)})}}var e=q.getStore();if(z.regime){if(e.hasLoaded()){q.setValue(z.regime)}else{e.on("load",function(){q.setValue(z.regime)})}}if(z.identificationType=="NIT"){u.show();q.show();x.setWidth(150);l.flex=1.15;M.doLayout();S.show();j.show()}else{q.hide()}if(Ext.isEmpty(z.firstName)&&Ext.isEmpty(z.secondName)&&Ext.isEmpty(z.lastName)){t.setValue(z.name);W.setValue(z.name)}else{W.setValue(z.firstName)}n.setValue(z.secondName);B.setValue(z.lastName);y.setValue(z.co_dv);break;case"costaRica":if(z.cr_nite&&!z.identification){R.setValue(z.cr_nite)}break}var J=Q.getStore();if(z.idTerm){if(J.hasLoaded()){Q.select(z.idTerm)}else{Q.getStore().load({callback:function(){Q.select(z.idTerm)}})}}else{if(!J.hasLoaded()){J.load()}}var V=I.getStore(),A=Ext.create("AL.model.PriceList",{name:"Ninguna",idLocal:null,dependent:"no",status:"active"});if(!V.hasLoaded()&&!V.isLoading()){V.load({callback:function(){V.add(A)}})}if(z.idPriceList){var D=function(){var ab=V.findRecord("idLocal",z.idPriceList);if(ab){I.select(ab)}};if(!V.hasLoaded()){V.load()}else{D()}V.on("load",D)}else{I.select(A)}var U=function(){var ac=p.findRecord("idLocal",null);if(!ac){ac=Ext.create("AL.model.Seller",{name:translate("anySeller",true),idLocal:null});F.add(ac)}var ab=p.findRecord("idLocal",z.idSeller);if(!ab){ab=ac}p.select(ab)};var F=p.getStore();if(F.hasLoaded()){U()}else{F.load({callback:function(){U()}})}if(z.isClient==="yes"){P.setValue(true)}if(z.isProvider==="yes"){O.setValue(true)}Ext.each(w,function(af){var ae=Ext.ComponentQuery.query("#addContactPanel")[0];var aj=Ext.create("AL.view.client.FormAddContact",{});var ad=aj.down("textfield[name=name]");var ac=aj.down("hidden[name=idLocal]");var ai=aj.down("textfield[name=lastName]");var ah=aj.down("textfield[name=email]");var ag=aj.down("textfield[name=phone]");var ab=aj.down("textfield[name=mobile]");var ak=aj.down("checkbox[name=sendNotifications]");ad.setValue(af.name);ac.setValue(af.idLocal);ai.setValue(af.lastName);ah.setValue(af.email);ag.setValue(af.phone);ab.setValue(af.mobile);if(af.sendNotifications=="yes"){ak.setValue(true)}else{ak.setValue(false)}ae.add(aj)})}})}},addContactForm:function(){var a=Ext.ComponentQuery.query("#addContactPanel")[0];var b=Ext.create("AL.view.client.FormAddContact",{});a.add(b)},goClientDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/client/view/id/"+h},setNewClientEvent:function(e,d,c){var b=this,a=e.up("form");if(c){c.removeAllListeners();c.addListener("click",function(f){b.quickNewContact(a,f)})}},validateForms:function(){var p=Ext.ComponentQuery.query("client_FormAdd")[0];var r=Ext.ComponentQuery.query("client_FormAddContact");var m=true;var l=true;var h=p.down("combo[name=identificationType]"),j=p.down("textfield[name=identification]");if(p.configs&&p.configs.country==="costaRica"){if(p.configs.electronicInvoicingVersion!="4.3"||(p.configs.electronicInvoicingVersion=="4.3"&&h.getValue()!="PE")){var d=["province","canton","district","description","neighborhood"];var e=false;for(var g=0;g<d.length;g++){var c=d[g];var b=p.down("combo[name="+c+"]");if(!b){b=p.down("textfield[name="+c+"]")}if(b){e=b.getValue()?true:false}if(e){break}}if(p.configs.electronicInvoicingVersion!="4.3"){d.pop()}for(var g=0;g<d.length;g++){var c=d[g];var b=p.down("combo[name="+c+"]");if(!b){b=p.down("textfield[name="+c+"]")}if(b){b.allowBlank=!e}}}if(p.configs.electronicInvoicingVersion!="4.3"||(p.documentType&&p.documentType=="saleTicket")){if(j.getValue()||h.getValue()){j.allowBlank=false;h.allowBlank=false;this.changeLabelIdentificationComponent(false)}else{j.allowBlank=true;h.allowBlank=true;this.changeLabelIdentificationComponent(true)}}}if(p.getForm().isValid()){Ext.each(r,function(u){var v=u.getValues();if(v.sendNotifications==="yes"&&!v.email){var t=u.down("textfield[name=email]");t.markInvalid("Si deseas enviarle notificaciones a este contacto es necesario especificar el correo electrónico.");m=false}})}else{m=false}var s=Ext.ComponentQuery.query("addressField[name=addressComponent]")[0];if(s){m=m&&s.isValid()}var a=Ext.ComponentQuery.query("editableListModalComponent[name=responsabilitiesComponent]")[0];if(a){if(!a.isValid()){if(m){l=false}m=false;GlobalMsg.showErrorMessage("Error","Debes configurar al menos una responsabilidad para facturación electrónica.")}}if(p.configs.country=="mexico"){var f=p.down("combo[name=thirdsType]");var o=p.down("combo[name=country]");if(f){var n=f.getValue();if(n!="FOREIGN"){o.setValue("MEX")}}}var k=p.down("textfield[name=email]");if(!k.getValue()){var q=p.down("checkbox[name=sendMailWithDocumentAfterAcceptanceByGovernmentEntity]");if(q&&q.getValue()==true){m=false;k.markInvalid("Es necesario indicar el correo del contacto si deseas enviarle documentos electrónicos")}}if(!m&&l){GlobalMsg.showNotification({tpl:"formInvalidFields"})}return m},pay:function(b,c,e){var a=c.record;var d=c.initiator.up("grid");Ext.Ajax.on("beforerequest",b.showSpinner,b,d.canApplyRetentions!=="no"?translate("loading",true):null);Ext.Ajax.on("requestcomplete",b.hideSpinner,b);Ext.Ajax.request({url:"/client/retrieve-info-invoice-pay/id/"+a.get("idLocal")+"/format/json",method:"POST",params:{origin:window.location.href},showSpinner:true,success:function(h,k){var l=Ext.decode(h.responseText);if(l.success){var g=l.info;var m=[{xtype:"box",cls:"modal-title",style:"font-size: 24px; font-weight: bold;",html:"<div> Pago a "+translate("invoice")+" "+g.number+"</div>"},{xtype:"box",html:'<div class="sublabel" style="font-size: 12px;margin-bottom: 20px;text-align: center;">Si pagas con tarjeta de crédito no es necesario agregar '+translate("retentions")+", la entidad las realiza por ti</div>",hidden:Ext.Array.contains(["cybs"],e)},{xtype:"combo",name:"paymentMethod",style:"margin: 0 auto 30px auto; width: 350px;",fieldLabel:"Método de pago",emptyText:"Seleccionar",displayField:"label",valueField:"value",allowBlank:Ext.Array.contains(["cybs"],e),forceSelection:true,queryMode:"local",editable:false,hidden:Ext.Array.contains(["cybs"],e),disabled:false,store:{fields:["label","value"],data:[{label:"Tarjeta de crédito",value:"CreditCard"},{label:"Otro",value:"Other"}]}},{xtype:"panel",name:"retentionsPanel",height:150,border:false,hidden:true,items:[{xtype:"box",cls:"modal-title",html:"<div>"+translate("retentions",true)+"</div>"},{xtype:"box",html:'<div class="sublabel" style="font-size: 12px;margin-bottom: 5px;text-align: center;">Agrega las '+translate("retentions")+" a aplicar al pago de "+translate("theInvoice")+" "+translate("invoice")+"</div>"},{xtype:"box",html:'<div id="retentions" style="margin: 10px auto; width:350px; visibility:hidden;" retentions="0" total="'+g.total+'" tax="'+g.tax+'"  subtotal="'+g.subtotal+'" decimalPrecision="'+g.decimalPrecision+'" currencySymbol="'+g.currencySymbol+'"><div style="background:#eee; height:24px; font-size: 11px; font-weight: normal; line-height:23px; border: 1px solid #d0d0d0;  border-bottom: 0px; padding-left:7px"><p style="display:inline-block;width:160px;">'+translate("retention",true)+'</p><p style="display:inline-block">Monto</p></div></div>'},{xtype:"box",html:'<div style="margin: 0 auto;width: 140px;"><a id="addOtherRetention" style="width:inherit;border-radius:0;z-index:100;">Agregar '+translate("retention")+"</a></div>"}]},{xtype:"panel",name:"infoPay",style:"margin-top: 30px",border:false,height:180,layout:{type:"table",columns:2,tableAttrs:{style:{margin:"0 auto","box-shadow":"2px 1px 1px #d0d0d0;",width:"545px"}}},defaults:{bodyStyle:"text-align:right;border:none;"},items:[{html:'<h3 style="background:#00b19d;padding:10px;color: #fff;text-align:center;font-size: 16px;">Resumen de pago</h3>',colspan:2},{html:'<span style="color: #58595F; font-weight: bold;">Subtotal</span>',style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);"},{html:'<span id="subtotalSpan" style="color: #58595F;">'+Ext.util.Format.usMoney(g.subtotal,g.decimalPrecision,g.currencySymbol)+"</span>",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);"},{html:'<span style="color: #58595F; font-weight: bold;">'+translate("retentions",true)+"</span>",name:"retentionsLabel",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);display:none;",},{html:'<span id="retentionsSpan" style="color: #58595F;">'+Ext.util.Format.usMoney(0,g.decimalPrecision,g.currencySymbol)+"</span>",name:"retentionsValue",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);display:none;"},{html:'<span style="color: #58595F; font-weight: bold;">'+(Ext.Array.contains(["cybs"],e)?"Impuestos":"IVA")+"</span>",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);"},{html:'<span style="color: #58595F;">'+Ext.util.Format.usMoney(g.tax,g.decimalPrecision,g.currencySymbol)+"</span>",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);"},{html:'<span style="font-size: 18px; color: #58595F; font-weight: bold;">TOTAL</span>',style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);font-weight: bold;"},{html:'<span id="totalSpan" style="font-size: 18px; color: #58595F;">'+Ext.util.Format.usMoney(g.total,g.decimalPrecision,g.currencySymbol)+"</span>",style:"padding:10px;border-bottom: 0.1px solid rgb(208, 208, 208);border-left: 0.1px solid rgb(208, 208, 208);font-weight: bold;"}]},{xtype:"checkbox",name:"acceptTermsConditions",style:"margin-bottom: 30px; margin-left: 7px; margin-right: 4px; text-align: justify;",hidden:!Ext.Array.contains(["cybs"],e),labelSeparator:"",hideLabel:true,boxLabel:'<span style="color: #58595F;">Al pagar aceptas los términos y condiciones de la factura. Puedes conocerlos descargando el PDF desde el estado de cuenta.</span>'}];var j=Ext.create("Ext.button.Button",{text:translate("pay",true),formBind:true});m.push({xtype:"container",layout:{type:"hbox",pack:"end"},items:[{xtype:"box",name:"payDocumentButton",html:'<button id="payDocumentButton" class="pay-document-button">PAGAR</button>',smDisabled:false,getDisabled:function(){return this.smDisabled},setDisabled:function(r){this.smDisabled=r;var q=Ext.get("payDocumentButton");if(r){if(q){q.el.dom.innerText="PROCESANDO..."}}else{if(q){q.el.dom.innerText="PAGAR"}}}}]});var f=Ext.create("Ext.form.Panel",{id:"formPayInvoice",idLocal:g.idLocal,country:d.country,items:m,border:false,anchor:100,layout:"anchor",bodyPadding:5,style:"overflow:visible;",defaults:{anchor:"100%"}});var p=Ext.create("AL.view.common.SmileWindow",{reason:"payDocument",id:"window-pay-document",title:"",type:"original",bodyPadding:"0 35 35 35",width:650,modal:true,shadowOffset:30,draggable:false,resizable:false,items:[f]});var j=f.down("box[name=payDocumentButton]");if(!Ext.Array.contains(["cybs"],e)&&d.canApplyRetentions==="no"&&j){b.payDocument(j)}else{c.initiator.setLoading(false);p.show()}var o=Ext.get("payDocumentButton");if(o){o.on("click",function(s,q){if(!j.getDisabled()){if(Ext.Array.contains(["cybs"],e)){var r=f.down("[name=acceptTermsConditions]");if(!r.getValue()){Ext.Msg.alert("","Debes aceptar los términos y condiciones para proceder con el pago de tu factura");return}}b.payDocument(j)}})}var n=Ext.get("addOtherRetention");if(n){n.on("click",function(s){var q=Ext.get("retentions");q.setStyle("visibility","visible");Ext.widget("client_FormAddRetentions",{renderTo:"retentions"});var r=f.down("panel[name=retentionsPanel]");f.setHeight(f.getHeight()+40);r.setHeight(r.getHeight()+40)})}}else{Ext.Msg.alert("",l.cause)}}})},payWithNequi:function(a){Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/client/pay-with-nequi/idInvoice/"+a+"/format/json",method:"POST",showSpinner:true,params:{origin:window.location.href},success:function(b,c){var d=Ext.decode(b.responseText);if(d.success){Ext.create("AL.view.client.NequiPaymentWindow",{amount:d.amount,qrCode:d.qrCode,decimalPrecision:d.decimalPrecision,currencySymbol:d.currencySymbol,verificationUrl:"/client/check-and-update-nequi-transaction/format/json",idInvoice:a}).fadeIn()}else{Ext.Msg.alert("",d.cause)}}})},changeLabelAddressComponent:function(c){var a=Ext.ComponentQuery.query("client_FormAdd addressField[name=addressComponent]")[0];var d=a.up("form").down("combo[name=identificationType]");if(a){var b=translate("address",true);if(a.country=="costaRica"){b=d.getValue()!="PE"?"Ubicación":"Dirección"}if(c){a.changeLabel("Ubicación")}else{a.changeLabel('Ubicación<span class="req">*</span>')}}},changeLabelIdentificationComponent:function(a){var b=Ext.ComponentQuery.query("client_FormAdd label[name=labelIdentification]")[0];if(b){if(a){b.getEl().dom.innerHTML=translate("identification",true)}else{b.getEl().dom.innerHTML=translate("identification",true)+'<span class="req">*</span>'}}},calculateDv:function(f){if(isNaN(f)||f.length>15){return}var c;var e=[3,7,13,17,19,23,29,37,41,43,47,53,59,67,71];var d=0;for(var a=0;a<f.length;a++){d+=(f[a]*e[f.length-a-1])}var b=d%11;c=[0,1].indexOf(b)!==-1?b:11-b;return(c||c==0)?c:null},showLastestNews:function(a){var d=a.down("combo[name=paymentType]"),c=null,b=null;var e=function(){if(c&&b){c.close();b.close();var f={metadata:Ext.encode({hasSeenContactPayment:true})};Ext.Ajax.request({url:"/user/update-metadata/format/json",method:"POST",params:f,success:function(g,h){},failure:function(g){}});a.configs.hasSeenContactPayment=true}GlobalMask.hide()};c=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact"],title:"Nuevos campos",targetEl:d,position:"r-r",positionBy:"setPosition",layout:"fit",modal:false,offsets:[148,-20],closeCallback:e,closeGroupOnClose:true,items:[{xtype:"container",html:'<div class="notification-contact-text">Ahora puedes asociar el <span>método y la forma de pago</span> por defecto a cada <span>contacto.</span></div>'}],footerItems:["->",{xtype:"button",hrefTarget:"blank",text:"Ver más",cls:["sm-button-view-more"],href:"https://ayudas.getsoft.app/es/articles/1711352#crea-tus-contactos-en-alegra-mxico"},{xtype:"button",text:"Entendido",cls:"sm-button-primary",padding:"4 18",handler:function(){e(this.up("window"))}},],autoShow:false,repositionOnWindowResize:false,});b=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact-fields"],title:"",targetEl:c,position:"r-r",positionBy:"setPosition",modal:false,offsets:[-155,8],showHeader:false,closable:false,items:[{xtype:"container",width:140,padding:"0px 5px",html:'<div class="notification-contact-labels"><label class="x-form-item-label x-form-item-label-right">Método de pago</label><label class="x-form-item-label x-form-item-label-right">'+translate("pdf.paymentMethod",true)+"</label></div>"}],footerItems:[],autoShow:false,repositionOnWindowResize:false,});c.queueToShow([b]);setTimeout(function(){Ext.dom.Query.select(".app")[0].scrollBy(500,0,true);c.setNewPosition(c);b.setNewPosition(b)},100);GlobalMask.show("dark modal-client-notif");Ext.EventManager.onWindowResize(function(){Ext.dom.Query.select(".app")[0].scrollBy(500,0,true);c.setNewPosition(c);b.setNewPosition(b)},this,{buffer:1})},quickNewContact:function(o,d){var h=this.application;d.preventDefault();var f=Ext.ComponentQuery.query("bill_FormAddBill")[0];var m=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var a=o.down("combo[name=idClient]");var l="";if(a){l=a.getValue();if(a.getDisplayValue()){l=a.getDisplayValue()}}var b={name:l};var j="invoice";var k="";if(f){j="bill";if(f.type=="xml"){b=f.client;k="mexico"}}if(m){if(m.type=="xml"){b=m.client;k="mexico"}var g=m.down("switch[name=documentTypeSwitch]");if(g&&g.getOptionSelected()){j=g.getOptionSelected().value}}var n=Ext.get(Ext.DomQuery.select("body")[0]).getHeight()<500?(Ext.get(Ext.DomQuery.select("body")[0]).getHeight()*0.65):null;var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-client-modal",reason:"addNewClient",border:false,resizable:false,title:translate("createNewContact",true),width:920,height:n,bodyStyle:"overflow-y: auto;",items:[{xtype:"container",id:"addClient",items:[{xtype:"client_FormAdd",style:"margin-bottom: 0px;",title:"",configs:o.configs,country:o.configs.country,emergent:true,hideLinkToComments:true,client:b,stampVersion:o.configs.stampVersion,documentType:j,callback:function(e){c.close();if(o.configs.country=="mexico"){if(e.raw.thirdsType=="FOREIGN"){e.data.identification="XEXX010101000"}}h.fireEvent("clientCreated",{record:e,initiator:a,country:k})}}]},{xtype:"container",id:"addContact",style:"display: none",items:[{id:"addContactPanel",items:[{xtype:"box",height:0,html:'<div id="headersTable"><table><tr><td class="tbName">Nombre</td><td class="tbLastName">Apellido</td><td class="tbEmail">Correo electrónico</td><td class="tbPhone">'+translate("phone",true)+'</td><td class="tbMobile">'+translate("mobilePhone",true)+'</td><td class="tbSendNotifications" style="width: 133px">Enviar notificaciones<img style="position: absolute; top: 3px; margin-left: 4px" id="tooltip_notifications" src="https://cdn1.getsoft.app/images/sm-help.png" /></td></tr></table></div>',style:"background: #eee"}]}]},{xtype:"container",id:"windowButtonsHolder",items:[Ext.create("AL.view.buttons.SubmitReset",{buttonsConfig:{submitButtonAction:"saveClient",submitButtonText:translate("save",true)}})],hidden:true},],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){c.close()}},{text:translate("save",true),cls:"button main-button",handler:function(e){var q=e.up("window");var p=q.down("button[action=saveClient]");if(p){p.fireEvent("click",p)}},listeners:{afterrender:function(e){var q=e.up("window");var p=q.down("form");e.setDisabled(p.hasInvalidField());p.on("validitychange",function(s,r){e.setDisabled(!r)})}}}]}})},listClick:function(d,g){var c=this,a=this.application,b=d.up("combo").up("form"),f=g.target;if(f.getAttribute("data-action")==="quickNewContact"){this.quickNewContact(b,g)}},});Ext.define("AL.view.debitnote.GridAll",{extend:"AL.view.common.GridAllDebitNotes",alias:"widget.debitnote_GridAll",title:"Notas débito"});Ext.define("AL.view.item.GridDebitNotes",{extend:"AL.view.common.GridAllDebitNotes",alias:"widget.item_GridDebitNotes",title:"Notas débito"});Ext.define("AL.view.company.modern.WindowExportInfo",{extend:"AL.view.common.SmileWindow",requires:["AL.view.buttons.modern.Button","AL.view.common.modern.Msg"],alias:"widget.company_modern_WindowExportInfo",modal:true,autoShow:true,draggable:false,resizable:false,border:false,layout:{type:"vbox",align:"stretch"},width:515,height:240,idConfig:null,documentTypeConfig:"",reportFormatConfig:"xlsx",helpHtmlConfig:"",successMsgConfig:null,itemsConfig:[],items:[{xtype:"label",margin:"0 20 12 20",style:{"font-family":"Roboto",color:"#808080","font-size":"12px"}}],footer:{items:[{xtype:"buttons_modern_Button",type:"basic",width:103,text:"Cancelar",handler:function(a){var b=a.up("window");b.destroy()}},{xtype:"button",cls:"button main-button",width:127,text:translate("export",true),handler:function(a){var b=a.up("window");if(b.exportCallbackConfig){b.exportCallbackConfig(a)}}}]},initComponent:function(){this.items[0].html=this.helpHtmlConfig;this.items=this.items.concat(this.itemsConfig);this.callParent(arguments)},enableButtonCallback:function(a,b){a.update("Exportar");a.enable()},disableButtonCallback:function(a,b){a.disable();a.update('<svg class="icon icon-spin" style="margin-left: 5px; margin-top: 1px; color: white;"><use xlink:href="/images/smile-icons.svg#loading"></use></svg>')},exportCallbackConfig:function(l){var j=l.up("window");var c=j.down("form");if(c&&!c.isValid()){return}var d=j.down("datefield[name=fromDate]");var k=j.down("datefield[name=toDate]");var n=j.documentTypeConfig;var a=j.reportFormatConfig;var m=d.getValue();var h=k.getValue();var g=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate();var e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var b="/labs/test11/exportable-type/"+n+"/format/json";if(n=="all"){b="/labs/test13/format/json"}if(g&&e){b=b+"/from-date/"+g+"/to-date/"+e}var f={};var o=a=="text"?"plano":"excel";var p=["Alegra está generando tu archivo "+o+" y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");if(["report-606","report-607","report-608"].indexOf(n)!==-1){p+="</br></br> Recuerda validar la información antes de presentarla ante cualquier</br>entidad de control.</br></br>";if(a!=""){b+="/file-type/"+a}}if(j.successMsgConfig){p=j.successMsgConfig}if(j.disableButtonCallback){j.disableButtonCallback(l,j)}Ext.Ajax.request({url:b,params:f,binary:true,timeout:300000,success:function(v,B){if(j.enableButtonCallback){j.enableButtonCallback(l,j)}j.close();try{var w=String.fromCharCode.apply(null,new Uint8Array(v.responseBytes));w=w.replace(/Already running.../gi,"");var s=Ext.decode(w);if(!s.success){Ext.create("AL.view.common.modern.Msg",{title:"Ocurrió un error",msgHtmlConfig:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link" target="_blank">getsoft.app/123</a>'})}else{if(s.rowsCount==0){p=translate("sorryNoRecordsFoundToExport",true)}Ext.create("AL.view.common.modern.Msg",{title:"Generando archivo "+AL.string.toCapitalizeFirstWord(o),msgHtmlConfig:p});if(n==="all"&&j.idConfig){var A=new Date();A.setTime(A.getTime()+(3600*1000));Ext.util.Cookies.set("export-all-info-job-"+j.idConfig,"working",A)}}}catch(z){var r="";var u=v.getResponseHeader("Content-Disposition");if(u&&u.indexOf("attachment")!==-1){var t=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var y=t.exec(u);if(y!=null&&y[1]){r=y[1].replace(/['"]/g,"")}}var D=v.getResponseHeader("Content-Type");var q=typeof File==="function"?new File([v.responseBytes],r,{type:D}):new Blob([v.responseBytes],{type:D});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(q,r)}else{var C=window.URL||window.webkitURL;var x=C.createObjectURL(q);if(r){var E=document.createElement("a");if(typeof E.download==="undefined"){window.location=x}else{E.href=x;E.download=r;document.body.appendChild(E);E.click()}}else{window.location=x}setTimeout(function(){C.revokeObjectURL(x)},100)}}},failure:function(q){console.log(q);Ext.create("AL.view.common.modern.Msg",{title:"Ocurrió un error",msgHtmlConfig:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link" target="_blank">getsoft.app/123</a>'});if(j.enableButtonCallback){j.enableButtonCallback(l,j)}}})}});Ext.define("AL.view.company.modern.WindowExportInfoPreviousYearInterval",{extend:"AL.view.company.modern.WindowExportInfo",alias:"widget.company_modern_WindowExportInfoPreviousYearInterval",itemsConfig:[{xtype:"form",layout:"anchor",defaultType:"datefield",format:"d/m/Y",defaults:{allowBlank:false,margin:"10 0 10 50",labelAlign:"right",labelPad:50,width:340},items:[{fieldLabel:"Desde",name:"fromDate"},{fieldLabel:"Hasta",name:"toDate"}]}],});Ext.define("AL.view.ux.view.GroupingList",{extend:"Ext.view.View",alias:"widget.groupinlist",requires:["Ext.layout.component.BoundList","Ext.toolbar.Paging","AL.plugin.SimplePaging"],pageSize:0,autoScroll:true,baseCls:Ext.baseCSSPrefix+"boundlist",listItemCls:"",shadow:false,trackOver:true,refreshed:0,disabledField:null,disabledValue:null,ariaRole:"listbox",componentLayout:"boundlist",renderTpl:['<div class="list-ct"></div>'],initComponent:function(){var h=this,e=h.baseCls,a=e+"-item",g=e+"-item-disabled";h.itemCls=a;h.selectedItemCls=e+"-selected";h.overItemCls=e+"-item-over";h.itemSelector="."+a;if(h.floating){h.addCls(e+"-floating")}if(!h.groupFieldPrefix){h.groupFieldPrefix=""}if(!h.afterTpl){h.afterTpl=""}var f=["<ul>",'<tpl for=".">'];var j=1;if(Ext.isArray(h.groupField)){j=h.groupField.length;for(var d=0;d<h.groupField.length;d++){f.push("<tpl if=\"xindex == 1 || parent[xindex - 2]['"+h.groupField[d]+"'] != values['"+h.groupField[d]+"']\">",'<li class="x-combo-list-group" style="padding-left:'+(d*16)+'px;">{["'+h.groupFieldPrefix+'" + translate(values["'+h.groupField[d]+'"])]}</li>',"</tpl>")}}else{f.push("<tpl if=\"xindex == 1 || parent[xindex - 2]['"+h.groupField+"'] != values['"+h.groupField+"']\">",'<li class="x-combo-list-group">{["'+h.groupFieldPrefix+'" + translate(values["'+h.groupField+'"])]}</li>',"</tpl>")}var c=h.disabledValue?h.disabledField+" == '"+h.disabledValue+"'":h.disabledField,b=h.disabledField?['<tpl if="'+c+'">','<li role="option" class="'+a+" {indentClass} "+g+'" style="padding-left:'+(j*16)+'px;">{[values["'+h.displayField+'"]]}</li>',"<tpl else>",'<li role="option" class="'+a+' {indentClass}" style="padding-left:'+(j*16)+'px;">{[values["'+h.displayField+'"]]}</li>',"</tpl>",].join(""):'<li role="option" class="'+a+' {indentClass}" style="padding-left:'+(j*16)+'px;">{[values["'+h.displayField+'"]]}</li>';f.push(b,"</tpl>",h.afterTpl,"</ul>");h.tpl=Ext.create("Ext.XTemplate",f);if(h.pageSize){h.pagingToolbar=h.createPagingToolbar()}h.callParent();Ext.applyIf(h.renderSelectors,{listEl:".list-ct"});if(h.disabledField){h.on("beforeselect",function(k,l){if(!h.isRecordSelectable(l)){return false}})}},createPagingToolbar:function(){return Ext.create("AL.plugin.SimplePaging",{pageSize:this.pageSize,store:this.store,border:false,afterDisplayMsg:this.afterDisplayMsg,emptyObjType:this.emptyObjType,displayMsg:translate("showing",true)+" {0} - {1} "+translate("of")+" {2}",emptyMsg:translate("emptyData",true),})},onRender:function(){var b=this,a=b.pagingToolbar;b.callParent(arguments);if(a){a.render(b.el)}},bindStore:function(a,b){var d=this,c=d.pagingToolbar;d.callParent(arguments);if(c){c.bindStore(a,b)}},getTargetEl:function(){return this.listEl||this.el},getInnerTpl:function(a){return"{"+a+"}"},refresh:function(){var a=this;a.callParent();if(a.isVisible()){a.refreshed++;a.doComponentLayout();a.refreshed--}},initAria:function(){this.callParent();var a=this.getSelectionModel(),c=a.getSelectionMode(),b=this.getActionEl();if(c!=="SINGLE"){b.dom.setAttribute("aria-multiselectable",true)}},onDestroy:function(){Ext.destroyMembers(this,"pagingToolbar","listEl");this.callParent()},isRecordSelectable:function(a){var b=true;if(this.disabledValue){if(a.get(this.disabledField)==this.disabledValue){b=false}}else{if(a.get(this.disabledField)){b=false}}return b}});Ext.define("AL.view.ux.form.GroupingComboBox",{extend:"Ext.form.field.ComboBox",requires:["AL.view.ux.view.GroupingList"],alias:["widget.groupingcombobox","widget.groupingcombo"],allowPaginate:false,initComponent:function(){var b=this;if(!b.displayTpl){var c=[],a='<tpl for=".">{0}</tpl>';c.push('{[values["'+b.displayField+'"]]}');b.displayTpl=Ext.String.format(a,c.join(this.displaySeparator||" "))}b.callParent()},createPicker:function(){var d=this;var a=d.pageSize;if(d.allowPaginate&&!a){if(d.store.pageSize){a=d.store.pageSize}}var b,e=Ext.baseCSSPrefix+"menu",c=Ext.apply({selModel:{mode:d.multiSelect?"SIMPLE":"SINGLE"},floating:true,hidden:true,ownerCt:d.ownerCt,cls:d.el.up("."+e)?e:"",store:d.store,groupField:d.groupField,displayField:d.displayField,focusOnToFront:false,pageSize:a,afterDisplayMsg:this.afterDisplayMsg,emptyObjType:this.emptyObjType,disabledField:this.disabledField,disabledValue:this.disabledValue},d.listConfig,d.defaultListConfig);b=d.picker=Ext.create("AL.view.ux.view.GroupingList",c);d.mon(b,{itemclick:d.onItemClick,refresh:d.onListRefresh,scope:d});d.mon(b.getSelectionModel(),"selectionchange",d.onListSelectionChange,d);return b},onListSelectionChange:function(b,d){var a=this,e=a.multiSelect,c=d.length>0;if(!a.ignoreSelection&&a.isExpanded){if(!e&&c){Ext.defer(a.collapse,1,a)}if(e||c){a.setValue(d,false)}if(c){a.fireEvent("select",a,d)}a.inputEl.focus()}},onTypeAhead:function(){var e=this,d=e.displayField,b=e.store.findRecord(d,e.getRawValue()),c=e.getPicker(),f,a,g;if(b&&c.isRecordSelectable(b)){f=b.get(d);a=f.length;g=e.getRawValue().length;c.highlightItem(c.getNode(b));if(g!==0&&g!==a){e.setRawValue(f);e.selectText(g,f.length)}}},});Ext.define("AL.view.company.WindowExportInfo",{id:"window-export-info",alias:"widget.company_WindowExportInfo",extend:"Ext.window.Window",title:"Exportar información",style:"background: #fff; overflow:visible;",cls:"container-visible",requires:["AL.view.ux.form.GroupingComboBox"],border:false,bodyPadding:"30 40 30 40",bodyStyle:"background: transparent; overflow: visible;",layout:{type:"anchor"},width:345,modal:true,autoShow:true,items:[{xtype:"form",border:false,bodyStyle:"overflow: visible;",items:[{xtype:"groupingcombobox",name:"dateRange",groupField:["parentName"],valueField:"range",displayField:"text",store:Ext.create("Ext.data.Store",{fields:["range","text","parentName"],data:[{range:"today",text:translate("today",true),parentName:translate("present",true)},{range:"thisWeek",text:translate("thisWeek",true),parentName:translate("present",true)},{range:"thisMonth",text:translate("thisMonth",true),parentName:translate("present",true)},{range:"thisYear",text:translate("thisYear",true),parentName:translate("present",true)},{range:"previousDay",text:translate("yesterday",true),parentName:translate("previous",true)},{range:"previousWeek",text:translate("lastWeek",true),parentName:translate("previous",true)},{range:"previousMonth",text:translate("lastMonth",true),parentName:translate("previous",true)},{range:"previousYear",text:translate("lastYear",true),parentName:translate("previous",true)},{range:"custom",text:translate("manual",true),parentName:"Manual"},]}),queryMode:"local",typeAhead:true,emptyText:translate("dateRange",true),width:250,matchFieldWidth:false,listConfig:{width:220,height:200},forceSelection:true},{xtype:"datefield",fieldLabel:translate("from",true),name:"fromDate",allowBlank:false,format:"d/m/Y",labelWidth:60,width:250,listeners:{change:function(h,f,a,c){var d=h.up("form");if(!d){return}var e=d.up("window");if(e&&e.documentType=="sales-detail"){var b=e.down("[name=sales-detail]");if(b){if(h.isValid()){b.enable()}else{b.disable()}}}var g=d.down("datefield[name=toDate]");if(!g){return}if(f instanceof Date&&!isNaN(f.getTime())){g.setMinValue(f)}}}},{xtype:"datefield",fieldLabel:translate("until",true),name:"toDate",allowBlank:false,format:"d/m/Y",labelWidth:60,width:250,listeners:{change:function(g,f,a,c){var d=g.up("form");if(!d){return}var e=d.up("window");if(e&&e.documentType=="sales-detail"){var b=e.down("[name=sales-detail]");if(b){if(g.isValid()){b.enable()}else{b.disable()}}}}}},{xtype:"button",text:translate("export",true),action:"export-info",formBind:true,style:"margin-left: 80px; margin-top: 7px"},{xtype:"label",name:"export-all-label",id:"export-all-label",html:'<a id=exportAllInfo href="#" style="color:#999; position:absolute; right: -35px; bottom:-25px; font-size:10px;">'+translate("exportAll",true)+"</a>",margin:"20 0 0 0"}]}],listeners:{afterrender:function(n,c){var d=n.down("form");var b=Ext.get("exportAllInfo");if(n.documentType&&n.documentType==="all"){b.hide()}if(n.hideExportAll&&n.hideExportAll=="yes"){b.hide()}var p=n.down("datefield[name=fromDate]");var j=n.down("datefield[name=toDate]");var l=this.down("groupingcombobox[name=dateRange]");l.on("change",function(w,u,t,B){var D=new Date();var C=Ext.Date.format(D,"N");var x=Ext.Date.getDayOfYear(D);var v=null;var z=null;switch(u){case"today":v=D;z=v;break;case"thisWeek":v=Ext.Date.add(D,Ext.Date.DAY,-1*C+1);z=Ext.Date.add(v,Ext.Date.DAY,6);break;case"thisMonth":v=Ext.Date.getFirstDateOfMonth(D);z=Ext.Date.getLastDateOfMonth(D);break;case"thisYear":v=Ext.Date.add(D,Ext.Date.DAY,-1*x);if(Ext.Date.isLeapYear(D)){z=Ext.Date.add(v,Ext.Date.DAY,365)}else{z=Ext.Date.add(v,Ext.Date.DAY,364)}break;case"previousDay":v=Ext.Date.add(D,Ext.Date.DAY,-1);z=v;break;case"previousWeek":var A=Ext.Date.add(D,Ext.Date.DAY,-1*C+1);v=Ext.Date.add(A,Ext.Date.DAY,-7);z=Ext.Date.add(v,Ext.Date.DAY,6);break;case"previousMonth":var E=Ext.Date.getFirstDateOfMonth(D);z=Ext.Date.add(E,Ext.Date.DAY,-1);v=Ext.Date.getFirstDateOfMonth(z);break;case"previousYear":var y=Ext.Date.add(D,Ext.Date.DAY,-1*x);z=Ext.Date.add(y,Ext.Date.DAY,-1);if(Ext.Date.isLeapYear(z)){v=Ext.Date.add(z,Ext.Date.DAY,-365)}else{v=Ext.Date.add(z,Ext.Date.DAY,-364)}break;case"custom":break;default:break}if(v&&z){p.causedByCombo=true;p.setValue(v);j.causedByCombo=true;j.setValue(z)}},this);p.on("expand",function(){l.select("custom")});j.on("expand",function(){l.select("custom")});l.select("thisMonth");switch(this.documentType){case"daily-report":var q=n.down("groupingcombobox[name=dateRange]");q.hide();var m=n.down("datefield[name=fromDate]");m.setFieldLabel("Día");m.setValue(new Date());var o=n.down("datefield[name=toDate]");o.hide();var e=n.down("label[name=export-all-label]");e.hide();var a=n.down("button[action=export-info]");a.hide();var g={xtype:"button",name:"daily-report",text:"Descargar",action:"download-daily-report",formBind:true,style:"margin-left: 80px; margin-top: 7px"};n.add(g);n.setHeight(150);m.setFieldStyle("margin-bottom: 20px");break;case"report-606":case"report-608":case"report-607":var k=this.documentType=="report-607"?"xlsx":"xls";var r=Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"Archivo plano",value:"text"},{name:"Archivo excel",value:k}]});var f=Ext.create("Ext.form.ComboBox",{name:"reportFormat",store:r,queryMode:"local",displayField:"name",valueField:"value",typeAhead:true,emptyText:"Formato",width:200,matchFieldWidth:false,listConfig:{width:200,height:200},forceSelection:true});f.select("text");d.insert(0,f);var s=Ext.get("export-all-label");switch(this.documentType){case"report-606":case"report-607":var h=this.documentType==="report-606"?'<a href="https://ayuda.getsoft.app/genera-el-reporte-606-desde-alegra-rep%C3%BAblica-dominicana" target="_blank" style="color:#999; position:absolute; left: -35px; bottom:-25px; font-size:10px;">¿Cómo funciona?</a>':"";s.setHTML(h+'<a href="/report/edit-report-categories" style="color:#999; position:absolute; right: -35px; bottom:-25px; font-size:10px;">Configuración</a>');break;case"report-608":s.hide();break}break;case"sales-detail":var a=n.down("button[action=export-info]");a.hide();var g={xtype:"button",name:"sales-detail",text:"Descargar",action:"download-sales-detail",formBind:true,style:"margin-left: 80px; margin-top: 7px"};n.add(g);var s=Ext.get("export-all-label");s.hide();break;case"report-1003":l.select("previousYear");break;case"ledger-trial-balance":l.select("previousYear");d.insert(3,{xtype:"category_CategoriesGroupingCombo",emptyText:"Filtrar por "+translate("categoryShort"),width:250,labelWidth:60,});d.insert(4,{xtype:"client_ClientsCombo",fieldLabel:"Tercero",emptyText:"Filtrar por tercero",width:250,labelWidth:60,});var s=Ext.get("export-all-label");s.hide();break}}}});Ext.define("AL.view.category.CategoriesGroupingCombo",{extend:"AL.view.ux.form.GroupingComboBox",requires:["AL.view.ux.view.GroupingList"],alias:"widget.category_CategoriesGroupingCombo",name:"idCategory",fieldLabel:translate("categoryShort",true),allowBlank:true,groupField:["parentName"],valueField:"idLocal",displayField:"text",store:"CategoriesCombo",queryMode:"remote",typeAhead:true,emptyText:"Seleccione la "+translate("category"),width:320,labelWidth:80,matchFieldWidth:false,listConfig:{width:300,height:200},forceSelection:true,});Ext.define("AL.controller.Company",{extend:"Ext.app.Controller",views:["company.FormInfoEdit","company.FormInvoiceInfoEdit","company.FormInvoiceTemplateEdit","company.FormNextInvoiceNumber","company.FormNextTransactionNumber","company.WindowExportInfo","company.WindowIncompleteInfo","company.WindowAclError","company.InvoiceTemplatePicker","company.FormUploadFile","company.GridAllStampReceptionMails","company.FormEditDocumentsNumber","company.FormEditEmailTemplate","company.EmailTemplates","admin.company.CountriesCombo","company.FormExternalPaymentsEdit","company.WindowReactiveDemo","company.FormTemplatePdfEdit","company.FormTemplateOther","company.EditTemplatesPanel","company.DocumentPicker","company.TemplateWindow","company.FileUploadWindow","company.FileUploadWindowLogo","ux.fields.Address","ux.fields.Name","ux.window.ModalTooltip","company.WindowInfoEdit","common.FormSignature","company.FormExternalPaymentsEditSwitch","externalpayments.FormEdit","externalpayments.Welcome","ux.fields.EditableListModal","externalpayments.FormEditNequi","externalpayments.FormEditPayU","externalpayments.FormEditRappiPay","externalpayments.FormEditTpaga","ux.form.Switch","ux.fields.EditableList","company.modern.WindowExportInfoPreviousYearInterval","payroll.PlansSelectionWindow","category.CategoriesGroupingCombo","client.ClientsCombo",],stores:["Companies","InvoiceTemplates","TemplatesPdf","StampReceptionMails","CountriesList","TimezonesList","CurrenciesAll","PdfTemplates","KindsOfPerson","IdentificationTypes","Provinces","Departments","Regions","Communes","Cantons","Districts","Neighborhoods","Cities","Countries","ConditionsIIBB","IvaConditions","EconomicActivities","OnlinePaymentListByCountry","FiscalResponsabilities",],models:["Company","InvoiceTemplate","StampReceptionMail","PdfTemplate","CountryLegalParameter",],init:function(){var a=Ext.select(".attachment-delete");a.on("click",function(g,h){var f=Ext.get(h);var j=f.getAttribute("data-id");var d=f.getAttribute("data-name");Ext.Msg.show({title:translate("deleteFile",true),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("file")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){GlobalRedirector.go({zoneTitle:translate("deletingFile",true)});Ext.Ajax.request({url:"/file/delete/format/json",method:"POST",params:{id:j},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){window.location.reload()}else{GlobalRedirector.close();if(m.cause){GlobalMsg.showErrorMessage(translate("error",true),m.cause)}}},failure:function(m,l){GlobalRedirector.close();var k=l.response;var n=Ext.decode(k.responseText);if(n.cause){GlobalMsg.showErrorMessage(translate("error",true),n.cause)}}})}}})});var c=Ext.select(".uploadFile");var b=this;c.on("click",function(l,d){l.preventDefault(0);var h=Ext.get(d);var n="";var k=h.getAttribute("data-idType");var m=h.getAttribute("data-type");var j=Ext.ComponentQuery.query(m+"_MoreActionsButton")[0];if(j&&j.maxFiles){n=j.maxFiles}var f=h.getAttribute("data-canUpload");if(f=="yes"){var g={};g.type=m;g.idType=k;b.application.fireEvent("uploadFile",g)}else{var o=Ext.create("AL.modal.PlanLimit",{configs:{message:"Has agregado <strong>"+n+" archivos adjuntos </strong> disponibles en tu plan actual. Elige un nuevo plan para realizar esta acción y seguir creciendo con Alegra."}});o.init()}});this.application.addListener("uploadFile",function(f){var e=f.type;var d=f.idType;var g=translate("attachAFile",true);if(f.windowTitle){g=f.windowTitle}Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,bodyStyle:"background: transparent",frame:false,title:g,items:[{xtype:"company_FormUploadFile",type:e,idType:d,margin:"0 30 0 30"}],footer:{items:[{cls:"button main-button",text:translate("attach",true),action:"uploadFile",margin:"0 28 0 0",handler:function(h){var k=h.up("window");var j=k.down("button[action=uploadFile]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(h){var k=h.up("window");var j=k.down("form");h.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){h.setDisabled(!l)})}}}]},listeners:{afterrender:function(k){var h=k.down("button[action=uploadFile]");var j=k.down("[name=title]");if(h){h.hide()}if(j){j.hide()}}}})});this.application.addListener("updateEmailTemplate",function(e){var d=e.emailType;Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,width:600,height:550,bodyPadding:"0 15 10 15",bodyStyle:"background: transparent",frame:false,title:translate("edit",true)+" "+translate("emailTemplate"),items:[{xtype:"company_FormEditEmailTemplate",type:d,emailExample:e.emailExample,companyName:e.companyName,country:e.country,statementClientAttached:e.statementClientAttached}],footer:{items:[{text:translate("cancelAction",true),handler:function(f){var g=f.up("window");if(g){g.close()}}},{text:translate("save",true),cls:"button main-button",action:"save",handler:function(f){var h=f.up("window");var g=h.down("company_FormEditEmailTemplate button[action=save]");if(g){g.fireEvent("click",g)}}},]}})});this.application.addListener("editInvoiceNumberWindow",function(d){Ext.create("AL.view.common.SmileWindow",{reason:"editInvoiceNumber",style:"background: transparent",bodyStyle:"background: transparent",title:translate("modify",true)+" "+translate("number")+" "+translate("ofInvoicing"),bodyCls:"",autoShow:true,modal:true,border:false,frame:false,width:430,items:[{xtype:"company_FormNextInvoiceNumber",idLocal:d.idLocal,country:d.country,isActiveElectronicInvoicing:d.isActiveElectronicInvoicing,configs:{country:d.country,isActiveElectronicInvoicing:d.isActiveElectronicInvoicing}}],footer:{items:[{text:translate("save",true),cls:"button main-button",handler:function(e){var g=e.up("window");var f=g.down("button[action=saveNextInvoiceNumber]");if(f){f.fireEvent("click",f)}},listeners:{afterrender:function(e){var g=e.up("window");var f=g.down("form");e.setDisabled(f.hasInvalidField());f.on("validitychange",function(j,h){e.setDisabled(!h)})}}}]},})},this);this.application.addListener("editTransactionNumber",function(e){var d=(e.type==="in")?"incomingTransaction":"outgoingTransaction";Ext.create("AL.view.common.SmileWindow",{reason:"editTransactionNumber",style:"background: transparent",bodyStyle:"background: transparent",bodyCls:"",type:e.type,autoShow:true,modal:true,border:false,frame:false,width:460,title:translate("modifyTransactionNumber",true,{transaction:"{{"+d+"}}"}),items:[{xtype:"company_FormNextTransactionNumber",type:e.type,country:e.country}],footer:{items:[{text:translate("save",true),cls:"button main-button",handler:function(f){var h=f.up("window");var g=h.down("button[action=saveNextTransactionNumber]");if(g){g.fireEvent("click",g)}},listeners:{afterrender:function(f){var h=f.up("window");var g=h.down("form");f.setDisabled(g.hasInvalidField());g.on("validitychange",function(k,j){f.setDisabled(!j)})}}}]},})},this);this.application.addListener("exportAllInformation",function(d){},this);this.application.addListener("editCompanyEvent",function(d,f,e){b.editEmergentEvent(d,f,e)});this.application.addListener("deleteStampReceptionMail",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:"Eliminar correo",msg:"¿Estás seguro de eliminar el correo? Esta operación no se puede deshacer.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(g){if(g=="yes"){Ext.Ajax.request({url:"/stamp-reception-mail/delete/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var h=e.getStore();h.load()}else{Ext.MessageBox.alert("Error",l.cause)}},failure:function(){}})}}})},this);this.control({" button[name=configureTemplate]":{click:function(e){var f=e.up("form");var d=this.application;var h={};h.emailType=e.emailType;if(!f){f=e.up("panel")}var g=f.down("box[queryName="+e.emailType+"]");h.companyName=f.companyName;h.country=f.country;h.statementClientAttached=f.statementClientAttached;h.emailExample=g;d.fireEvent("updateEmailTemplate",h)}},company_FormNextInvoiceNumber:{beforerender:function(e){var d=e.down("textfield[name=prefix]");var g=e.down("textfield[name=nextInvoiceNumber]");var h=e.down("checkbox[name=isElectronicResolution]");var f=e.down("checkbox[name=autoincrement]");if(e.isActiveElectronicInvoicing===true){if(h.getValue()===true){f.setValue(true);f.disable()}else{f.enable()}}if(e.country==="chile"){g.setFieldLabel("Siguiente "+translate("numeration")+" de "+translate("invoice"))}if(e.country==="peru"){if(e.isActiveElectronicInvoicing===true){g.maxLength=8;d.allowBlank=false;d.minLength=4;d.maxLength=4;d.regex=/[F]([A-Za-z0-9]{3})/;h.show()}else{d.regex=/^([A-Za-z0-9]+)$/}}else{if(e.country==="argentina"){f.setValue(true);f.disable();d.fieldLabel=translate("prefix",true);d.regex=/^[0-9]*$/;d.maxLength=5;d.allowBlank=false;g.maxLength=8}}},render:function(d){Ext.Ajax.request({url:"/resolution/retrieve-one/fields/hasDocuments/format/json",params:{id:d.idLocal},success:function(h,n){var o=Ext.decode(h.responseText);if(o.success){var k=o.results;var f=d.down("displayfield[name=name]");var l=d.down("checkbox[name=autoincrement]");var p=d.down("hidden[name=idLocal]");var q=d.down("textarea[name=resolutionText]");var g=d.down("textfield[name=prefix]");var m=d.down("textfield[name=nextInvoiceNumber]");var e=d.down("checkbox[name=isElectronicResolution]");f.setValue(k.name);p.setValue(k.idLocal);var j=k.metadata&&k.metadata.isElectronicResolution;if(k.metadata){d.setFieldValuesFromMetadata(k.metadata)}q.setValue(k.resolutionText);if(k.autoincrement==="yes"){l.setValue(true);m.suspendEvents();m.setValue(k.nextInvoiceNumber);m.resumeEvents();g.setValue(k.prefix)}else{g.allowBlank=true;l.setValue(false)}if(k.hasDocuments){e.disable()}switch(d.country){case"colombia":case"peru":case"costaRica":if(j===true){l.disable()}else{l.enable()}if(d.configs.isActiveElectronicInvoicing===true){e.show()}else{e.hide()}break}if(d.country==="chile"&&j===true){q.disable();g.hide()}if(d.country==="costaRica"){e.disable();if(j===true){g.disable()}q.originalValue=k.resolutionText;if(Ext.Array.contains(["invoice","saleTicket"],k.documentType)&&j===true){q.setReadOnly(true);q.setValue("Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019")}else{q.setReadOnly(false);if(q.originalValue){q.setValue(q.originalValue)}else{q.setValue(null)}}}if(d.country==="peru"){d.documentType=k.documentType;if(d.isActiveElectronicInvoicing===true){m.maxLength=8;g.minLength=4;g.maxLength=4;switch(k.documentType){case"invoice":g.regex=/[F]([A-Za-z0-9]{3})/;break;case"saleTicket":g.regex=/[B]([A-Za-z0-9]{3})/;break}}else{g.regex=/^([A-Za-z0-9]+)$/}q.originalValue=k.resolutionText;if(Ext.Array.contains(["invoice","saleTicket"],k.documentType)&&j===true){q.setReadOnly(true);q.setValue("Autorizado mediante resolución Nº 034-005-0004781")}else{q.setReadOnly(false);if(q.originalValue){q.setValue(q.originalValue)}else{q.setValue(null)}}d.isValid()}}else{}},failure:function(){}})}},"company_FormNextInvoiceNumber [name=resolutionText]":{beforerender:function(e){var d=e.up("form");if(d.country){switch(d.country){case"peru":e.readOnlyCls="x-item-disabled";break;case"costaRica":e.readOnlyCls="x-item-disabled";break}}}},"company_FormNextInvoiceNumber checkbox[name=isElectronicResolution]":{change:function(g){var f=g.up("form");var d=f.down("textfield[name=prefix]");var e=f.down("textfield[name=nextInvoiceNumber]");var j=f.down("checkbox[name=autoincrement]");var h=f.down("[name=resolutionText]");if(g.checked===true){j.setValue(true);j.disable()}else{j.enable()}switch(f.country){case"peru":if(g.checked===true){e.maxLength=8;d.allowBlank=false;d.minLength=4;d.maxLength=4;if(f.documentType){switch(f.documentType){case"invoice":d.regex=/[F]([A-Za-z0-9]{3})/;break;case"saleTicket":d.regex=/[B]([A-Za-z0-9]{3})/;break}}else{d.regex=/[F]([A-Za-z0-9]{3})/}j.setValue(true);j.disable();if(Ext.Array.contains(["invoice","saleTicket"],f.documentType)){h.setReadOnly(true);h.setValue("Autorizado mediante resolución Nº 034-005-0004781")}}else{e.maxLength=11;d.allowBlank=true;d.minLength=0;d.maxLength=100;d.regex=/^([A-Za-z0-9]+)$/;j.enable();if(Ext.Array.contains(["invoice","saleTicket"],f.documentType)){h.setReadOnly(false);if(h.originalValue){h.setValue(h.originalValue)}else{h.setValue(null)}}}break;case"colombia":if(g.checked===true){j.setValue(true);j.disable()}else{j.enable()}break;case"costaRica":if(g.checked===true){d.allowBlank=false;d.minLength=10;d.maxLength=10;if(Ext.Array.contains(["invoice","saleTicket"],f.documentType)){h.setReadOnly(true);h.setValue("Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019")}}else{d.allowBlank=true;d.minLength=0;d.maxLength=100;if(Ext.Array.contains(["invoice","saleTicket"],f.documentType)){h.setReadOnly(false);if(h.originalValue){h.setValue(h.originalValue)}else{h.setValue(null)}}}break;case"argentina":j.setValue(true);j.disable();break}if(["peru","argentina"].indexOf(f.country)==-1){d.regex=""}f.getForm().isValid()}},"company_FormNextInvoiceNumber textfield[name=nextInvoiceNumber]":{change:function(e){var d=e.up("form");var f=d.down("checkbox[name=isElectronicResolution]");if(["colombia","peru"].indexOf(d.country)!==-1&&f.getValue()===true){Ext.Msg.alert("Advertencia","Estás usando una numeración electrónica, te recomendamos no editar el siguiente número de "+translate("invoice"))}}},"company_FormNextInvoiceNumber button[action=saveNextInvoiceNumber]":{click:function(k){k.disable();var o=this.application;var e=k.up("form");var g=e.down("textfield[name=prefix]");var j=e.down("checkbox[name=autoincrement]");var n=e.down("textarea[name=resolutionText]");var d=e.down("checkbox[name=isElectronicResolution]");g.getSubmitData=this.getSubmitDataDisabled;d.getSubmitData=this.getSubmitDataDisabled;j.getSubmitData=this.getSubmitDataDisabled;var f=e.getForm();var m=e.down("hidden[name=idLocal]");var h={id:m.getValue()};var p=e.getFieldValuesAsMetadata();if(p){h.metadata=Ext.encode(p)}var l=e.up("window");if(f.isValid()){f.submit({url:"/resolution/edit-next-resolution-number/format/json",params:h,waitMsg:translate("loading",true),submitEmptyText:false,success:function(t,r){var q=r.response;var u=Ext.decode(q.responseText);if(u.success){if(l){l.close()}var s=u.results;o.fireEvent("nextInvoiceNumberEdited",s)}else{Ext.MessageBox.alert(translate("error",true),u.cause)}},failure:function(s,r){k.enable();var q=r.response;var t=Ext.decode(q.responseText);Ext.MessageBox.alert(translate("error",true),t.cause)}})}}},"company_FormInfoEdit filefield[name=certificate]":{change:function(h,j,d,e){var g=h.up("form");var f=g.down("filefield[name=privateKey]");f.allowBlank=false;this.removeFakePathWord(h,j)}},"company_FormInfoEdit filefield[name=privateKey]":{change:function(j,k,f,g){var h=j.up("form");var d=h.down("filefield[name=certificate]");var e=h.down("textfield[name=keyPassword]");d.allowBlank=false;e.allowBlank=false;this.removeFakePathWord(j,k)}},"company_FormInfoEdit filefield[name=logo]":{change:function(f,e,d){this.removeFakePathWord(f,e)}},"company_FormInfoEdit combo[name=regime]":{change:function(k,j,f){var h=k.up("form");switch(h.country){case"colombia":var g=h.down("combo[name=invoiceText]");var e=h.down("checkbox[name=isActiveElectronicInvoicing]");if(["SPECIAL_REGIME","NOT_REPONSIBLE_FOR_CONSUMPTION"].indexOf(j)!==-1){e.setValue(false);e.disable();e.getSubmitData=this.getSubmitDataDisabled}else{var d=h.down("combo[name=versionElectronicInvoicing]");if(j=="SIMPLE_REGIME_OF_TAXATION"){d.setValue("2.1");d.disable()}else{d.enable()}e.enable()}if(e.getValue()==true||j!="SIMPLIFIED_REGIME"){g.setValue("factura de venta");g.disable();g.getSubmitData=this.getSubmitDataDisabled}else{if(j=="SIMPLIFIED_REGIME"&&e.getValue()!=true){g.setValue("cuenta de cobro");g.enable()}}break}},afterrender:function(e){var d=e.up("form");if(d.country=="chile"&&d.configs.regime=="GENERAL_REGIME"){this.showModalIfRegimeIsNotEnable(e)}}},"company_FormInfoEdit button[action=saveCompanyInfo]":{click:this.saveCompanyInfo},"company_FormInfoEdit button[name=toggleViewPassword]":{click:function(){var d=Ext.fly(Ext.DomQuery.selectNode("svg[id=viewPassword]"));var e=Ext.ComponentQuery.query("textfield[name=keyPassword]")[0];if(d.hasCls("dark")){d.toggleCls("dark");d.toggleCls("green");document.getElementById(e.inputId).setAttribute("type","text")}else{d.toggleCls("green");d.toggleCls("dark");document.getElementById(e.inputId).setAttribute("type","password")}}},"buttons_SubmitReset button[action=saveCompanyInfo]":{click:function(){var d=Ext.get("modalSaveCompanyInfo");if(d){d.dom.click()}}},"company_WindowInfoEdit button[action=saveCompanyInfo]":{click:this.saveCompanyInfo},company_FormInfoEdit:{beforerender:function(F){F.executeActionsBeforeRender();var K=F.down("textfield[name=name]"),s=F.down("textfield[name=identification]"),t=F.down("fieldcontainer[itemId=mxAddressContainer]"),I=F.down("displayfield[itemId=mxAddressDisplayField]"),d=F.down("addressField[name=addressComponent]"),h=F.down("textfield[name=city]"),C=F.down("textfield[name=phone]"),k=F.down("textfield[name=website]"),Q=F.down("textfield[name=email]"),n=F.down("combo[name=regime]"),N=F.down("combo[name=currency]"),R=F.down("textfield[name=stampReceptionEmail]"),g=F.down("combo[name=decimalPrecision]"),q=F.down("combo[name=exportablesDecimalSeparator]"),E=F.down("combo[name=invoiceText]"),w=F.down("combo[name=countryCode]"),z=F.down("combo[name=timezone]"),f=F.down("fieldset[itemId=signatureFields]"),M=F.down("checkbox[name=isActiveElectronicInvoicing]");identificationTypeField=F.down("combo[name=identificationType]"),electronicInvoiceAdditionalParams=F.down("fieldset[itemId=electronicInvoiceAdditionalParams]"),mailInboxFieldsContainer=F.down("fieldset[itemId=mailInboxFields]"),mxStampVersionContainer=F.down("fieldset[itemId=mxStampVersionContainer]"),identificationText="Nit.";d.setCountry(F.country);if(F.country==="peru"){identificationText="RUC";s.tooltip="Puedes ingresar 1234 para realizar pruebas sin activar facturación electrónica."}else{if(translate("identification",true)){identificationText=translate("identification",true)}}var e=N.getStore();s.setFieldLabel(identificationText);g.bindStore(Ext.create("Ext.data.Store",{fields:["decimalPrecision"],data:this.getDecimalPrecisionDataForCountry(F.country)}));E.bindStore(Ext.create("Ext.data.Store",{fields:["label","value"],data:this.getInvoiceTextDataForCountry(F.country)}));n.bindStore(Ext.create("Ext.data.Store",{fields:["display","value","key"],data:this.getRegimeDataForCountry(F.country)}));switch(F.country){case"colombia":n.tooltip="Elige la responsabilidad asociada al IVA. Encuéntrala en el RUT en la sección Responsabilidades, Calidades y Atributos.";E.enable();E.show();F.down("addressField[name=addressComponent]").width=432;var J=F.down("textfield[name=zipCode]");J.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left: -230px; top: -64px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si desconoces tu código postal, haz <a target="_blank" href="http://visor.codigopostal.gov.co/472/visor/">'+translate("clickHere")+"</a>.</div></div></div></div>";mailInboxFieldsContainer.setTitle("Configura tu buzón de correo para recibir "+translate("stampDocuments"));var D=mailInboxFieldsContainer.down("component[name=helpStampReceptionMail]");D.html="<div>Puedes configurar una dirección de correo para recibir \n                            "+translate("stampDocuments")+' de tus proveedores y aceptarlos o rechazarlos. \n                                <strong><a target="_blank" href="https://ayudas.getsoft.app/es/articles/3753412">Saber más</a></strong></div>';var p=mailInboxFieldsContainer.down("displayfield[name=domainText]");var R=mailInboxFieldsContainer.down("textfield[name=stampReceptionEmail]");p.setValue("@recepcion.getsoft.app");R.setWidth(280);mailInboxFieldsContainer.setWidth(450);mailInboxFieldsContainer.setDisabled(false);mailInboxFieldsContainer.show();mailInboxFieldsContainer.margin="0 0 0 50";if(M===false){mailInboxFieldsContainer.getEl().setStyle({"margin-top":"0px"})}var H=new Date(F.configs.dateRegistry);var m=new Date("2020-01-29");if(H>=m){var v=F.down("[name=containerComponentsVersionElectronicInvoicing]");if(v){v.hide()}helpVersionElectronincInvoicingLabel=F.down("[name=helpVersionElectronincInvoicing]");if(helpVersionElectronincInvoicingLabel){helpVersionElectronincInvoicingLabel.hide()}var y=F.down("[name=labelTitleResponsabilities]");if(y){y.removeCls("border-top-box-feco")}}break;case"mexico":var u=F.down("filefield[name=certificate]");s.allowBlank=false;s.regex=/^[A-Z,Ñ,&]{3,4}[0-9]{2}[0-1][0-9][0-3][0-9][A-Z,0-9]?[A-Z,0-9]?[0-9,A-Z]?$/;s.tooltip=null;f.setDisabled(false);f.show();mailInboxFieldsContainer.setDisabled(false);mailInboxFieldsContainer.show();u.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-CSD" style="left: -180px;top:-15px;"><div class="tooltip-text-wrapper tooltip-small tooltip-CSD"><div class="text">Descarga tu certificado <a href="https://portalsat.plataforma.sat.gob.mx/RecuperacionDeCertificados/faces/consultaCertificados.xhtml" target="_blank">aquí</a></div></div></div></div>';var P=new Date();var j=new Date(P.getFullYear()+"-"+(P.getMonth()+1)+"-"+P.getDate());if(j<new Date("2018-01-01")||F.stampVersion!="3.3"){mxStampVersionContainer.setDisabled(false);mxStampVersionContainer.show();var r=Ext.ComponentQuery.query("combo[name=stampVersion]")[0];r.allowBlank=false}n.listConfig.width=380;break;case"republicaDominicana":n.matchFieldWidth=true;break;case"peru":s.regex=/^[0-9]*$/;s.maxLength=11;if(F.plan!="education"){M.show()}else{M.hide()}s.allowBlank=false;n.matchFieldWidth=true;break;case"other":w.setDisabled(false);w.show();case"usa":n.hide();z.setDisabled(false);z.show();break;case"panama":n.hide();E.enable();E.show();break;case"spain":n.matchFieldWidth=true;break;case"chile":f.setDisabled(false);f.setTitle("Configura los datos para facturación electrónica");var u=F.down("filefield[name=certificate]"),L=F.down("filefield[name=privateKey]"),A=F.down("textfield[name=keyPassword]");certificateCompanyInfofield=F.down("fieldset[name=certificateCompanyInfo]");certificateCompanyInfofield.style="border-bottom: none;min-height: 160px; background: #FFF;border: .2px solid #DCDCDC;width: 474px;";u.setFieldLabel(translate("certificate",true));A.setFieldLabel("Contraseña de llave");u.tooltip='<div class="text">Selecciona tu certificado electrónico (.pfx). Para conocer más, haz clic <a style="font-weight: bold;" href="https://ayudas.getsoft.app/es/articles/3647983#configura-el-certificado-de-facturacin-electrnica" target="_blank">aquí</a>.</div>';A.tooltip="Escribe la contraseña de tu "+translate("certificate")+".";if(F.hasCertificate!="yes"){f.setHeight(150)}else{var u=F.down("panel[name=hasNotCertificate]");u.hide()}L.setDisabled(true);L.hide();break;case"costaRica":f.setDisabled(false);f.setTitle("Configura los datos para facturación electrónica");var u=F.down("filefield[name=certificate]"),L=F.down("filefield[name=privateKey]"),A=F.down("textfield[name=keyPassword]");u.setFieldLabel(translate("certificate",true));A.setFieldLabel("Contraseña de llave");u.tooltip="Selecciona el archivo de producción (.p12) que solicitaste en la ATV.";A.tooltip="Escribe la contraseña de tu "+translate("certificate")+".";L.setDisabled(true);L.hide();var l=F.down("displayfield[itemId=otherCertificateDisplayField]");if(l){l.setValue("Actualiza tu "+translate("certificate"))}electronicInvoiceAdditionalParams.setDisabled(false);electronicInvoiceAdditionalParams.setTitle("Configura los datos de ingreso para "+translate("stampDocuments"));var o=electronicInvoiceAdditionalParams.down("textfield[name=governmentEntityUser]");o.emptyText="Ejemplo: cpj-1-234-567890@prod.comprobanteselectronicos.go.cr";n.matchFieldWidth=true;if(identificationTypeField){identificationTypeField.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');identificationTypeField.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'}}mailInboxFieldsContainer.margin="120 0 0 50";mailInboxFieldsContainer.setDisabled(false);mailInboxFieldsContainer.show();mailInboxFieldsContainer.setTitle("Configura tu buzón de correo para recibir "+translate("stampDocuments"));var D=mailInboxFieldsContainer.down("component[name=helpStampReceptionMail]");D.html="<div>Puedes configurar una dirección de correo para recibir \n                            "+translate("stampDocuments")+' de tus proveedores y aceptarlos o rechazarlos.</div>\n                            <div class="tooltip-wrapper" style="left: auto;top: 20px;right: 25px;">\n                                 <img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png">\n                                 <div class="tooltip-text-container">\n                                     <div class="tooltip-text-wrapper" style="position: relative;top: 12px;right: 280px;">\n                                         <div class="text">Si necesitas ayuda para configurar tu buzón de correo, haz <a target ="_blank" href="https://ayuda.getsoft.app/configura-el-buz%C3%B3n-de-recepci%C3%B3n-de-comprobantes-electr%C3%B3nicos-en-costa-rica">'+translate("clickHere")+"</a>.</div>\n                                     </div>\n                                 </div>\n                             </div>";var p=mailInboxFieldsContainer.down("displayfield[name=domainText]");var R=mailInboxFieldsContainer.down("textfield[name=stampReceptionEmail]");p.setValue("@recepcion.getsoft.app");R.setWidth(280);break;case"argentina":if(identificationTypeField){identificationTypeField.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');identificationTypeField.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'};var O=identificationTypeField.getStore();if(O.hasLoaded()){var G=O.findRecord("key","CUIT");if(G){identificationTypeField.select(G)}}else{O.on("load",function(){var S=O.findRecord("key","CUIT");if(S){identificationTypeField.select(S)}})}}var B=F.down("combo[name=conditionIibb]");if(B){var x=B.getStore();if(x.hasLoaded()){var G=x.findRecord("key","LOCAL");if(G){B.select(G)}}else{x.on("load",function(){var S=x.findRecord("key","LOCAL");if(S){B.select(S)}})}}break}Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(S,T){var X=Ext.decode(S.responseText);if(X.success){var ae=X.results;K.setValue(ae.name);s.setValue(ae.identification);C.setValue(ae.phone);k.setValue(ae.website);Q.setValue(ae.email);if(F.country=="mexico"||F.canEditCurrency=="no"){N.disable()}e.load();N.setValue(ae.currency);g.setValue(ae.decimalPrecision);q.setValue(ae.exportablesDecimalSeparator);if(ae.metadata){F.setFieldValuesFromMetadata(ae.metadata)}if(!M.checked){b.changeIsActiveElectronicInvoicingValue(M)}n.setValue(ae.regime);if(R&&ae.stampReceptionEmail){var af=ae.stampReceptionEmail;var al="";if(F.country=="mexico"){al="@cfdi.alegra"}else{if(F.country==="costaRica"||F.country=="colombia"){al="@recepcion.alegra"}}R.setValue(af.split(al)[0])}if(F.country=="mexico"&&r){if(ae.stampVersion){r.setValue(ae.stampVersion)}else{r.setValue("3.2")}}d.setValues(ae);switch(F.country){case"colombia":var ak=F.down("textfield[name=firstName]");var ad=F.down("textfield[name=secondName]");var Y=F.down("textfield[name=lastName]");var U=F.down("combo[name=kindOfPerson]");var W=function(){var am=U.getStore();if(!am.hasLoaded()&&!am.isLoading()){am.on("load",function(){U.select(ae.kindOfPerson);n.setValue(ae.regime)})}else{U.select(ae.kindOfPerson);n.setValue(ae.regime)}};var ab=identificationTypeField.getStore();var V=function(){var am=ab.findRecord("key","NUIP");if(am){ab.remove(am)}};if(ae.identificationType){var ag=function(){V();identificationTypeField.setValue(ae.identificationType);if(ae.kindOfPerson){W()}};if(!ab.hasLoaded()&&!ab.isLoading()){ab.on("load",function(){ag()})}else{ag()}}else{if(!ab.hasLoaded()&&!ab.isLoading()){ab.on("load",function(){V()})}else{V()}n.setValue(ae.regime)}ak.setValue(ae.firstName);ad.setValue(ae.secondName);Y.setValue(ae.lastName);if(ae.invoiceText){E.setValue(ae.invoiceText)}else{E.setValue("factura de venta")}var ah=F.down("textfield[name=co_dv]");ah.setValue(ae.co_dv);break;case"panama":if(ae.invoiceText){E.setValue(ae.invoiceText)}else{E.setValue("factura de venta")}break;case"mexico":if(ae.address&&ae.city){I.setFieldLabel(translate("address",true)+" 1")}break;case"costaRica":if(ae.cr_nite&&!ae.identification){s.setValue(ae.cr_nite)}var ab=identificationTypeField.getStore();if(ae.identificationType){if(ab.hasLoaded()){identificationTypeField.setValue(ae.identificationType)}else{ab.on("load",function(){identificationTypeField.setValue(ae.identificationType)})}}electronicInvoiceAdditionalParams.down("textfield[name=governmentEntityPassword]").setValue("");break;case"other":w.setValue(ae.countryCode);case"usa":z.setValue(ae.timezone);break;case"argentina":if(ae.identificationType){var ab=identificationTypeField.getStore();if(!ab.hasLoaded()&&!ab.isLoading()){ab.on("load",function(){identificationTypeField.setValue(ae.identificationType)})}else{identificationTypeField.setValue(ae.identificationType)}}break;case"republicaDominicana":if(ae.regime=="SIMPLE_ESTIMATION_REGIME"){var ac=n.getStore();var Z=[{display:"Régimen de estimación simple",value:"Régimen de estimación simple",key:"SIMPLE_ESTIMATION_REGIME"}];ac.loadData(Z,true);n.bindStore(ac);n.setValue(ae.regime)}break}if((["mexico","costaRica","chile"].indexOf(F.country)!==-1)&&F.hasCertificate=="yes"){F.down('fieldcontainer[itemId="hasCertificate"]').show();var aj=AL.date(ae.certificate.expirationDate);var aa=F.down("displayfield[itemId=certificateSerialDisplayField]"),ai=F.down("displayfield[itemId=certificateDueDateDisplayField]");aa.originalValue=ae.certificate.serial;aa.setValue(ae.certificate.serial);ai.originalValue=Ext.Date.format(aj,"d/m/Y");ai.setValue(Ext.Date.format(aj,"d/m/Y"))}}},failure:function(){}})},afterrender:function(e){switch(e.country){case"chile":var d=e.down("filefield[name=certificate]");d.tooltip.hideDelay=2000;break}}},"company_FormInfoEdit combo[name=currency]":{keypress:function(e,d){e.on("change",function(){var f=e.store;f.clearFilter();f.filter({property:"comboName",anyMatch:true,value:e.getValue()});if(e.getValue()==null){e.store.clearFilter()}})},select:function(d){d.store.clearFilter()}},company_WindowInfoEdit:{beforerender:function(g){g.validateCustomProperties();var B=g.down("textfield[name=name]"),o=g.down("textfield[name=identification]"),d=g.down("fieldcontainer[itemId=mxAddressContainer]"),v=g.down("displayfield[itemId=mxAddressDisplayField]"),A=g.down("addressField[name=addressComponent]"),w=g.down("textfield[name=city]"),m=g.down("textfield[name=phone]"),x=g.down("textfield[name=website]"),r=g.down("textfield[name=email]"),l=g.down("combo[name=regime]"),k=g.down("combo[name=currency]"),y=g.down("textfield[name=stampReceptionEmail]"),f=g.down("combo[name=decimalPrecision]"),p=g.down("combo[name=exportablesDecimalSeparator]"),t=g.down("combo[name=invoiceText]"),e=g.down("combo[name=countryCode]"),s=g.down("combo[name=timezone]"),u=g.down("fieldset[itemId=signatureFields]"),j=g.down("checkbox[name=isActiveElectronicInvoicing]");identificationTypeField=g.down("combo[name=identificationType]"),mxCertificateTitle=g.down("label[name=mxCertificateTitle]"),mxCertificateField=g.down("filefield[name=certificate]"),mxKeyField=g.down("filefield[name=privateKey]"),mxPassword=g.down("textfield[name=keyPassword]"),buttonCloseCert=g.down("button[name=closeCertificates]"),buttonEditCert=g.down("button[name=editCertificates]"),mailInboxFieldsContainer=g.down("fieldset[itemId=mailInboxFields]"),mxStampVersionContainer=g.down("fieldset[itemId=mxStampVersionContainer]"),identificationText="Nit.";A.setCountry(g.country);if(g.country==="peru"){identificationText="RUC";o.tooltip="Puedes ingresar 1234 para realizar pruebas sin activar facturación electrónica."}else{if(translate("identification",true)){identificationText=translate("identification",true)}}var h=k.getStore();o.setFieldLabel(identificationText);f.bindStore(Ext.create("Ext.data.Store",{fields:["decimalPrecision"],data:this.getDecimalPrecisionDataForCountry(g.country)}));t.bindStore(Ext.create("Ext.data.Store",{fields:["label","value"],data:this.getInvoiceTextDataForCountry(g.country)}));l.bindStore(Ext.create("Ext.data.Store",{fields:["display","value","key"],data:this.getRegimeDataForCountry(g.country)}));switch(g.country){case"colombia":t.enable();if(g.configs.isActiveElectronicInvoicing&&g.configs.electronicInvoicingVersion==="2.1"){g.down("displayfield[id=labelNameAddress]").setFieldLabel(translate("address",true)+'<span class="req">*</span>')}g.down("addressField[name=addressComponent]").width=432;var n=g.down("textfield[name=zipCode]");n.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left: -230px; top: -64px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si desconoces tu código postal, haz <a target="_blank" href="http://visor.codigopostal.gov.co/472/visor/">'+translate("clickHere")+"</a>.</div></div></div></div>";break;case"mexico":o.allowBlank=false;o.regex=/^[A-Z,Ñ,&]{3,4}[0-9]{2}[0-1][0-9][0-3][0-9][A-Z,0-9]?[A-Z,0-9]?[0-9,A-Z]?$/;o.tooltip=null;mxCertificateTitle.show();mxCertificateField.show();mxKeyField.show();mxPassword.show();var z=Ext.getCmp("mxPacText");z.show();var q=Ext.ComponentQuery.query("combo[name=stampVersion]")[0];q.allowBlank=false;l.listConfig.width=380;break;case"republicaDominicana":l.matchFieldWidth=true;break;case"peru":o.regex=/^[0-9]*$/;o.maxLength=11;j.hide();o.allowBlank=false;l.matchFieldWidth=true;break;case"other":e.setDisabled(false);case"usa":l.hide();s.setDisabled(false);break;case"panama":l.hide();t.enable();break;case"spain":case"chile":l.matchFieldWidth=true;break;case"costaRica":l.matchFieldWidth=true;if(identificationTypeField){identificationTypeField.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');identificationTypeField.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'}}break;case"argentina":if(identificationTypeField){identificationTypeField.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">{value}</tpl>');identificationTypeField.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{value}</div></tpl>'}}break}Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(C,D){var I=Ext.decode(C.responseText);if(I.success){var O=I.results;B.setValue(O.name);o.setValue(O.identification);m.setValue(O.phone);r.setValue(O.email);l.setValue(O.regime);if(g.country=="mexico"||g.canEditCurrency=="no"){k.disable()}h.load();k.setValue(O.currency);f.setValue(O.decimalPrecision);p.setValue(O.exportablesDecimalSeparator);if(O.metadata){g.setFieldValuesFromMetadata(O.metadata)}if(y&&O.stampReceptionEmail){var P=O.stampReceptionEmail;y.setValue(P.split("@cfdi.alegra")[0])}if(g.country=="mexico"&&q){if(O.stampVersion){q.setValue(O.stampVersion)}else{q.setValue("3.2")}}A.setValues(O);switch(g.country){case"colombia":var W=g.down("textfield[name=firstName]");var N=g.down("textfield[name=secondName]");var J=g.down("textfield[name=lastName]");var E=g.down("combo[name=kindOfPerson]");var H=function(){E.suspendEvents();var X=E.getStore();if(!X.hasLoaded()&&!X.isLoading()){X.on("load",function(){E.select(O.kindOfPerson);l.setValue(O.regime)})}else{E.select(O.kindOfPerson);l.setValue(O.regime)}E.resumeEvents()};var M=identificationTypeField.getStore();var F=function(){var X=M.findRecord("key","NUIP");if(X){M.remove(X)}};if(O.identificationType){var Q=function(){F();identificationTypeField.setValue(O.identificationType);if(O.kindOfPerson){H()}};identificationTypeField.suspendEvents();if(!M.hasLoaded()&&!M.isLoading()){M.on("load",function(){Q()})}else{Q()}identificationTypeField.resumeEvents()}else{if(!M.hasLoaded()&&!M.isLoading()){M.on("load",function(){F()})}else{F()}l.setValue(O.regime)}W.setValue(O.firstName);N.setValue(O.secondName);J.setValue(O.lastName);if(O.invoiceText){t.setValue(O.invoiceText)}else{t.setValue("factura de venta")}var R=g.down("textfield[name=co_dv]");R.setValue(O.co_dv);var G=g.down("textfield[name=tradeName]"),T=g.down("displayfield[id=clientNameLabelField]"),L=g.down("nameField[name=nameComponent]");if(j.getValue()==true&&E.isVisible()&&O.kindOfPerson==1){L.width=430;T.setFieldLabel('Razón social<span class="req">*</span>');G.show()}else{L.width=403;T.setFieldLabel(translate("name",true)+'<span class="req">*</span>');G.hide()}break;case"panama":if(O.invoiceText){t.setValue(O.invoiceText)}else{t.setValue("factura de venta")}break;case"mexico":if(O.address&&O.city){v.setFieldLabel(translate("address",true)+" 1")}break;case"peru":break;case"costaRica":if(O.cr_nite&&!O.identification){o.setValue(O.cr_nite)}var M=identificationTypeField.getStore();if(O.identificationType){if(M.hasLoaded()){identificationTypeField.setValue(O.identificationType)}else{M.on("load",function(){identificationTypeField.setValue(O.identificationType)})}}break;case"other":e.setValue(O.countryCode);case"usa":s.setValue(O.timezone);break;case"argentina":if(O.identificationType){var M=identificationTypeField.getStore();if(!M.hasLoaded()&&!M.isLoading()){M.on("load",function(){identificationTypeField.setValue(O.identificationType)})}else{identificationTypeField.setValue(O.identificationType)}}break}if((["mexico"].indexOf(g.country)!==-1)&&O.certificate&&O.certificate.serial){mxCertificateField.hide();mxKeyField.hide();mxPassword.hide();buttonEditCert.show();var V=AL.date(O.certificate.expirationDate);var K=g.down("displayfield[itemId=certificateSerialDisplayField]"),U=g.down("displayfield[itemId=certificateDueDateDisplayField]");K.originalValue=O.certificate.serial;K.setValue(O.certificate.serial);U.originalValue=Ext.Date.format(V,"d/m/Y");U.setValue(Ext.Date.format(V,"d/m/Y"));K.show();U.show();var S=document.getElementById("hasCertModal");S.style.display="inline"}}else{}},failure:function(){}})}},"company_WindowInfoEdit button[name=editCertificates]":{click:function(f){var j=f.up("form");var e=j.down("filefield[name=certificate]"),h=j.down("filefield[name=privateKey]"),d=j.down("textfield[name=keyPassword]"),g=j.down("displayfield[itemId=certificateSerialDisplayField]"),k=j.down("displayfield[itemId=certificateDueDateDisplayField]"),l=j.down("button[name=closeCertificates]");g.hide();k.hide();f.hide();e.show();h.show();d.show();l.show()}},"company_WindowInfoEdit button[name=closeCertificates]":{click:function(f){var k=f.up("form");var e=k.down("filefield[name=certificate]"),j=k.down("filefield[name=privateKey]"),d=k.down("textfield[name=keyPassword]"),g=k.down("displayfield[itemId=certificateSerialDisplayField]"),l=k.down("displayfield[itemId=certificateDueDateDisplayField]"),h=k.down("button[name=editCertificates]");e.hide();j.hide();d.hide();buttonCloseCert.hide();f.hide();g.show();l.show();h.show()}},"company_FormInfoEdit combo[name=kindOfPerson]":{change:function(k){var g=k.up("form");switch(g.configs.country){case"colombia":var h=g.down("nameField[name=nameComponent]");var d=k.getSelectedRecord().data;var f=g.down("combo[name=regime]");var j=f.getStore();h.changeVisibilitySpecificNameFields(d.id==2);this.showOrHideTradeName(g,k);var e=j.findExact("regime","SIMPLIFIED_REGIME");if(d.id==1&&e!=-1){if(j.hasLoaded()){f.setValue("COMMON_REGIME");j.remove(j.getAt(e))}else{j.on("load",{callback:function(){f.setValue("COMMON_REGIME");j.remove(j.getAt(e))}})}}else{if(e==-1){if(j.hasLoaded()){j.add({regime:"SIMPLIFIED_REGIME"})}else{j.on("load",{callback:function(){j.add({regime:"SIMPLIFIED_REGIME"})}})}}}break}}},"company_WindowInfoEdit combo[name=identificationType]":{select:function(l){var j=l.up("form");switch(j.country){case"colombia":var e=l.getSelectedRecord().data;var d=j.down("combo[name=kindOfPerson]");var g=j.down("combo[name=regime]");if(["NIT","FOREIGN_NIT"].indexOf(e.key)!==-1){var h=d.getStore();if(h.hasLoaded()){d.setValue("1")}else{h.on("load",{callback:function(){d.setValue("1")}})}var k=g.getStore();if(k.hasLoaded()){g.setValue("COMMON_REGIME")}else{k.on("load",{callback:function(){g.setValue("COMMON_REGIME")}})}}else{var h=d.getStore();var f=j.down("checkbox[name=isActiveElectronicInvoicing]");if(h.hasLoaded()){d.setValue("2")}else{h.on("load",{callback:function(){d.setValue("2")}})}var k=g.getStore();if(k.hasLoaded()){g.setValue("SIMPLIFIED_REGIME")}else{k.on("load",{callback:function(){g.setValue("SIMPLIFIED_REGIME")}})}f.disable();f.getSubmitData=function(){var m=this;var n=null;var o;if(m.submitValue&&!m.isFileUpload()){o=m.getSubmitValue();if(o!==null){n={};n[m.getName()]=o}}return n}}break}},change:function(f){var e=f.up("form");switch(e.country){case"colombia":var g=f.getSelectedRecord().data;var k=e.down("combo[name=kindOfPerson]");var m=e.down("textfield[name=identification]");var d=e.down("combo[name=regime]");var j=e.down("textfield[name=co_dv]");var l=null;var h=e.down("checkbox[name=isActiveElectronicInvoicing]");if(g.rules){switch(g.rules.type){case"int":l=/^[0-9]*$/;break}}m.regex=l;if(g.id==31){if(m.getValue()&&m.getValue()!==""){j.setValue(b.calculateDv(m.getValue()))}j.show();j.allowBlank=false;m.setWidth(300);k.show();d.show();h.enable()}else{j.allowBlank=true;j.setValue("");j.hide();m.setWidth(396);k.hide();d.hide();h.setValue(false);h.disable()}e.isValid();break}}},"company_WindowInfoEdit textfield[name=identification]":{blur:function(e){var d=e.up("form");if(d.configs){switch(d.configs.country){case"colombia":var g=d.down("combo[name=identificationType]");if(g.getValue()=="NIT"){var f=d.down("textfield[name=co_dv]");f.setValue(b.calculateDv(e.getValue()))}break}}}},"company_WindowInfoEdit combo[name=kindOfPerson]":{change:function(k){var g=k.up("form");switch(g.configs.country){case"colombia":var h=g.down("nameField[name=nameComponent]");var d=k.getSelectedRecord().data;var f=g.down("combo[name=regime]");var j=f.getStore();h.changeVisibilitySpecificNameFields(d.id==2);this.showOrHideTradeName(g,k);var e=j.findExact("regime","SIMPLIFIED_REGIME");if(d.id==1&&e!=-1){if(j.hasLoaded()){f.setValue("COMMON_REGIME");j.remove(j.getAt(e))}else{j.on("load",{callback:function(){f.setValue("COMMON_REGIME");j.remove(j.getAt(e))}})}}else{if(e==-1){if(j.hasLoaded()){j.add({regime:"SIMPLIFIED_REGIME"})}else{j.on("load",{callback:function(){j.add({regime:"SIMPLIFIED_REGIME"})}})}}}break}}},"company_FormInfoEdit combo[name=identificationType]":{select:function(l){var j=l.up("form");switch(j.country){case"colombia":var e=l.getSelectedRecord().data;var d=j.down("combo[name=kindOfPerson]");var g=j.down("combo[name=regime]");if(["NIT","FOREIGN_NIT"].indexOf(e.key)!==-1){var h=d.getStore();if(h.hasLoaded()){d.setValue("1")}else{h.on("load",{callback:function(){d.setValue("1")}})}var k=g.getStore();if(k.hasLoaded()){g.setValue("COMMON_REGIME")}else{k.on("load",{callback:function(){g.setValue("COMMON_REGIME")}})}}else{var h=d.getStore();var f=j.down("checkbox[name=isActiveElectronicInvoicing]");if(h.hasLoaded()){d.setValue("2")}else{h.on("load",{callback:function(){d.setValue("2")}})}var k=g.getStore();if(k.hasLoaded()){g.setValue("SIMPLIFIED_REGIME")}else{k.on("load",{callback:function(){g.setValue("SIMPLIFIED_REGIME")}})}f.disable();f.getSubmitData=function(){var m=this;var n=null;var o;if(m.submitValue&&!m.isFileUpload()){o=m.getSubmitValue();if(o!==null){n={};n[m.getName()]=o}}return n}}break}},change:function(h){var e=h.up("form");var p=e.down("textfield[name=identification]");var k=h.getSelectedRecord().data;if(k.rules){var f=k.rules.maxLength?k.rules.maxLength:p.maxLength;var g=k.rules.minLength?k.rules.minLength:p.minLength;var j=p.regex?p.regex:null;var o=k.rules.regex;if(o){j=o.regex;if(o.invalidRegexText){p.invalidText=o.invalidRegexText}}switch(k.rules.type){case"int":j="^[0-9]*$";break}if(j){j=new RegExp(j)}p.minLength=g;p.maxLength=f;p.regex=j}switch(e.country){case"colombia":var n=e.down("combo[name=kindOfPerson]");var d=e.down("combo[name=regime]");var m=e.down("textfield[name=co_dv]");var o=null;var l=e.down("checkbox[name=isActiveElectronicInvoicing]");if(k.id==31){if(p.getValue()&&p.getValue()!==""){m.setValue(b.calculateDv(p.getValue()))}m.show();m.allowBlank=false;p.setWidth(309);n.show();d.show();l.enable()}else{m.allowBlank=true;m.setValue("");m.hide();p.setWidth(402);d.hide();l.setValue(false);l.disable();n.hide()}break;case"argentina":var l=e.down("checkbox[name=isActiveElectronicInvoicing]");if(k.key==="CUIT"){l.enable()}else{l.disable()}break}if(p.getValue()){e.isValid()}}},"company_FormInfoEdit textfield[name=identification]":{blur:function(e){var d=e.up("form");if(d.configs){switch(d.configs.country){case"colombia":var g=d.down("combo[name=identificationType]");if(g.getValue()=="NIT"){var f=d.down("textfield[name=co_dv]");f.setValue(b.calculateDv(e.getValue()))}break}}}},"company_FormInfoEdit checkbox[name=isActiveElectronicInvoicing]":{change:this.changeIsActiveElectronicInvoicingValue},"company_FormInfoEdit combo[name=versionElectronicInvoicing]":{change:function(g){var f=g.up("form");var d=g.getValue();var e=f.down("checkbox[name=isActiveElectronicInvoicing]").checked;this.changeFieldsLikeRequiredWhenUbl21(f,e,d)}},"company_FormInfoEdit combo[name=economicActivity]":{change:function(e){var d=e.up("form");if(d.configs.country=="chile"){mainEconomicActivityField=d.down("combo[name=mainEconomicActivity]");mainEconomicActivityField.setValue(e.getValue())}}},"company_FormInfoEdit combo[name=mainEconomicActivity]":{change:function(e){var d=e.up("form");if(d.configs.country=="chile"){economicActivityField=d.down("combo[name=economicActivity]");economicActivityField.setValue(e.getValue())}}},"company_FormTemplateOther button[action=saveInvoiceInfo]":{click:this.saveOtherTemplates},"buttons_SubmitReset button[action=saveInvoiceInfo]":{click:this.saveInvoiceInfo},company_FormTemplateOther:{render:function(d){var f=d.down("combo[name=transactionPrintFormat]");var e=d.down("combo[name=purchaseOrderPrintFormat]");Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){f.setValue(j.results.transactionPrintFormat);e.setValue(j.results.purchaseOrderPrintFormat)}}})}},company_FormInvoiceInfoEdit:{render:function(e){var d=e.down("textarea[name=termsConditions]");var f=e.down("textarea[name=invoiceAnotation]");var g=e.down("checkboxfield[name=statementClientAttached]");Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(h,k){var l=Ext.decode(h.responseText);if(l.success){var j=l.results;d.setValue(j.termsConditions);f.setValue(j.invoiceAnotation);if(l.country==="usa"){remissionPrintFormat.hide()}else{if(l.country==="peru"){d.maxLength=70;d.maxLengthText=translate("generalDataTaCPeruMaxLengthMsg")}}if(j.metadata){e.setFieldValuesFromMetadata(j.metadata)}g.setValue(j.statementClientAttached);g.on("change",function(m,n){if(n){Ext.MessageBox.alert(translate("emailsTemplatesSettings",true),translate("emailsTemplatesSettingMessage",false,{statement:false}))}})}else{GlobalMsg.showErrorMessage(translate("error",true),l.cause)}},failure:function(){}})}},company_FormEditDocumentsNumber:{beforerender:function(g){if(["peru","republicaDominicana"].indexOf(g.configs.country)!==-1){var k=["creditNotePrefix","transactionInPrefix","transactionOutPrefix"];switch(g.configs.country){case"republicaDominicana":g.down("label[name=creditNotes]").update({html:"Numeración "+translate("creditNotes")+' (04) <span class="req">*</span>'});g.down("label[name=transactionOut]").update({html:'Numeración gastos menores (13) <span class="req">*</span>'});g.down("label[name=transactionIn]").update({html:'Numeración registro único de ingreso (12) <span class="req">*</span>'});g.insert(0,{xtype:"container",width:850,layout:"hbox",margin:"0 0 0 316",items:[{xtype:"label",html:'<div style="margin-top:42px;">'+translate("prefix",true)+"</div>",width:130,height:60,style:"text-align:center;color: #195D64;font-weight: bold;",margin:"0 15 0 0"},{xtype:"component",html:'<div class="tooltip-wrapper" style="left: -55px;top:41px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="position: relative;top: -71px;left: 5px;"><div class="tooltip-text-wrapper" style="width: 379px;"><div class="text" style="z-index:10000">Ingresa los primeros diez (10) dígitos de tu NCF (hasta el primer dígito del tipo de comprobante) Ejemplo: A020010210.</div></div></div></div>'},{xtype:"label",html:'<div style="margin-top:42px;">Secuencia</div>',width:135,height:60,style:"text-align:center;color: #195D64;font-weight: bold;"},{xtype:"component",html:'<div class="tooltip-wrapper" style="left:-33px;top:41px;"><img class="tooltip" style="z-index:1" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="position: relative;top: -51px;left: 5px;"><div class="tooltip-text-wrapper" style="width: 379px;"><div class="text">Comienza con el segundo dígito del tipo de comprobante (la onceava posición de tu NCF) Ejemplo: 100000008.</div></div></div></div>'},]});var d=g.down("container[name=remissions]");var e=g.items.items.indexOf(d);g.insert(e,{xtype:"container",width:850,layout:"hbox",items:[{xtype:"label",html:'Numeración proveedores informales (11) <span class="req">*</span>',width:300,style:"text-align:right;",margin:"0 15 0 0"},{xtype:"textfield",name:"billPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",errorMsg:"Numeración proveedores informales (11)"},{xtype:"textfield",fieldLabel:"",name:"nextBillNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el "+translate("number"),msgTarget:"side",emptyText:"Siguiente "+translate("number"),errorMsg:"Numeración proveedores informales (11)"}]});g.insert(e+1,{xtype:"container",width:850,layout:"hbox",items:[{xtype:"textfield",labelWidth:300,labelAlign:"right",labelPad:15,fieldLabel:"Numeración de "+translate("debitNote")+' (03) <span class="req">*</span>',name:"debitNotePrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",errorMsg:" Numeración de "+translate("debitNote")+" (03)"},{xtype:"textfield",fieldLabel:"",name:"nextDebitNoteNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el siguiente "+translate("number")+" de "+translate("debitNote"),msgTarget:"side",emptyText:"Siguiente "+translate("number"),errorMsg:" Numeración de "+translate("debitNote")+" (03)"}]});Ext.Ajax.request({url:"/resolution/retrieve-all-active-and-autoincrement/format/json",success:function(n,o){var q=Ext.decode(n.responseText);if(q.success){var m=q.resolutions;var p=1;Ext.each(m,function(t){var s=t.name.charAt(0).toLowerCase()+t.name.slice(1);var r="";switch(s){case"crédito fiscal":r=" (01)";break;case"consumidores finales":r=" (02)";break;case"régimen especial de tributación":r=" (14)";break;case"gubernamentales":r=" (15)";break}g.insert(p,{xtype:"container",name:"invoiceResolution",width:850,layout:"hbox",resolutionId:t.idLocal,items:[{xtype:"textfield",labelWidth:300,labelAlign:"right",labelPad:15,fieldLabel:"Numeración "+s+r+' <span class="req">*</span>',name:"invoiceResolutionPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0",value:t.prefix},{xtype:"textfield",fieldLabel:"",name:"invoiceResolutionNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el siguiente "+translate("number"),msgTarget:"side",emptyText:"Siguiente "+translate("number"),value:t.nextInvoiceNumber}]});p=p+1})}},failure:function(){}});break;case"peru":g.down("label[name=transactionOut]").update({html:'Numeración de comprobantes de pago <span class="req">*</span>'});g.down("label[name=transactionIn]").update({html:'Numeración de recibos de caja <span class="req">*</span>'});g.down("label[name=creditNotes]").update({html:"Numeración de "+translate("creditNotes")+' a facturas de venta<span class="req">*</span>',});var j=g.query("container");Ext.each(j,function(m){var n=m.items.items[0];n.width=350});g.insert(0,{xtype:"container",width:850,layout:"hbox",margin:"0 0 0 366",items:[{xtype:"label",html:translate("prefix",true),width:130,style:"text-align:center;color: #195D64;font-weight: bold;",margin:"0 15 0 0"},{xtype:"label",html:"Correlativo",width:130,style:"text-align:center;color: #195D64;font-weight: bold;"}]});g.insert(4,{xtype:"container",cls:"container-visible",width:850,layout:"hbox",items:[{xtype:"label",html:"Numeración de "+translate("creditNotes")+" a "+translate("saleTickets")+'<span class="req">*</span>',width:350,style:"text-align:right;",margin:"0 15 0 0",name:"creditNoteSaleTicket"},{xtype:"textfield",name:"creditNoteSaleTicketPrefix",msgTarget:"side",emptyText:translate("prefix",true),margin:"0 15 0 0"},{xtype:"textfield",fieldLabel:"",name:"nextCreditNoteSaleTicketNumber",regex:/^[0-9]+$/,regexText:"Tiene que ser un número",allowBlank:false,blankText:"Es necesario indicar el siguiente "+translate("number")+" de "+translate("creditNote"),msgTarget:"side",emptyText:"Siguiente "+translate("number"),afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Para '+translate("stamp")+" "+translate("creditNotes")+" electrónicas a "+translate("saleTickets")+", la "+translate("prefix")+' debe contener 4 caracteres y empezar por "B". <a href="http://ayuda.getsoft.app/hc/es/articles/115002451263" target="_blank">Ver más</a>.</div></div></div></div>'},]});var l=g.down("textfield[name=nextCreditNoteNumber]");l.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:5px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Para '+translate("stamp")+" "+translate("creditNotes")+" electrónicas a "+translate("specializedInvoices")+", la "+translate("prefix")+' debe contener 4 caracteres y empezar por "F". <a href="http://ayuda.getsoft.app/hc/es/articles/115002451263" target="_blank">Ver más</a>.</div></div></div></div>';break}Ext.each(k,function(m){g.down("textfield[name="+m+"]").show()})}else{if(g.configs.country=="colombia"){var h=g.down("container[name=eventDocumentsReceived]");if(g.configs.providerElectronicInvoicing=="alegra"){h.show()}else{h.hide()}}}if(["costaRica"].indexOf(g.configs.country)!==-1){var f=["acceptDocumentsReceived","partiallAcceptDocumentsReceived","rejectDocumentsReceived"];Ext.each(g.items.items,function(m){if(f.indexOf(m.name)==-1){m.hide()}})}},render:function(f){var o=f.down("textfield[name=nextTransactionInNumber]");var m=f.down("textfield[name=transactionInPrefix]");var d=f.down("textfield[name=nextTransactionOutNumber]");var l=f.down("textfield[name=transactionOutPrefix]");var v=f.down("textfield[name=estimatePrefix]");var r=f.down("textfield[name=nextEstimateNumber]");var g=f.down("textfield[name=nextCreditNoteNumber]");var u=f.down("textfield[name=creditNotePrefix]");var p=f.down("textfield[name=nextCreditNoteSaleTicketNumber]");var s=f.down("textfield[name=creditNoteSaleTicketPrefix]");var w=f.down("textfield[name=nextDebitNoteNumber]");var e=f.down("textfield[name=debitNotePrefix]");var t=f.down("textfield[name=nextRemissionNumber]");var n=f.down("textfield[name=remissionPrefix]");var q=f.down("textfield[name=nextBillNumber]");var j=f.down("textfield[name=billPrefix]");var h=f.down("textfield[name=nextPurchaseOrderNumber]");var k=f.down("textfield[name=purchaseOrderPrefix]");Ext.Ajax.request({url:"/company/retrieve-numeration-info/format/json",success:function(x,z){var A=Ext.decode(x.responseText);if(A.success){var y=A.results;o.setValue(y.nextTransactionInNumber);m.setValue(y.transactionInPrefix);d.setValue(y.nextTransactionOutNumber);l.setValue(y.transactionOutPrefix);v.setValue(y.estimatePrefix);r.setValue(y.nextEstimateNumber);g.setValue(y.nextCreditNoteNumber);u.setValue(y.creditNotePrefix);t.setValue(y.nextRemissionNumber);n.setValue(y.remissionPrefix);h.setValue(y.nextPurchaseOrderNumber);k.setValue(y.purchaseOrderPrefix);if(p){s.setValue(y.creditNoteSaleTicketPrefix);p.setValue(y.nextCreditNoteSaleTicketNumber)}if(q){q.setValue(y.nextBillNumber);j.setValue(y.billPrefix)}if(w){w.setValue(y.nextDebitNoteNumber);e.setValue(y.debitNotePrefix)}if(y.metadata){f.setFieldValuesFromMetadata(y.metadata)}}else{GlobalMsg.showErrorMessage(translate("error",true),A.cause)}},failure:function(){}});if(f.configs&&f.configs.country==="peru"){u.regex=/^([A-Za-z0-9]+)$/}}},"company_FormEditDocumentsNumber button[action=savePrefixAndNumbersInfo]":{click:function(f){f.disable();var h=f.up("form"),g=h.getForm(),s=this.validateNumberAndPrefixMaxValue(g.getValues()),j="",e=true,m=h.down("textfield[name=nextTransactionInNumber]"),d=h.down("textfield[name=nextTransactionOutNumber]"),q=h.down("textfield[name=nextEstimateNumber]"),k=h.down("textfield[name=nextCreditNoteNumber]"),o=h.down("textfield[name=nextCreditNoteSaleTicketNumber]"),x=h.down("textfield[name=nextDebitNoteNumber]"),v=h.down("textfield[name=nextRemissionNumber]"),p=h.down("textfield[name=nextBillNumber]"),l=h.down("textfield[name=nextPurchaseOrderNumber]"),r=true,n=[],u=[],t,w=function(){if(g.isValid()&&e){var D=Ext.ComponentQuery.query("container[name=invoiceResolution]");var C=g.getValues();if(D){var z=[];Ext.each(D,function(G){var E=G.down("textfield[name=invoiceResolutionPrefix]");var F=G.down("textfield[name=invoiceResolutionNumber]");z.push({idResolution:G.resolutionId,prefix:E.getValue(),number:F.getValue()})});C.invoiceResolutions=Ext.encode(z)}var B=h.getFieldValuesAsMetadata();if(B){C.metadata=Ext.encode(B)}var y=new Ext.LoadMask(f.up("form"),{msg:translate("saving",true)});y.show();Ext.Ajax.request({url:"/company/edit-prefix-info/format/json",method:"POST",params:C,success:function(E,F){var G=Ext.decode(E.responseText);if(G.success){if(Ext.Array.contains(["costaRica"],h.configs.country)){window.location="/stamp-document-received/management"}else{window.location="/configuration"}}else{GlobalMsg.showErrorMessage(translate("error",true),G.cause);y.hide()}},failure:function(G,F){var E=F.response;var H=Ext.decode(E.responseText);f.enable();y.hide();GlobalMsg.showErrorMessage(translate("error",true),H.cause)}})}else{for(var A=0;A<t.fields.length;A++){t.fields[A].markInvalid("El valor ingresado debe ser menor a 4,294,967,295")}f.enable()}};u.push(m);u.push(d);u.push(q);u.push(k);u.push(v);u.push(l);if(x){u.push(x)}if(p){u.push(p)}if(o){u.push(o)}t=this.validateNumberFieldMaxValue(u);if((t.valid==false||s.valid==false)&&h.configs.country=="republicaDominicana"){e=t;Ext.each(s.fields,function(y){j=y+", "+j});Ext.Msg.show({title:"Advertencia",msg:"La "+j+" no contiene la cantidad de dígitos requeridos, esto podría afectar tus reportes ante la DGII. ¿Deseas continuar?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(y){if(y==="ok"){e=true;w()}}});f.enable();return}else{w()}}},"company_FormInvoiceTemplateEdit button[action=saveInvoiceTemplate]":{click:this.saveInvoiceTemplate},"company_FormTemplatePdfEdit button[action=saveTemplatePdf]":{click:this.saveTemplatePdf},company_FormTemplatePdfEdit:{beforerender:function(d){var g=d.down("fieldset[itemId=testParameters]"),m=d.down("dataview[name=idTemplatePdf]"),f=d.down("combo[name=keyCountry]"),e=d.down("button[itemId=showPreviewButton]"),k=d.down("button[action=saveTemplatePdf]"),h=d.resource,n=m.getStore(),j={resource:h};d.elementView=true;if(!d.canUseKeyCountryField()){e.hide(true);var l=["usa","mexico","peru"];if(l.indexOf(d.country)>=0){n.loadData(n.basic)}Ext.Ajax.request({url:"/company/retrieve-print-format/format/json",params:j,success:function(o){var p=Ext.decode(o.responseText);if(p.success){d.elementView=false;if(n.hasLoaded()){m.collapseAll();m.select(n.findRecord("template",p.format))}else{n.on("load",function(){m.collapseAll();m.select(n.findRecord("template",p.format))})}}},failure:function(){}})}else{k.setDisabled(true);k.hide();g.setDisabled(false);g.show();n.reload()}}},company_FormInvoiceTemplateEdit:{beforerender:function(d){var n=d.down("dataview[name=idInvoiceTemplate]"),f=d.down("checkbox[name=showRetentionInvoice]"),l=d.down("checkbox[name=showInvoiceTotalInWords]"),m=d.down("checkbox[name=showNewLineCharOnPdf]"),e=d.down("button[itemId=showPreviewButton]"),k=d.down("button[action=saveInvoiceTemplate]"),g=d.down("combo[name=keyCountry]"),h=d.down("fieldset[itemId=testParameters]");var o=n.getStore();var p=true,j=function(){};if(d.canUseKeyCountryField()){p=false;k.hide();h.setDisabled(false);h.show();o.getProxy().setExtraParam("isTest","yes");j=function(r,q,t){var s=Ext.decode(q.response.responseText);d.availableTemplatesByCountry=s.availableTemplatesByCountry;g.originalValue="colombia";g.setValue(g.originalValue);e.fireEvent("click",e)}}o.load(j);if(d.country=="usa"){f.hide();l.hide()}else{if(d.country=="mexico"){d.down("combo[name=font]").hide();d.down("combo[name=fontSize]").hide();f.hide();d.down("box[itemId=anotationText]").hide();d.down("box[itemId=anotationTextMexico]").show()}}Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(q,s){var t=Ext.decode(q.responseText);if(t.success){var r=t.results;if(r.showRetentionInvoice==="yes"){f.setValue(true)}else{f.setValue(false)}if(r.showInvoiceTotalInWords==="yes"){l.setValue(true)}else{l.setValue(false)}if(r.showNewLineCharOnPdf=="yes"){m.setValue(true)}else{m.setValue(false)}if(p){if(o.hasLoaded()){n.collapseAll();n.select(o.findRecord("idLocal",r.idInvoiceTemplate))}else{o.on("load",function(){n.collapseAll();n.select(o.findRecord("idLocal",r.idInvoiceTemplate))})}}}else{GlobalMsg.showErrorMessage(translate("error",true),t.cause)}},failure:function(){}})}},"company_FormTemplatePdfEdit combo[name=keyCountry]":{change:function(k,j,e){var g=k.up("form"),h=g.down("company_InvoiceTemplatePicker"),f=h.getStore(),d=k.getValue();if(g.canUseKeyCountryField()){var l=["usa","mexico","peru"];if(l.indexOf(d)>=0){f.loadData(f.basic)}else{f.reload()}h.select(f.findRecord("template","general"))}}},"company_FormInvoiceTemplateEdit combo[name=keyCountry]":{change:function(h){var g=h.up("form"),d=g.down("company_InvoiceTemplatePicker"),e=h.getValue();if(g.canUseKeyCountryField()){for(var j in g.availableTemplatesByCountry){var f=true;if(e==j){f=false}d.changeRecordsVisibility(g.availableTemplatesByCountry[j],f)}var k=g.availableTemplatesByCountry[e].length?g.availableTemplatesByCountry[e][0]:null;if(k){d.select(d.getStore().findRecord(d.recordValue,k))}}}},"company_FormTemplatePdfEdit dataview[name=idTemplatePdf]":{refresh:function(e){var g=e.getStore(),f=g.findRecord("template","half"),h=e.up("form");if(h.elementView){if(f){var d=e.getSelectionModel();selectedRecord=d.getLastSelected();e.select(f);if(selectedRecord&&f.get("template")==selectedRecord.get("template")){e.fireEvent("select",e.getSelectionModel(),f)}}}},select:function(d,f){var g=d.view.up("form"),e=g.down("button[itemId=showPreviewButton]");g.dataPreview=f.getData();e.fireEvent("click",e)}},"company_FormInvoiceTemplateEdit dataview[name=idInvoiceTemplate]":{select:function(e,g){var l=e.view.up("form"),f=l.down("button[itemId=showPreviewButton]"),h=[l.down("combo[name=font]"),l.down("combo[name=fontSize]"),l.down("numberfield[name=itemsSpacing]"),l.down("checkboxfield[name=showItemsCount]")];for(var j=0;j<h.length;j++){h[j].setValue(g.get(h[j].name))}templateNameValue=g.get("name");if(l.canUseKeyCountryField()){var d=l.down("combo[name=keyCountry]"),k=d.findRecordByValue(d.getValue());templateNameValue+=" ("+translate(g.get("pageSize"))+") - "+k.get(d.displayField)}l.down("displayfield[name=templateName]").setValue(templateNameValue);f.fireEvent("click",f)}},"company_FormInvoiceTemplateEdit filefield[name=signature]":{change:function(f,e,d){this.removeFakePathWord(f,e)}},"company_FormInvoiceTemplateEdit button[itemId=showPreviewButton]":{click:function(d){var y=d.up("form"),f=y.getValues(),p=y.down("box[itemId=previewBox]");var j="/invoice/preview-invoice-template/idInvoiceTemplate/"+y.getForm().idInvoiceTemplate;if(!f.showItemsCount){f.showItemsCount="no"}if(!f.showRetentionInvoice){f.showRetentionInvoice="no"}if(!f.showInvoiceTotalInWords){f.showInvoiceTotalInWords="no"}if(!f.showNewLineCharOnPdf){f.showNewLineCharOnPdf="no"}for(var m in f){if(m=="keyCountry"&&!(y.isTest=="yes"&&y.canTestOtherCountries=="yes")){continue}j+="/"+m+"/"+f[m]}if(y.canUseKeyCountryField()){j+="/isTest/yes";var u=y.down("company_InvoiceTemplatePicker"),g=u.getStore().findRecord("idLocal",y.getForm().idInvoiceTemplate);g.set({font:f.font,fontSize:f.fontSize,itemsSpacing:f.itemsSpacing,showItemsCount:f.showItemsCount})}var t=new Ext.LoadMask(p,{msg:translate("loading",true)}),r=function(){t.hide();p.getEl().un("load",r)};var s=y.down("filefield[name=signature]");var w=s.getValue();if(w!=""){var k=["png","jpg","jpeg"];var q=w.split(".");var l=q[q.length-1].toLowerCase();if(!Ext.Array.contains(k,l)){GlobalMsg.showErrorMessage(translate("error",true),"Tu firma debe ser de tipo .png, .jpg o .jpeg y de tamaño inferior a 2 MB");return}}var e=y.down("filefield[name=signatureToPreview]");var o=e.fileInputEl.dom.id;var x=e.fileInputEl.dom.name;e.fileInputEl.dom=s.fileInputEl.dom.cloneNode();e.fileInputEl.dom.id=o;e.fileInputEl.dom.name=x;var h=new Date().getTime();var v="fileupload-form-"+h;var n=Ext.DomHelper.append(Ext.getBody(),'<form id="'+v+'" method="POST" enctype="multipart/form-data" style="display : none;"></form>');n.appendChild(e.extractFileInput());n.action=j;p.getEl().on("load",function(){window.formEl=n;p.getEl().on("load",r);p.getEl().dom.contentWindow.postMessage("",document.location.origin)});t.show();p.getEl().dom.src="/invoice/preview-signature-form"}},"company_FormTemplatePdfEdit button[itemId=showPreviewButton]":{click:function(k){var h=k.up("form"),p=h.dataPreview,s=h.down("box[itemId=previewBox]");var d="/company/preview-template-pdf/resource/"+h.resource;for(var m in p){d+="/"+m+"/"+p[m]}if(h.canUseKeyCountryField()){var e=h.down("combo[name=keyCountry]"),f=h.down("checkboxfield[name=showPlanText]"),g=h.down("checkboxfield[name=multicurrency]");var o="no";var r="no";if(f.getValue()){o="yes"}if(g.getValue()){r="yes"}if(!e.getValue()){d+="/isTest/yes/showPlanText/"+o+"/multicurrency/"+r}else{d+="/isTest/yes/showPlanText/"+o+"/multicurrency/"+r+"/keyCountry/"+e.getValue()}var n=h.down("company_InvoiceTemplatePicker"),j=n.getStore().findRecord("idLocal",h.getForm().idInvoiceTemplate)}else{d+="/keyCountry/"+h.country}var q=new Ext.LoadMask(s,{msg:translate("loading",true)}),l=function(){q.hide();s.getEl().un("load",l)};q.show();s.getEl().on("load",l);s.getEl().dom.src=d}},company_EditTemplatesPanel:{afterrender:function(g,f){var d=this;var e=Ext.getStore("PdfTemplates");e.load({callback:function(j,h,m){var l=[],o="Clásico ("+translate("template.letter")+")";e.each(function(s){var p=s.get("documentType");var t=s.get("name");var w=s.get("companysDefault");var r=s.get("pageSize");var q=t;var v=l.length;var u;for(u=0;u<v;u++){if(t==l[u].name&&r==l[u].pageSize){return true}}switch(r){case"letter":q+=" ("+translate("template.letter")+")";break;case"half-letter":q+=" ("+translate("template.half-letter")+")";break;case"ticket":q+=" ("+translate("template.ticket")+")";break}if(p=="invoice"&&w){o=q}l.push({displayName:q,name:t,pageSize:r})});var k=Ext.ComponentQuery.query("[xtype=documentpicker]")[0];var n=Ext.ComponentQuery.query("[name=globalTemplate]")[0];n.store=Ext.create("Ext.data.Store",{fields:["displayName","name","pageSize"],data:l});n.suspendEvents();n.setValue(o);n.resumeEvents();d.updateDocumentPickerWithDefaultPdfTemplates(k);n.enable();g.items.items[1].setDisabled(false);g.items.items[3].items.items[0].enable()}});Ext.create("AL.view.common.FormSignature",{renderTo:"templateSignature",configs:{showFooter:false,userSignatureUrl:g.userSignatureUrl}})}},"company_EditTemplatesPanel combo[name=globalTemplate]":{select:function(g,e,f){var d=this;Ext.Msg.show({title:translate("attention",true),msg:translate("massiveEditTemplateDocument",true)+" "+translate("areYouSureYouWantToPerformThisAction",true),buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.QUESTION,fn:function(k){if(k=="yes"){var j={};var l={};var r={};var p=e[0].get("displayName");var h=e[0].get("name");var n=e[0].get("pageSize");var q=Ext.getStore("PdfTemplates");q.each(function(t){var s=t.get("documentType");j[s]=s;if(t.get("companysDefault")){l[s]=t}if(t.get("name")==h&&t.get("pageSize")==n){t.set("companysDefault",true);r[s]=s}else{t.set("companysDefault",false)}});for(var o in j){if(!r[o]){l[o].set("companysDefault",true)}}var m=Ext.ComponentQuery.query("[xtype=documentpicker]")[0];d.updateDocumentPickerWithDefaultPdfTemplates(m)}else{this.close()}}})}},"company_EditTemplatesPanel documentpicker":{itemclick:function(j,d,h,f,k,g){Ext.create("AL.view.company.TemplateWindow",{editTemplatesPanel:j.up(),document:d}).show()}},"company_EditTemplatesPanel filefield[name=signature]":{change:function(f,e,d){this.removeFakePathWord(f,e)}},"company_EditTemplatesPanel button[name=saveButton]":{click:function(j,k,g){var h=Ext.ComponentQuery.query("[name=globalParametersForm]")[0].getForm();if(h.isValid()){j.disable();var d=Ext.getStore("PdfTemplates");var f=[];d.each(function(e){if(e.get("companysDefault")){f.push({idLocal:e.get("idLocal")+"",documentType:e.get("documentType"),name:e.get("name"),template:e.get("template"),companysDefault:e.get("companysDefault"),pageSize:e.get("pageSize"),itemsSpacing:e.get("itemsSpacing")+"",font:e.get("font"),fontSize:e.get("fontSize"),showItemsCount:e.get("showItemsCount"),showDiscount:e.get("showDiscount"),showTaxValue:e.get("showTaxValue"),showTaxPercentage:e.get("showTaxPercentage")})}});h.submit({url:"/pdf-template/save-all/format/json",waitMsg:translate("savingAction",true),params:Ext.merge(h.getValues(),{templates:Ext.encode(f)}),success:function(m,l){var e=l.response;var n=Ext.decode(e.responseText);j.enable();if(n.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage(translate("error",true),n.cause)}},failure:function(m,l){var e=l.response;var n=Ext.decode(e.responseText);j.enable();GlobalMsg.showErrorMessage(translate("error",true),n.cause)}})}}},company_TemplateWindow:{afterrender:function(u,d){if(u.document){var h=Ext.getStore("PdfTemplates");var e=h.queryBy(function(x,y){return x.get("documentType")==u.document.get("documentType")}).items;var w=e.length;var v=[];var o,t,s,f;for(o=0;o<w;o++){t=e[o];switch(t.get("pageSize")){case"letter":s=" ("+translate("template.half-letter")+")";break;case"half-letter":s=" ("+translate("template.half-letter")+")";break;case"ticket":s=" ("+translate("template.ticket")+")";break;default:s="";break}v.push({name:t.get("name")+s,template:t.get("template")});if(t.get("companysDefault")){f=t}}var p=Ext.ComponentQuery.query("[name=windowPanel]")[0];var q=Ext.ComponentQuery.query("[name=template]")[0];var m=Ext.ComponentQuery.query("[name=font]")[0];var j=Ext.ComponentQuery.query("[name=fontSize]")[0];var g=Ext.ComponentQuery.query("[name=itemsSpacing]")[0];var n=Ext.ComponentQuery.query("[name=showItemsCount]")[0];var r=Ext.ComponentQuery.query("[name=columnsConfigurationFieldSet]")[0];var l=Ext.ComponentQuery.query("[name=transactionType]")[0];var k=Ext.ComponentQuery.query("[name=previewButton]")[0];q.store=Ext.create("Ext.data.Store",{fields:["name","template"],data:v});q.setValue(f.get("template"));if(u.document.get("documentType")=="invoice"){p.update('<div class="tooltip-wrapper" style="left: 675px; top: 0px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("ifYouNeedHelpCustomizingYourDocumentTemplate",true,{document:"{{invoices}}"})+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/206445995 ">'+translate("clickHere")+"</a>.</div></div></div></div>")}else{if(u.document.get("documentType")=="estimate"){p.update('<div class="tooltip-wrapper" style="left: 675px; top: 0px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("ifYouNeedHelpCustomizingYourDocumentTemplate",true,{document:"{{estimates}}"})+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115004651646">'+translate("clickHere")+"</a>.</div></div></div></div>")}else{if(u.document.get("documentType")=="remission"){p.update('<div class="tooltip-wrapper" style="left: 675px; top: 0px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><div class="text">'+translate("ifYouNeedHelpCustomizingYourDocumentTemplate",true,{document:"{{remissions}}"})+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115002542183">'+translate("clickHere")+"</a>.</div></div></div></div>")}else{if(u.document.get("documentType")=="transaction"){p.update('<div class="tooltip-wrapper" style="left: 675px; top: 0px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><div class="text">'+translate("ifYouNeedHelpCustomizingYourDocumentTemplate",true,{document:"{{transactions}}"})+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115004651043">'+translate("clickHere")+"</a>.</div></div></div></div>")}else{if(u.document.get("documentType")=="purchaseOrder"){p.update('<div class="tooltip-wrapper" style="left: 675px; top: 0px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><div class="text">'+translate("ifYouNeedHelpCustomizingYourDocumentTemplate",true,{document:"{{purchaseOrders}}"})+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115004668806">'+translate("clickHere")+"</a>.</div></div></div></div>")}}}}}if(u.document.get("documentType")=="transaction"||u.document.get("documentType")=="purchaseOrder"){m.setVisible(false);j.setVisible(false);g.setVisible(false);n.setVisible(false);r.setVisible(false)}if(u.document.get("documentType")=="transaction"){l.setValue("in");l.show()}k.fireEvent("click",k)}},},"company_TemplateWindow combo[name=template]":{change:function(x,n,q,d){var u=x.up().up().up().up();var t=Ext.ComponentQuery.query("[name=template]")[0];var m=Ext.ComponentQuery.query("[name=font]")[0];var k=Ext.ComponentQuery.query("[name=fontSize]")[0];var f=Ext.ComponentQuery.query("[name=itemsSpacing]")[0];var p=Ext.ComponentQuery.query("[name=showItemsCount]")[0];var w=Ext.ComponentQuery.query("[name=showDiscount]")[0];var l=Ext.ComponentQuery.query("[name=showTaxValue]")[0];var g=Ext.ComponentQuery.query("[name=showTaxPercentage]")[0];var o=Ext.ComponentQuery.query("[name=stampedInvoiceDefaultTemplateHelp]")[0];var j=Ext.getStore("PdfTemplates");var v=j.queryBy(function(y,z){return y.get("documentType")==u.document.get("documentType")&&y.get("template")==n}).items[0];var e=u.down("form[name=templateConfigurationForm]");var h=e.down("box[name=helpPeruGeneralHalf]");var r=v.get("documentType");var s=v.get("template");if(r==="invoice"){if(u.editTemplatesPanel&&u.editTemplatesPanel["keyCountry"]&&["peru","colombia"].indexOf(u.editTemplatesPanel["keyCountry"])!==-1){o.show()}else{o.hide()}if(s==="peru_general"){h.show()}else{h.hide()}}m.setValue(v.get("font"));k.setValue(v.get("fontSize"));f.setValue(v.get("itemsSpacing"));p.setValue(v.get("showItemsCount"));w.setValue(v.get("showDiscount"));l.setValue(v.get("showTaxValue"));g.setValue(v.get("showTaxPercentage"));if(r=="invoice"){if(s.indexOf("ticket")!==-1||Ext.Array.contains(["other_general_half_blank","peru_general_blank","peru_general_half","peru_general_half_blank"],s)){w.setValue(false);w.setDisabled(true)}else{w.setDisabled(false)}if(Ext.Array.contains(["other_general_half_blank","peru_general_blank","peru_general_half_blank","other_general_half_blank_with_discount","peru_general_half","peru_general_half_blank_with_discount"],s)){l.setValue(false);l.setDisabled(true);g.setValue(false);g.setDisabled(true)}else{l.setDisabled(false);g.setDisabled(false)}}}},"company_TemplateWindow combo[name=transactionType]":{change:function(g,h,e,f){var d=Ext.ComponentQuery.query("[name=previewButton]")[0];d.fireEvent("click",d)}},"company_TemplateWindow [name=showTaxPercentage]":{change:function(h,j,e,f){var k=h.up("company_TemplateWindow");var d=k.down("[name=template]");if(j&&d.getValue().indexOf("ticket")!=-1){var g=k.down("[name=showTaxValue]");g.setValue(false)}}},"company_TemplateWindow [name=showTaxValue]":{change:function(h,j,e,f){var k=h.up("company_TemplateWindow");var d=k.down("[name=template]");if(j&&d.getValue().indexOf("ticket")!=-1){var g=k.down("[name=showTaxPercentage]");g.setValue(false)}}},"company_TemplateWindow button[name=cancelButton]":{click:function(f,g,d){f.up().up().up().close()}},"company_TemplateWindow button[name=previewButton]":{click:function(x,t,f){var u=x.up().up().up();if(!u.document||!u.editTemplatesPanel){return}var m=u.editTemplatesPanel.down("[name=globalParametersForm]").getForm();var d=Ext.ComponentQuery.query("[name=templateConfigurationForm]")[0];if(m.isValid()&&d.isValid()){x.disable();var p=Ext.ComponentQuery.query("[itemId=previewBox]")[0];var h=Ext.merge(m.getValues(),d.getValues());var j=Ext.getStore("PdfTemplates");var w=j.queryBy(function(e,z){return e.get("documentType")==u.document.get("documentType")&&e.get("template")==h.template}).items[0];var l="/pdf-template/preview/keyCountry/"+h.keyCountry+"/idLocal/"+w.get("idLocal")+"/documentType/"+u.document.get("documentType")+"/template/"+h.template+"/font/"+h.font+"/fontSize/"+h.fontSize+"/itemsSpacing/"+h.itemsSpacing+"/transactionType/"+(h.transactionType?h.transactionType:"no-transaction");if(h.showInvoiceTotalInWords){l+="/showInvoiceTotalInWords/yes"}if(h.showRetentionInvoice){l+="/showRetentionInvoice/yes"}if(h.showNewLineCharOnPdf){l+="/showNewLineCharOnPdf/yes"}if(h.multicurrency){l+="/multicurrency/yes"}if(h.showPlanText){l+="/showPlanText/yes"}if(u.editTemplatesPanel.isTest=="yes"){l+="/isTest/yes"}if(h.showItemsCount){l+="/showItemsCount/yes"}if(h.showDiscount){l+="/showDiscount/yes"}if(h.showTaxValue){l+="/showTaxValue/yes"}if(h.showTaxPercentage){l+="/showTaxPercentage/yes"}var s=new Ext.LoadMask(p,{msg:translate("loading",true)});var q=function(){s.hide();x.enable();p.getEl().un("load",q)};var r=u.editTemplatesPanel.down("filefield[name=signature]");var g=u.editTemplatesPanel.down("filefield[name=signatureToPreview]");var o=g.fileInputEl.dom.id;var y=g.fileInputEl.dom.name;g.fileInputEl.dom=r.fileInputEl.dom.cloneNode();g.fileInputEl.dom.id=o;g.fileInputEl.dom.name=y;var k=new Date().getTime();var v="fileupload-form-"+k;var n=Ext.DomHelper.append(Ext.getBody(),'<form id="'+v+'" method="POST" enctype="multipart/form-data" style="display : none;"></form>');n.appendChild(g.extractFileInput());n.action=l;p.getEl().on("load",function(){window.formEl=n;p.getEl().on("load",q);p.getEl().dom.contentWindow.postMessage("",document.location.origin)});s.show();p.getEl().dom.src="/invoice/preview-signature-form"}}},"company_TemplateWindow button[name=applyButton]":{click:function(z,w,d){var r=this;var f=Ext.ComponentQuery.query("[name=templateConfigurationForm]")[0].getForm();if(!f.isValid()){return}z.disable();var x=z.up().up().up();var v=Ext.ComponentQuery.query("[xtype=documentpicker]")[0];var u=Ext.ComponentQuery.query("[name=template]")[0];var p=Ext.ComponentQuery.query("[name=font]")[0];var n=Ext.ComponentQuery.query("[name=fontSize]")[0];var h=Ext.ComponentQuery.query("[name=itemsSpacing]")[0];var q=Ext.ComponentQuery.query("[name=showItemsCount]")[0];var y=Ext.ComponentQuery.query("[name=showDiscount]")[0];var o=Ext.ComponentQuery.query("[name=showTaxValue]")[0];var j=Ext.ComponentQuery.query("[name=showTaxPercentage]")[0];var k=Ext.getStore("PdfTemplates");var g=k.queryBy(function(e,B){return e.get("documentType")==x.document.get("documentType")}).items;var A=g.length;var t,m;for(t=0;t<A;t++){template=g[t];if(template.get("companysDefault")){template.set("companysDefault",false)}if(template.get("template")==u.getValue()){m=template}}m.set("template",u.getValue());m.set("companysDefault",true);m.set("font",p.getValue());m.set("fontSize",n.getValue());m.set("itemsSpacing",h.getValue()+"");m.set("showItemsCount",(q.getValue())?"yes":"no");m.set("showDiscount",(y.getValue())?"yes":"no");m.set("showTaxValue",(o.getValue())?"yes":"no");m.set("showTaxPercentage",(j.getValue())?"yes":"no");if(m.get("documentType")=="invoice"){var l=m.get("name"),s=x.editTemplatesPanel.down("combobox[name=globalTemplate]");switch(m.get("pageSize")){case"letter":l+=" ("+translate("template.half-letter")+")";break;case"half-letter":l+=" ("+translate("template.half-letter")+")";break;case"ticket":l+=" ("+translate("template.ticket")+")";break}s.setValue(l)}f.submit({url:"/pdf-template/save-default/format/json",waitMsg:translate("savingAction",true),params:{idLocal:m.get("idLocal")+"",documentType:m.get("documentType"),name:m.get("name"),template:m.get("template"),companysDefault:(m.get("companysDefault"))?"yes":"no",pageSize:m.get("pageSize"),itemsSpacing:m.get("itemsSpacing"),font:m.get("font"),fontSize:m.get("fontSize"),showItemsCount:m.get("showItemsCount"),showDiscount:m.get("showDiscount"),showTaxValue:m.get("showTaxValue"),showTaxPercentage:m.get("showTaxPercentage")},success:function(C,B){var e=B.response;var D=Ext.decode(e.responseText);z.enable();if(D.success){r.updateDocumentPickerWithDefaultPdfTemplates(v);z.up().up().up().close()}else{GlobalMsg.showErrorMessage(translate("error",true),D.cause)}},failure:function(C,B){var e=B.response;var D=Ext.decode(e.responseText);z.enable();GlobalMsg.showErrorMessage(translate("error",true),D.cause)}})}},company_FormNextTransactionNumber:{render:function(d){Ext.Ajax.request({url:"/company/retrieve-next-transaction-numbers/format/json",success:function(f,h){var k=Ext.decode(f.responseText);if(k.success){var g=k.results;var e=d.down("textfield[name=nextTransactionNumber]");var j=d.down("textfield[name=transactionPrefix]");if(d.type==="in"){e.setValue(g.nextTransactionInNumber);j.setValue(g.transactionInPrefix)}else{if(d.type==="out"){e.setValue(g.nextTransactionOutNumber);j.setValue(g.transactionOutPrefix)}else{}}}else{Ext.MessageBox.alert(translate("error",true),k.cause)}}})}},"company_FormNextTransactionNumber button[action=saveNextTransactionNumber]":{click:function(l){var e=l.up("form");var m=e.up("window");var o=new Ext.LoadMask(m,{msg:translate("editingAction",true)});o.show();var n=e.down("textfield[name=nextTransactionNumber]");var f=e.down("textfield[name=transactionPrefix]");var j=[n];var d=this.validateNumberFieldMaxValue(j);if(d.valid){var h=n.getValue();var g={};if(e.type==="in"){g.nextTransactionInNumber=h;g.transactionInPrefix=f.getValue()}else{if(e.type==="out"){g.nextTransactionOutNumber=h;g.transactionOutPrefix=f.getValue()}}Ext.Ajax.request({url:"/company/edit-next-transaction-number/format/json",method:"POST",params:g,success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){e.up("window").destroy();o.hide()}else{Ext.MessageBox.alert(translate("error",true),r.cause);o.hide()}},failure:function(){o.hide()}})}else{o.hide();for(var k=0;k<d.fields.length;k++){d.fields[k].markInvalid("El valor ingresado debe ser menor a 4,294,967,295")}}}},"window[reason=incompleteCompanyInfo]":{render:function(e){form=e.up("form");var d=this;var f=e.infoTitle;if(f==undefined){f=""}Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,j){var y=Ext.decode(g.responseText);if(y.success){var G=y.results;var B=G.keyCountry;var P=G.name;var q=G.identification;var n=G.address;var I=G.countryName;var J=G.city;var r=G.phone;var m=G.website;var F=G.email;var l=G.termsConditions;var O=G.hasLogo;var z=G.idInvoiceTemplate;var K;var D=[];if(P&&P!==""){K={xtype:"hidden",name:"name",value:P}}else{K={xtype:"textfield",name:"name",fieldLabel:translate("name",true),emptyText:translate("name",true),allowBlank:true}}D.push(K);if(q&&q!==""){K={xtype:"hidden",name:"identification",value:q}}else{var v=B!="usa"?true:false;K={xtype:"textfield",name:"identification",fieldLabel:translate("identification",true),emptyText:"",allowBlank:!v};switch(B){case"mexico":K.regex=/^[A-Z,Ñ,&]{3,4}[0-9]{2}[0-1][0-9][0-3][0-9][A-Z,0-9]?[A-Z,0-9]?[0-9,A-Z]?$/;K.tooltip=null;break;case"peru":K.regex=/^[0-9]*$/;K.maxLength=11;break}}D.push(K);if(B=="mexico"){var x=G.addressObject.street;var C=G.addressObject.exteriorNumber;var p=G.addressObject.interiorNumber;var N=G.addressObject.colony;var s=G.addressObject.locality;var M=G.addressObject.municipality;var t=G.addressObject.zipCode;var o=G.addressObject.state;var I=G.addressObject.country;K={xtype:"container",layout:"hbox",items:[{xtype:"displayfield",fieldLabel:translate("address",true),labelAlign:"right",labelPad:15,labelWidth:110},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",align:"right",defaults:{xtype:"textfield"},items:[{emptyText:"Calle",name:"street",width:134,allowBlank:true,hidden:x?true:false,value:x,},{emptyText:"Exterior",name:"exteriorNumber",allowBlank:true,width:65,margin:"0 5",hidden:C?true:false,value:C,},{emptyText:"Interior",name:"interiorNumber",allowBlank:true,width:64,hidden:p?true:false,value:p,},]},{xtype:"container",layout:"hbox",align:"right",margin:"5 0 0 0",defaults:{xtype:"textfield"},items:[{emptyText:"Colonia",name:"colony",width:134,margin:"0 5 0 0",allowBlank:true,hidden:N?true:false,value:N,},{emptyText:"Localidad",name:"locality",width:134,allowBlank:true,hidden:s?true:false,value:s,},]},{xtype:"container",margin:"5 0 0 0",layout:"hbox",align:"right",defaults:{xtype:"textfield"},items:[{emptyText:"Municipio/Delegación",name:"municipality",allowBlank:true,width:134,margin:"0 5 0 0",hidden:M?true:false,value:M,},{emptyText:"Código postal",name:"zipCode",allowBlank:false,width:134,minLength:5,maxLength:5,regex:/^([0-9]+$)/,hidden:t?true:false,value:t,}]},{xtype:"container",layout:"hbox",margin:"5 0",align:"right",defaults:{xtype:"textfield"},items:[{emptyText:"Estado",name:"state",width:134,margin:"0 5 0 0",allowBlank:true,hidden:o?true:false,value:o,},{emptyText:"País",name:"country",allowBlank:false,width:134,hidden:I?true:false,value:I,}]}]}]}}else{D.push({xtype:"addressField",name:"addressComponent",labelPad:15,labelWidth:105,fullWidth:274,isRequiredForElectronicInvoicing:{idNeighborhood:["costaRica"]},defaults:{margin:"5 0 0 3",},})}if(r&&r!==""){K={xtype:"hidden",name:"phone",value:r}}else{K={xtype:"textfield",name:"phone",fieldLabel:translate("phone",true),emptyText:"",allowBlank:true}}D.push(K);if(m&&m!==""){K={xtype:"hidden",name:"website",value:m}}else{K={xtype:"textfield",name:"website",fieldLabel:translate("webSite",true),emptyText:"",allowBlank:true}}D.push(K);if(F&&F!==""&&!e.forEmail){K={xtype:"hidden",name:"email",value:F};D.push(K)}else{var E=(e.forEmail)?false:true;K={xtype:"textfield",name:"email",fieldLabel:translate("electronicEmail",true),regex:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,invalidText:translate("thisFieldMustBeAnEmailAddressInTheFormat",true),emptyText:"",allowBlank:E,value:F};D.push(K);if(!E){K={xtype:"hidden",name:"reason",value:"email"};D.push(K)}}if(l&&l!==""){K={xtype:"hidden",name:"termsConditions",value:l}}else{K={xtype:"textarea",name:"termsConditions",fieldLabel:translate("termAndCondition",true),emptyText:"",allowBlank:true}}D.push(K);if(!O){K={xtype:"box",width:275,html:translate("inOrderToHaveAGoodLookingLogo",true),style:"float: right; width: 275px; margin-right: 58px; margin-bottom: 10px;margin-top: 10px;border: 1px solid #CCC;background: #EEE;padding: 10px;border-radius: 6px;color: #555;"};D.push(K);K={xtype:"filefield",name:"logo",fieldLabel:translate("logo",true),buttonText:translate("selectLogo",true),emptyText:translate("logo",true),allowBlank:true,listeners:{change:function(S,R,Q){d.removeFakePathWord(S,R)}}};D.push(K)}if(I!=="México"&&e.resourceTrigger&&e.resourceTrigger==="invoice"){D.push({xtype:"company_InvoiceTemplatePicker",id:"dataviewIdInvoiceTemplates",width:"100%",label:translate("templateOf",true)+" "+translate("theInvoices")+" "+translate("invoices"),labelType:"fieldset",fieldsetStyle:"border: 1px solid #ccc;",itemsContainerStyle:"margin: -2px;",name:"idInvoiceTemplate",useItemsGroup:false});D.push({xtype:"box",width:"100%",style:"text-align: center; margin-top: 15px; padding: 0px 35px;",html:"<div>"+translate("youCanSeeMoreBillingTemplatesAndConfigureThem",true)+".</div>"})}var h=Ext.create("Ext.form.Panel",{bodyPadding:"25 15 15",border:false,anchor:100,defaults:{labelAlign:"right",labelPad:15,labelWidth:110,width:400},url:e.url,number:e.number,callback:e.callback,defaultType:"textfield",items:D,configs:{country:B,isActiveElectronicInvoicing:G.metadata&&G.metadata.isActiveElectronicInvoicing},buttons:[{text:translate("save",true),cls:"button main-button",margin:"10 10 0 0",height:40,hidden:true,action:"saveMandatoryCompanyInfo"}],listeners:{afterrender:function(){var Q=document.querySelector(".smile-window .x-window-body");if(Q){Q.scroll(0,0)}}}});var L=h.down("addressField[name=addressComponent]");if(L){L.setCountry(B);L.setValues(G)}if(I!=="México"&&e.resourceTrigger&&e.resourceTrigger==="invoice"){var w=h.down("dataview[name=idInvoiceTemplate]");var H=w.getStore();var k=H.getProxy();k.url="/configuration/retrieve-default-and-two-more-invoice-templates/format/json";H.load({callback:function(){w.select(H.findRecord("idLocal",z));e.scrollBy(0,-110)}})}else{h.getForm().idInvoiceTemplate=z}var u={xtype:"box",cls:"modal-title",style:"margin-bottom: 0px; margin-top: 15px; padding: 0px 35px;",html:"<div>"+f+" </div>",name:"header"};var A={xtype:"label",html:'<div style="float: left; position: relative; top: -30px; left: 10px;" class="required-anotation window">'+translate("requiredText",true)+"</div>"};e.add(u);e.add(h)}else{}},failure:function(){}})},destroy:function(d){if(!d.forEmail){}}},"button[action=saveMandatoryCompanyInfo]":{click:this.saveMandatoryCompanyInfo},"company_WindowExportInfo button[action=export-info]":{click:function(k){var p=k.up("window");var o=p.documentType;var e=p.down("datefield[name=fromDate]");var m=p.down("datefield[name=toDate]");var q=p.down("combo[name=reportFormat]");var n=e.getValue();var l=m.getValue();var j=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();var f=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var d="/labs/test11/exportable-type/"+o+"/format/json";if(o==="all"){d="/labs/test13/format/json"}if(j&&f){d=d+"/from-date/"+j+"/to-date/"+f}var h=p.filterPlugin,g={};if(h){g.filters=h.getSubmitFilters()}if(o==="ledger-trial-balance"){g.idClient=p.down("combo[name=idClient]").getValue();g.idCategory=p.down("combo[name=idCategory]").getValue()}var r=q?(q.getValue()=="text"?"plano":"excel"):"excel";var s=["Alegra está generando tu archivo "+r+" y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");if(["report-606","report-607","report-608"].indexOf(o)!==-1){s=s+"</br></br> Recuerda validar la información antes de presentarla ante cualquier</br>entidad de control.</br></br>";if(q){d+="/file-type/"+q.getValue()}}if(k.text==translate("export",true)){k.update('<svg class="icon icon-spin"><use xlink:href="/images/smile-icons.svg#loading"></use></svg>');Ext.Ajax.request({url:d,params:g,binary:true,timeout:300000,success:function(y,E){k.update(translate("export",true));try{var z=String.fromCharCode.apply(null,new Uint8Array(y.responseBytes));z=z.replace(/Already running.../gi,"");var v=Ext.decode(z);if(!v.success){Ext.Msg.show({title:translate("anErrorOcurred",true),msg:translate("yourExportableCouldNotBeGenerated",true),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{var I=translate("generatingFile",true)+" "+r;if(v.rowsCount==0){s=translate("sorryNoRecordsFoundToExport",true)}else{p.close()}if(r=="excel"){I=translate("generatingExcelFile",true)}Ext.Msg.show({title:I,msg:s,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION});if(o==="all"&&p.id){var D=new Date();D.setTime(D.getTime()+(3600*1000));Ext.util.Cookies.set("export-all-info-job-"+p.id,"working",D)}}}catch(C){p.close();var u="";var x=y.getResponseHeader("Content-Disposition");if(x&&x.indexOf("attachment")!==-1){var w=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var B=w.exec(x);if(B!=null&&B[1]){u=B[1].replace(/['"]/g,"")}}var G=y.getResponseHeader("Content-Type");var t=typeof File==="function"?new File([y.responseBytes],u,{type:G}):new Blob([y.responseBytes],{type:G});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(t,u)}else{var F=window.URL||window.webkitURL;var A=F.createObjectURL(t);if(u){var H=document.createElement("a");if(typeof H.download==="undefined"){window.location=A}else{H.href=A;H.download=u;document.body.appendChild(H);H.click()}}else{window.location=A}setTimeout(function(){F.revokeObjectURL(A)},100)}}},failure:function(t){console.log(t);Ext.Msg.show({title:translate("anErrorOcurred",true),msg:translate("yourExportableCouldNotBeGenerated",true),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});k.update(translate("export",true))}})}}},"company_WindowExportInfo ":{afterrender:function(d){var e=Ext.get("exportAllInfo");if(e){e.on("click",function(j){j.preventDefault();var f=d.documentType;var l=d.filterPlugin,k={};if(l){k.filters=l.getSubmitFilters()}var h=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");var g=this;if(e.dom.innerHTML==translate("exportAll",true)){g.update('<svg class="icon icon-spin"><use xlink:href="/images/smile-icons.svg#loading"></use></svg>');Ext.Ajax.request({url:"/labs/test11/exportable-type/"+f+"/format/json",params:k,binary:true,success:function(r,w){e.dom.innerHTML=translate("exportAll",true);d.close();try{var s=String.fromCharCode.apply(null,new Uint8Array(r.responseBytes));s=s.replace(/Already running.../gi,"");var o=Ext.decode(s);if(!o.success){Ext.Msg.show({title:translate("anErrorOcurred",true),msg:translate("yourExportableCouldNotBeGenerated",true),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(o.rowsCount==0){h=translate("sorryNoRecordsFoundToExport",true)}Ext.Msg.show({title:translate("generatingExcelFile",true),msg:h,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}catch(v){var n="";var p=r.getResponseHeader("Content-Disposition");if(p&&p.indexOf("attachment")!==-1){var q=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var u=q.exec(p);if(u!=null&&u[1]){n=u[1].replace(/['"]/g,"")}}var y=r.getResponseHeader("Content-Type");var m=typeof File==="function"?new File([r.responseBytes],n,{type:y}):new Blob([r.responseBytes],{type:y});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(m,n)}else{var x=window.URL||window.webkitURL;var t=x.createObjectURL(m);if(n){var z=document.createElement("a");if(typeof z.download==="undefined"){window.location=t}else{z.href=t;z.download=n;document.body.appendChild(z);z.click()}}else{window.location=t}setTimeout(function(){x.revokeObjectURL(t)},100)}}},failure:function(m){console.log(m);Ext.Msg.show({title:translate("anErrorOcurred",true),msg:translate("yourExportableCouldNotBeGenerated",true),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});g.update(translate("exportAll",true))}})}})}setTimeout(function(){var f=Ext.ComponentQuery.query("button[action=download-daily-report]")[0];if(f){f.on("click",function(m,l){var j=d.down("datefield[name=fromDate]");var k=j.getValue();var h=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();location.href="/report/daily-sales-report/from/"+h;d.close()})}var g=Ext.ComponentQuery.query("button[action=download-sales-detail]")[0];if(g){g.on("click",function(o,n){var l=d.down("datefield[name=fromDate]");var m=l.getValue();var p=d.down("datefield[name=toDate]");var k=p.getValue();var h=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate();var j=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();location.href="/report/sales-detail-report/from/"+h+"/to/"+j;d.close()})}},200)}},company_modern_WindowExportInfoPreviousYearInterval:{beforerender:function(h){var f=h.down("datefield[name=fromDate]");var l=h.down("datefield[name=toDate]");var e=new Date();var j=Ext.Date.getDayOfYear(e);var k=Ext.Date.add(e,Ext.Date.DAY,-1*j);var d=Ext.Date.add(k,Ext.Date.DAY,-1);if(Ext.Date.isLeapYear(d)){var g=Ext.Date.add(d,Ext.Date.DAY,-365)}else{var g=Ext.Date.add(d,Ext.Date.DAY,-364)}f.setValue(g);l.setValue(d)}},"company_modern_WindowExportInfoPreviousYearInterval datefield[name=fromDate]":{change:function(f,h,d){var g=f.up("window");var j=g.down("datefield[name=toDate]");var e=f.getValue();if(e instanceof Date){j.minValue=e;j.isValid()}}},"company_FormUploadFile filefield[name=file]":{change:function(g,f,d){var e=Ext.DomQuery.selectNode("input[id="+g.getInputId()+"]");e.value=f.replace("C:\\fakepath\\","")}},"company_FormUploadFile filefield[name=pdfFile]":{change:function(g,f,d){var e=Ext.DomQuery.selectNode("input[id="+g.getInputId()+"]");e.value=f.replace("C:\\fakepath\\","")}},"company_FormUploadFile button[action=uploadFile]":{click:function(k){var e=k.up("form");var l=e.up("window");e.down("hidden[name=type]").setValue(e.type);e.down("hidden[name=idType]").setValue(e.idType);var d="/file/upload/format/json";if(e.url){d=e.url}if(e.isValid()){var j=e.down("filefield[name=file]");var g=new Date().getTime();var m="fileupload-form-"+g;var n=Ext.DomHelper.append(Ext.getBody(),'<form id="'+m+'" method="POST" enctype="multipart/form-data" class="x-hide-display"></form>');n.appendChild(j.extractFileInput());var l=e.up("window");var f=new Ext.LoadMask(l.getEl(),{msg:translate("uploadingFile",true)});var h=e.getValues();h.forceUploadEmptyResource=e.forceUploadEmptyResource;f.show();Ext.Ajax.request({url:d,params:h,isUpload:true,form:m,headers:{"Content-type":"multipart/form-data"},success:function(p){f.hide();var s=null;var r=null;try{s=Ext.decode(p.responseText)}catch(q){r=q.message;console.log(q)}l.close();if(s&&s.success){var o="";if(e.type=="billXml"){if(s.idPdf){o="/idPdf/"+s.idPdf}window.location="/bill/add-from-xml/id/"+s.idXml+o}else{if(e.type=="invoiceXml"){if(s.idPdf){o="/idPdf/"+s.idPdf}window.location="/invoice/add-from-xml/id/"+s.idXml+o}else{window.location.reload()}}}else{if(s&&s.cause){GlobalMsg.showErrorMessage(translate("error",true),s.cause)}else{var q="El archivo no se pudo adjuntar correctamente, por favor inténtalo de nuevo";if(r.match(/413 Request Entity Too Large/)){q="El archivo es muy grande y no se pudo adjuntar, el tamaño máximo permitido es 10MB"}GlobalMsg.showErrorMessage(translate("error",true),q)}}},failure:function(o){f.hide();l.close();var q=null;try{q=Ext.decode(o.responseText)}catch(p){console.log(p)}if(q&&q.cause){GlobalMsg.showErrorMessage(translate("error",true),q.cause)}else{GlobalMsg.showErrorMessage(translate("error",true),"El archivo no se pudo adjuntar correctamente, por favor inténtalo de nuevo")}}})}},beforerender:function(d){var e=d.up("form");var f=translate("attachAFile",true);if(e.windowTitle){f=e.windowTitle}e.insert(2,{xtype:"component",width:550,cls:"modal-title",style:"margin-bottom: 20px;",name:"title",html:"<div>"+f+"</div>"});if(e.type=="xml"){d.text="Subir"}if(e.type=="invoiceXml"||e.type=="billXml"){e.add({xtype:"filefield",name:"pdfFile",fieldLabel:translate("selectPdfFile",true),labelWidth:140,width:450});e.down("filefield[name=file]").fieldLabel=translate("selectXmlFile",true)}}},"menuitem[action=uploadFile]":{click:function(h){var g={};var f="";var d=h.up("button");if(d.maxFiles){f=d.maxFiles}if(d.canUpload=="yes"){g.type=d.type;g.idType=d.idType;this.application.fireEvent("uploadFile",g)}else{var e=Ext.create("AL.modal.PlanLimit",{configs:{message:"Has agregado <strong>"+f+" archivos adjuntos </strong> disponibles en tu plan actual. Elige un nuevo plan para realizar esta acción y seguir creciendo con Alegra."}});e.init()}}},"menuitem[action=uploadFile]":{click:function(h){var g={};var f="";var d=h.up("button");if(d.maxFiles){f=d.maxFiles}if(d.canUpload=="yes"){g.type=d.type;g.idType=d.idType;this.application.fireEvent("uploadFile",g)}else{var e=Ext.create("AL.modal.PlanLimit",{configs:{message:"Has agregado <strong>"+f+" archivos adjuntos </strong> disponibles en tu plan actual. Elige un nuevo plan para realizar esta acción y seguir creciendo con Alegra."}});e.init()}}},company_GridAllStampReceptionMails:{afterrender:function(e){var d=e.getStore();if(!d.hasLoaded()&&!d.isLoading()){d.load()}}},company_FormEditEmailTemplate:{beforerender:function(f){var g="";switch(f.type){case"invoices-overdue-today":g=translate("noticesForInvoicesDueToday",true);break;case"invoices-overdue":g=translate("notificationOfOverdueInvoices",true);break;case"invoices-almost-overdue":g=translate("notificationForUpcomingInvoicesDueToday",true);break;case"invoice":g=translate("sendingTheDocument",true,{document:translate("invoices")})+" ";break;case"estimate":g=translate("sendingTheDocument",true,{document:translate("estimates")})+" "+ +"";break;case"remission":g=translate("sendingTheDocument",true,{document:translate("remissions")});break;case"credit-note":g=translate("sendingTheDocument",true,{document:translate("creditNotes")});break;case"transaction-in":g=translate("sendingTheDocument",true,{document:translate("transactionIn")});break;case"transaction-out":g=translate("sendingTheDocument",true,{document:translate("transactionOut")});break;case"purchase-order":g=translate("sendingTheDocument",true,{document:translate("purchaseOrders")});break}f.down("label[name=emailTypeSubtitle]").update('<div class="windowTitle" style ="font-weight:normal;">'+g+"</div>");var e=f.up("window");var d=new Ext.LoadMask(e.getEl(),{msg:translate("loading",true)});d.show();Ext.Ajax.request({url:"/company/retrieve-email-template/format/json/type/"+f.type,success:function(n,m){d.hide();var p=Ext.decode(n.responseText);if(p.success){var o=p.results;var k=o.emailType;var j=f.down("textfield[name=subject]");var h=f.down("htmleditor[name=message]");var q=f.down("textfield[name=fromAddress]");var l=f.down("hidden[name=emailType]");j.setValue(k.subject);h.setValue(k.message);q.setValue(o.companyName);l.setValue(f.type)}},failure:function(){}})}},"company_FormEditEmailTemplate button[action=save]":{click:function(f){var h=f.up("form").getForm();var g=f.up("form").up("window");var e=f.up("form");var d=new Ext.LoadMask(g.getEl(),{msg:translate("saving",true)});d.show();h.submit({url:"/company/edit-email-templates/format/json",success:function(o,k){var j=k.response;var p=Ext.decode(j.responseText);if(p.success){d.hide();g.close();if(e.emailExample){var n=e.emailExample;var l=p.preview.subject;var m=p.preview.message;var q='<div class="noifications-email-preview"><strong>De:</strong> <span class="company-email">'+e.companyName+"</span><br /><strong>Para:</strong> nombre@micliente.com<br /><strong>Asunto:</strong> "+l+"<hr /><br />";if(e.country=="usa"){q='<div class="noifications-email-preview"><strong>From:</strong> <span class="company-email">'+e.companyName+"</span><br /><strong>To:</strong> client@myclient.com<br /><strong>Subject:</strong> "+l+"<hr /><br />"}n.update(q+m+"</div>")}}else{GlobalMsg.showErrorMessage(translate("error",true),p.cause);d.hide()}},failure:function(){d.hide()}})}},"company_FormEditEmailTemplate htmleditor[name=message]":{change:function(e){var f=e.up("form");var d=f.down("splitbutton[name=placeHolderButton]");d.originElement="htmleditor"}},"company_FormEditEmailTemplate textfield[name=subject]":{focus:function(f){var e=f.up("form");var d=e.down("splitbutton[name=placeHolderButton]");d.originElement="subjectTextField"}},"company_FormEditEmailTemplate splitbutton[name=placeHolderButton]":{afterrender:function(f){var g=f.up(g);var e=[];if(g.type){switch(g.type){case"invoices-overdue":case"invoices-overdue-today":case"invoices-almost-overdue":case"invoice":e.push('<div class="placeHolderTitle">'+translate("invoice",true)+"</div>");e.push({text:translate("number",true),value:"{{NúmeroFactura}}"},{text:translate("date",true),value:"{{FechaFactura}}"},{text:translate("due",true),value:"{{FechaVencimientoFactura}}"},{text:"Total",value:"{{TotalFactura}}"},{text:translate("unpaid",true),value:"{{TotalPagarFactura}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});if(g.statementClientAttached==="yes"){e.push({text:translate("statementWC",true),value:"{{AccesoEstadoCuenta}}"})}break;case"estimate":e.push('<div class="placeHolderTitle">'+translate("estimate")+"</div>");e.push({text:translate("number",true),value:"{{NúmeroCotización}}"},{text:translate("date",true),value:"{{FechaCotización}}"},{text:translate("due",true),value:"{{FechaVencimientoCotización}}"},{text:"Total",value:"{{TotalCotización}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});break;case"credit-note":e.push('<div class="placeHolderTitle">'+translate("creditNote",true)+"</div>");e.push({text:translate("number",true),value:"{{NúmeroNotaCrédito}}"},{text:translate("date",true),value:"{{FechaNotaCrédito}}"},{text:"Total",value:"{{TotalNotaCrédito}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});break;case"remission":e.push('<div class="placeHolderTitle">'+translate("remission",true)+"</div>");e.push({text:translate("number",true),value:"{{NúmeroRemisión}}"},{text:translate("date",true),value:"{{FechaRemisión}}"},{text:translate("due",true),value:"{{FechaVencimientoRemisión}}"},{text:"Total",value:"{{TotalRemisión}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});break;case"transaction-in":case"transaction-out":var d=translate("transactionIn",true);var h="ReciboCaja";if(g.type=="transaction-out"){d=translate("transactionOut",true);h="ComprobanteEgreso"}e.push('<div class="placeHolderTitle">'+d+"</div>");e.push({text:translate("number",true),value:"{{Número"+h+"}}"},{text:translate("date",true),value:"{{Fecha"+h+"}}"},{text:"Total",value:"{{Total"+h+"}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});break;case"purchase-order":e.push('<div class="placeHolderTitle">'+translate("purchaseOrder",true)+"</div>");e.push({text:translate("number",true),value:"{{NúmeroOrdenDeCompra}}"},{text:translate("date",true),value:"{{FechaOrdenDeCompra}}"},{text:translate("deliveryDate",true),value:"{{FechaEntregaOrdenDeCompra}}"},{text:"Total",value:"{{TotalOrdenDeCompra}}"});e.push('<div class="placeHolderTitle">'+translate("clientA",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreCliente}}"});break;case"statement":e.push('<div class="placeHolderTitle">'+translate("statement",true)+"</div>");e.push({text:translate("linkTo",true)+" "+translate("statementWC"),value:"{{Link}}"});break}e.push('<div class="placeHolderTitle">'+translate("company",true)+"</div>");e.push({text:translate("name",true),value:"{{NombreEmpresa}}"},{text:translate("email",true),value:"{{CorreoEmpresa}}"},{text:translate("phone",true),value:"{{TeléfonoEmpresa}}"},{text:translate("webSite",true),value:"{{PáginaEmpresa}}"})}f.menu=new Ext.menu.Menu({items:e})}},"company_FormEditEmailTemplate menuitem":{click:function(k){if(k.value){var h=Ext.ComponentQuery.query("company_FormEditEmailTemplate")[0];var d=h.down("splitbutton[name=placeHolderButton]");var f=null;if(d.originElement=="subjectTextField"){f=h.down("textfield[name=subject]");var j=Ext.DomQuery.select("input",f.getEl().dom)[0];var e=j.selectionStart;var g=j.selectionEnd;j.value=j.value.substring(0,e)+k.value+j.value.substring(g,j.value.length);j.selectionStart=e+k.value.length;j.selectionEnd=e+k.value.length}else{f=h.down("htmleditor[name=message]");f.insertAtCursor(k.value)}}}},company_EmailTemplates:{afterrender:function(d){Ext.Ajax.request({url:"/company/retrieve-all-email-templates/format/json",success:function(g){if(d.country=="usa"){d.down("fieldset[name=remissionContainer]").hide()}g=Ext.decode(g.responseText);for(var f in g.results){var e=d.down("box[queryName="+f+"]");if(e){var h='<div class="noifications-email-preview"><strong>De:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>Para:</strong> nombre@micliente.com<br /><strong>Asunto:</strong> "+g.results[f].subject+"<hr /><br />";if(d.country=="usa"){h='<div class="noifications-email-preview"><strong>From:</strong> <span class="company-email">'+d.companyName+"</span><br /><strong>To:</strong> client@myclient.com<br /><strong>Subject:</strong> "+g.results[f].subject+"<hr /><br />"}e.update(h+g.results[f].message+"</div>")}}},failure:function(){}})}},externalpayments_FormEdit:{render:function(f){var g=f.down("textfield[name=identification]");g.getSubmitData=this.getSubmitDataDisabled;var h=f.down("[name=merchantId]");h.getSubmitData=this.getSubmitDataDisabled;var e=f.down("[name=email]");e.getSubmitData=this.getSubmitDataDisabled;var d=f.down("[name=phone]");d.getSubmitData=this.getSubmitDataDisabled;Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(j,o){var p=Ext.decode(j.responseText);if(p.success){var m=p.results;var n=true;f.getForm().setValues({canReceiveExternalPayments:m.canReceiveExternalPayments==="yes",merchantId:m.merchantId});if(m.metadata){f.setFieldValuesFromMetadata(m.metadata);if(!m.metadata.visanet){var s=f.down("textfield[name=identification]");var l=f.down("textfield[name=phone]");var r=f.down("textfield[name=email]");if(m.identification){s.setValue(m.identification)}if(m.phone){l.setValue(m.phone)}if(m.email){r.setValue(m.email)}}else{n=false;f.notEdited=true;var k=f.down("[name=editButton]");if(k){k.show()}var q=Ext.get("editInfoVisanet");if(q){q.on("click",function(u){u.preventDefault();var t=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,bodyStyle:"background: transparent;",title:"Editar "+translate("externalPayments"),width:403,items:[{xtype:"box",html:'<div style="margin-left: 42px; font-family: Roboto; font-style: normal; font-weight: normal; font-size: 12px; line-height: 18px; color: #808080;">Para realizar cambios en la información de tus datos<br>escríbemos en <a href="https://www.getsoft.app/123" target="_blank">getsoft.app/123</a>.</div>'}],footer:{items:[{cls:"button main-button",text:"Entendido",margin:"0 28 0 0",handler:function(){t.close()}}]}})})}}}f.disabledControls(n&&m.canReceiveExternalPayments==="yes")}else{GlobalMsg.showErrorMessage(translate("error",true),p.cause)}},failure:function(l,k){var j=k.response;var m=Ext.decode(j.responseText);Ext.Msg.alert(translate("error",true),m.cause)}})}},"externalpayments_FormEdit checkbox[name=canReceiveExternalPayments],company_FormExternalPaymentsEdit checkbox[name=canReceiveExternalPayments]":{change:function(d,f){var e=d.up("form");if(e&&!e.notEdited){e.disabledControls(f)}}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditNequi checkbox[name=canReceiveExternalPayments]":{change:function(d,e){}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditPayU checkbox[name=canReceiveExternalPayments]":{change:function(e,g){var f=Ext.ComponentQuery.query("externalpayments_FormEditPayU")[0];var d=f.down("textfield[name=minimumAmount]");var h=f.down("checkboxfield[name=restrictMinimumPayment]");if(f){f.disabledControls(g)}if(h.value&&g){d.allowBlank=false;d.validate();d.enable()}else{d.disable()}}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditRappiPay checkbox[name=canReceiveExternalPayments]":{change:function(d,f){var e=Ext.ComponentQuery.query("externalpayments_FormEditRappiPay")[0];if(e){e.enableControls(f)}}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditTpaga checkbox[name=canReceiveExternalPayments]":{change:function(d,f){var e=Ext.ComponentQuery.query("externalpayments_FormEditTpaga")[0];if(e){e.enableControls(f)}}},externalpayments_Welcome:{render:function(g){var d=Ext.get("affiliate");if(d){d.on("click",function(m){m.preventDefault();var j=Ext.ComponentQuery.query("[tabId=option0]")[0];if(j){var l=j.down("externalpayments_Welcome");if(l){l.hide()}var k=j.down("externalpayments_FormEdit");if(k){k.show()}}})}var e=Ext.get("joinMe");if(e){var f=g.up("company_FormExternalPaymentsEditSwitch"),h=f?f.idCompany:null;e.on("click",function(k){k.preventDefault();dataLayer.push({eventAppCategory:"Alliances",eventAppAction:"New Lead Visanet",eventAppLabel:h,event:"eventApp"});var j=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,bodyStyle:"background: transparent;",title:"Redirigiendo a afiliación en línea",width:455,items:[{xtype:"box",html:'<div style="margin-left: 42px; font-family: Roboto; font-style: normal; font-weight: normal; font-size: 12px; line-height: 18px; color: #808080;"><strong>Ten a la mano los siguientes documentos para este proceso:</strong><ul><li>- Carta de referencia bancaria</li><li>- Copia del RNC</li><li>- Documento de identidad del representante</li><li>- Fotos del establecimiento.</li></ul></div>'}],footer:{items:[{cls:"button main-button",text:"Entendido",margin:"0 28 0 0",handler:function(){window.open("https://alegra.visanet.com.do/");j.onClose=true;j.close()}}]},listeners:{close:function(l){if(!l.onClose){window.open("https://alegra.visanet.com.do/")}}}})})}}},company_FormExternalPaymentsEdit:{render:function(g){var f=g.down("textfield[name=minimumAmount]");if(g.country&&!Ext.Array.contains(["mexico","republicaDominicana"],g.country)){if(!g.externalPaymentsProvider||g.externalPaymentsProvider!=="nequi"){g.down("checkbox[name=canApplyRetentions]").show()}}if(g.country&&g.country==="republicaDominicana"){var d=g.down("[name=apiKey]");d.maxLength=64;var e=g.down("[name=accountId]");e.regex=null;e.minValue=null;e.maxLength=72;var j=g.down("[name=merchantId]");j.regex=null;j.minValue=null;j.maxLength=50;var h=g.down("[name=secretKey]");h.allowBlank=false;h.show()}else{if(g.externalPaymentsProvider&&g.externalPaymentsProvider==="nequi"){var d=g.down("[name=apiKey]");d.maxLength=64;d.allowBlank=true;d.hide();var e=g.down("[name=accountId]");e.regex=null;e.minValue=null;e.maxLength=72;e.allowBlank=true;e.hide();var j=g.down("[name=merchantId]");j.regex=null;j.minValue=null;j.maxLength=50;j.allowBlank=true;j.hide();var h=g.down("[name=secretKey]");h.allowBlank=true;h.hide()}}Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(k,m){var n=Ext.decode(k.responseText);if(n.success){var l=n.results;var o=Ext.isEmpty(l.externalPaymentsProvider)?"payu":l.externalPaymentsProvider;if(g.country&&g.country==="colombia"&&g.externalPaymentsProvider&&g.externalPaymentsProvider!=o){g.getForm().setValues({canReceiveExternalPayments:l.canReceiveExternalPayments,canApplyRetentions:l.canApplyRetentions,restrictMinimumPayment:l.restrictMinimumPayment,minimumAmount:l.minimumAmount})}else{g.getForm().setValues({canReceiveExternalPayments:l.canReceiveExternalPayments,apiKey:l.apiKey,merchantId:l.merchantId,accountId:l.accountId,secretKey:l.secretKey,canApplyRetentions:l.canApplyRetentions,restrictMinimumPayment:l.restrictMinimumPayment,minimumAmount:l.minimumAmount})}if(l.restrictMinimumPayment==="yes"){f.enable()}g.disabledControls(l.canReceiveExternalPayments==="yes")}else{GlobalMsg.showErrorMessage(translate("error",true),n.cause)}},failure:function(m,l){var k=l.response;var n=Ext.decode(k.responseText);Ext.Msg.alert(translate("error",true),n.cause)}})}},"company_FormExternalPaymentsEdit button[action=saveExternalPaymentsInfo], company_FormExternalPaymentsEditSwitch button[action=saveExternalPaymentsInfo]":{click:this.saveExternalPaymentsInfo},"company_FormExternalPaymentsEditSwitch button[action=cancel]":{click:function(){window.location="/configuration"}},"company_FormExternalPaymentsEdit checkbox[name=restrictMinimumPayment]":{change:function(e,g){var f=e.up("form");var d=f.down("textfield[name=minimumAmount]");if(g){d.allowBlank=false;d.validate();d.enable()}else{d.disable()}}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditPayU":{render:function(f){var e=Ext.MessageBox.wait(translate("loading"));var d=f.down("textfield[name=minimumAmount]");Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,j){var k=Ext.decode(g.responseText);if(k.success){var h=k.results;if(h.externalPaymentsProvider==="nequi"){f.disabledControls(false)}else{f.getForm().setValues({canReceiveExternalPayments:h.canReceiveExternalPayments,apiKey:h.apiKey,merchantId:h.merchantId,accountId:h.accountId,secretKey:h.secretKey,canApplyRetentions:h.canApplyRetentions,restrictMinimumPayment:h.restrictMinimumPayment==="yes"?true:false,minimumAmount:h.minimumAmount});f.disabledControls(h.canReceiveExternalPayments==="yes");if(h.restrictMinimumPayment==="yes"&&h.canReceiveExternalPayments==="yes"){d.enable()}else{d.disable()}}}else{GlobalMsg.showErrorMessage(translate("error",true),k.cause)}e.hide()},failure:function(j,h){e.hide();var g=h.response;var k=Ext.decode(g.responseText);Ext.Msg.alert(translate("error",true),k.cause)}})}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditNequi":{render:function(e){var d=Ext.MessageBox.wait(translate("loading"));Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,j){var k=Ext.decode(g.responseText);if(k.success){var l="inactive";var h=k.results;var f=h.paymentProviders;if(f&&f.nequi){l=f.nequi.state}e.getForm().setValues({canReceiveExternalPayments:l==="active"?"yes":"no"})}else{GlobalMsg.showErrorMessage(translate("error",true),k.cause)}d.hide()},failure:function(h,g){d.hide();var f=g.response;var j=Ext.decode(f.responseText);Ext.Msg.alert(translate("error",true),j.cause)}})}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditRappiPay":{render:function(d){this.retrieveInfo(d)}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditPayU checkbox[name=restrictMinimumPayment]":{change:function(e,g){var f=e.up("form");var d=f.down("textfield[name=minimumAmount]");if(g){d.allowBlank=false;d.validate();d.enable()}else{d.disable()}}},"company_GridAllStampReceptionMails gridcolumn[type=actions]":{click:function(d,f,l,k,m,n){var o=this.application;var h=Ext.get(m.target);var g=d.up("grid").getSelectionModel().getSelection()[0];if(h.hasCls("deleteStampReceptionMail")||h.parent().hasCls("deleteStampReceptionMail")){m.preventDefault();o.fireEvent("deleteStampReceptionMail",{record:g,initiator:d})}}},"company_FormExternalPaymentsEditSwitch externalpayments_FormEditTpaga":{render:function(e){var d=Ext.MessageBox.wait(translate("loading"));Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(g,j){var m=Ext.decode(g.responseText);if(m.success){var l="unregistered";var h=m.results;var f=h.paymentProviders;if(f&&f.tpaga){l=f.tpaga.state}if(l=="unregistered"){e.getForm().setValues({canReceiveExternalPayments:l==="active"?"yes":"no",username:"",oldState:l,pass:""})}else{if(f.tpaga&&f.tpaga.data){var k=f.tpaga.data;e.getForm().setValues({canReceiveExternalPayments:l==="active"?"yes":"no",username:k.username,oldState:l,pass:k.password})}}if(l==="active"){e.enableControls(true)}else{if(l==="pending"){fieldsetNotification=e.down("fieldset[id=fieldsetNotification]");e.enableControls(false)}else{e.enableControls(false)}}}else{GlobalMsg.showErrorMessage("Error",m.cause)}d.hide()},failure:function(h,g){d.hide();var f=g.response;var j=Ext.decode(f.responseText);Ext.Msg.alert("Error",j.cause)}})}},"company_FormInfoEdit button[action=showModalSendSetTest]":{click:function(d){var f=d.up("form");var e=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,width:480,title:"Confirmación de datos para set de pruebas",bodyPadding:"20 20",bodyStyle:"background: transparent",items:{xtype:"form",items:[{xtype:"box",html:'<div class="sublabel" style="font-size: 12px;text-align: center; padding: 5px 10px 20px 10px;">Por favor verifica la información antes de volver a enviar el set de pruebas:</div>'},{xtype:"textfield",fieldLabel:"Test ID",name:"testId",allowBlank:false,maxLength:60,labelPad:15,labelWidth:100,width:355,labelAlign:"right",value:f.down("textfield[name=testSetId]").getValue(),allowBlank:false,regex:/^([A-Za-z0-9]{8})-([A-Za-z0-9]{4})-([A-Za-z0-9]{4})-([A-Za-z0-9]{4})-([A-Za-z0-9]{12})$/,regexText:"El valor ingresado no parece ser un testSetId válido, verifica la información directamente en la plataforma de la DIAN",tooltip:"Campo informativo para identificar el set de pruebas que se desea habilitar."},{xtype:"displayfield",hidden:false,fieldLabel:"Proveedor: ",value:"Soluciones Alegra S.A.S.",fieldStyle:"color: rgb(0, 177, 157); font-weight: bold; text-align:left;",labelPad:15,labelWidth:100,labelAlign:"right",}]},footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:"Confirmar",cls:"button main-button",margin:"0 28 0 0",handler:function(g){var k=g.up("window");var h=k.down("form");var l={setTestId:h.down("textfield[name=testId]").getValue()};k.destroy();var j=new Ext.LoadMask(Ext.getBody(),{msg:"Enviando..."});j.show();Ext.Ajax.request({url:"/company/resend-set-test/format/json",method:"POST",showSpinner:true,params:l,success:function(m,n){var o=Ext.decode(m.responseText);if(o.success){window.location.reload()}j.destroy()},failure:function(){j.destroy()}})},listeners:{afterrender:function(g){var j=g.up("window");var h=j.down("form");g.setDisabled(h.hasInvalidField());h.on("validitychange",function(k,l){g.setDisabled(!l)})}}}]}})}},})},saveExternalPaymentsInfo:function(d){var f=this;var b=d.up("form");var j=Ext.ComponentQuery.query("company_FormExternalPaymentsEditSwitch");var h="";var c=null;if(j){j=j[0];h=j.activeTab.id;c=j.country}var g=false;if(!b){b=Ext.ComponentQuery.query("externalpayments_FormEdit")[0]}if(!b&&h==="nequi"){b=Ext.ComponentQuery.query("externalpayments_FormEditNequi")[0]}if(!b&&h==="payu"){b=Ext.ComponentQuery.query("externalpayments_FormEditPayU")[0]}if(!b&&h==="rappiPay"){b=Ext.ComponentQuery.query("externalpayments_FormEditRappiPay")[0]}if(!b&&h==="tpaga"){b=Ext.ComponentQuery.query("externalpayments_FormEditTpaga")[0]}if(b){g=b.canReceiveExternalPayments;var a=b.identificationType}if(b.hidden){d.enable();return}function e(){d.disable();var t=b.down("checkbox[name=canReceiveExternalPayments]");if(b.getForm().isValid()){var o={};o.showNotification="no";if(c==="republicaDominicana"){var r=b.down("textfield[name=identification]");var q=b.down("textfield[name=phone]");var n=b.down("textfield[name=email]");var m={visanet:{identification:r.getValue(),phone:q.getValue(),email:n.getValue()}};o.provider="visanet";o.showNotification="yes";o.metadata=Ext.encode(m)}if(c==="colombia"||c==="mexico"){var s=b.down("checkboxfield[name=restrictMinimumPayment]");if(h==="nequi"){var p={paymentProviders:{nequi:{active:t.getValue()}}};o.canReceiveExternalPayments="yes";o.provider=h;o.metadata=Ext.encode(p)}else{if(h==="payu"){o.canReceiveExternalPayments=t.getValue();o.provider=h;o.restrictMinimumPayment=s.getValue()===true?"yes":"no"}}o.externalPaymentsProvider=h}b.getForm().submit({waitMsg:translate("loading",true),url:"/company/edit-external-payments-info/format/json",params:o,success:function(y,w){var u=w.response;var z=Ext.decode(u.responseText);if(z.success){if(c==="republicaDominicana"){if(t.getValue()&&g!==t.getValue()){var x=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,bodyStyle:"background: transparent;",title:"Activación de pagos en línea",width:455,items:[{xtype:"box",html:'<div style="margin-left: 42px; font-family: Roboto; font-style: normal; font-weight: normal; font-size: 12px; line-height: 18px; color: #808080;">Estamos validando tus datos. Un agente de VisaNet pronto<br>se pondrá en contacto contigo para activar el servicio.<br><br>Si tienes dudas escríbenos en <a href="https://www.getsoft.app/123" target="_blank">getsoft.app/123</a>.</div>'}],footer:{items:[{cls:"button main-button",text:"Entendido",margin:"0 28 0 0",handler:function(){d.enable();x.onClose=true;window.location="/configuration";x.close()}}]},listeners:{close:function(A){if(!A.onClose){d.enable();window.location="/configuration"}}}})}else{window.location="/configuration"}}else{GlobalMsg.showNotification({title:"Éxito",text:z.message,type:"success"});d.enable()}}else{var v=Ext.decode(z.cause);GlobalMsg.showErrorMessage(translate("error",true),v.message);d.enable()}},failure:function(w,v){var u=v.response;var x=Ext.decode(u.responseText);d.enable();GlobalMsg.showErrorMessage(translate("error",true),x.cause)}})}else{d.enable()}}function k(){d.disable();if(b.getForm().isValid()){var n={};var q=Ext.ComponentQuery.query("textfield[name=oldState]")[0];var p=Ext.ComponentQuery.query("textfield[name=name]")[0];var o=Ext.ComponentQuery.query("textfield[name=category]")[0];var s=Ext.ComponentQuery.query("textfield[name=phone]")[0];var m=Ext.ComponentQuery.query("textfield[name=email]")[0];var r=Ext.ComponentQuery.query("textfield[name=password]")[0];n.showNotification="no";n.externalPaymentsProvider="rappiPay";n.name=p.getValue();n.category=o.getValue();n.phone=s.getValue();n.email=m.getValue();n.password=r.getValue();b.getForm().submit({waitMsg:translate("saving",true),url:"/company/external-payments-info-rappi/format/json",params:n,success:function(w,v){var t=v.response;var x=Ext.decode(t.responseText);if(x.success){f.retrieveInfo(w,false);GlobalMsg.showNotification({title:"Éxito",text:x.message,type:"success"});d.enable()}else{var u=Ext.decode(x.cause);GlobalMsg.showErrorMessage("Error",u.message);d.enable()}},failure:function(w,v){var t=v.response;var x=Ext.decode(t.responseText);d.enable();var u="Error";if(x.causeTitle){u=x.causeTitle}GlobalMsg.showErrorMessage(u,x.cause)}})}else{d.enable()}}function l(){d.disable();if(b.getForm().isValid()){var m={};var n=Ext.ComponentQuery.query("textfield[name=oldState]")[0];var p=Ext.ComponentQuery.query("textfield[name=username]")[0];var o=Ext.ComponentQuery.query("textfield[name=pass]")[0];m.showNotification="no";m.externalPaymentsProvider="tpaga";m.oldState=n.getValue();m.username=p.getValue();m.password=o.getValue();b.getForm().submit({waitMsg:translate("saving",true),url:"/company/external-payments-info-tpaga/format/json",params:m,success:function(t,s){var q=s.response;var u=Ext.decode(q.responseText);if(u.success){GlobalMsg.showNotification({title:"Éxito",text:u.message,type:"success"});d.enable()}else{var r=Ext.decode(u.cause);GlobalMsg.showNotification({title:"Advertencia",text:r.message,type:"warning"});d.enable()}},failure:function(s,r){var q=r.response;var t=Ext.decode(q.responseText);GlobalMsg.showNotification({title:"Advertencia",text:t.cause,type:"warning"});d.enable()}})}else{d.enable()}}if(c==="colombia"&&h==="nequi"){if(j&&(Ext.isEmpty(j.identificationType)||Ext.isEmpty(j.identification))){Ext.Msg.show({title:"Configura la información de tu negocio",msg:"Para recibir pagos con Nequi debes agregar "+translate("theIdentification")+" "+translate("identification")+' de tu empresa <b><a href="edit" >aquí</a></b>.',buttons:Ext.MessageBox.OK,buttonText:{ok:"<b>Entendido</b>"},});return}Ext.Msg.show({title:"Activar pagos en línea - Nequi",msg:"Al continuar con esta operación autorizas a Nequi y a Alegra para recibir "+translate("externalPayments")+' a través del <span style="font-weight: bold;">'+j.identificationType+" "+j.identification+'</span>.<br> Si tienes dudas escríbenos en <a href="//getsoft.app/123" target="_blank">getsoft.app/123</a> <span style="font-weight: bold;"></span>',buttons:Ext.MessageBox.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(m){if(m=="ok"){e()}else{this.close()}}})}else{if(c==="colombia"&&h==="rappiPay"){k()}else{if(c==="colombia"&&h==="tpaga"){l()}else{e()}}}},saveCompanyInfo:function(k){var d=k.up("form");var o=this;var l=k.getEl().id;var e=translate("loading",true);var q=false;var g=true;if(l&&l==="modalSaveCompanyInfo"){e=translate("saving",true);q=true}var a=d.getForm().isValid();var f=Ext.ComponentQuery.query("addressField[name=addressComponent]")[0];if(f){a=a&&f.isValid()}var n=Ext.ComponentQuery.query("editableListModalComponent[name=responsabilitiesComponent]")[0];if(n){a=a&&n.isValid();if(!n.isValid()){g=false;GlobalMsg.showErrorMessage(translate("error",true),"Debes tener al menos una responsabilidad configurada para facturación electrónica.")}}if(d.configs.country==="costaRica"){var b=d.down("combo[name=economicActivity]");if(b&&b.getValue()&&b.getValue()!=""&&!b.getSelectedRecord()){b.markInvalid("Selecciona una actividad de la lista");a=false}}else{if(d.configs.country==="chile"){var b=d.down("combo[name=mainEconomicActivity]");if(a==true){a=this.verifySecondaryEconomicActivity(d)}if(b&&b.getValue()&&b.getValue()!=""&&!b.getSelectedRecord()){b.markInvalid("Selecciona una actividad de la lista");a=false}}}var m=Ext.ComponentQuery.query("combo[name=currency]")[0];var j=m.getSelectedRecord();if(j&&m.getValue()){if(a){var r={};var p=d.getFieldValuesAsMetadata();if(p){r.metadata=Ext.encode(p)}if(["costaRica","colombia","argentina","peru","mexico","chile"].indexOf(d.configs.country)!==-1){var f=d.down("addressField[name=addressComponent]");r.address=Ext.encode(f.getValues())}var c=Ext.ComponentQuery.query("filefield[name=logo]")[0];r.pngImageDataLogo=c.value;d.getForm().submit({url:"/company/edit"+(q?"/emergent/true":"")+"/format/json",params:r,waitMsg:e,submitEmptyText:false,success:function(B,v){var w=v.response;var z=Ext.decode(w.responseText);var s=d.country;if(z.success){if(!q){if(["peru","colombia","chile"].indexOf(s)!==-1&&z.electronicInovicingActivated){var t='Realizaste el primer paso para activar factura electrónica. Ahora debes configurar a BIZLINKS S.A.C. como tu PSE + OSE. <a target="_blank"  href="https://ayudas.getsoft.app/es/articles/1711460">Aquí</a> puedes ver cómo completar el proceso. Si tienes dudas contáctanos y te apoyaremos';switch(s){case"colombia":t="Para "+translate("stamp")+" documentos validos ante "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+' asegúrate haber realizado el proceso para ser facturador electrónico en <a href="https://muisca.dian.gov.co/WebArquitectura/DefLogin.faces" target="_blank">muisca.dian.gov.co</a>. Para saber más, haz <a target="_blank" href="https://ayuda.getsoft.app/habil%C3%ADtate-en-la-dian-para-ser-facturador-electr%C3%B3nico-en-colombia">'+translate("clickHere")+"</a>.";break;case"argentina":t="Alegra en alianza con LinkSide te brinda la emisión de comprobantes electrónicos. <br> Para "+translate("stamp")+" comprobantes validos ante "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+' asegúrate de haber configurado a LinkSide como tu proveedor en AFIP. Para saber más, haz <a target="_blank" href="https://ayuda.getsoft.app/emit%C3%AD-facturas-de-venta-electr%C3%B3nicas-en-alegra-argentina#asociar-proveedor">'+translate("clickHere")+"</a>.";break;case"chile":t="Alegra en alianza con Gosocket te brinda la emisión de comprobantes electrónicos. <br> Para "+translate("stamp")+" comprobantes validos ante "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+' asegúrate de haber realizado el proceso para ser facturador electrónico en <a href="http://www.sii.cl/servicios_online/1039-proc_postulacion-1184.html" target="_blank">www.sii.cl</a>.';break}if(s=="peru"){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,width:400,bodyStyle:"background: transparent",frame:false,title:"Facturación electrónica",items:[{xtype:"box",html:'<p style="padding: 0 20px; margin: 0">Realizaste el primer paso para activar factura electrónica. Ahora debes configurar a BIZLINKS S.A.C. como tu PSE + OSE. <a target="_blank"  href="https://ayudas.getsoft.app/es/articles/1711460">Aquí</a> puedes ver cómo completar el proceso. Si tienes dudas <a href="" id="openIntercomChat">contáctanos</a> y te apoyaremos</p>',}],footer:{items:[{cls:"button",text:translate("cancelAction",true),margin:"0 10 0 0",handler:function(D){this.up("window").close()}},{cls:"button main-button",text:"Entendido",margin:"0 10 0 0",handler:function(D){this.up("window").close()}}]},listeners:{afterrender:function(E){var D=document.getElementById("openIntercomChat");if(D){D.addEventListener("click",function(F){F.preventDefault();Intercom("show")})}}}})}else{Ext.Msg.show({title:"Has activado la facturación electrónica en tu cuenta",msg:t,buttons:Ext.Msg.OK,closable:false,fn:function(D){window.location="/configuration"}})}}else{window.location="/configuration"}}else{var u=Ext.ComponentQuery.query("window[reason=editCompanyInfo]")[0];if(u){u.close()}var C=Ext.getCmp("labelInvoiceCompanyName");if(C&&z.companyName){C.setText(z.companyName)}var x=Ext.getCmp("labelInvoiceCompanyIdentification");if(x){x.setText(z.companyIdentification)}var x=Ext.getCmp("labelInvoiceCompanyIdentification");if(x){x.setText(translate("identification",true)+" "+z.companyIdentification)}var y=Ext.getCmp("labelInvoiceCompanyEmail");if(y){y.setText(z.companyEmail)}if(u.stamp){o.application.fireEvent("companyEditedToStamp",u.initiator)}Ext.Msg.alert(translate("success",true),translate("theCompanyHasBeenSuccessfullyEdited",true))}}else{var A=z.title?z.title:translate("error",true);GlobalMsg.showErrorMessage(A,z.cause,"no","error")}},failure:function(u,t){var s=t.response;var v=Ext.decode(s.responseText);var w=v.title?v.title:"Error";if(q){Ext.Msg.alert(w,v.cause)}else{GlobalMsg.showErrorMessage(w,v.cause,"no","error")}}})}else{if(country=="mexico"){var h=k.up("form").down("textfield[name=exteriorNumber]");if(h.getValue()=="0"){h.markInvalid()}}if(g){GlobalMsg.showErrorMessage(translate("error",true),translate("youMustCheckTheFieldsMarkedInRedToContinue",true))}}}else{m.markInvalid(translate("youMustSelectACurrencyFromTheList",true));m.store.clearFilter();GlobalMsg.showErrorMessage(translate("error",true),translate("youMustCheckTheFieldsMarkedInRedToContinue",true))}},saveOtherTemplates:function(a){a.disable();var b=a.up("form").getForm();if(b.isValid()){b.submit({waitMsg:translate("loading",true),url:"/company/edit-other-templates/format/json",success:function(e,d){var c=d.response;var f=Ext.decode(c.responseText);if(f.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage(translate("error",true),f.cause)}},failure:function(e,d){console.log(d);var c=d.response;var f=Ext.decode(c.responseText);a.enable();GlobalMsg.showErrorMessage(translate("error",true),f.cause)}})}else{a.enable()}},saveInvoiceInfo:function(b){var c=Ext.ComponentQuery.query("company_FormInvoiceInfoEdit")[0];var d={};var a=c.getFieldValuesAsMetadata();if(a){d.metadata=Ext.encode(a)}if(c.isValid()){c.submit({waitMsg:translate("loading",true),params:d,url:"/company/edit-invoice-info/format/json",success:function(g,f){var e=f.response;var h=Ext.decode(e.responseText);if(h.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage(translate("error",true),h.cause)}},failure:function(g,f){var e=f.response;var h=Ext.decode(e.responseText);b.enable();GlobalMsg.showErrorMessage(translate("error",true),h.cause)}})}else{b.enable()}},editEmergentEvent:function(d,f,e){var b=this.application;var a=Ext.getBody().getViewSize().height;var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-edit-company-modal",reason:"editCompanyInfo",border:false,resizable:false,title:translate("editCompanyData",true),width:480,maxHeight:a-50,stamp:f,initiator:e,bodyStyle:"overflow-y: auto;",items:[{xtype:"container",id:"editWindow",items:[{xtype:"company_WindowInfoEdit",bodyPadding:0,title:"",configs:d.configs,country:d.configs.country,emergent:true,stampVersion:d.configs.stampVersion,hasCertificate:d.hasCertificate,callback:function(g){c.close()}}]},{xtype:"container",id:"windowButtonsHolder",items:[Ext.create("AL.view.buttons.SubmitReset",{buttonsConfig:{submitButtonAction:"saveCompanyInfo",submitButtonText:translate("save",true),stamp:f}})],hidden:true,},],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),cls:"button main-button",handler:function(g){var j=g.up("window");var h=j.down("button[action=saveCompanyInfo]");if(h){h.fireEvent("click",h)}},listeners:{afterrender:function(g){var j=g.up("window");var h=j.down("form");g.setDisabled(h.hasInvalidField());h.on("validitychange",function(l,k){g.setDisabled(!k)})}}}]},})},saveTemplatePdf:function(c){var e=c.up("form").getForm(),d=c.up("form"),a=d.down("button[itemId=showPreviewButton]"),f=d.resource;var b={template:d.dataPreview.template,resource:d.resource};c.disable();e.submit({url:"/company/save-print-format/format/json",params:b,waitMsg:translate("savingAction",true),success:function(j,h){var g=h.response;var k=Ext.decode(g.responseText);if(k.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage(translate("error",true),k.cause)}c.enable()},failure:function(j,h){var g=h.response;var k=Ext.decode(g.responseText);c.enable();GlobalMsg.showErrorMessage(translate("error",true),k.cause)}})},saveInvoiceTemplate:function(b){b.disable();var c=b.up("form").getForm(),a=Ext.merge(c.getValues(),{idInvoiceTemplate:c.idInvoiceTemplate});if(c.isValid()){c.submit({url:"/company/edit-invoice-template/format/json",params:a,waitMsg:translate("savingAction",true),success:function(f,e){var d=e.response;var g=Ext.decode(d.responseText);if(g.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage(translate("error",true),g.cause)}},failure:function(f,e){var d=e.response;var g=Ext.decode(d.responseText);b.enable();GlobalMsg.showErrorMessage(translate("error",true),g.cause)}})}else{b.enable()}},saveMandatoryCompanyInfo:function(b){b.disable();var g=Ext.ComponentQuery.query("button[name=handlerIncompleteInfo]")[0];g.disable();var e=b.up("form").getForm();var d=b.up("form");if(e.isValid()){var c=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];var f={};if(e.idInvoiceTemplate){f.idInvoiceTemplate=e.idInvoiceTemplate;f.idLocalInvoice=c.idLocal}if(d.configs&&["costaRica","argentina"].indexOf(d.configs.country)!==-1){var a=d.down("addressField[name=addressComponent]");f.address=Ext.encode(a.getValues())}e.submit({params:f,submitEmptyText:false,url:"/company/edit-mandatory/"+(c.resourceTrigger==="bill"?"type/bill/":"")+"format/json",waitMsg:translate("loading",true),success:function(l,j){var h=j.response;var m=Ext.decode(h.responseText);if(m.success){if(l.callback){var k=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(k){k.close()}d.callback()}else{if(b.up("form").callback){b.up("form").callback()}else{window.location="/invoice/print/id/"+d.idLocal}}}else{if(m.cause){Ext.Msg.alert(translate("error",true),m.cause)}}},failure:function(k,j){var h=j.response;var l=Ext.decode(h.responseText);if(l.cause){Ext.Msg.alert(translate("error",true),l.cause)}b.enable();g.enable()}})}else{b.enable();g.enable()}},removeFakePathWord:function(c,b){var a=Ext.DomQuery.selectNode("input[id="+c.getInputId()+"]");a.value=b.replace("C:\\fakepath\\","")},validateNumberFieldMaxValue:function(b){var e=true;var a=[];var d={};for(var c=0;c<b.length;c++){if(parseInt(b[c].getValue())>4294967295){e=false;a.push(b[c])}}d.valid=e;d.fields=a;return d},validateNumberAndPrefixMaxValue:function(a){var h=true,f=this;invalidFied=[];results={};keyName="";valAll={};prefixField="";numberField="";invoiceResolutions=Ext.ComponentQuery.query("container[name=invoiceResolution]");if(invoiceResolutions){Ext.each(invoiceResolutions,function(l){prefixField=l.down("textfield[name=invoiceResolutionPrefix]");numberField=l.down("textfield[name=invoiceResolutionNumber]");valAll=prefixField.getValue()+numberField.getValue();if(valAll.length!=19){h=false;keyName=f.convertMsg(prefixField.getFieldLabel(),"");invalidFied.push(keyName);prefixField="";numberField=""}})}delete a.invoiceResolutionNumber;delete a.invoiceResolutionPrefix;delete a.nextEstimateNumber;delete a.estimatePrefix;delete a.nextPurchaseOrderNumber;delete a.purchaseOrderPrefix;delete a.nextRemissionNumber;delete a.remissionPrefix;var d="";var k="";var b="";var c="";var j="";var e="";prefixField="";numberField="";for(var g in a){d=f.convertMsg(g,"");j=Ext.ComponentQuery.query("textfield[name="+g+"]");e=j[0].errorMsg;c=d.substring(0,1);d=d.replace(c,"");if(d==k){if(b.search("Prefix")>0){prefixField=a[b]}if(g.search("Number")>0){numberField=a[g]}if(prefixField!=null&&numberField!=null){valAll=prefixField.concat(numberField);if(valAll.length!=19||prefixField==""||numberField==""){h=false;invalidFied.push(e)}prefixField=null;numberField=null}}k=d;b=g}results.valid=h;results.fields=invalidFied;return results},convertMsg:function(d,b){var c="";var a="";a=d.replace("Number","");a=a.replace("next","");a=a.replace("Prefix","");a=a.replace(' <span class="req">*</span>',"");return a},updateDocumentPickerWithDefaultPdfTemplates:function(b){var a=Ext.getStore("PdfTemplates");b.store.each(function(d){var c=d.get("documentType");var f=a.queryBy(function(g){return g.get("documentType")==c&&g.get("companysDefault")}).items[0];var e=f.get("template");d.set("attributes",'src="https://cdn1.getsoft.app/images/pdfTemplates/'+c+"s/minified/"+e+'.png"')})},isValidSignature:function(b){if(b==null){return true}var e=b.el.getAttribute("src");if(e!=""){var a=[".png",".jpg",".jpeg"];for(var d=0;d<a.length;d++){var c=e.indexOf(a[d]);if(c!=-1){return true}}GlobalMsg.showErrorMessage(translate("error",true),"Tu firma debe ser de tipo .png, .jpg o .jpeg y de tamaño inferior a 2 MB");return false}return true},calculateDv:function(f){if(isNaN(f)||f.length>15){return}var c;var e=[3,7,13,17,19,23,29,37,41,43,47,53,59,67,71];var d=0;for(var a=0;a<f.length;a++){d+=(f[a]*e[f.length-a-1])}var b=d%11;c=[0,1].indexOf(b)!==-1?b:11-b;return(c||c==0)?c:null},getInvoiceTextDataForCountry:function(b){var a=[{label:"Factura de venta",value:"factura de venta"},{label:"Cuenta de cobro",value:"cuenta de cobro"}];switch(b){case"panama":a=[{label:"Factura de venta",value:"factura de venta"},{label:"Detalle de venta",value:"detalle de venta"}];break}return a},getDecimalPrecisionDataForCountry:function(b){var a=[{decimalPrecision:"0"},{decimalPrecision:"1"},{decimalPrecision:"2"},{decimalPrecision:"3"},{decimalPrecision:"4"}];switch(b){case"mexico":a=[{decimalPrecision:"0"},{decimalPrecision:"1"},{decimalPrecision:"2"}];break;case"costaRica":a=[{decimalPrecision:"0"},{decimalPrecision:"1"},{decimalPrecision:"2"},{decimalPrecision:"3"},{decimalPrecision:"4"},{decimalPrecision:"5"}];break}return a},getRegimeDataForCountry:function(b){var a=[{display:"Responsable del IVA",value:"Régimen común",key:"COMMON_REGIME"},{display:"No responsable del IVA",value:"Régimen simplificado",key:"SIMPLIFIED_REGIME"},{display:"Régimen simple de tributación",value:"Régimen simple de tributación",key:"SIMPLE_REGIME_OF_TAXATION"},{display:"No responsable de consumo",value:"Régimen simplificado impuesto nacional al consumo",key:"NOT_REPONSIBLE_FOR_CONSUMPTION"},{display:"Régimen especial",value:"Régimen especial",key:"SPECIAL_REGIME"}];switch(b){case"mexico":a=[{display:"Régimen asalariados",value:"Régimen asalariados",key:"SALARIED_REGIME"},{display:"Régimen honorarios (servicios profesionales)",value:"Régimen honorarios (servicios profesionales)",key:"FEES_REGIME"},{display:"Régimen actividades empresariales",value:"Régimen actividades empresariales",key:"BUSINESS_ACTIVITIES_REGIME"},{display:"Régimen de arrendamiento",value:"Régimen de arrendamiento",key:"LEASEHOLD_REGIME"},{display:"Régimen General de Ley Personas Morales",value:"Régimen General de Ley Personas Morales",key:"GENERAL_REGIME_OF_MORAL_PEOPLE_LAW"},{display:"Régimen de las Personas Morales con Fines No Lucrativos",value:"Régimen de las Personas Morales con Fines No Lucrativos",key:"REGIME_OF_MORAL_PEOPLE_NOT_PROFIT"},{display:"Régimen de Incorporación Fiscal",value:"Régimen de Incorporación Fiscal",key:"FISCAL_INCORPORATION_REGIME"},{display:"Régimen de Actividades Agrícolas, Ganaderas, Silvicolas y Pesqueras",value:"Régimen de Actividades Agrícolas, Ganaderas, Silvicolas y Pesqueras",key:"PRIMARY_SECTOR_REGIME"},{display:"Régimen de los Coordinados",value:"Régimen de los Coordinados",key:"REGIME_OF_THE_COORDINATED"}];break;case"republicaDominicana":a=[{display:"Régimen general",value:"Régimen general",key:"GENERAL_REGIME"},{display:"Régimen RST",value:"Régimen RST",key:"RST_REGIME"},{display:"Regímenes especiales de tributación",value:"Regímenes especiales de tributación",key:"SPECIAL_REGIME_OF_TAXATION"}];break;case"peru":a=[{display:"Régimen especial",value:"Régimen especial",key:"SPECIAL_REGIME"},{display:"Régimen general",value:"Régimen general",key:"GENERAL_REGIME"},{display:"Régimen MYPE tributario",value:"Régimen MYPE tributario",key:"MYPE_TRIBUTARY_REGIME"},{display:"Nuevo RUS",value:"Nuevo RUS",key:"NEW_RUS"}];break;case"spain":a=[{display:"Régimen general",value:"Régimen general",key:"GENERAL_REGIME"},{display:"Régimen simplificado",value:"Régimen simplificado",key:"SIMPLIFIED_REGIME"}];break;case"chile":a=[{display:"Renta presunta",value:"Renta presunta",key:"PRESUMED_INCOME"},{display:"Tributación simplificada",value:"Tributación simplificada",key:"SIMPLIFIED_TAXATION"},{display:"Renta atribuida",value:"Renta atribuida",key:"ATTRIBUTED_INCOME"},{display:"Semi integrado",value:"Semi integrado",key:"SEMI_INTEGRATED"},{display:"Pro pyme general",value:"Pro pyme general",key:"PRO_PYME_GENERAL"},{display:"Pro pyme transparente",value:"Pro pyme transparente",key:"PRO_PYME_TRANSPARENT"}];break;case"costaRica":a=[{display:"Régimen simplificado",value:"Régimen simplificado",key:"SIMPLIFIED_REGIME"},{display:"Régimen tradicional",value:"Régimen tradicional",key:"TRADITIONAL_REGIME"},{display:"Persona física",value:"Persona física",key:"PHYSICAL_PERSON"}];break}return a},getSubmitDataDisabled:function(){var a=this,b=null,c;if(a.submitValue&&!a.isFileUpload()){c=a.getSubmitValue();if(c!==null){b={};b[a.getName()]=c}}return b},showModalIfRegimeIsNotEnable:function(c){var b=function(){contentArea=Ext.dom.Query.select(".content-area")[0];contentArea.scrollTo(0,340)};var a=function(){modalMessage=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact"],title:"¡Que buena noticia!",bodyHtml:"Ahora podrás emitir tus facturas elecrónicas con Alegra. Es por esto, que te invitamos a actualizar tu régimen actual.",targetEl:c,offsets:[430,-13],position:"r-r",layout:"fit",positionBy:"setPosition",hidden:true,showHeader:true,showBtnClose:false,autoShow:false,closeCallback:d,footerItems:[{xtype:"button",text:"Entendido",cls:"sm-button-primary",padding:"4 18",handler:function(){d(this.up("window"))}},],dispatchShowDelayTime:600,delayAll:true,closeGroupOnClose:false,beforeDispatch:function(e){setTimeout(b,400)},});modalTarget=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact-fields"],style:{opacity:"1",},title:null,targetEl:modalMessage,position:"r-r",positionBy:"setPosition",width:350,modal:false,offsets:[-360,-5],showHeader:false,closable:false,autoShow:false,dispatchNextModalOnClose:false,items:[{xtype:"container",layout:"hbox",name:"parentCointainer",style:{padding:"15px 15px 15px 10px",},items:[{xtype:"combo",editable:false,labelWidth:60,labelPad:15,fieldLabel:translate("regime",true),width:320,},]}]});modalTarget2=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","modal-tooltip-contact-fields"],style:{opacity:"0",},title:null,targetEl:modalMessage,position:"r-r",positionBy:"setPosition",width:350,modal:false,offsets:[-360,-5],showHeader:false,closable:false,autoShow:false,dispatchNextModalOnClose:false,afterDispatch:function(f){var e=Ext.dom.Query.select(".x-mask")[0];e.style.setProperty("background-color","black","important");e.style.setProperty("opacity","0.4","important");e.style.setProperty("height","5000","important");setTimeout(function(){Ext.dom.Query.select(".app")[0].scrollBy(500,0,true);modalMessage.setNewPosition(modalMessage);modalTarget.setNewPosition(modalTarget);modalTarget2.setNewPosition(modalTarget2)},500)}});var d=function(){if(modalMessage!=null&&modalTarget!=null){modalTarget.close();modalTarget2.close();modalMessage.close()}};modalMessage.queueToShow([modalTarget,modalTarget2])};a()},changeIsActiveElectronicInvoicingValue:function(g){var c=g.up("form");var d=c.configs.country;var f=g.checked;var e=["container","fieldset","panel","addressField"];var b=function(n){Ext.each(n,function(p){var o=null;if(e.indexOf(p.xtype)!==-1){return b(p.items.items)}if(p.requires){if(p.requires.indexOf(d)!==-1){o=false}}if(p.isRequiredForElectronicInvoicing){if(p.isRequiredForElectronicInvoicing.indexOf(d)!==-1&&f){o=false}else{o=o===null?true:o}}p.allowBlank=o===null?p.allowBlank:o;if(p.countries){if(p.countriesStampValidate){if(p.countries.indexOf(d)!==-1&&f){p.show()}else{p.hide()}}else{if(p.countries.indexOf(d)!==-1){p.show()}else{p.hide()}}}})};switch(c.configs.country){case"colombia":b(c.items.items);var m=c.down("combo[name=invoiceText]");var k=c.down("fieldset[itemId=electronicInvoiceCadenaParam]");this.changeFieldsLikeRequiredWhenUbl21(c,f,c.down("combo[name=versionElectronicInvoicing]").getValue());this.showOrHideTradeName(c,c.down("combo[name=kindOfPerson]"));if(f===true){k.setDisabled(false);k.show();m.disable();m.getSubmitData=function(){var n=this;var o=null;var p;if(n.submitValue&&!n.isFileUpload()){p=n.getSubmitValue();if(p!==null){o={};o[n.getName()]=p}}return o};m.setValue("factura de venta")}else{m.enable();m.setValue("factura de venta");k.hide()}break;case"costaRica":var l=c.down("fieldset[itemId=signatureFields]"),j=c.down("fieldset[itemId=electronicInvoiceAdditionalParams]"),a=c.down("fieldset[itemId=mailInboxFields]");if(f){l.show();j.show();a.show()}else{l.hide();j.hide();a.hide()}b(c.items.items);if(c.hasCertificate=="yes"){var h=c.down("filefield[name=certificate]");keyPasswordField=c.down("textfield[name=keyPassword]");governmentEntityPassword=c.down("textfield[name=governmentEntityPassword]");h.allowBlank=true;keyPasswordField.allowBlank=true;if(c.configs&&c.configs.isActiveElectronicInvoicing){governmentEntityPassword.allowBlank=true}}break;case"argentina":b(c.items.items);break;case"chile":b(c.items.items);var l=c.down("fieldset[itemId=signatureFields]");identification=c.down("textfield[name=identification]");if(f){l.show();identification.regex=/^\d{6,8}[\-][0-9kK]$/;identification.regexText="Este campo debe tener el siguiente formato: 10545454-5 ó 154545-K"}else{l.hide();identification.regex=null;c.getForm().isValid()}if(c.hasCertificate=="yes"){var h=c.down("filefield[name=certificate]");keyPasswordField=c.down("textfield[name=keyPassword]");h.allowBlank=true;keyPasswordField.allowBlank=true}break}},changeFieldsLikeRequiredWhenUbl21:function(d,f,j){var g=d.down("textfield[name=description]");var e=d.down("panel[name=responsabilitiesPanel]");var k=d.down("editableListModalComponent[name=responsabilitiesComponent]");var h=d.down("textfield[name=testSetId]");var c=d.down("fieldset[itemId=electronicResolutionParam]");var b=d.down("fieldset[itemId=mailInboxFields]");var l=d.down("displayfield[itemId=statusDianVPField]");b.setDisabled(false);b.show();if(f===true&&j=="2.0"){b.getEl().setStyle({"margin-top":"60px"})}else{if(f===false){b.getEl().setStyle({"margin-top":"0px"})}}if(f===true&&j=="2.1"){b.getEl().setStyle({"margin-top":"5px"});g.allowBlank=false;d.down("combo[name=city]").allowBlank=false;d.down("combo[name=department]").allowBlank=false;var a=d.down("textfield[name=zipCode]");a.width=g.width;a.show();e.show();k.allowBlank=false;c.enable();c.show();h.allowBlank=false;h.enable();d.down("displayfield[id=labelNameAddress]").setFieldLabel(translate("address",true)+'<span class="req">*</span>');if(typeof d.configs.statusDianPreviousValidation!=="undefined"&&d.configs.statusDianPreviousValidation!==""){l.setFieldLabel("Estado de envío de set de pruebas: ");l.originalValue=d.configs.statusDianPreviousValidation;l.setValue(d.configs.statusDianPreviousValidation);if(d.configs.isAlegraElectronicInvoicingProvider===true&&d.configs.statusDianPreviousValidation=="No autorizado"){d.down("button[action=showModalSendSetTest]").show()}}else{l.setFieldLabel("")}}else{g.allowBlank=true;d.down("combo[name=city]").allowBlank=true;d.down("combo[name=department]").allowBlank=true;var a=d.down("textfield[name=zipCode]");a.width=g.width;a.allowBlank=true;a.hide();e.hide();k.allowBlank=true;c.disable();c.hide();h.disable();h.allowBlank=true;l.setFieldLabel("");d.down("displayfield[id=labelNameAddress]").setFieldLabel(translate("address",true))}},verifySecondaryEconomicActivity:function(a){var b=a.down("editableListComponent[name=secondaryEconomicActivity]");if(b){return b.isValid()}else{return true}},showOrHideTradeName:function(d,c){var b=d.down("checkbox[name=isActiveElectronicInvoicing]");var f=d.down("textfield[name=tradeName]"),a=d.down("displayfield[id=clientNameLabelField]"),e=d.down("nameField[name=nameComponent]");if(b.getValue()==true&&c.isVisible()&&c.getSelectedRecord()&&c.getSelectedRecord().data.id==1){e.width=430;a.setFieldLabel('Razón social<span class="req">*</span>');f.show()}else{e.width=403;a.setFieldLabel(translate("name",true)+'<span class="req">*</span>');f.hide()}},retrieveInfo:function(b){b=Ext.ComponentQuery.query("externalpayments_FormEditRappiPay")[0];var a=Ext.MessageBox.wait(translate("loading"));Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(d,g){var j=Ext.decode(d.responseText);if(j.success){var e="unregistered";var f=j.results;var c=f.paymentProviders;if(c&&c.rappipay){e=c.rappipay.state}if(e=="unregistered"){b.getForm().setValues({canReceiveExternalPayments:e==="active"?"yes":"no",name:f.name,phone:f.phone,email:f.email,oldState:e,password:""})}else{if(c.rappipay&&c.rappipay.data){var h=c.rappipay.data;b.getForm().setValues({canReceiveExternalPayments:e==="active"?"yes":"no",name:h.name,category:h.category,phone:h.phone,email:h.email,oldState:e,password:h.password})}}if(e==="active"){b.enableControls(true)}else{if(e==="pending"){fieldsetNotification=b.down("fieldset[id=fieldsetNotification]");fieldsetNotification.show();b.enableControls(false)}else{b.enableControls(false)}}}else{GlobalMsg.showErrorMessage("Error",j.cause)}a.hide()},failure:function(e,d){a.hide();var c=d.response;var f=Ext.decode(c.responseText);Ext.Msg.alert("Error",f.cause)}})}});Ext.define("AL.view.conciliation.ConciliationForm",{extend:"Ext.form.Panel",alias:"widget.conciliation_ConciliationForm",requires:["AL.view.ux.form.Month","AL.view.ux.form.GroupingComboBox"],title:"",bodyPadding:35,layout:"hbox",defaultType:"textfield",items:[{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15},items:[{xtype:"groupingcombobox",fieldLabel:"Cuenta",name:"idLocal",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"remote",typeAhead:true,store:"Accounts"},{xtype:"datefield",fieldLabel:"Fecha",name:"date",format:"d/m/Y",blankText:"Es necesario definir la fecha de emisión de la conciliación",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",value:new Date()},{xtype:"displayfield",fieldLabel:"Saldo inicial",name:"initialBalance"},{xtype:"displayfield",fieldLabel:"Tasa",name:"exchangeCurrencyDisplay",tooltip:"Indica la tasa de cambio de la moneda seleccionada a tu moneda principal",hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true}]},{xtype:"container",flex:1,defaultType:"textfield",defaults:{labelAlign:"right",labelPad:15,labelWidth:150,checkChangeBuffer:150},items:[{xtype:"fieldset",title:'<span style="font-size:12px; margin-right:17px;">Información adicional</span> ',defaultType:"textfield",padding:15,items:[{xtype:"label",text:"Agregar estos valores después de seleccionar todas las transacciones."},{fieldLabel:"Gastos bancarios",name:"accountExpenses",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal",margin:"15 0 0 0"},{fieldLabel:"Impuestos bancarios",name:"accountTaxes",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal"},{fieldLabel:"Entradas bancarias",name:"accountInterests",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal"},{fieldLabel:"Saldo final",name:"finalBalance",allowBlank:false,regex:/^-?([0-9]+(\.[0-9]+)?)$/,regexText:"Solo se admiten valores numéricos con el punto (.) como separador decimal"}]},{xtype:"displayfield",fieldLabel:"Diferencia",name:"difference",labelAlign:"left",padding:15}]}]});Ext.define("AL.controller.Conciliation",{extend:"Ext.app.Controller",views:["conciliation.ConciliationForm","conciliation.ConciliationGrid","conciliation.Buttons","ux.grid.CheckColumn"],stores:["Transactions","Accounts"],models:["Transaction","Account"],init:function(){this.control({"conciliation_ConciliationGrid checkcolumn":{checkchange:this.checkColumnChange},conciliation_ConciliationGrid:{afterrender:function(b){var a=b.getStore();a.on("load",function(){this.calculateDifference()},this)}},"conciliation_ConciliationForm combo[name=idLocal]":{render:function(e){var c=e.up("form");if(c.idLocal){var b=this;if(c.account){var a=e.getStore();var d=Ext.create("AL.model.Account",c.account);a.on("load",function(g,f,k,j){for(var h in f){if(f[h].get("idLocal")==d.get("idLocal")){e.select(f[h]);break}}b.prepareConciliation(e)});a.load()}}}},"conciliation_ConciliationForm groupingcombobox[name=idLocal]":{select:this.prepareConciliation},"conciliation_ConciliationForm textfield[name=accountExpenses]":{change:function(b,a){this.calculateDifference();this.changeDisplayExchangeRate(b,a)}},"conciliation_ConciliationForm textfield[name=accountTaxes]":{change:function(b,a){this.calculateDifference();this.changeDisplayExchangeRate(b,a)}},"conciliation_ConciliationForm textfield[name=accountInterests]":{change:function(b,a){this.calculateDifference();this.changeDisplayExchangeRate(b,a)}},"conciliation_ConciliationForm textfield[name=finalBalance]":{change:this.calculateDifference},"button[action=save]":{click:this.saveConciliation},"button[action=postpone]":{click:this.saveConciliation}})},saveConciliation:function(j){j.disable();GlobalRedirector.go({zoneTitle:"Conciliando cuenta"});var d=Ext.ComponentQuery.query("conciliation_ConciliationForm")[0],a=Ext.ComponentQuery.query("conciliation_ConciliationGrid")[0],l=a.getStore(),f=l.checkedRecords;if(!d.getForm().isValid()){GlobalMsg.showNotification({tpl:"formInvalidFields"});j.enable();GlobalRedirector.close();return}var g=[];Ext.each(f,function(o){var p={idLocal:o.get("idLocal"),conciliated:o.get("draftConciliated")};g.push(p)});var h=d.down("datefield[name=date]"),n=d.down("groupingcombobox[name=idLocal]"),k=n.findRecordByValue(n.getValue()),m=d.getValues(),e=h.getValue();delete m.date;m.realBalance=(k.get("type")==="credit-card")?AL.math.mul(-1,m.finalBalance):m.finalBalance;delete m.finalBalance;m.date=Ext.Date.format(e,"Y-m-d");m.transactions=Ext.encode(g);var c="";if(j.action=="save"){c="/conciliation/conciliate/format/json"}else{c="/conciliation/save-draft/format/json"}var b=d.down("hidden[name=exchangeCurrency]");if(b&&b.getValue()){m.exchangeRate=b.getValue()}Ext.Ajax.request({url:c,method:"POST",params:m,timeout:240000,success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){window.location="/account"}else{j.enable();GlobalRedirector.close()}},failure:function(){j.enable();GlobalRedirector.close()}})},prepareConciliation:function(g){var k=this,c=g.up("form"),d=c.down("groupingcombobox[name=idLocal]"),a=Ext.ComponentQuery.query("conciliation_ConciliationGrid")[0];if(d.getValue()){var h=d.findRecordByValue(d.getValue()),b=null,f=null,e=c.down("displayfield[name=initialBalance]");if(h){b=h.get("idLocal");f=h.get("type")}else{if(c.idLocal){b=c.idLocal;f=c.account.type}}var j=false;if(g.getName()==="idLocal"){if(a){a.idAccount=b}Ext.Ajax.request({url:"/conciliation/retrieve-conciliation/idAccount/"+b+"/format/json",success:function(r,m){var u=Ext.decode(r.responseText),q=Ext.ComponentQuery.query("textfield[name=finalBalance]")[0],v=Ext.ComponentQuery.query("textfield[name=accountExpenses]")[0],p=Ext.ComponentQuery.query("textfield[name=accountInterests]")[0],n=Ext.ComponentQuery.query("textfield[name=accountTaxes]")[0],o=Ext.ComponentQuery.query("textfield[name=date]")[0];q.setRawValue(null);v.setValue(null);p.setValue(null);n.setValue(null);o.setValue(new Date());if(u.success){if(u.results){var t=u.results;q.setValue(t.realBalance);v.setValue(t.accountExpenses);p.setValue(t.accountInterests);n.setValue(t.accountTaxes);o.setValue(t.date)}if(u.postponedTransactions){var l=Ext.ComponentQuery.query("conciliation_ConciliationGrid")[0],w=l.getStore();w.checkedRecords=[];for(var s in u.postponedTransactions){w.checkedRecords.push(new AL.model.Transaction(u.postponedTransactions[s]))}if(j){k.checkRecordsPreviuslyChecked(w,w.getRange())}}}},failure:function(){}})}Ext.Ajax.request({url:"/account/retrieve-conciliation-balance/id/"+b+"/format/json",timeout:240000,success:function(m,p){var q=Ext.decode(m.responseText);if(q.success){e.setValue(Ext.util.Format.usMoney(AL.math.approx(q.results,null,2),2,h.get("currencySymbol")));e.actualValue=(f==="credit-card")?AL.math.mul(-1,q.results):parseFloat(q.results);var o=Ext.ComponentQuery.query("conciliation_ConciliationGrid")[0],l=o.getStore(),n=l.getProxy();n.url="/account/retrieve-conciliation-transactions/id/"+b+"/format/json";l.remoteSort=true;if(!l.checkedRecords){l.checkedRecords=[]}l.removeListener("load",k.checkRecordsPreviuslyChecked,k);l.addListener("load",k.checkRecordsPreviuslyChecked,k);l.load({callback:function(){j=true}})}},failure:function(){}})}},checkRecordsPreviuslyChecked:function(b,a){for(var d in a){var e=false;for(var c in b.checkedRecords){if(b.checkedRecords[c].get("idLocal")===a[d].get("idLocal")){e=true;if(!a[d].get("draftConciliated")){a[d].set("draftConciliated",true);b.checkedRecords[c]=a[d]}break}}if(e===false){a[d].set("draftConciliated",false)}}},checkColumnChange:function(g,c,e){var b=g.up("conciliation_ConciliationGrid").getStore();var a=b.getAt(c);var f={idLocal:a.get("idLocal"),conciliated:a.get("draftConciliated")};if(e){b.checkedRecords.push(a)}else{for(var d in b.checkedRecords){if(b.checkedRecords[d].get("idLocal")===f.idLocal){b.checkedRecords.splice(d,1);break}}}this.calculateDifference()},calculateDifference:function(){var c=Ext.ComponentQuery.query("conciliation_ConciliationForm")[0],w=c.down("groupingcombobox[name=idLocal]"),u=Ext.ComponentQuery.query("displayfield[name=initialBalance]")[0],d=c.down("textfield[name=accountExpenses]"),g=c.down("textfield[name=accountTaxes]"),q=c.down("textfield[name=accountInterests]"),p=c.down("textfield[name=finalBalance]"),o=c.down("displayfield[name=difference]");if(p.getValue()&&u.getValue()){var e=w.findRecordByValue(w.getValue()),f=e.get("type"),n=parseFloat(u.actualValue),t=(d.getValue())?AL.math.approx(parseFloat(d.getValue()),null,2):0,k=(g.getValue())?AL.math.approx(parseFloat(g.getValue()),null,2):0,j=(q.getValue())?AL.math.approx(parseFloat(q.getValue()),null,2):0,b=Ext.ComponentQuery.query("button[action=save]")[0],l=parseFloat(p.getValue()),a=Ext.ComponentQuery.query("conciliation_ConciliationGrid")[0],h=a.getStore(),r=h.checkedRecords,x=AL.math.sub(AL.math.add(n,j),AL.math.add(t,k));Ext.each(r,function(y){if(y.get("draftConciliated")){if(y.get("type")==="in"){x=AL.math.approx(AL.math.add(x,y.get("amount")),null,4)}else{if(y.get("type")==="out"){x=AL.math.approx(AL.math.sub(x,y.get("amount")),null,4)}}}});var v=(f==="credit-card")?AL.math.add(x,l):AL.math.sub(AL.math.approx(x,null,4),AL.math.approx(l,null,4));v=AL.math.approx(v,null,4);var s=2;var m=v.toString().split(".");if(m.length>1&&m[1].length>2){s=4;v=(Math.abs(v)<0.0001)?0:v}else{v=(Math.abs(v)<0.01)?0:v}o.setValue(Ext.util.Format.usMoney(AL.math.approx(v,null,4),s,e.get("currencySymbol")));if(AL.math.comp(v,0)==0){b.enable()}else{b.disable()}}else{o.setValue(null)}},changeDisplayExchangeRate:function(j,a){var h=this.application,b=j.up("form"),l=b.down("displayfield[name=exchangeCurrencyDisplay]"),g=b.down("hidden[name=exchangeCurrency]");if(a){if(l.hidden){var k=b.down("combo[name=idLocal]"),e=k.getSelectedRecord();if(e&&e.get("currencyCode")){l.show();l.setValue("1 "+e.get("currencyCode")+" = "+Ext.util.Format.round(e.get("currentExchangeRate"),8)+" "+b.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');g.setValue(Ext.util.Format.round(e.get("currentExchangeRate"),8));var d=Ext.get("editExchangeRate");if(d){d.on("click",function(m){m.preventDefault();h.fireEvent("editExchangeRate",{currency:e.get("currencyCode"),initiator:l})})}}}}else{var f=b.down("textfield[name=accountTaxes]"),c=b.down("textfield[name=accountExpenses]");if(!f.getValue()&&!c.getValue()){l.hide();g.setValue(null)}}}});Ext.define("AL.view.creditnote.FormAddCreditNote",{extend:"Ext.form.Panel",alias:"widget.creditnote_FormAddCreditNote",requires:["AL.view.ux.form.GroupingComboBox","AL.view.ux.fields.Numeration","AL.view.ux.form.Switch"],style:"margin-bottom:10px",title:"",bodyPadding:30,anchor:100,layout:"hbox",defaults:{msgTarget:"side"},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",name:"containerLeft",flex:1,defaults:{labelAlign:"right",labelPad:15,width:400,labelWidth:120},items:[{xtype:"switch",name:"affectedDocumentType",hidden:true,label:{text:translate("creditNote",true)+" "+translate("to"),style:"padding-left: 14px;"},options:[{id:"invoice",value:"invoice",text:translate("invoice",true),checked:true},{id:"saleTicket",value:"saleTicket",text:translate("saleTicket",true)},]},{xtype:"numerationField",name:"numerationComponent",configs:{documentType:"creditNote",labelPad:15,fieldWidth:400,labelWidth:120,parent:"creditnote_FormAddCreditNote"},width:400},{xtype:"combo",fieldLabel:translate("clientA",true),name:"idClient",triggerAction:"all",allowBlank:false,store:"Clients",emptyText:translate("search",true),displayField:"name",valueField:"idLocal",id:"creditnoteClientCombo",minChars:0,msgTarget:"side",matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"textarea",fieldLabel:"Motivo",name:"emissionCause",allowBlank:true,maxLength:250,hidden:true,countries:["peru","costaRica"],isRequiredForElectronicInvoicing:["peru","costaRica"]},{xtype:"textarea",fieldLabel:translate("notes",true),name:"anotation",allowBlank:true,tooltip:translate("visibleInDocumentPrinting",true)},{xtype:"container",name:"advancedOptionsContainer",allowBlank:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:1025,items:[{xtype:"label",html:'<span id="advancedOptionsLink" href="#">'+translate("moreOptions",true)+"</span>"},{xtype:"creditnote_FormAdvancedOptions",hidden:true}]}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,width:380,labelWidth:150},items:[{xtype:"combo",name:"creditNoteType",emptyText:"Seleccionar",allowBlank:true,fieldLabel:"Tipo de "+translate("creditNote"),store:"CreditNoteTypes",valueField:"key",displayField:"value",queryMode:"local",editable:false,hidden:true,isRequiredForElectronicInvoicing:["colombia","costaRica","peru","chile"],countries:["colombia","costaRica","peru","chile"]},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDate",true),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",id:"creditnoteDateDatefield"},{xtype:"combo",name:"saleCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("condition",true),store:"SaleConditions",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["costaRica","argentina"],isRequiredForElectronicInvoicing:["costaRica","argentina"],hidden:true},{xtype:"combo",name:"paymentMethod",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("paymentMethod",true),store:"PaymentMethods",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"],hidden:true},{xtype:"combo",name:"paymentForm",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("paymentType",true),store:"PaymentForm",valueField:"id",displayField:"value",editable:false,hidden:true,isRequiredForElectronicInvoicing:["chile"],countries:["chile"]},{xtype:"datefield",fieldLabel:translate("due",true),name:"dueDate",allowBlank:true,hidden:true,minValue:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineADateWhen",true)+" "+translate("theCreditNote")+" "+translate("creditNote")+" "+translate("expiresItself"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",countries:["costaRica","argentina","chile"],requires:["costaRica"],},{xtype:"combo",fieldLabel:translate("concept",true),name:"saleConcept",tooltip:translate("indicatesTheConceptOfTheAssociatedInvoice",true),emptyText:translate("selectSimple",true),allowBlank:true,hidden:true,store:"SalesConcepts",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["argentina"],isRequiredForElectronicInvoicing:["argentina"],},{xtype:"datefield",fieldLabel:translate("serviceStartDate",true),name:"startDateService",tooltip:translate("indicatesTheDateWhenTheServiceWasStarted",true),allowBlank:true,format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",hidden:true},{xtype:"datefield",fieldLabel:translate("serviceEndDate",true),name:"endDateService",tooltip:translate("indicatesTheDateWhenTheServiceWasCompleted",true),allowBlank:true,format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",hidden:true},{xtype:"combo",name:"mx_creditNoteType",fieldLabel:translate("type",true),displayField:"name",valueField:"code",store:"CreditNoteTypesMx",editable:false,labelAlign:"right",queryMode:"local",emptyText:translate("selectSimple",true),labelPad:15,allowBlank:true,hidden:true,matchFieldWidth:false,listConfig:{width:350}},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("invoice"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"combo",name:"economicActivity",emptyText:translate("selectSimple",true),fieldLabel:translate("economicActivity",true),allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",queryMode:"remote",queryParam:"queryByIdAndValue",displayTpl:'<tpl for=".">{id} - {value}</tpl>',forceSelection:true,autoSelect:false,minChars:1,listConfig:{width:300,loadingText:translate("searching",true),emptyText:'<div style="padding:10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",getInnerTpl:function(){return"{id} - {value}"}},countries:["costaRica","chile"],isRequiredForElectronicInvoicing:["costaRica","chile"],tooltip:translate("selectYourEconomicActivityRelatedToWhatYouAreSelling",true)},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,forceSelection:true,listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},}]}],listeners:{afterrender:function(d,c){if(d.configs.country&&d.configs.country==="mexico"&&d.configs.stampVersion!="3.3"){var b=this.down("container[name=containerLeft]"),a={xtype:"panel",id:"paymentMethodContainer",layout:"hbox",border:false,width:430,style:" margin-bottom: 8px;",items:[{xtype:"combo",name:"paymentMethod",fieldLabel:translate("paymentMethod",true),valueField:"paymentMethod",displayField:"display",allowBlank:false,forceSelection:true,value:"cash",labelAlign:"right",labelPad:15,width:260,labelWidth:120,queryMode:"local",matchFieldWidth:false,store:Ext.create("AL.store.DocumentPaymentMethods",{country:d.configs.country}),listeners:{change:function(g){var f=g.up("form");var h=f.down("textfield[name=accountNumber]");var e=g.getValue();if(e!="cash"&&e!="other"&&e!="not-applicable"){h.enable()}else{h.disable();h.setValue(null)}}}},{xtype:"textfield",name:"accountNumber",emptyText:translate("accountNumber",true),style:"margin-left:15px",width:125,tooltip:translate("enterTheLastFourNumbersOfTheAccountOrCardHere",true),hideLabel:true,disabled:true,minLength:4}]};b.add(a)}}},getFieldValuesAsMetadata:function(){var j=null;var k=this.configs&&this.configs.country?this.configs.country:null;switch(k){case"costaRica":var f=this.down("combo[name=creditNoteType]"),h=this.down("textarea[name=emissionCause]"),n=this.down("combo[name=saleCondition]"),d=this.down("combo[name=paymentMethod]"),a=this.down("combo[name=economicActivity]");j={saleCondition:n.getValue(),type:f.getValue(),cause:h.getValue(),paymentMethod:d.getValue(),economicActivity:a.getValue(),};break;case"argentina":var c=this.down("combo[name=saleConcept]"),g=this.down("datefield[name=startDateService]"),m=this.down("datefield[name=endDateService]"),n=this.down("combo[name=saleCondition]"),l=this.down("datefield[name=dueDate]");j={saleConcept:c.getValue(),saleCondition:n.getValue(),dueDate:Ext.Date.format(l.getValue(),"Y-m-d"),startDateService:Ext.Date.format(g.getValue(),"Y-m-d"),endDateService:Ext.Date.format(m.getValue(),"Y-m-d"),};break;case"peru":var f=this.down("combo[name=creditNoteType]"),h=this.down("textarea[name=emissionCause]");j={type:f.getValue(),cause:h.getValue(),};break;case"colombia":var f=this.down("combo[name=creditNoteType]");var b=this.down("textarea[name=emissionCause]");j={cause:b.getValue(),type:f.getValue(),};break;case"chile":var e=this.down("combo[name=paymentForm]"),a=this.down("combo[name=economicActivity]");l=this.down("datefield[name=dueDate]");f=this.down("combo[name=creditNoteType]");j={type:f.getValue(),paymentForm:e.getValue(),economicActivity:a.getValue(),dueDate:Ext.Date.format(l.getValue(),"Y-m-d"),};break;case"mexico":var f=this.down("combo[name=mx_creditNoteType]");j={type:f.getValue(),};break}return j},setFieldValuesFromMetadata:function(j){var k=this.configs&&this.configs.country?this.configs.country:null;switch(k){case"costaRica":if(typeof j.saleCondition!=="undefined"){var o=this.down("combo[name=saleCondition]");var n=o.getStore();if(n.hasLoaded()){o.setValue(j.saleCondition)}else{n.on("load",function(p){o.setValue(j.saleCondition)})}}if(typeof j.paymentMethod!=="undefined"){var d=this.down("combo[name=paymentMethod]");var n=d.getStore();if(n.hasLoaded()){d.setValue(j.paymentMethod)}else{n.on("load",function(p){d.setValue(j.paymentMethod)})}}if(typeof j.type!=="undefined"){var f=this.down("combo[name=creditNoteType]");var n=f.getStore();if(n.hasLoaded()){f.setValue(j.type)}else{n.on("load",function(p){f.setValue(j.type)})}}if(typeof j.cause!=="undefined"){var h=this.down("textarea[name=emissionCause]");h.setValue(j.cause)}if(typeof j.economicActivity!=="undefined"){var a=this.down("combo[name=economicActivity]");var n=a.getStore();if(n.hasLoaded()){a.setValue(j.economicActivity)}else{n.on("load",function(p){a.setValue(j.economicActivity)})}}break;case"argentina":if(typeof j.saleCondition!=="undefined"){var o=this.down("combo[name=saleCondition]");var n=o.getStore();if(n.hasLoaded()){o.setValue(j.saleCondition)}else{n.on("load",function(p){o.setValue(j.saleCondition)})}}if(typeof j.saleConcept!=="undefined"){var c=this.down("combo[name=saleConcept]");var n=c.getStore();if(n.hasLoaded()){c.setValue(j.saleConcept)}else{n.on("load",function(p){c.setValue(j.saleConcept)})}}if(typeof j.dueDate!=="undefined"&&j.dueDate!=""){var m=this.down("datefield[name=dueDate]");m.setValue(j.dueDate)}if(typeof j.startDateService!=="undefined"&&j.startDateService!=""){var g=this.down("datefield[name=startDateService]");g.setValue(j.startDateService)}if(typeof j.endDateService!=="undefined"&&j.startDateService!=""){var l=this.down("datefield[name=endDateService]");l.setValue(j.endDateService)}break;case"peru":if(typeof j.type!=="undefined"){var f=this.down("combo[name=creditNoteType]");var n=f.getStore();if(n.hasLoaded()){f.setValue(j.type)}else{n.on("load",function(p){f.setValue(j.type)})}}if(typeof j.cause!=="undefined"){var h=this.down("textarea[name=emissionCause]");h.setValue(j.cause)}break;case"colombia":if(typeof j.cause!=="undefined"){var b=this.down("textarea[name=emissionCause]");b.setValue(j.cause)}if(typeof j.type!=="undefined"){var f=this.down("combo[name=creditNoteType]");var n=f.getStore();if(n.hasLoaded()){f.setValue(j.type)}else{n.on("load",function(p){f.setValue(j.type)})}}break;case"chile":if(typeof j.paymentForm!=="undefined"){var e=this.down("combo[name=paymentForm]");var n=e.getStore();if(n.hasLoaded()){e.setValue(j.paymentForm)}else{n.on("load",function(p){e.setValue(j.paymentForm)})}}if(typeof j.type!=="undefined"){var f=this.down("combo[name=creditNoteType]");var n=f.getStore();if(n.hasLoaded()){f.setValue(j.type)}else{n.on("load",function(p){f.setValue(j.type)})}}if(typeof j.dueDate!=="undefined"&&j.dueDate!=""){var m=this.down("datefield[name=dueDate]");m.setValue(j.dueDate)}if(typeof j.economicActivity!=="undefined"){var a=this.down("combo[name=economicActivity]");var n=a.getStore();if(n.hasLoaded()){a.setValue(j.economicActivity)}else{n.on("load",function(p){a.setValue(j.economicActivity)})}}break}},});Ext.define("AL.view.creditnote.FormAssociations",{extend:"Ext.tab.Panel",activeTab:0,alias:"widget.creditnote_FormAssociations",requires:["AL.view.ux.form.GroupingComboBox"],style:"margin-bottom:10px",bodyPadding:30,anchor:100,defaults:{msgTarget:"side"},plain:true,items:[{title:'<div id="creditNoteAddRefundTab">'+translate("theresMoneyBack",true)+"</div>",contents:"clientRefunds",listeners:{activate:function(){var b=this.up("tabpanel");var a=Ext.get("addRefund");a.removeAllListeners();a.on("click",function(c){c.preventDefault();b.fireEvent("addAnotherRefund",{tabPanel:b})})}},items:[{xtype:"box",id:"refundHeaders",style:"background:#eee;height:24px;",html:'<table class="headersTable"><tr><td class="tbDate">'+translate("date",true)+'</td><td class="tbAccount">'+translate("bankAccount",true)+'</td><td class="tbAmount">'+translate("amount",true)+'</td><td class="tbObservations">'+translate("observations",true)+"</td></tr></table>"},{xtype:"container",id:"refundContainer",items:[]},{xtype:"box",html:'<a href="#" id="addRefund">'+translate("add",true)+" "+translate("moneyBack")+"</a>"}]},{title:'<div id="creditNoteAddInvoiceCreditTab">'+translate("creditTo",true)+" "+translate("invoice")+"</div>",contents:"creditInvoices",listeners:{activate:function(){var b=this.up("tabpanel");var a=Ext.get("addInvoice");a.removeAllListeners();a.on("click",function(c){c.preventDefault();b.fireEvent("addAnotherInvoice",{tabPanel:b})})}},items:[{xtype:"box",id:"invoiceHeaders",style:"background: #eee; height: 24px;",html:'<table class="headersTable"><tr><td class="tbInvoice" id="tbInvoice">'+translate("invoice",true)+'</td><td class="tbDate">'+translate("date",true)+'</td><td class="tbDate">'+translate("due",true)+'</td><td class="tbObservations">'+translate("observations",true)+'</td><td class="tbAmount">Total</td><td class="tbAmount">'+translate("collected",true)+'</td><td class="tbAmount">'+translate("toCollect",true)+'</td><td class="tbAmountInput">'+translate("amount",true)+"</td></tr></table>",listeners:{afterrender:function(){var b=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(b&&b.configs.country==="costaRica"){var a=Ext.get("tbInvoice");if(a){a.setHTML("Comprobante")}}}}},{xtype:"container",id:"invoiceContainer",items:[]},{xtype:"box",id:"linkAddInvoice",html:'<a href="#" id="addInvoice">'+translate("add",true)+" "+translate("invoice")+"</a>",listeners:{afterrender:function(){var b=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(b&&b.configs.country==="costaRica"){var a=Ext.get("addInvoice");if(a){a.setHTML("Agregar comprobante")}}}}}]}]});Ext.define("AL.view.creditnote.FormAddRefund",{extend:"Ext.form.Panel",alias:"widget.creditnote_FormAddRefund",requires:["AL.view.ux.form.GroupingComboBox"],bodyPadding:"18 5 10 5",border:false,style:"border-bottom: 1px solid #eee; padding-top: 0px;",layout:"hbox",defaults:{cls:"refundInput",anchor:"100%",msgTarget:"side"},items:[{xtype:"datefield",name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",emptyText:translate("date",true),width:140},{xtype:"groupingcombobox",width:190,name:"idAccount",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts",emptyText:translate("account",true),hidden:false,disabled:false,editable:false,},{xtype:"container",layout:"vbox",width:170,defaults:{labelWidth:25,labelStyle:"color: #808080;",labelPad:5},items:[{xtype:"textfield",name:"amount",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",allowBlank:false,emptyText:translate("amount",true),disabled:false,hidden:false},{xtype:"displayfield",hidden:true,name:"currencyDisplay",fieldLabel:"",cls:"currencyAmount",style:"color: #808080 !important;"}]},{xtype:"textarea",name:"observations",emptyText:translate("observations",true),width:200},{xtype:"button",action:"deleteRefund",width:16,height:16,style:"margin-left: 30px",baseCls:"none"},{xtype:"hiddenfield",name:"isConciliated"}]});Ext.define("AL.view.debitnote.FormAddDebitNote",{extend:"Ext.form.Panel",alias:"widget.debitnote_FormAddDebitNote",requires:["AL.view.ux.form.GroupingComboBox","AL.view.ux.fields.Numeration"],style:"margin-bottom: 10px;",title:"",bodyPadding:30,anchor:100,layout:"hbox",defaults:{msgTarget:"side"},defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"container",flex:1,items:[{labelPad:15,labelAlign:"right",fieldLabel:translate("numeration",true),xtype:"textfield",name:"number",emptyText:translate("numeration",true),allowBlank:true,width:400,hidden:true},{xtype:"numerationField",name:"numerationComponent",configs:{documentType:"debitNote",labelPad:15,fieldWidth:400,labelWidth:100,parent:"debitnote_FormAddDebitNote"},width:400},{xtype:"combo",fieldLabel:translate("supplier",true),name:"idClient",triggerAction:"all",allowBlank:false,store:"Clients",width:400,emptyText:translate("search",true),displayField:"name",valueField:"idLocal",id:"debitnoteClientCombo",minChars:0,labelAlign:"right",msgTarget:"side",labelPad:15,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("new",true)+" "+translate("client")+"</a></div>",width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"textarea",labelAlign:"right",fieldLabel:"Observaciones",name:"observations",id:"debitnoteObservationsTextarea",width:400,labelPad:15,allowBlank:true,hidden:true}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,width:350,labelWidth:150},items:[{xtype:"datefield",fieldLabel:translate("date",true),name:"date",width:300,allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",id:"debitnoteDateDatefield"},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("bill"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:300},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,width:300,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,width:300,forceSelection:true,listConfig:{width:300,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},},]}]});Ext.define("AL.view.debitnote.FormAssociations",{extend:"Ext.tab.Panel",activeTab:0,alias:"widget.debitnote_FormAssociations",requires:["AL.view.ux.form.GroupingComboBox"],style:"margin-bottom:10px;",bodyPadding:30,anchor:100,defaults:{msgTarget:"side"},plain:true,items:[{title:'<div id="debitNoteAddRefundTab">'+translate("theresMoneyBack",true)+"</div>",contents:"clientRefundsDebit",listeners:{activate:function(){var b=this.up("tabpanel");var a=Ext.get("addRefund");a.removeAllListeners();a.on("click",function(c){c.preventDefault();b.fireEvent("addAnotherRefund",{tabPanel:b})})}},items:[{xtype:"box",id:"refundHeaders",style:"background:#eee;height:24px;",html:'<table class="headersTable"><tr><td class="tbDate">'+translate("date",true)+'</td><td class="tbAccount">'+translate("bankAccount",true)+'</td><td class="tbAmount">'+translate("amount",true)+'</td><td class="tbObservations">'+translate("observations",true)+"</td></tr></table>"},{xtype:"container",id:"refundContainer",items:[]},{xtype:"box",html:'<a href="#" id="addRefund">'+translate("add",true)+" "+translate("moneyBack")+"</a>"}]},{title:translate("debitTo",true)+" "+translate("bill"),contents:"debitBills",listeners:{activate:function(){var b=this.up("tabpanel");var a=Ext.get("addBill");a.removeAllListeners();a.on("click",function(c){c.preventDefault();b.fireEvent("addAnotherBill",{tabPanel:b})})}},items:[{xtype:"box",id:"billsHeaders",style:"background:#eee;height:24px;",html:'<table class="headersTable"><tr><td class="tbNumbr">'+translate("bill",true)+'</td><td class="tbAmount">Total</td><td class="tbPayed">'+translate("amountPaid",true)+'</td><td class="tbMissingAmount">'+translate("missingAmount",true)+'</td><td class="tbToPay">'+translate("amount",true)+"</td></tr></table>"},{xtype:"container",id:"billContainer",items:[]},{xtype:"box",id:"linkAddBill",html:'<a href="#" id="addBill">'+translate("add",true)+" "+translate("bill")+"</a>"}]}]});Ext.define("AL.view.debitnote.FormAddRefund",{extend:"Ext.form.Panel",alias:"widget.debitnote_FormAddRefund",requires:["AL.view.ux.form.GroupingComboBox"],bodyPadding:5,border:false,style:"border-bottom: 1px solid #eee; padding-top: 5px",layout:"hbox",defaults:{anchor:"100%",msgTarget:"side",cls:"refundInput"},items:[{xtype:"datefield",name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}",emptyText:translate("date",true)},{xtype:"groupingcombobox",width:200,name:"idAccount",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts",blankText:translate("itIsNecessaryToSpecifyTheAccountFromWhichMoneyComesOut",true),emptyText:translate("account",true),hidden:false,disabled:false,editable:false,},{xtype:"container",layout:"vbox",width:170,defaults:{labelWidth:25,labelStyle:"color: #808080;",labelPad:5},items:[{xtype:"textfield",name:"amount",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",allowBlank:false,emptyText:translate("amount",true),disabled:false,hidden:false},{xtype:"displayfield",hidden:true,name:"currencyDisplay",fieldLabel:"",cls:"currencyAmount",style:"color: #808080 !important;"}]},{xtype:"textarea",name:"observations",emptyText:translate("observations",true),width:200},{xtype:"button",action:"deleteRefund",width:16,height:16,style:"margin-left: 20px",baseCls:"none"}]});Ext.define("AL.view.item.FormAdd",{extend:"Ext.form.Panel",alias:"widget.item_FormAdd",requires:["AL.view.ux.form.GroupingComboBox"],style:"margin-bottom:10px; box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.1); border-radius: 5px;",title:"Agregar ítem",layout:"vbox",defaultType:"textfield",items:[{xtype:"hidden",name:"idLocal",allowBlank:false},{xtype:"container",name:"topContainer",layout:"hbox",items:[{xtype:"container",name:"leftContainer",flex:33,padding:"10 30",minHeight:350,border:"0 1 0 0",style:{borderColor:"#EAEAEA",borderStyle:"solid"},defaults:{labelAlign:"top",labelStyle:"margin: 0px 0px 4px 0px !important;",width:260,msgTarget:"side",margin:"15px 0px 0px 0px"},items:[{xtype:"textfield",fieldLabel:translate("itemName",true),name:"name",id:"itemNameTextField",allowBlank:false},{xtype:"panel",itemId:"pricePanel",layout:"vbox",border:false,width:280,items:[{xtype:"textfield",fieldLabel:translate("salePrice",true),name:"price",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),id:"itemPriceTextField",labelAlign:"top",msgTarget:"side",labelStyle:"margin: 0px 0px 4px 0px !important;",width:260,listeners:{change:function(a){var b=Ext.ComponentQuery.query("item_FormAddPriceList");Ext.each(b,function(g){var f=g.down("combo");if(f.getValue()){var h=f.getSelectedRecord();if(h){if(h.get("dependent")&&h.get("dependent")=="yes"){var k=g.down("textfield[name=priceListText]");var j=AL.math.approx(AL.math.sub(a.getValue(),AL.math.mul(a.getValue(),AL.math.div(h.get("percentage"),100))));k.setValue(j)}}}});var d=a.up("form");var c=d.getPriceWithTaxes(a,null,d);var e=d.down("box[name=priceLabel]");if(e){e.update('<span class="is-pulled-left">'+Ext.util.Format.usMoney(c)+'</span><span class="is-pulled-right has-text-right item-price-form-currency">'+d.currency+"</span>")}}}},{xtype:"label",id:"usePriceList",itemId:"usePriceList",name:"usePriceList",width:260,style:"font-size: 12px; text-align: right;right: auto;left: 0px;z-index: 100000;",html:'<a href="#" style="color:#999; line-height: 24px" id="usePriceList">'+translate("usePriceList",true)+"</a>"}]},{xtype:"combo",fieldLabel:translate("tax",true),name:"idTax",labelStyle:"margin: -15px 0px 4px 0px !important;",allowBlank:false,store:"Taxes",labelWidth:100,displayField:"name",valueField:"idLocal",id:"itemTaxCombo",queryMode:"local",forceSelection:true,matchFieldWidth:false,margin:"0px 0px 0px 0px",displayTpl:'<tpl for=".">{name} - ({[AL.math.approx(values.tax, null, 2)]}%)</tpl>',listConfig:{width:200,height:200,border:true,tpl:'<tpl for="."><div class="x-boundlist-item">{name} - ({[AL.math.approx(values.tax, null, 2)]}%)</div></tpl>'},editable:false,},{xtype:"radiogroup",name:"itemType",fieldLabel:translate("typeOf",true)+" "+translate("item"),labelWidth:100,margin:"15px 0px 0px 0px",defaultType:"radiofield",items:[{boxLabel:"Simple",name:"itemType",inputValue:"simple",checked:true},{boxLabel:translate("compositeItem",true),name:"itemType",inputValue:"kit",}],afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -321px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" ><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("indicateIfYourItemIsComposedOfOtherItems",true)+".</div></div></div></div>"},{xtype:"checkbox",name:"isInventariable",labelAlign:"right",labelPad:5,margin:"10px 0px 0px 0px",boxLabel:translate("inventoryItem",true),inputValue:"yes",id:"itemIsInventariableCheckBox",width:180,tooltip:translate("theyAreItemToWhichYouTakeControl",true)+".",listeners:{change:function(e,f,b,c){var d=e.up("form");var a=d.down("fieldset[name=inventoryFieldset]");if(f){a.show();a.enable()}else{a.hide();a.disable()}}}},{xtype:"combo",name:"kitIdWarehouse",fieldLabel:translate("warehouse",true),store:"WarehouseCombo",margin:"10px 0px 0px 0px",valueField:"idLocal",displayField:"name",editable:false,allowBlank:true,emptyText:translate("selectSimple",true),width:126,queryMode:"local",padding:"0px 12px 0px 0px",hidden:true,cls:"kitIdWarehouse",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'},afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -319px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("selectTheWarehouseYouWantToAssociateWithYour",true)+" "+translate("compositeItem")+".</div></div></div></div>"}]},{xtype:"container",flex:1,name:"middlecontainer",margin:"0 0 0 -1",flex:33,padding:"10 30",minHeight:334,defaults:{labelAlign:"top",msgTarget:"side",width:260,labelStyle:"margin: 0px 0px 4px 0px !important;",margin:"15px 0px 0px 0px"},border:"0 0 0 1",style:{borderColor:"#EAEAEA",borderStyle:"solid"},items:[{xtype:"combo",name:"referenceType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:translate("typeOf",true)+" "+translate("reference"),store:"ReferenceTypes",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,hidden:true,countries:["costaRica"]},{xtype:"textfield",fieldLabel:translate("reference",true),name:"reference",maxLengthText:translate("thisValueCannotContainMoreThan",true)+" 12 "+translate("characters",true),id:"itemReferenceTextField",allowBlank:true,},{xtype:"combo",name:"idItemCategory",emptyText:translate("selectSimple",true),fieldLabel:translate("categoryItem",true),store:"ItemCategories",displayField:"name",valueField:"idLocal",minChars:0,queryMode:"remote",afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -314px !important; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -245px; top: -66px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("toKnowMoreAboutItemCategories",true)+' <a target="_blank" href="https://ayudas.getsoft.app/es/articles/3660541">'+translate("clickHere")+"<a>.</div></div></div></div>",listConfig:{width:200,height:200,border:true,emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list",tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewItemCategory" class="setupCategories">'+translate("newCategoryItem",true)+"</a></div>"},listeners:{beforerender:function(b){var a=new Ext.util.Filter({filterFn:function(c){return c.data.status=="active"}});b.getStore().addFilter(a)}}},{xtype:"textfield",name:"tariffHeading",allowBlank:true,fieldLabel:"Partida arancelaria",forceSelection:true,regex:/^\w{12,12}$/,regexText:"La partida arancelaría debe contener 12 caracteres",queryMode:"local",editable:false,msgTarget:"side",hidden:true,countries:["costaRica"],afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -314px !important; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -245px; top: -66px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">De uso exclusivo para exportadores en la venta de mercancías.</div></div></div></div>',},{xtype:"container",name:"customFields",width:260,margin:"0px 0px 0px 0px",defaults:{labelAlign:"top",msgTarget:"side",width:260,margin:"15px 0px 0px 0px",labelStyle:"margin: 0px 0px 4px 0px !important;",},},{xtype:"textfield",fieldLabel:translate("productKey",true),name:"productKey",maxLength:8,maxLengthText:"Este valor no puede contener más de 8 caracteres",minLength:8,minLengthText:"Este valor no puede contener menos de 8 caracteres",id:"productKeyTextField",allowBlank:true,hidden:true,countries:["peru"]},{xtype:"combo",fieldLabel:translate("productKey",true),name:"productKey",triggerAction:"all",allowBlank:true,hidden:true,store:"ProductKeys",emptyText:"Buscar...",displayField:"keyAndName",valueField:"key",id:"productKeyCombo",minChars:0,blankText:"Debes seleccionar una clave del catálogo de claves",msgTarget:"side",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{key} - {name}</div></tpl>',width:282,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -315px !important; top: 4px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="top: -25px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si desconoces la clave de tus productos, haz <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115003866766#catalogo">clic aquí</a>.</div></div></div></div>',countries:["mexico"],},{xtype:"combo",fieldLabel:translate("category",true),name:"idCategory",allowBlank:false,store:"CategoriesComboForItem",displayField:"text",valueField:"idLocal",queryMode:"local",forceSelection:true,matchFieldWidth:false,labelWidth:130,displayTpl:'<tpl for=".">{text}</tpl>',listConfig:{width:200,height:200,border:true,tpl:'<tpl for="."><div class="x-boundlist-item">{text}</div></tpl><div><a href="#" data-action="setupCategories" class="setupCategories">'+translate("setUp",true)+" "+translate("categories")+"</a></div>"},editable:false,afterBodyEl:'<div class="tooltip-wrapper" style="margin-left: -314px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="left: -245px; top: -66px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("selectTheAccountWhereTheAmountsDueToSalesOfTheItemWillBeRecorded",true)+".</div></div></div></div>"},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",id:"itemDescriptionTextArea",allowBlank:true,margin:"15px 0px 0px 0px",height:123},]},{xtype:"container",flex:33,name:"rightContainer",style:"margin-left: 40px",padding:"20 10 0 0",defaults:{labelAlign:"top",labelWidth:125,labelPad:15,msgTarget:"side",width:360,},items:[{xtype:"box",name:"itemImageBox",margin:"0 0 15 0",configs:{maxWidth:238,maxHeight:218},html:'<div class="form-add-common-image-zone form-add-item-image-zone" onselectstart="return false;"><svg fill="rgba(205, 214, 226, 0.5)" xmlns="http://www.w3.org/2000/svg" width="140" height="140"  ><use xmlns:xlink = "http://www.w3.org/1999/xlink" xlink:href = "/images/smile-icons.svg#product"></use></svg><div padding-top: 23px;">'+translate("imageOfThe",true)+" "+translate("item")+"</div></div>"},{xtype:"box",cls:"x-form-item-label",html:"<span>"+translate("totalPrice",true)+"</span>"},{xtype:"box",width:230,name:"priceLabel",cls:"item-price-form",listeners:{beforerender:function(a){var b=a.up("form");a.update('<span class="is-pulled-left">'+Ext.util.Format.usMoney(0,AL.config.decimalPrecision)+'</span><span class="is-pulled-right has-text-right item-price-form-currency">'+b.currency+"</span>")}}}]},]},{xtype:"container",flex:1,name:"bottomContainer",defaults:{labelAlign:"top",labelWidth:165,labelPad:15,msgTarget:"side"},padding:"0 0 5 0",html:'<div id="tooltip-one-warehouse" class="tooltip-wrapper" style="margin-left: 130px; margin-top: 27px;; z-index: 11;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style=" margin-left: -336px"><div class="tooltip-text-wrapper"><div class="text" style="margin: 1px;">'+translate("ifYouNeedHelpDistributingYourItems",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115001549163">'+translate("clickHere")+"</a>.</div></div></div></div>",items:[{xtype:"fieldset",title:translate("inventoryDetails",true),hidden:true,width:1024,border:"1 0 0 0",cls:"inventory-fieldset",disabled:true,name:"inventoryFieldset",defaultType:"textfield",padding:"20px 30px",layout:"hbox",style:{borderColor:"#EAEAEA",borderStyle:"solid"},margin:"-11px 0px 0px 0px",defaults:{labelAlign:"top",labelWidth:110,msgTarget:"side",},items:[{xtype:"container",layout:"hbox",defaults:{labelAlign:"top",labelWidth:110,msgTarget:"side",width:130,padding:"0px 10px 0px 0px",labelStyle:"margin: 0px 0px 4px 0px !important;",},items:[{xtype:"groupingcombobox",fieldLabel:translate("measurementUnit",true),name:"unit",labelWidth:130,allowBlank:false,groupField:["unitType"],valueField:"unit",displayField:"text",value:"unit",id:"itemUnitTextField",store:Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:[{unitType:"",unit:"notApplicable",text:translate("notApply",true)},{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("area",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("area",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("area",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:"Peso",unit:"gram",text:translate("gramA",true)},{unitType:"Peso",unit:"kilogram",text:translate("kilogramA",true)},{unitType:"Peso",unit:"ton",text:translate("ton",true)},{unitType:"Peso",unit:"pound",text:translate("pound",true)},]}),typeAhead:true,emptyText:translate("selectSimple",true),editable:false,hidden:true,disabled:true,},{xtype:"combo",fieldLabel:translate("measurementUnit",true),name:"unit",allowBlank:false,emptyText:translate("search",true),displayField:"keyAndName",valueField:"key",id:"itemUnitCombo",minChars:0,labelAlign:"top",blankText:translate("youMustSelectAUnitFromTheUnitCatalog",true)+".",msgTarget:"side",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{key} - {name}</div></tpl>',width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},store:"Units",hidden:true,disabled:true,width:141},{xtype:"textfield",name:"unitCost",fieldLabel:translate("unitCost",true),regex:/^([0-9]+(\.[0-9]+)?)$/,allowBlank:false,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),id:"itemCostTextField",width:111},{xtype:"textfield",name:"initialQuantityMainWarehouse",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),fieldLabel:translate("initialQuantity",true),msgTarget:"side",hidden:true,margin:"0px 0px 0px 72px"},{xtype:"textfield",name:"minQuantityMainWarehouse",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),fieldLabel:translate("minimumQuantity",true),msgTarget:"side",hidden:true,margin:"0px 0px 0px 10px"},{xtype:"textfield",name:"maxQuantityMainWarehouse",allowBlank:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),fieldLabel:translate("maximumQuantity",true),msgTarget:"side",hidden:true,margin:"0px 0px 0px 10px"},{xtype:"label",name:"useWarehouses",style:"font-size: 12px;  ",margin:"27 0 0 20",width:145,padding:"0px 10px 15px 0px",html:'<a href="#" style="color:#999; line-height: 19px;" id="useWarehouses">'+translate("distributeIn",true)+" "+translate("warehouses")+"</a>",hidden:true},]},{xtype:"container",layout:"vbox",items:[{xtype:"container",name:"warehouseContainer",layout:"vbox",margin:"0 0 0 52",width:600,defaults:{labelAlign:"top",labelWidth:110,labelPad:10}},{xtype:"container",margin:"10 0 0 52",padding:"0 0 10 0",layout:"vbox",width:600,items:[{width:200,xtype:"label",name:"addWarehouse",id:"addWarehouse",style:"font-size: 12px; margin-left: 420px; margin-top: 2px;",html:'<a href="#" style="text-decoration: none;color: #00B19D; line-height: 19px;  padding: 4px 0px 4px 0px;" id="addWarehouse">'+translate("addIn",true)+" "+translate("anotherWarehouse")+"</a>"}]}]},]}]},],getFieldValuesAsMetadata:function(){var b=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":var d=this.down("combo[name=referenceType]");var c=this.down("textfield[name=tariffHeading]");b={referenceType:d.getValue(),tariffHeading:c.getValue()};break}return b},setFieldValuesFromMetadata:function(c){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":if(typeof c.referenceType!=="undefined"){var e=this.down("combo[name=referenceType]");var b=e.getStore();if(b.hasLoaded()){e.setValue(c.referenceType)}else{b.on("load",function(f){e.setValue(c.referenceType)})}}if(typeof c.tariffHeading!=="undefined"){var d=this.down("textfield[name=tariffHeading]");d.setValue(c.tariffHeading)}break}},getPriceWithTaxes:function(a,c,e){if(!a){a=e.down("textfield[name=price]")}var d=a.getValue();if(!c){c=e.down("combo[name=idTax]")}var b=0;if(c.getValue()||c.findRecordByValue(c.getValue())){var f=typeof(c.getValue())=="string"?[c.getValue()]:c.getValue();Ext.each(f,function(h){var g=c.findRecordByValue(h);if(g){b=AL.math.add(b,AL.math.approx(AL.math.mul(d,AL.math.div(g.get("tax"),100)),null,e.decimalPrecision))}})}return AL.math.approx(AL.math.add(d,b),null,e.decimalPrecision)}});Ext.define("AL.controller.Item",{extend:"Ext.app.Controller",views:["item.FormAdd","item.GridAll","category.Tree","buttons.SubmitReset","item.ItemToolbar","item.GridInvoices","item.GridBills","item.GridCreditNotes","item.GridDebitNotes","category.CrudTree","item.FormAddPriceList","company.FormUploadFile","item.MoreActionsButton","item.GridRemissions","item.GridEstimates","item.GridPurchaseOrders","item.GridWarehouseTransfers","item.FormAddWarehouse","item.ItemKitPanel","item.FormItemsKitAddItem","item.FormImage"],stores:["Items","ItemsCombo","Taxes","Categories","Invoices","Bills","CategoriesCombo","CreditNotes","DebitNotes","PriceListCombo","Remissions","Estimate","PurchaseOrders","WarehouseCombo","ReferenceTypes","CategoriesComboForItem","Units","ProductKeys","TaxTypes","UsedGoodsTypes","GroupingCodes","ItemCategories"],models:["Item","Category","ItemSold","Tax","Invoice","CategoryCombo","PriceList","Estimate","PurchaseOrder","Warehouse","CountryLegalParameter","GroupingCode"],itemCounter:1,init:function(){var a=this;this.application.addListener("updateTaxesOfItems",function(b){textData=b.data<2?b.data+" tu item":b.data+" tus items";Ext.Msg.show({title:"Actualizar IV (13%) a IVA (13%)",msg:"Con esta acción actualizarás el impuesto IV (13%) de "+textData+" al nuevo impuesto IVA (13%). <br> ¿Estás seguro de que deseas realizar esta acción? Esta operación no se puede deshacer.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f){if(f=="yes"){var d={reference:"IV",rate:13};var e={reference:"IVA",rate:13};GlobalRedirector.go({zoneTitle:"Actualizando "+translate("items")+" a IVA"});var c="Ha ocurrido un error al actualizar el impuesto de tus items";Ext.Ajax.request({url:"/item/update-rate-tax/format/json",method:"POST",params:{oldTax:Ext.encode(d),newTax:Ext.encode(e)},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){window.location.reload()}else{GlobalRedirector.close();Ext.MessageBox.alert("Error",j.cause?j.cause:c)}},failure:function(g){GlobalRedirector.close();Ext.MessageBox.alert("Error",c)}})}}})});this.application.addListener("deleteItem",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("item"),msg:translate("areYouSureYouWantToDeleteItem",true,{item:false})+"  "+translate("thisOperationCannotBeUndone",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/item/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){c.up("gridpanel").getPlugin("recordSelector").selectRecords([b],false);var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleItemStatus",function(d){GlobalLoadMask.show("gridItems");var b=d.record.data;var c=d.initiator;Ext.Ajax.request({url:"/item/toggle-item-status/format/json",method:"POST",params:{id:b.idLocal},success:function(g,h){GlobalLoadMask.hide("gridItems");var j=Ext.decode(g.responseText);if(j.success){if(c){var f=c.getStore();f.load()}else{window.location.reload()}}else{GlobalMsg.showErrorMessage("Error",j.cause)}var e=c.up("grid").getSelectionModel();e.deselectAll()},failure:function(){GlobalLoadMask.hide("gridItems")}})},this);this.application.addListener("usePriceList",function(){var g=Ext.ComponentQuery.query("item_FormAdd")[0];if(g.canPriceList){var b=g.down("panel[itemId=pricePanel]"),c=b.items.findIndex("name","usePriceList");var f=Ext.get("usePriceList");var d=g.type&&g.type=="edit"?"19px":"24px";f.setHTML('<a href="#" style="color: #00B19D; line-height: '+d+'; text-decoration: none; padding: 4px 0px 4px 18px;" id="usePriceList">'+translate("addAnotherList",true)+"</a>");var e=Ext.create("AL.view.item.FormAddPriceList",{margin:"0 0 2.5 0"});b.insert(c,e)}else{var h=g.plansText?g.plansText:"Pyme y Pro";Ext.create("AL.view.company.WindowAclError",{configs:{title:"¡Las listas de precios están disponibles para los planes "+h+"!",text:'Para utilizar listas de precio te invitamos a elegir un plan.<br><strong><a href="/plan">Ver planes disponibles.</a></strong>'}})}},this);this.application.addListener("addWarehouse",function(){var c=Ext.ComponentQuery.query("item_FormAdd")[0];var d=Ext.ComponentQuery.query("item_FormAdd container[name=warehouseContainer]")[0];var b=Ext.create("AL.view.item.FormAddWarehouse",{configs:c.configs});d.add(b)},this);this.application.addListener("useWarehouses",function(){var e=Ext.ComponentQuery.query("item_FormAdd")[0];var c=e.down("container[name=warehouseContainer]");var j=e.down("textfield[name=initialQuantityMainWarehouse]");var g=e.down("textfield[name=minQuantityMainWarehouse]");var f=e.down("textfield[name=maxQuantityMainWarehouse]");var b=e.down("label[name=useWarehouses]");var l=e.down("label[name=addWarehouse]");j.destroy();g.destroy();f.destroy();b.hide();c.show();l.show();e.configs.showWarehouses="1";e.down("textfield[name=initialQuantity]").setValue(null);e.down("textfield[name=initialQuantity]").clearInvalid();if(e.emergent){var h=e.up("window");var k=h.body.dom;k.scrollTop=k.scrollHeight-k.offsetHeight}a.renderTooltipWarehouse(e)},this);this.application.addListener("taxCreated",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"))},this);this.application.addListener("warehouseCreated",function(e){var f=e.initiator;var b=e.record;var c=f.getStore();var d=Ext.ComponentQuery.query("advancedfield[name=idWarehouseCustom]")[0];c.add(b);f.select(b.get("idLocal"));f.fireEvent("select",f);if(d){d.getComboElement().select(b)}},this);this.control({"buttons_SubmitCreate button[action=saveItem]":{click:this.saveItem},"buttons_SubmitCreate button[action=saveCreateItem]":{click:this.saveItem},"buttons_SubmitReset button[action=saveItem]":{click:this.saveItem},"buttons_SubmitReset button[action=selectCategory]":{click:function(){var e=Ext.ComponentQuery.query("window[reason=setupCategories]")[0];var b=Ext.ComponentQuery.query("category_CrudTree")[0];var g=b.getSelectionModel().getSelection()[0].get("idLocal");var d=Ext.ComponentQuery.query("item_FormAdd")[0];var f=d.down("combo[name=idCategory]");var c=f.getStore();c.load({url:"/category/retrieve-for-combo/format/json/type/income/item/true/includeFixedAsset/false/includeItems/false",callback:function(){f.setValue(g)}});if(e){e.destroy()}}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"item_GridInvoices gridcolumn[type=invoiceActions]":{click:function(b,c,k,g,l,m){var o=this.application;var f=Ext.get(l.target);var d=b.up("grid").getSelectionModel().getSelection()[0];var n=this;if(f.hasCls("convertInvoiceToOpen")){l.preventDefault();o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(e){b.getStore().load()}})}else{if(f.hasCls("addInvoicePayment")){if(d.get("status")==="draft"){l.preventDefault();o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(e){window.location="/transaction/in/number/"+e},showWarning:"yes"})}}else{if(f.hasCls("printInvoice")){l.preventDefault();if(d.get("status")==="draft"){o.fireEvent("convertInvoiceToOpen",{record:d,callback:function(e){window.location="/invoice/print/id/"+e},showWarning:"yes"})}else{var h=window.open("/invoice/print/id/"+d.get("idLocal"));h.print()}}else{if(f.hasCls("deleteInvoice")){l.preventDefault();if(d.get("status")==="draft"){o.fireEvent("deleteInvoice",{record:d,initiator:b})}else{Ext.Msg.alert("Error","Solo se puede eliminar "+translate("theInvoices")+" "+translate("invoice")+" en estado borrador")}}else{if(f.hasCls("voidInvoice")){l.preventDefault();if(d.get("status")==="open"){o.fireEvent("voidInvoice",{record:d,initiator:b})}else{Ext.Msg.alert("Error","Solo se puede "+translate("cancel")+" "+translate("theInvoices")+" "+translate("invoice")+" con estado "+translate("openInvoice"))}}}}}}}},"item_GridCreditNotes gridcolumn[type=creditNoteActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteCreditNote")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteCreditNote",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("creditNote")+" que tengan devolución de dinero")}}else{if(f.hasCls("voidCreditNote")){k.preventDefault();if(d.get("voidable")){m.fireEvent("voidCreditNote",{record:d,initiator:b})}}}}},"item_GridBills gridcolumn[type=billActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteBill")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteBill",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar compras que ya tienen pagos asociados")}}}},"item_GridDebitNotes gridcolumn[type=debitNoteActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteDebitNote")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteDebitNote",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar notas débito que tengan devolución de dinero conciliadas")}}}},"menuitem[action=uploadItemImageFile]":{click:function(c){var d=c.up("splitbutton");var b={};b.type="item-gallery";b.idType=d.idType;this.application.fireEvent("uploadFile",b)}},"item_FormAdd checkbox[name=isInventariable]":{change:function(f,d,b,g){var e=f.up("form");var k=e.down("fieldset[name=inventoryFieldset]");var h=false;if(d){h=true;k.show();k.enable();if(["mexico","peru","costaRica","argentina","colombia"].indexOf(e.country)!==-1){if(e.country==="mexico"){var j=e.down("combo[name=unit]");if(j.getValue()){k.down("combo#itemUnitCombo").setValue(j.getValue())}j.hide();j.disable()}else{var j=e.down("groupingcombobox[name=unit]");if(j.getValue()){k.down("groupingcombobox[name=unit]").setValue(j.getValue())}j.hide();j.disable()}}}else{k.hide();k.disable();if(["mexico","peru","costaRica","argentina","colombia"].indexOf(e.country)!==-1){if(e.country==="mexico"){var c=e.down("combo[name=unit]");c.setValue(k.down("combo#itemUnitCombo").getValue());c.show();c.enable()}else{var c=e.down("groupingcombobox[name=unit]");c.show();c.enable()}}this.validateForm()}this.renderTooltipWarehouse(e,!h)}},"item_FormAdd textfield[name=reference]":{afterrender:function(d){var b=d.up("form");if(b.configs&&b.configs.country==="costaRica"){var c=b.down("combo[name=referenceType]");c.hide()}},change:function(e,d){var b=e.up("form");if(b.configs&&b.configs.country==="costaRica"){var c=b.down("combo[name=referenceType]");if(d){c.allowBlank=false;c.show()}else{c.reset();c.allowBlank=true;c.hide()}}}},item_GridAll:{itemdblclick:this.goItemDetails,selectedRecordsChanged:function(b,d){var c=d.getSelectedRecords().length;if(c>=2){document.getElementById("tooltip-many-selections").style.display="inline-block"}else{document.getElementById("tooltip-many-selections").style.display="none"}}},"item_GridAll gridcolumn[type=itemActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteItem")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteItem",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar ítems que ya están asociados a "+translate("invoices")+", compras o "+translate("creditNote"))}}if(f.hasCls("toggleItemStatus")){k.preventDefault();m.fireEvent("toggleItemStatus",{record:d,initiator:b})}}},"item_ItemToolbar button[action=addItem]":{click:function(){window.location="/item/add"}},"item_FormAdd filefield[name=itemImage]":{change:function(d,c){var b=Ext.DomQuery.selectNode("input[id="+d.getInputId()+"]");b.value=c.replace("C:\\fakepath\\","")}},item_FormAdd:{afterrender:this.initialize,beforerender:function(b){b.executeActionsBeforeRender();var u=b.down("container[name=warehouseContainer]");var s={margin:"0 0 0 20",xtype:"item_FormAddWarehouse",configs:b.configs};u.add(s);var c=false;switch(b.country){case"mexico":var m=b.down("container[name=leftContainer]");var p=b.down("textfield[name=productKey]");p.destroy();var h=b.down("combo[name=productKey]");h.hidden=false;h.allowBlank=false;m.insert(3,{xtype:"combo",fieldLabel:"Unidad de medida",name:"unit",allowBlank:false,displayField:"text",store:"Units",emptyText:"Buscar...",displayField:"keyAndName",valueField:"key",id:"mx_unitCombo",minChars:0,width:260,labelWidth:110,labelAlign:"top",blankText:"Debes seleccionar una unidad del catálogo de unidades.",msgTarget:"side",labelStyle:"margin: 0px 0px 4px 0px !important;",padding:"0px 10px 0px 0px",labelStyle:"margin: 0px 0px 4px 0px !important;",margin:"15px 0px 0px 0px",matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{key} - {name}</div></tpl>',width:300,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list"},});var o=Ext.ComponentQuery.query("#mx_unitCombo")[0];var r=Ext.ComponentQuery.query("#itemUnitCombo")[0];var g=o.getStore();r.store=g;r.getStore().load();r.disabled=false;r.hidden=false;break;case"peru":case"costaRica":case"argentina":case"colombia":var m=b.down("container[name=leftContainer]");var p=b.down("textfield[name=productKey]");p.hidden=true;if(b.country==="peru"){p.hidden=false;p.regex=/(?!84121901)(^[1-9]{1}[0-9]{7}$)/;p.regexText=translate("theProductKey",true)+" debe ser un valor válido.";p.afterBodyEl='<div class="tooltip-wrapper" style="left: 196px; top: 3px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="top: -25px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si necesitas ayuda para agregar '+translate("theProductKey")+" a tus "+translate("items")+', haz clic <a href="https://ayudas.getsoft.app/articles/3065233" target="_blank">aquí</a>.</div></div></div></div>';var t=new Date();var e=new Date("2021-01-01");if(t>=e){p.allowBlank=false}}if(b.country==="costaRica"){data=[{unitType:translate("service",true),unit:"Servicios profesionales",text:"Servicios profesionales (Sp)"}];if(b.configs.electronicInvoicingVersion=="4.3"){data=[{unitType:translate("service",true),unit:"rentalOfResidentialUse",text:"Alquiler de uso habitacional (Al)"},{unitType:translate("service",true),unit:"rentalOfCommercialUse",text:"Alquiler de uso comercial (Alc)"},{unitType:translate("service",true),unit:"comissions",text:"Comisiones (Cm)"},{unitType:translate("service",true),unit:"interests",text:"Intereses (I)"},{unitType:translate("service",true),unit:"anotherTypeOfService",text:"Otro tipo de servicio (Os)"},{unitType:translate("service",true),unit:"personalServices",text:"Servicios personales (Spe)"},{unitType:translate("service",true),unit:"service",text:"Servicios profesionales (Sp)"},{unitType:translate("service",true),unit:"technicalServices",text:"Servicios técnicos (St)"}]}data.push({unitType:translate("unit",true),unit:"unit",text:translate("unitA",true)},{unitType:"Tiempo",unit:"second",text:"Segundo (s)"},{unitType:"Tiempo",unit:"minute",text:"Minuto (min)"},{unitType:"Tiempo",unit:"hour",text:"Hora (h)"},{unitType:"Tiempo",unit:"day",text:"Día (d)"},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"milimeter",text:translate("millimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:"Pulgada (In)"},{unitType:translate("",true),unit:"meterSquared",text:"Metro cuadrado (m²)"},{unitType:translate("",true),unit:"meterCubic",text:"Metro cúbico (m³)"},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:"Galón (Gal)"},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"ton",text:"Tonelada (t)"},{unitType:translate("weight",true),unit:"onza",text:"Onza (Oz)"})}else{if(b.country==="argentina"){data=[{unitType:translate("service",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"unit",text:translate("unitA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("",true),unit:"meterSquared",text:"Metro cuadrado (m²)"},{unitType:translate("",true),unit:"meterCubic",text:"Metro cúbico (m³)"},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)}]}else{if(b.country==="colombia"){c=true;data=[{unitType:"",unit:"notApplicable",text:translate("notApply",true)},{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("unit",true),unit:"thousand",text:translate("thousand",true)},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("length",true),unit:"foot",text:translate("footA",true)},{unitType:translate("",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"ton",text:translate("ton",true)},{unitType:translate("weight",true),unit:"pound",text:translate("pound",true)},];if(b.configs.isActiveElectronicInvoicing&&b.configs.electronicInvoicingVersion=="2.1"){c=false;data=[{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("unit",true),unit:"thousand",text:translate("thousand",true)},{unitType:translate("unit",true),unit:"par",text:translate("pair",true)},{unitType:translate("unit",true),unit:"npr",text:translate("pairs",true)},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("length",true),unit:"foot",text:translate("footA",true)},{unitType:translate("",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"pound",text:translate("pound",true)},{unitType:"AIU",unit:"administration",text:"Administración"}]}}else{data=[{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("unit",true),unit:"thousand",text:translate("thousand",true)},{unitType:translate("unit",true),unit:"kit",text:"Kit"},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"ton",text:translate("ton",true)},{unitType:translate("weight",true),unit:"pound",text:translate("pound",true)}]}}}m.insert(3,{xtype:"groupingcombobox",fieldLabel:translate("measurementUnit",true),name:"unit",allowBlank:c,groupField:["unitType"],valueField:"unit",displayField:"text",labelAlign:"top",width:130,padding:"0px 10px 0px 0px",labelStyle:"margin: 0px 0px 4px 0px !important;",margin:"15px 0px 0px 0px",store:Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:data}),typeAhead:true,emptyText:translate("selectSimple",true),editable:false});var n=b.down("groupingcombobox[name=unit]");var g=n.getStore();var l=b.down("fieldset[name=inventoryFieldset]");var k=l.down("groupingcombobox[name=unit]");k.disabled=false;k.hidden=false;var d=Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:data,});k.store=d;k.getStore().load();if(g.hasLoaded()){n.select("unit")}else{g.on("load",function(){n.select("unit")})}break;case"republicaDominicana":data=[{unitType:"",unit:"notApplicable",text:translate("notApply",true)},{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("length",true),unit:"foot",text:translate("footA",true)},{unitType:translate("",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"ton",text:translate("ton",true)},{unitType:translate("weight",true),unit:"pound",text:translate("pound",true)},];var l=b.down("fieldset[name=inventoryFieldset]");var n=l.down("groupingcombobox[name=unit]");g=Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:data});n.store=g;n.getStore().load();n.disabled=false;n.hidden=false;break;default:data=[{unitType:"",unit:"notApplicable",text:translate("notApply",true)},{unitType:translate("unit",true),unit:"unit",text:translate("unit",true)},{unitType:translate("unit",true),unit:"service",text:translate("service",true)},{unitType:translate("unit",true),unit:"piece",text:translate("piece",true)},{unitType:translate("length",true),unit:"centimeter",text:translate("centimeterA",true)},{unitType:translate("length",true),unit:"meter",text:translate("meterA",true)},{unitType:translate("length",true),unit:"inch",text:translate("inch",true)},{unitType:translate("",true),unit:"centimeterSquared",text:translate("centimeterSquaredA",true)},{unitType:translate("",true),unit:"meterSquared",text:translate("meterSquaredA",true)},{unitType:translate("",true),unit:"inchSquared",text:translate("inchSquared",true)},{unitType:translate("volume",true),unit:"mililiter",text:translate("milliliterA",true)},{unitType:translate("volume",true),unit:"liter",text:translate("literA",true)},{unitType:translate("volume",true),unit:"gallon",text:translate("gallon",true)},{unitType:translate("weight",true),unit:"gram",text:translate("gramA",true)},{unitType:translate("weight",true),unit:"kilogram",text:translate("kilogramA",true)},{unitType:translate("weight",true),unit:"ton",text:translate("ton",true)},{unitType:translate("weight",true),unit:"pound",text:translate("pound",true)}];var l=b.down("fieldset[name=inventoryFieldset]");var n=l.down("groupingcombobox[name=unit]");if(b.country==="panama"){data.push({unitType:translate("weight",true),unit:"ounce",text:translate("ounce",true)})}g=Ext.create("Ext.data.Store",{fields:["unitType","unit","text"],data:data});n.store=g;n.getStore().load();n.disabled=false;n.hidden=false;break}if(b.country!="mexico"){var j=b.down("textfield[name=reference]");if(j){j.afterBodyEl=""}}if(b.multicurrency){var f=b.multicurrency=="yes"?"("+b.currency+")":"";b.down("textfield[name=price]").setFieldLabel(translate("salePrice",true)+" "+f)}if(!b.configs.showWarehouses){u.hide();b.down("label[name=addWarehouse]").hide();b.down("textfield[name=initialQuantityMainWarehouse]").show();b.down("textfield[name=minQuantityMainWarehouse]").show();b.down("textfield[name=maxQuantityMainWarehouse]").show();b.down("label[name=useWarehouses]").show();b.down("textfield[name=initialQuantity]").setValue(0)}else{b.down("textfield[name=initialQuantityMainWarehouse]").destroy();b.down("textfield[name=minQuantityMainWarehouse]").destroy();b.down("textfield[name=maxQuantityMainWarehouse]").destroy()}if(b.configs.showCustomFields){var q=b.down("container[name=customFields]");Ext.Ajax.request({url:"/custom-field/retrieve-all/resource/item/format/json/onlyActive/true",success:function(v){var w=Ext.decode(v.responseText);if(w.success){Ext.each(w.results,function(y){switch(y.type){case"text":var z={xtype:"textfield",fieldLabel:y.name,idField:y.id,key:y.key};break;case"boolean":var z={xtype:"checkbox",fieldLabel:y.name,idField:y.id,key:y.key};break}if(y.key=="barcode"){z.msgTarget="side";var x="left: 196px; top: 3px;";z.afterBodyEl='<div class="tooltip-wrapper" style="'+x+'"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="top: -25px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Si necesitas ayuda para agregar el código de barras a tus productos, haz <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115002508303">clic aquí</a>.</div></div></div></div>'}if(y.key=="importRequest"){z.msgTarget="side";var x="left: 196px; top: 3px;";z.afterBodyEl='<div class="tooltip-wrapper" style="'+x+'"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="top: -25px;"><div class="tooltip-text-wrapper tooltip-small"><div class="text">Activa esta opción si este producto es importado de primera mano. <a target="_blank" href="https://ayuda.getsoft.app/articles/3123763">Ver más</a>.</div></div></div></div>'}q.add(z)})}}})}}},"item_FormAddWarehouse combo[name=warehouseCombo]":{afterrender:function(f){var e=f.getStore(),b=f;if(!e.hasLoaded()&&!e.isLoading()){e.load({callback:function(){var g=e.findRecord("isMain","yes");if(g){b.select(g)}}})}else{var d=Ext.ComponentQuery.query("item_FormAddWarehouse combo[name=warehouseCombo]");if(d.length<=1){var c=e.findRecord("isMain","yes");if(c){b.select(c)}}}},},item_FormAddWarehouse:{afterrender:function(e){if(e.type&&e.type=="edit"){if(e.warehouse){var c=e.warehouse;var f=e.down("combo[name=warehouseCombo]");var d=f.getStore();var b=d.findRecord("idLocal",c.idWarehouse);if(!b){b=Ext.create("AL.model.Warehouse",{idLocal:c.idWarehouse,name:c.warehouseName,deletable:c.deletable});d.add(b)}if(d.hasLoaded()){f.select(b)}else{d.on("load",function(){f.select(b)})}e.down("textfield[name=initialQuantity]").setValue(c.initialQuantity);e.down("textfield[name=minQuantity]").setValue(c.minQuantity);e.down("textfield[name=maxQuantity]").setValue(c.maxQuantity);if(c.deletable=="no"||c.hideDelete=="yes"){e.down("button[action=deleteWarehouse]").hide();if(c.deletable=="no"){f.readOnly=true;f.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC; border-radius: 4px;")}}}}},afterlayout:function(c){var g=Ext.ComponentQuery.query("item_FormAdd")[0];if(g.emergent){var b=Ext.ComponentQuery.query("item_FormAddWarehouse");if(b.length>1){var e=g.up("window");var f=e.body.dom;f.scrollTop=f.scrollHeight-f.offsetHeight}}},beforerender:function(b){this.addLabelsToFirstForm()}},"item_FormAddPriceList combo[name=priceListCombo]":{beforerender:function(c){var b=Ext.ComponentQuery.query("item_FormAddPriceList");if(b.length==1){b[0].down("combo[name=priceListCombo]").setFieldLabel(translate("priceList",true));b[0].down("textfield[name=priceListText]").setMargin("29 0 0 5");b[0].down("button[action=deletePriceList]").setMargin("29 0 0 35")}},afterrender:function(c){var b=c.getStore();if(!b.hasLoaded()&&!b.isLoading()){b.load({callback:function(){var d=b.findRecord("main","yes");if(d){b.remove(d)}}})}else{setTimeout(function(){var d=b.findRecord("main","yes");if(d){b.remove(d)}},100)}},select:function(j,e){var d=e[0].data;var c=j.up("panel");var b=c.down("textfield[name=priceListText]");if(d){if(d.dependent&&d.dependent=="yes"){b.disable();b.tooltip.update({tooltipDescription:"Puedes observar el precio con "+translate("theDiscount")+" "+translate("discount")+" indicado en tu lista"});var g=Ext.ComponentQuery.query("item_FormAdd textfield[name=price]")[0];if(g.getValue()){var f=j.getSelectedRecord();var h=AL.math.approx(AL.math.sub(g.getValue(),AL.math.mul(g.getValue(),AL.math.div(f.get("percentage"),100))));b.setValue(h)}}else{b.enable();b.setValue(null);b.tooltip.update({tooltipDescription:"Indica el precio de tu "+translate("item")+" en esta lista."})}}}},"item_FormAdd container[name=warehouseContainer]":{afterrender:function(b){var d=Ext.ComponentQuery.query("item_FormAddWarehouse")[0];if(d){var c=d.down("button[action=deleteWarehouse]");c.hide()}}},"item_FormAddWarehouse button[action=deleteWarehouse]":{click:function(b){var d=b.up("form");d.removeAll();d.destroy();if(d.type=="edit"){this.addLabelsToFirstForm();var c=Ext.ComponentQuery.query("item_FormAddWarehouse");if(c.length>0){c[0].down("button[action=deleteWarehouse]").hide()}}}},"item_FormAdd combo[name=idTax]":{beforerender:function(c){var b=c.up("form");if(b.configs.canCreateNewTax=="yes"){c.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl><div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}},beforeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0||(d.getValue()&&d.getValue()[0]===0)){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",true)}});d.setValue("[0]")}return b.get("disabled")?false:true}},beforedeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",false)}})}}},change:function(f,b,c){var e=f.up("form");var d=e.getPriceWithTaxes(null,f,e);var g=e.down("box[name=priceLabel]");if(g){g.update('<span class="is-pulled-left">'+Ext.util.Format.usMoney(d)+'</span><span class="is-pulled-right has-text-right item-price-form-currency">'+e.currency+"</span>")}}},"item_FormAdd box[name=itemImageBox]":{render:function(c){var b=c.up("form");this.promptFileUploadWindowOnClick(c,"fileUrl",{asyncUpload:true,title:translate("imageOfThe",true)+" "+translate("item"),url:"/file/upload/format/json",fieldName:"file",fieldLabel:translate("file",true),buttonText:translate("selectSimple",true),forceUploadEmptyResource:true,hideFileSuccessMessage:true},function(d){b.idImageFile=d.idResource})}},"item_FormAdd radiogroup[name=itemType]":{change:function(d,b){var c=d.up("form"),e=c.down("checkbox[name=isInventariable]"),g=null;if(c.configs.country=="mexico"){g=c.down("checkbox[key=importRequest]")}if(b&&b.itemType=="kit"){e.setValue(false);e.hide();if(g){g.setValue(false);g.disable()}Ext.create("AL.view.item.ItemKitPanel",{renderTo:"itemsKitContainer"});if(c.configs.showWarehouses){var f=c.down("combo[name=kitIdWarehouse]");f.allowBlank=false;f.show();var k=f.getStore();k.on("load",function(){var l=k.findRecord("isMain","yes");f.select(l)});k.load()}}else{e.show();var j=Ext.ComponentQuery.query("item_ItemKitPanel");var h=c.down("combo[name=kitIdWarehouse]");if(h){h.allowBlank=true;h.select(0);h.hide()}if(j&&j[0]){j[0].destroy()}if(g){g.setValue(false);g.enable()}}}},"item_FormAdd combo[name=kitIdWarehouse]":{select:function(){var d=Ext.ComponentQuery.query("item_FormItemsKitAddItem");if(d){Ext.each(d,function(j){var k=j.down("combo[name=idLocal]");var h=k.getStore().getProxy();h.clearCache();j.removeAll();j.destroy()});var g=Ext.ComponentQuery.query("item_ItemKitPanel")[0];var f=g.down("container[name=itemKitFormContainer]");var c=Ext.create("AL.view.item.FormItemsKitAddItem");f.add(c);var b=Ext.create("AL.view.item.FormItemsKitAddItem");f.add(b);var e=Ext.create("AL.view.item.FormItemsKitAddItem");f.add(e);this.updateTotalCost()}}},item_ItemKitPanel:{beforerender:function(g){var f=Ext.ComponentQuery.query("item_FormAdd")[0];if(f.type!="edit"){var e=g.down("container[name=itemKitFormContainer]");var c=Ext.create("AL.view.item.FormItemsKitAddItem");e.add(c);var b=Ext.create("AL.view.item.FormItemsKitAddItem");e.add(b);var d=Ext.create("AL.view.item.FormItemsKitAddItem");e.add(d)}},afterrender:function(b){var c=Ext.get("addOtherItemKit");c.on("click",function(){var d=Ext.ComponentQuery.query("container[name=itemKitFormContainer]")[0];var e=Ext.create("AL.view.item.FormItemsKitAddItem");d.add(e)},this)}},"item_FormItemsKitAddItem combo[name=idLocal]":{render:function(g){var e=g.up("form");var j=Ext.ComponentQuery.query("item_FormAdd")[0];var f=Ext.create("AL.store.ItemsCombo");var c=f.getProxy();c.extraParams={includeImagePath:"yes",itemsType:"simple"};var h=null;if(j.configs.showWarehouses||e.idItem){var b=j.down("combo[name=kitIdWarehouse]");if(b.getValue()){if(typeof b.getValue()=="string"){h=b.getValue()}else{h=b.getValue().get("idLocal")}c.extraParams.idWarehouse=h}else{var d=b.getStore();d.on("load",function(){var k=d.findRecord("isMain","yes");h=k.get("idLocal");c.extraParams.idWarehouse=h})}}g.store=f},select:function(c,b){this.getContainedItemDetails(c,b)},select2:function(c){var d=c.combo;var b=c.record;this.getContainedItemDetails(d,[b])}},"item_FormItemsKitAddItem button[action=deleteItem]":{click:function(b){b.up("form").destroy();this.updateTotalCost()},},"item_FormItemsKitAddItem numberfield[name=quantity]":{change:function(){this.updateTotalCost()},},"item_FormImage box[name=imageBox]":{render:function(c){var b=c.up("form");this.promptFileUploadWindowOnClick(c,"fileUrl",{asyncUpload:true,title:translate("itemImage",true),url:"/file/upload/format/json",fieldName:"file",fieldLabel:translate("file",true),buttonText:translate("selectSimple",true),forceUploadEmptyResource:true,hideFileSuccessMessage:true},function(d){b.idImageFile=d.idResource;var e=b.getValues();url="/item/edit-image/format/json";e.idLocal=b.idLocal;if(b.idImageFile){e.idImageFile=b.idImageFile}Ext.Ajax.request({url:url,params:e})})}},})},saveItem:function(a){var c=Ext.ComponentQuery.query("item_FormAdd")[0];var t=this.validateForm();if(t.result){var d=c.getValues();var u=a.up("form");var x=u.query("button");Ext.each(x,function(z){z.disable()});GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("item")});var g="/item/add/format/json";if(c.type&&c.type=="edit"){g="/item/edit/format/json";d.idLocal=c.idLocal}if(!d.idTax||d.idTax==0){delete d.idTax}if(d.warehouseCombo){delete d.warehouseCombo}if(d.initialQuantity){delete d.initialQuantity}if(!d.minQuantity||d.minQuantity===""){delete d.minQuantity}if(!d.maxQuantity||d.maxQuantity===""){delete d.maxQuantity}var w=[];var o=Ext.ComponentQuery.query("item_FormAddPriceList");if(o.length>0){Ext.each(o,function(E){var D=E.down("combo");if(D.getValue()){var z=E.down("textfield[name=priceListText]");var C=z.getValue();var B=D.getSelectedRecord();if(B&&B.get("dependent")=="yes"){C=null}var A=D.getValue();w.push({id:A,price:C})}})}d.priceLists=Ext.encode(w);var m=[];var b=0;var e=Ext.ComponentQuery.query("item_FormAddWarehouse");if(e.length>0){if(c.configs.showWarehouses){Ext.each(e,function(C){var z=C.down("combo");if(z.getValue()){var B=C.down("textfield[name=initialQuantity]");var E=C.down("textfield[name=minQuantity]");var D=C.down("textfield[name=maxQuantity]");var F=B.getValue();var A=z.getValue();m.push({id:A,initialQuantity:F,minQuantity:E.getValue()!==""?E.getValue():null,maxQuantity:D.getValue()!==""?D.getValue():null});b=AL.math.add(b,F)}})}else{var y=c.down("textfield[name=initialQuantityMainWarehouse]");var s=c.down("textfield[name=minQuantityMainWarehouse]");var r=c.down("textfield[name=maxQuantityMainWarehouse]");m.push({id:e[0].down("combo").getValue(),initialQuantity:y.getValue(),minQuantity:s.getValue()!==""?s.getValue():null,maxQuantity:r.getValue()!==""?r.getValue():null});b=y.getValue()}}d.warehouses=Ext.encode(m);if(c.configs.showCustomFields){var j=[];var h=c.down("container[name=customFields]");var f=h.items.items;Ext.each(f,function(z){j.push({id:z.idField,value:z.getValue()})});d.customFields=Ext.encode(j)}if(c.configs.multipleTaxes=="yes"){var l=d.idTax;d.idTax=Ext.encode(l)}var q=c.getFieldValuesAsMetadata();if(q){d.metadata=Ext.encode(q)}if(c.idImageFile){d.idImageFile=c.idImageFile}if(!d.itemType){d.itemType=c.down("radiogroup[name=itemType]").getValue().itemType}if(d.itemType=="kit"){var n=Ext.ComponentQuery.query("item_FormItemsKitAddItem");var v=[];Ext.each(n,function(z){var A=z.getValues();if(A.idLocal){v.push(A)}});d.kitContainedItems=Ext.encode(v)}if(d.itemType){d.type=d.itemType}switch(c.configs.country){case"mexico":var k=c.down("combo[name=productKey]");if(k){d.productKey=k.getValue()}break;case"peru":var p=c.down("textfield[name=productKey]");if(p){d.productKey=p.getValue()}break}Ext.Ajax.request({url:g,params:d,timeout:120000,success:function(A){var C=Ext.decode(A.responseText);if(C.success){var D=C.results;if(c.emergent){GlobalRedirector.close()}if(c.callback){var z=Ext.create("AL.model.Item",d);z.set("idLocal",D);z.set("availableQuantity",b);if(c.configs.country=="mexico"){Ext.each(f,function(E){if(E.key=="importRequest"&&E.value){z.set("canUseImportRequest","yes")}})}c.callback(z)}else{if(a.createAnother){window.location="/item/add"}else{window.location="/item/view/id/"+D}}}else{if(c.emergent){GlobalRedirector.close();var B="Hay un error en el formulario";if(C&&C.notification){B="No cuentas con permisos para crear el "+translate("item",true)}else{B=C.cause}Ext.MessageBox.alert("Error",B)}else{GlobalRedirector.close();if(!C.requestDuplicate){GlobalMsg.showErrorMessage("Error",C.cause)}}Ext.each(x,function(E){E.enable()})}},failure:function(){GlobalRedirector.close();Ext.each(x,function(z){z.enable()})}})}else{if(c.emergent){Ext.MessageBox.alert("Error","Hay un error en el formulario")}else{if(t.message){GlobalMsg.showNotification({title:"Error",text:t.message,type:"error"})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}}}},initialize:function(){var l=this;var c=Ext.ComponentQuery.query("item_FormAdd")[0];var g=c.down("combo[name=idTax]");var b=g.getStore();var j=Ext.get("usePriceList");if(j){j.removeAllListeners();j.on("click",function(o){o.preventDefault();l.application.fireEvent("usePriceList",this)})}var k=Ext.get("addWarehouse");if(k){k.removeAllListeners();k.on("click",function(o){o.preventDefault();l.application.fireEvent("addWarehouse",this)})}var f=Ext.get("useWarehouses");if(f){f.removeAllListeners();f.on("click",function(o){o.preventDefault();l.application.fireEvent("useWarehouses",this)})}if(c.configs.multipleTaxes=="yes"){var h=c.down("combo[name=idTax]");h.multiSelect=true;var n="";if(c.configs.canCreateNewTax=="yes"){n='<div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}h.listConfig.tpl='<tpl for="."><tpl if="values.disabled==true"><div class="x-boundlist-item checkbox-item-disabled"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div><tpl else><div class="x-boundlist-item"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl></tpl>'+n}var a=true;if(c.type&&c.type=="edit"){GlobalLoadMask.show("generalContainer");Ext.Ajax.request({url:"/item/retrieve-one/id/"+c.idLocal+"/incluede-main-price/false/format/json/warehouse-deep-check/yes/deletable/yes/include-kit-contain-items/yes/belongs-in-kit/yes",success:function(s){var w=Ext.decode(s.responseText),H=w.results,G=c.down("hiddenfield[name=idLocal]"),o=c.down("textfield[name=reference]"),A=c.down("textfield[name=name]"),P=c.down("textfield[name=price]"),B=c.down("textarea[name=description]"),L=c.down("checkbox[name=isInventariable]"),M=c.down("textfield[name=initialQuantity]"),y=c.down("textfield[name=minQuantity]"),V=c.down("textfield[name=maxQuantity]"),T=c.down("textfield[name=unitCost]"),R=c.down("radiogroup[name=itemType]"),J=c.down("radio[inputValue="+H.type+"]"),Q=c.down("combo[name=idItemCategory]");J.setValue(true);if(!H.deletable||H.belongsInKit){R.disable()}if(H.metadata){c.setFieldValuesFromMetadata(H.metadata)}G.setValue(H.idLocal);o.setValue(H.reference);A.setValue(H.name);var t=function(ab){var aa=Ext.create("AL.model.Tax",{idLocal:ab.idTax,tax:ab.tax,name:ab.taxName});p.add(aa);g.select(aa)};var Y=function(){var aa=[];Ext.each(H.taxes,function(ab){if(ab.status==="inactive"){t(ab)}else{aa.push(ab.id)}});if(aa.length>0){g.setValue(aa)}else{g.select(0)}};if(b.hasLoaded()){Y()}else{b.on("load",Y)}if(!Q.isHidden()){var K=Q.getStore();K.removeFilter();K.load({callback:function(){var ab=new Ext.util.Filter({filterFn:function(ac){if(ac.data.status=="active"||ac.data.idLocal==H.idItemCategory){return true}else{return false}}});K.addFilter(ab);var aa=K.findRecord("idLocal",H.idItemCategory);Q.select(aa)}})}B.setValue(H.description);if(["mexico","peru"].indexOf(c.country)!==-1){if(c.country==="mexico"){var I=c.down("combo[name=productKey]");I.setValue(H.productKey);var U=I.getStore();U.load({params:{query:H.productKey},callback:function(){I.select(H.productKey)}})}else{var Z=c.down("textfield[name=productKey]");Z.setValue(H.productKey)}}if(["mexico","peru","costaRica","argentina","colombia"].indexOf(c.country)!==-1){if(c.country==="mexico"){var S;if(H.isInventariable==="yes"){S=c.down("combo#itemUnitCombo")}else{S=c.down("container[name=leftContainer]").down("combo[name=unit]")}var p=S.getStore();p.load({params:{query:H.unit},callback:function(){S.select(H.unit)}})}else{c.down("container[name=leftContainer]").down("combo[name=unit]").setValue(H.unit)}}if(H.isInventariable==="yes"){c.down("fieldset[name=inventoryFieldset]").down("combo[name=unit]").setValue(H.unit);L.setValue(true);L.disable();M.setValue(H.initialQuantity);y.setValue(H.minQuantity);V.setValue(H.maxQuantity);T.setValue(H.unitCost);if(H.type=="simple"){J.disable();c.down("radio[inputValue=kit]").disable()}}if(H.belongsInKit){if(H.isInventariable==="yes"){c.down("fieldset[name=inventoryFieldset]").down("combo[name=unit]").setValue(H.unit);L.setValue(true)}L.disable()}P.setValue(H.price);if(c.canPriceList){var E=H.priceLists,v=Ext.get("usePriceList"),O=c.type&&c.type=="edit"?"19px":"41px";v.setHTML('<a href="#" style="color: #00B19D; line-height: '+O+'; text-decoration: none;padding: 4px 0px 4px 18px;" id="usePriceList">'+translate("addAnotherList",true)+"</a>");var D=c.down("panel[itemId=pricePanel]"),u=D.items.findIndex("name","usePriceList");Ext.Object.each(E,function(aa,ac){var ab=Ext.create("AL.view.item.FormAddPriceList",{listeners:{afterrender:function(ae){var ah=ae.down("combo[name=priceListCombo]"),af=ah.getStore(),ad=ae.down("textfield[name=priceListText]"),ag=function(){var ai=af.findRecord("idLocal",aa);if(ai){ah.select(ai);ad.setValue(ac);setTimeout(function(){var aj=ah.getSelectedRecord();if(aj&&aj.get("dependent")=="yes"){ad.disable()}},500)}};if(af.hasLoaded()){ag()}else{af.on("load",ag)}}}});D.insert(u,ab)})}var C=H.warehouses.length;if(C>0){var q=H.warehouses;if(!c.configs.showWarehouses){c.down("textfield[name=initialQuantityMainWarehouse]").setValue(q[0].initialQuantity);c.down("textfield[name=minQuantityMainWarehouse]").setValue(q[0].minQuantity);c.down("textfield[name=maxQuantityMainWarehouse]").setValue(q[0].maxQuantity)}else{var X=Ext.ComponentQuery.query("item_FormAddWarehouse");Ext.each(X,function(aa){aa.removeAll();aa.destroy()});var W=c.down("container[name=warehouseContainer]");Ext.Object.each(q,function(aa,ac){if(H.belongsInKit){ac.deletable="no"}if(AL.math.comp(C,1)==0){ac.hideDelete="yes"}var ab="10 0 0 20";if(aa==0){ab="0 0 0 20"}var ad=Ext.create("AL.view.item.FormAddWarehouse",{type:"edit",warehouse:ac,configs:c.configs,margin:ab});W.add(ad)})}}if(H.customFields){var x=c.down("container[name=customFields]").items.items;Ext.each(x,function(aa){Ext.Object.each(H.customFields,function(ac,ab){if(ac===aa.idField){aa.setValue(ab.value);return false}})})}if(H.image){var r=c.down("box[name=itemImageBox]");r.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;" onselectstart="return false;"><img src="'+H.image.url+'" style="margin: 0 auto; max-height: 220px; max-width: 240px" /></div></div>')}l.loadSelectedCategory(c,H.idCategory);if(H.type=="kit"){var z=c.down("combo[name=kitIdWarehouse]");var N=z.getStore();if(!H.deletable){z.readOnly=true;z.addCls("read-only");Ext.getElementById("addOtherItemKit").classList.add("hidden")}var F=function(){if(H.warehouse){z.select(H.warehouse.idLocal)}var aa=H.containItems;var ab=Ext.ComponentQuery.query("container[name=itemKitFormContainer]")[0];Ext.each(aa,function(ae){var ad=Ext.create("AL.view.item.FormItemsKitAddItem",{type:"edit"});ab.add(ad);var af=ad.down("combo[name=idLocal]");var ac=Ext.create("AL.model.Item",ae.item);af.getStore().add(ac);af.select(ac);af.fireEvent("select2",{combo:af,record:ac});var ag=ad.down("numberfield[name=quantity]");ag.setValue(ae.quantity);if(!H.deletable){af.readOnly=true;ag.readOnly=true;ad.down("button[action=deleteItem]").hide()}})};if(H.warehouse){if(N.hasLoaded()){console.log("hola1");F()}else{console.log("hola12");N.on("load",F)}}else{F()}}GlobalLoadMask.hide("generalContainer")}})}else{if(b.hasLoaded()){g.select(0)}else{b.on("load",function(){g.select(0)})}l.loadSelectedCategory(c,c.configs.defaultItemCategory);if(c.forceInventariable){var m=c.down("checkbox[name=isInventariable]");m.hide();m.setValue(1);a=false;c.down("radio[inputValue=simple]").setValue(true);c.down("radiogroup[name=itemType]").hide()}if(c.configs.idItemCategory){var d=c.down("combo[name=idItemCategory]");if(!d.isHidden()){var e=d.getStore();e.load({callback:function(){var o=e.findRecord("idLocal",c.configs.idItemCategory);d.select(o)}})}}}if(a){l.renderTooltipWarehouse(c,true)}if(!b.hasLoaded()&&!b.isLoading()){b.load()}},goItemDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/item/view/id/"+h},getContainedItemDetails:function(r,o,k,b){var d=o[0];var g=r.up("form");var a=g.down("textfield[name=reference]");var e=g.down("textarea[name=description]");var j=g.down("numberfield[name=quantity]");var m=g.down("displayfield[name=unit]");var n=g.down("displayfield[name=cost]");var c="N/A";if(g.type!="edit"){j.setValue(1)}if(d.get("image")){var q=g.down("box[name=itemKitImageBox]");q.update('<img src="'+d.get("image").url+'"  style="max-width:38px; max-height:38px;">')}if(d.get("unit")){var l=null;var h=null;var f=null;if(AL.config.currentKeyCountry=="mexico"){l=Ext.ComponentQuery.query("#mx_unitCombo")[0];h=l.getStore();f=h.findRecord("key",d.get("unit"));c=f?f.get("keyAndName"):""}else{l=Ext.ComponentQuery.query("combo[name=unit]")[0];h=l.getStore();f=h.findRecord("unit",d.get("unit"));c=f?f.get("text"):""}}a.setValue(d.get("reference"));e.setValue(d.get("description"));m.setValue(c);var s=this;var p=function(u){var t=u?Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(u,null,AL.config.decimalPrecision),j.getValue()),null,AL.config.decimalPrecision),AL.config.decimalPrecision):"";g.itemUnitCost=u;n.setValue(t);r.up("form").enableFields();s.updateTotalCost()};if(d.get("unitCost")){Ext.Ajax.request({url:"/item/retrieve-for-adjustment/id/"+d.get("idLocal")+"/format/json",success:function(t,v){var x=Ext.decode(t.responseText);if(x.success){var u=x.results;var w=u.averageCost;p(w)}else{GlobalMsg.showErrorMessage("Error",x.cause)}},failure:function(){}})}else{n.setValue("N/A")}},validateForm:function(){var a=Ext.ComponentQuery.query("item_FormAdd")[0];var b=true;if(!a.getForm().isValid()){b=false}var m=Ext.ComponentQuery.query("combo[name=priceListCombo]");var e=[];Ext.each(m,function(p){if(p.getValue()){if(e.indexOf(p.getValue())<0){e.push(p.getValue())}else{b=false;p.clearInvalid();p.markInvalid("Esta lista ya ha sido seleccionada")}}});var n=Ext.ComponentQuery.query("combo[name=warehouseCombo]");var d=[];Ext.each(n,function(p){if(p.getValue()){if(d.indexOf(p.getValue())<0){d.push(p.getValue())}else{b=false;p.clearInvalid();p.markInvalid("Esta "+translate("warehouse")+" ya ha sido seleccionada")}}});if(a.country==="mexico"){var j=a.down("checkbox[name=isInventariable]");var h;if(j.getValue()){h=a.down("combo#itemUnitCombo");if(!h.getSelectedRecord()){b=false;h.markInvalid("Debes seleccionar el ítem, no solo escribir su nombre")}}else{h=a.down("combo[name=unit]");if(!h.getSelectedRecord()){b=false;h.markInvalid("Debes seleccionar el ítem, no solo escribir su nombre")}}var g=a.down("combo[name=productKey]");if(!g.getSelectedRecord()){b=false;g.markInvalid("Debes seleccionar el ítem, no solo escribir su nombre")}}var l=a.down("combo[name=idItemCategory]");if(l&&!l.isHidden()){if(!l.getSelectedRecord()&&l.getValue()){b=false;l.markInvalid("Debes seleccionar la categoría, no solo escribir su nombre")}}var o={};var f=a.down("radiogroup[name=itemType]").getValue().itemType;if(f=="kit"){var c=Ext.ComponentQuery.query("item_FormItemsKitAddItem");var k=false;Ext.each(c,function(q){var p=q.down("combo[name=idLocal]");if(p.getSelectedRecord()){k=true;if(!q.isValid()){b=false;o.message="Hay un error en uno de los formularios del "+translate("item")}}});if(!k){b=false;o.message=translate("aKitMustContainAtLeastOneItem",true)}}o.result=b;return o},listClick:function(l,k){var m=this;var c=l.up("combo");var d=k.target.getAttribute("data-action");if(d==="quickNewItem"){k.preventDefault();var h="",a=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0],g=false,j="no",p=450;if(a){h="Invoice"}if(!a){a=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!a){a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!a){a=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!a){a=Ext.ComponentQuery.query("remission_FormAddRemission")[0];if(a){h="Remission"}}if(!a){a=Ext.ComponentQuery.query("bill_FormAddBill")[0];g=true;p=580;c=l.up("form").down("combo[name=idCategory]")}var o=Ext.create("AL.view.common.SmileWindow",{id:"window-new-item-modal",autoShow:true,modal:true,reason:"addNewItem",title:translate("addNew",true)+" "+translate("item"),width:990,height:p,bodyPadding:"0px 5px 0px 5px",bodyStyle:"overflow-y: auto;",maxHeight:Ext.getBody().getViewSize().height*0.7,items:[{xtype:"container",style:"position: relative;",id:"createNewItem",items:[Ext.create("AL.view.item.FormAdd",{title:"",bodyPadding:0,style:"margin-bottom: 0px",canPriceList:a.configs.canPriceList,country:a.configs.country,multicurrency:a.configs.multicurrency,currency:a.configs.currency,forceInventariable:g,configs:{showWarehouses:a.configs.showWarehouses,showCustomFields:a.configs.showCustomFields,stampVersion:a.configs.stampVersion,country:a.configs.country,canCreateNewTax:a.configs.canCreateNewTax,canCreateNewWarehouse:a.configs.canCreateNewWarehouse,defaultItemCategory:a.configs.defaultItemCategory,multipleTaxes:a.configs.multipleTaxes,isActiveElectronicInvoicing:a.configs.isActiveElectronicInvoicing,electronicInvoicingVersion:a.configs.electronicInvoicingVersion},emergent:true,callback:function(e){e.multipleTaxes=a.configs.multipleTaxes;m.application.fireEvent("itemCreated"+h,{record:e,initiator:c});o.close()}}),{xtype:"box",html:'<div id="itemsKitContainer"></div>'}]},{xtype:"container",id:"windowButtonsHolder",items:[Ext.create("AL.view.buttons.SubmitReset",{buttonsConfig:{submitButtonAction:"saveItem",submitButtonText:translate("save",true)}})],hidden:true,}],required:true,footer:{items:[{text:translate("cancelAction",true),handler:function(){o.close()}},{text:translate("save",true),cls:"button main-button",handler:function(e){var r=e.up("window");var q=r.down("button[action=saveItem]");if(q){q.fireEvent("click",q)}},listeners:{afterrender:function(e){var r=e.up("window");var q=r.down("form");e.setDisabled(q.hasInvalidField());q.on("validitychange",function(t,s){e.setDisabled(!s)})}}}]},listeners:{resize:function(s,r,e,q){s.center()}}})}else{if(d==="setupCategories"){k.preventDefault();var h="";var a=Ext.ComponentQuery.query("item_FormAdd")[0];var j="yes";if(!a){a=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!a){a=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!a){a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!a){a=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(!a){a=Ext.ComponentQuery.query("remission_FormAddRemission")[0]}if(a.emergent){window.open("/category","_blank");return}if(a&&a.configs&&a.configs.showCategoriesCode){j=a.configs.showCategoriesCode}var n="";if(a&&(a.country||a.configs.country)){n=a.country?a.country:a.configs.country}var b=Ext.create("AL.view.common.SmileWindow",{id:"window-setup-categories-modal",autoShow:true,modal:true,title:translate("selectTheAccountingAccountOfIncomeToWhichYourItemBelongs",true,{category:false,item:false}),smileTooltip:{text:'<div class="text" style="font-weight: normal;">'+translate("ifYouNeedHelpManagingYourCategories",true,{categories:false})+' <a target="_blank" href="https://ayuda.getsoft.app/clasifica-tu-informaci%C3%B3n-en-diferentes-cuentas-contables">'+translate("clickHere")+"</a>",style:"top: -10px;height: 50px;width: 300px;left: -240px;"},reason:"setupCategories",width:990,bodyStyle:"overflow-y: auto;",items:[{xtype:"container",style:"position: relative;",id:"createNewItem",items:[{xtype:"box",cls:"modal-title",style:"margin-bottom: 0px;",html:'<p style="font-family: Roboto; font-style: normal; font-weight: normal; line-height: 18px; font-size: 11px; text-align: center; color: #000000;">'+translate("customizeYourCategoriesCreateNewOnesAndAddTheCodeFromTheIconsInTheActionColumn",true,{categories:false})+".</p>"},{xtype:"container",id:"selectCategory",items:[{xtype:"category_CrudTree",title:"",height:290,showCategoriesCode:j,setAccountType:"ingresos",configs:{country:n,},emergent:true,store:Ext.create("AL.store.Categories",{proxy:{type:"ajax",url:"/category/retrieve-all/type/income/item/true/format/json"}}),listeners:{load:function(){var e=this;var r=e.getStore();var q=setInterval(function(){if(!r.isLoading()){clearInterval(q);e.expandAll()}},100);e.getSelectionModel().on("select",function(){var s=Ext.ComponentQuery.query("button[action=selectCategory]")[0];if(s){s.enable()}})}}}]},{xtype:"container",id:"windowButtonsHolder",items:[Ext.create("AL.view.buttons.SubmitReset",{buttonsConfig:{submitButtonAction:"selectCategory"}})],hidden:true}]}],footer:{items:[{text:translate("cancelAction",true),handler:function(){b.close()}},{text:translate("selectSimple",true),cls:"button main-button",handler:function(e){var r=e.up("window");var q=r.down("button[action=selectCategory]");if(q){q.fireEvent("click",q)}},listeners:{afterrender:function(e){var r=e.up("window");var q=r.down("form");e.setDisabled(q.hasInvalidField());q.on("validitychange",function(t,s){e.setDisabled(!s)})}}}]}});var f=Ext.ComponentQuery.query("button[action=selectCategory]")[0];if(f){f.setText(translate("selectSimple",true));f.disable()}b.on("close",function(){var e=c.getStore();e.load({url:"/category/retrieve-for-combo/format/json/type/income/item/true/includeFixedAsset/false/includeItems/false"})})}}},loadSelectedCategory:function(d,b){if(d&&b){var a=d.down("combo[name=idCategory]");var c=a.getStore();c.load({callback:function(){var e=c.findRecord("idLocal",b);a.select(e)}})}},renderTooltipWarehouse:function(a,e){var g=e?"none":"block";var d=a.down("container[name=warehouseContainer]");isTop=d.hidden?true:false;var c=document.getElementById("tooltip-one-warehouse");c.style.display=g;if(g==="none"){return}var b=a.down("checkbox[name=isInventariable]");var f=b.hidden;if(isTop){c.style.marginLeft="420px";c.style.marginTop=f?"13px":"32px"}else{c.style.marginLeft="430px";c.style.marginTop=f?"46px":"67px"}},promptFileUploadWindowOnClick:function(b,a,e,d){var c=false;b.getEl().on("click",function(g,k){if(c){return}c=true;var j=false;var f=b.getEl().getHTML();var h=Ext.create("AL.view.company.FileUploadWindow",{asyncUpload:e.asyncUpload,title:e.title,url:e.url,fieldName:e.fieldName,fieldLabel:e.fieldLabel,buttonText:e.buttonText,helpText:e.helpText,forceUploadEmptyResource:true,hideFileSuccessMessage:true,attachmentType:"item-gallery",height:200,onSubmit:function(l,m){j=true;Ext.create("Ext.fx.Anim",{target:l,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){l.close()}});Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){b.update('<div class="form-add-invoice-image-zone-loading" style="width: 240px; height: 220px;"></div>');Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(m,l,n){c=false;Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var o=new Image;o.onload=function(r){var q=(o.width*Math.min(b.configs.maxHeight,o.height))/o.height;var p="";if(q<b.configs.maxWidth){p="width: auto; max-height: "+b.configs.maxHeight+"px;"}else{p="height: auto; max-width: "+b.configs.maxWidth+"px;"}b.update('<div style="cursor: pointer;"><div class="form-add-common-image-zone form-add-item-image-zone" style="border: none; padding: 0px;"  onselectstart="return false;"><img src="'+l[a]+'" style="margin: 0 auto; '+p+'" /></div></div>');if(d){d(l)}Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})};o.src=l[a]}})},onFailure:function(m,l,o){c=false;Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){b.update(f);Ext.create("Ext.fx.Anim",{target:b,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof l=="string"||!l.cause){Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}else{var n=l.title?l.title:translate("error",true);Ext.MessageBox.alert(n,l.cause)}},onClose:function(l){if(!j){c=false}}});h.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:h,duration:300,from:{opacity:0},to:{opacity:1}})},b)},updateTotalCost:function(){var a=Ext.ComponentQuery.query("item_FormItemsKitAddItem");var c=0;Ext.each(a,function(e){if(e.itemUnitCost){var d=e.down("displayfield[name=cost]");var g=e.down("numberfield[name=quantity]");var f=AL.math.approx(AL.math.mul(AL.math.approx(e.itemUnitCost,null,AL.config.decimalPrecision),g.getValue()),null,AL.config.decimalPrecision);c=AL.math.add(c,f);d.setValue(Ext.util.Format.usMoney(f,AL.config.decimalPrecision))}});var b=Ext.ComponentQuery.query("box[name=costDisplay]")[0];b.update('<div class="totalCostLabel">'+translate("totalCost",true)+" "+Ext.util.Format.usMoney(c,AL.config.decimalPrecision)+"</div>")},addLabelsToFirstForm:function(){var a=Ext.ComponentQuery.query("item_FormAddWarehouse");if(a.length>0){a[0].down("combo[name=warehouseCombo]").setFieldLabel(translate("warehouse",true));a[0].down("textfield[name=initialQuantity]").setFieldLabel(translate("initialQuantity",true));a[0].down("textfield[name=minQuantity]").setFieldLabel(translate("minimumQuantity",true));a[0].down("textfield[name=maxQuantity]").setFieldLabel(translate("maximumQuantity",true));a[0].down("button[action=deleteWarehouse]").setMargin("15 0 0 5")}}});Ext.define("AL.view.journal.FormAddJournalCategory",{extend:"Ext.form.Panel",alias:"widget.journal_FormAddJournalCategory",cls:"form-add-category-component",requires:["AL.view.ux.form.GroupingComboBox"],bodyPadding:5,border:false,layout:"hbox",defaults:{anchor:"100%",blankText:translate("thisFieldIsRequired",true),msgTarget:"side",cls:"journal-category-input"},listeners:{render:function(){var a=this.down("combo[name=idCategory]");a.on("change",function(d,b,c){if(d.getSelectedRecord()){d.selectedRecord=d.getSelectedRecord()}});a.on("blur",function(d,c,b){if(!d.getSelectedRecord()){d.markInvalid(translate("youMustSelectAField",true,{a:"{{theM}}",field:"{{categoryTitle}}"})+", "+translate("notJustWriteItsField",false,{field:"{{name}}"}))}})}},defaultType:"textfield",items:[{xtype:"combo",itemId:"clientCombo",name:"idClient",store:"ClientsCombo",labelAlign:"right",width:148,triggerCls:"x-form-search-trigger",labelPad:15,minChars:0,typeAhead:true,emptyText:translate("selectSimple",true)+" "+translate("theM")+" "+translate("client"),triggerAction:"all",matchFieldWidth:false,forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewContact" class="createNewContact">'+translate("newContact",true)+"</a></div>",width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},displayField:"name",valueField:"idLocal"},{xtype:"displayfield",name:"categoryName",hidden:true,width:170},{xtype:"groupingcombobox",name:"idCategory",cls:"category-combo-component journal-category-input",allowBlank:false,groupField:["parentName"],valueField:"idLocal",displayField:"text",store:"CategoriesCombo",queryMode:"remote",typeAhead:true,emptyText:translate("selectSimple",true)+" "+translate("theM")+" "+translate("categoryTitle"),width:190,matchFieldWidth:false,disabledField:"blocked",disabledValue:"yes",listConfig:{width:260,height:200},forceSelection:true},{xtype:"displayfield",name:"description",hidden:true,width:190},{xtype:"textarea",name:"description",emptyText:translate("description",true),width:180},{xtype:"combo",name:"idCostCenter",hidden:true,allowBlank:true,emptyText:translate("costCenter",true),width:120,store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,queryMode:"remote",forceSelection:true,disabled:false,},{xtype:"displayfield",name:"debit",hidden:true,width:105},{name:"debit",emptyText:translate("ledger.debit",true),regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),allowBlank:false,width:105},{xtype:"displayfield",name:"credit",hidden:true,width:105},{name:"credit",emptyText:translate("ledger.credit",true),regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),allowBlank:false,width:105},{xtype:"button",action:"deleteItem",width:16,height:16,style:"",baseCls:"none",}]});Ext.define("AL.controller.Journal",{extend:"Ext.app.Controller",views:["journal.FormAddJournalCategory","journal.FormAddJournal","journal.GridAll","journal.InitialBalanceLayout","journal.InitialBalanceTopFields","category.CrudTree",],stores:["CategoriesCombo","Journals","ClientsCombo","CostCentersCombo",],models:["Journal","CostCenter",],openingBalanceStoreloads:0,showNoficationDuplicityInfo:true,hasWindowBeforeUnload:false,init:function(){var a=Ext.get("add-category-link");if(a){a.on("click",function(c,b){c.preventDefault();this.addCategoryForm()},this)}this.application.addListener("deleteJournal",function(d){var b=d.record;var c=d.initiator;var g=b.get("idLocal");var f=translate("remove",true)+" "+translate("journal")+"";var e=translate("areYouSureYouWantToDelete",true)+" "+translate("theJournal")+" "+translate("journal")+"? "+translate("thisOperationCannotBeUndone",true)+".";if(g==0){f=translate("titleDeleteOpeningBalance",true);e=translate("confirmDeleteOpeningBalance",true)}else{if(b.get("numberResource")&&b.get("statusResource")==="closed"){e=translate("areYouSureYouWantToDelete",true)+" "+translate("theJournal")+" "+translate("journal")+"? <br> "+translate("thisOperationWillReopenThe",true)+" "+translate(b.get("resourceTypeOfResource"))+" "+translate("number",true)+": "+b.get("numberResource")}}Ext.Msg.show({title:f,msg:e,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/journal/delete/format/json",method:"POST",params:{id:b.get("idLocal"),notification:"no"},success:function(k,m){var o=Ext.decode(k.responseText);if(o.success){var j=c.getStore();j.load();if(g==0){GlobalMsg.showNotification({title:translate("success",true),text:translate("openingBalanceDeleteSuccess",true),type:"success"});var l=Ext.get("btnOpeningBalance");if(l){l.dom.href="/journal/add-opening-balance";var n=l.el.down("span");n.dom.innerHTML=translate("newBtnInitialBalance",true)}}}else{if(o.cause){Ext.MessageBox.alert("Error",o.cause)}}},failure:function(){}})}}})},this);this.application.addListener("clientCreated",function(e){var d=e.initiator;var b=e.record;var c=d.getStore();c.add(b);c.getProxy().clearCacheByTerms([b.get("name")]);d.select(b.get("idLocal"))},this);this.control({journal_InitialBalanceTopFields:{beforerender:function(b){if(b.configs&&b.configs.date){b.down("datefield[name=date]").setValue(b.configs.date)}}},journal_InitialBalanceLayout:{beforerender:function(c){var e=c.down("panel[itemId=resultsContent]");var b=c.down("panel[itemId=balanceContent]");var g=c.down("displayfield[itemId=totalBalanceLeft]");var n=c.down("displayfield[itemId=totalBalanceRight]");var l=false;var q=false;var h=false;if(c.configs.canShowLedger){h=true}if(c.configs.onlyView){l=true;this.showNoficationDuplicityInfo=false}if(c.configs.edit){q=true}var d=this.createTreeByType("one",true,l,h,q);var p=this.createTreeByType("two",true,l,h,q);var f=this.createTreeByType("three",true,l,h,q);var m=this.createTreeByType("asset",true,l,h,q);var o=this.createTreeByType("liability",true,l,h,q);var k=this.createTreeByType("equity",true,l,h,q);e.add(d,p,f);b.insert(0,m);b.insert(1,o);b.insert(2,k);g.setValue("$ 0.00");n.setValue("$ 0.00");c.type="opening-balance";if(l||q){var j=this;var r=[d.up().up().configs.idCategoryRuleUtility,d.up().up().configs.idCategoryRuleBanks,d.up().up().configs.idCategoryRuleInventory];d.getStore().on("load",function(){j.calculateAgregationTotalAll(d.getRootNode(),r);j.updateTotals(d);j.updateCardTotals()});p.getStore().on("load",function(){j.calculateAgregationTotalAll(p.getRootNode(),r);j.updateTotals(p);j.updateCardTotals()});f.getStore().on("load",function(){j.calculateAgregationTotalAll(f.getRootNode(),r);j.updateTotals(f);j.updateCardTotals()});m.getStore().on("load",function(){j.calculateAgregationTotalAll(m.getRootNode(),r);j.updateTotals(m);j.updateCardTotals()});o.getStore().on("load",function(){j.calculateAgregationTotalAll(o.getRootNode(),r);j.updateTotals(o);j.updateCardTotals()});k.getStore().on("load",function(){j.calculateAgregationTotalAll(k.getRootNode(),r);j.updateTotals(k);j.updateCardTotals()})}},afterrender:function(b){if(this.showNoficationDuplicityInfo){this.showModalNotificationDuplicityInfo()}}},journal_FormAddJournal:{render:function(b){if(b.edit||b.idJournal){GlobalLoadMask.show("category-wrapper");GlobalLoadMask.show("generalContainer")}if(b.edit){this.populateForm(b.id)}else{if(b.idJournal){this.populateForm(b.idJournal)}}},},"journal_FormAddJournalCategory textarea[name=description]":{render:function(b){var c=Ext.ComponentQuery.query("journal_FormAddJournal")[0];if(c&&!c.configs.costCenter.isActive){b.width=318}}},"journal_FormAddJournalCategory combo[name=idCostCenter]":{beforerender:function(b){var c=Ext.ComponentQuery.query("journal_FormAddJournal")[0];if(c&&c.configs.costCenter.isActive){b.show()}},render:function(c){var b=Ext.create("AL.store.CostCentersCombo");c.store=b}},"journal_FormAddJournalCategory combo[name=idClient]":{render:function(c){var b=Ext.create("AL.store.ClientsCombo");c.store=b},afterrender:function(b){var d=Ext.ComponentQuery.query("journal_FormAddJournal")[0];var c=d.configs.hasSeenJournalContactNotification;if(typeof c=="undefined"||c||d.contactNotification){return}var e=function(f){Ext.Ajax.request({url:"/user/update-metadata/format/json",method:"POST",params:{metadata:JSON.stringify({hasSeenJournalContactNotification:true})},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){f.close();GlobalMask.hide()}},failure:function(){}})};GlobalMask.show("dark");d.contactNotification=Ext.create("AL.view.ux.window.ModalTooltip",{cls:["modal-tooltip","journal-contact-notification"],title:"Nuevo campo Contacto",targetEl:b,targetImg:"https://cdn1.getsoft.app/images/client-combo.png",targetImgStyle:{width:"181px","margin-left":"-6px","margin-top":"-6px",},positionBy:"setPosition",modal:false,offsets:[183,-100],closeCallback:e,width:320,bodyHtml:"Ahora puedes asociar un <b>contacto</b> por cada línea en tus <b>"+translate("journals")+"</b>.",footerItems:[{xtype:"button",hrefTarget:"blank",text:"Ver más",padding:"4 20",cls:["sm-button-outline","sm-button-outline-secondary"],href:"https://ayudas.getsoft.app/es/articles/1711325"},"->",{xtype:"button",text:"Entendido",cls:"sm-button-primary",padding:"4 20",handler:function(){e(this.up("window"))}},],autoShow:false,});setTimeout(function(){d.contactNotification.queueToShow()},100)},},"journal_FormAddJournalCategory groupingcombobox[name=idCategory]":{afterrender:function(d){var b=Ext.create("AL.store.CategoriesCombo");var c=b.getProxy();c.url="/category/retrieve-for-combo/types/asset-liability-equity-expense-income-other/format/json";d.store=b;b.load()},blur:function(b){b.getStore().clearFilter()}},"journal_FormAddJournalCategory button[action=deleteItem]":{click:function(b){var c=b.up("form");c.destroy();this.calculateTotal()}},"journal_FormAddJournalCategory textfield[name=credit], journal_FormAddJournalCategory textfield[name=debit]":{change:function(b){this.disableFields(b);this.calculateTotal()}},"buttons_SubmitReset button[action=save]":{click:this.saveJournal},"journal_GridAll gridcolumn[type=journalActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteJournal")){k.preventDefault();if(d.get("deletable")){m.fireEvent("deleteJournal",{record:d,initiator:b})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("thisJournal")+" "+translate("journal"))}}}}})},treeToJson:function(a){var b=[];var c=this;Ext.each(a,function(e){if(!isNaN(e.data.amount)&&e.data.amount!=null&&e.data.amount!=""){var d={idLocal:e.data.idLocal,amount:e.data.amount};b.push(d)}if(e.childNodes.length>0){b=b.concat(c.treeToJson(e.childNodes))}});return b},saveOpeningBalance:function(e){e.disable();var c=Ext.ComponentQuery.query("journal_InitialBalanceTopFields")[0];var j=Ext.ComponentQuery.query("journal_InitialBalanceLayout")[0];var b=c.down("datefield[name=date]");var k={};var f=[];if(!b){e.enable();return false}if(!b.getValue()){Ext.MessageBox.alert("Error",translate("wrongDate",true));e.enable();return false}k.date=Ext.Date.format(b.getValue(),"Y-m-d");var m=["one","two","three","asset","liability","equity"];for(var d=0;d<m.length;d++){var l=this.getTreeByType(m[d]);f=f.concat(this.treeToJson(l.getRootNode().childNodes))}if(f.length==0){GlobalMsg.showErrorMessage("Error",translate("wrongDataForm",true),"no");e.enable();return false}if(!this.isValidBalance()){GlobalMsg.showErrorMessage("Error",translate("wrongGeneralBalance",true),"no");e.enable();return false}GlobalRedirector.go({zoneTitle:"Guardando "+translate("initialBalanceTitle")});k.categories=Ext.JSON.encode(f);var a="/journal/add-opening-balance/format/json";if(j.configs.edit){a="/journal/edit-opening-balance/format/json";var g=c.down("hidden[name=idLocal]");if(!g.getValue()){g.setValue(0)}k.idLocal=g.getValue()}var h=this;Ext.Ajax.request({url:a,method:"POST",params:k,success:function(n,o){var p=Ext.decode(n.responseText,true);if(p&&p.success){this.hasWindowBeforeUnload=false;Ext.EventManager.removeListener(window,"beforeunload",null,h);window.location="/journal/view-opening-balance"}else{e.enable();GlobalRedirector.close()}},failure:function(){e.enable();GlobalRedirector.close()}})},showModalNotificationDuplicityInfo:function(){var b=this,a=translate("openingBalanceDuplicityInfo1",true)+" <br /><br /> "+translate("openingBalanceDuplicityInfo2",true);a=a.replace("{bank}",'<a href="/account" target="_blank">'+translate("bankDetails",true)+"</a>").replace("{items}",'<a href="/item" target="_blank">'+translate("itemsForSale",true)+"</a>").replace("{linkHelp}",'<a href="https://ayudas.getsoft.app/es/articles/3514433" target="_blank" class="has-text-bold">'+translate("btnThisHelp")+"</a>");var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,id:"window-opening-balance-duplicity",width:600,laytout:"fit",modal:true,reason:"notificationDuplicityInfo",border:false,title:translate("openingBalanceDuplicityInfoTitle",true),items:[{xtype:"box",html:'<div class="opening-balance-modal-box">'+a+"</div>",style:"background: #eee"}],footer:{items:[{text:translate("btnUnderstood",true),cls:"button main-button",handler:function(d){c.close()},}]}})},saveJournal:function(d){var f=d.up();if(f.type&&f.type=="opening-balance"){this.saveOpeningBalance(d);return}if(this.validateForms()){d.disable();GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("journal")});var g=Ext.ComponentQuery.query("journal_FormAddJournal")[0];var e=Ext.ComponentQuery.query("journal_FormAddJournalCategory");var b=g.getValues();var a=[];Ext.each(e,function(h){a.push(h.getValues())});b.categories=Ext.encode(a);var c=(g.edit)?"/journal/edit/format/json":"/journal/add/format/json";Ext.Ajax.request({url:c,method:"POST",params:b,success:function(h,j){var k=Ext.decode(h.responseText,true);if(k&&k.success){var l=k.results;window.location="/journal/view/id/"+l}else{d.enable();GlobalRedirector.close()}},failure:function(){d.enable();GlobalRedirector.close()}})}},addCategoryForm:function(){var a=Ext.ComponentQuery.query("journal_FormAddJournal")[0];Ext.create("AL.view.journal.FormAddJournalCategory",{renderTo:"category-forms-wrapper",configs:{country:a.configs.country,}})},calculateTotal:function(){var b=Ext.get("total-debit");var g=Ext.get("total-credit");var d=0,c=0,f=false,e=false;var a=Ext.ComponentQuery.query("journal_FormAddJournalCategory");Ext.each(a,function(j){var k=j.down("textfield[name=debit]");var h=j.down("textfield[name=credit]");if(k.getValue()&&k.isValid()){d=AL.math.approx(AL.math.add(d,AL.math.approx(k.getValue(),null,2)),null,2);f=true}if(h.getValue()&&h.isValid()){c=AL.math.approx(AL.math.add(c,AL.math.approx(h.getValue(),null,2)),null,2);e=true}});b.setHTML(Ext.util.Format.usMoney(d,2));g.setHTML(Ext.util.Format.usMoney(c,2));return{totalDebit:d,totalCredit:c,hasDebit:f,hasCredit:e}},disableFields:function(c){var b=c.up("form");var d=b.down("textfield[name=debit]");var a=b.down("textfield[name=credit]");if(!d.getValue()&&!a.getValue()){d.enable();a.enable()}else{if(d.getValue()){a.disable()}else{if(a.getValue()){d.disable()}}}},populateForm:function(c){var b=this;var d=Ext.ComponentQuery.query("journal_FormAddJournal")[0];var a=d&&d.idJournal;Ext.Ajax.request({url:"/journal/retrieve-one/id/"+c+(a?"/decimalPrecisionCompany/true":"")+"/format/json",success:function(j,m){var o=Ext.decode(j.responseText,true);if(o.success){var g=d.down("datefield[name=date]");var e=o.results;var n=e.categoryAdjustments;var k=e.resourceType=="advanceApplied"?true:false;if(a){if(e.date){delete e.date}if(e.reference){delete e.reference}if(e.observations){delete e.observations}}d.getForm().setValues(e);if(g&&k){var q=new Date(e.invoiceDate);var f=new Date(e.transactionDate);if(q>f){var h=e.invoiceDate}else{var h=e.transactionDate}g.setMinValue(h)}GlobalLoadMask.hide("generalContainer");var l=1;var p=n.length;Ext.each(n,function(y){var s=Ext.create("AL.view.journal.FormAddJournalCategory",{renderTo:"category-forms-wrapper",configs:{country:d.configs.country,}});var B=s.down("combo[name=idClient]");if(y.idClient){var w=Ext.create("AL.model.Client",{idLocal:y.idClient,name:y.name,});B.getStore().add(w);B.select(w)}if(k){B.setDisabled(true)}var C=s.down("groupingcombobox[name=idCategory]");var r=s.down("textarea[name=description]");var v=s.down("combo[name=idCostCenter]");var z=s.down("textfield[name=debit]");var E=s.down("textfield[name=credit]");var F=C.getStore();var H=function(){C.select(y.idCategory);if(k){var I=s.down("displayfield[name=categoryName]");selectedValue=C.getSelectedRecord();I.setValue(selectedValue.get("text"));I.show()}};if(F.hasLoaded()){H()}else{F.on("load",function(){H()})}var D=y.debit;var x=y.credit;if(a){D=D?AL.math.approx(D,d.config.decimalPrecision):D;x=x?AL.math.approx(x,d.config.decimalPrecision):x}r.setValue(y.description);z.suspendEvents();E.suspendEvents();z.setValue(D);E.setValue(x);z.resumeEvents();E.resumeEvents();b.disableFields(z);if(d.configs.costCenter.isActive){v.show();if(v){if(y.idCostCenter){b.setCostCenterField(v,y.idCostCenter)}}}if(k){var G=s.down("button[action=deleteItem]");var A=s.down("displayfield[name=description]");var u=s.down("displayfield[name=debit]");var t=s.down("displayfield[name=credit]");A.setValue(y.description);if(y.debit){u.setValue(Ext.util.Format.usMoney(y.debit,2))}if(y.credit){t.setValue(Ext.util.Format.usMoney(y.credit,2))}A.show();u.show();t.show();G.hide();C.hide();r.hide();v.hide();z.hide();E.hide()}if(l==p){GlobalLoadMask.hide("category-wrapper");b.calculateTotal()}l++})}},failure:function(){}})},validateForms:function(){var g=Ext.ComponentQuery.query("journal_FormAddJournal")[0];var f=Ext.ComponentQuery.query("journal_FormAddJournalCategory");var e=false;var a=translate("checkTheFieldsMarkedInRed",true);if(g.isValid()){e=true;if(f&&f.length===0){e=false;a=translate("youMustAddSome",true)+" "+translate("category")+" "+translate("toTheJournal")+" "+translate("journal")}else{var d=[];var c=[];Ext.each(f,function(l){var m=l.down("groupingcombobox[name=idCategory]"),h=m.getSelectedRecord(),k=l.down("combo[name=idCostCenter]"),j=null;if(k){var j=k.getSelectedRecord()}if(h&&d.indexOf(h.get("idLocal"))===-1){d.push(h.get("idLocal"))}if(j&&c.indexOf(j.get("idLocal"))===-1){c.push(j.get("idLocal"))}if(!h){m.markInvalid(translate("youMustSelectAField",true,{a:"{{theF}}",field:"{{category}}"})+", "+translate("notJustWriteItsField",false,{field:"{{name}}"}));e=false}else{if(!l.isValid()){e=false}}});if(e&&d.length<=1){if(c.length<=d.length){a=translate("youMustAddAtLeastTwoDifferentDocuments",true,{documents:"{{categories}}"});e=false}}}if(e){var b=this.calculateTotal();if(!b.hasCredit){e=false;a=translate("youMustAddAtLeastOneTypeAccount",true,{type:"{{ledger.credit}}"})}else{if(!b.hasDebit){e=false;a=translate("youMustAddAtLeastOneTypeAccount",true,{type:"{{ledger.debit}}"})}else{if(b.totalDebit!=b.totalCredit){e=false;a=translate("theSumOfTheDebitsMustEqualTheSumOfTheCredits",true)}}}}}if(!e){GlobalMsg.showNotification({title:"Error",text:a,type:"error"})}return e},isValidBalance:function(){var b=Ext.ComponentQuery.query("displayfield[itemId=totalBalanceLeft]")[0];var a=Ext.ComponentQuery.query("displayfield[itemId=totalBalanceRight]")[0];if(b&&a){if(b.getValue()==a.getValue()){return true}}return false},updateCardTotals:function(){this.openingBalanceStoreloads++;if(this.openingBalanceStoreloads==6){var e=["income","expense","asset","liability","equity"];var c=this.getOpeningBalanceTotalIncomeExpense();for(var b=0;b<e.length;b++){var a=Ext.get("card-"+e[b]);if(a){switch(e[b]){case"income":a.setHTML(Ext.util.Format.usMoney(c.income,2));break;case"expense":a.setHTML(Ext.util.Format.usMoney(c.expense,2));break;default:var d=Ext.get("total-"+e[b]);if(typeof d!="undefined"){a.setHTML(d.dom.innerText)}break}}}}},getTotalTreeByType:function(a){var b=Ext.get("total-"+a);if(b){var c=b.getHTML();if(c!=""){c=c.replace(/[\$,\,]/g,"")}if(!isNaN(c)){return c}}return 0},updateTotals:function(m){var g="";var y=0;var e=Ext.ComponentQuery.query("displayfield[itemId=totalBalanceLeft]")[0];var q=Ext.ComponentQuery.query("displayfield[itemId=totalBalanceRight]")[0];if(m){if(m.itemId){g=m.itemId.substring(5)}y=this.calculateInitialBalanceTotal(m.getRootNode().childNodes)}switch(g){case"one":var k=this.getTreeByType("two");var n=0,t=0;if(k){n=this.calculateInitialBalanceTotal(k.getRootNode().childNodes)}var j=Ext.get("total-two");if(j){n=AL.math.add(y,n);j.setHTML(Ext.util.Format.usMoney(n,2))}var p=this.getTreeByType("three");if(p){t=this.calculateInitialBalanceTotal(p.getRootNode().childNodes)}var f=Ext.get("total-three");if(f){t=AL.math.add(t,n);f.setHTML(Ext.util.Format.usMoney(t,2))}break;case"two":var v=this.getTotalTreeByType("one");y=AL.math.add(y,v);var p=this.getTreeByType("three");if(p){t=this.calculateInitialBalanceTotal(p.getRootNode().childNodes)}var f=Ext.get("total-three");if(f){t=AL.math.add(t,y);f.setHTML(Ext.util.Format.usMoney(t,2))}break;case"three":var n=this.getTotalTreeByType("two");y=AL.math.add(n,y);break}var r=Ext.get("total-"+g);if(r){r.setHTML(Ext.util.Format.usMoney(y,2))}switch(g){case"one":case"two":case"three":var b=m.up();var h=this.getOpeningBalanceTotalIncomeExpense();if(b){var o=this.getTreeByType("equity");if(o){var s=null;Ext.each(o.getRootNode().childNodes,function(z){if(z.data.idCategoryRule==o.up().up().configs.idCategoryRuleUtility){s=z;return false}});if(s){var l=AL.math.sub(h.income,h.expense);if(!isNaN(s.sumAmount)&&s.sumAmount!=null){s.data.sumAmount=AL.math.add(s.sumAmount,l)}else{if(!isNaN(s.data.amount)&&s.data.amount!=null){s.data.sumAmount=AL.math.add(s.data.amount,l)}else{s.data.sumAmount=l}}s.commit();this.updateTotals(o)}}}break;case"income":var b=m.up();var a=0;if(b){var o=this.getTreeByType("equity");if(o){var s=null;Ext.each(o.getRootNode().childNodes,function(z){if(z.data.idCategoryRule==o.up().up().configs.idCategoryRuleUtility){s=z;return false}});if(s){var d=b.down("panel[itemId=tree_expense]");if(d){a=this.calculateInitialBalanceTotal(d.getRootNode().childNodes)}var l=AL.math.sub(y,a);if(!isNaN(s.sumAmount)&&s.sumAmount!=null){s.data.sumAmount=AL.math.add(s.sumAmount,l)}else{if(!isNaN(s.data.amount)&&s.data.amount!=null){s.data.sumAmount=AL.math.add(s.data.amount,l)}else{s.data.sumAmount=l}}s.commit();this.updateTotals(o)}}}break;case"expense":var b=m.up();var c=0;if(b){var o=this.getTreeByType("equity");if(o){var s=null;Ext.each(o.getRootNode().childNodes,function(z){if(z.data.idCategoryRule==o.up().up().configs.idCategoryRuleUtility){s=z;return false}});if(s){var u=b.down("panel[itemId=tree_income]");if(u){c=this.calculateInitialBalanceTotal(u.getRootNode().childNodes)}var l=AL.math.sub(c,y);if(!isNaN(s.sumAmount)&&s.sumAmount!=null){s.data.sumAmount=AL.math.add(s.sumAmount,l)}else{s.data.sumAmount=l}s.commit();this.updateTotals(o)}}}break;case"asset":if(e){e.setValue(Ext.util.Format.usMoney(y,2))}break;case"liability":var b=m.up();if(b){var o=b.down("panel[itemId=tree_equity]");if(o){y+=this.calculateInitialBalanceTotal(o.getRootNode().childNodes)}}if(q){q.setValue(Ext.util.Format.usMoney(y,2))}break;case"equity":var b=m.up();if(b){var x=b.down("panel[itemId=tree_liability]");if(x){y+=this.calculateInitialBalanceTotal(x.getRootNode().childNodes)}}if(q){q.setValue(Ext.util.Format.usMoney(y,2))}break;default:break}if(q&&e){var w=e.up("container[itemId=initialBalanceContainer]");if(w){if(AL.math.comp(q.getValue(),e.getValue())==0){w.removeCls("initial-balance-totals-bg-error")}else{w.addCls("initial-balance-totals-bg-error")}}}},calculateAgregationTotalAll:function(b,c){if(b.childNodes.length==0){this.calculateAgregationTotal(b,c)}else{for(var a=0;a<b.childNodes.length;a++){this.calculateAgregationTotalAll(b.childNodes[a],c)}}},getOpeningBalanceTotalIncomeExpense:function(){var a=[this.getTreeByType("one"),this.getTreeByType("two"),this.getTreeByType("three")];var d=0;var c=0;for(var b=0;b<a.length;b++){if(a[b]){Ext.each(a[b].getRootNode().childNodes,function(e){if(e.data.type=="income"){if(!isNaN(e.data.sumAmount)&&e.data.sumAmount!=null){d=AL.math.add(d,e.data.sumAmount)}else{if(!isNaN(e.data.amount)&&e.data.amount!=null){d=AL.math.add(d,e.data.amount)}else{if(e.childNodes.length>0){d=AL.math.add(d,me.calculateInitialBalanceTotal(e.childNodes))}}}}else{if(e.data.type=="expense"){if(!isNaN(e.data.sumAmount)&&e.data.sumAmount!=null){c=AL.math.add(c,e.data.sumAmount)}else{if(!isNaN(e.data.amount)&&e.data.amount!=null){c=AL.math.add(c,e.data.amount)}else{if(e.childNodes.length>0){c=AL.math.add(c,me.calculateInitialBalanceTotal(e.childNodes))}}}}}})}}c=AL.math.mul(-1,c);return{income:d,expense:c}},calculateAgregationTotal:function(e,g){var d=0;var b=0;var c=this;if(e){if(e.childNodes.length==0){if(e.parentNode){if(!isNaN(e.parentNode.data.amount)&&e.parentNode.data.amount!==null){if(e.parentNode.data.type=="expense"){d=AL.math.add(d,AL.math.mul(-1,e.parentNode.data.amount))}else{d=AL.math.add(d,e.parentNode.data.amount)}}Ext.each(e.parentNode.childNodes,function(h){if(!isNaN(h.data.amount)&&h.data.amount!==null){if(h.data.type=="expense"){d=AL.math.add(d,AL.math.mul(-1,h.data.amount))}else{d=AL.math.add(d,h.data.amount)}}});e.parentNode.data.sumAmount=d;e.parentNode.commit();var f=0;if(e.data.idCategoryRule&&e.data.idCategoryRule==g[0]){var a=this.getOpeningBalanceTotalIncomeExpense();f=AL.math.sub(a.income,a.expense)}b=(isNaN(e.data.amount)||e.data.amount==""||e.data.amount==null)?0:e.data.amount;if(e.data.type=="expense"){d=AL.math.mul(-1,b)}else{d=b}e.data.sumAmount=AL.math.add(d,f);e.commit();c.calculateAgregationTotal(e.parentNode,g)}}else{if(e.parentNode){Ext.each(e.childNodes,function(h){if(!isNaN(h.data.sumAmount)&&h.data.sumAmount!==null){d=AL.math.add(d,h.data.sumAmount)}else{b=(isNaN(h.data.amount)||h.data.amount==""||h.data.amount==null)?0:h.data.amount;if(h.data.type=="expense"){d=AL.math.add(d,AL.math.mul(-1,b))}else{d=AL.math.add(d,b)}}});b=(isNaN(e.data.amount)||e.data.amount==""||e.data.amount==null)?0:e.data.amount;if(e.data.type=="expense"){e.data.sumAmount=AL.math.add(d,AL.math.mul(-1,b))}else{e.data.sumAmount=AL.math.add(d,b)}e.commit();c.calculateAgregationTotal(e.parentNode,g)}}}},calculateInitialBalanceTotal:function(a){var c=0;var b=this;Ext.each(a,function(d){if(!isNaN(d.data.sumAmount)&&d.data.sumAmount!=null){c=AL.math.add(c,d.data.sumAmount)}else{if(!isNaN(d.data.amount)&&d.data.amount!=null){c=AL.math.add(c,d.data.amount)}else{if(d.childNodes.length>0){c=AL.math.add(c,b.calculateInitialBalanceTotal(d.childNodes))}}}});return c},getTreeByType:function(c){var a=null;var b=null;switch(c){case"income":case"expense":case"one":case"two":case"three":b=Ext.ComponentQuery.query("panel[itemId=resultsContent]")[0];break;case"asset":case"liability":case"equity":b=Ext.ComponentQuery.query("panel[itemId=balanceContent]")[0];break}if(b){a=b.down("panel[itemId=tree_"+c+"]")}return a},onBeforeUnload:function(a){if(window.event){window.event.returnValue=translate("openingBalanceLeaving",true)}return translate("openingBalanceLeaving",true)},addEventWindowUnload:function(){if(!this.hasWindowBeforeUnload){this.hasWindowBeforeUnload=true;Ext.EventManager.addListener(window,"beforeunload",this.onBeforeUnload,this)}},createTreeByType:function(g,a,h,e,k){var d=null;var f=this;var b="/category/retrieve-all/type/"+g+"/item/true/format/json";var j=g;var c=g+"Total";switch(g){case"one":case"two":case"three":b=(e)?"/report/retrieve-profit-and-loss/section/"+g+"/format/json/ledger/yes":"/report/retrieve-profit-and-loss/section/"+g+"/format/json/ledger/no";j=g+"OpeningBalance";break}if(h||k){b+="/opening-balance/yes"}var a=typeof a!="undefined"||false;if(a){d={html:'<div class="initial-balance-totals">'+translate(c,true)+' <span id="total-'+g+'">$0.00</span></div>',height:60,cls:"initial-balance-totals-inline"}}var l=new Ext.tree.TreePanel({title:translate(j,true)+'<div class="initial-balance-title-agregate">'+translate("agregate",true)+'</div><div class="initial-balance-title-balance">'+translate("balance",true)+"</div>",rootVisible:false,useArrows:false,autoScroll:true,animate:true,enableDD:true,lines:true,containerScroll:false,hideHeaders:true,itemId:"tree_"+g,cls:["initial-balance-subtitles"],store:Ext.create("AL.store.Categories",{proxy:{type:"ajax",url:b},}),viewConfig:{getRowClass:function(m,o,p,n){if(m.parentNode&&m.parentNode.get("text")=="Root"){return"initial-balance-row-first"}return""}},columns:[{xtype:"treecolumn",text:"",sortable:false,flex:2,dataIndex:"text",},{name:"idCategoryRule",dataIndex:"idCategoryRule",hidden:true},{name:"type",dataIndex:"type",hidden:true},{xtype:"numbercolumn",name:"amount",dataIndex:"amount",text:translate("balance",true),width:136,editor:{xtype:"numberfield",allowBlank:true,decimalPrecision:2,width:126,value:"",hideTrigger:true,cls:"initial-balance-amount-input",},renderer:function(n,o,m){o.tdCls+=" initial-balance-amount-text";if(!n){if(!h){o.tdCls+=" initial-balance-amount-color";n="Ingresar saldo";if(m.data.blocked=="yes"){n="0.00";o.tdCls+=" initial-balance-amount-text-blocked"}}else{o.tdCls+=" initial-balance-no-border-field";n="0.00"}return n}else{if(h){o.tdCls+=" initial-balance-no-border-field"}}return Ext.util.Format.usMoney(n,2," ")},},{xtype:"numbercolumn",name:"sumAmount",dataIndex:"sumAmount",width:136,text:"",tooltip:"Hola",renderer:function(n,o,m){if(n){n=Ext.util.Format.usMoney(n,2," ")}return n}},{name:"info",text:"",width:22,renderer:function(n,o,m){if(m.data.idCategoryRule==this.up().up().configs.idCategoryRuleUtility){o.tdCls+=" opening-balance-tooltip";n='<img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png" data-qtip="'+translate("openingBalanceUtilityTooltip",true)+'" data-qwidth="50px">'}return n},}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{edit:function(m,n){n.record.commit();var o=[n.grid.up().up().configs.idCategoryRuleUtility,n.grid.up().up().configs.idCategoryRuleBanks,n.grid.up().up().configs.idCategoryRuleInventory];f.addEventWindowUnload();f.calculateAgregationTotal(n.record,o);f.updateTotals(n.grid)},beforeedit:function(m,n){if(n.record.data.blocked=="yes"||h){return false}}}})],bbar:d,});l.getRootNode().expand(true);return l},loadCostCenterRecord:function(a,c){var b=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+a+"/format/json",success:function(e,g){var j=Ext.decode(e.responseText);if(j.success){var f=j.results;var d=Ext.create("AL.model.CostCenter",f);var h=c.getStore();if(h.isLoading()){h.on("load",function(){h.insert(0,d);c.select(d)})}else{h.insert(0,d);c.select(d)}}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},setCostCenterField:function(e,c){var b=e.getStore();var d=this;if(!b.hasLoaded()){b.load({callback:function(){var f=b.findRecord("idLocal",c);if(!f){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(f);e.resumeEvents()}}})}else{var a=b.findRecord("idLocal",c);if(!a){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(a);e.resumeEvents()}}},});Ext.define("AL.view.payment.FormAdd",{extend:"Ext.form.Panel",alias:"widget.payment_FormAdd",requires:["AL.view.ux.form.GroupingComboBox"],style:"margin-bottom: 10px",title:"Agregar pago",bodyPadding:30,layout:"hbox",defaultType:"textfield",items:[{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,width:300,msgTarget:"side"},items:[{xtype:"groupingcombobox",fieldLabel:"Banco",name:"idAccount",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",typeAhead:true,store:"Accounts",queryMode:"local",typeAhead:true,blankText:"Debe escoger la cuenta con la que va a realizar el pago"},{xtype:"textarea",fieldLabel:"Observaciones",name:"observations",allowBlank:true}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,msgTarget:"side"},items:[{xtype:"combo",width:350,fieldLabel:"Proveedor",name:"idClient",triggerAction:"all",allowBlank:true,store:"Clients",displayField:"name",valueField:"idLocal",minChars:0,typeAhead:true,listConfig:{width:250,height:200,loadingText:translate("loading",true),emptyText:translate("searchNotMatch",true)},blankText:translate("itIsNecessaryToAssignAClient",true),msgTarget:"side"},{xtype:"datefield",fieldLabel:"Fecha",width:220,name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDate",true),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}"}]},]});Ext.define("AL.view.recurringpayment.FormAdd",{extend:"Ext.form.Panel",alias:"widget.recurringpayment_FormAdd",style:"margin-bottom: 10px",requires:["AL.view.ux.form.GroupingComboBox","AL.view.ux.fields.Numeration"],title:translate("add",true)+" "+translate("recurringPayment"),bodyPadding:30,layout:"hbox",defaultType:"textfield",items:[{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,width:350,msgTarget:"side"},items:[{xtype:"numerationField",name:"numerationComponent",configs:{documentType:"transactionOut",labelPad:15,fieldWidth:350,labelWidth:100,parent:"recurringpayment_FormAdd",showNextNumberContainer:false,onlyAutoincrement:true},width:350},{xtype:"groupingcombobox",fieldLabel:translate("account",true),name:"idAccount",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts",listeners:{afterrender:function(a){a.setFieldLabel(translate("account",true)+'<span class="req">*</span>')}}},{xtype:"textarea",fieldLabel:translate("observations",true),name:"observations",allowBlank:true},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("purchase"),emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},editable:false,hidden:true,msgTarget:"side",labelAlign:"right",labelPad:15,width:350},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",value:translate("itIsAssignedAccordingToTheRateThatTheSystemHasSetTheDayThePaymentIsGenerated",true),hidden:true,width:350}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",labelPad:15,labelWidth:150},items:[{xtype:"combo",fieldLabel:translate("supplier",true),name:"idClient",triggerAction:"all",allowBlank:true,store:"Clients",displayField:"name",valueField:"idLocal",minChars:0,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("createNewContact",true)+"</a></div>",width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"datefield",fieldLabel:translate("startDate",true),name:"startDate",allowBlank:false,format:"d/m/Y",value:function(){var a=new Date();a.setDate(a.getDate()+1);return a}(),minValue:function(){var a=new Date();a.setDate(a.getDate()+1);return a}(),tooltip:translate("dateOnWhichTheFirstPaymentIsCreated",true)},{xtype:"datefield",fieldLabel:translate("endDate",true),name:"endDate",allowBlank:true,format:"d/m/Y",minValue:function(){var a=new Date();a.setDate(a.getDate()+1);return a}(),tooltip:translate("dateOnWhichTheLastPaymentIsCreated",true)},{xtype:"numberfield",fieldLabel:translate("frequencyMonths",true),name:"repeatEvery",allowBlank:false,minValue:1,tooltip:translate("frequencyWithWhichTheExpenseIsGeneratedInMonths",true)}]}]});Ext.define("AL.view.retention.FormAdd",{extend:"Ext.form.Panel",requires:["AL.view.ux.form.GroupingComboBox"],alias:"widget.retention_FormAdd",layout:"anchor",border:false,bodyStyle:{background:"transparent"},cancelSaveButtonsAttributes:{},items:[{xtype:"panel",bodyPadding:"30 0 10 0",width:520,layout:"anchor",style:"margin: 5px; box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.1);",items:[{xtype:"fieldset",title:'<span style="color: #00535E; font-size: 14px;">'+translate("generalSetting",true)+"</span>",padding:"20 20 5 20",border:"1 0 0 0",style:{borderColor:"#cccccc"},defaults:{anchor:"100%",labelWidth:220,labelAlign:"right",maxWidth:450,labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[{xtype:"container",itemId:"alertContainer",cls:"form-alert",html:'<section class="alert-wrapper"><div class="alert info"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#info-outline"></use></svg><p class="alert-content" style="float: none;">La configuración general no puede ser editada en '+translate("retentions")+' que ya fueron utilizadas</p></div><div class="is-clearfix"></div></section>',hidden:true,},{xtype:"hidden",name:"idLocal",allowBlank:false},{fieldLabel:translate("retentionName",true),name:"name",allowBlank:false},{xtype:"combo",fieldLabel:"Calcular por",name:"calculatedBy",displayField:"name",valueField:"key",allowBlank:false,hidden:true,store:Ext.create("Ext.data.Store",{fields:["key","name"],data:[{key:"percentage",name:"Porcentaje"},{key:"fixedAmount",name:"Monto fijo"}]}),queryMode:"local",forceSelection:true},{fieldLabel:translate("percentage",true),name:"percentage",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,cls:"percentaje",regexText:translate("onlyNumericalValuesWithDecimalSeparator",true)},{xtype:"combo",fieldLabel:translate("retentionType",true),name:"idRetentionReference",displayField:"name",valueField:"id",allowBlank:false,store:"RetentionReferences",queryMode:"local",forceSelection:true,listeners:{afterrender:function(b){var a=b.getStore();a.load()}}},{xtype:"combo",fieldLabel:"Tipo de "+translate("retention")+" ante "+translate("theGovernmentEntity")+" "+translate("governmentEntity"),name:"retentionType606",displayField:"value",valueField:"id",allowBlank:false,store:"RetentionTypes606",queryMode:"local",forceSelection:true,hidden:true},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",allowBlank:true}]},{xtype:"fieldset",title:'<span style="color: #00535E; font-size: 14px;">Configuración de contabilidad</span>',padding:"20 20 5 20",border:"1 0 0 0",hidden:true,style:{borderColor:"#cccccc"},defaults:{anchor:"100%",labelWidth:220,labelAlign:"right",maxWidth:450,labelPad:15,msgTarget:"side",tooltip:"Selecciona la "+translate("categoryShort")+" en la que se contabilizará la "+translate("retention")},items:[{xtype:"groupingcombobox",fieldLabel:translate("categoryForSales",true),groupField:["parentName"],cls:"category-combo-component",name:"idCategoryFavorable",displayField:"text",valueField:"idLocal",allowBlank:false,forceSelection:true,disabled:true,store:"RetentionsCategoriesFavorablesCombo",typeAhead:true,matchFieldWidth:false,minChars:2,disabledField:"blocked",disabledValue:"yes",listConfig:{width:300,height:200}},{xtype:"groupingcombobox",fieldLabel:translate("categoryForPurchases",true),groupField:["parentName"],cls:"category-combo-component",name:"idCategoryToBePaid",displayField:"text",valueField:"idLocal",allowBlank:false,forceSelection:true,disabled:true,store:"RetentionsCategoriesToBePaidCombo",typeAhead:true,matchFieldWidth:false,minChars:2,disabledField:"blocked",disabledValue:"yes",listConfig:{width:300,height:200}}],listeners:{afterrender:function(d){var c=d.up("form");if(["colombia","argentina"].indexOf(c.configs.country)!=-1){var b=d.down("[name=idCategoryFavorable]");var a=d.down("[name=idCategoryToBePaid]");b.enable();a.enable();d.show()}}}}]},{xtype:"buttons_modern_CancelSave",width:670,requiredTextMargin:"9 0 0 4"}],initComponent:function(){this.addAttributes(this.items[1],this.cancelSaveButtonsAttributes);this.callParent(arguments)},addAttributes:function(b,a){var c;for(c in a){b[c]=a[c]}}});Ext.define("AL.controller.Retention",{extend:"Ext.app.Controller",views:["common.SmileWindow","buttons.modern.CancelSave","retention.FormAdd","retention.GridAll","retention.RetentionToolbar","retention.PanelForApplyRetentions","retention.ModalForApplyRetention",],stores:["RetentionsCategoriesFavorablesCombo","RetentionsCategoriesToBePaidCombo","Retentions","RetentionReferences","RetentionTypes606",],models:["Retention","RetentionReference","CountryLegalParameter",],init:function(){this.application.addListener("deleteRetention",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("retention")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("retention")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/retention/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleRetentionStatus",function(c){var a=c.record.data;var b=c.initiator;Ext.Ajax.request({url:"/retention/toggle-status/format/json",method:"POST",params:{id:a.idLocal},success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){if(b){var d=b.getStore();d.load()}}else{if(g.cause){GlobalMsg.showErrorMessage("Error",g.cause)}}},failure:function(){}})},this);this.control({"retention_FormAdd buttons_modern_Button[action=save]":{click:this.saveRetention},retention_FormAdd:{beforerender:this.initialize},"retention_FormAdd combo[name=idRetentionReference]":{beforerender:function(b){var a=b.up("retention_FormAdd");if(typeof a.editable!="undefined"&&!a.editable&&Ext.Array.contains(["republicaDominicana","colombia","argentina"],a.configs.country)){b.disable()}},change:function(d,m){var b=d.up("form");var e=b.down("combo[name=retentionType606]");if(b.configs&&b.configs.country=="republicaDominicana"&&m==9){e.allowBlank=false;e.show()}else{e.allowBlank=true;e.hide()}if(["colombia","argentina"].indexOf(b.configs.country)!=-1&&b.type!="edit"){var h=d.getSelectedRecord();if(h){var j=b.down("[name=idCategoryFavorable]");var c=b.down("[name=idCategoryToBePaid]");var n=j.getStore();var g=c.getStore();var a=null;var k=null;switch(b.configs.country){case"colombia":switch(h.get("keyRetentionReference")){case"IVA":a=43;k=50;break;case"FUENTE":a=41;k=48;break;case"ICA":a=42;k=49;break;case"OTRO":a=108;k=107;break}break;case"argentina":switch(h.get("keyRetentionReference")){case"GANANCIAS":a=128;k=133;break;case"INGRESOS_BRUTOS":a=126;k=131;break;case"IVA":a=125;k=130;break;case"SEGURIDAD_SOCIAL":a=127;k=132;break;case"OTRO":a=129;k=134;break}break}function f(){var o=n.findRecord("idCategoryRule",a);if(o){j.select(o)}}if(n.isLoading()){n.on("load",function(){f()})}else{if(n.hasLoaded()){f()}else{n.on("load",function(){f()});n.load()}}function l(){var o=g.findRecord("idCategoryRule",k);if(o){c.select(o)}}if(g.isLoading()){g.on("load",function(){l()})}else{if(g.hasLoaded()){l()}else{g.on("load",function(){l()});g.load()}}}}}},"retention_FormAdd textarea[name=description]":{beforerender:function(b){var a=b.up("retention_FormAdd");if(typeof a.editable!="undefined"&&!a.editable&&Ext.Array.contains(["republicaDominicana","colombia","argentina"],a.configs.country)){b.disable()}},},"retention_FormAdd [name=idCategoryFavorable]":{select:function(d,e,a,b){var c=d.up("form");c.retentionCategoryChanged=true}},"retention_FormAdd [name=idCategoryToBePaid]":{select:function(d,e,a,b){var c=d.up("form");c.retentionCategoryChanged=true}},"retention_FormAdd combo[name=calculatedBy]":{change:function(d,c){var a=d.up("form");var b=a.down("textfield[name=percentage]");if(c=="fixedAmount"){b.allowBlank=true;b.hide()}else{b.allowBlank=false;b.show()}}},"retention_GridAllRetentions gridcolumn[type=retentionActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteRetention")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteRetention",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("retentions")+" que ya están asociadas a algo")}}if(d.hasCls("toggleRetentionStatus")){h.preventDefault();l.fireEvent("toggleRetentionStatus",{record:c,initiator:a})}}},"retention_GridAllRetentions gridcolumn[type=retentionType]":{render:function(f,h,d,a,g,c){var b=f.up("grid");if(b.configs.country=="other"){f.hide()}}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"combo[name=idRetention]":{beforerender:function(b){var a=b.up("form");if(a&&a.canCreateNewRetention=="yes"){b.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} {[values.calculatedBy == \'percentage\' ? (\'- (\' + [Ext.util.Format.round(values.percentage, 4)] + \'%)\') : \'\']}</div></tpl><div><a href="#" data-action="quickNewRetention" class="createNewRetention">'+translate("newF",true)+" "+translate("retention")+"</a></div>"}}}})},saveRetention:function(a){var c=a.up("form");function b(){GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("retention")});var e=c.getValues();var f="/retention/add/format/json"+(c.emergent?"/emergent/true":"");if(c.type&&c.type==="edit"){f="/retention/edit/format/json"}var d=Ext.ComponentQuery.query("retention_FormAdd")[0];Ext.Ajax.request({url:f,method:"POST",params:e,success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var m=l.results;if(c.callback){var h=c.getValues();var g=Ext.create("AL.model.Retention",h);g.set("idLocal",m);d.callback(g)}else{window.location="/retention"}if(d.emergent){GlobalRedirector.close()}}else{GlobalRedirector.close()}},failure:function(){if(d.emergent){Ext.MessageBox.alert("Error",responseText.cause)}else{GlobalMsg.showErrorMessage("Error",responseText.cause)}GlobalRedirector.close()}})}if(c.type==="edit"&&c.canSeeRetentionsCategoriesChangeModal===true&&c.retentionCategoryChanged===true){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:403,height:204,title:"Actualización contable",draggable:false,resizable:false,bodyStyle:{"margin-top":"0px !important","margin-bottom":"0px !important","padding-top":"0px !important","padding-bottom":"0px !important"},footer:{items:[{cls:"button main-button",text:"Entendido",formBind:true}]},items:[{xtype:"box",padding:"25 40 11 40",html:'<span style="font-size: 12px; font-family: Roboto, sans-serif;"><span style="color: #808080;">El cambio de <span style="font-weight: bold;">'+translate("categories")+"</span> se aplicará en las nuevas asociaciones de esta "+translate("retention")+'. Para actualizar tu contabilidad anterior, comunícate con nosotros en</span> <a href="https://getsoft.app/123" target="_blank">getsoft.app/123</a></span>'}],listeners:{afterrender:function(f){var e=f.down("toolbar");var d=e.down("button");d.getEl().on("click",function(){f.hide();b()})}}})}else{b()}},initialize:function(d){var h=d.down("combo[name=idRetentionReference]");var j=this;switch(d.configs.country){case"other":var l=h.getStore();l.on("load",function(){var n=l.findRecord("name",translate("otherRetentionType",true));h.select(n)});h.hide();break;case"colombia":case"argentina":d.down("combo[name=idCategoryFavorable]").allowBlank=false;d.down("combo[name=idCategoryToBePaid]").allowBlank=false;break;default:break}var f=d.down("combo[name=calculatedBy]");f.setValue(d.configs.country==="argentina"?"fixedAmount":"percentage");if(d.type&&d.type=="edit"){var b=d.down("textfield[name=name]");var a=d.down("hidden[name=idLocal]");var k=d.down("textfield[name=percentage]");var m=d.down("textarea[name=description]");var e=d.down("combo[name=retentionType606]");var g=d.down("[name=idCategoryFavorable]");var c=d.down("[name=idCategoryToBePaid]");if(!d.editable){b.disable();k.disable();d.down("container[itemId=alertContainer]").addCls("visible");d.down("container[itemId=alertContainer]").show()}Ext.Ajax.request({url:"/retention/retrieve-one/id/"+d.idLocal+"/format/json",success:function(p){var t=Ext.decode(p.responseText);var q=t.results;a.setValue(q.idLocal);b.setValue(q.name);m.setValue(q.description);f.setValue(q.calculatedBy);if(q.percentage){k.setValue(AL.math.approx(q.percentage,null,4))}var v=h.getStore();if(!v.hasLoaded()||v.isLoading()){v.load({callback:function(){h.select(q.idRetentionReference)}})}else{h.select(q.idRetentionReference)}var n=e.getStore();if(!n.hasLoaded()||n.isLoading()){n.load({callback:function(){e.select(q.retentionType606)}})}else{e.select(q.retentionType606)}if(q.idCategoryFavorable){var s=g.getStore();function r(){g.setValue(q.idCategoryFavorable+"");d.retentionCategoryChanged=false}if(s.isLoading()){s.on("load",function(){r()})}else{if(s.hasLoaded()){r()}else{s.on("load",function(){r()});s.load()}}}if(q.idCategoryToBePaid){var o=c.getStore();function u(){c.setValue(q.idCategoryToBePaid+"");d.retentionCategoryChanged=false}if(o.isLoading()){o.on("load",function(){u()})}else{if(o.hasLoaded()){u()}else{o.on("load",function(){u()});o.load()}}}}})}},listClick:function(f,h){var g=f.up("combo");var a=this.application;var d=Ext.ComponentQuery.query("bill_FormAddBill")[0];var b="";if(!d){d=Ext.ComponentQuery.query("bill_FormAddRetention")[0]}if(d){b="Bill"}if(!d){d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!d){d=Ext.ComponentQuery.query("invoice_FormAddRetention")[0]}if(d&&b==""){b="Invoice"}if(!d){d=Ext.ComponentQuery.query("transaction_FormTransaction")[0]}if(d.configs&&d.configs.type){delete d.configs.type}if(h.target.getAttribute("data-action")=="quickNewRetention"){h.preventDefault();if(d.emergent){window.open("/retention/add","_blank");return}var c=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-retention-modal",reason:"addNewRetention",border:false,resizable:false,bodyStyle:"overflow-y: auto;",title:translate("addNewF",true)+" "+translate("retention"),items:[{xtype:"container",style:"position: relative;",id:"createNewRetention",items:[{xtype:"container",id:"addRetention",items:[{xtype:"retention_FormAdd",style:"margin-bottom: 0px;",bodyPadding:"0 30 0 30",title:"",configs:d.configs,country:d.configs.country,emergent:true,cancelSaveButtonsAttributes:{width:492,hidden:true,requiredText:translate("requiredText",true)},callback:function(e){c.close();a.fireEvent("retentionCreated"+b,{record:e,initiator:g})}}]}]}],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),cls:"button main-button",handler:function(e){var k=e.up("window");var j=k.down("button[action=save]");if(j){j.fireEvent("click",j)}},listeners:{afterrender:function(e){var k=e.up("window");var j=k.down("form");e.setDisabled(j.hasInvalidField());j.on("validitychange",function(m,l){e.setDisabled(!l)})}}}]},listeners:{afterrender:function(j){var e=j.down("button[action=save]");var k=j.down("buttons_Cancel");if(e){e.hide()}if(k){k.hide()}}}})}}});Ext.define("AL.view.report.DatesForm",{extend:"Ext.form.Panel",alias:"widget.report_DatesForm",requires:["AL.view.ux.form.GroupingComboBox"],configs:{buttonAction:"viewReport"},border:false,bodyStyle:"background: transparent",layoutPack:"center",cls:"report-dates-form",defaults:{layout:{type:"hbox",pack:"center",align:"middle",padding:"5"},},items:[{xtype:"container",itemId:"additionalFields",items:[],hidden:true},{xtype:"container",itemId:"standardFields",defaults:{labelAlign:"right"},items:[{xtype:"container",name:"container"},{xtype:"groupingcombobox",name:"dateRange",groupField:["parentName"],valueField:"range",displayField:"text",store:Ext.create("Ext.data.Store",{fields:["range","text","parentName"],data:[{range:"today",text:"Hoy",parentName:"Presente"},{range:"thisWeek",text:"Esta semana",parentName:"Presente"},{range:"thisMonth",text:"Este mes",parentName:"Presente"},{range:"thisYear",text:"Este año",parentName:"Presente"},{range:"previousDay",text:"Ayer",parentName:"Anterior"},{range:"previousWeek",text:"Semana anterior",parentName:"Anterior"},{range:"previousMonth",text:"Mes anterior",parentName:"Anterior"},{range:"previousYear",text:"Año anterior",parentName:"Anterior"},{range:"custom",text:"Manual",parentName:"Manual"}]}),queryMode:"local",typeAhead:true,emptyText:translate("dateRange",true),width:150,listConfig:{height:200},forceSelection:true},{xtype:"datefield",fieldLabel:translate("from",true),name:"fromDate",allowBlank:false,format:"d/m/Y",width:160,labelWidth:60},{xtype:"datefield",fieldLabel:translate("until",true),name:"toDate",allowBlank:false,format:"d/m/Y",width:160,labelWidth:60},{xtype:"button",text:"Generar reporte",cls:"filter-button",itemId:"submitBtn",action:"save",disabled:true,formBind:true,style:"margin-left:10px"},{xtype:"button",text:"Exportar a Excel",cls:"filter-button",action:"excel",disabled:true,formBind:true,style:"margin-left:10px",name:"excelButton"},{xtype:"label",cls:"tooltip",style:"margin:0px;padding:0px;"}]}],initComponent:function(){this.defaults.layout.pack=this.layoutPack;this.callParent(arguments)}});Ext.define("AL.view.report.EditExogenousReportCategoriesTabPanel",{extend:"Ext.tab.Panel",requires:["AL.view.ux.form.GroupingComboBox"],alias:"widget.report_EditExogenousReportCategoriesTabPanel",cls:"modern-tab-panel",bodyCls:"modern-tab-panel-body",width:980,configs:{info:null},items:[],buttons:[{xtype:"buttons_modern_Cancel",text:"Cancelar",margin:"30 17 0 0",width:100},{xtype:"buttons_modern_Button",action:"save",text:"Guardar",formBind:true,margin:"30 0 0 0",width:129,type:"primary"}],initComponent:function(){this.populateForm();this.callParent(arguments)},populateForm:function(){var a=this.configs.info;Ext.each(a.tabs,function(d){var c=[{xtype:"container",layout:"vbox",padding:"0 0 0 12",flex:51,items:[{xtype:"label",style:{color:"#00535E","font-weight":"bold"},text:"Cuenta contable"}]},{xtype:"container",layout:"vbox",flex:49,items:[{xtype:"label",style:{color:"#00535E","font-weight":"bold"},text:"Concepto"}]}];if(d.chooseColumnType){c.push({xtype:"container",layout:"vbox",flex:15,items:[{xtype:"label",style:{color:"#00535E","font-weight":"bold"},text:"Tipo"}]})}if(d.chooseLiabilityCategory){c.push({xtype:"container",layout:"vbox",flex:24,items:[{xtype:"label",style:{color:"#00535E","font-weight":"bold"},text:"Cuenta de "+translate("retention")+" asociada"}]})}var b=[{xtype:"container",layout:"hbox",padding:"12 0 12 0",flex:100,style:{background:"#f9fafd"},items:c},{xtype:"form"}];var e={title:d.title,itemId:d.itemId,height:"auto",items:b};this.items.push(e)},this)},populateCategories:function(){var a=this;var b=this.configs.info;Ext.each(b.tabs,function(d,c){(function(h,f){var g=Ext.create("Ext.data.Store",{model:"AL.model.Category",autoLoad:false,proxy:{url:h.categoriesStore.url,type:"ajax",reader:{type:"json",root:"results"}}});var j=Ext.create("Ext.data.Store",{model:"AL.model.DianConcept",autoLoad:true,proxy:{url:h.conceptsStore.url,type:"ajax",reader:{type:"json",root:"results"}}});if(f==0){var e=new Ext.LoadMask(a,{msg:translate("loadingAction",true)});e.show()}g.on("load",function(){var k=a.down("[itemId="+h.itemId+"]");var l=k.down("form");g.each(function(p){var o="";if(!Ext.isEmpty(p.get("code"))){o+=p.get("code")+" "}o+=p.get("name");var n;if(p.get("isEditable")){n={xtype:"combobox",name:"category_"+h.conceptType+"_"+p.get("idLocal"),store:j,queryMode:"local",displayField:"description",valueField:"code",emptyText:"Selecciona el concepto",value:p.get("conceptCode"),flex:50,listeners:{beforequery:function(r){r.query=new RegExp(r.query,"i");r.forceAll=true}}}}else{n={xtype:"label",flex:50,html:'Los conceptos pueden asociarse en subcuentas. Crea nuevas cuentas <a href="/category" target="_blank" style="font-weight: bold;">aquí</a>.'}}var q=[{xtype:"label",margin:"0 0 0 12",flex:50,text:o},n];if(h.chooseColumnType){q.push({xtype:"combobox",name:"type_"+h.conceptType+"_"+p.get("idLocal"),queryMode:"local",store:{fields:["typeName","type"],data:[{typeName:"Ninguno",type:""},{typeName:"Deducible",type:"discountable"},{typeName:"No deducible",type:"notDiscountable"}]},displayField:"typeName",valueField:"type",emptyText:"Selecciona el tipo",flex:15,editable:false,value:p.get("conceptType")})}if(h.chooseLiabilityCategory){q.push({xtype:"groupingcombobox",name:"concept5002RetentionIdCategory_"+h.conceptType+"_"+p.get("idLocal"),groupField:["parentName"],cls:"category-combo-component",displayField:"text",valueField:"idLocal",store:"LiabilitiesCategoriesCombo",typeAhead:true,matchFieldWidth:false,minChars:2,disabledField:"blocked",disabledValue:"yes",listConfig:{width:300,height:200},flex:25,emptyText:translate("category",true)+" para "+translate("retentions"),value:p.get("report1001concept5002RetentionIdCategory"),queryMode:"local",listeners:{beforequery:function(r){r.query=new RegExp(r.query,"i");r.forceAll=true}}})}l.add({xtype:"container",layout:"hbox",padding:"14 0 14 0",style:{"border-bottom":"1px solid #e5e5e5"},items:q})});var m=Ext.getStore("LiabilitiesCategoriesCombo");m.load();if(f==0){e.destroy()}});g.load()})(d,c)})},listeners:{afterrender:function(a){this.populateCategories()}}});Ext.define("AL.controller.Report",{extend:"Ext.app.Controller",views:["buttons.modern.Cancel","ux.window.Msg","report.IncomeTree","report.ExpenseTree","report.EquityTree","report.LiabilityTree","report.AssetTree","report.DatesForm","report.SalesByClientGrid","report.ItemsProfitGrid","report.SalesByItemGrid","report.InventoryGrid","report.TrialBalanceTree","report.ProfitAndLossTree","report.GridOpenInvoices","report.GridOpenBills","common.GridAllInvoices","common.ReportTree","common.modern.Msg","report.SalesGrid","report.TransactionsGrid","report.GridTaxes","report.SalesBySellerGrid","report.GridRetentions","report.EditCategoriesGrid","report.OverdueButtons","report.PurchasesGrid","report.EditExogenousReportCategoriesTabPanel","report.ledger.JournalsGrid","report.ledger.JournalCategoriesGrid","report.ledger.GeneralLedgerTree","report.ledger.SubsidiaryLedgerGrid","category.CategoriesGroupingCombo","client.ClientsCombo",],stores:["Bills","TotalAssetCategories","TotalIncomeCategories","TotalLiabilityCategories","TotalExpenseCategories","TotalEquityCategories","ClientsSales","Sales","Invoices","ItemsSales","ItemsProfit","InventoriesReport","TrialBalanceCategories","ProfitAndLoss","Transactions","SellersCombo","SellerSales","WarehouseCombo","Categories606","PurchaseTypes606","Purchases","IncomeTypes607","ResolutionsCombo","ledger.Journals","ledger.JournalCategories","CategoriesCombo","ledger.CategoriesSummary","Clients","ledger.SubsidiaryCategoriesSummary","LiabilitiesCategoriesCombo","CostCentersCombo","ledger.ResourceTypes",],models:["Bill","Category","ClientSales","Invoice","ItemSales","ItemProfit","InventoryReport","RetentionReport","Sales","Seller","Transaction","TaxReport","Purchase","DianConcept","ledger.Journal","ledger.JournalCategory","ledger.CategorySummary","CostCenter",],loaded:false,storesLoaded:0,sectionThreeTotal:0,sectionTwoTotal:0,sectionOneTotal:0,treesRendered:1,removeDebitRecords:[],removeCreditRecords:[],init:function(){var a=this;this.control({"report_DatesForm groupingcombobox[name=dateRange]":{change:function(r,l,m,c){var g=r.getStore();var d=r.up("form");var t=d.configs;var b=d.down("button[action="+t.buttonAction+"]");var q=d.down("datefield[name=fromDate]");var j=d.down("datefield[name=toDate]");var p=new Date();var k=Ext.Date.format(p,"N");var h=Ext.Date.getDayOfYear(p);var e=null;var n=null;switch(l){case"today":e=p;n=e;break;case"thisWeek":e=Ext.Date.add(p,Ext.Date.DAY,-1*k+1);n=Ext.Date.add(e,Ext.Date.DAY,6);break;case"thisMonth":e=Ext.Date.getFirstDateOfMonth(p);n=Ext.Date.getLastDateOfMonth(p);break;case"thisYear":e=Ext.Date.add(p,Ext.Date.DAY,-1*h);if(Ext.Date.isLeapYear(p)){n=Ext.Date.add(e,Ext.Date.DAY,365)}else{n=Ext.Date.add(e,Ext.Date.DAY,364)}break;case"previousDay":e=Ext.Date.add(p,Ext.Date.DAY,-1);n=e;break;case"previousWeek":var f=Ext.Date.add(p,Ext.Date.DAY,-1*k+1);e=Ext.Date.add(f,Ext.Date.DAY,-7);n=Ext.Date.add(e,Ext.Date.DAY,6);break;case"previousMonth":var o=Ext.Date.getFirstDateOfMonth(p);n=Ext.Date.add(o,Ext.Date.DAY,-1);e=Ext.Date.getFirstDateOfMonth(n);break;case"previousYear":var s=Ext.Date.add(p,Ext.Date.DAY,-1*h);n=Ext.Date.add(s,Ext.Date.DAY,-1);if(Ext.Date.isLeapYear(n)){e=Ext.Date.add(n,Ext.Date.DAY,-365)}else{e=Ext.Date.add(n,Ext.Date.DAY,-364)}break;case"custom":break;default:break}if(e&&n){q.causedByCombo=true;q.setValue(e);j.causedByCombo=true;j.setValue(n)}if((l!="custom"&&g.findRecord(r.valueField,l))&&b.action!="renderBalance"){setTimeout(function(){b.fireEvent("click",b)},500)}}},"report_DatesForm datefield[name=fromDate]":{change:function(p,e,c){var f=p.up("form");var g=f.configs;var h=f.down("button[action="+g.buttonAction+"]");if(h.action!="renderBalance"&&h.action!="renderBalanceDetailed"&&h.action!="renderInventory"&&h.action!="renderOpenInvoices"&&h.action!="renderOpenBills"){var d=window.location.href;var m=d.split("/from/");var j=m[0];if(m[1]){var l=m[1].split("/to/");var k=l[1];var b={};var n="/from/"+Ext.Date.format(p.getValue(),"Y-m-d")+"/to/"+k;history.replaceState(b,"page",j+n)}else{var o=f.down("datefield[name=toDate]");history.replaceState(b,"page",j+"/from/"+Ext.Date.format(p.getValue(),"Y-m-d")+"/to/"+Ext.Date.format(o.getValue(),"Y-m-d"))}if(e!=c){if(p.causedByCombo){p.causedByCombo=false}else{var q=Ext.ComponentQuery.query("report_DatesForm groupingcombobox[name=dateRange]")[0];q.select("custom")}}}}},"report_DatesForm datefield[name=toDate]":{change:function(m,e,c){var f=m.up("form");var g=f.configs;var h=f.down("button[action="+g.buttonAction+"]");if(h.action!="renderBalance"){var d=window.location.href;var k=d.split("/to/");var j=k[0];var b={};if(k[1]){var l="/to/"+Ext.Date.format(m.getValue(),"Y-m-d");history.replaceState(b,"page",j+l)}else{history.replaceState(b,"page",j+"/to/"+Ext.Date.format(m.getValue(),"Y-m-d"))}if(e!=c){if(m.causedByCombo){m.causedByCombo=false}else{var n=Ext.ComponentQuery.query("report_DatesForm groupingcombobox[name=dateRange]")[0];n.select("custom")}}}}},report_DatesForm:{beforerender:function(d,k){var e=d.configs;var g=d.down("button[action=save]"),l=d.down("button[action=excel]"),h=Ext.ComponentQuery.query("ledger_JournalsGrid")[0];journalsGeneralTree=Ext.ComponentQuery.query("ledger_GeneralLedgerTree")[0];journalsCategoriesGrid=Ext.ComponentQuery.query("ledger_JournalCategoriesGrid")[0];if(e.submitButtonText){g.setText(e.submitButtonText)}var c=false;if(!d.configs.excelUrlGenerator){c=true}else{var f=Ext.get("exportBtn");if(f){c=true;f.on("click",function(){a.excelExport(d)})}}if(c&&l){l.destroy()}if((journalsGeneralTree&&journalsGeneralTree.configs.costCenter&&journalsGeneralTree.configs.costCenter.isActive)||(journalsCategoriesGrid&&journalsCategoriesGrid.costCenter&&journalsCategoriesGrid.costCenter.isActive)||(d.configs&&d.configs.costCenter&&d.configs.costCenter.isActive)){var j={xtype:"combo",name:"idCostCenter",hidden:false,allowBlank:true,emptyText:translate("costCenterComboSelect",true),store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,queryMode:"remote",forceSelection:true,style:"margin-left:10px",labelWidth:110,labelAlign:"left",fieldLabel:translate("costCenter",true),width:320,listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},};if(journalsCategoriesGrid){var b=d.down("container[itemId=additionalFields]");if(b){b.add(j);b.show()}}else{var m=d.down("container[itemId=standardFields]");if(m){m.insert(4,j)}}}},render:function(e,d){var b=e.configs;var c=e.down("button[action=save]");c.action=b.buttonAction},afterrender:function(d,m){var f=d.configs;var h=d.down("button[action="+f.buttonAction+"]");var e=d.down("datefield[name=fromDate]");var o=d.down("datefield[name=toDate]");var s=d.down("groupingcombobox[name=dateRange]");var c=window.location.href;var r=c.split("/from/")[1];var n=c.split("/to/")[1];if(r||n){if(r){var l=r.split("/to/");var j=l[0];var g=j.split("-");var q=g[1]+"/"+g[2]+"/"+g[0];var p=new Date(q);if(p.getDate()){e.setValue(p)}}if(n){var b=n.split("-");q=b[1]+"/"+b[2]+"/"+b[0];var k=new Date(q);if(k.getDate()){o.setValue(k)}}if(h.action!="renderBalance"){setTimeout(function(){h.fireEvent("click",h)},500)}}else{if(c.split("/report/")[1]=="bills-open"||c.split("/report/")[1]=="invoices-open"){s.select("today")}else{s.select("thisMonth")}}}},"report_DatesForm button[action=renderOptimizedProfitAndLoss]":{click:function(f){if(this.validateDateForm()){var b=f.up("form"),h=b.configs.ledger;var c=b.down("datefield[name=fromDate]");var j=b.down("datefield[name=toDate]");var k=c.getValue();var g=j.getValue();var e=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var l=b.down("combo[name=idCostCenter]");idCostCenterString=null;if(l&&l.getSelectedRecord()){idCostCenterString=l.getValue()}else{if(l){if(l.getValue()!=""&&l.getValue()!=null){l.markInvalid(translate("costCenterErrorCombo",true));return}}}this.sectionThreeTotal=0;this.sectionTwoTotal=0;this.sectionOneTotal=0;this.destroyProfitAndLossTrees();this.renderSectionOneOptimized(e,d,b.configs.showCategoriesCode,h,idCostCenterString);this.renderSectionTwoOptimized(e,d,b.configs.showCategoriesCode,h,idCostCenterString);this.renderSectionThreeOptimized(e,d,b.configs.showCategoriesCode,h,idCostCenterString)}}},report_SalesGrid:{filtersapplied:function(b,c){var d=b.getStore().getProxy();a.updateTotals("sales",d.extraParams,true,true)},filterscleared:function(b){var c=b.getStore().getProxy();a.updateTotals("sales",c.extraParams,true,false)}},report_PurchasesGrid:{beforerender:function(b){if(b&&b.country=="peru"){b.columns[0].setText("Número de factura")}},filtersapplied:function(b,c){var d=b.getStore().getProxy();a.updateTotals("purchases",d.extraParams,true,true)},filterscleared:function(b){var c=b.getStore().getProxy();a.updateTotals("purchases",c.extraParams,true,false)}},"report_DatesForm button[action=renderOpenInvoices]":{afterrender:function(c){var d=c.up("form");var b=d.down("datefield[name=fromDate]");var e=d.down("groupingcombobox[name=dateRange]");b.allowBlank=true;b.hide();e.hide()},click:function(d){var b=d.up("form");var h=b.down("datefield[name=toDate]");var e=h.getValue();var c=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();var k=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];if(k){var j=k.getStore();var f=j.getProxy();f.setExtraParam("overdueDaysFilter","");k.overdueDaysFilter=null;var g=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(g,function(l){if(l.pressed){l.toggle(false)}});j.remoteSort=true;j.sorters=new Ext.util.MixedCollection({sorters:[{property:"date",direction:"DESC"}]});f.setExtraParam("to",c);j.load({callback:function(){a.updateMissingAmount("invoices",null,k,c)}})}}},"report_DatesForm button[action=renderOpenBills]":{afterrender:function(c){var d=c.up("form");var b=d.down("datefield[name=fromDate]");var e=d.down("groupingcombobox[name=dateRange]");b.allowBlank=true;b.hide();e.hide()},click:function(d){var b=d.up("form");var j=b.down("datefield[name=toDate]");var e=j.getValue();var c=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();var f=Ext.ComponentQuery.query("report_GridOpenBills")[0];if(f){var k=f.getStore();var g=k.getProxy();g.setExtraParam("overdueDaysFilter","");f.overdueDaysFilter=null;var h=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(h,function(l){if(l.pressed){l.toggle(false)}});k.remoteSort=true;k.sorters=new Ext.util.MixedCollection({sorters:[{property:"date",direction:"DESC"}]});var g=k.getProxy();g.setExtraParam("to",c);k.load({callback:function(){a.updateMissingAmount("bills",null,f,c)}})}}},"report_DatesForm button[action=renderSales]":{click:function(h){if(this.validateDateForm()){var b=h.up("form");var d=b.down("datefield[name=fromDate]");var m=b.down("datefield[name=toDate]");var q=b.down("combo[name=idResolution]");var e=b.down("combo[name=idWarehouse]");var n=d.getValue();var j=m.getValue();var o=q.getValue();var k=e.getValue();var g=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();var f=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate();var c=Ext.ComponentQuery.query("report_SalesGrid")[0];if(c){var p=c.getStore();p.remoteSort=true;p.sorters=new Ext.util.MixedCollection({sorters:[{property:"date",direction:"DESC"}]});var l=p.getProxy();l.setExtraParam("from",g);l.setExtraParam("to",f);l.setExtraParam("idResolution",o);l.setExtraParam("idWarehouse",k);p.load({callback:function(){a.updateTotals("sales",l.extraParams,false)}})}}},afterrender:function(e){var b=e.up("form");var m=b.down("groupingcombobox[name=dateRange]");var c=b.down("datefield[name=fromDate]");var j=b.down("datefield[name=toDate]");m.setWidth(120);c.setWidth(160);j.setWidth(160);var f=Ext.getStore("ResolutionsCombo");var l={idLocal:"all",name:"Todas"};var d=f.getProxy();d.url="/resolution/retrieve-all-for-report/format/json";f.pageSize=50;if(f.hasLoaded()){f.insert(0,l)}else{f.on("load",function(){f.insert(0,l)})}var k=Ext.getStore("WarehouseCombo");var h=k.getProxy();h.url="/warehouse/retrieve-all/format/json";var l={idLocal:"all",name:"Todas"};if(k.hasLoaded()){k.insert(0,l)}else{k.on("load",function(){k.insert(0,l)})}var g=[{xtype:"combo",fieldLabel:translate("numeration",true),style:"margin-left: 5px;",labelWidth:85,name:"idResolution",allowBlank:true,queryModel:"local",store:f,valueField:"idLocal",displayField:"name",matchFieldWidth:false,forceSelection:true,value:"all",editable:false},{xtype:"combo",fieldLabel:translate("warehouse",true),labelWidth:75,name:"idWarehouse",allowBlank:true,queryModel:"local",store:k,valueField:"idLocal",displayField:"name",matchFieldWidth:false,forceSelection:true,value:"all",editable:false}];b.down("container[itemId=standardFields]").insert(4,g)}},"report_DatesForm combo[name=idResolution]":{afterrender:function(d){var b=d.getStore();d.store.load();if(!b.hasLoaded()){b.on("load",function(){var e=d.getStore().getAt(0);d.select(e)})}else{var c=d.getStore().getAt(0);d.select(c)}},change:function(h,g){var b=h.getStore();var f=h.up("form");var c=f.configs;var d=f.down("button[action="+c.buttonAction+"]");if(b.findRecord(h.valueField,g)){d.fireEvent("click",d)}var e=Ext.ComponentQuery.query("report_SalesGrid")[0];e.getView().refresh()}},"report_DatesForm button[action=renderLedgerJournals]":{click:function(h){if(!this.validateDateForm()){return}var d=h.up("form"),b=d.configs.grid,c=d.configs.gridProxy,k=d.down("datefield[name=fromDate]").getValue(),j=d.down("datefield[name=toDate]").getValue(),e=d.down("combo[name=resourceType]").getValue(),l=d.down("combo[name=idCostCenter]");var g=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate(),f=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate();c.setExtraParam("fromDate",g);c.setExtraParam("toDate",f);c.setExtraParam("resourceType",e.join(","));if(l&&l.getSelectedRecord()){c.setExtraParam("idCostCenter",l.getValue())}else{if(l){if(l.getValue()!=""&&l.getValue()!=null){l.markInvalid(translate("costCenterErrorCombo",true));return}c.setExtraParam("idCostCenter","")}}h.setDisabled(true);b.getStore().loadPage(1,{callback:function(){h.setDisabled(false)}})},afterrender:function(b){var c=b.up("form");c.down("container[itemId=standardFields]").insert(4,{xtype:"combo",fieldLabel:translate("ledger.resourceType",true),labelWidth:120,name:"resourceType",allowBlank:true,queryModel:"local",store:"ledger.ResourceTypes",valueField:"id",displayField:"name",forceSelection:true,editable:false,multiSelect:true,width:250,})}},"report_DatesForm button[action=renderLedgerJournalCategories]":{click:function(g){var d=g.up("form"),m=d.down("combo[name=idCategory]"),j=m.hasActiveError();if(!this.validateDateForm()||!m.isValid()){if(!j){m.clearInvalid()}return}var b=d.configs.grid,c=d.configs.gridProxy,k=d.down("datefield[name=fromDate]").getValue(),h=d.down("datefield[name=toDate]").getValue();var f=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate(),e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate(),l=d.down("combo[name=idCostCenter]");c.setExtraParam("fromDate",f);c.setExtraParam("toDate",e);if(l&&l.getSelectedRecord()){c.setExtraParam("idCostCenter",l.getValue())}else{if(l){if(l.getValue()!=""&&l.getValue()!=null){l.markInvalid(translate("costCenterErrorCombo",true));return}c.setExtraParam("idCostCenter","")}}g.setDisabled(true);b.getStore().loadPage(1,{callback:function(){g.setDisabled(false)}})},afterrender:function(b){var d=b.up("form");var c=Ext.ComponentQuery.query("ledger_JournalCategoriesGrid")[0];if(c&&c.costCenter&&c.costCenter.isActive){var e=d.down("container[itemId=additionalFields]");e.addCls("category-combo-with-CC");e.insert(0,{xtype:"category_CategoriesGroupingCombo",allowBlank:false,})}else{d.down("container[itemId=standardFields]").insert(4,{xtype:"category_CategoriesGroupingCombo",allowBlank:false,})}d.configs.grid.hide()},},"report_DatesForm button[action=renderSubsidiaryLedger]":{click:function(g){var h=g.up("form");if(!this.validateDateForm()){return}var f=h.configs.grid,j=h.configs.gridProxy,e=h.down("datefield[name=fromDate]").getValue(),d=h.down("datefield[name=toDate]").getValue();var b=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),c=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();j.setExtraParam("fromDate",b);j.setExtraParam("toDate",c);g.setDisabled(true);f.getStore().loadPage(1,{callback:function(){g.setDisabled(false)}})},afterrender:function(c){var d=c.up("form"),b=d.down("container[itemId=standardFields]");b.insert(4,{xtype:"client_ClientsCombo",fieldLabel:"Tercero",emptyText:"Selecciona el tercero",})},},"report_DatesForm button[action=renderGeneralLedger]":{click:function(g){if(!this.validateDateForm()){return}var d=g.up("form"),b=d.configs.grid,c=d.configs.gridProxy,j=d.down("datefield[name=fromDate]").getValue(),h=d.down("datefield[name=toDate]").getValue(),k=d.down("combo[name=idCostCenter]");var f=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate(),e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();c.setExtraParam("fromDate",f);c.setExtraParam("toDate",e);c.timeout=360000;if(k&&k.getSelectedRecord()){c.setExtraParam("idCostCenter",k.getValue())}else{if(k){if(k.getValue()!=""&&k.getValue()!=null){k.markInvalid(translate("costCenterErrorCombo",true));return}c.setExtraParam("idCostCenter","")}}g.setDisabled(true);b.setLoading({msg:translate("loadingAction",true)});b.getStore().load({callback:function(){g.setDisabled(false);b.setLoading(false)}})}},"report_DatesForm combo[name=idCategory]":{beforerender:function(c){var b=c.getStore().getProxy();b.setExtraParam("excludeInventory","true")},change:function(f,e,c){var b=Ext.get("exportBtn"),d=null;if(f.allowBlank&&f.forceSelection&&(e===""||e===null)){f.clearValue();f.fireEvent("select",f);d=false}else{if(!f.isValid()||!f.getSelectedRecord()){d=false}else{d=true}}if(d!==null&&b){b.setDisplayed(d)}},select:function(e){var d=e.up("form"),c=d.configs.grid;c.getStore().getProxy().setExtraParam("idCategory",e.getValue());if(c.isHidden()){c.show()}var b=d.down("button[itemId=submitBtn]");b.fireEvent("click",b)},},"report_DatesForm combo[name=idClient]":{change:function(f,e,c){var b=Ext.get("exportBtn"),d=null;if(f.allowBlank&&f.forceSelection&&(e===""||e===null)){f.clearValue();f.fireEvent("select",f);d=true}else{if(!f.isValid()||!f.getSelectedRecord()){customExportBtnDisabled=false}else{d=true}}if(d!==null&&b){b.setDisplayed(d)}},select:function(d){var c=d.up("form"),b=c.configs.grid;b.getStore().getProxy().setExtraParam("idClient",d.getValue())},},"report_DatesForm button[action=renderPurchases]":{click:function(g){if(this.validateDateForm()){var b=g.up("form");var c=b.down("datefield[name=fromDate]");var k=b.down("datefield[name=toDate]");var l=c.getValue();var h=k.getValue();var f=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var d=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var e=Ext.ComponentQuery.query("report_PurchasesGrid")[0];if(e){var m=e.getStore();m.remoteSort=true;m.sorters=new Ext.util.MixedCollection({sorters:[{property:"date",direction:"DESC"}]});var j=m.getProxy();j.setExtraParam("from",f);j.setExtraParam("to",d);m.load({callback:function(){a.updateTotals("purchases",j.extraParams,false)}})}}}},"report_DatesForm button[action=renderOptimizedIncomeExpense]":{click:function(f){if(this.validateDateForm()){var b=f.up("form"),h=b.configs.ledger;var c=b.down("datefield[name=fromDate]");var j=b.down("datefield[name=toDate]");var k=c.getValue();var g=j.getValue();var e=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();this.renderOptimizedIncome(e,d,b.configs.showCategoriesCode,h);this.renderOptimizedExpense(e,d,b.configs.showCategoriesCode,h)}}},"report_DatesForm button[action=renderCashFlowOptimized]":{click:function(g){if(this.validateDateForm()){var b=g.up("form");var c=b.down("datefield[name=fromDate]");var k=b.down("datefield[name=toDate]");var l=c.getValue();var h=k.getValue();var f=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();this.renderCashFlowInOptimized(f,e,b.configs.showCategoriesCode);this.renderCashFlowOutOptimized(f,e,b.configs.showCategoriesCode);this.renderCashFlowEquityOptimized(f,e,b.configs.showCategoriesCode);this.renderCashFlowAssetOptimized(f,e,b.configs.showCategoriesCode);this.renderCashFlowLiabilityOptimized(f,e,b.configs.showCategoriesCode);var j=Ext.Date.subtract(l,Ext.Date.DAY,1);var d=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate();this.renderAccountsBalances(d,e)}}},report_SalesByClientGrid:{filtersapplied:function(b,c){var d=b.getStore().getProxy();a.updateTotals("sales-by-client",d.extraParams,true,true)},filterscleared:function(b){var c=b.getStore().getProxy();a.updateTotals("sales-by-client",c.extraParams,true,false)}},"report_DatesForm button[action=renderSalesByClient]":{click:function(f){if(this.validateDateForm()){var b=f.up("form");var c=b.down("datefield[name=fromDate]");var j=b.down("datefield[name=toDate]");var l=c.getValue();var g=j.getValue();var e=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var k=Ext.ComponentQuery.query("report_SalesByClientGrid")[0];if(k){var m=k.getStore();var h=m.getProxy();h.setExtraParam("from",e);h.setExtraParam("to",d);m.load({callback:function(){a.updateTotals("sales-by-client",h.extraParams,false)}})}}}},"report_DatesForm button[action=renderItemsProfit]":{click:function(f){if(this.validateDateForm()){var b=f.up("form");var c=b.down("datefield[name=fromDate]");var j=b.down("datefield[name=toDate]");var k=c.getValue();var g=j.getValue();var e=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var m=Ext.ComponentQuery.query("report_ItemsProfitGrid")[0];if(m){var l=m.getStore();var h=l.getProxy();h.extraParams={from:e,to:d};if(l.lastRequest){Ext.Ajax.abort(l.lastRequest)}l.load({callback:function(){var n=this.getRange();var p=0;var q=0;var o=0;Ext.each(n,function(r){p=AL.math.add(p,r.get("totalSold"));q=AL.math.add(q,r.get("totalCost"));o=AL.math.add(o,r.get("profit"))});Ext.get("totalSold").setHTML(Ext.util.Format.usMoney(p,2));Ext.get("totalCost").setHTML(Ext.util.Format.usMoney(q,2));Ext.get("profit").setHTML(Ext.util.Format.usMoney(o,2))}});l.lastRequest=Ext.Ajax.getLatest()}}}},report_SalesByItemGrid:{filtersapplied:function(b,c){var d=b.getStore().getProxy();a.updateTotals("sales-by-item",d.extraParams,true,true)},filterscleared:function(b){var c=b.getStore().getProxy();a.updateTotals("sales-by-item",c.extraParams,true,false)}},"report_DatesForm button[action=renderSalesByItem]":{click:function(g){if(this.validateDateForm()){var b=g.up("form");var c=b.down("datefield[name=fromDate]");var k=b.down("datefield[name=toDate]");var l=c.getValue();var h=k.getValue();var f=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var d=Ext.ComponentQuery.query("report_SalesByItemGrid")[0];if(d){var m=d.getStore();var j=m.getProxy();j.setExtraParam("from",f);j.setExtraParam("to",e);m.load({callback:function(){a.updateTotals("sales-by-item",j.extraParams,false)}})}}}},report_TransactionsGrid:{filtersapplied:function(b,c){var d=b.getStore().getProxy();a.updateTotals("transactions",d.extraParams,true,true)},filterscleared:function(b){var c=b.getStore().getProxy();a.updateTotals("transactions",c.extraParams,true,false)}},"report_DatesForm button[action=renderTransactionsReport]":{click:function(g){if(this.validateDateForm()){var c=g.up("form");var d=c.down("datefield[name=fromDate]");var k=c.down("datefield[name=toDate]");var l=d.getValue();var h=k.getValue();var f=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var e=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var b=Ext.ComponentQuery.query("report_TransactionsGrid")[0];if(b){var m=b.getStore();var j=m.getProxy();j.url="/report/retrieve-transactions/format/json";j.setExtraParam("from",f);j.setExtraParam("to",e);m.load({callback:function(){a.updateTotals("transactions",j.extraParams,false)}})}}}},report_SalesBySellerGrid:{filtersapplied:function(c,d){var e=c.getStore().getProxy();var b=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(b.getValue()=="all"){var f="sales-sellers";e.url="/report/retrieve-sales-sellers/format/json"}else{var f="sales-by-seller";e.url="/report/retrieve-sales-by-seller/format/json"}a.updateTotals(f,e.extraParams,true,true)},filterscleared:function(c){var d=c.getStore().getProxy();var b=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(b.getValue()=="all"){var e="sales-sellers";d.url="/report/retrieve-sales-sellers/format/json"}else{var e="sales-by-seller";d.url="/report/retrieve-sales-by-seller/format/json"}a.updateTotals(e,d.extraParams,true,false)}},"report_DatesForm button[action=renderSalesBySeller]":{afterrender:function(c){var f=c.up("form");var b=Ext.getStore("SellersCombo");var d={idLocal:"all",name:"Todos"};if(b.hasLoaded()){b.insert(0,d)}else{b.on("load",function(){b.insert(0,d)})}var e=[{xtype:"combo",fieldLabel:"Vendedor",labelWidth:85,name:"idSeller",allowBlank:false,queryModel:"local",store:b,valueField:"idLocal",displayField:"name",matchFieldWidth:false,forceSelection:true,listConfig:{emptyText:'<div style="padding:3px 5px 5px !important; color:#666;">Aún no has registrado vendedores</div><div style="padding: 0px  0px 7px 5px"><a href="/seller/add" >Crear vendedor</a></div>',width:200}}];f.down("container[itemId=standardFields]").insert(4,e)},click:function(j){if(this.validateDateForm()){var b=j.up("form");var d=b.down("datefield[name=fromDate]");var m=b.down("datefield[name=toDate]");var o=b.down("combo[name=idSeller]");var n=d.getValue();var k=m.getValue();var g=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();var f=k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate();var c=Ext.ComponentQuery.query("report_SalesBySellerGrid")[0];if(c){var e=o.getValue();if(e=="all"){var p=c.getStore();var l=p.getProxy();var h="sales-sellers";l.url="/report/retrieve-sales-sellers/format/json";l.setExtraParam("from",g);l.setExtraParam("to",f)}else{var p=c.getStore();var l=p.getProxy();var h="sales-by-seller";l.url="/report/retrieve-sales-by-seller/format/json";l.setExtraParam("from",g);l.setExtraParam("to",f);l.setExtraParam("idSeller",e)}p.load({callback:function(){a.updateTotals(h,l.extraParams,false)}})}}}},"report_DatesForm combo[name=idSeller]":{afterrender:function(d){var b=d.getStore();d.store.load();if(!b.hasLoaded()){b.on("load",function(){var e=d.getStore().getAt(0);d.select(e)})}else{var c=d.getStore().getAt(0);d.select(c)}},change:function(f,d,c){var k=f.getStore();var e=f.up("form");var g=e.configs;var j=e.down("button[action="+g.buttonAction+"]");if(k.findRecord(f.valueField,d)){j.fireEvent("click",j)}var b=Ext.ComponentQuery.query("report_SalesBySellerGrid")[0];if(d=="all"){b.columns[0].hidden=true;b.columns[1].setText("Vendedor");var h=Ext.create("Ext.grid.column.Column",{header:"Número de facturas",dataIndex:"totalInvoices",flex:1,align:"center",sortable:false,filter:false});b.headerCt.insert(2,h);b.columns[1].renderer=null}else{b.columns[1].renderer=function(m,n,l){return'<a href="/invoice/view/id/'+l.get("idLocal")+'">'+l.get("name")+"</a>"};b.columns[1].setText("Cliente");b.columns[0].hidden=false;if(b.columns[2].dataIndex=="totalInvoices"){b.headerCt.remove(2)}b.reconfigure(b.getStore(),b.initialConfig.columns)}b.getView().refresh()}},report_LiabilityTree:{render:function(b){if(b.reportType&&b.reportType==="open-bills"){var c=b.getStore();var d=c.getProxy();d.url="/report/retrieve-liability-tree/format/json";c.load()}}},"report_DatesForm button[action=excel]":{click:function(b){var c=b.up("form");a.excelExport(c)}},report_TrialBalanceTree:{render:function(b){var c=b.getStore();c.load()}},"report_InventoryGrid gridcolumn[dataIndex=averageCost]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);hasLoading=f.down("span");if(f.hasCls("downloadInventoryReport")&&!hasLoading){k.preventDefault();var d=b.up("grid").getSelectionModel().getSelection()[0];var n=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");f.insertFirst({tag:"span",html:'<svg class="icon icon-spin"><use xlink:href="/images/smile-icons.svg#loading"></use></svg>'});Ext.Ajax.request({url:"/labs/test11/exportable-type/inventory-history/idItem/"+d.data.idLocal+"/format/json",binary:true,timeout:360000,success:function(s,x){try{var t=String.fromCharCode.apply(null,new Uint8Array(s.responseBytes));t=t.replace(/Already running.../gi,"");var p=Ext.decode(t);if(!p.success){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(p.rowsCount==0){n="Lo sentimos, no se encontraron registros que exportar.<br /><br />"}Ext.create("AL.view.ux.window.Msg",{title:"Generando archivo de excel con el costo promedio del producto",msgMsg:n,width:550,msgButtons:Ext.Msg.OK,msgIcon:Ext.Msg.QUESTION,msgHelpText:'Si necesitas ayuda para consultar el costo promedio, haz <a href="http://ayuda.getsoft.app/hc/es/articles/115001012643" target="_blank">clic aquí</a>.',msgHelpX:-25,msgHelpY:18,msgHelpTooltipX:-360,msgHelpTooltipY:2,msgHelpTooltipWidth:340})}}catch(w){var o="";var q=s.getResponseHeader("Content-Disposition");if(q&&q.indexOf("attachment")!==-1){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var v=r.exec(q);if(v!=null&&v[1]){o=v[1].replace(/['"]/g,"")}}var z=s.getResponseHeader("Content-Type");var j=typeof File==="function"?new File([s.responseBytes],o,{type:z}):new Blob([s.responseBytes],{type:z});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(j,o)}else{var y=window.URL||window.webkitURL;var u=y.createObjectURL(j);if(o){var A=document.createElement("a");if(typeof A.download==="undefined"){window.location=u}else{A.href=u;A.download=o;document.body.appendChild(A);A.click()}}else{window.location=u}setTimeout(function(){y.revokeObjectURL(u)},100)}}finally{if(f.dom.firstChild){f.dom.removeChild(f.dom.firstChild)}}},failure:function(){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}},report_GridOpenInvoices:{filtersapplied:function(c,d){if(c.overdueDaysFilter){var b=Ext.decode(d);b.push(c.overdueDaysFilter);d=Ext.encode(b)}a.updateMissingAmount("invoices",d,c)},filterscleared:function(c){if(c.overdueDaysFilter){var b=[];b.push(c.overdueDaysFilter);var d=Ext.encode(b)}a.updateMissingAmount("invoices",d,c)},render:function(d){var b=d.getStore();var c=b.getProxy();b.pageSize=20;c.timeout=360000;c.url="/report/retrieve-open-invoices/format/json"}},"report_OverdueButtons button[name=overdue30]":{click:function(g){var b=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];var l="invoices";if(!b){b=Ext.ComponentQuery.query("report_GridOpenBills")[0];l="bills"}if(!b){b=Ext.ComponentQuery.query("client_GridStatement")[0];if(!b.idContact){return}l="statement"}var n=b.getStore();var h=n.getProxy();var e=[];if(!g.pressed){h.setExtraParam("overdueDaysFilter","");b.overdueDaysFilter=null}else{var k=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(k,function(o){if(o.pressed&&g.id!=o.id){o.toggle(false)}});var d={};if(l==="statement"){d={type:"betweenNumbers",property:"overdueDays",fromNumber:1,toNumber:30,}}else{var j=Ext.ComponentQuery.query("report_DatesForm datefield[name=toDate]")[0];var f=j.getValue();var m=Ext.Date.subtract(f,Ext.Date.DAY,30);var d={type:"betweenDates",property:"dueDate",fromDate:Ext.Date.format(m,"Y-m-d"),toDate:Ext.Date.format(f,"Y-m-d")}}h.setExtraParam("overdueDaysFilter",Ext.encode(d));b.overdueDaysFilter=d;if(h.extraParams.filters){e=Ext.decode(h.extraParams.filters)}e.push(d);e=Ext.encode(e)}n.load();if(l==="statement"){b.withFilterOverdue=g.pressed;var c=b.withFilterOverdue||b.withFilters;a.updateTotals("statement",h.extraParams,true,c,true,b.idContact)}else{a.updateMissingAmount(l,e,b)}}},"report_OverdueButtons button[name=overdue60]":{click:function(g){var b=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];var l="invoices";if(!b){b=Ext.ComponentQuery.query("report_GridOpenBills")[0];l="bills"}if(!b){b=Ext.ComponentQuery.query("client_GridStatement")[0];if(!b.idContact){return}l="statement"}var n=b.getStore();var h=n.getProxy();var e=[];if(!g.pressed){h.setExtraParam("overdueDaysFilter","");b.overdueDaysFilter=null}else{var k=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(k,function(p){if(p.pressed&&g.id!=p.id){p.toggle(false)}});var d={};if(l==="statement"){d={type:"betweenNumbers",property:"overdueDays",fromNumber:31,toNumber:60,}}else{var j=Ext.ComponentQuery.query("report_DatesForm datefield[name=toDate]")[0];var f=j.getValue();var m=Ext.Date.subtract(f,Ext.Date.DAY,60);var o=Ext.Date.subtract(f,Ext.Date.DAY,31);var d={type:"betweenDates",property:"dueDate",fromDate:Ext.Date.format(m,"Y-m-d"),toDate:Ext.Date.format(o,"Y-m-d")}}h.setExtraParam("overdueDaysFilter",Ext.encode(d));b.overdueDaysFilter=d;if(h.extraParams.filters){e=Ext.decode(h.extraParams.filters)}e.push(d);e=Ext.encode(e)}n.load();if(l==="statement"){b.withFilterOverdue=g.pressed;var c=b.withFilterOverdue||b.withFilters;a.updateTotals("statement",h.extraParams,true,c,true,b.idContact)}else{a.updateMissingAmount(l,e,b)}}},"report_OverdueButtons button[name=overdue90]":{click:function(g){var b=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];var l="invoices";if(!b){b=Ext.ComponentQuery.query("report_GridOpenBills")[0];l="bills"}if(!b){b=Ext.ComponentQuery.query("client_GridStatement")[0];if(!b.idContact){return}l="statement"}var n=b.getStore();var h=n.getProxy();var e=[];if(!g.pressed){h.setExtraParam("overdueDaysFilter","");b.overdueDaysFilter=null}else{var k=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(k,function(p){if(p.pressed&&g.id!=p.id){p.toggle(false)}});var d={};if(l==="statement"){d={type:"betweenNumbers",property:"overdueDays",fromNumber:61,toNumber:90,}}else{var j=Ext.ComponentQuery.query("report_DatesForm datefield[name=toDate]")[0];var f=j.getValue();var m=Ext.Date.subtract(f,Ext.Date.DAY,90);var o=Ext.Date.subtract(f,Ext.Date.DAY,61);d={type:"betweenDates",property:"dueDate",fromDate:Ext.Date.format(m,"Y-m-d"),toDate:Ext.Date.format(o,"Y-m-d")}}h.setExtraParam("overdueDaysFilter",Ext.encode(d));b.overdueDaysFilter=d;if(h.extraParams.filters){e=Ext.decode(h.extraParams.filters)}e.push(d);e=Ext.encode(e)}n.load();if(l==="statement"){b.withFilterOverdue=g.pressed;var c=b.withFilterOverdue||b.withFilters;a.updateTotals("statement",h.extraParams,true,c,true,b.idContact)}else{a.updateMissingAmount(l,e,b)}}},"report_OverdueButtons button[name=overdue90Plus]":{click:function(h){var c=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];var n="invoices";if(!c){c=Ext.ComponentQuery.query("report_GridOpenBills")[0];n="bills"}if(!c){c=Ext.ComponentQuery.query("client_GridStatement")[0];if(!c.idContact){return}n="statement"}var q=c.getStore();var j=q.getProxy();var f=[];if(!h.pressed){j.setExtraParam("overdueDaysFilter","");c.overdueDaysFilter=null}else{var m=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(m,function(r){if(r.pressed&&h.id!=r.id){r.toggle(false)}});var b="greaterThan";var o="overdueDays";var l=91;if(n!=="statement"){var k=Ext.ComponentQuery.query("report_DatesForm datefield[name=toDate]")[0];var g=k.getValue();var p=Ext.Date.subtract(g,Ext.Date.DAY,91);b="earlierThanOrEqual";o="dueDate";l=Ext.Date.format(p,"Y-m-d")}var e={type:b,property:o,value:l};j.setExtraParam("overdueDaysFilter",Ext.encode(e));c.overdueDaysFilter=e;if(j.extraParams.filters){f=Ext.decode(j.extraParams.filters)}f.push(e);f=Ext.encode(f)}q.load();if(n==="statement"){c.withFilterOverdue=h.pressed;var d=c.withFilterOverdue||c.withFilters;a.updateTotals("statement",j.extraParams,true,d,true,c.idContact)}else{a.updateMissingAmount(n,f,c)}}},"report_OverdueButtons button[name=notOverdue]":{click:function(h){var c=Ext.ComponentQuery.query("report_GridOpenInvoices")[0];var m="invoices";if(!c){c=Ext.ComponentQuery.query("report_GridOpenBills")[0];m="bills"}if(!c){c=Ext.ComponentQuery.query("client_GridStatement")[0];if(!c.idContact){return}m="statement"}var p=c.getStore();var j=p.getProxy();var f=[];if(!h.pressed){j.setExtraParam("overdueDaysFilter","");c.overdueDaysFilter=null}else{var l=Ext.ComponentQuery.query("report_OverdueButtons button");Ext.each(l,function(q){if(q.pressed&&h.id!=q.id){q.toggle(false)}});var b="lessThan";var n="overdueDays";var k=1;if(m!=="statement"){var g=new Date();var o=Ext.Date.subtract(g,Ext.Date.DAY,1);b="laterThan";n="dueDate";k=Ext.Date.format(o,"Y-m-d")}var e={type:b,property:n,value:k};j.setExtraParam("overdueDaysFilter",Ext.encode(e));c.overdueDaysFilter=e;if(j.extraParams.filters){f=Ext.decode(j.extraParams.filters)}f.push(e);f=Ext.encode(f)}p.load();if(m==="statement"){c.withFilterOverdue=h.pressed;var d=c.withFilterOverdue||c.withFilters;a.updateTotals("statement",j.extraParams,true,d,true,c.idContact)}else{a.updateMissingAmount(m,f,c)}}},report_GridOpenBills:{filtersapplied:function(c,d){if(c.overdueDaysFilter){var b=Ext.decode(d);b.push(c.overdueDaysFilter);d=Ext.encode(b)}a.updateMissingAmount("bills",d,c)},filterscleared:function(c){if(c.overdueDaysFilter){var b=[];b.push(c.overdueDaysFilter);var d=Ext.encode(b)}a.updateMissingAmount("bills",d,c)},render:function(d){var b=d.getStore();var c=b.getProxy();c.url="/report/retrieve-open-bills/format/json"}},"report_DatesForm button[action=renderInventory]":{afterrender:function(c){var d=c.up("form");var b=d.down("datefield[name=fromDate]");var e=d.down("groupingcombobox[name=dateRange]");b.allowBlank=true;b.hide();e.hide();if(d.configs.showWarehouses){d.down("container[itemId=standardFields]").insert(4,{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:"Seleccionar",allowBlank:false,labelWidth:75})}},click:function(e){var k=this,b=e.up("form"),j=b.down("datefield[name=toDate]"),f=j.getValue(),m=b.down("combo[name=idWarehouse]"),c=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate(),d=Ext.ComponentQuery.query("report_InventoryGrid")[0];if(d){var l=d.getStore(),h=l.getProxy(),g=d.itemsMaxReportInventoryValue;h.setExtraParam("to",c);if(m){m.disable();if(m.getValue()){h.setExtraParam("idWarehouse",m.getValue())}}e.disable();l.load({callback:function(){var o=this.getRange(),q=this.getTotalCount()>=g,p=0,n=d.columns[5],r=false;Ext.each(o,function(s){if(!q){var t=s.get("inventoryTotal");if(s.get("quantity")<0||s.get("averageCost")<0||s.get("inventoryTotal")<0){t=0}p=AL.math.add(p,t)}if(m&&m.getValue()&&s.get("minQuantity")!==null){r=true}});if(r){n.show()}else{n.hide()}Ext.get("total").setHTML(Ext.util.Format.usMoney(p,2));k.doAfterLoadInventoryValue(d,q);e.enable();if(m){m.enable()}}})}}},"report_DatesForm combo[name=idWarehouse]":{afterrender:function(c){var b=c.getStore();b.load({callback:function(){var d=Ext.create("AL.model.Warehouse",{idLocal:null,name:"Todas"});b.add(d);c.select(d)}})},select:function(e){var d=e.up("form");if(d.configs.buttonAction!="renderSales"){var j=e.getSelectedRecord();var m=this;var c=Ext.ComponentQuery.query("report_InventoryGrid")[0];var n=c.getStore();var l=n.getProxy();var b=c.columns[3];b.show();b.setText("Cantidad en "+j.get("name"));c.columns[4].setText("Cantidad total");var h=c.columns[5];var g=false;n.each(function(p){if(p.get("minQuantity")){g=true;return false}});if(g){h.show()}else{h.hide()}l.setExtraParam("idWarehouse",e.getValue());if(d.configs.buttonAction=="renderInventory"){var o=Ext.ComponentQuery.query("button[action=renderInventory]")[0];if(o){o.disable()}e.disable();var f=Ext.ComponentQuery.query("report_InventoryGrid")[0],k=f.itemsMaxReportInventoryValue;n.reload({callback:function(){var p=this.getRange(),r=this.getTotalCount()>=k,q=0;if(!r){Ext.each(p,function(s){var t=s.get("inventoryTotal");if(s.get("quantity")<0||s.get("averageCost")<0||s.get("inventoryTotal")<0){t=0}q=AL.math.add(q,t)})}Ext.get("total").setHTML(Ext.util.Format.usMoney(q,2));m.doAfterLoadInventoryValue(f,r);if(o){o.enable()}e.enable()}})}else{n.reload()}if(!e.getValue()){c.columns[4].setText("Cantidad");b.hide()}}},change:function(h,g){var f=h.up("form");if(f.configs.buttonAction=="renderSales"){var c=h.getStore();var f=h.up("form");var d=f.configs;var e=f.down("button[action="+d.buttonAction+"]");if(c.findRecord(h.valueField,g)){e.fireEvent("click",e)}var b=Ext.ComponentQuery.query("report_SalesGrid")[0];b.getView().refresh()}}},"report_DatesForm button[action=renderBalanceDetailed]":{afterrender:function(c){var d=c.up("form");var b=d.down("datefield[name=fromDate]");var e=d.down("groupingcombobox[name=dateRange]");b.allowBlank=true;b.hide();e.hide()},click:this.renderBalance},"report_DatesForm button[action=renderBalance]":{afterrender:function(f){var c=f.up("form");var j=c.down("datefield[name=fromDate]");var d=c.down("groupingcombobox[name=dateRange]");j.allowBlank=true;j.hide();d.hide();var h=window.location.href.split("/to/")[1];if(h){var b=h.split("-");var k=b[1]+"/"+b[2]+"/"+b[0];var e=new Date(k);e=Ext.Date.format(e,"d/m/Y");var g=c.down("datefield[name=toDate]");setTimeout(function(){g.setValue(e)},100)}},click:function(d){var f=d.up("form");var b=f.down("datefield[name=toDate]");var c=b.getValue();var e=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();window.location="/report/optimized-general-balance/to/"+e}},report_EditCategoriesGrid:{beforeedit:function(b,c){if(c.colIdx&&c.colIdx==1&&c.record.get("isEditable")==false){return false}if(c.grid.report=="606"&&c.colIdx&&c.colIdx==2&&c.record.get("isEditable")==false){return false}}},"buttons_SubmitReset button[action=saveCategoriesConfig]":{click:function(f){var e=Ext.ComponentQuery.query("report_EditCategoriesGrid")[0];var d=[];var c=e.getStore().getRange();var g=true;Ext.each(c,function(h){if(!h.get("category606")&&h.get("purchaseType606")){GlobalMsg.showNotification({title:"Error",text:"Debes asociar una categoría de "+translate("theGovernmentEntity")+" "+translate("governmentEntity")+" para asignar un tipo de compra.",type:"error"});g=false;return false}d.push(h.data)});if(g){var b=new Ext.LoadMask(Ext.getBody(),{msg:translate("savingAction",true)});b.show();Ext.Ajax.request({url:"/report/edit-report-categories/format/json/report/"+e.report,method:"POST",params:{categories:Ext.encode(d)},timeout:360000,success:function(h,j){b.hide();b.destroy();window.location="/configuration"},failure:function(){b.hide();b.destroy()}})}}},client_GridStatement:{filtersapplied:function(c,d){var e=c.getStore().getProxy();c.withFilters=true;var b=c.withFilters||c.withFilterOverdue;a.updateTotals("statement",e.extraParams,true,b,true,c.idContact)},filterscleared:function(c){var d=c.getStore().getProxy();c.withFilters=false;var b=c.withFilters||c.withFilterOverdue;a.updateTotals("statement",d.extraParams,true,b,true,c.idContact)}},"report_DatesForm button[action=renderTaxesAndRetentionsReport]":{click:function(f){var k=this;var b=f.up("form");var m=b.down("datefield[name=fromDate]");var g=b.down("datefield[name=toDate]");var c=m.getValue();var l=g.getValue();var e=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();var d=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();var j=Ext.ComponentQuery.query("panel[name=tabPanel]");Ext.each(j,function(n){n.destroy()});var h=Ext.ComponentQuery.query("panel[name=taxPanel]");Ext.each(h,function(n){n.destroy()});Ext.create("Ext.tab.Panel",{name:"tabPanel",renderTo:"taxes-tab-panel",border:false,bodyStyle:"background: transparent",style:"background: transparent",minTabWidth:168,tabBar:{style:"background: transparent;"},items:[{title:"Impuestos en venta",border:false,bodyStyle:"background: transparent",style:"background: transparent",listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/sales/includeInactiveTaxes/true/format/json",timeout:360000,success:function(p,q){var r=Ext.decode(p.responseText,true);var o=r.taxes;var s=o.sales;if(s.length>0){Ext.each(s,function(t){n.add(k.generateTaxGrid(t,"sales",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡'+translate("YouHaveNoSalesRelatedTaxesInThisPeriod")+"!</div></div></div>"})}}})}}},{title:"Devoluciones en venta",html:'<div id="taxes-credits"></div>',border:false,bodyStyle:"background: transparent",style:"background: transparent",listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/credits/format/json",timeout:360000,success:function(p,q){var s=Ext.decode(p.responseText,true);var o=s.taxes;var r=o.credits;if(r.length>0){Ext.each(r,function(t){n.add(k.generateTaxGrid(t,"credits",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes impuestos asociados a '+translate("creditNote")+" en este período!</div></div></div>"})}}})}}},{title:"Impuestos en compra",html:'<div id="taxes-bills"></div>',border:false,bodyStyle:"background: transparent",style:"background: transparent",listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/bills/format/json",timeout:360000,success:function(p,q){var s=Ext.decode(p.responseText,true);var o=s.taxes;var r=o.bills;if(r.length>0){Ext.each(r,function(t){n.add(k.generateTaxGrid(t,"bills",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes impuestos asociados a compras en este período!</div></div></div>'})}}})}}},{title:"Devoluciones en compra",html:'<div id="taxes-debits"></div>',border:false,bodyStyle:"background: transparent",style:"background: transparent",listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/debits/format/json",timeout:360000,success:function(p,q){var r=Ext.decode(p.responseText,true);var o=r.taxes;var s=o.debits;if(s.length>0){Ext.each(s,function(t){n.add(k.generateTaxGrid(t,"debits",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes impuestos asociados a notas débito en este período!</div></div></div>'})}}})}}},{title:translate("retentions",true)+" en compras",border:false,bodyStyle:"background: transparent",style:"background: transparent",html:'<div id="retentions-applied-by"></div>',listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/appliedBy/format/json",timeout:360000,success:function(p,r){var s=Ext.decode(p.responseText,true);var o=s.retentions;var q=o.appliedBy;if(q.length>0){Ext.each(q,function(t){n.add(k.generateRetentionGrid(t,"appliedBy",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes '+translate("retentions")+" asociadas a compras en este período!</div></div></div>"})}}})}}},{title:translate("retentions",true)+" en ventas",border:false,bodyStyle:"background: transparent",style:"background: transparent",html:'<div id="retentions-applied-to"></div>',listeners:{afterrender:function(){var n=this;Ext.Ajax.request({url:"/report/retrieve-taxes-and-retentions/fromDate/"+e+"/toDate/"+d+"/type/appliedTo/format/json",timeout:360000,success:function(p,q){var s=Ext.decode(p.responseText,true);var o=s.retentions;var r=o.appliedTo;if(r.length>0){Ext.each(r,function(t){n.add(k.generateRetentionGrid(t,"appliedTo",e,d))})}else{n.add({xtype:"container",height:300,html:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">¡No tienes '+translate("retentions")+" asociadas a ventas en este período!</div></div></div>"})}}})}}}]})}},"report_EditExogenousReportCategoriesTabPanel [action=save]":{click:function(f){var h=f.up("tabpanel");var d=Ext.ComponentQuery.query("report_EditExogenousReportCategoriesTabPanel form");var e=Ext.ComponentQuery.query("report_EditExogenousReportCategoriesTabPanel combobox");var g=false;Ext.Array.each(e,function(j){if(j.name.indexOf("category")==-1){return true}var k=j.getValue();if(!Ext.isEmpty(k)&&(!Ext.isNumeric(k)||(k+"").length!=4)){g=true;j.markInvalid("Debes seleccionar un concepto")}return true});if(g){return}var b=new Ext.LoadMask(h,{msg:translate("savingAction",true)});b.show();var c={};d.forEach(function(k){var l=k.getForm().getValues();var j;for(j in l){c[j]=l[j]}});Ext.Ajax.request({url:"/category/save-for-exogenous-report/format/json",method:"POST",params:c,timeout:360000,success:function(j,k){var j=Ext.decode(j.responseText);if(j.success){window.location="/configuration"}else{b.hide();b.destroy();GlobalMsg.showErrorMessage("Error",j.cause)}},failure:function(){b.hide();b.destroy();GlobalMsg.showErrorMessage("Error",response.cause)}})}}})},validateDateForm:function(){var b=Ext.ComponentQuery.query("report_DatesForm")[0];var a=b.down("datefield[name=fromDate]");var d=b.down("datefield[name=toDate]");var c=true;if(a.getValue()>d.getValue()){c=false;GlobalMsg.showNotification({title:"Error",text:"La fecha inicial debe ser menor o igual a la fecha final",type:"error"})}return c},renderOptimizedIncome:function(b,a,d,c){var e=this,g="/ledger/"+c;var j=Ext.ComponentQuery.query("report_IncomeTree")[0];if(j){j.destroy()}var h=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:b,to:a},url:"/report/retrieve-income-expense/type/income/format/json"+g,timeout:360000}});j=Ext.create("AL.view.report.IncomeTree",{renderTo:"incomeTree",store:h,showCategoriesCode:d});j.setLoading({msg:translate("loadingAction",true)});h.on("load",function(){j.expandAll();j.setLoading(false)});var f=j.getView();f.on("resize",function(){var m=Ext.dom.Query.select(".x-grid-row");for(var l=0;l<m.length;l++){if((l%2)!=0){var k=Ext.get(m[l]);k.addCls("dark-row")}}});h.load({callback:function(n,o,u){if(u){var r=Ext.decode(o.response.responseText);var s=r.results;if(s!=0){Ext.each(n,function(v){e.removeZeroCreditCategories(v)});Ext.each(e.removeCreditRecords,function(v){v.remove()})}var k=Ext.ComponentQuery.query("displayfield[name=incomeTotal]")[0];if(!k){k=Ext.create("Ext.form.field.Display",{fieldLabel:"Ingresos",renderTo:"incomeTotal",name:"incomeTotal"})}k.setValue(Ext.util.Format.usMoney(s,2));k.realValue=s;if(e.loaded){e.loaded=false;var p=Ext.ComponentQuery.query("displayfield[name=netProfit]")[0];var l=Ext.ComponentQuery.query("displayfield[name=expenseTotal]")[0];if(l){var t=l.realValue,m=c=="yes"?"Diferencia":"Ganancia";if(!p){p=Ext.create("Ext.form.field.Display",{fieldLabel:m,renderTo:"netProfit",name:"netProfit"})}var q=AL.math.sub(s,t);p.setValue(Ext.util.Format.usMoney(q,2))}}else{e.loaded=true}}}})},renderOptimizedExpense:function(b,a,d,c){var e=this,g="/ledger/"+c;var j=Ext.ComponentQuery.query("report_ExpenseTree")[0];if(j){j.destroy()}var h=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:b,to:a},url:"/report/retrieve-income-expense/type/expense/format/json"+g,timeout:360000}});j=Ext.create("AL.view.report.ExpenseTree",{renderTo:"expenseTree",store:h,showCategoriesCode:d});j.setLoading({msg:translate("loadingAction",true)});h.on("load",function(){j.expandAll();j.setLoading(false)});var f=j.getView();f.on("resize",function(){var m=Ext.dom.Query.select(".x-grid-row");for(var l=0;l<m.length;l++){if((l%2)!=0){var k=Ext.get(m[l]);k.addCls("dark-row")}}});h.load({callback:function(n,p,u){if(u){var s=Ext.decode(p.response.responseText);var t=s.results;if(t!=0){Ext.each(n,function(v){e.removeZeroDebitCategories(v)});Ext.each(e.removeDebitRecords,function(v){v.remove()})}var l=Ext.ComponentQuery.query("displayfield[name=expenseTotal]")[0];if(!l){l=Ext.create("Ext.form.field.Display",{fieldLabel:"Egresos",renderTo:"expenseTotal",name:"expenseTotal"})}l.setValue(Ext.util.Format.usMoney(t,2));l.realValue=t;if(e.loaded){e.loaded=false;var q=Ext.ComponentQuery.query("displayfield[name=netProfit]")[0];var k=Ext.ComponentQuery.query("displayfield[name=incomeTotal]")[0];if(k){var o=k.realValue,m=c=="yes"?"Diferencia":"Ganancia";if(!q){q=Ext.create("Ext.form.field.Display",{fieldLabel:m,renderTo:"netProfit",name:"netProfit"})}var r=AL.math.sub(o,t);q.setValue(Ext.util.Format.usMoney(r,2))}}else{e.loaded=true}}}})},renderCashFlowInOptimized:function(c,e,f){var g=this;var a=Ext.ComponentQuery.query("report_IncomeTree")[0];if(a){a.destroy()}var d=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:c,to:e},url:"/report/retrieve-cash-flow/type/income/format/json",timeout:360000}});a=Ext.create("AL.view.report.IncomeTree",{renderTo:"incomeTree",store:d,showCategoriesCode:f});a.setLoading({msg:translate("loadingAction",true)});d.on("load",function(){a.expandAll();a.setLoading(false)});var b=a.getView();b.on("resize",function(){var k=Ext.dom.Query.select(".x-grid-row");for(var j=0;j<k.length;j++){if((j%2)!=0){var h=Ext.get(k[j]);h.addCls("dark-row")}}});d.load({callback:function(j,h,m){if(m){var l=Ext.decode(h.response.responseText);var k=l.results;if(k!=0){Ext.each(j,function(o){g.removeZeroCreditCategories(o)});Ext.each(g.removeCreditRecords,function(o){o.remove()})}var n=Ext.ComponentQuery.query("displayfield[name=incomeTotal]")[0];if(!n){n=Ext.create("Ext.form.field.Display",{fieldLabel:"Ingresos",renderTo:"incomeTotal",name:"incomeTotal"})}n.setValue(Ext.util.Format.usMoney(k,2));n.realValue=k}}})},renderCashFlowEquityOptimized:function(c,e,f){var g=this;var a=Ext.ComponentQuery.query("report_EquityTree")[0];if(a){a.destroy()}var d=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:c,to:e},url:"/report/retrieve-cash-flow/type/equity/format/json",timeout:360000}});a=Ext.create("AL.view.report.EquityTree",{renderTo:"equityTree",store:d,showCategoriesCode:f});a.setLoading({msg:translate("loadingAction",true)});d.on("load",function(){a.expandAll();a.setLoading(false)});var b=a.getView();b.on("resize",function(){var k=Ext.dom.Query.select(".x-grid-row");for(var j=0;j<k.length;j++){if((j%2)!=0){var h=Ext.get(k[j]);h.addCls("dark-row")}}});d.load({callback:function(j,h,n){if(n){var m=Ext.decode(h.response.responseText);var k=m.results;if(k!=0){Ext.each(j,function(o){g.removeZeroCreditCategories(o)});Ext.each(g.removeCreditRecords,function(o){o.remove()})}var l=Ext.ComponentQuery.query("displayfield[name=equityTotal]")[0];if(!l){l=Ext.create("Ext.form.field.Display",{fieldLabel:"Patrimonio",renderTo:"equityTotal",name:"equityTotal"})}l.setValue(Ext.util.Format.usMoney(k,2));l.realValue=k}}})},renderCashFlowAssetOptimized:function(c,e,f){var g=this;var a=Ext.ComponentQuery.query("report_AssetTree")[0];if(a){a.destroy()}var d=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:c,to:e},url:"/report/retrieve-cash-flow/type/asset/format/json",timeout:360000}});a=Ext.create("AL.view.report.AssetTree",{renderTo:"assetTree",store:d,showCategoriesCode:f});a.setLoading({msg:translate("loadingAction",true)});d.on("load",function(){a.expandAll();a.setLoading(false)});var b=a.getView();b.on("resize",function(){var k=Ext.dom.Query.select(".x-grid-row");for(var j=0;j<k.length;j++){if((j%2)!=0){var h=Ext.get(k[j]);h.addCls("dark-row")}}});d.load({callback:function(j,h,n){if(n){var m=Ext.decode(h.response.responseText);var l=m.results;if(l!=0){Ext.each(j,function(o){g.removeZeroDebitCategories(o)});Ext.each(g.removeDebitRecords,function(o){o.remove()})}var k=Ext.ComponentQuery.query("displayfield[name=assetTotal]")[0];if(!k){k=Ext.create("Ext.form.field.Display",{fieldLabel:"Activos",renderTo:"assetTotal",name:"assetTotal"})}k.setValue(Ext.util.Format.usMoney(l,2));k.realValue=l}}})},renderCashFlowLiabilityOptimized:function(c,e,f){var g=this;var a=Ext.ComponentQuery.query("report_LiabilityTree")[0];if(a){a.destroy()}var d=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:c,to:e},url:"/report/retrieve-cash-flow/type/liability/format/json",timeout:360000}});a=Ext.create("AL.view.report.LiabilityTree",{renderTo:"liabilityTree",store:d,showCategoriesCode:f});a.setLoading({msg:translate("loadingAction",true)});d.on("load",function(){a.expandAll();a.setLoading(false)});var b=a.getView();b.on("resize",function(){var k=Ext.dom.Query.select(".x-grid-row");for(var j=0;j<k.length;j++){if((j%2)!=0){var h=Ext.get(k[j]);h.addCls("dark-row")}}});d.load({callback:function(k,j,n){if(n){var m=Ext.decode(j.response.responseText);var l=m.results;if(l!=0){Ext.each(k,function(o){g.removeZeroCreditCategories(o)});Ext.each(g.removeCreditRecords,function(o){o.remove()})}var h=Ext.ComponentQuery.query("displayfield[name=liabilityTotal]")[0];if(!h){h=Ext.create("Ext.form.field.Display",{fieldLabel:"Pasivos",renderTo:"liabilityTotal",name:"liabilityTotal"})}h.setValue(Ext.util.Format.usMoney(l,2));h.realValue=l}}})},renderCashFlowOutOptimized:function(c,e,f){var g=this;var a=Ext.ComponentQuery.query("report_ExpenseTree")[0];if(a){a.destroy()}var d=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",sorters:["text"],root:{children:[]},proxy:{type:"ajax",extraParams:{from:c,to:e},url:"/report/retrieve-cash-flow/type/expense/format/json",timeout:360000}});a=Ext.create("AL.view.report.ExpenseTree",{renderTo:"expenseTree",store:d,showCategoriesCode:f});a.setLoading({msg:translate("loadingAction",true)});d.on("load",function(){a.expandAll();a.setLoading(false)});var b=a.getView();b.on("resize",function(){var k=Ext.dom.Query.select(".x-grid-row");for(var j=0;j<k.length;j++){if((j%2)!=0){var h=Ext.get(k[j]);h.addCls("dark-row")}}});d.load({callback:function(j,h,n){if(n){var l=Ext.decode(h.response.responseText);var k=l.results;if(k!=0){Ext.each(j,function(o){g.removeZeroDebitCategories(o)});Ext.each(g.removeDebitRecords,function(o){o.remove()})}var m=Ext.ComponentQuery.query("displayfield[name=expenseTotal]")[0];if(!m){m=Ext.create("Ext.form.field.Display",{fieldLabel:"Egresos",renderTo:"expenseTotal",name:"expenseTotal"})}m.setValue(Ext.util.Format.usMoney(k,2));m.realValue=k}}})},renderAccountsBalances:function(a,b){Ext.Ajax.request({url:"/account/retrieve-total-accounts-balance-to-date/date/"+a+"/format/json",timeout:360000,success:function(c,d){var e=Ext.decode(c.responseText,true);if(e&&e.success){var f=Ext.ComponentQuery.query("displayfield[name=accountInitialBalanceField]")[0];if(f){f.setValue(Ext.util.Format.usMoney(e.results))}else{Ext.create("Ext.container.Container",{renderTo:"initialBalance",items:[{xtype:"displayfield",fieldLabel:"Saldo inicial",labelClsExtra:"accountBalanceTitle",name:"accountInitialBalanceField",value:Ext.util.Format.usMoney(e.results,2)}]})}}},failure:function(){}});Ext.Ajax.request({url:"/account/retrieve-total-accounts-balance-to-date/date/"+b+"/format/json",timeout:360000,success:function(c,d){var e=Ext.decode(c.responseText,true);if(e&&e.success){var f=Ext.ComponentQuery.query("displayfield[name=accountEndBalanceField]")[0];if(f){f.setValue(Ext.util.Format.usMoney(e.results))}else{Ext.create("Ext.container.Container",{renderTo:"finalBalance",items:[{xtype:"displayfield",fieldLabel:"Saldo final",labelClsExtra:"accountBalanceTitle",name:"accountEndBalanceField",value:Ext.util.Format.usMoney(e.results,2)}]})}}},failure:function(){}})},destroyProfitAndLossTrees:function(){var a=Ext.ComponentQuery.query("report_ProfitAndLossTree");Ext.each(a,function(b){b.destroy()})},removeZeroDebitCategories:function(a,b){if(parseFloat(a.get("debit"))==0){this.removeDebitRecords.push(a)}else{if(a.hasChildNodes()){Ext.each(a.childNodes,function(c){this.removeZeroDebitCategories(c,"myself")},this)}}},removeZeroCreditCategories:function(a,b){if(parseFloat(a.get("credit"))==0){this.removeCreditRecords.push(a)}else{if(a.hasChildNodes()){Ext.each(a.childNodes,function(c){this.removeZeroCreditCategories(c,"myself")},this)}}},renderSectionOneOptimized:function(b,a,d,c,j){var e=this,g="/ledger/"+c;if(j){g+="/idCostCenter/"+j}var h=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",extraParams:{from:b,to:a},url:"/report/retrieve-profit-and-loss/section/one/format/json"+g,timeout:360000}});var k=Ext.create("AL.view.report.ProfitAndLossTree",{renderTo:"sectionOne",store:h,showCategoriesCode:d});k.setLoading({msg:translate("loadingAction",true)});h.on("load",function(){k.expandAll();k.setLoading(false)});var f=k.getView();f.on("resize",function(){var n=Ext.dom.Query.select(".x-grid-row");for(var m=0;m<n.length;m++){if((m%2)!=0){var l=Ext.get(n[m]);l.addCls("dark-row")}}});h.load({callback:function(m,l,p){if(p){var o=Ext.decode(l.response.responseText);var n=o.total;e.sectionOneTotal=AL.math.approx(n,null,2);e.renderSectionFour()}}})},renderSectionTwoOptimized:function(b,a,d,c,j){var e=this,g="/ledger/"+c;if(j){g+="/idCostCenter/"+j}var h=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",extraParams:{from:b,to:a},url:"/report/retrieve-profit-and-loss/section/two/format/json"+g,timeout:360000}});var k=Ext.create("AL.view.report.ProfitAndLossTree",{renderTo:"sectionTwo",store:h,showCategoriesCode:d});k.setLoading({msg:translate("loadingAction",true)});h.on("load",function(){k.expandAll();k.setLoading(false)});var f=k.getView();f.on("resize",function(){var n=Ext.dom.Query.select(".x-grid-row");for(var m=0;m<n.length;m++){if((m%2)!=0){var l=Ext.get(n[m]);l.addCls("dark-row")}}});h.load({callback:function(m,l,p){if(p){var o=Ext.decode(l.response.responseText);var n=o.total;e.sectionTwoTotal=AL.math.approx(n,null,2);e.renderSectionFour()}}})},renderSectionThreeOptimized:function(b,a,d,c,j){var e=this,g="/ledger/"+c;if(j){g+="/idCostCenter/"+j}var h=Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",extraParams:{from:b,to:a},url:"/report/retrieve-profit-and-loss/section/three/format/json"+g,timeout:360000}});var k=Ext.create("AL.view.report.ProfitAndLossTree",{renderTo:"sectionThree",store:h,showCategoriesCode:d});k.setLoading({msg:translate("loadingAction",true)});h.on("load",function(){k.expandAll();k.setLoading(false)});var f=k.getView();f.on("resize",function(){var n=Ext.dom.Query.select(".x-grid-row");for(var m=0;m<n.length;m++){if((m%2)!=0){var l=Ext.get(n[m]);l.addCls("dark-row")}}});h.load({callback:function(m,l,p){if(p){var o=Ext.decode(l.response.responseText);var n=o.total;e.sectionThreeTotal=AL.math.approx(n,null,2);e.renderSectionFour()}}})},renderSectionFour:function(){var b=this;if(++b.treesRendered==4){b.treesRendered=1;var c=Ext.ComponentQuery.query("report_ProfitAndLossTree[renderTo=sectionFour]")[0];if(c){c.destroy()}var a=Ext.select("div#sectionOneTotal div.value");a.setHTML(Ext.util.Format.usMoney(b.sectionOneTotal,2));a=Ext.select("div#sectionTwoTotal div.value");a.setHTML(Ext.util.Format.usMoney(b.sectionOneTotal+b.sectionTwoTotal,2));a=Ext.select("div#sectionThreeTotal div.value");a.setHTML(Ext.util.Format.usMoney(b.sectionOneTotal+b.sectionTwoTotal+b.sectionThreeTotal,2))}},renderBalance:function(j){var d=j.up("form"),k=d.configs.ledger;var e=d.down("datefield[name=toDate]");var f=e.getValue();var q=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate(),r="/toDate/"+q+"/format/json/ledger/"+k;var l=Ext.get("treeAsset");var t=Ext.get("treeLiability");var o=Ext.get("treeEquity");if(l){l.destroy()}if(t){t.destroy()}if(o){o.destroy()}var p=Ext.create("Ext.tree.Panel",{cls:"categories-tree",rootVisible:false,renderTo:"assetTree",id:"treeAsset",title:"Activos",minHeight:144,store:Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",timeout:360000,url:"/report/retrieve-optimized-general-balance/type/asset"+r},listeners:{load:function(u,c,v){var w=0;Ext.each(v,function(a){w+=parseFloat(a.get("debit"))});Ext.get("totalAsset").setHTML(Ext.util.Format.usMoney(parseFloat(w),2))}}}),columns:{items:[{xtype:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"text",renderer:function(b,c,a){if(d.configs.showCategoriesCode=="yes"&&a.get("code")){b=a.get("code")+" - "+b}return'<a href="/category/view/id/'+a.get("idLocal")+'">'+b+"</a>"}},{text:"Total",colName:"money",flex:1,dataIndex:"debit",renderer:"usMoney",align:"right",sortable:true,renderer:function(c,b,a){if(a.get("debit")){c=a.get("debit")}else{c=a.get("credit")}return Ext.util.Format.usMoney(c,2)}}]}});p.getStore().load();var h=false;var g=0;var s=0;var n=Ext.create("Ext.tree.Panel",{cls:"categories-tree",rootVisible:false,renderTo:"liabilityTree",id:"treeLiability",title:"Pasivos",minHeight:72,store:Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",timeout:360000,url:"/report/retrieve-optimized-general-balance/type/liability"+r},listeners:{load:function(u,c,v){Ext.each(v,function(a){g+=parseFloat(a.get("credit"))});if(h){Ext.get("totalLiabilityEquity").setHTML(Ext.util.Format.usMoney(parseFloat(g)+parseFloat(s),2))}else{h=true}}}}),columns:{items:[{xtype:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"text",renderer:function(b,c,a){if(d.configs.showCategoriesCode=="yes"&&a.get("code")){b=a.get("code")+" - "+b}return'<a href="/category/view/id/'+a.get("idLocal")+'">'+b+"</a>"}},{text:"Total",colName:"money",flex:1,dataIndex:"debit",renderer:"usMoney",align:"right",sortable:true,renderer:function(c,b,a){if(a.get("debit")){c=a.get("debit")}else{c=a.get("credit")}return Ext.util.Format.usMoney(c,2)}}]}});n.getStore().load();var m=Ext.create("Ext.tree.Panel",{cls:"categories-tree",rootVisible:false,renderTo:"equityTree",id:"treeEquity",title:"Patrimonio",minHeight:72,store:Ext.create("Ext.data.TreeStore",{model:"AL.model.Category",folderSort:true,root:{children:[]},proxy:{type:"ajax",timeout:360000,url:"/report/retrieve-optimized-general-balance/type/equity"+r},listeners:{load:function(u,c,v){Ext.each(v,function(a){s+=parseFloat(a.get("credit"))});if(h){Ext.get("totalLiabilityEquity").setHTML(Ext.util.Format.usMoney(parseFloat(g)+parseFloat(s),2))}else{h=true}}}}),columns:{items:[{xtype:"treecolumn",text:translate("category",true),flex:2,sortable:true,dataIndex:"text",renderer:function(b,c,a){if(d.configs.showCategoriesCode=="yes"&&a.get("code")){b=a.get("code")+" - "+b}return'<a href="/category/view/id/'+a.get("idLocal")+'">'+b+"</a>"}},{text:"Total",colName:"money",flex:1,dataIndex:"debit",renderer:"usMoney",align:"right",sortable:true,renderer:function(c,b,a){if(a.get("debit")){c=a.get("debit")}else{c=a.get("credit")}return Ext.util.Format.usMoney(c,2)}}]}});m.getStore().load()},generateTaxGrid:function(e,d,c,b){var a=Ext.create("Ext.data.Store",{model:"AL.model.TaxReport",folderSort:true,pageSize:10,remoteSort:true,sorters:[{direction:"DESC"}],proxy:{type:"ajax",extraParams:{fromDate:c,toDate:b,id:e.idTax,type:d},timeout:360000,url:"/report/retrieve-tax-applications/format/json",reader:{type:"json",root:"taxes"}},autoLoad:true});return Ext.create("Ext.panel.Panel",{margin:"20 0",border:false,name:"taxPanel",bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"box",style:"background: transparent",margin:"10 0",html:'<div class="subTitle">Impuesto:  '+e.taxName+" ("+e.tax+"%) "+(e.taxStatus==="inactive"?'<span style="color:#888">(Inactivo)</span>':"")+"</div>"},Ext.create("AL.view.report.GridTaxes",{store:a,dockedItems:[{store:a,xtype:"pagingtoolbar"}],listeners:{afterrender:function(h){var k=h.down("gridcolumn[name=number]");var f=h.down("gridcolumn[name=discount]");var g=h.down("gridcolumn[name=transactionNumber]");if(d==="credits"){k.setText(translate("creditNote",true));var j=h.down("gridcolumn[name=itemName]");var l=h.down("gridcolumn[name=itemName]");k.sortable=false;j.sortable=false;l.sortable=false;g.hide()}if(d==="sales"){k.setText(translate("invoice",true))}if(d==="debits"){k.setText("Nota débito");g.hide();f.hide()}if(d=="debits"){f.hide()}}}}),{xtype:"box",heigth:100,html:'<div class="total"><div class="label">Total:</div>'+Ext.util.Format.usMoney(e.taxTotal,2)+"</div>"}]})},generateRetentionGrid:function(g,f,d,c){var b=Ext.ComponentQuery.query("report_DatesForm")[0];var e=b&&b.configs.country&&b.configs.country=="colombia";var a=Ext.create("Ext.data.Store",{model:"AL.model.RetentionReport",folderSort:true,pageSize:10,remoteSort:true,sorters:[{direction:"DESC"}],proxy:{type:"ajax",extraParams:{fromDate:d,toDate:c,id:g.idRetention,type:f},timeout:360000,url:"/report/retrieve-retentions-applications/format/json",reader:{type:"json",root:"retentionsApplied"}},autoLoad:true});var h;if(e){h={xtype:"box",html:'<div class="total" style="width: 550px;"><div class="label">Totales:</div>'+Ext.util.Format.usMoney(g.baseTotal,2)+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+Ext.util.Format.usMoney(g.retentionTotal,2)+"</div>"}}else{h={xtype:"box",html:'<div class="total"><div class="label">Total:</div>'+Ext.util.Format.usMoney(g.retentionTotal,2)+"</div>"}}return Ext.create("Ext.panel.Panel",{margin:"20 0",border:false,name:"taxPanel",bodyStyle:"background: transparent",style:"background: transparent",items:[{xtype:"box",style:"background: transparent",margin:"10 0",html:'<div class="subTitle">'+translate("retention",true)+":  "+g.retentionName+(g.calculatedBy=="percentage"?(" ("+AL.math.approx(g.percentage,null,4)+"%) "):"")+(g.retentionStatus==="inactive"?'<span style="color:#888">(Inactiva)</span>':"")+"</div>"},Ext.create("AL.view.report.GridRetentions",{store:a,dockedItems:[{store:a,xtype:"pagingtoolbar"}],configs:{allowBase:e},listeners:{afterrender:function(j){var k=j.down("gridcolumn[name=number]");if(f==="appliedTo"){k.setText(AL.config.currentKeyCountry==="argentina"?"Comprobante":translate("invoice",true))}}}}),h]})},updateMissingAmount:function(h,c,a,d){var d=d;if(!d){var g=Ext.ComponentQuery.query("report_DatesForm datefield[name=toDate]")[0];var f=g.getValue();d=f?f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate():""}var e={};if(c){e.filters=c}if(d){e.toDate=d}var k=2;var b="";var j="";switch(h){case"bills":b="retrieve-bills-missing-amount";j="Total por pagar ";if(a.configs.decimalPrecision>2){k=a.configs.decimalPrecision}break;case"invoices":b="retrieve-invoices-missing-amount";j="Total por cobrar ";break;default:console.warn("invalid type");return}if(a){if(a.configs.multicurrency=="yes"){if(a.configs.currency){j=j+'<span class="totalCurrencyTip">('+a.configs.currency+" "+a.configs.currencySymbol+")</span>"}}}Ext.Ajax.request({url:"/report/"+b+"/format/json",method:"POST",params:e,timeout:360000,success:function(m,n){var p=Ext.decode(m.responseText);if(p.success){var o=p.missingAmount,q=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];q.removeAll();var l="";if(e.filters){l=' <span class="filters-indicator">(con filtros)</span>'}q.addItem({label:j+l,value:AL.math.approx(o,null,k),important:true,decimalPrecision:k})}else{Ext.MessageBox.alert("Error",p.cause)}},failure:function(){}})},updateTotals:function(f,g,e,k,c,d){e=(typeof k!=="undefined"&&e)?true:false;k=(typeof k!=="undefined"&&k)?true:false;c=(typeof c!=="undefined"&&c)?true:false;var b="/report/retrieve-"+f+"-totals";var h=[];switch(f){case"sales-by-seller":case"sales-sellers":h.push("totalPayed");case"sales":case"purchases":case"sales-by-item":case"sales-by-client":h.push("subtotal","total");break;case"transactions":h.push("totalIn","totalOut");break;case"statement":var a=window.location.href;if(a.indexOf("report")===-1){b=a.replace("statement","retrieve-total-statement")}else{b="/client/retrieve-total-statement/id/"+d}h.push("total","totalPaid","missingAmount");break;default:console.warn("invalid type");return}if(!c){var j={};Ext.each(h,function(l,m){var n=Ext.get(l);if(n){j[l]=n.getHTML();n.setHTML("Calculando")}})}b+="/format/json";Ext.Ajax.request({url:b,method:"POST",params:g,success:function(n,p){var q=Ext.decode(n.responseText);if(q.success){if(c){var r=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];if(!r){return console.warn("total panel not found")}r.removeItem('<span class="filters-indicator">'+translate("results",true)+"</span>");if(k){r.addItem({id:"filterIndicate",label:'<span class="filters-indicator">'+translate("results",true)+"</span>",value:'<span class="filters-indicator">('+translate("withFilters",true)+")</span>",type:"footer"});k=!k}Ext.each(r.items.items,function(t){var s=h.indexOf(t.id);if(s!==-1){totalElementId=h[s];var u=Ext.util.Format.usMoney(q[totalElementId],t.decimalPrecision,t.currencySign);t.setValue(u)}})}else{Ext.each(h,function(s,u){if(c){}else{var v=Ext.get(s);if(v){var t=q[s];if(typeof t==="undefined"||!t){t=0}v.setHTML(Ext.util.Format.usMoney(t,2))}}});if(e===true){var m="";if(k===true){m=' <span class="filters-indicator">('+translate("withFilters",true)+")</span>"}var l=Ext.get("totals-label"),o=l.getAttribute("data-text");if(!o){o="Totales"}l.setHTML(o+m)}}}else{if(!q.success&&!c){Ext.each(h,function(s,t){var u=Ext.get(s);if(u){u.setHTML(Ext.util.Format.usMoney(j[s],2))}})}}},failure:function(){Ext.each(h,function(l,m){var n=Ext.get(l);if(n){n.setHTML(Ext.util.Format.usMoney(j[l],2))}})}})},excelExport:function(d){var b=d,u=b.configs.canExport;if(u=="no"){Ext.create("AL.view.company.WindowAclError",{configs:{title:"No cuentas con permisos para acceder",text:"Parece que no estás autorizado para realizar esta acción.  Si deseas más información, comunícate con el administrador de la cuenta."},cls:"access-denied"})}else{var y=b.down("datefield[name=fromDate]");var m=b.down("datefield[name=toDate]");var q=y.getValue();var w=m.getValue();var t=q?q.getFullYear()+"-"+(q.getMonth()+1)+"-"+q.getDate():"";var o=m?w.getFullYear()+"-"+(w.getMonth()+1)+"-"+w.getDate():"";var j="";var h=b.down("combo[name=idCostCenter]");if(h&&h.getSelectedRecord()){j="/idCostCenter/"+h.getValue()}else{if(h){if(h.getValue()!=""&&h.getValue()!=null){h.markInvalid(translate("costCenterErrorCombo",true));return}}}if(b.configs.emailReport&&b.configs.emailReport=="yes"){var z={};if(b.configs.buttonAction=="renderSalesBySeller"){var x=Ext.ComponentQuery.query("combo[name=idSeller]")[0];z.idSeller=x.getValue()}if(b.configs.buttonAction=="renderSales"){var c=Ext.ComponentQuery.query("combo[name=idResolution]")[0];z.idResolution=c.getValue();var k=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];z.idWarehouse=k.getValue()}if(b.configs.buttonAction=="renderLedgerJournals"){var n=Ext.ComponentQuery.query("combo[name=resourceType]")[0];z.resourceType=n.getValue().join(",")}if(b.configs.buttonAction=="renderLedgerJournalCategories"){var s=Ext.ComponentQuery.query("combo[name=idCategory]")[0];z.idCategory=s.getValue()}if(b.configs.buttonAction=="renderInventory"){var k=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];if(k&&k.getSelectedRecord()&&k.getValue()){z.idWarehouse=k.getValue()}}if(b.configs.gridProxy&&b.configs.gridProxy.extraParams.filters){z.filters=b.configs.gridProxy.extraParams.filters}if(b.configs.buttonAction==="renderOpenInvoices"||b.configs.buttonAction==="renderOpenBills"){var g=b.configs.buttonAction==="renderOpenInvoices"?Ext.ComponentQuery.query("report_GridOpenInvoices")[0]:Ext.ComponentQuery.query("report_GridOpenBills")[0];if(g.overdueDaysFilter){var p=[];if(z.filters){p=Ext.decode(z.filters)}p.push(g.overdueDaysFilter);z.filters=Ext.encode(p)}}var l=["Alegra está generando tu archivo de excel y puede ","demorar unos minutos.<br />Cuando se termine el ","proceso, el archivo será enviado a tu correo ","electrónico."].join("");var f=/\/labs\/test1[1,5]/i;if(f.test(b.configs.excelUrlGenerator)){var e=Ext.get("exportBtn");if(e){var r=e.down("svg");if(!r.hasCls("icon-spin")){r.update('<use xlink:href="/images/smile-icons.svg#loading"></use>');r.dom.classList.add("icon-spin");Ext.Ajax.request({url:b.configs.excelUrlGenerator+"/from-date/"+t+"/to-date/"+o+j+"/format/json",params:z,binary:true,success:function(F,K){try{var G=String.fromCharCode.apply(null,new Uint8Array(F.responseBytes));G=G.replace(/Already running.../gi,"");var C=Ext.decode(G);if(!C.success){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(C.rowsCount==0){l=translate("sorryNoRecordsFoundToExport",true)}Ext.Msg.show({title:translate("generatingExcelFile",true),msg:l,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}catch(J){var B="";var D=F.getResponseHeader("Content-Disposition");if(D&&D.indexOf("attachment")!==-1){var E=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var I=E.exec(D);if(I!=null&&I[1]){B=I[1].replace(/['"]/g,"")}}var M=F.getResponseHeader("Content-Type");var A=typeof File==="function"?new File([F.responseBytes],B,{type:M}):new Blob([F.responseBytes],{type:M});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(A,B)}else{var L=window.URL||window.webkitURL;var H=L.createObjectURL(A);if(B){var N=document.createElement("a");if(typeof N.download==="undefined"){window.location=H}else{N.href=H;N.download=B;document.body.appendChild(N);N.click()}}else{window.location=H}setTimeout(function(){L.revokeObjectURL(H)},100)}}finally{r.update('<use xlink:href="/images/smile-icons.svg#export"></use>');r.dom.classList.remove("icon-spin")}},failure:function(A){console.log(A);Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});r.update('<use xlink:href="/images/smile-icons.svg#export"></use>');r.dom.classList.remove("icon-spin")}})}}}else{Ext.Msg.show({title:translate("generatingExcelFile",true),msg:l,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION});Ext.Ajax.request({url:b.configs.excelUrlGenerator+"/from-date/"+t+"/to-date/"+o+"/format/json",params:z,success:function(A,B){var C=Ext.decode(A.responseText);if(!C.success){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}},failure:function(){Ext.Msg.show({title:"Ocurrió un error",msg:'Tu exportable no se pudo generar, inténtalo de nuevo más tarde o comunícate a  <a href="support-link">getsoft.app/123</a>',buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}})}}else{var v="";if(b.configs.buttonAction=="renderInventory"){var k=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];if(k&&k.getSelectedRecord()&&k.getValue()){v="/idWarehouse/"+k.getValue()}}if(b.configs.buttonAction=="renderSubsidiaryLedger"){var a=Ext.ComponentQuery.query("combo[name=idClient]")[0];if(a.getValue()){v+="/idClient/"+a.getValue()}if(b.configs.gridProxy&&b.configs.gridProxy.extraParams.filters){v+="/filters/"+b.configs.gridProxy.extraParams.filters}}if(j){v+=j}window.location=b.configs.excelUrlGenerator+"from/"+t+"/to/"+o+v}}},doAfterLoadInventoryValue:function(b,d){var a=Ext.get("totalInventory"),c=b.getDockedItems("pagingtoolbar")[0];if(d){a.hide();if(!c){b.addDocked({xtype:"pagingtoolbar",store:"InventoriesReport"})}}else{a.show();if(c){b.removeDocked(c)}}}});Ext.define("AL.view.tax.FormAdd",{extend:"Ext.form.Panel",requires:["AL.view.ux.form.GroupingComboBox"],alias:"widget.tax_FormAdd",title:"Nuevo tipo de impuesto",layout:"anchor",border:false,bodyStyle:{background:"transparent"},cancelSaveButtonsAttributes:{requiredText:translate("requiredText",true)},categoryChanged:false,canSetupTaxCategories:false,isWindow:false,items:[{xtype:"panel",bodyPadding:"30 0 10 0",width:520,layout:"anchor",style:"margin: 5px; box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.1);",items:[{xtype:"fieldset",title:'<span style="color: #00535E; font-size: 14px;">'+translate("generalSetting",true)+"</span>",itemId:"generalFields",padding:"20 20 5 20",border:"1 0 0 0",style:{borderColor:"#cccccc"},defaults:{anchor:"100%",labelWidth:220,labelAlign:"right",maxWidth:450,labelPad:15,msgTarget:"side"},defaultType:"textfield",items:[{xtype:"container",itemId:"alertContainer",cls:"form-alert",html:'<section class="alert-wrapper"><div class="alert info"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#info-outline"></use></svg><p class="alert-content" style="float: none;">'+translate("theGeneralConfigurationCannotBeEditedOnTaxesThatHaveAlreadyBeenUsed",true)+'</p></div><div class="is-clearfix"></div></section>',hidden:true,},{xtype:"hidden",name:"idLocal",allowBlank:false},{fieldLabel:translate("name",true),name:"name",allowBlank:false},{fieldLabel:translate("percentage",true),name:"tax",allowBlank:false,regex:/^([0-9]+(\.[0-9]+)?)$/,cls:"percentaje",regexText:translate("onlyNumericalValuesWithDecimalSeparator",true)},{xtype:"combo",fieldLabel:translate("taxType",true),name:"idTaxReference",displayField:"name",valueField:"id",allowBlank:false,editable:false,store:"TaxReferences",queryMode:"local",forceSelection:true,listeners:{afterrender:function(b){var a=b.getStore();a.load()}}},{xtype:"combo",fieldLabel:"Tipo de tarifa",name:"rateType",displayField:"value",valueField:"key",store:"RateTypes",queryMode:"local",forceSelection:true,hidden:true,allowBlank:true,requires:["costaRica"]},{xtype:"checkboxfield",name:"deductible",inputValue:"yes",fieldLabel:translate("tax",true)+" "+translate("deductible"),tooltip:translate("disableThisOptionOnlyIfTheTaxWillIncreaseTheCostValue",true),hidden:true,checked:true},{xtype:"textarea",fieldLabel:translate("description",true),name:"description",allowBlank:true},],},{xtype:"fieldset",title:'<span style="color: #00535E; font-size: 14px;">'+translate("accountingSetting",true)+"</span>",itemId:"accountingFields",padding:"20 20 5 20",border:"1 0 0 0",hidden:true,style:{borderColor:"#cccccc"},defaults:{anchor:"100%",labelWidth:220,labelAlign:"right",maxWidth:450,labelPad:15,msgTarget:"side",xtype:"groupingcombobox",groupField:["parentName"],cls:"category-combo-component",displayField:"text",valueField:"idLocal",allowBlank:false,forceSelection:true,disabled:true,typeAhead:true,matchFieldWidth:false,minChars:1,disabledField:"blocked",disabledValue:"yes",listConfig:{width:300,height:200},tooltip:translate("selectTheAccountInWhichTheTaxWillBePosted",true)},items:[{fieldLabel:translate("category",true)+" "+translate("forSales"),name:"idCategoryToBePaid",store:"TaxCategoriesToBePaidCombo",},{fieldLabel:translate("category",true)+" "+translate("forPurchases"),name:"idCategoryFavorable",store:"TaxCategoriesFavorableCombo",}],}]},{xtype:"buttons_modern_CancelSave",width:670,requiredTextMargin:"9 0 0 4"}],initComponent:function(){this.addAttributes(this.items[1],this.cancelSaveButtonsAttributes);if(this.isWindow){delete this.items[0].style;this.items[0].bodyPadding="20 0 10 0";this.items[1].hidden=true}if(this.configs&&typeof this.configs.canSetupTaxCategories!=="undefined"){this.canSetupTaxCategories=this.configs.canSetupTaxCategories}this.callParent(arguments)},addAttributes:function(b,a){var c;for(c in a){b[c]=a[c]}},getFieldValuesAsMetadata:function(){var c=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":var b=this.down("combo[name=rateType]");c={rateType:b.getValue()};break}return c},setFieldValuesFromMetadata:function(d){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":if(typeof d.rateType!=="undefined"){var c=this.down("combo[name=rateType]");var b=c.getStore();if(b.hasLoaded()){c.setValue(d.rateType)}else{b.on("load",function(e){c.setValue(d.rateType)})}}break}}});Ext.define("AL.controller.Tax",{extend:"Ext.app.Controller",views:["tax.FormAdd","tax.GridAll","tax.TaxToolbar","tax.AdvancedSettingsForm","buttons.modern.CancelSave",],stores:["Taxes","TaxReferences","TaxCategoriesFavorableCombo","TaxCategoriesToBePaidCombo","RateTypes",],models:["Tax","TaxReference","CategoryCombo","CountryLegalParameter",],init:function(){this.application.addListener("deleteTax",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("tax")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("tax")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/tax/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("toggleTaxStatus",function(c){var a=c.record.data;var b=c.initiator;Ext.Ajax.request({url:"/tax/toggle-status/format/json",method:"POST",params:{id:a.idLocal},success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){if(b){var d=b.getStore();d.load()}}else{if(g.cause){GlobalMsg.showErrorMessage("Error",g.cause)}}},failure:function(){}})},this);this.control({"tax_FormAdd button[action=save]":{click:this.saveTax},tax_FormAdd:{render:this.initialize,afterrender:function(b){var a=b.down("combo[name=rateType]");a.allowBlank=true}},"tax_FormAdd [name=idCategoryToBePaid], tax_FormAdd [name=idCategoryFavorable]":{select:function(e,d,a,b){var c=e.up("form");c.categoryChanged=true},beforerender:function(d){var b=d.up("form"),a=b.down("combo[name=idTaxReference]"),c=b.down("checkboxfield[name=deductible]");d.getStore().on("load",function(h,f,l){if(l!==true||!a.getValue()){return}var j=a.getSelectedRecord();if(!j){return}d.queryMode="local";var g="";if(d.getName()=="idCategoryFavorable"){if(!c.getValue()){g="ID_TAX_NOT_DEDUCTIBLE"}else{switch(b.configs.country){case"colombia":switch(j.get("keyTaxReference")){case"IVA":g="ID_IVA_IN_FAVOR_COL";break;case"ICO":g="ID_ICO_IN_FAVOR_COL";break;case"OTRO":g="ID_OTHER_TAX_TYPE_IN_FAVOR";break}break}}}else{switch(b.configs.country){case"colombia":switch(j.get("keyTaxReference")){case"IVA":g="ID_IVA_TO_PAY_COL";break;case"ICO":g="ID_ICO_TO_PAY_COL";break;case"OTRO":g="ID_OTHER_TAX_TYPE_TO_PAY";break}break}}if(!g){return}categoryRulesStore=Ext.create("AL.store.CategoryRules");var e=categoryRulesStore.findRecord("key",g);if(e){var k=d.findRecord("idCategoryRule",e.get("id"));if(k){d.select(k)}}})}},"tax_FormAdd combo[name=idTaxReference]":{change:function(g,f){var d=g.up("form"),h=[d.down("combo[name=idCategoryToBePaid]"),d.down("combo[name=idCategoryFavorable]"),],e=d.down("checkboxfield[name=deductible]");var a=g.getSelectedRecord();if(d.configs&&d.configs.country==="costaRica"){var c=d.down("combo[name=rateType]");if(a&&["IVA"].indexOf(a.get("keyTaxReference"))!==-1){var b=c.getStore();if(b.hasLoaded()){c.setValue("GENERAL")}else{b.on("load",function(){c.setValue("GENERAL")})}c.show();c.allowBlank=false}else{c.setValue(null);c.hide();c.allowBlank=true}}if(!a||!d.canSetupTaxCategories){return}Ext.each(h,function(j){var k=j.getStore().getProxy();k.setExtraParam("idTaxReference",f);if(j.getName()=="idCategoryFavorable"&&!e.getValue()){return}k.clearCache();j.reset();delete j.lastQuery;j.queryMode="remote";j.getStore().load();j.queryMode="local"})}},"tax_FormAdd checkboxfield[name=deductible]":{beforerender:function(a){var c=a.up("form"),b=c.down("combo[name=idCategoryFavorable]");b.getStore().getProxy().setExtraParam("deductible",a.getValue()?"yes":"no")},change:function(a,d){var c=a.up("form"),b=c.down("combo[name=idCategoryFavorable]");idCategoryFavorableProxy=b.getStore().getProxy();if(!c.canSetupTaxCategories){return}idCategoryFavorableProxy.setExtraParam("deductible",d?"yes":"no");idCategoryFavorableProxy.clearCache();b.reset();delete b.lastQuery;b.queryMode="remote";if(!b.isDisabled()){b.getStore().load();b.queryMode="local"}}},"tax_FormAdd fieldset[itemId=accountingFields]":{afterrender:function(b){var a=b.up("form");if(a.canSetupTaxCategories){b.down("[name=idCategoryToBePaid]").enable();b.down("[name=idCategoryFavorable]").enable();b.show()}}},"tax_TaxToolbar button[action=addTax]":{click:function(){window.location="/tax/add"}},tax_GridAllTaxes:{render:function(a){a.getStore().load()}},"tax_GridAllTaxes gridcolumn[type=taxActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteTax")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteTax",{record:c,initiator:a})}else{Ext.Msg.alert("Error",translate("youCantEliminateTaxesThatAreAlreadyAssociatedWithSomething",true))}}if(d.hasCls("toggleTaxStatus")){h.preventDefault();l.fireEvent("toggleTaxStatus",{record:c,initiator:a})}}},"tax_GridAllTaxes gridcolumn[type=taxType]":{render:function(b){var a=b.up("grid");if(a.configs.country=="other"){b.hide()}}},"tax_AdvancedSettingsForm button[action=save]":{click:function(a){var b=a.up("form");if(b.isValid()){b.submit({url:"/configuration/taxes-settings/format/json",waitMsg:translate("loading",true),success:function(e,d){var c=d.response;var f=Ext.decode(c.responseText);if(f.success){window.location="/configuration"}else{GlobalMsg.showErrorMessage("Error",f.cause,"no")}}})}}},tax_AdvancedSettingsForm:{afterrender:function(a){GlobalLoadMask.show(a);Ext.Ajax.request({url:"/configuration/taxes-settings/format/json",success:function(b){GlobalLoadMask.hide(a);var d=Ext.decode(b.responseText);var c=d.results;if(c.multipletaxes=="yes"){a.down("checkbox[name=multipletaxes]").setValue(true);a.down("checkbox[name=multipletaxes]").setDisabled(true)}}})}},groupinlist:{containerclick:this.listClick},boundlist:{containerclick:this.listClick},"combo[name=idTax]":{beforerender:function(b){var a=b.up("form");if(a.canCreateNewTax=="yes"){b.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl><div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}}}})},initialize:function(d){var k=d.down("combo[name=idTaxReference]"),b=d.down("checkbox[name=deductible]"),e=d.canSetupTaxCategories;if(d.configs.country=="other"||d.configs.country=="usa"){var h=k.getStore();h.on("load",function(){var l=h.findRecord("name","Otro");k.select(l)});k.hide()}if(d.configs.multipleTaxes=="yes"){b.show()}d.down("combo[name=idCategoryFavorable]").allowBlank=false;d.down("combo[name=idCategoryToBePaid]").allowBlank=false;if(d.type&&d.type=="edit"){var c=d.down("textfield[name=name]"),a=d.down("hidden[name=idLocal]"),f=d.down("textfield[name=tax]"),j=d.down("textarea[name=description]");if(!d.editable||d.areEditableOnlyTheCategories){d.down("fieldset[itemId=generalFields]").disable();d.down("container[itemId=alertContainer]").addCls("visible");d.down("container[itemId=alertContainer]").show()}var g=Ext.create("AL.LoadMask",{target:d,msg:translate("loading",true)});d.on("afterrender",function(){g.show()});g.addDependantTask();Ext.Ajax.request({url:"/tax/retrieve-one/id/"+d.idLocal+"/format/json",success:function(m){var q=Ext.decode(m.responseText);var o=q.results;a.setValue(o.idLocal);c.setValue(o.name);f.setValue(o.tax);j.setValue(o.description);var r=b.getValue(),n=o.deductible=="yes"?true:false;b.setValue(n);if(r==n){b.fireEvent("change",b,n,r)}var l=k.getStore(),p=function(){k.select(o.idTaxReference);var s=function(z,u){g.addDependantTask();var t=d.down("combo[name="+z+"]");var y=t.getStore(),w=u+"",x=function(){var A=t.findRecord("idLocal",w);if(A){t.select(A)}d.categoryChanged=false};if(y.hasLoaded()){x();g.endDependantTask()}else{var v=function(){x();g.endDependantTask()};if(!y.isLoading()){y.load({callback:function(){v()}})}else{y.on("load",function(){v()})}}};if(e){if(o.idCategoryFavorable){s("idCategoryFavorable",o.idCategoryFavorable)}if(o.idCategoryToBePaid){s("idCategoryToBePaid",o.idCategoryToBePaid)}}g.endDependantTask()};if(o.metadata){d.setFieldValuesFromMetadata(o.metadata)}g.addDependantTask();if(!l.hasLoaded()||l.isLoading()){l.on("load",p);if(!l.hasLoaded()){l.load()}}else{p()}g.endDependantTask()}})}},saveTax:function(c){GlobalRedirector.go({zoneTitle:translate("savingTax",true)});var f=c.up("form");var b="/tax/add/format/json"+(f.emergent?"/emergent/true":"");if(f.type&&f.type==="edit"){b="/tax/edit/format/json"}var a=f.getValues();var d=f.down("combo[name=idTaxReference]");if(!d.getSelectedRecord()){delete a.idTaxReference}if(f.type==="edit"&&!a.idLocal){a.idLocal=f.down("hidden[name=idLocal]").getValue()}a.deductible="no";if(f.down("checkbox[name=deductible]").getValue()){a.deductible="yes"}var e=function(){var h=Ext.ComponentQuery.query("tax_FormAdd")[0];var g=h.getFieldValuesAsMetadata();if(g){a.metadata=Ext.encode(g)}Ext.Ajax.request({url:b,method:"POST",params:a,success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){var o=n.results;if(h.callback){var k=h.getValues();var j=Ext.create("AL.model.Tax",k);j.set("idLocal",o);h.callback(j)}else{window.location="/tax"}if(h.emergent){GlobalRedirector.close()}}else{if(n.cause){GlobalMsg.showErrorMessage("Error",n.cause);GlobalRedirector.close()}}},failure:function(){if(h.emergent){Ext.MessageBox.alert("Error",responseText.cause)}else{GlobalMsg.showErrorMessage("Error",responseText.cause)}GlobalRedirector.close()}})};if(f.type&&f.type==="edit"&&f.canSetupTaxCategories===true&&f.categoryChanged===true){Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,frame:false,width:403,height:250,title:"Actualización contable",draggable:false,resizable:false,bodyStyle:{"margin-top":"0px !important","margin-bottom":"0px !important","padding-top":"0px !important","padding-bottom":"0px !important"},footer:{items:[{cls:"button main-button",text:"Entendido",formBind:true}]},items:[{xtype:"box",padding:"25 40 11 40",html:'<span style="font-size: 12px; font-family: Roboto, sans-serif;"><span style="color: #808080;">El cambio de <span style="font-weight: bold;">'+translate("categories")+'</span> se aplicará en las nuevas asociaciones de este impuesto. Para actualizar tu contabilidad anterior, comunícate con nosotros en </span> <a href="https://getsoft.app/123" target="_blank">getsoft.app/123</a></span>'}],listeners:{afterrender:function(j){var h=j.down("toolbar");var g=h.down("button");g.getEl().on("click",function(){j.hide();e()})}}})}else{e()}},listClick:function(d,g){var f=d.up("combo");var a=this.application;var c=Ext.ComponentQuery.query("item_FormAdd")[0];if(!c){c=Ext.ComponentQuery.query("bill_FormAddBill")[0]}if(!c){c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0]}if(!c){c=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0]}if(!c){c=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0]}if(!c){c=Ext.ComponentQuery.query("remission_FormAddRemission")[0]}if(!c){c=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0]}if(!c){c=Ext.ComponentQuery.query("transaction_FormTransaction")[0]}if(!c){c=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0]}if(!c){c=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0]}if(!c){c=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0]}if(c.configs&&c.configs.type){delete c.configs.type}if(g.target.getAttribute("data-action")=="quickNewTax"){g.preventDefault();if(c.emergent){window.open("/tax/add","_blank");return}var b=Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,id:"window-new-tax-modal",reason:"addNewTax",title:translate("addNewTax",true),border:false,resizable:false,width:540,bodyStyle:"overflow-y: auto;",bodyPadding:"0 5px 0 5px",items:[{xtype:"container",style:"position: relative;",id:"createNewTax",items:[{xtype:"container",id:"addTax",items:[{xtype:"tax_FormAdd",style:"margin-bottom: 0px;",isWindow:true,bodyPadding:0,title:"",configs:c.configs,emergent:true,callback:function(e){b.close();a.fireEvent("taxCreated",{record:e,initiator:f})}}]},]}],footer:{items:[{text:translate("cancelAction",true),handler:function(){this.up("window").close()},cls:"button",},{text:translate("save",true),cls:"button main-button",handler:function(e){var j=e.up("window");var h=j.down("button[action=save]");if(h){h.fireEvent("click",h)}},listeners:{afterrender:function(e){var j=e.up("window");var h=j.down("form");e.setDisabled(h.hasInvalidField());h.on("validitychange",function(l,k){e.setDisabled(!k)})}}}]},listeners:{afterrender:function(h){var e=h.down("button[action=save]");var j=h.down("buttons_Cancel");if(e){e.hide()}if(j){j.hide()}}}})}}});Ext.define("AL.view.transaction.FormTransaction",{extend:"Ext.form.Panel",alias:"widget.transaction_FormTransaction",requires:["AL.view.ux.form.GroupingComboBox","AL.view.ux.fields.Numeration"],bodyPadding:35,layout:"hbox",edit:false,style:"background: #fff; border: 1px solid #D0D0D0; padding: 21px 21px 5px 21px;",transactionType:null,items:[{xtype:"container",flex:1,defaultType:"textfield",defaults:{labelAlign:"right",labelPad:15,labelWidth:120,width:400,msgTarget:"side"},items:[{xtype:"hidden",name:"idTransaction"},{xtype:"datefield",fieldLabel:translate("date",true),name:"date",width:240,allowBlank:true,value:new Date(),format:"d/m/Y",invalidText:"{0} "+translate("itIsNotAValidDateItMust")+" {1}"},{xtype:"numerationField",name:"numerationComponent",configs:{documentType:this.transactionType==="in"?"transactionIn":"transactionOut",labelPad:15,fieldWidth:400,labelWidth:110,parent:"transaction_FormTransaction",autoload:false},width:400},{xtype:"combo",fieldLabel:translate("clientA",true),name:"idClient",minChars:0,triggerAction:"all",triggerCls:"x-form-search-trigger",allowBlank:true,store:"Clients",displayField:"name",valueField:"idLocal",forceSelection:true,emptyText:translate("selectSimple",true),listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:250,height:200,loadingText:translate("search",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"}},{xtype:"groupingcombobox",fieldLabel:translate("bankAccount",true),name:"idAccount",allowBlank:false,groupField:["typeName"],valueField:"idLocal",displayField:"name",queryMode:"local",typeAhead:true,store:"Accounts",blankText:translate("itIsNecessaryToSpecifyTheAccountToWhichTheMoneyWillEnter",true),emptyText:translate("selectSimple",true),listeners:{afterrender:function(a){a.setFieldLabel(translate("bankAccount",true)+'<span class="req">*</span>')}}},{xtype:"combo",name:"paymentMethod",fieldLabel:translate("paymentMethod",true),valueField:"paymentMethod",displayField:"display",emptyText:translate("selectSimple",true),editable:false,listeners:{beforerender:function(c,a){var b=c.up("transaction_FormTransaction");if(b.configs.country=="republicaDominicana"){c.setFieldLabel("Forma de pago")}}}},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,queryMode:"remote",forceSelection:true,width:400,tooltip:translate("costCenterTransactionTooltip",true),listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",tooltip:translate("selectTheCurrencyWithWhichYouAreGoingToMakeThis",true)+" "+translate("transaction")+".",emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">Nueva moneda</a></div>',cls:"search-input-list"},editable:false,hidden:true,width:240},{xtype:"checkbox",fieldLabel:"Pago de parcialidad",name:"mx_stampTransaction",id:"mx_stampTransaction",hidden:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="left: 25px; top: 15px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="top:-20px;"><div class="tooltip-text-wrapper tooltip-small" style="width:250px;line-height:15px;"><div class="text">Si necesitas ayuda para crear el complemento de pago en parcialidades, haz <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/115005881043">clic aquí</a>.</div></div></div></div>'},{xtype:"textfield",fieldLabel:"RFC cuenta de origen",name:"mx_originAccountIdentification",maxLength:13,maxLengthText:"Este valor no puede contener más de 13 caracteres",id:"mx_originAccountIdentification",allowBlank:true,hidden:true},{xtype:"textfield",fieldLabel:"Número de cuenta origen",name:"mx_originAccountNumber",maxLength:18,maxLengthText:"Este valor no puede contener más de 18 caracteres",id:"mx_originAccountNumber",allowBlank:true,hidden:true},{xtype:"textfield",fieldLabel:"Nombre banco origen",name:"mx_originAccountName",maxLength:40,maxLengthText:"Este valor no puede contener más de 40 caracteres",id:"mx_originAccountName",allowBlank:true,hidden:true},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:translate("indicateTheRateOfExchangeFromTheSelectedCurrencyToYourPrimaryCurrency",true),hidden:true,width:270},{xtype:"hidden",name:"exchangeCurrency",hidden:true},]},{xtype:"container",flex:1,defaultType:"textfield",defaults:{labelAlign:"right",labelPad:15,labelWidth:180,width:450,msgTarget:"side"},items:[{xtype:"container",layout:"hbox",width:450,margin:"0 0 5 0",items:[{xtype:"label",name:"numberLabel",width:180,margin:"0 15 0 0",style:"text-align:right;"},{xtype:"textfield",name:"prefix",disabled:true,hidden:true,emptyText:translate("prefix",true),width:125,margin:"0 5 0 0"},{xtype:"textfield",emptyText:translate("number",true),name:"number",disabled:true,width:125,hidden:true,regex:/^([0-9]+)$/,regexText:translate("onlyNumericalValues"),msgTarget:"side"},]},{xtype:"panel",layout:"hbox",border:false,width:380,id:"nextTransactionNumberContainer",style:" margin-bottom: 8px; margin-left:35px",items:[{xtype:"box",html:'<span style="" id="labelNextTransactionNumner">Recibo de caja #</span> <span style="font-size: 11px;margin-left: 10px;color: #888;display: inline-block;">'+translate("automaticNumeration",true)+'</span> <a style="font-size:10px;color:#888" href="/company/edit-invoice-info" id="editTransactionInfo">'+translate("setUp")+"</a>"}]},{xtype:"textarea",fieldLabel:"Observaciones",name:"observations",allowBlank:true,hidden:true},{xtype:"textarea",fieldLabel:translate("paymentReceivedAnotation",true),name:"anotation",allowBlank:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="top: 11px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png" style="position: relative;top: 9px;"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text"><strong>Notas adicionales visibles al imprimir</strong><br>Notas visibles al imprimir</div></div></div></div>'}]}],getFieldValuesAsMetadata:function(){var c=null;var b=this.configs&&this.configs.country?this.configs.country:null;switch(b){case"mexico":var a=this.down("combo[name=paymentMethod]");c={paymentMethod:a.getValue(),};break}return c},});Ext.define("AL.view.common.FormAddCategory",{extend:"Ext.form.Panel",alias:"widget.common_FormAddCategory",cls:"form-add-category-component",requires:["AL.view.ux.form.GroupingComboBox"],bodyPadding:5,border:false,layout:"hbox",style:"background-color: #FFFFFF",hideMode:"visibility",defaults:{anchor:"100%",blankText:translate("thisFieldIsRequired",true),msgTarget:"side"},canCreateNewItem:false,getComboDependentFields:function(){var a=[];a.push(this.down("textfield[name=price]"));a.push(this.down("textfield[name=discount]"));a.push(this.down("combo[name=idTax]"));a.push(this.down("numberfield[name=quantity]"));a.push(this.down("textarea[name=observations]"));return a},enableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.enable()})},disableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.disable()})},listeners:{render:function(){var a=this.down("combo[name=idCategory]");a.on("change",function(f,d,e){if(f.getSelectedRecord()){f.selectedRecord=f.getSelectedRecord();f.up("form").enableFields()}else{if(f.up("form").type!=="purchaseOrder"){f.up("form").disableFields()}}});a.on("blur",function(f,e,d){if(!f.getSelectedRecord()){f.markInvalid([translate("youMustSelectAField",true,{a:translate("aCategory"),field:translate("category")}),", ",translate("notJustWriteItsField",true,{field:translate("name")})].join(""))}});if(this.multipleTaxes=="yes"){var b=this.down("combo[name=idTax]");b.multiSelect=true;var c="";if(this.canCreateNewTax=="yes"){c='<div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}b.listConfig.tpl='<tpl for="."><tpl if="values.disabled==true"><div class="x-boundlist-item checkbox-item-disabled"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div><tpl else><div class="x-boundlist-item"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl></tpl>'+c}}},defaultType:"textfield",items:[{xtype:"hidden",name:"oldIdCategory"},{xtype:"hidden",name:"oldCategoryName"},{xtype:"hidden",name:"idPurchaseOrder",},{xtype:"hidden",name:"idCategoryPurchaseOrder",},{xtype:"displayfield",name:"mxItemName",hidden:true,width:180},{xtype:"fieldcontainer",layout:"anchor",defaultType:"textfield",items:[{xtype:"groupingcombobox",name:"idCategory",cls:"category-combo-component",allowBlank:false,groupField:["parentName"],valueField:"idLocal",displayField:"text",store:"CategoriesCombo",queryMode:"remote",emptyText:translate("selectSimple",true),width:200,matchFieldWidth:false,minChars:2,allowPaginate:true,disabledField:"blocked",disabledValue:"yes",listConfig:{width:260,height:200},forceSelection:true},]},{name:"price",allowBlank:false,emptyText:translate("price",true),regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),cls:"price-input-component",width:100,disabled:true},{xtype:"textfield",name:"discount",width:40,hidden:true,regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),emptyText:"%",allowBlank:true,disabled:true},{xtype:"hidden",name:"oldTaxName"},{xtype:"hidden",name:"oldTax"},{xtype:"combobox",name:"idTax",emptyText:translate("tax",true),store:"Taxes",displayField:"name",valueField:"idLocal",width:80,cls:"tax-combo-component",typeAhead:true,queryMode:"local",matchFieldWidth:false,margin:"0 0 0 10",forceSelection:true,listConfig:{width:200,height:200,border:true,loadingText:translate("loading",true),emptyText:translate("searchNotMatch",true),tpl:'<tpl for="."><div class="x-boundlist-item">{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl>',},disabled:true,editable:false,},{xtype:"numberfield",name:"quantity",allowBlank:false,emptyText:translate("quantity",true),minValue:0,cls:"quantity-input-component",width:60,value:1,margin:"0 0 0 10",disabled:true},{xtype:"textarea",name:"observations",allowBlank:true,emptyText:translate("observations",true),cls:["observations-textarea-component"],width:240,disabled:true,margin:"0 0 0 10",},{xtype:"displayfield",allowBlank:true,name:"total",value:"0.00",width:144,overflowX:"hidden",cls:"total-displayfield-component",fieldBodyCls:"totalAligned"},{xtype:"button",action:"deleteItem",width:16,height:16,style:"",baseCls:"none",cls:"delete-button-component"}],getFieldValuesAsMetadata:function(){var b=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":var c=this.down("textfield[name=discount]");if(c.discount){b={discountNature:c.discount.discountNature}}break}return b},setFieldValuesFromMetadata:function(b){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"costaRica":if(typeof b.discountNature!=="undefined"){var c=this.down("textfield[name=discount]");if(c.discount){c.discount.discountNature=b.discountNature}}break}}});Ext.define("AL.view.bill.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.bill_FormAddCategory"});Ext.define("AL.controller.Bill",{extend:"Ext.app.Controller",views:["bill.FormAddBill","category.Tree","bill.FormAddCategory","common.GridAllBills","bill.GridAll","bill.FormAddRetention","bill.MoreActionsButton","stampDocumentReceived.GridAll","bill.FormAddPurchaseOrder","bill.FormCloseBill","bill.PhysicalDocument","ux.fields.TogglerFields","purchaseOrder.ComboPurchaseOrders","purchaseOrder.PurchaseOrderForBill",],stores:["Bills","Clients","Categories","Taxes","CategoriesCombo","Retentions","StampDocumentsReceived","CompanyCurrenciesCombo","PurchaseOrdersCombo","WarehouseCombo","EconomicActivities","SaleConditions","PaymentMethods","CostCentersCombo",],models:["Bill","Client","Category","Tax","CategoryCombo","Retention","StampDocumentReceived","CompanyCurrency","PurchaseOrder","Warehouse","CostCenter",],init:function(){var a=this;this.application.addListener("clientCreated",function(f){var e=f.initiator;var b=f.record;var c=e.getStore();if(f.country=="mexico"){var d=Ext.create("AL.model.Client",b.data)}else{var d=Ext.create("AL.model.Client",b)}c.add(d);e.select(b);a.getContact(e)},this);this.application.addListener("itemCreated",function(b){var h=b.initiator,e=b.record,f=h.getStore(),d={idLocal:e.get("idLocal"),text:e.get("reference")?e.get("name")+" - ("+e.get("reference")+")":e.get("name"),parentName:"Ítems inventariables",description:e.get("description"),type:null,recordType:"item",itemLastCost:null};var c=Ext.create("AL.model.CategoryCombo",d);f.add(c);f.getProxy().clearCacheByTerms([c.get("text")]);h.select(c.get("idLocal"));a.selectCategoryCombo(h,[c]);var g=h.up("form")},this);this.application.addListener("deleteBill",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("supplierInvoice")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("supplierInvoice")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/bill/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("addPurchaseOrder",function(){var c=Ext.ComponentQuery.query("bill_FormAddPurchaseOrder")[0];var b=Ext.create("AL.view.purchaseOrder.PurchaseOrderForBill");c.add(b)},this);this.application.addListener("retentionCreatedBill",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"));this.calculateRetentionFromRetentionCreated(e,[b])},this);this.application.addListener("warehouseCreatedBill",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"));e.fireEvent("select",e)},this);this.control({"buttons_SubmitCreate button[action=saveBill]":{click:this.saveBill},"buttons_SubmitReset button[action=saveBill]":{click:this.saveBill},"buttons_SubmitCreate button[action=saveAddPayment]":{click:this.saveBill},"buttons_SubmitCreate button[action=saveCreateBill]":{click:this.saveBill},"buttons_SubmitReset button[action=editBill]":{click:this.editBill},bill_FormAddBill:{render:this.initialize,afterrender:function(j){var f=function(){var l=this,m=null,n;if(l.submitValue&&!l.isFileUpload()){n=l.getSubmitValue();if(n!==null){m={};m[l.getName()]=n}}return m};if(j.configs.notEditableCurrency){var h=j.down("combo[name=currency]");h.getSubmitData=f;h.disable()}if(j.configs.notEditableClient){var d=j.down("combo[name=idClient]");var k=Ext.get("createOtherContact");k.destroy();d.getSubmitData=f;d.disable();d.tooltip.setVisibleIconHelp(true)}if(j&&j.configs.country=="peru"){var b=j.down("label[name=billNumberLabel]");b.setText("Número de factura")}if(j&&j.configs.country=="costaRica"){var e=j.down("textfield[name=billNumber]");var c=j.down("textfield[name=prefix]");e.getSubmitData=f;c.getSubmitData=f}if(j&&j.configs.costCenter.isActive){var g=j.down("combo[name=idCostCenter]");g.store=Ext.create("AL.store.CostCentersCombo");g.enable();g.show()}}},"bill_FormAddBill label[name=billNumberLabel]":{render:function(b){var c=b.up("form");if(c.configs.country==="republicaDominicana"){b.setText("NCF")}}},"bill_FormAddBill textfield[name=billNumber]":{render:function(d){var c=d.up("form");var b="";if(c.foilPrefix!=""){b=c.foilPrefix}if(typeof c.foilNumber!=="undefined"){b=b+c.foilNumber}d.setValue(b)}},"bill_FormAddBill combo[name=idClient]":{render:function(d){var c=d.up("form");var b=this;if(c.idClient){Ext.Ajax.request({url:"/client/retrieve-one/id/"+c.idClient+"/format/json",success:function(f,h){var j=Ext.decode(f.responseText);if(j.success){var g=j.results;var e=Ext.create("AL.model.Client",g);d.getStore().add(e);d.select(e);b.getContact(d)}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}})}},select:this.getContact},"bill_FormAddBill datefield[name=isElectronicBill]":{change:function(c,d,b){var e=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];e.setMinValue(d)}},"bill_FormAddBill combo[name=days]":{change:function(b){this.changeDueDateFromDays(b.getSelectedRecord())}},"bill_FormAddBill checkbox[name=isElectronicBillCheckbox]":{change:function(c){var b=c.up("form");if(b.configs.country==="costaRica"){this.setUpElectronicFields(b,c.getValue())}}},"bill_FormAddBill combo[name=saleCondition]":{change:function(f,e){var c=f.up("form");var g=c.down("datefield[name=dueDate]");var b=c.down("datefield[name=date]");var d=e=="CREDIT";this.hoverFieldRequired(g,d,d)}},"bill_FormAddBill datefield[name=date]":{change:function(e,b,d,c){var f=e.up("form");var g=f.down("datefield[name=dueDate]");g.setMinValue(b);if(g.isHidden()){g.setValue(b)}},},"bill_FormAddBill combo[name=idCostCenter]":{blur:function(c){var b=c.getSelectedRecord();if(!b&&c.getValue()!=null){c.markInvalid(translate("costCenterErrorCombo",true))}}},"bill_BillToolbar button[action=addBill]":{click:function(){window.location="/bill/add"}},bill_GridAll:{itemdblclick:this.goBillDetails,render:this.setRightClickEvent},bill_GridOverdue:{itemdblclick:this.goBillDetails,render:this.setRightClickEvent},"bill_FormAddCategory groupingcombobox[name=idCategory]":{beforerender:function(c){var b=c.up("form");if(b.canCreateNewItem){c.listConfig.afterTpl='<div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newM",true)+" "+translate("item")+"</a></div>"}},render:this.setCategoryComboStore,select:function(e,c){this.selectCategoryCombo(e,c);this.checkQuantity(e);var b=Ext.ComponentQuery.query("bill_FormAddBill")[0];var d=e.up("form")},blur:function(b){b.getStore().clearFilter()}},"bill_FormAddCategory button[action=deleteItem]":{beforerender:function(b){b.addCls("delete-button-with-cc")},click:function(b){b.up("form").destroy();this.updateTotal()}},"bill_FormAddCategory textfield[name=price]":{change:this.updateItemTotal},"bill_FormAddCategory numberfield[name=quantity]":{change:function(c,f,b){var d=c.up("form");var e=d.down("[name=idCategory]");this.checkQuantity(e);this.updateItemTotal(c)}},"bill_FormAddCategory textfield[name=discount]":{change:this.updateItemTotal},bill_FormAddCategory:{afterrender:function(b){var k=Ext.ComponentQuery.query("bill_FormAddBill")[0],l=this;b.down("textfield[name=discount]").show();this.setDiscountForElectronicBill(b);if(k.configs.country=="costaRica"){var h=k.down("checkbox[name=isElectronicBillCheckbox]"),o=false;if(h){o=h.getValue()}l.setTaxToCategoryForForElectronicBill(b,o)}if(b.type==="edit"||b.type=="purchaseOrder"){if(b.category){var c=b.category;var m=b.down("textfield[name=price]");var g=b.down("numberfield[name=quantity]");var f=b.down("textarea[name=observations]");var j=b.down("textfield[name=discount]");m.suspendEvents();g.suspendEvents();j.suspendEvents();m.setValue(AL.math.approx(c.priceSecondaryCurrency));g.setValue(c.quantity);f.setValue(c.observations);j.setValue(c.discount);m.resumeEvents();g.resumeEvents();j.resumeEvents();if(b.type=="purchaseOrder"){if(k.type!="edit"){g.setValue(b.category.maxQuantity)}var n=b.down("displayfield[name=mxItemName]");n.show();if(k.configs.showCategoriesCode=="yes"&&b.category.categoryCode){n.setValue(b.category.categoryCode+" - "+b.category.categoryName)}else{n.setValue(b.category.categoryName)}var d=b.down("combo[name=idCategory]");d.hide();var e=b.category.maxQuantity?b.category.maxQuantity:b.category.quantity;g.maxValue=e;g.maxText="No se puede aumentar la cantidad a un valor mayor de lo que falta por facturar"}if(c.metadata){if(k.configs.country==="costaRica"){j.discount={discount:c.discount,discountNature:Ext.decode(c.metadata).discountNature}}if(!b.configs){b.configs=k.configs}b.configs.country=k.configs.country;b.setFieldValuesFromMetadata(c.metadata)}this.updateItemTotal(m,"no")}}},beforerender:function(c){var b=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(c.type=="purchaseOrder"){var d=c.down("displayfield[name=mxItemName]");d.hidden=false}}},"bill_GridAll gridcolumn[type=billActions]":{click:function(b,d,k,h,l,m){var n=this.application;var g=Ext.get(l.target);var f=b.up("grid").getSelectionModel().getSelection()[0];if(g.hasCls("deleteBill")){l.preventDefault();if(f.get("deletable")){n.fireEvent("deleteBill",{record:f,initiator:b})}else{var c="No se puede eliminar compras que ya tienen pagos asociados";var b=b.up("grid");if(Ext.Array.contains(["costaRica"],b.country)&&b.isActiveElectronicInvoicing){c+=" "+translate("or")+" "+translate("thatAreInTheProcessOfCertification")+"."}GlobalMsg.showNotification({title:translate("remember",true),text:c,type:"notice"})}}else{if(g.hasCls("printBill")){l.preventDefault();this.printBill(g,l)}}}},"bill_FormAddBill combo[name=idWarehouse]":{change:function(j,h,f){var d=j.up("form");if(d.configs.costCenter.isActive&&j.canChangeCostCenter){var b=j.getSelectedRecord();var c=d.down("combo[name=idCostCenter]");if(b){var g=b.get("idCostCenter");if(c&&g){c.setValue(g);var e=c.getSelectedRecord();if(!e){a.setCostCenterField(c,g)}c.setReadOnly(true);c.addCls("combo-noedit-full-border")}else{if(c){c.setValue(null);c.setReadOnly(false);c.removeCls("combo-noedit-full-border")}}}}j.canChangeCostCenter=true},afterrender:function(e){var d=e.up("form");e.canChangeCostCenter=false;var c=this;var b=e.getStore();if(!b.hasLoaded()&&!b.isLoading()){b.load({callback:function(){if(d.type!="edit"&&!d.idPurchaseOrder){e.canChangeCostCenter=true;var f=b.findRecord("isMain","yes");if(f){e.select(f);if(d.configs.costCenter.isActive){var g=d.down("combo[name=idCostCenter]");var h=f.get("idCostCenter");if(g&&h){g.setValue(h);var f=g.getSelectedRecord();if(!f){c.setCostCenterField(g,h)}g.setReadOnly(true);g.addCls("combo-noedit-full-border")}}var j=Ext.ComponentQuery.query("bill_FormAddCategory");Ext.each(j,function(m){var l=m.down("groupingcombobox[name=idCategory]");var k=l.getStore().getProxy();k.clearCache();m.removeAll();m.destroy()});c.addCategoryForm()}}}})}},select:function(d){var c=this;var b=d.up("form");var e=Ext.ComponentQuery.query("bill_FormAddCategory");Ext.each(e,function(k){var j=k.down("groupingcombobox[name=idCategory]");var g=j.getStore();var h=g.getProxy();h.clearCache();if(b&&b.type=="xml"){c.clearFormItem(k)}else{k.removeAll();k.destroy()}});if(b&&b.type=="xml"){}else{c.addCategoryForm()}var f=Ext.ComponentQuery.query("container[name=purchaseOrderContainer]")[0];if(f){c.updatePurchaseOrderContainer(f)}}},"bill_FormAddCategory combo[name=idTax]":{render:function(g){var b=g.getStore();var f=g.up("form");var e=this;if(f.type&&(f.type==="edit"||f.type=="xml"||f.type=="purchaseOrder")){var d=f.category;var c=function(){g.suspendEvents();var h=Ext.ComponentQuery.query("bill_FormAddBill")[0];var k=function(n){var m=g.findRecordByValue(n.idTax);if(!m){var m=Ext.create("AL.model.Tax",{idLocal:n.idTax,tax:n.tax,name:n.taxName,status:n.taxStatus});b.add(m)}g.select(m)};var j=[];var l=true;Ext.each(d.taxes,function(m){if(m.taxStatus==="inactive"){if(h.type==="edit"&&f.type!=="purchaseOrder"){k(m);j.push(m.idTax)}else{if(h.type==="edit"&&f.type==="purchaseOrder"){var n=Ext.ComponentQuery.query("purchaseOrder_PurchaseOrderForBill")[0];if(n.type==="edit"){k(m);j.push(m.idTax)}else{g.select(0)}}else{g.select(0)}}}else{j.push(m.idTax);l=false}});if(f.type=="purchaseOrder"&&l){j.push(d.idTax)}if(j&&j.length>0){g.setValue(j)}else{g.select(0)}g.resumeEvents();g.fireEvent("taxComboRendered")};if(b.hasLoaded()){c()}else{b.on("load",function(){c()})}}if(!b.hasLoaded()&&!b.isLoading()){if(f.type&&(f.type==="edit"||f.type=="xml"||f.type=="purchaseOrder")){b.load({callback:function(){c()}})}else{b.load()}}},change:this.updateTotal,beforeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0||(d.getValue()&&d.getValue()[0]===0)){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",true)}});d.setValue("[0]")}return b.get("disabled")?false:true}},beforedeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",false)}})}}},},stampDocumentReceived_GridAll:{beforerender:function(d){var b=d.getStore();if(!b.hasLoaded()&&!b.isLoading()){var c=b.getProxy();c.url="/stamp-document-received/retrieve-all/noIdResource/true/resourceType/bill/format/json";b.load()}}},"bill_FormAddBill checkboxfield[name=informalProvider]":{change:function(c){var b=c.up("form");var d=b.down("container[name=numberContainer]");if(c.getValue()){d.hide()}else{d.show()}}},"bill_FormAddBill combo[name=currency]":{change:function(e){var c=e.up("form");var m=c.down("displayfield[name=exchangeCurrencyDisplay]");var j=c.down("hidden[name=exchangeCurrency]");var g=e.getSelectedRecord();var l=this.application;if(g&&g.get("code")&&g.get("code")!=c.configs.currency){m.show();m.setValue("1 "+g.get("code")+" = "+Ext.util.Format.round(g.get("exchangeRate"),8)+" "+c.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');j.setValue(Ext.util.Format.round(g.get("exchangeRate"),8));var f=Ext.get("editExchangeRate");if(f){f.on("click",function(o){o.preventDefault();var n={};n.currency=g.get("code");n.initiator=m;n.currencyRecord=g;l.fireEvent("editExchangeRate",n)})}}else{m.hide();j.setValue(null)}var d=Ext.ComponentQuery.query("container[name=purchaseOrderContainer]")[0];if(d){this.updatePurchaseOrderContainer(d);this.updateTotal()}var h=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(h){var k={code:g.get("code"),symbol:g.get("symbol")};h.setCurrency(k)}var b=Ext.ComponentQuery.query("advance_Panel")[0];if(b){b.destroy()}}},"purchaseOrder_PurchaseOrderForBill button[action=deletePurchaseOrder]":{click:function(b){var c=b.up("purchaseOrder_PurchaseOrderForBill");if(c){c.destroy();this.updateTotal()}}},bill_FormAddPurchaseOrder:{afterrender:function(e){var k=Ext.ComponentQuery.query("bill_FormAddBill")[0];var d=e.down("combo[name=idPurchaseOrder]");var l=d.getStore();var f=Ext.ComponentQuery.query("combo[name=currency]")[0];var m=f.getSelectedRecord();var c="";if(m&&m.get("code")){c=m.get("code")}var g=k.down("combo[name=idWarehouse]");var n=g.getStore();var o=k.down("combo[name=idClient]");if(n.isLoading()){n.on("load",function(){var q=g.getSelectedRecord();var p="";if(q&&q.get("idLocal")){p=q.get("idLocal")}else{q=n.findRecord("isMain","yes");p=q.get("idLocal")}if(!l.hasLoaded()&&!l.isLoading()){a.setPurchaseOrderProxy(null,o,c,p,l)}})}else{var b=g.getSelectedRecord();var j="";if(b&&b.get("idLocal")){j=b.get("idLocal")}else{b=n.findRecord("isMain","yes");j=b.get("idLocal")}if(!l.hasLoaded()&&!l.isLoading()){a.setPurchaseOrderProxy(null,o,c,j,l)}}var h=Ext.get("addPurchaseOrderLink");if(h){h.removeAllListeners();h.on("click",function(p){p.preventDefault();a.application.fireEvent("addPurchaseOrder",this)})}}},"bill_FormAddPurchaseOrder combo[name=idPurchaseOrder]":{change:function(e,d,c){if(c&&d!=c&&d){var b=Ext.ComponentQuery.query("bill_FormAddCategory[queryName=purchaseOrder_"+c+"]");Ext.each(b,function(f){f.destroy()})}},select:function(e){var c=e.getValue();var b=e.up("container");var f=Ext.ComponentQuery.query("bill_FormAddBill")[0];var d=this.validateDifferentPurchaseOrders(e,true);GlobalLoadMask.show(b);if(d){Ext.Ajax.request({url:"/purchase-order/retrieve-items-and-categories/format/json/id/"+c,method:"POST",success:function(m){var j=m.responseText;var k=Ext.decode(j);if(k.success){var n=k.results;var p=n.length;var l=1;var o=b.down("container[name=tableHeader]");if(!o){b.add({xtype:"container",name:"tableHeader",height:24,html:'<div id="headersTable" class="purchaseOrder"><table><tr><td class="tbName">'+translate("category",true)+"/"+translate("item",true)+'</td><td class="tbPrice">'+translate("price",true)+'</td><td class="tbDiscount">'+translate("discountAbbreviature",true)+' %</td><td class="tbTax" style="width: 89px !important;">'+translate("tax",true)+'</td><td class="tbQuantity">'+translate("quantity",true)+'</td><td class="tbDescription">'+translate("observations",true)+'</td><td class="tbTotal">Total</td></tr></table></div>',style:"background: #eee; margin-top:12px",queryName:"purchaseOrder_"+c})}var h=f.configs.canCreateNewTax;var g=f.configs.canCreateNewWarehouse;f.callUpdateTotal=p<=1;Ext.each(n,function(s){var u=Ext.create("AL.view.bill.FormAddCategory",{category:s,type:"purchaseOrder",queryName:"purchaseOrder_"+c,canCreateNewWarehouse:g,canCreateNewTax:h,});var t=u.down("hidden[name=idPurchaseOrder]");t.setValue(c);var q=u.down("hidden[name=idCategoryPurchaseOrder]");q.setValue(s.id);var r=u.down("combo[name=idTax]");b.add(u);if(l==p){r.on("taxComboRendered",function(){f.callUpdateTotal=true;a.updateTotal();GlobalLoadMask.hide(b)});f.callUpdateTotal=true;a.updateTotal();GlobalLoadMask.hide(b)}l++})}else{GlobalLoadMask.hide(b);GlobalMsg.showErrorMessage("Error",k.cause)}},failure:function(){GlobalLoadMask.hide(b)}})}else{GlobalLoadMask.hide(b)}}},"bill_FormAddBill hidden[name=exchangeCurrency]":{change:function(g){var c=Ext.ComponentQuery.query("bill_FormAddCategory");var f=this;var h=g.up("form");var e=h.down("combo[name=currency]");var d=e.getSelectedRecord();if(d.get("code")!=h.configs.currency){h.currencySign=d.get("symbol")}else{h.currencySign=null}var b=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];Ext.each(c,function(m){var n=m.down("combo[name=idCategory]");var k=m.down("textfield[name=price]");var j=n.getSelectedRecord();if(j){var l=(j.get("itemLastCost"))?j.get("itemLastCost"):null;if(l){if(b.getValue()){l=AL.math.approx(AL.math.div(l,b.getValue()),null,3)}else{l=AL.math.approx(l)}k.suspendEvents();k.setValue(l);k.resumeEvents()}f.updateItemTotal(k,"no")}});this.updateTotal()}},"#editRetentionsPanel":{render:function(b){var d=Ext.get("addOtherRetention");var c=this;d.on("click",function(){c.addRetentionForm(true)});Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({showSpinner:true,url:"/bill/retrieve-retentions/id/"+b.billIdLocal+"/onlyActive/true/format/json",success:function(e,h){var k=Ext.decode(e.responseText);if(k.success){var g=k.results;var f=Ext.ComponentQuery.query("#editRetentionsPanel")[0];var j=f.configs.canCreateNewRetention;Ext.each(g,function(s){var n={retention:s,canCreateNewRetention:j,};if(f.configs.country=="colombia"){n.width=1170;n.allowBase=true}var r=Ext.create("AL.view.bill.FormAddRetention",n);if(n.allowBase&&n.allowBase===true&&s.calculatedBy=="percentage"){var u=r.down("[name=base]");var l=0;if(s.percentage>0){l=AL.math.approx(AL.math.div(AL.math.mul(s.amountSecondaryCurrency,100),s.percentage),null,f.billDecimalPrecision)}u.setValue(l)}if(f.configs){r.configs=f.configs;r.configs.retention=s}var o=r.down("combo[name=idRetention]");if(f.configs&&["republicaDominicana","argentina"].indexOf(f.configs.country)!=-1&&s.supportDocument){var m=r.down("box[name=supportDocumentSection]");m.html='<a href="/'+s.supportDocumentType+"/view/id/"+s.supportDocument.idLocal+'" target="_blank">Soportada por transacción: '+s.supportDocument.number+"</a>"}var t=o.getStore();var q=function(){var y=r.down("textfield[name=amount]");if(s.status==="inactive"){var w=Ext.create("AL.model.Retention",{idLocal:s.idRetention,name:s.name,percentage:s.percentage,exchangeRate:s.exchangeRate,calculatedBy:s.calculatedBy});t.add(w)}o.select(s.idRetention);y.setValue(s.amountSecondaryCurrency);if(r.configs.showExchangeRate=="yes"){r.down("textfield[name=exchangeRate]").show();r.down("textfield[name=exchangeRate]").allowBlank=false;p.setValue(Ext.util.Format.round(s.exchangeRate,8));p.setFieldLabel("1 "+r.configs.billCurrency+" = ");var x=r.down("label[name=currencyLabel]");Ext.each(x,function(z){x.destroy()});var v=r.down("container[name=exchangeRateContainer]");v.add({xtype:"label",name:"currencyLabel",text:r.configs.currency,margin:"3 0 0 7"})}};if(t.hasLoaded()){q()}else{t.on("load",q);t.load()}var p=r.down("textfield[name=exchangeRate]");p.setValue(Ext.util.Format.round(r.configs.billExchangeRate,8));f.add(r)})}}})}},"#editRetentionsPanel bill_FormAddRetention combo[name=idRetention]":{select:this.calculateRetentionPanel},"form combo[name=idRetention]":{render:function(g){var b=g.getStore();var e=g.up("form");if(e.type&&e.type==="edit"){var d=e.retention;var f=e.down("textfield[name=amount]");var c=function(){if(d.status==="inactive"){var h=Ext.create("AL.model.Retention",{idLocal:d.idRetention,percentage:d.percentage,name:d.name,calculatedBy:d.calculatedBy});b.add(h);g.select(h)}else{g.select(d.idRetention)}f.setValue(d.amountSecondaryCurrency)};if(b.hasLoaded()){c()}else{b.on("load",c)}}if(!b.hasLoaded()){b.load()}},select:this.calculateRetention},"form [name=amount]":{change:function(e,f,c,d){var b=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(b&&b.configs.showRetentionsTotals&&b.configs.showRetentionsTotals===true){this.updateTotal()}}},"buttons_SubmitReset button[action=editRetentions]":{click:this.editRetentions},bill_FormCloseBill:{afterrender:function(b){var d=translate("itIsAdjustedDueToTheClosureOf",true)+" "+translate("theBill")+" "+translate("supplierInvoice");if(Ext.isEmpty(b.billNumber)){d+=" del "+Ext.Date.format(new Date(b.date+" 00:00:00"),"d/m/Y")}else{d+=" número: "+b.billNumber}b.down("textarea[name=observations]").setValue(d);var c=b.down("combo[name=idCategory]");c.store.proxy.url+="type/income"}},"bill_FormCloseBill datefield[name=date]":{render:function(f){var h=f.up("bill_FormCloseBill");var c=new Date();var j=new Date(h.date);var e=new Date(j.getFullYear(),j.getMonth(),j.getDate()+1);var g=new Date(c.getFullYear(),c.getMonth()-1,1);var d=new Date(c.getFullYear(),c.getMonth(),31);var b=c.getMonth()===d.getMonth()?d:new Date(c.getFullYear(),c.getMonth(),30);f.setMinValue(j>g?e:g);f.setMaxValue(b);f.setValue((j>c)?e:c)}},"bill_FormCloseBill combo[name=idCategory]":{hide:function(b){b.allowBlank=true;b.up("form[name=formCloseBill]").getForm().isValid()},show:function(b){b.allowBlank=false},},"bill_FormCloseBill button[action=save]":{click:function(g){var c=g.up("bill_FormCloseBill");var j=c.down("combo[name=idCategory]");var d=c.down("textarea[name=observations]").getValue();var k=c.down("datefield[name=date]");var e=j.getValue();if(e){GlobalRedirector.go({zoneTitle:translate("closingAction",true)+" "+translate("supplierInvoice")});var h=c.billId;var f={idResource:h,resourceType:"bill",idCategory:e,date:new Date(k.getValue()),observations:d};var b="/bill/close/id/"+h+"/format/json";Ext.Ajax.request({url:b,method:"POST",params:f,success:function(l){var n=Ext.decode(l.responseText);if(n.success){window.location.reload()}else{var m=n.cause?n.cause:"Ha ocurrido un error al cerrar "+translate("theBill")+" "+translate("supplierInvoice");GlobalRedirector.close();GlobalMsg.showErrorMessage("Ha ocurrido un error cerrando "+translate("theBill")+" "+translate("supplierInvoice"),m)}}})}else{c.down("form[name=formCloseBill]").getForm().isValid();if(c.emergent){Ext.MessageBox.alert("Error","Hay un error en el formulario")}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}}}},"bill_FormCloseBill button[action=close]":{click:function(b){b.up("window").close()}},"menuitem[action=closeBill]":{click:function(c,d){var b=c.up("button");Ext.create("AL.view.bill.FormCloseBill",{billNumber:b.billNumber,billId:b.idType,date:b.date})}},bill_MoreActionsButton:{beforerender:function(){var b=this;if(Ext.get("printBill")){Ext.get("printBill").on("click",function(d,c){d.preventDefault();if(c.getAttribute("data-canPrintOrDownload")){b.printBill(c,d)}})}if(Ext.get("downloadBill")){Ext.get("downloadBill").on("click",function(d,c){d.preventDefault();if(c.getAttribute("data-canPrintOrDownload")){b.downloadBill(c,d)}})}if(Ext.get("stampBill")){Ext.get("stampBill").on("click",function(d,c){b.stampBill(c,d)})}}},})},addRetentionForm:function(h){h=h===true||false;if(h){var e=Ext.ComponentQuery.query("#editRetentionsPanel")[0];var d={canCreateNewRetention:e.configs.canCreateNewRetention,};if(e.configs.country=="colombia"){d.width=1170;d.allowBase=true}var b=Ext.create("AL.view.bill.FormAddRetention",d);var g=b.down("textfield[name=exchangeRate]");var f=b.down("combo[name=idRetention]");var l=Ext.create("AL.store.Retentions",{autoLoad:false,data:[]});if(e.configs){b.configs=e.configs}if(b.configs&&b.configs.showExchangeRate=="yes"){b.down("textfield[name=exchangeRate]").show();g.setValue(Ext.util.Format.round(b.configs.billExchangeRate,8));g.setFieldLabel("1 "+b.configs.billCurrency+" = ");var k=b.down("label[name=currencyLabel]");Ext.each(k,function(o){o.destroy()});var a=b.down("container[name=exchangeRateContainer]");a.add({xtype:"label",name:"currencyLabel",text:b.configs.currency,margin:"3 0 0 7"})}if(b.configs&&!b.configs.billCurrency){g.hide()}f.store=l;l.load();e.add(b)}else{var j=Ext.ComponentQuery.query("bill_FormAddBill")[0];var m=j.decimalPrecision?j.decimalPrecision:j.configs.companyDecimalPrecision;var d={renderTo:"retentionsAdd",canCreateNewRetention:j.configs.canCreateNewRetention,};if(j.configs.country=="colombia"){d.width=1170;d.allowBase=true}var b=Ext.create("AL.view.bill.FormAddRetention",d);if(d.allowBase&&d.allowBase===true){var c=this.updateTotal();var n=b.down("[name=base]");n.setValue(AL.math.approx(c.subTotal,null,m))}}},saveBill:function(f){var e=Ext.ComponentQuery.query("bill_FormAddCategory"),c=Ext.ComponentQuery.query("bill_FormAddRetention"),k=Ext.ComponentQuery.query("bill_FormAddBill")[0],m=this;if(this.validateForms()){GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("bill")});var a=f.up("form");var n=a.query("button");Ext.each(n,function(s){s.disable()});var r=[];Ext.each(c,function(s){r.push(s.getValues())});var j=[];var q=[];Ext.each(e,function(w){var t=w.down("groupingcombo");var s=t.selectedRecord;var u=w.getForm().getValues();if(!u.idTax||u.idTax==0){delete u.idTax}if(s){if(!w.configs){w.configs=k.configs}w.configs.country=k.configs.country;var v=w.getFieldValuesAsMetadata();if(v){u.metadata=Ext.encode(v)}if(s.get("recordType")==="item"){u.idLocal=u.idCategory;delete u.idCategory;q.push(u)}else{if(s.get("recordType")==="category"){j.push(u)}}}});var p=k.getValues();p.categories=Ext.encode(j);p.retentions=Ext.encode(r);p.items=Ext.encode(q);var l=Ext.get("new-comment");if(l&&l.getValue()){var g=l.getValue();p.comment=Ext.encode(g)}if(k.type=="xml"){p.idXml=k.idXml;if(k.configs.idPdf){p.idPdf=k.configs.idPdf}}var b=k.down("hidden[name=exchangeCurrency]");if(b&&b.getValue()){p.exchangeRate=b.getValue()}var h=Ext.ComponentQuery.query("advance_FormPanel");if(h){var d=[];Ext.each(h,function(t){var s=t.getValues();if(s.number&&s.amountToApply){d.push({id:s.number,amount:s.amountToApply,date:s.date})}});p.advances=Ext.encode(d)}var o=k.getFieldValuesAsMetadata();if(o){p.metadata=Ext.encode(o)}Ext.Ajax.request({url:"/bill/add/format/json",method:"POST",params:p,success:function(s,t){var v=Ext.decode(s.responseText);if(v.success){var w=v.results;if(f.createAnother){window.location="/bill/add"}else{window.location="/bill/view/id/"+w}if(f.afterSave){switch(f.afterSave){case"addPayment":window.location="/transaction/out/idBill/"+w;break}}}else{var u=k.down("checkbox[name=isElectronicBillCheckbox]");if(u&&u.getValue()){if(v.id){window.location="/bill/view/id/"+v.id}else{Ext.each(n,function(x){x.enable();GlobalRedirector.close()})}}else{Ext.each(n,function(x){x.enable();GlobalRedirector.close()})}}},failure:function(){Ext.each(n,function(s){s.enable()});GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                               Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},editBill:function(e){var d=Ext.ComponentQuery.query("bill_FormAddCategory"),b=Ext.ComponentQuery.query("bill_FormAddRetention"),f=Ext.ComponentQuery.query("bill_FormAddBill")[0],h=this;if(this.validateForms()){e.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("bill")});var m=[];Ext.each(b,function(p){var n=p.getValues();var q=p.down("combo[name=idRetention]");if(q.getValue()==="old"){var o=q.currentRetention;if(o.get("currentId")){n.idRetention=o.get("currentId");n.retentionName=o.get("name");n.percentage=o.get("percentage")}else{delete n.idRetention}}m.push(n)});var g=[];var l=[];Ext.each(d,function(t){var o=t.down("groupingcombo[name=idCategory]");var p=t.getForm().getValues();if(p.idCategory==="old"){p.idCategory=p.oldIdCategory;p.categoryName=p.oldCategoryName;delete p.oldCategoryName}else{delete p.oldCategoryName}if(p.idTax==="old"){var q=t.down("combo[name=idTax]");var r=q.actualTax;if(r.get("currentId")){p.idTax=r.get("currentId");p.taxName=r.get("name");p.tax=r.get("tax")}else{delete p.idTax}p.taxName=r.get("name");p.tax=r.get("tax")}else{if(!p.idTax||p.idTax==0){delete p.idTax}}var n=o.selectedRecord;if(!t.configs){t.configs=f.configs}t.configs.country=f.configs.country;var s=t.getFieldValuesAsMetadata();if(s){p.metadata=Ext.encode(s)}if(n){if(n.get("recordType")==="item"){p.idLocal=p.idCategory;delete p.idCategory;l.push(p)}else{if(n.get("recordType")==="category"){g.push(p)}}}});var c=Ext.ComponentQuery.query("bill_FormAddBill")[0];var k=c.getValues();if(k.idClient==="old"){k.idClient=k.oldIdClient}else{delete k.oldClientName;delete k.oldIdClient}var a=c.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){k.exchangeRate=a.getValue()}k.categories=Ext.encode(g);k.items=Ext.encode(l);k.retentions=Ext.encode(m);var j=c.getFieldValuesAsMetadata();if(j){k.metadata=Ext.encode(j)}Ext.Ajax.request({url:"/bill/edit/format/json",method:"POST",params:k,timeout:60000,success:function(n,o){var p=Ext.decode(n.responseText);if(p.success){var q=p.results;window.location="/bill/view/id/"+q}else{e.enable();GlobalRedirector.close()}},failure:function(){e.enable();GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(d){var h=this;var g=d.down("textfield[name=billNumber]");var e=d.down("textfield[name=prefix]");var j=Ext.get("addOtherAccount");j.on("click",this.addCategoryForm);var n=Ext.get("addOtherRetention");if(n){n.on("click",function(){h.addRetentionForm()})}if(!d.configs.showWarehouses){d.down("combo[name=idWarehouse]").hide()}if(d.configs.country=="republicaDominicana"){var l=d.down("container[name=rightContainer]");var a=l.down("checkboxfield[name=isSubjectToProportionality606]");a.show();if(!d.type){l.insert(1,{xtype:"checkboxfield",boxLabel:"Asignar NCF comprobante de compra",inputValue:"yes",name:"informalProvider",afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="left: 79%; margin-left: 12px; z-index: 100;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -35px;top: 5px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 273px;padding:3px;line-height: 14px;"><div class="text">Activa esta opción para registrar compras informales y diligencia la plantilla de comprobante fiscal. <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/115004214963">Ver más</a>.</div></div></div></div>',boxLabelAlign:"before",labelPad:20,boxLabelCls:"informalProviderCheckbox"})}}var k=d.down("combo[name=currency]");var m=k.getStore();m.load({callback:function(){var o=Ext.create("AL.model.CompanyCurrency",{code:d.configs.currency,name:d.configs.nameCurrency,exchangeRate:1});m.add(o);k.select(o)}});if(d.configs.multicurrency=="yes"){k.show()}var c=Ext.get("purchaseOrderLink");if(c){c.on("click",function(o){o.preventDefault();h.showPurchaseOrderForm()})}if(d.type||d.idPurchaseOrder){if(d.type==="edit"||d.idPurchaseOrder){GlobalLoadMask.show("generalContainer");GlobalLoadMask.show("mask-items-loading")}if(d.type==="edit"){var b=d.idLocal;Ext.Ajax.request({url:"/bill/retrieve-info/id/"+b+"/format/json",success:function(s,S){var w=Ext.decode(s.responseText);if(w.success){var C=w.results;var M=C.bill;d.bill=M;var F=C.categories;var v=C.retentions;if(M.metadata){d.setFieldValuesFromMetadata(M.metadata)}if(d.configs&&d.configs.country=="republicaDominicana"){if(M.idResolution){d.down("textfield[name=prefix]").show()}var R=Ext.get("retentionsContainer");if(R){R.applyStyles({display:"none"})}var X=Ext.get("viewRetentionsApplied");if(X){X.applyStyles({display:"block"})}}var aa=d.down("hidden[name=idLocal]");var B=d.down("combo[name=idClient]");var H=d.down("datefield[name=date]");var Y=d.down("datefield[name=dueDate]");var K=d.down("textarea[name=observations]");var x=d.down("combo[name=idWarehouse]");if(d.configs&&d.configs.country=="costaRica"){e.show();if(M.metadata&&M.metadata.isElectronicBill){g.disable();e.disable()}var L=d.down("container[name=isElectronicBillContainer]");L.hide();if(M.idResolution){e.show()}}if(M.warehouse&&M.warehouse.idLocal){var G=x.getStore();if(!G.hasLoaded()&&!G.isLoading()){G.on("load",function(){var ab=Ext.create("AL.model.Warehouse",M.warehouse);G.add(ab);x.select(ab)})}else{var N=Ext.create("AL.model.Warehouse",M.warehouse);G.add(N);x.select(N)}}d.decimalPrecision=C.bill.decimalPrecision;aa.setValue(M.idLocal);var p=B.getStore();var V=Ext.create("AL.model.Client",{idLocal:M.idClient,name:M.name});p.add(V);B.suspendEvents();B.select(V);B.resumeEvents();h.getContact(B);var Z=AL.date(M.date);Z=Ext.Date.format(Z,"d/m/Y");var P=AL.date(M.dueDate);P=Ext.Date.format(P,"d/m/Y");g.setValue(M.billNumber);H.setRawValue(Z);Y.setMinValue(H.getValue());Y.setRawValue(P);K.setValue(M.observations);if(d.configs.multicurrency=="yes"){var u=d.down("combo[name=currency]");var E=d.down("hidden[name=exchangeCurrency]");var o=u.getStore();u.show();var t=function(){var ab=o.findRecord("code",d.configs.currency);if(!ab){ab=Ext.create("AL.model.CompanyCurrency",{code:d.configs.currency,exchangeRate:1});o.add(ab)}var ac=null;if(M.currencyCode){ac=o.findRecord("code",M.currencyCode);if(ac){ac.set("exchangeRate",M.exchangeRate)}else{ac=Ext.create("AL.model.CompanyCurrency",{exchangeRate:M.exchangeRate,code:M.currencyCode,symbol:M.currencySymbol});if(ac&&ac.code){o.add(ac)}}}if(!ac){ac=ab}u.select(ac);E.setValue(M.exchangeRate)};if(o.hasLoaded()){t()}else{o.load({callback:function(){t()}})}}d.down("textfield[name=prefix]").setValue(M.prefix);GlobalLoadMask.hide("generalContainer");var T=1;var z=[];var D=[];var r=d.configs.costCenter.isActive;if(!M.categoriesPurchaseOrder){Ext.each(F,function(ab){if(!ab.idPurchaseOrder){D.push(ab)}else{z.push(ab)}});M.categoriesPurchaseOrder=z}else{z=M.categoriesPurchaseOrder;GlobalLoadMask.hide("mask-items-loading")}if(r){var W=d.down("combo[name=idCostCenter]");if(W&&M.idCostCenter){h.setCostCenterField(W,M.idCostCenter)}}var I=Ext.ComponentQuery.query("#addCategoryPanel")[0];var J=D.length;var A=d.configs.multipleTaxes!="yes"?"no":"yes";var Q=d.configs.canCreateNewTax;var q=d.configs.canCreateNewWarehouse;var U=d.configs.canCreateNewItem;d.callUpdateTotal=J<=1;Ext.each(D,function(ad){var ac=Ext.create("AL.view.bill.FormAddCategory",{type:"edit",category:ad,canCreateNewItem:U,multipleTaxes:A,canCreateNewTax:Q,canCreateNewWarehouse:q,});ac.down("groupingcombobox[name=idCategory]").store=Ext.create("AL.store.CategoriesCombo");I.add(ac);var ab=ac.down("combo[name=idTax]");if(T==J){ab.on("taxComboRendered",function(){d.callUpdateTotal=true;h.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}T++});if(z.length>0){h.showPurchaseOrderForm();h.populatePurchaseOrderForm()}if(d.configs&&d.configs.country==="republicaDominicana"){var O=d.down("checkbox[name=isSubjectToProportionality606]");O.setValue(M.isSubjectToProportionality606);if(v&&v.length>0){var X=Ext.get("viewRetentionsApplied");if(X){X.applyStyles({display:"block"})}}}else{var y=d.configs.canCreateNewRetention;Ext.each(v,function(ad){var af={retention:ad,type:"edit",renderTo:"retentionsAdd",canCreateNewRetention:y,};if(d.configs.country==="colombia"){af.allowBase=true;af.width=1170}var ab=Ext.create("AL.view.bill.FormAddRetention",af);if(af.allowBase&&af.allowBase===true&&ad.calculatedBy=="percentage"){var ac=ab.down("[name=base]");var ae=AL.math.approx(AL.math.div(AL.math.mul(ad.amountSecondaryCurrency,100),ad.percentage),null,d.decimalPrecision);ac.setValue(ae)}})}}else{}},failure:function(){}},this)}else{if(d.type=="xml"){var f=d.idXml;GlobalLoadMask.show("generalContainer");GlobalLoadMask.show("mask-items-loading");Ext.Ajax.request({url:"/bill/retrieve-info-from-xml/format/json",method:"POST",params:{idXml:f},success:function(o){var x=Ext.decode(o.responseText);if(x.success){var z=x.results;var s=z.client;var E=d.down("combo[name=idClient]");if(s.idLocal){var u=E.getStore();var s=Ext.create("AL.model.Client",{idLocal:s.idLocal,name:s.name});u.add(s);E.select(s)}else{d.client={name:s.name,identification:s.identification,identificationType:s.identificationType,addressObject:s.addressObject,email:s.email}}if(z.errors.length>0){var G=Ext.create("Ext.panel.Panel",{renderTo:"errorsXmlBill",id:"xmlErrors",cls:"xml-errors",frame:false,border:false,bodyPadding:10,bodyStyle:"background: transparent;",margin:"10 0 10 0",width:500});Ext.each(z.errors,function(J){G.add({xtype:"displayfield",value:J.text})});var A=Ext.get("createOtherContactXml");if(A){var H={link:A,combo:E};h.application.fireEvent("setNewClientEvent",H)}}var t=d.down("datefield[name=date]");t.setValue(z.billInfo.date);if(d.configs&&d.configs.country=="colombia"){d.down("textfield[name=billNumber]").setValue(z.billInfo.billNumber)}if(z.billInfo.currency&&z.billInfo.exchangeRate){var B=d.down("combo[name=currency]");var q=B.getStore();var D=q.findRecord("code",z.billInfo.currency);if(D){D.set("exchangeRate",Ext.util.Format.round(z.billInfo.exchangeRate,8));B.select(D)}}var p=z.items.length;var w=1;GlobalLoadMask.hide("generalContainer");var y=Ext.ComponentQuery.query("#addCategoryPanel")[0];var v=d.configs.canCreateNewTax;var F=d.configs.canCreateNewWarehouse;var C=d.configs.canCreateNewItem;var I=d.configs.multipleTaxes!="yes"?"no":"yes";if(p>0){firstItem=y.query("bill_FormAddCategory")[0];firstItem.destroy()}d.callUpdateTotal=p<=1;Ext.each(z.items,function(N){var J=Ext.create("AL.view.bill.FormAddCategory",{canCreateNewTax:v,canCreateNewWarehouse:F,canCreateNewItem:C,multipleTaxes:I,fromXml:true,multipleTaxes:I,});var Q=J.down("displayfield[name=mxItemName]");var P=J.down("combo[name=idCategory]");var L=J.down("textarea[name=observations]");var M=J.down("button[action=deleteItem]");P.width=170;L.width=110;M.hidden=true;Q.hidden=false;Q.setValue(N.name);J.enableFields();J.down("textfield[name=quantity]").setValue(N.quantity);J.down("textfield[name=price]").setValue(AL.math.approx(N.price,2));if(d.configs&&d.configs.country=="colombia"&&N.discountPercent){J.down("textfield[name=discount]").setValue(AL.math.approx(N.discountPercent,2))}var O=[];if(N.taxes){Ext.each(N.taxes,function(R){O.push(R.idLocal)})}var K=J.down("combo[name=idTax]").getStore();if(K.hasLoaded()){J.down("combo[name=idTax]").setValue(O)}else{K.on("load",function(){J.down("combo[name=idTax]").setValue(O)})}if(!K.hasLoaded()&&!K.isLoading()){K.load()}J.down("groupingcombobox[name=idCategory]").store=Ext.create("AL.store.CategoriesCombo");y.add(J);if(w==p){d.callUpdateTotal=true;h.updateTotal();GlobalLoadMask.hide("mask-items-loading")}w++});var r=d.configs.canCreateNewRetention;Ext.each(z.retentions,function(J){Ext.create("AL.view.bill.FormAddRetention",{retention:J,type:"edit",renderTo:"retentionsAdd",canCreateNewRetention:r,})})}else{GlobalMsg.showErrorMessage("Error",x.cause)}},failure:function(){GlobalMsg.showErrorMessage("Error","Ha ocurrido un erro por favor inténtalo de nuevo más tarde")}})}else{if(d.idPurchaseOrder){Ext.Ajax.request({url:"/purchase-order/retrieve-info/id/"+d.idPurchaseOrder+"/format/json/includeMaxQuantity/yes",success:function(r,x){var y=Ext.decode(r.responseText);if(y.success){var s=y.results;var E=s.purchaseOrder;var u=s.categories;if(E.idResolution&&d.configs.country=="republicaDominicana"){d.down("textfield[name=prefix]").show()}var w=d.down("hidden[name=idLocal]");var v=d.down("combo[name=idClient]");var o=d.down("combo[name=idWarehouse]");if(E.warehouse&&E.warehouse.idLocal){var D=o.getStore();if(!D.hasLoaded()&&!D.isLoading()){D.on("load",function(){var F=Ext.create("AL.model.Warehouse",E.warehouse);D.add(F);o.select(F)})}else{var t=Ext.create("AL.model.Warehouse",E.warehouse);D.add(t);o.select(t)}}d.decimalPrecision=E.decimalPrecision;w.setValue(E.idLocal);var C=v.getStore();var q=Ext.create("AL.model.Client",{idLocal:E.idClient,name:E.name,identification:E.identification});C.add(q);v.suspendEvents();v.select(q);v.resumeEvents();if(d.configs.multicurrency=="yes"){var z=d.down("combo[name=currency]");var p=d.down("hidden[name=exchangeCurrency]");var B=z.getStore();z.show();var A=function(){var F=B.findRecord("code",d.configs.currency);if(!F){F=Ext.create("AL.model.CompanyCurrency",{code:d.configs.currency,exchangeRate:1});B.add(F)}var G=null;if(E.currencyCode){G=B.findRecord("code",E.currencyCode);if(G){G.set("exchangeRate",E.exchangeRate)}else{G=Ext.create("AL.model.CompanyCurrency",{exchangeRate:E.exchangeRate,code:E.currencyCode,symbol:E.currencySymbol});if(G&&G.code){B.add(G)}}}if(!G){G=F}z.select(G);p.setValue(E.exchangeRate)};if(B.hasLoaded()){A()}else{B.load({callback:function(){A()}})}}GlobalLoadMask.hide("generalContainer");E.categoriesPurchaseOrder=u;d.bill=E;h.showPurchaseOrderForm();h.populatePurchaseOrderForm()}else{}},failure:function(){}})}}}}},addCategoryForm:function(){var f=Ext.ComponentQuery.query("bill_FormAddBill")[0];var e=Ext.ComponentQuery.query("#addCategoryPanel")[0];var d=Ext.create("AL.view.bill.FormAddCategory",{canCreateNewTax:f.configs.canCreateNewTax,canCreateNewWarehouse:f.configs.canCreateNewWarehouse,multipleTaxes:f.configs.multipleTaxes,});d.down("groupingcombobox[name=idCategory]").store=Ext.create("AL.store.CategoriesCombo");var a=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(a.type=="xml"){d.down("displayfield[name=mxItemName]").hidden=false;d.down("combo[name=idCategory]").width=170;d.down("textarea[name=observations]").width=110}if(a.configs.multipleTaxes=="yes"){var b=d.down("combo[name=idTax]");b.multiSelect=true;var c="";if(f.configs.canCreateNewTax=="yes"){c='<div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}b.listConfig.tpl='<tpl for="."><tpl if="values.disabled==true"><div class="x-boundlist-item checkbox-item-disabled"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div><tpl else><div class="x-boundlist-item"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl></tpl>'+c}e.add(d)},setCategoryComboStore:function(d,h){var c=d.up("form");var l=this;var m=d.getStore();var j=m.getProxy();var e=Ext.ComponentQuery.query("bill_FormAddBill combo[name=idWarehouse]")[0];var a=function(){Ext.Ajax.request({url:"/item/retrieve-category-item/id/"+c.idItem+"/format/json",success:function(n,p){var q=Ext.decode(n.responseText);if(q.success){var o=q.results;var r=Ext.create("AL.model.CategoryCombo",o);m.add(r);comboCategory=Ext.ComponentQuery.query("bill_FormAddCategory groupingcombobox[name=idCategory]")[0];comboCategory.selectedRecord=r;comboCategory.select(r);l.selectCategoryCombo(comboCategory,[r]);l.checkQuantity(comboCategory);Ext.ComponentQuery.query("bill_FormAddCategory")[0].enableFields()}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})};j.setExtraParam("includeItems","true");j.setExtraParam("type","expense");j.setExtraParam("includeAsset","true");if(e){j.setExtraParam("idWarehouse",e.getValue())}if(c.idItem){if(!m.hasLoaded()){m.load()}else{a()}m.on("load",a)}if(c.type==="edit"||c.type=="purchaseOrder"){var b=c.category,f=(b.reference)?b.categoryName+" - "+b.reference:b.categoryName,g=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(g.configs.showCategoriesCode=="yes"&&b.categoryCode){f=b.categoryCode+" - "+f}var k=Ext.create("AL.model.CategoryCombo",{idLocal:b.idCategory,text:f,recordType:b.recordType,isInventariable:b.isInventariable,availableQuantity:b.availableQuantity,maxQuantity:b.maxQuantity,maxQuantityReal:b.maxQuantityReal,quantity:b.quantity,});m.add(k);d.selectedRecord=k;d.select(k)}},goBillDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/bill/view/id/"+h},setRightClickEvent:function(c){var b=this.application;var a=c.getView();a.on("itemcontextmenu",function(e,d,k,h,j,g){j.preventDefault();var f=[{text:"Ver Detalle",iconCls:"viewDetailIcon",actionUrl:"/bill/view/id/"+d.get("idLocal")},{text:"Agregar Pago",iconCls:"addPaymentIcon",actionUrl:"/transaction/out/idBill/"+d.get("idLocal")},{text:"Editar",iconCls:"editIcon",actionUrl:"/bill/edit/id/"+d.get("idLocal")}];if(d.get("deletable")){f.push({text:"Eliminar",iconCls:"deleteIcon",action:"deleteBill",actionUrl:"/bill/delete/id/"+d.get("idLocal")+"/format/json"})}Ext.create("Ext.menu.Menu",{width:134,margin:"0 0 10 0",record:d,listeners:{click:function(o,m,n,l){if(m.action&&m.action==="deleteBill"){b.fireEvent("deleteBill",{record:d,initiator:c})}else{window.location=m.actionUrl}}},items:f}).showAt(j.getXY())})},calculateRetention:function(d,e,g,h){var f=e[0];var a=d.up("form");var j=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(!j){return}if(f.get("calculatedBy")!="percentage"){return}var l=0;if(f.get("idRetentionReference")==1||f.get("idRetentionReference")==8||f.get("idRetentionReference")==25){l=this.getTotalIva()}else{if(f.get("idRetentionReference")==6){l=this.getSubtotalItemsWithIva()}else{var c=this.updateTotal();l=j.configs.country==="peru"?c.total:c.subTotal}}if(j.configs.country==="colombia"){var m=a.down("[name=base]");m.setValue(AL.math.approx(l,null,j.decimalPrecision))}var b=a.down("textfield[name=amount]");var k=AL.math.div(AL.math.approx(AL.math.mul(l,f.get("percentage")),null,j.decimalPrecision),100);b.setValue(AL.math.approx(k,null,j.decimalPrecision))},updateTotal:function(){var p=Ext.ComponentQuery.query("bill_FormAddBill")[0];var q=p&&!p.type?true:p.callUpdateTotal==true;if(!q){return}var d=p&&p.configs.showRetentionsTotals&&p.configs.showRetentionsTotals===true;var h={};var j=Ext.ComponentQuery.query("bill_FormAddCategory");var k=Ext.ComponentQuery.query("bill_FormAddRetention");var l=0;var s=0;var a=0;var e=0;var r=0;var o=1;var c=0;var m=false;var f="";if(p&&p.configs.multicurrency=="yes"){var n=p.down("combo[name=currency]");if(n.getValue()&&p.configs.currency!=n.getValue()){f=n.getValue();m=true;o=p.down("hidden[name=exchangeCurrency]").getValue()}}if(q){Ext.each(j,function(t){var u=t.down("textfield[name=discount]").isValid();if(u==false){q=false}})}if(q){Ext.each(j,function(t){var D=t.down("combo[name=idTax]");var F=t.down("textfield[name=price]");var z=t.down("numberfield[name=quantity]");var H=t.down("textfield[name=discount]");var v;var w;var u;var y=z.getValue()?z.getValue():0;var G=AL.math.approx(F.getValue(),null,p.decimalPrecision);var x=AL.math.approx(AL.math.mul(G,o),null,p.decimalPrecision);var C=null;var E=typeof(D.getValue())=="string"?[D.getValue()]:D.getValue();if(p.type&&p.type==="edit"){if(D.getValue()==="old"){C=D.actualTax}}if(H.getValue()){a=AL.math.add(a,AL.math.approx(AL.math.mul(y,AL.math.approx(AL.math.mul(G,AL.math.div(H.getValue(),100)),null,p.decimalPrecision)),null,p.decimalPrecision));v=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(G,AL.math.sub(1,AL.math.div(H.getValue(),100))),null,p.decimalPrecision),y),null,p.decimalPrecision);w=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(x,AL.math.sub(1,AL.math.div(H.getValue(),100))),null,p.decimalPrecision),z.getValue()),null,p.decimalPrecision);u=AL.math.approx(AL.math.mul(G,y),null,p.decimalPrecision)}else{v=AL.math.approx(AL.math.mul(G,y),null,p.decimalPrecision);w=AL.math.approx(AL.math.mul(x,y),null,p.decimalPrecision);u=v}e=AL.math.add(e,u);l=AL.math.add(l,v);if(D.getValue()){var B=0;var A=0;Ext.each(E,function(J){C=D.findRecordByValue(J);if(C){B=AL.math.add(B,AL.math.approx(AL.math.mul(v,AL.math.div(C.get("tax"),100)),null,p.decimalPrecision));A=AL.math.add(A,AL.math.approx(AL.math.mul(w,AL.math.div(C.get("tax"),100)),null,p.decimalPrecision));var I=C.get("name")+C.get("tax");if(h[I]){h[I].value=AL.math.add(h[I].value,AL.math.approx(AL.math.mul(v,AL.math.div(C.get("tax"),100)),null,p.decimalPrecision))}else{h[I]={label:C.get("name")+" ("+Ext.util.Format.round(C.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(v,AL.math.div(C.get("tax"),100)),null,p.decimalPrecision)}}}else{s=AL.math.add(s,v);r=AL.math.add(r,w)}});s=AL.math.add(s,AL.math.add(v,B));r=AL.math.add(r,AL.math.add(w,A))}else{s=AL.math.add(s,v);r=AL.math.add(r,w)}});if(d){Ext.each(k,function(t){var u=t.down("[name=amount]");if(u){c=AL.math.add(c,u.getValue())}})}var b=p&&p.currencySign?p.currencySign:null;var g=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];g.removeAll();g.addItem({label:"Subtotal",value:AL.math.approx(e,null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b});g.addItem({label:translate("discount",true),value:AL.math.approx(AL.math.mul(a,-1),null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b});g.addItem({label:"Subtotal",value:AL.math.approx(l,null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b});Ext.Object.each(h,function(t,u){u.value=AL.math.approx(u.value,null,p.decimalPrecision);u.decimalPrecision=p.decimalPrecision;u.currencySign=b;g.addItem(u)});g.addItem({label:"Total "+f,value:AL.math.approx(s,null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b});if(d&&AL.math.comp(c,0)>0){g.addItem({label:"- "+translate("retentions",true),value:AL.math.approx(c,null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b});g.addItem({label:"Total a pagar",value:AL.math.approx(AL.math.sub(s,c),null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision,currencySign:b})}if(m){g.addItem({label:"Total "+p.configs.currency,value:AL.math.approx(r,null,p.decimalPrecision),important:true,decimalPrecision:p.decimalPrecision})}}else{var l=0,h=0,s=0}return{subTotal:l,taxes:h,total:s}},getTotalIva:function(){var c=Ext.ComponentQuery.query("bill_FormAddCategory");var b=0;var a=Ext.ComponentQuery.query("bill_FormAddBill")[0];Ext.each(c,function(d){var f=d.down("combo[name=idTax]");var e=d.down("textfield[name=price]");var k=d.down("numberfield[name=quantity]");var j=d.down("textfield[name=discount]");if(e.getValue()&&k.getValue()){var h=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(e.getValue(),null,a.decimalPrecision),AL.math.sub(1,AL.math.div(j.getValue(),100))),null,a.decimalPrecision),k.getValue()),null,a.decimalPrecision);var g=typeof(f.getValue())=="string"?[f.getValue()]:f.getValue();Ext.each(g,function(m){var l=f.findRecordByValue(m);if(l){if(l.get("idTaxReference")==1||l.get("idTaxReference")==4||l.get("idTaxReference")==8){b=AL.math.add(b,AL.math.approx(AL.math.mul(h,AL.math.div(l.get("tax"),100)),null,a.decimalPrecision))}}})}});return b},getSubtotalItemsWithIva:function(){var c=Ext.ComponentQuery.query("bill_FormAddCategory");var a=Ext.ComponentQuery.query("bill_FormAddBill")[0];var b=0;Ext.each(c,function(d){var e=d.down("textfield[name=price]");var l=d.down("numberfield[name=quantity]");var j=d.down("textfield[name=discount]");var k=j.getValue();if(e.getValue()&&l.getValue()){if(k>0){k=AL.math.approx(AL.math.div(k,100));var h=AL.math.approx(AL.math.mul(AL.math.approx(e.getValue(),null,a.decimalPrecision),l.getValue()));discountTotal=AL.math.approx(AL.math.mul(h,k));h=AL.math.approx(AL.math.sub(h,discountTotal))}else{var h=AL.math.approx(AL.math.mul(AL.math.approx(e.getValue(),null,a.decimalPrecision),l.getValue()))}var f=d.down("combo[name=idTax]");var g=typeof(f.getValue())=="string"?[f.getValue()]:f.getValue();Ext.each(g,function(n){var m=f.findRecordByValue(n);if(m){if(m.get("idTaxReference")==3&&m.get("tax")>0){b=AL.math.add(b,h);return}}})}});return b},checkQuantity:function(d){var n=Ext.ComponentQuery.query("bill_FormAddBill")[0];var o="El "+translate("item")+" ",c=" ha alcanzado la cantidad máxima configurada";var k=d.getSelectedRecord(),p=function(q){GlobalMsg.showNotification({type:"warning",title:"Advertencia",text:q})},b=d.up("form"),h=b.down("numberfield[name=quantity]"),l=b.down("combo[name=idLocal]"),g=h.getValue(),a=n&&n.type=="edit";if(k&&k.get("isInventariable")=="yes"){if(k&&k.get("availableQuantity")&&k.get("maxQuantity")){var j=AL.math.sub(k.get("availableQuantity"),k.get("quantityRemissioned"));var f=k.get("maxQuantity");var e=AL.math.add(j,g);if(b.type==="edit"){var m=k.get("maxQuantityReal");if(m==null){return}if(!g){g=parseFloat(k.get("quantity"))}if(AL.math.comp(e,m)>=0){p(o+k.get("text")+c)}}else{if(g&&(AL.math.comp(e,f)>=0)){p(o+k.get("text")+c)}}}}},updateItemTotal:function(g,e){if(e!="no"){e="yes"}var b=g.up("form");var h=b.down("textfield[name=price]");var f=b.down("displayfield[name=total]");var c=b.down("numberfield[name=quantity]");var j=b.down("textfield[name=discount]");var d=Ext.ComponentQuery.query("bill_FormAddBill")[0];var a=d.currencySign?d.currencySign:null;if(h.isValid()&&c.isValid()&&j.isValid()){f.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(h.getValue(),null,d.decimalPrecision),AL.math.sub(1,AL.math.div(j.getValue(),100))),null,d.decimalPrecision),c.getValue()),null,d.decimalPrecision),d.decimalPrecision,a))}else{e="no"}if(e=="yes"){this.updateTotal()}},validateForms:function(){var g=Ext.ComponentQuery.query("bill_FormAddBill")[0];var e=Ext.ComponentQuery.query("bill_FormAddCategory");var f=Ext.ComponentQuery.query("bill_FormAddRetention");var c=Ext.ComponentQuery.query("advance_Panel")[0];var j=0;var a=true;if(g.getForm().isValid()){var k=g.down("combo[name=idClient]");if(!k.getSelectedRecord()){a=false;k.markInvalid("Debes seleccionar el proveedor, no solo escribir su "+translate("name"))}if(e.length===0){a=false}else{var d=0;Ext.each(e,function(n){var l=n.down("groupingcombobox[name=idCategory]");if(l.getSelectedRecord()||n.fromXml){d++;var m=n.getForm();if(!m.isValid()){a=false;return false}}});if(d==0){a=false;e[0].down("groupingcombobox[name=idCategory]").markInvalid(["Debes seleccionar al menos una "+translate("category")+" para asociar a la","factura de proveedor"].join(" "))}Ext.each(f,function(n){var m=n;if(!m.getForm().isValid()){a=false}else{var l=m.getValues();j=AL.math.add(j,l.amount)}})}if(c){var h=this.updateTotal().total;h=AL.math.sub(h,j);a=a&&c.validateAdvancesForm(h,j>0)}var b=Ext.ComponentQuery.query("bill_PhysicalDocument datefield[name=physicalDocumentDate]")[0];if(b&&b.getValue()&&b.getValue()>new Date()){a=false;b.markInvalid(translate("theDateIsNotAPastDate",true))}}else{a=false}return a},getContact:function(f){var j=Ext.ComponentQuery.query("client_PositiveBalances")[0],c=f.up("form");clientRecord=f.getSelectedRecord();if(Ext.Array.contains(["costaRica"],c.configs.country)&&c.type!="edit"){this.verifySupplierRegimeOnEntityEndpoint(c)}if(j&&clientRecord){var h=clientRecord.getData();var e=Ext.ComponentQuery.query("combo[name=currency]")[0];var m=e.getSelectedRecord();var a=Ext.ComponentQuery.query("advance_Panel")[0];if(a){a.destroy()}if(m&&m.get("code")){j.setClient(h);var k={code:m.get("code"),symbol:m.get("symbol")};j.setCurrency(k)}else{j.setClient(h,true)}}if(clientRecord){var l=Ext.ComponentQuery.query("combo[name=days]")[0];if(clientRecord.get("idTerm")){var n=l.getStore();var b=function(o){var p=n.findRecord("idLocal",o.get("idTerm"));if(p){l.select(p)}};if(n.hasLoaded()){b(clientRecord)}else{n.on("load",function(){b(clientRecord)});n.load()}}else{var g=Ext.create("AL.model.Term",{idLocal:0,days:"Vencimiento manual",name:"Vencimiento manual"});l.select(g)}}var d=Ext.ComponentQuery.query("container[name=purchaseOrderContainer]")[0];if(d){this.updatePurchaseOrderContainer(d);this.updateTotal()}},showPurchaseOrderForm:function(){var a=Ext.ComponentQuery.query("bill_FormAddPurchaseOrder")[0];if(a.hidden){document.getElementById("purchase-order-wrapper").style.display="block";a.show()}else{document.getElementById("purchase-order-wrapper").style.display="none";a.hide()}},validateDifferentPurchaseOrders:function(e,b){var d=true;var a=Ext.ComponentQuery.query("bill_FormAddBill combo[name=idWarehouse]")[0];if(e.getSelectedRecord()&&a){var c=e.getSelectedRecord();if(c.get("warehouse").idLocal!=a.getSelectedRecord().get("idLocal")){e.setValue(null);e.clearInvalid();e.markInvalid(translate("theAssociatedWarehouse",true)+" a la "+translate("purchaseOrder")+" es diferente a "+translate("theAssociatedWarehouse")+" al documento");d=false}}var f=Ext.ComponentQuery.query("bill_FormAddPurchaseOrder combo[name=idPurchaseOrder]");Ext.each(f,function(g){if(g.getId()!=e.getId()){if(e.getValue()==g.getValue()){d=false;if(b){e.setValue(null);e.clearInvalid();e.markInvalid("La "+translate("purchaseOrder")+" ya ha sido seleccionada")}}}});return d},populatePurchaseOrderForm:function(){var b=Ext.ComponentQuery.query("bill_FormAddBill")[0];var e=b.bill;var c=this;var d=e.categoriesPurchaseOrder;if(d.length>0){var g=Ext.ComponentQuery.query("purchaseOrder_PurchaseOrderForBill")[0];if(g){g.destroy()}var f=[];if(!b.idPurchaseOrder){Ext.each(d,function(j){var h=[];if(f[j.idPurchaseOrder]){h=f[j.idPurchaseOrder]}h.push(j);f[j.idPurchaseOrder]=h;f[j.idPurchaseOrder].purchaseOrderNumber=j.purchaseOrderNumber})}else{f[b.idPurchaseOrder]=d}var a=Ext.ComponentQuery.query("bill_FormAddPurchaseOrder")[0];Ext.each(f,function(n){if(n){var k=Ext.ComponentQuery.query("combo[name=currency]")[0];var p=k.getSelectedRecord();var j="";if(p&&p.get("code")){j=p.get("code")}var m=Ext.create("AL.view.purchaseOrder.PurchaseOrderForBill",{type:!b.idPurchaseOrder?"edit":null});a.insert(2,m);var o=m.down("combo[name=idPurchaseOrder]");var l=o.getStore();l.getProxy().url="/purchase-order/retrieve-all-open-by-client/format/json/idClient/"+e.idClient+"/currency/"+j+"/idWarehouse/"+e.warehouse.idLocal;if(b.type=="edit"){var h=Ext.create("AL.model.PurchaseOrder",{id:f.indexOf(n),purchaseOrderNumber:n.purchaseOrderNumber,warehouse:{idLocal:e.warehouse.idLocal}});l.add(h);o.select(h)}if(b.type=="edit"){l.on("load",function(q){if(!o.getStore()){o.store=l}l.add(h);o.select(h)})}l.load({callback:function(){var r=l.findRecord("id",f.indexOf(n));if(r||b.type=="edit"){if(b.type!="edit"){if(!o.getStore()){o.store=l}o.select(r)}m.add({xtype:"container",name:"tableHeader",height:24,html:'<div id="headersTable" class="purchaseOrder"><table><tr><td class="tbName">'+translate("category",true)+"/"+translate("item",true)+'</td><td class="tbPrice">'+translate("price",true)+'</td><td class="tbDiscount">'+translate("discountAbbreviature",true)+' %</td><td class="tbTax" style="width: 89px !important;">'+translate("tax",true)+'</td><td class="tbQuantity">'+translate("quantity",true)+'</td><td class="tbDescription">'+translate("observations",true)+'</td><td class="tbTotal">Total</td></tr></table></div>',style:"background: #eee; margin-top:12px",queryName:"purchaseOrder_"+f.indexOf(n)});var u=n.length;var t=1;var s=b.configs.canCreateNewTax;var q=b.configs.canCreateNewWarehouse;b.callUpdateTotal=u<=1;Ext.each(n,function(x){x.idPurchaseOrder=b.idPurchaseOrder;var z=Ext.create("AL.view.bill.FormAddCategory",{category:x,type:"purchaseOrder",queryName:"purchaseOrder_"+f.indexOf(n),canCreateNewTax:s,canCreateNewWarehouse:q,});var y=z.down("hidden[name=idPurchaseOrder]");y.setValue(f.indexOf(n));var v=z.down("hidden[name=idCategoryPurchaseOrder]");if(b.type=="edit"){v.setValue(x.idCategoryPurchaseOrder)}else{v.setValue(x.id)}var w=z.down("combo[name=idTax]");m.add(z);z.enableFields();var w=z.down("combo[name=idTax]");if(t==u){w.on("taxComboRendered",function(){b.callUpdateTotal=true;c.updateTotal();GlobalLoadMask.hide("mask-items-loading")});b.callUpdateTotal=true;c.updateTotal();GlobalLoadMask.hide("mask-items-loading")}t++})}else{GlobalLoadMask.hide("mask-items-loading")}}})}})}},selectCategoryCombo:function(h,d){var b=d[0],c=Ext.ComponentQuery.query("bill_FormAddBill")[0];h.selectedRecord=b;if(c.type!="xml"&&c.type!="purchaseOrder"){if(b.get("recordType")=="item"){var g=(b.get("itemLastCost"))?b.get("itemLastCost"):null;if(g){var a=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];if(a.getValue()){g=AL.math.approx(AL.math.div(g,a.getValue()),null,3)}else{g=AL.math.approx(g)}}var f=h.up("form"),e=f.down("textfield[name=price]");e.setValue(g);e.clearInvalid()}}},updatePurchaseOrderContainer:function(c,k,h){var g=this;if(!c){c=Ext.ComponentQuery.query("container[name=purchaseOrderContainer]")[0]}if(!k){k=Ext.ComponentQuery.query("combo[name=idClient]")[0]}var b="";if(!h){var d=Ext.ComponentQuery.query("combo[name=currency]")[0];var h=d.getSelectedRecord();if(h&&h.get("code")){b=h.get("code")}}else{b=h.get("code")}if(c){c.removeAll();var l=Ext.create("AL.view.purchaseOrder.PurchaseOrderForBill");c.add(l);var e=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var j=e.getStore();if(!j.hasLoaded()){j.on("load",function(){var n=e.getSelectedRecord();var m="";if(n&&n.get("idLocal")){m=n.get("idLocal")}else{n=j.findRecord("isMain","yes");m=n.get("idLocal")}g.setPurchaseOrderProxy(l,k,b,m)})}else{var a=e.getSelectedRecord();var f="";if(a&&a.get("idLocal")){f=a.get("idLocal")}else{a=j.findRecord("isMain","yes");f=a.get("idLocal")}this.setPurchaseOrderProxy(l,k,b,f)}}},setPurchaseOrderProxy:function(e,b,a,c,d){if(!d){var f=e.down("purchaseOrder_ComboPurchaseOrders");if(f){d=f.getStore()}}if(d){d.getProxy().url="/purchase-order/retrieve-all-open-by-client/format/json/idClient/"+b.getValue()+"/currency/"+a+"/idWarehouse/"+c;d.load()}},showSpinner:function(b,c,d){d=d?d:"Cargando..";if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},validateRetentionForms:function(){var b=Ext.ComponentQuery.query("bill_FormAddRetention");var a=true;Ext.each(b,function(c){if(!c.getForm().isValid()){a=false}});return a},editRetentions:function(c){if(this.validateRetentionForms()){c.disable();GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("retentions")});var b=Ext.ComponentQuery.query("#editRetentionsPanel")[0];var d=Ext.ComponentQuery.query("bill_FormAddRetention");var a=[];Ext.each(d,function(j){var g=j.getValues();if(j.retention){g.idRetentionApplied=j.retention.id}var f=j.down("combo[name=idRetention]");var h=f.currentRetention;if(g.idRetention==="old"&&h){g.idRetention=h.get("currentId")}else{if(g.idRetention==="old"&&!h){delete g.idRetention}}g.exchangeRate=j.down("textfield[name=exchangeRate]").getValue();a.push(g)});var e={billIdLocal:b.billIdLocal,retentions:Ext.encode(a)};Ext.Ajax.request({url:"/bill/edit-retentions/format/json",method:"POST",params:e,success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){window.location="/bill/view/id/"+b.billIdLocal}else{c.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",h.cause)}},failure:function(){GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},calculateRetentionPanel:function(e,g,k,m){var j=g[0];var d=e.up("form");var a=d.up("panel");var f=d.down("textfield[name=amount]");var l=Ext.ComponentQuery.query("#editRetentionsPanel")[0];if(j.get("calculatedBy")!="percentage"){return}if(j.get("idRetentionReference")==1||j.get("idRetentionReference")==8||j.get("idRetentionReference")==6){var c=a.billIdLocal;var b;if(j.get("idRetentionReference")==6){b="/bill/retrieve-total-iva/id/"+c+"/subTotalWithIva/true/format/json"}else{b="/bill/retrieve-total-iva/id/"+c+"/format/json"}Ext.Ajax.request({url:b,success:function(p,q){var u=Ext.decode(p.responseText);if(u.success){var t=AL.math.approx(u.results,null,a.billDecimalPrecision);var s=AL.math.approx(AL.math.mul(t,AL.math.div(j.get("percentage"),100)),null,a.billDecimalPrecision);f.setValue(s);if(d.allowBase&&d.allowBase===true){var r=d.down("[name=base]");r.setValue(t)}}}})}else{var n=j.get("percentage");var h=AL.math.approx(AL.math.mul(a.total,AL.math.div(n,100)),null,a.billDecimalPrecision);f.setValue(h);if(l&&d.allowBase&&d.allowBase===true){var o=d.down("[name=base]");o.setValue(AL.math.approx(l.total,null,l.billDecimalPrecision))}}},calculateRetentionFromRetentionCreated:function(b,a){var c=Ext.ComponentQuery.query("bill_FormAddBill")[0];if(c){this.calculateRetention(b,a)}else{this.calculateRetentionPanel(b,a)}},printBill:function(d,g){g.preventDefault();var a=Ext.getDom("printBill"),b=Ext.getDom("downloadBill"),j=d.getAttribute("data-idLocal"),c=d.getAttribute("data-canPrint");var h=function(){if(c==="yes"){f()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",title:"¡Para imprimir debes ingresar los siguientes datos de tu empresa!",idLocal:j,callback:f,resourceTrigger:"bill"})}};var f=function(){var l=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(l){l.destroy();var k=Ext.ComponentQuery.query("bill_GridAll")[0];if(k){k.canPrint="yes"}if(a){a.setAttribute("data-canPrint","yes")}if(b){b.setAttribute("data-canDownload","yes")}window.location="/bill/print/id/"+j}else{var e=window.open("/bill/print/id/"+j);e.print()}};h()},downloadBill:function(c,g){g.preventDefault();var a=Ext.getDom("printBill"),b=Ext.getDom("downloadBill"),j=c.getAttribute("data-idLocal"),f=c.getAttribute("data-canDownload");var h=function(){if(f==="yes"){d()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",title:"¡Para descargar las "+translate("bills")+" debes ingresar los siguientes datos de tu empresa!",url:"/bill/id/"+j,idLocal:j,callback:d,resourceTrigger:"bill"})}};var d=function(){var e=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(e){e.destroy();b.setAttribute("data-canDownload","yes");a.setAttribute("data-canPrint","yes")}window.location="/bill/generate-pdf/id/"+j+"/download/yes"};h()},changeDueDateFromDays:function(a){if(!a){return}var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();if(a.get("idLocal")){var d=parseInt(a.get("days"));var b=Ext.Date.add(c,Ext.Date.DAY,d);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(b,"d/m/Y"))}Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setMinValue(c)},clearFormItem:function(d){var c=d.down("groupingcombobox[name=idCategory]");var a=c.getStore();var b=a.getProxy();b.setExtraParam("idWarehouse",c.getValue());c.reset();a.reload()},stampBill:function(f,h){var l=this,a=f.getAttribute("data-idLocal"),c=f.getAttribute("data-country"),k=f.getAttribute("data-priceFeInCurrentMembership"),o=f.getAttribute("data-showModalInfoFe"),n=f.getAttribute("data-monthsCurrentMembership"),d=f.getAttribute("data-userIdentification");h.preventDefault();var m=function(){switch(c){case"costaRica":url="https://api.hacienda.go.cr/fe/ae?identificacion="+d;break}GlobalRedirector.go({zoneTitle:translate("stamping",true)+" "+translate("invoice")});var e=function(){Ext.Ajax.request({url:"/bill/stamp/format/json/id/"+a,success:function(p){var q=Ext.decode(p.responseText);if(q.success){window.location.reload()}else{GlobalRedirector.close();if(q.cause){GlobalMsg.showNotification({title:"Error",text:q.cause,type:"error",closeable:"no"})}else{GlobalMsg.showNotification({title:"Error",text:translate("theBill",true)+" "+translate("bill")+" "+translate("couldNotBeStamped"),type:"error",closeable:"no"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:translate("theBill",true)+" "+translate("bill")+" "+translate("couldNotBeStamped"),type:"error"})}})};Ext.Ajax.request({url:url,method:"GET",success:function(p){var q=Ext.decode(p.responseText);switch(c){case"costaRica":if(q.regimen.descripcion=="Régimen Simplificado"){e()}else{GlobalRedirector.close();l.showSupplierNotAvailableToBeStampedNotification()}break}},failure:function(p){switch(c){case"costaRica":if(p&&p.responseText){var q=Ext.decode(p.responseText);if(q.code==400){GlobalRedirector.close();l.showGeneralStampInfoNotification(translate("providerIdentificationsIsNotValid",true))}else{if(q.code==404){GlobalRedirector.close();l.showGeneralStampInfoNotification(translate("providerIsNotRegisteredInHacienda",true))}else{e()}}}else{e()}break}}})};if(["costaRica","peru","colombia"].indexOf(c)!==-1&&o==true){var b="mensuales";switch(n){case"3":b="trimestrales";break;case"6":b="semestrales";break;case"12":b="anuales";break}var j,g;switch(c){case"costaRica":j=(new Date()<new Date("2018-10-01")?"Disfruta de facturación electrónica sin costo hasta el 30 de septiembre. <br> Luego podrás emitir ":" Para continuar emitiendo comprobantes deberás activar facturación electrónica")+" por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g=(new Date()<new Date("2018-10-01")?"Disfrutala sin costo hasta el 30 de septiembre. <br> ":"")+"Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"peru":j="Para continuar emitiendo comprobantes deberás activar facturación electrónica por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"colombia":j="Para continuar expidiendo comprobantes deberás activar facturación electrónica por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break}Ext.Msg.show({title:"Incluir facturación electrónica",msg:j,buttons:Ext.MessageBox.YESNO,cls:"modal-info-fe",width:480,fn:function(e){GlobalRedirector.go({zoneTitle:"Actualizando membresía"});Ext.Ajax.request({url:"/membership/include-fe/value/"+e+"/format/json",success:function(p,q){GlobalRedirector.close();var r=Ext.decode(p.responseText);if(r.success&&e==="yes"){GlobalMsg.showNotification({type:"success",title:"Facturación electrónica incluida",text:g,});setTimeout(m,3000)}else{m()}}})}})}else{m()}},hoverFieldRequired:function(c,d,b){var a=b?b:false;if(d&&c.fieldLabel){if(c.fieldLabel.includes('<span class="req">*</span>')){c.setFieldLabel(c.fieldLabel)}else{c.setFieldLabel(c.fieldLabel+'<span class="req">*</span>')}}else{c.setFieldLabel(c.fieldLabel.replace('<span class="req">*</span>',""))}c.allowBlank=!d;if(a){c.show()}else{c.hide()}},setUpElectronicFields:function(b,l){var g=b.down("textfield[name=billNumber]"),a=b.down("combo[name=economicActivity]"),k=b.down("combo[name=saleCondition]"),d=b.down("combo[name=paymentMethod]"),h=Ext.ComponentQuery.query("togglerFields[name=physicalDocumentsToggler]")[0],c=b.down("datefield[name=date]"),j=b.down("datefield[name=dueDate]"),f=Ext.get("addResolutionContainer");this.hoverFieldRequired(a,l,l);this.hoverFieldRequired(k,l,l);this.hoverFieldRequired(d,l,l);if(k.getValue()!="CREDIT"){this.hoverFieldRequired(j,!l,!l)}this.setItemsRequirementsForElectronicBill(l);this.setDiscountForElectronicBill();if(l){if(!b.type){this.verifySupplierRegimeOnEntityEndpoint(b);this.setElectronicBillNumber(b,g);this.setTextToSubmitCreateButtons(l);c.setFieldLabel(translate("stampDate",true)+'<span class="req">*</span>');j.setValue(c.getValue())}g.disable();g.allowBlank=false;h.show();if(f){f.hide();var e=Ext.ComponentQuery.query("bill_FormAddRetention");Ext.each(e,function(m){m.destroy()})}}else{g.enable();g.allowBlank=true;g.setValue("");h.hide();if(!b.type){this.setTextToSubmitCreateButtons(l);c.setFieldLabel(translate("date",true)+'<span class="req">*</span>')}if(f){f.show()}}},setElectronicBillNumber:function(c,a){var b=Ext.create("AL.LoadMask",{target:c,msg:translate("loading",true)});b.show();b.addDependantTask();Ext.Ajax.request({url:"/resolution/retrieve-all-active-and-autoincrement/format/json",method:"POST",success:function(f){var d=f.responseText;var e=Ext.decode(d);if(e.success){b.endDependantTask();Ext.each(e.resolutions,function(g){if(g.documentType=="bill"&&g.metadata&&g.metadata.isElectronicResolution==true){a.setValue(g.prefix+g.nextInvoiceNumber)}})}else{GlobalLoadMask.hide(container);GlobalMsg.showErrorMessage("Error",e.cause)}}})},setTextToSubmitCreateButtons:function(c){var b=Ext.ComponentQuery.query("buttons_SubmitCreate")[0];var d=b.down('button[action="saveAddPayment"]');var a=b.down('button[action="saveCreateBill"]');var e=b.down('button[action="saveBill"]');if(c){d.setText(translate("saveStampAndAddPayment",true));d.hide();a.setText(translate("saveStampAndCreateNew",true,{"new":"nueva"}));e.setText(translate("stamp",true))}else{d.setText(translate("saveAndAddPayment",true));d.show();a.setText(translate("saveAndCreateNew",true,{"new":"nueva"}));e.setText(translate("save",true))}},setItemsRequirementsForElectronicBill:function(a){var c=this,b=Ext.ComponentQuery.query("bill_FormAddCategory");Ext.each(b,function(d){c.setTaxToCategoryForForElectronicBill(d,a)})},setTaxToCategoryForForElectronicBill:function(d,c){var a=d.down("combo[name=idTax]");var b=a.getStore();if(c){b.clearFilter();b.filter({filterFn:function(e){if(e.raw.keyTaxReference=="IVA"&&e.raw.name=="IVA exento"&&Math.floor(e.raw.tax)==0){return true}else{return false}}});a.select(b.getAt(0));a.allowBlank=false}else{b.clearFilter();a.allowBlank=true}},setDiscountForElectronicBill:function(e){var f=Ext.ComponentQuery.query("bill_FormAddBill")[0],b=Ext.ComponentQuery.query("bill_FormAddCategory"),c=this;if(Ext.Array.contains(["costaRica"],f.configs.country)){var d=f.down("checkbox[name=isElectronicBillCheckbox]"),a=false;if(d){a=d.getValue()}if(e){c.manageDiscountModalToCategoryField(e,a)}else{Ext.each(b,function(g){c.manageDiscountModalToCategoryField(g,a)})}}},manageDiscountModalToCategoryField:function(c,a){var d=c.down("textfield[name=discount]"),e=Ext.ComponentQuery.query("bill_FormAddBill")[0];d.setValue("");if(a){var b=function(){var f=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!f){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:d,valueDiscountMax:100,isActiveElectronicInvoicing:true,country:e.configs.country}})}};d.getEl().on("click",b);d.getEl().on("focusin",b)}else{d.getEl().removeAllListeners()}},verifySupplierRegimeOnEntityEndpoint:function(d){var c=this,a=d.down("combo[name=idClient]"),e=a.getSelectedRecord();isElectronicBillCheckBox=d.down("checkbox[name=isElectronicBillCheckbox]");if(isElectronicBillCheckBox){var b=isElectronicBillCheckBox.getValue()}if(b&&e!=false){url="";switch(d.configs.country){case"costaRica":url="https://api.hacienda.go.cr/fe/ae?identificacion="+e.data.identification;break}Ext.Ajax.request({url:url,method:"GET",success:function(f){var g=Ext.decode(f.responseText);switch(d.configs.country){case"costaRica":if(g.regimen.descripcion=="Régimen Simplificado"){return}else{isElectronicBillCheckBox.setValue(false);c.showSupplierNotAvailableToBeStampedNotification()}break}},failure:function(f){if(f&&f.responseText){var g=Ext.decode(f.responseText);if(g.code==400){isElectronicBillCheckBox.setValue(false);c.showGeneralStampInfoNotification(translate("providerIdentificationsIsNotValid",true))}else{if(g.code==404){isElectronicBillCheckBox.setValue(false);c.showGeneralStampInfoNotification(translate("providerIsNotRegisteredInHacienda",true))}else{c.showGeneralStampInfoNotification(translate("ensureThatYourProviderIsInCorrectRegime",true),"warning",translate("information",true))}}}else{c.showGeneralStampInfoNotification(translate("ensureThatYourProviderIsInCorrectRegime",true),"warning",translate("information",true))}}})}},showSupplierNotAvailableToBeStampedNotification:function(){GlobalMsg.showNotification({closeable:"no",title:translate("documentCanNotBeStamped",true,{document:translate("theBill",true)+" "+translate("bill"),stampDocument:translate("stampedBill")}),text:translate("electronicBillCanNotBeStampedBecauseProviderIsTraditionalRegime",true),type:"error"})},showGeneralStampInfoNotification:function(b,a,c){a=a||"error";c=c||translate("documentCanNotBeStamped",true,{document:translate("theBill",true)+" "+translate("bill"),stampDocument:translate("stampedBill")});GlobalMsg.showNotification({title:c,closeable:"no",text:b,type:a})},loadCostCenterRecord:function(a,c){var b=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+a+"/format/json",success:function(e,g){var j=Ext.decode(e.responseText);if(j.success){var f=j.results;var d=Ext.create("AL.model.CostCenter",f);var h=c.getStore();if(h.isLoading()){h.on("load",function(){h.insert(0,d);c.select(d)})}else{h.insert(0,d);c.select(d)}}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},setCostCenterField:function(e,c){var b=e.getStore();var d=this;if(!b.hasLoaded()){b.load({callback:function(){var f=b.findRecord("idLocal",c);if(!f){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(f);e.resumeEvents()}}})}else{var a=b.findRecord("idLocal",c);if(!a){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(a);e.resumeEvents()}}},validateCostCenter:function(d,c){if(d.configs.costCenter.isActive){var a=d.down("combo[name=idWarehouse]");var b=d.down("combo[name=idCostCenter]");if(!a||!b){return true}var e=a.getSelectedRecord();var f=e.get("idCostCenter");if(f==""||f==null){return true}if(c.idCostCenter!=f){return false}}return true},showMessageCostCenterError:function(g,f){var c=g.down("combo[name=idWarehouse]");var j=invoiceForm.down("combo[name=idCostCenter]");var d=j.getSelectedRecord();var a=c.getSelectedRecord();var h=this;var b={document:translate("invoice")};var e=Ext.create("AL.view.common.SmileWindow",{id:"window-configuration-cost-centers",title:translate("costCenterErrorValidationTitle",true),width:600,modal:true,style:"padding:10px 18px 0px 18px",items:[{xtype:"box",html:"<div>"+translate("costCenterErrorValidationMessage",true)+translate("costCenterErrorValidationFixQuestion",true,b)+'<ul class="cost-center-selection-message"> <li>'+translate("costCenterWarehouseSelected",true)+" "+a.get("costCenterName")+"</li> <li>"+translate("costCenterSelected",true,b)+" "+d.get("name")+"</li></ul></div>"},],footer:{items:[{text:translate("skip",true),cls:"button",handler:function(k){e.close()}},{text:translate("modify",true),cls:"button main-button",handler:function(k){j.setValue(a.get("idCostCenter"));d=j.getSelectedRecord();if(!d&&a.get("idCostCenter")){h.loadCostCenterRecord(a.get("idCostCenter"),j,f)}else{f.fireEvent("click",f)}e.close()}}]}});e.show()}});Ext.define("AL.view.debitnote.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.debitnote_FormAddCategory"});Ext.define("AL.controller.DebitNote",{extend:"Ext.app.Controller",views:["debitnote.FormAddDebitNote","debitnote.FormAddCategory","debitnote.FormAssociations","debitnote.FormAddRefund","debitnote.FormAddBill","debitnote.GridAll","debitnote.FormAddBillCombo",],stores:["DebitNotes","Clients","Items","ItemsDebitNote","Taxes","Accounts","Bills","Categories","CompanyCurrenciesCombo","WarehouseCombo","CostCentersCombo",],models:["DebitNote","Client","Item","ItemDebitNote","Tax","Account","Bill","CategoryCombo","CompanyCurrency","Warehouse","CostCenter",],errorAlertDisplayed:false,init:function(){this.application.addListener("clientCreated",function(d){var c=d.initiator;var a=d.record;var b=c.getStore();b.add(a);c.select(a.get("idLocal"))},this);this.application.addListener("deleteDebitNote",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("debitNote")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("debitNote")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/debit-note/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.application.addListener("hiddenExchangeRateChanged",function(b){var e=Ext.ComponentQuery.query("debitnote_FormAddRefund");var a=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var c=a.down("combo[name=currency]");var d=c.getSelectedRecord();b=b?b:1;Ext.each(e,function(j){var k=j.down("displayfield[name=currencyDisplay]");var h=j.down("textfield[name=amount]");var l=j.down("combo[name=idAccount]");var g=l.getSelectedRecord();if(!k.hidden&&k.getValue()&&h.getValue()){if(h.getValue()&&g&&d&&!g.get("currencyCode")&&d.get("code")!=a.configs.currency){k.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(h.getValue(),null,2),b),null,2),2))}else{var f=d?d.get("symbol"):null;if(g&&g.get("currencyCode")){f=g.get("currencySymbol")}k.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(h.getValue(),null,2),b),null,2),2,f))}}})},this);this.application.addListener("warehouseCreatedDebitNote",function(c){var d=c.initiator;var a=c.record;var b=d.getStore();b.add(a);d.select(a.get("idLocal"));d.fireEvent("select",d)},this);this.control({"buttons_SubmitReset button[action=save]":{click:this.saveDebitNote},"buttons_SubmitReset button[action=edit]":{click:this.editDebitNote},debitnote_FormAddDebitNote:{afterrender:this.initialize},"debitnote_FormAddRefund button[action=deleteRefund]":{click:function(f){f.up("form").destroy();var g=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var e=g.down("hidden[name=exchangeCurrency]");if(e.getValue()){var h=Ext.ComponentQuery.query("debitnote_FormAddRefund");var a=false;Ext.each(h,function(k){var j=k.down("groupingcombobox[name=idAccount]");if(j.getSelectedRecord()&&j.getSelectedRecord().get("currencyCode")){a=true}});var b=g.down("combo[name=currency]");var d=b.getSelectedRecord();if(!a&&d.get("code")==g.configs.currency){e.setValue(null);var c=g.down("displayfield[name=exchangeCurrencyDisplay]");c.hide();c.setValue(null)}}}},"debitnote_FormAddDebitNote combo[name=idClient]":{select:function(e,d,b,c){var a=Ext.ComponentQuery.query("debitnote_FormAssociations #billContainer")[0];if(d!==b){a.removeAll(true)}},change:function(d,c,a,b){this.removeBillForms()}},"debitnote_FormAddCategory groupingcombobox[name=idCategory]":{render:this.setCategoryComboStore,select:function(h,d){var c=d[0];h.selectedRecord=c;var b=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var g=h.up("form");if(c.get("recordType")=="item"){var f=(c.get("itemLastCost"))?c.get("itemLastCost"):null;var e=g.down("textfield[name=price]");e.setValue(f);if(f){var a=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];if(a.getValue()){f=AL.math.approx(AL.math.div(f,a.getValue()),null,3)}else{f=AL.math.approx(f)}}e.setValue(f);e.clearInvalid()}}},"debitnote_FormAddCategory button[action=deleteItem]":{click:function(a){a.up("form").destroy();this.updateTotal()}},"debitnote_FormAddCategory textfield[name=price]":{change:this.updateItemTotal},debitnote_FormAddCategory:{beforerender:function(b){var a=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0]},afterrender:function(a){if(a.type&&a.type==="edit"){if(a.category){var b=a.category;var c=a.down("combo[name=idCategory]");var j=a.down("textfield[name=price]");var d=a.down("numberfield[name=quantity]");var e=a.down("textarea[name=observations]");var k=c.getStore();var g=(b.reference)?b.categoryName+" - "+b.reference:b.categoryName,h=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(h.configs.showCategoriesCode=="yes"&&b.categoryCode){g=b.categoryCode+" - "+g}var f=Ext.create("AL.model.CategoryCombo",{idLocal:b.idCategory,text:g,recordType:b.recordType});k.add(f);c.selectedRecord=f;c.select(f);j.setValue(b.priceSecondaryCurrency);d.setValue(b.quantity);e.setValue(b.observations)}}}},debitnote_GridAll:{beforerender:function(a){if(a&&a.country=="peru"){a.columns[0].setText(translate("number",true))}}},"debitnote_GridAll gridcolumn[type=debitNoteActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteDebitNote")){h.preventDefault();if(c.get("deletable")){l.fireEvent("deleteDebitNote",{record:c,initiator:a})}else{Ext.Msg.alert("Error","No se puede eliminar notas débito que tengan devolución de dinero conciliadas")}}}},"debitnote_FormAddCategory combo[name=idTax]":{render:function(f){var a=f.getStore();var e=f.up("form");var d=this;if(e.type&&e.type==="edit"){var c=e.category;var b=function(){var g=[];Ext.each(c.taxes,function(j){if(j.taxStatus==="inactive"){var h=Ext.create("AL.model.Tax",{idLocal:j.idTax,tax:j.tax,name:j.taxName});a.add(h);f.select(h)}else{g.push(j.idTax)}});d.updateTotal();if(g){f.setValue(g)}};if(a.hasLoaded()){b()}else{a.on("load",b)}}if(!a.hasLoaded()&&!a.isLoading()){a.load()}},change:this.updateTotal,beforeselect:function(c,a,b){if(c.multiSelect==true){if(a.get("idLocal")===0||(c.getValue()&&c.getValue()[0]===0)){c.getStore().each(function(d){if(d.get("idLocal")!==0){d.set("disabled",true)}});c.setValue("[0]")}return a.get("disabled")?false:true}},beforedeselect:function(c,a,b){if(c.multiSelect==true){if(a.get("idLocal")===0){c.getStore().each(function(d){if(d.get("idLocal")!==0){d.set("disabled",false)}})}}},},"debitnote_FormAddCategory numberfield[name=quantity]":{change:this.updateItemTotal},debitnote_FormAssociations:{addAnotherRefund:function(c){var a=Ext.ComponentQuery.query("#refundContainer")[0];var b=Ext.create("AL.view.debitnote.FormAddRefund");a.add(b)},addAnotherBill:function(g){var j=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var p=j.down("combo[name=idClient]");var e=j.down("combo[name=currency]");var k=e.getSelectedRecord();var h=k?k.get("code"):j.configs.currency;var l=Ext.ComponentQuery.query("#billContainer")[0];if(p.getValue()){var m=p.getValue();var c=Ext.create("AL.view.debitnote.FormAddBillCombo");var d=c.down("combo[name=number]");var q="";if(j.configs.costCenter.isActive){var b=j.down("combo[name=idCostCenter]");if(b&&b.previousSelected){q="/idCostCenter/"+b.getValue()}}var a={autoLoad:false,pageSize:20,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",url:"/bill/retrieve-open-by-client/idClient/"+m+"/format/json/currency/"+h+"/checkCurrency/yes/forceBillNumber/true"+q,reader:{type:"json",root:"results"}}};if(j.configs&&j.configs.country=="peru"){var o=j.down("[name=resolutionCombo]");var f=o.getSelectedRecord();if(f&&f.get("isElectronicResolution")=="yes"){a.filters=[{property:"hasStamp",value:"yes"}]}else{a.filters=[{property:"hasStamp",value:"no"}]}}var n=Ext.create("AL.store.Bills",a);d.store=n;d.emptyText=translate("search",true);d.editable=true;d.triggerCls="x-form-search-trigger";d.queryMode="remote";d.typeAhead=true;d.forceSelection=true;d.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{billNumber}</div></tpl>',width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"};l.add(c)}else{Ext.MessageBox.alert("Error",translate("youMustFirstChooseThe",true)+" "+translate("client"))}}},debitnote_FormAddRefund:{render:function(e){var g=e.down("groupingcombobox[name=idAccount]");var b=g.getStore();var d=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(!b.hasLoaded()){b.load({callback:function(){d.accounts=b.getRange(0,b.getCount());var h=d.down("combo[name=currency]"),j=h.getSelectedRecord();if(j&&j.get("code")&&j.get("code")!=d.configs.currency){b.each(function(k){if(k&&k.get("currencyCode")&&j.get("code")!=k.get("currencyCode")){b.remove(k)}})}}})}else{var a=d.down("combo[name=currency]");var f=a.getSelectedRecord();if(f&&f.get("code")){var c=d.accounts;b.removeAll();b.loadData(c);if(f.get("code")!=d.configs.currency){b.each(function(h){if(h&&h.get("currencyCode")&&f.get("code")!=h.get("currencyCode")){b.remove(h)}})}}}}},"debitnote_FormAddBillCombo button[action=deleteInvoice]":{click:function(a){a.up("form").destroy();this.updateTotal()}},"debitnote_FormAddBillCombo combo[name=number]":{select:this.billSelected,select2:function(a){this.billSelected(a.combo,[a.record])}},"debitnote_FormAddRefund combo[name=idAccount]":{change:function(e){var k=this.application;if(this.validateAccountRefund(e)){var l=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var d=l.down("combo[name=currency]");var n=e.getSelectedRecord();var a=d.getSelectedRecord();var f=e.up("form");var b=f.down("textfield[name=amount]");var h=f.down("displayfield[name=currencyDisplay]");var j=l.down("hidden[name=exchangeCurrency]");var p=l.down("displayfield[name=exchangeCurrencyDisplay]");if(n&&a&&n.get("currencyCode")&&a.get("code")){var m=d.getStore();var c=m.findRecord("code",n.get("currencyCode"));p.show();p.setValue("1 "+c.get("code")+" = "+Ext.util.Format.round(c.get("exchangeRate"),8)+" "+l.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');j.suspendEvents();j.setValue(Ext.util.Format.round(c.get("exchangeRate"),8));j.resumeEvents();var g=Ext.get("editExchangeRate");if(g){g.on("click",function(s){s.preventDefault();var r={};r.currency=c.get("code");r.initiator=p;r.currencyCode=c.get("code");r.fireChangeEvent=true;k.fireEvent("editExchangeRate",r)})}}if(b.getValue()&&n&&a&&n.get("currencyCode")){if(n.get("currencyCode")!=a.get("code")){if(n.get("currencyCode")&&n.get("currencyCode")!=l.configs.currency){h.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(b.getValue(),null,2),j.getValue()),null,2),2,n.get("currencySymbol")));h.setFieldLabel(n.get("currencyCode"))}h.show()}else{h.hide();b.setFieldLabel(null)}}else{h.hide();b.setFieldLabel(null);if(b.getValue()&&n&&a&&a.get("code")&&!n.get("currencyCode")&&a.get("code")!=l.configs.currency){h.show();h.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(b.getValue(),null,2),j.getValue()),null,2),2));h.setFieldLabel(l.configs.currency)}}if(n&&a&&n.get("currencyCode")!=a.get("code")){if(n.get("currencyCode")){b.setFieldLabel(a.get("code"))}else{if(!n.get("currencyCode")&&a.get("code")==l.configs.currency){b.setFieldLabel(null);var q=Ext.ComponentQuery.query("debitnote_FormAddRefund");var o=false;Ext.each(q,function(s){var r=s.down("groupingcombobox[name=idAccount]");if(r.getSelectedRecord()&&r.getSelectedRecord().get("currencyCode")){o=true}});if(!o){p.setValue(null);p.hide();j.suspendEvents();j.setValue(null);j.resumeEvents()}}else{b.setFieldLabel(a.get("code"))}}}else{b.setFieldLabel(null)}}}},"debitnote_FormAddRefund textfield[name=amount]":{change:function(f,b){var j=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var c=j.down("combo[name=currency]");var d=f.up("form");var g=d.down("combo[name=idAccount]");var k=g.getSelectedRecord();var a=c.getSelectedRecord();if(k&&a&&k.get("currencyCode")!=a.get("code")){var h=j.down("hidden[name=exchangeCurrency]");var e=d.down("displayfield[name=currencyDisplay]");if(k.get("currencyCode")&&k.get("currencyCode")!=j.configs.currency){e.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(b,null,2),h.getValue()),null,2),2,k.get("currencySymbol")));e.setFieldLabel(k.get("currencyCode"));e.show()}else{if(!k.get("currencyCode")&&a.get("code")!=j.configs.currency){e.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(b,null,2),h.getValue()),null,2),2));e.setFieldLabel(j.configs.currency);e.show()}}}}},"debitnote_FormAddDebitNote hidden[name=exchangeCurrency]":{change:function(g){var b=Ext.ComponentQuery.query("debitnote_FormAddCategory");var f=this;var d=g.up("form");var e=d.down("combo[name=currency]");var c=e.getSelectedRecord();if(c.get("code")!=d.configs.currency){d.currencySign=c.get("symbol")}else{d.currencySign=null}if(c.get("code")!=d.configs.currency){var a=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];Ext.each(b,function(l){var m=l.down("combo[name=idCategory]");var j=l.down("textfield[name=price]");var h=m.getSelectedRecord();if(h){var k=(h.get("itemLastCost"))?h.get("itemLastCost"):null;if(k){if(a.getValue()){k=AL.math.approx(AL.math.div(k,a.getValue()),null,3)}j.suspendEvents();j.setValue(k);j.resumeEvents()}f.updateItemTotal(j)}})}this.updateTotal()}},"debitnote_FormAddDebitNote combo[name=currency]":{change:function(e,b,a){var c=e.up("form");var m=c.down("displayfield[name=exchangeCurrencyDisplay]");var j=c.down("hidden[name=exchangeCurrency]"),d=j.getValue();var g=e.getSelectedRecord();var l=this.application;var k=this;if(g.get("code")&&g.get("code")!=c.configs.currency){m.show();m.setValue(" 1 "+g.get("code")+" = "+Ext.util.Format.round(g.get("exchangeRate"),8)+" "+c.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');j.setValue(Ext.util.Format.round(g.get("exchangeRate"),8));var f=Ext.get("editExchangeRate");if(f){f.on("click",function(p){p.preventDefault();var o={};o.currency=g.get("code");o.initiator=m;o.currencyRecord=g;o.fireChangeEvent=true;l.fireEvent("editExchangeRate",o)})}}else{m.hide();j.setValue(null)}var h=Ext.ComponentQuery.query("debitnote_FormAddRefund");Ext.each(h,function(o){o.destroy()});var n=Ext.ComponentQuery.query("debitnote_FormAddBillCombo");Ext.each(n,function(o){o.destroy()})}},"debitnote_FormAddDebitNote combo[name=idWarehouse]":{change:function(h,g,e){var a=h.up("form");h.previousValue=e;if(a.configs.costCenter.isActive&&h.canChangeCostCenter){var b=h.getSelectedRecord();var c=a.down("combo[name=idCostCenter]");if(b){var f=b.get("idCostCenter");if(c&&f){c.setValue(f);var d=c.getSelectedRecord();if(!d){this.loadCostCenterRecord(f,c)}else{c.fireEvent("select",c)}c.setReadOnly(true);c.addCls("combo-noedit-full-border")}else{if(c&&c.previousValue){c.setValue(c.previousValue);c.setReadOnly(false);c.removeCls("combo-noedit-full-border");c.fireEvent("select",c)}else{if(c){c.setValue(null);c.setReadOnly(false);c.removeCls("combo-noedit-full-border");c.fireEvent("select",c)}}}}else{if(c&&c.previousValue){c.setValue(c.previousValue);c.setReadOnly(false);c.removeCls("combo-noedit-full-border");c.fireEvent("select",c)}else{c.setValue(null);c.setReadOnly(false);c.removeCls("combo-noedit-full-border");c.fireEvent("select",c)}}}h.canChangeCostCenter=true},afterrender:function(d){var a=d.up("form");var c=this;d.canChangeCostCenter=false;var b=d.getStore();if(!b.hasLoaded()&&!b.isLoading()){b.load({callback:function(){if(a.type!="edit"){var e=b.findRecord("isMain","yes");if(e){d.select(e);if(a.configs.costCenter.isActive){var f=a.down("combo[name=idCostCenter]");var g=e.get("idCostCenter");if(f&&g){f.setValue(g);var e=f.getSelectedRecord();if(!e){c.setCostCenterField(f,g)}else{f.fireEvent("select",f)}f.previousSelected=true;f.setReadOnly(true);f.addCls("combo-noedit-full-border")}}}}}})}},select:function(b){var c=Ext.ComponentQuery.query("debitnote_FormAddCategory");Ext.each(c,function(d){d.removeAll();d.destroy()});this.addCategoryForm();var a=b.up("form");if(a.configs.costCenter.isActive){b.selectedValue=true}}},"debitnote_FormAddDebitNote combo[name=idCostCenter]":{beforerender:function(a){a.previousSelected=false},change:function(c,b,a){c.previousValue=a},blur:function(b){var a=b.getSelectedRecord();if(!a&&b.getValue()!=null){b.markInvalid(translate("costCenterErrorCombo",true))}},select:function(e){var c=e.up("form");var a=Ext.ComponentQuery.query("debitnote_FormAddBillCombo");if(a.length>0){var b=this;var d=Ext.create("AL.view.common.SmileWindow",{id:"confirm-window-cost-centers",title:translate("costCenter",true),width:600,modal:true,items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 13px 0px 13px; position: relative; text-align: justify; line-height: 18px;",html:"<div>"+translate("costCenterDebitNoteChange",true)+"</div>"}],footer:{items:[{text:translate("btnCancel",true),cls:"button",handler:function(g){d.close();e.suspendEvents();if(!isNaN(e.previousValue)){e.setValue(e.previousValue)}else{e.setValue(null)}var f=c.down("combo[name=idWarehouse]");if(f&&(f.selectedValue||f.idCostCenter!=null)){if(!isNaN(f.previousValue)){f.setValue(f.previousValue);delete f.previousValue}}e.resumeEvents()}},{text:translate("buttonOk",true),cls:"button main-button",handler:function(h){Ext.each(a,function(k){var j=k.down("button[action=deleteInvoice]");if(j){j.fireEvent("click",j)}});d.close();if(e.getValue()!==null){var g=e.getStore();var f=g.findRecord("idLocal",e.getValue());if(!f){this.loadCostCenterRecord(e.getValue(),e)}else{e.select(f)}}}}]}});d.show()}e.previousSelected=true}},})},saveDebitNote:function(f){var k=this;if(this.validateForms()){f.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("debitNote")});var e=Ext.ComponentQuery.query("debitnote_FormAddCategory");var q=Ext.ComponentQuery.query("debitnote_FormAddBillCombo");var p=Ext.ComponentQuery.query("debitnote_FormAddRefund");var h=[];var n=[];Ext.each(e,function(u){var s=u.down("groupingcombo");var r=s.selectedRecord;var t=u.getForm().getValues();if(!t.idTax||t.idTax==0){delete t.idTax}if(r){if(r.get("recordType")==="item"){t.idLocal=t.idCategory;delete t.idCategory;n.push(t)}else{if(r.get("recordType")==="category"){h.push(t)}}}});var c=[];Ext.each(q,function(r){var u=r.down(" > textfield[name=amount]");if(u.getValue()&&u.getValue()>0){var t=r.down("hidden[name=idBill]");var s={};s.idBill=t.getValue();s.amount=u.getValue();c.push(s)}});var d=[];Ext.each(p,function(r){d.push(r.getValues())});var b=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var m=b.getValues();var j=Ext.get("new-comment");if(j&&j.getValue()){var g=j.getValue();m.comment=Ext.encode(g)}var a=b.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){m.exchangeRate=a.getValue()}m.items=Ext.encode(n);m.categories=Ext.encode(h);m.bills=Ext.encode(c);m.refunds=Ext.encode(d);if(b.configs&&b.configs.resolutionModel&&b.configs.resolutionModel==="new"){var o=b.down("numerationField[name=numerationComponent]");var l=o.getSelectedNumeration();m.idResolution=l.idLocal}if(!this.validateCostCenter(b,m)){f.enable();GlobalRedirector.close();this.showMessageCostCenterError(b,f);return}Ext.Ajax.request({url:"/debit-note/add/format/json",method:"POST",params:m,success:function(r,s){var t=Ext.decode(r.responseText);if(t.success){var u=t.results;window.location="/debit-note/view/id/"+u}else{f.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",t.cause)}},failure:function(){f.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                               Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{if(!(this.errorAlertDisplayed)){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},editDebitNote:function(g){var j=this;if(this.validateForms()){g.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("debitNote")});var f=Ext.ComponentQuery.query("debitnote_FormAddCategory");var p=Ext.ComponentQuery.query("debitnote_FormAddBillCombo");var o=Ext.ComponentQuery.query("debitnote_FormAddRefund");var h=[];var m=[];Ext.each(f,function(v){var r=v.down("groupingcombo");var q=r.selectedRecord;var s=v.getForm().getValues();if(s.idCategory==="old"){s.idCategory=s.oldIdCategory;s.categoryName=s.oldCategoryName;delete s.oldCategoryName}else{delete s.oldCategoryName}if(s.idTax==="old"){var t=v.down("combo[name=idTax]");var u=t.actualTax;if(u.get("currentId")){s.idTax=u.get("currentId");s.taxName=u.get("name");s.tax=u.get("tax")}else{delete s.idTax}s.taxName=u.get("name");s.tax=u.get("tax")}else{if(!s.idTax||s.idTax==0){delete s.idTax}}delete s.oldId;if(q){if(q.get("recordType")==="item"){s.idLocal=s.idCategory;delete s.idCategory;m.push(s)}else{if(q.get("recordType")==="category"){h.push(s)}}}});var c=[];Ext.each(p,function(q){var t=q.down(" > textfield[name=amount]");if(t.getValue()&&t.getValue()>0){var s=q.down("hidden[name=idBill]");var r={};r.idBill=s.getValue();r.amount=t.getValue();c.push(r)}});var e=[];Ext.each(o,function(q){e.push(q.getValues())});var b=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var d=b.down("combo[name=idCostCenter]");if(b.configs.costCenter.isActive&&d&&!d.allowEdit){d.enable()}var l=b.getValues();var a=b.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){l.exchangeRate=a.getValue()}l.items=Ext.encode(m);l.categories=Ext.encode(h);l.bills=Ext.encode(c);l.refunds=Ext.encode(e);if(b.configs&&b.configs.resolutionModel&&b.configs.resolutionModel==="new"){var n=b.down("numerationField[name=numerationComponent]");var k=n.getSelectedNumeration();l.idResolution=k.idLocal}if(!this.validateCostCenter(b,l)){g.enable();GlobalRedirector.close();this.showMessageCostCenterError(b,g);return}Ext.Ajax.request({url:"/debit-note/edit/format/json",method:"POST",params:l,success:function(q,r){var s=Ext.decode(q.responseText);if(s.success){var t=s.results;window.location="/debit-note/view/id/"+t}else{g.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",s.cause)}},failure:function(){g.enable();GlobalRedirector.close()}})}else{if(!this.errorAlertDisplayed){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},validateDifferentBills:function(d,a){var c=true;var b=Ext.ComponentQuery.query("debitnote_FormAddBillCombo combo[name=number]");setTimeout(function(){Ext.each(b,function(e){if(e.getId()!=d.getId()){if(d.getValue()==e.getValue()){c=false;if(a){d.setValue(null);d.clearInvalid();d.markInvalid(translate("theInvoice",true)+" "+translate("invoice")+" ya ha sido seleccionada")}}}})},100);return c},billSelected:function(d,g){var k=g[0];var b=d.up("form");if(this.validateDifferentBills(d,true)){var o=b.down("hidden[name=idBill]");var c=b.down("displayfield[name=total]");var l=b.down("displayfield[name=totalPayed]");var j=b.down("displayfield[name=missingAmount]");var f=b.down("textfield[name=amount]");var e=new Date(k.get("date"));e=Ext.Date.format(e,"d/m/Y");var n=new Date(k.get("dueDate"));n=Ext.Date.format(n,"d/m/Y");o.setValue(k.get("idLocal"));c.setValue(Ext.util.Format.usMoney(k.get("total"),k.get("decimalPrecision"),k.get("currencySymbol")));l.setValue(Ext.util.Format.usMoney(k.get("totalPayed"),k.get("decimalPrecision"),k.get("currencySymbol")));j.setValue(Ext.util.Format.usMoney(k.get("missingAmount"),k.get("decimalPrecision"),k.get("currencySymbol")));var m=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(!k.get("blockedAssociations")){f.enable()}f.focus(false,true);if(m.configs.costCenter.isActive){var h=k.get("idCostCenter");var a=m.down("combo[name=idCostCenter]");if(a&&h!=""&&h!=null){storeCostCenter=a.getStore();if(!storeCostCenter.hasLoaded()&&!storeCostCenter.isLoading()){this.loadCostCenterRecord(h,a)}else{var k=storeCostCenter.findRecord("idLocal",h);if(!k){this.loadCostCenterRecord(h,a)}else{a.select(k)}}}a.previousSelected=true}}},initialize:function(e){var a=Ext.get("addOtherAccount");a.on("click",this.addCategoryForm);var d=this;if(!e.configs.showWarehouses){e.down("combo[name=idWarehouse]").hide()}var c=e.down("combo[name=currency]");var f=c.getStore();f.load({callback:function(){var h=Ext.create("AL.model.CompanyCurrency",{code:e.configs.currency,name:e.configs.nameCurrency,exchangeRate:1});f.add(h);if(e.type!="edit"){c.select(e.configs.currency)}}});if(e.configs.multicurrency=="yes"){c.show()}if(e.configs&&(!e.configs.resolutionModel||e.configs.resolutionModel!=="new")){var g=e.down("textfield[name=number]");g.show()}var b=null;if(e&&e.configs.costCenter.isActive){b=e.down("combo[name=idCostCenter]");b.store=Ext.create("AL.store.CostCentersCombo");b.enable();b.show();b.allowEdit=true}if(e.type&&e.type==="edit"){Ext.Ajax.request({url:"/debit-note/retrieve-for-edit/id/"+e.idLocal+"/format/json",success:function(h,j){var v=Ext.decode(h.responseText);if(v.success){var A=v.results;var w=A.debitNote;if(e.configs&&e.configs.resolutionModel&&e.configs.resolutionModel==="new"){var s=e.down("numerationField[name=numerationComponent]");s.values.numerationIdLocal=w.resolutionIdLocal;s.values.prefix=w.prefix;s.values.number=w.number;s.selectNumerationByIdLocal(w.resolutionIdLocal)}else{var m=e.down("textfield[name=number]");m.setValue(w.number)}var z=A.categories;var t=A.refunds;var B=A.billPayed;var K=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];K.decimalPrecision=w.decimalPrecision;var F=AL.date(w.date);F=Ext.Date.format(F,"d/m/Y");var x=e.down("hidden[name=idLocal]");var o=e.down("combo[name=idClient]");var q=e.down("datefield[name=date]");var p=e.down("textarea[name=observations]");var n=Ext.create("AL.model.Client",{idLocal:w.idClient,name:w.name});o.suspendEvents();o.select(n);o.resumeEvents();var u=e.down("combo[name=idWarehouse]");if(w.warehouse&&w.warehouse.idLocal){var E=u.getStore();if(!E.hasLoaded()&&!E.isLoading()){E.on("load",function(){var M=Ext.create("AL.model.Warehouse",w.warehouse);E.add(M);u.select(M)})}else{var l=Ext.create("AL.model.Warehouse",w.warehouse);E.add(l);u.select(l)}}if(K.configs.multicurrency=="yes"){var G=K.down("combo[name=currency]");var D=K.down("hidden[name=exchangeCurrency]");var k=G.getStore();G.show();var J=function(){var M=k.findRecord("code",K.configs.currency);if(!M){M=Ext.create("AL.model.CompanyCurrency",{code:K.configs.currency,exchangeRate:1});k.add(M)}var N=null;if(w.currencyCode){N=k.findRecord("code",w.currencyCode);if(N){N.set("exchangeRate",w.exchangeRate)}else{N=Ext.create("AL.model.CompanyCurrency",{exchangeRate:w.exchangeRate,code:w.currencyCode,symbol:w.currencySymbol});k.add(N)}}if(!N){N=M}G.select(N);D.setValue(w.exchangeRate)};if(k.hasLoaded()){J()}else{k.load({callback:function(){J()}})}}x.setValue(w.idLocal);p.setValue(w.observations);var L=e.configs.multipleTaxes!="yes"?"no":"yes";var r=e.configs.canCreateNewTax;var I="";if(b){if(B.length>0){b.allowEdit=false;b.setReadOnly(true);b.addCls("combo-noedit-full-border")}if(w.idCostCenter){d.setCostCenterField(b,w.idCostCenter);I="/idCostCenter/"+w.idCostCenter}}Ext.each(z,function(N){var O=Ext.ComponentQuery.query("#addCategoryPanel")[0];var M=Ext.create("AL.view.debitnote.FormAddCategory",{type:"edit",category:N,multipleTaxes:L,canCreateNewTax:r,});O.add(M)});var H=Ext.ComponentQuery.query("#billContainer")[0];var C=e;Ext.each(B,function(T){var M=Ext.create("AL.view.debitnote.FormAddBillCombo");var P=M.down("combo[name=number]");var N={autoLoad:true,pageSize:20,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",url:"/bill/retrieve-open-by-client/idClient/"+w.idClient+"/format/json/currency/"+w.currencyCode+"/checkCurrency/yes/forceBillNumber/true"+I,reader:{type:"json",root:"results"}}};var U=Ext.create("AL.store.Bills",N);P.store=U;P.emptyText=translate("search",true);P.editable=true;P.triggerCls="x-form-search-trigger";P.queryMode="remote";P.typeAhead=true;P.forceSelection=true;P.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{billNumber}</div></tpl>',width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("theSearchDidNotGetAnyResults",true)+"</div>",cls:"search-input-list"};var R=Ext.create("AL.model.Bill",T);var O=R.getData();var Q=AL.date(O.date);if(C.configs.country==="usa"){Q=Ext.Date.format(Q,"m/d/Y")}else{Q=Ext.Date.format(Q,"d/m/Y")}R.set("billNumber",(O.billNumber)?O.billNumber:"Factura "+Q.toString());R.set("missingAmount",parseFloat(T.missingAmount)+parseFloat(T.amountSecondaryCurrency));R.set("totalPayed",parseFloat(T.totalPayed)-parseFloat(T.amountSecondaryCurrency));R.set("currencySymbol",w.currencySymbol);if(U.hasLoaded()){U.insert(0,R);P.select(R)}else{U.on("load",function(){U.insert(0,R);P.select(R)})}P.fireEvent("select2",{combo:P,record:R});var S=M.down("textfield[name=amount]");S.setValue(T.amountSecondaryCurrency);H.add(M)});var y=Ext.ComponentQuery.query("#refundContainer")[0];Ext.each(t,function(S){var Q=AL.date(S.date);Q=Ext.Date.format(Q,"d/m/Y");var N=Ext.create("AL.view.debitnote.FormAddRefund");var O=N.down("datefield[name=date]");var T=N.down("combo[name=idAccount]");var P=N.down("textfield[name=amount]");var R=N.down("textfield[name=observations]");O.setValue(Q);var U=T.getStore(),M=function(){var V=T.getSelectedRecord();if(V.get("currencyCode")&&!w.currencyCode){P.setValue(S.amount)}else{P.setValue(S.amountSecondaryCurrency)}};if(U.hasLoaded()){T.select(S.idAccount);M()}else{U.on("load",function(){T.select(S.idAccount);M()})}R.setValue(S.observations);y.add(N)});q.setRawValue(F)}},failure:function(){}})}},addCategoryForm:function(){var a=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var c=Ext.ComponentQuery.query("#addCategoryPanel")[0];var e=Ext.create("AL.view.debitnote.FormAddCategory",{canCreateNewTax:a.configs.canCreateNewTax,});var b=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];if(b.configs.multipleTaxes=="yes"){var d=e.down("combo[name=idTax]");d.multiSelect=true;d.listConfig.tpl='<tpl for="."><tpl if="values.disabled==true"><div class="x-boundlist-item checkbox-item-disabled"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div><tpl else><div class="x-boundlist-item"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl></tpl>'}c.add(e)},setCategoryComboStore:function(b,e){var a=b.up("form");var f=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var j=Ext.create("AL.store.CategoriesCombo");j.proxy.url="/category/retrieve-for-combo/includeItems/true/type/expense/format/json/includeAsset/true";var h=null;if(f.configs.showWarehouses){var c=f.down("combo[name=idWarehouse]");var d=j.getProxy();if(c.getValue()){if(typeof c.getValue()=="string"){h=c.getValue()}else{h=c.getValue().get("idLocal")}d.extraParams={idWarehouse:h}}else{var g=c.getStore();g.on("load",function(){var k=g.findRecord("isMain","yes");h=k.get("idLocal");d.extraParams={idWarehouse:h}})}}b.store=j},addBillForm:function(e){var d=Ext.ComponentQuery.query("#billContainer")[0];var b=Ext.create("AL.view.debitnote.FormAddBill");e.idBill=e.idLocal;var a=AL.date(e.date);a=Ext.Date.format(a,"d/m/Y");e.billNumber=(e.billNumber)?e.billNumber:"Factura "+a.toString();var c=(e.prefix)?e.prefix:"";b.getForm().setValues({idBill:e.idBill,billNumber:c+e.billNumber,total:Ext.util.Format.usMoney(e.total,e.decimalPrecision,e.currencySymbol),missingAmount:Ext.util.Format.usMoney(e.missingAmount,e.decimalPrecision,e.currencySymbol),totalPayed:Ext.util.Format.usMoney(e.totalPayed,e.decimalPrecision,e.currencySymbol),amount:e.amount});b.billSubTotal=e.subTotal;b.missingAmount=e.missingAmount;b.decimalPrecision=e.decimalPrecision;d.add(b)},updateTotal:function(){var f={};var d=Ext.ComponentQuery.query("debitnote_FormAddCategory");var a=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var e=0;var j=0;var k=0;var g=1;var h=false;if(a&&a.configs.multicurrency=="yes"){var c=a.down("combo[name=currency]");if(c.getValue()&&a.configs.currency!=c.getValue()){h=true;g=a.down("hidden[name=exchangeCurrency]").getValue()}}Ext.each(d,function(m){var t=m.down("combo[name=idTax]");var v=m.down("textfield[name=price]");var p=m.down("numberfield[name=quantity]");var s=t.findRecordByValue(t.getValue());var n=AL.math.approx(AL.math.mul(AL.math.approx(v.getValue(),null,a.decimalPrecision),p.getValue()),null,a.decimalPrecision);var o=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(v.getValue(),null,a.decimalPrecision),g),null,a.decimalPrecision),p.getValue()),null,a.decimalPrecision);e=AL.math.add(e,n);var s=null;var u=typeof(t.getValue())=="string"?[t.getValue()]:t.getValue();if(m.type&&m.type==="edit"){if(t.getValue()==="old"){s=t.actualTax}}if(t.getValue()){var r=0;var q=0;Ext.each(u,function(x){s=t.findRecordByValue(x);if(s){var w=s.get("name")+s.get("tax");r=AL.math.add(r,AL.math.approx(AL.math.mul(n,AL.math.div(s.get("tax"),100)),null,a.decimalPrecision));q=AL.math.add(q,AL.math.approx(AL.math.mul(o,AL.math.div(s.get("tax"),100)),null,a.decimalPrecision));if(f[w]){f[w].value=AL.math.add(f[w].value,AL.math.approx(AL.math.mul(n,AL.math.div(s.get("tax"),100)),null,a.decimalPrecision))}else{f[w]={label:s.get("name")+" ("+Ext.util.Format.round(s.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(n,AL.math.div(s.get("tax"),100)),null,a.decimalPrecision)}}}else{j=AL.math.add(j,n);k=AL.math.add(k,o)}});j=AL.math.add(j,AL.math.add(n,r));k=AL.math.add(k,AL.math.add(o,q))}else{j=AL.math.add(j,n);k=AL.math.add(k,o)}});var b=a&&a.currencySign?a.currencySign:null;var l=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];l.removeAll();l.actualTotal=j;l.addItem({label:"Subtotal",value:AL.math.approx(e,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});Ext.Object.each(f,function(m,n){n.value=AL.math.approx(n.value,null,a.decimalPrecision);n.decimalPrecision=a.decimalPrecision;n.currencySign=b;l.addItem(n)});l.addItem({label:"Total",value:AL.math.approx(j,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});if(h){l.addItem({label:"Total "+a.configs.currency,value:AL.math.approx(k,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision})}return{subTotal:e,taxes:f,total:j}},updateItemTotal:function(h,f,d,k){var c=h.up("form");var j=c.down("textfield[name=price]");var g=c.down("displayfield[name=total]");var e=c.down("numberfield[name=quantity]");var a=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];var b=a.currencySign?a.currencySign:null;if(j.isValid()&&e.isValid()){g.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(j.getValue(),null,a.decimalPrecision),e.getValue()),null,a.decimalPrecision),a.decimalPrecision,b))}else{g.setValue(Ext.util.Format.usMoney(0,a.decimalPrecision,b))}this.updateTotal()},removeBillForms:function(){var a=Ext.ComponentQuery.query("debitnote_FormAddBill");GlobalLoadMask.show("associationsContainer");Ext.each(a,function(b){b.destroy()});GlobalLoadMask.hide("associationsContainer")},validateForms:function(){var c=this;c.errorAlertDisplayed=false;var d=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0].getForm();var b=Ext.ComponentQuery.query("debitnote_FormAddCategory");var a=true;if(d.isValid()){if(b.length===0){a=false}else{Ext.each(b,function(f){var e=f.getForm();if(!e.isValid()){a=false}});a=a&&c.validateAssociateForm()}}else{a=false}return a},validateAssociateForm:function(){this.updateTotal();var c=this;var g=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0].actualTotal;var j=Ext.ComponentQuery.query("debitnote_FormAddBillCombo");var h=Ext.ComponentQuery.query("debitnote_FormAddRefund");var f=Ext.ComponentQuery.query("debitnote_FormAddDebitNote")[0];g=AL.math.approx(g,null,f.decimalPrecision);var a=true;var e=0;var b=f.configs.currency;var d=f.down("combo[name=currency]").getSelectedRecord()?f.down("combo[name=currency]").getSelectedRecord().get("code"):null;Ext.each(h,function(l){var k=l.down("textfield[name=amount]");if(l.getForm().isValid()){e=AL.math.add(e,AL.math.approx(k.getValue(),null,2))}else{a=false}});Ext.each(j,function(k){var l=k.down(" > textfield[name=amount]");if(k.getForm().isValid()){if(l.getValue()){e=AL.math.add(e,l.getValue());e=AL.math.approx(e,null,k.decimalPrecision)}}else{a=false}});if(a&&AL.math.comp(g,e)<0){GlobalMsg.showNotification({title:"Error",text:translate("theValueOfReturnsAndOrCreditsToDocument1IsGreaterThanTheTotalOfTheDocument2",true,{document1:translate("bill"),document2:translate("debitNote")}),type:"error"});a=false;c.errorAlertDisplayed=true}return a},validateAccountRefund:function(d){var a=d.getSelectedRecord();var b=true;var c=Ext.ComponentQuery.query("debitnote_FormAddRefund");Ext.each(c,function(e){var g=e.down("combo[name=idAccount]");var f=g.getSelectedRecord();if(f&&a&&f.get("currencyCode")&&a.get("currencyCode")&&f.get("currencyCode")!=a.get("currencyCode")){b=false;setTimeout(function(){d.setValue(null);d.clearInvalid();d.markInvalid("No se puede seleccionar dos bancos de monedas extranjeras diferentes")},100)}});return b},loadCostCenterRecord:function(b,d,a){var c=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+b+"/format/json",success:function(f,h){var k=Ext.decode(f.responseText);if(k.success){var g=k.results;var e=Ext.create("AL.model.CostCenter",g);var j=d.getStore();if(j.isLoading()){j.on("load",function(){j.insert(0,e);d.select(e)})}else{j.insert(0,e);d.select(e)}if(a){a.fireEvent("click",a)}}else{Ext.MessageBox.alert(translate("costCenterNotFound",true))}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},setCostCenterField:function(e,c){var b=e.getStore();var d=this;if(!b.hasLoaded()){b.load({callback:function(){var f=b.findRecord("idLocal",c);if(!f){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(f);e.resumeEvents()}}})}else{var a=b.findRecord("idLocal",c);if(!a){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(a);e.resumeEvents()}}},validateCostCenter:function(b,d){if(b.configs.costCenter.isActive){var a=b.down("combo[name=idWarehouse]");var c=b.down("combo[name=idCostCenter]");if(!a||!c){return true}var e=a.getSelectedRecord();var f=e.get("idCostCenter");if(f==""||f==null){return true}if(d.idCostCenter!=f){return false}}return true},showMessageCostCenterError:function(j,f){var c=j.down("combo[name=idWarehouse]");var h=j.down("combo[name=idCostCenter]");var d=h.getSelectedRecord();var a=c.getSelectedRecord();var g=this;var b={document:translate("debitNote")};var e=Ext.create("AL.view.common.SmileWindow",{id:"window-configuration-cost-centers",title:translate("costCenterErrorValidationTitle",true),width:600,modal:true,style:"padding:10px 18px 0px 18px",items:[{xtype:"box",html:"<div>"+translate("costCenterErrorValidationMessage",true)+translate("costCenterErrorValidationFixQuestion",true,b)+'<ul class="cost-center-selection-message"> <li>'+translate("costCenterWarehouseSelected",true)+" "+a.get("costCenterName")+"</li> <li>"+translate("costCenterSelected",true,b)+" "+d.get("name")+"</li></ul></div>"},],footer:{items:[{text:translate("skip",true),cls:"button",handler:function(k){e.close()}},{text:translate("modify",true),cls:"button main-button",handler:function(k){h.setValue(a.get("idCostCenter"));d=h.getSelectedRecord();if(!d&&a.get("idCostCenter")){g.loadCostCenterRecord(a.get("idCostCenter"),h,f)}else{f.fireEvent("click",f)}e.close()}}]}});e.show()}});Ext.define("AL.view.payment.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.payment_FormAddCategory"});Ext.define("AL.view.purchaseOrder.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.purchaseOrder_FormAddCategory"});Ext.define("AL.controller.PurchaseOrder",{extend:"Ext.app.Controller",views:["purchaseOrder.FormAddPurchaseOrder","purchaseOrder.FormAddCategory","purchaseOrder.GridAll","purchaseOrder.MoreActionsButton"],stores:["CompanyCurrenciesCombo","Clients","Categories","Taxes","CategoriesCombo","Retentions","PurchaseOrders","WarehouseCombo","CostCentersCombo"],models:["CompanyCurrency","Client","Category","Tax","CategoryCombo","Retention","PurchaseOrder","Warehouse","CostCenter"],init:function(){this.application.addListener("clientCreated",function(h){var g=h.initiator;var e=h.record;var f=g.getStore();f.add(e);g.select(e.get("idLocal"))},this);this.application.addListener("deletePurchaseOrder",function(g){var e=g.record;var f=g.initiator;Ext.Msg.show({title:translate("delete",true)+" "+translate("purchaseOrder"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("purchaseOrder")+"? "+translate("thisOperationCannotBeUndone",true),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/purchase-order/delete/format/json",method:"POST",params:{id:e.get("id")},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){var j=f.getStore();j.load()}else{if(m.cause){Ext.MessageBox.alert("Error",m.cause)}}},failure:function(){}})}}})},this);this.application.addListener("voidPurchaseOrder",function(g){var e=g.record;var f=g.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("purchaseOrder"),msg:translate("areYouSureYouWantTo",true)+" "+translate("cancel")+" "+translate("theF")+" "+translate("purchaseOrder")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/purchase-order/void/format/json",method:"POST",params:{id:e.get("id")},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){if(f){var j=f.getStore();j.load()}else{window.location="/purchase-order/view/id/"+e.get("id")}}else{if(m.cause){Ext.MessageBox.alert("Error",m.cause)}}},failure:function(){}})}}})},this);this.application.addListener("warehouseCreatedPurchaseOrder",function(g){var h=g.initiator;var e=g.record;var f=h.getStore();f.add(e);h.select(e.get("idLocal"))},this);var d=Ext.get("printPurchaseOrderLink");if(d){d.on("click",function(g,f){g.preventDefault();if(f.getAttribute("data-canPrintOrDownload")){var h=f.getAttribute("data-id");var e=window.open("/purchase-order/print/id/"+h);e.print()}})}var a=Ext.select("a[data-action=voidPurchaseOrder]");if(a.elements.length>0){a.on("click",function(j,k){j.preventDefault();var h=Ext.get(k);var g=h.getAttribute("data-idPurchaseOrder");var f=Ext.create("AL.model.PurchaseOrder",{id:g});this.application.fireEvent("voidPurchaseOrder",{initiator:null,record:f})},this)}var c=Ext.get("emailPurchaseOrder");if(c){c.on("click",function(h,f){var k=f.getAttribute("data-id");var e=f.getAttribute("data-idClient");var g=f.getAttribute("data-canEmail");var j=function(){var l=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(l){l.destroy();f.setAttribute("data-canEmail","yes")}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+e+"/format/json/email-template/purchase-order/idDocument/"+k,success:function(n,p){var r=Ext.decode(n.responseText);if(r.success){var m=[];if(r.results){var o=r.results;if(r.emailTemplate){m.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:r.emailTemplate.subject});m.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:r.emailTemplate.message});m.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}m.push({xtype:"box",style:"color: #67948E; margin-bottom:10px",html:translate("emailAddressesAssociatedWithThisClient",true)});if(r.clientEmail){m.push({boxLabel:r.clientEmail+" - ("+r.clientName+")",name:"email",record:{name:r.clientName,email:r.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(o.length==0){m.push({xtype:"box",style:"color: #999; font-size:11px",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(o,function(s){m.push({boxLabel:s.email+" - ("+s.name+" "+s.lastName+")",name:"email",record:s,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}m.push({xtype:"box",style:"color: #67948E; margin-bottom:10px; margin-top:20px",html:translate("youCanAlsoSend",true)+" "+translate("thisPurchaseOrder")+" "+translate("purchaseOrder")+" "+translate("toAParticularEmailOrSendTo")},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var q=Ext.create("AL.view.common.SmileWindow",{reason:"confirmPurchaseOrderEmail",id:"window-purchase-order-send-to-emails",number:k,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,title:translate("send",true)+" "+translate("purchaseOrder")+" "+translate("toTheseEmails"),items:{xtype:"form",items:m,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(s){var u=s.up("window");var t=u.down("button[action=confirmEmail]");if(t){t.fireEvent("click",t)}}}]}});q.show()}else{Ext.Msg.alert("Error",r.cause)}},failure:function(){}})};if(g==="yes"){j()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theEstimate")+" "+translate("estimate")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),forEmail:true,number:k,callback:j,resourceTrigger:"purchaseOrder"})}})}var b=Ext.get("billPurchaseOrder");if(b){b.on("click",function(g,e){g.preventDefault();var f=e.getAttribute("data-warehouseStatus");if(f=="inactive"){GlobalMsg.showNotification({title:"Error",text:translate("thePurchaseOrderCannotActionAsTheWarehouseIsInactive",true,{action:translate("toBill"),thePurhcaseOrder:translate("theF"),purchaseOrder:translate("purchaseOrder"),theWarehouse:translate("theWarehouse"),warehouse:translate("warehouse")}),type:"error"})}else{window.location=e.getAttribute("href")}})}this.control({"window[reason=confirmPurchaseOrderEmail] form button[action=confirmEmail]":{click:function(n){var g=n.up("form");var q=g.up("window");var m=Ext.ComponentQuery.query("window[reason=confirmPurchaseOrderEmail] checkbox[name=email]");var o=g.down("textfield[name=email]");var j=g.down("checkbox[name=sendCopyToUser]");var s=[];var t;if(m){Ext.each(m,function(x){if(x.getValue()){var u=x.record;var v="";if(u.name){v=u.name;if(u.lastName){v=v+" "+u.lastName}}var w={name:v,email:u.email};s.push(w)}})}if(o.getValue()&&o.getValue()!==""){t={name:"",email:o.getValue()};s.push(t)}var k=g.down("htmleditor[name=emailMessage]");var f=g.down("textfield[name=emailSubject]");var h={subject:f.getValue(),message:k.getValue()};var l=[],p,e;Ext.each(s,function(u){l.push(u.email)});l=l.join(",");p=Ext.get("emailPurchaseOrder").getAttribute("data-maxEmailsToSend");e=l.split(/[;,]/).length;if(e>p){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("thePurchaseOrder")+" "+translate("purchaseOrder"),quantity:p}));return}var r={number:q.number,emails:Ext.encode(s),sendCopyToUser:j.getValue(),emailTemplate:Ext.encode(h)};Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/purchase-order/email/format/json",method:"POST",params:r,showSpinner:true,success:function(u,v){var w=Ext.decode(u.responseText);if(w.success){q.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("theF",true)+" "+translate("purchaseOrder")+" "+translate("hasBeenSentsuccessfullyF"),type:"success"});setTimeout(function(){window.location.reload()},1500)}else{Ext.Msg.alert("Error",w.cause)}},failure:function(){}})}},"purchaseOrder_FormAddCategory combo[name=idCostCenter]":{beforerender:function(e){e.hide()}},"purchaseOrder_FormAddCategory groupingcombobox[name=idCategory]":{render:this.setCategoryComboStore,select:function(l,g){var f=g[0];l.selectedRecord=f;var k=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];if(f.get("recordType")=="item"){var j=(f.get("itemLastCost"))?f.get("itemLastCost"):null;if(j){var e=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];if(e.getValue()){j=AL.math.approx(AL.math.div(j,e.getValue()),null,3)}else{j=AL.math.approx(j)}}var k=l.up("form");var h=k.down("textfield[name=price]");h.setValue(j);h.clearInvalid()}},blur:function(e){e.getStore().clearFilter()}},"buttons_SubmitReset button[action=save]":{click:this.savePurchaseOrder},"buttons_SubmitReset button[action=edit]":{click:this.editPurchaseOrder},"purchaseOrder_FormAddCategory button[action=deleteItem]":{click:function(e){e.up("form").destroy();this.updateTotal()}},"purchaseOrder_FormAddCategory textfield[name=price]":{change:this.updateItemTotal},"purchaseOrder_FormAddCategory numberfield[name=quantity]":{change:this.updateItemTotal},"purchaseOrder_FormAddCategory textfield[name=discount]":{change:this.updateItemTotal},purchaseOrder_FormAddPurchaseOrder:{render:this.initialize},"purchaseOrder_FormAddPurchaseOrder combo[name=idWarehouse]":{afterrender:function(g){var f=g.up("form");var e=g.getStore();if(!e.hasLoaded()&&!e.isLoading()){e.load({callback:function(){if(f.type!="edit"){var h=e.findRecord("isMain","yes");if(h){g.select(h)}}}})}}},purchaseOrder_GridAll:{beforerender:function(e){if(e&&e.country=="peru"){e.columns[0].setText(translate("number",true))}}},"purchaseOrder_GridAll gridcolumn[type=purchaseOrderActions]":{click:function(f,g,m,l,n,o){var p=this.application;var k=Ext.get(n.target);var h=f.up("grid").getSelectionModel().getSelection()[0];if(k.hasCls("deletePurchaseOrder")){n.preventDefault();if(h.get("deletable")){p.fireEvent("deletePurchaseOrder",{record:h,initiator:f})}else{Ext.Msg.alert("Error","No se puede eliminar "+translate("purchaseOrders")+" que tienen facturas de compra asociadas")}}else{if(k.hasCls("voidPurchaseOrder")){n.preventDefault();if(h.get("voidable")){p.fireEvent("voidPurchaseOrder",{record:h,initiator:f})}}}}},purchaseOrder_FormAddCategory:{beforerender:function(g){var e=g.down("textarea[name=observations]");var f=g.down("displayfield[name=total]");if(e){e.width=240}if(f){f.width=153}},afterrender:function(h){h.down("textfield[name=discount]").show();if(h.type&&h.type==="edit"){if(h.category){var g=h.category;var f=h.down("textfield[name=price]");var k=h.down("numberfield[name=quantity]");var j=h.down("textfield[name=discount]");var e=h.down("textarea[name=observations]");f.suspendEvents();k.suspendEvents();f.setValue(AL.math.approx(g.priceSecondaryCurrency));k.setValue(g.quantity);e.setValue(g.observations);j.setValue(g.discount);f.resumeEvents();k.resumeEvents();this.updateItemTotal(f,"no")}}}},"purchaseOrder_FormAddPurchaseOrder combo[name=currency]":{change:function(l){var k=l.up("form");var h=k.down("displayfield[name=exchangeCurrencyDisplay]");var g=k.down("hidden[name=exchangeCurrency]");var e=l.getSelectedRecord();var f=this.application;if(e&&e.get("code")&&e.get("code")!=k.configs.currency){h.show();h.setValue("1 "+e.get("code")+" = "+Ext.util.Format.round(e.get("exchangeRate"),8)+" "+k.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');g.setValue(Ext.util.Format.round(e.get("exchangeRate"),8));var j=Ext.get("editExchangeRate");if(j){j.on("click",function(n){n.preventDefault();var m={};m.currency=e.get("code");m.initiator=h;m.currencyRecord=e;f.fireEvent("editExchangeRate",m)})}}else{h.hide();g.setValue(null)}}},"purchaseOrder_FormAddPurchaseOrder hidden[name=exchangeCurrency]":{change:function(l){var g=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");var k=this;var f=l.up("form");var j=f.down("combo[name=currency]");var h=j.getSelectedRecord();if(h.get("code")!=f.configs.currency){f.currencySign=h.get("symbol")}else{f.currencySign=null}var e=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];Ext.each(g,function(p){var q=p.down("combo[name=idCategory]");var n=p.down("textfield[name=price]");var m=q.getSelectedRecord();if(m){var o=(m.get("itemLastCost"))?m.get("itemLastCost"):null;if(o){if(e.getValue()){o=AL.math.approx(AL.math.div(o,e.getValue()),null,3)}else{o=AL.math.approx(o)}n.suspendEvents();n.setValue(o);n.resumeEvents()}k.updateItemTotal(n,"no")}});this.updateTotal()}},"purchaseOrder_FormAddCategory combo[name=idTax]":{render:function(k){var e=k.getStore();var j=k.up("form");var h=this;if(j.type&&j.type==="edit"&&j.category){var g=j.category;var f=function(){k.suspendEvents();if(g.taxStatus==="inactive"){var l=Ext.create("AL.model.Tax",{idLocal:g.idTax,tax:g.tax,name:g.taxName});e.add(l);k.select(l)}else{k.select(g.idTax)}k.resumeEvents();k.fireEvent("taxComboRendered")};if(e.hasLoaded()){f()}else{e.on("load",f)}}if(!e.hasLoaded()&&!e.isLoading()){e.load()}},change:this.updateTotal},})},initialize:function(d){var c=this;var a=Ext.get("addOtherAccount");a.on("click",function(){this.addCategoryForm();var g=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");if(g.length===200){Ext.Msg.show({title:"Límite de "+translate("categories")+"/"+translate("items")+" alcanzado",msg:"Al agregar más "+translate("categories")+" o "+translate("items")+" no podrás imprimir o descargar la "+translate("purchaseOrder")+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var b=d.down("combo[name=currency]");var e=b.getStore();e.load({callback:function(){var g=Ext.create("AL.model.CompanyCurrency",{code:d.configs.currency,name:d.configs.nameCurrency,exchangeRate:1});e.add(g);b.select(d.configs.currency)}});if(d.configs.multicurrency=="yes"){b.show()}if(!d.configs.showWarehouses){d.down("combo[name=idWarehouse]").hide()}if(d.type){var c=this;if(d.type==="edit"){GlobalLoadMask.show("generalContainer");GlobalLoadMask.show("mask-items-loading");var f=d.idLocal;Ext.Ajax.request({url:"/purchase-order/retrieve-info/id/"+f+"/format/json",success:function(g,h){var x=Ext.decode(g.responseText);if(x.success){var C=x.results;var A=C.purchaseOrder;var B=C.categories;var v=d.down("hidden[name=idLocal]");var o=d.down("combo[name=idClient]");var q=d.down("datefield[name=date]");var y=d.down("datefield[name=deliveryDate]");var p=d.down("textarea[name=observations]");var J=d.down("textarea[name=anotation]");var m=d.down("textarea[name=termsConditions]");if(d.configs&&d.configs.resolutionModel&&d.configs.resolutionModel==="new"){var s=d.down("numerationField[name=numerationComponent]");s.values.numerationIdLocal=A.resolutionIdLocal;s.values.prefix=A.prefix;s.values.number=A.number;s.selectNumerationByIdLocal(A.resolutionIdLocal)}d.decimalPrecision=A.decimalPrecision;v.setValue(A.idLocal);var t=o.getStore();var n=Ext.create("AL.model.Client",{idLocal:A.idClient,name:A.name});t.add(n);o.select(n);var F=AL.date(A.date);F=Ext.Date.format(F,"d/m/Y");var z=AL.date(A.deliveryDate);z=Ext.Date.format(z,"d/m/Y");q.setRawValue(F);y.setRawValue(z);p.setValue(A.observations);J.setValue(A.anotation);m.setValue(A.termsConditions);var w=d.down("combo[name=idWarehouse]");if(A.warehouse&&A.warehouse.idLocal){var E=w.getStore();if(!E.hasLoaded()&&!E.isLoading()){E.on("load",function(){var K=Ext.create("AL.model.Warehouse",A.warehouse);E.add(K);w.select(K)})}else{var l=Ext.create("AL.model.Warehouse",A.warehouse);E.add(l);w.select(l)}}if(d.configs.multicurrency=="yes"){var G=d.down("combo[name=currency]");var D=d.down("hidden[name=exchangeCurrency]");var k=G.getStore();G.show();var I=function(){var K=k.findRecord("code",d.configs.currency);if(!K){K=Ext.create("AL.model.CompanyCurrency",{code:d.configs.currency,exchangeRate:1});k.add(K)}var L=null;if(A.currencyCode){L=k.findRecord("code",A.currencyCode);if(L){L.set("exchangeRate",A.exchangeRate)}else{L=Ext.create("AL.model.CompanyCurrency",{exchangeRate:A.exchangeRate,code:A.currencyCode?A.currencyCode:d.configs.currency,symbol:A.currencySymbol});k.add(L)}}if(!L){L=K}G.select(L);D.setValue(A.exchangeRate)};if(k.hasLoaded()){I()}else{k.load({callback:function(){I()}})}}var H=d.down("hidden[name=idLocal]");H.setValue(f);GlobalLoadMask.hide("generalContainer");var j=B.length;var u=1;var r=d.configs.canCreateNewTax;Ext.each(B,function(L){var N=Ext.ComponentQuery.query("#addCategoryPanel")[0];var K=Ext.create("AL.view.purchaseOrder.FormAddCategory",{type:"edit",category:L,canCreateNewTax:r,});K.down("groupingcombobox[name=idCategory]").store=Ext.create("AL.store.CategoriesCombo");N.add(K);var M=K.down("combo[name=idTax]");if(u==j){M.on("taxComboRendered",function(){c.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}u++})}else{}},failure:function(){}})}}},addCategoryForm:function(){var a=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var c=Ext.ComponentQuery.query("#addCategoryPanel")[0];var b=Ext.create("AL.view.purchaseOrder.FormAddCategory",{canCreateNewTax:a.configs.canCreateNewTax,});b.down("groupingcombobox[name=idCategory]").store=Ext.create("AL.store.CategoriesCombo");c.add(b)},setCategoryComboStore:function(c,f){var a=c.up("form");var j=c.getStore();var g=j.getProxy();g.setExtraParam("includeItems","true");g.setExtraParam("type","expense");g.setExtraParam("includeAsset","true");if(a.idItem){Ext.Ajax.request({url:"/item/retrieve-category-item/id/"+a.idItem+"/format/json",success:function(k,m){var n=Ext.decode(k.responseText);if(n.success){var l=n.results;var o=Ext.create("AL.model.CategoryCombo",l);j.add(o);c.selectedRecord=o;c.select(o)}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})}if(a.type&&a.type==="edit"){var b=a.category,e=(b.reference)?b.categoryName+" - "+b.reference:b.categoryName,d=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];if(d.configs.showCategoriesCode=="yes"&&b.categoryCode){e=b.categoryCode+" - "+e}var h=Ext.create("AL.model.CategoryCombo",{idLocal:b.idCategory,text:e,recordType:b.recordType});j.add(h);c.selectedRecord=h;c.select(h)}},updateTotal:function(){var g={};var d=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");var e=0;var m=0;var f=0;var l=0;var n=0;var j=1;var b=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var k=false;if(b&&b.configs.multicurrency=="yes"){var c=b.down("combo[name=currency]");if(c.getValue()&&b.configs.currency!=c.getValue()){k=true;j=b.down("hidden[name=exchangeCurrency]").getValue()}}var h=true;Ext.each(d,function(p){var q=p.down("textfield[name=discount]").isValid();if(q==false){h=false}});if(h){Ext.each(d,function(p){var y=p.down("combo[name=idTax]");var w=y.findRecordByValue(y.getValue());var z=p.down("textfield[name=price]");var v=p.down("numberfield[name=quantity]");var B=p.down("textfield[name=discount]");if(p.type&&p.type==="edit"){if(y.getValue()==="old"){w=y.actualTax}}var r;var s;var q;var u=v.getValue()?v.getValue():0;var A=AL.math.approx(z.getValue(),null,b.decimalPrecision);var t=AL.math.approx(AL.math.mul(A,j),null,b.decimalPrecision);if(B.getValue()){f=AL.math.add(f,AL.math.approx(AL.math.mul(u,AL.math.approx(AL.math.mul(A,AL.math.div(B.getValue(),100)),null,b.decimalPrecision)),null,b.decimalPrecision));r=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(A,AL.math.sub(1,AL.math.div(B.getValue(),100))),null,b.decimalPrecision),u),null,b.decimalPrecision);s=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(t,AL.math.sub(1,AL.math.div(B.getValue(),100))),null,b.decimalPrecision),v.getValue()),null,b.decimalPrecision);q=AL.math.approx(AL.math.mul(A,u),null,b.decimalPrecision)}else{r=AL.math.approx(AL.math.mul(A,u),null,b.decimalPrecision);s=AL.math.approx(AL.math.mul(t,u),null,b.decimalPrecision);q=r}l=AL.math.add(l,q);e=AL.math.add(e,r);if(w){m=AL.math.add(m,AL.math.approx(AL.math.mul(r,AL.math.add(1,AL.math.div(w.get("tax"),100))),null,b.decimalPrecision));n=AL.math.add(n,AL.math.approx(AL.math.mul(s,AL.math.add(1,AL.math.div(w.get("tax"),100))),null,b.decimalPrecision));var x=w.get("name")+w.get("tax");if(g[x]){g[x].value=AL.math.add(g[x].value,AL.math.approx(AL.math.mul(r,AL.math.div(w.get("tax"),100)),null,b.decimalPrecision))}else{g[x]={label:w.get("name")+" ("+Ext.util.Format.round(w.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(r,AL.math.div(w.get("tax"),100)),null,b.decimalPrecision)}}}else{m=AL.math.add(m,r);n=AL.math.add(n,s)}});var a=b&&b.currencySign?b.currencySign:null;var o=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];o.removeAll();o.addItem({label:"Subtotal",value:AL.math.approx(l,null,b.decimalPrecision),important:true,decimalPrecision:b.decimalPrecision,currencySign:a});o.addItem({label:translate("discount",true),value:AL.math.approx(AL.math.mul(f,-1),null,b.decimalPrecision),important:true,decimalPrecision:b.decimalPrecision,currencySign:a});o.addItem({label:"Subtotal",value:AL.math.approx(e,null,b.decimalPrecision),important:true,decimalPrecision:b.decimalPrecision,currencySign:a});Ext.Object.each(g,function(p,q){q.value=AL.math.approx(q.value,null,b.decimalPrecision);q.decimalPrecision=b.decimalPrecision;q.currencySign=a;o.addItem(q)});o.addItem({label:"Total",value:AL.math.approx(m,null,b.decimalPrecision),important:true,decimalPrecision:b.decimalPrecision,currencySign:a});if(k){o.addItem({label:"Total "+b.configs.currency,value:AL.math.approx(n,null,b.decimalPrecision),important:true,decimalPrecision:b.decimalPrecision})}}else{var e=0,g=0,m=0}return{subTotal:e,taxes:g,total:m}},updateItemTotal:function(g,e){if(e!="no"){e="yes"}var b=g.up("form");var h=b.down("textfield[name=price]");var f=b.down("displayfield[name=total]");var d=b.down("numberfield[name=quantity]");var j=b.down("textfield[name=discount]");var c=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var a=c.currencySign?c.currencySign:null;if(h.isValid()&&d.isValid()&&j.isValid()){f.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(h.getValue(),null,c.decimalPrecision),AL.math.sub(1,AL.math.div(j.getValue(),100))),null,c.decimalPrecision),d.getValue()),null,c.decimalPrecision),c.decimalPrecision,a))}else{e="no"}if(e=="yes"){this.updateTotal()}},validateForms:function(){var b=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var g=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");var a=true;if(b.getForm().isValid()){var j=b.down("combo[name=idClient]");if(!j.getSelectedRecord()){a=false;j.markInvalid("Debes seleccionar el proveedor, no solo escribir su "+translate("name"))}if(g.length===0){a=false}else{var f=0;Ext.each(g,function(m){var k=m.down("groupingcombobox[name=idCategory]");if(k.getSelectedRecord()){f++;var l=m.getForm();if(!l.isValid()){a=false}}});if(f==0){a=false;g[0].down("groupingcombobox[name=idCategory]").markInvalid(["Debes seleccionar al menos una "+translate("category")+" para asociar a la","factura de proveedor"].join(" "))}}var c=b.down("datefield[name=date]");var e=b.down("datefield[name=deliveryDate]");var d=new Date(c.getValue());var h=new Date(e.getValue());if(d>h){a=false;e.markInvalid("La fecha de entrega debe ser mayor que la fecha de la orden")}}else{a=false}return a},savePurchaseOrder:function(e){var d=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");if(this.validateForms()){GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("purchaseOrder")});var a=e.up("form");var j=a.query("button");Ext.each(j,function(o){o.disable()});var g=[];var l=[];Ext.each(d,function(r){var p=r.down("groupingcombo");var o=p.selectedRecord;var q=r.getForm().getValues();if(!q.idTax||q.idTax==0){delete q.idTax}if(o){if(o.get("recordType")==="item"){q.idLocal=q.idCategory;delete q.idCategory;l.push(q)}else{if(o.get("recordType")==="category"){g.push(q)}}}});var c=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var m=c.getValues();m.categories=Ext.encode(g);m.items=Ext.encode(l);var h=Ext.get("new-comment");if(h&&h.getValue()){var f=h.getValue();m.comment=Ext.encode(f)}var b=c.down("hidden[name=exchangeCurrency]");if(b&&b.getValue()){m.exchangeRate=b.getValue()}if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var n=c.down("numerationField[name=numerationComponent]");var k=n.getSelectedNumeration();m.idResolution=k.idLocal}Ext.Ajax.request({url:"/purchase-order/add/format/json",method:"POST",params:m,success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){var r=q.results;if(e.createAnother){window.location="/purchase-order/add"}else{window.location="/purchase-order/view/id/"+r}}else{Ext.each(j,function(s){s.enable();GlobalRedirector.close()})}},failure:function(){Ext.each(j,function(o){o.enable()});GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                               Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},editPurchaseOrder:function(e){var d=Ext.ComponentQuery.query("purchaseOrder_FormAddCategory");if(this.validateForms()){GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("purchaseOrder")});var a=e.up("form");var g=a.query("button");Ext.each(g,function(m){m.disable()});var f=[];var j=[];Ext.each(d,function(r){var n=r.down("groupingcombo");var m=n.selectedRecord;var o=r.getForm().getValues();if(o.idCategory==="old"){o.idCategory=o.oldIdCategory;o.categoryName=o.oldCategoryName;delete o.oldCategoryName}else{delete o.oldCategoryName}if(o.idTax==="old"){var p=r.down("combo[name=idTax]");var q=p.actualTax;if(q.get("currentId")){o.idTax=q.get("currentId");o.taxName=q.get("name");o.tax=q.get("tax")}else{delete o.idTax}o.taxName=q.get("name");o.tax=q.get("tax")}else{if(!o.idTax||o.idTax==0){delete o.idTax}}if(m){if(m.get("recordType")==="item"){o.idLocal=o.idCategory;delete o.idCategory;j.push(o)}else{if(m.get("recordType")==="category"){f.push(o)}}}});var c=Ext.ComponentQuery.query("purchaseOrder_FormAddPurchaseOrder")[0];var k=c.getValues();if(k.idClient==="old"){k.idClient=k.oldIdClient}else{delete k.oldClientName;delete k.oldIdClient}k.categories=Ext.encode(f);k.items=Ext.encode(j);var b=c.down("hidden[name=exchangeCurrency]");if(b&&b.getValue()){k.exchangeRate=b.getValue()}if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var l=c.down("numerationField[name=numerationComponent]");var h=l.getSelectedNumeration();k.idResolution=h.idLocal}Ext.Ajax.request({url:"/purchase-order/edit/format/json",method:"POST",params:k,success:function(m,n){var o=Ext.decode(m.responseText);if(o.success){var p=o.results;window.location="/purchase-order/view/id/"+p}else{Ext.each(g,function(q){q.enable();GlobalRedirector.close()})}},failure:function(){Ext.each(g,function(m){m.enable()});GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},showSpinner:function(b,c){if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}}});Ext.define("AL.view.recurringpayment.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.recurringpayment_FormAddCategory"});Ext.define("AL.controller.RecurringPayment",{extend:"Ext.app.Controller",views:["recurringpayment.FormAdd","recurringpayment.GridAll","recurringpayment.RecurringPaymentToolbar","recurringpayment.FormAddCategory"],stores:["RecurringPayments","CategoriesCombo","Accounts","Clients","Taxes","CompanyCurrenciesCombo"],models:["RecurringPayment","CategoryCombo","Account","Client","Tax","CompanyCurrency"],init:function(){this.application.addListener("clientCreated",function(d){var c=d.initiator;var a=d.record;var b=c.getStore();b.add(a);c.select(a.get("idLocal"))},this);this.application.addListener("taxCreated",function(c){var d=c.initiator;var a=c.record;var b=d.getStore();b.add(a);d.select(a.get("idLocal"))},this);this.application.addListener("deleteRecurringPayment",function(c){var a=c.record;var b=c.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("recurringPayment")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theM")+" "+translate("recurringPayment")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(d){if(d=="yes"){Ext.Ajax.request({url:"/recurring-payment/delete/format/json",method:"POST",params:{id:a.get("idLocal")},success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=b.getStore();e.load()}else{if(h.cause){Ext.MessageBox.alert("Error",h.cause)}}},failure:function(){}})}}})},this);this.control({"buttons_SubmitReset button[action=saveRecurringPayment]":{click:this.saveRecurringPayment},"buttons_SubmitReset button[action=editRecurringPayment]":{click:this.editRecurringPayment},"recurringpayment_FormAdd combo[name=idClient]":{render:function(a){a.getStore().addListener("beforeload",function(){})}},recurringpayment_FormAdd:{render:this.initialize},"recurringpayment_FormAdd groupingcombobox[name=idAccount]":{render:function(b){var a=b.getStore();if(!a.hasLoaded()&&!a.isLoading()){a.load()}},change:function(d){var j=this;var h=d.getSelectedRecord();var b=d.up("form");var g=b.companyCurrencies;var c=b.down("combo[name=currency]");var k=c.getStore();Ext.each(g,function(l){if(!k.findRecord("code",l.get("code"))){k.add(l)}});if(h&&h.get("currencyCode")){var a=h.get("currencyCode");k.each(function(l){if(l&&l.get("code")!=a&&l.get("code")!=b.configs.currency){k.remove(l)}});var f=k.findRecord("code",b.configs.currency);if(!b.edit){if(f){c.select(f)}j.currencyComboChanged(c,"no")}else{var e=c.getSelectedRecord();if(!e){c.select(f)}j.currencyComboChanged(c,"no")}}else{if(h){j.currencyComboChanged(c,"no")}}}},recurringpayment_GridAll:{beforerender:function(a){if(a&&a.country=="peru"){a.columns[0].setText(translate("number",true))}},itemdblclick:this.goPaymentDetails},"recurringpayment_FormAddCategory groupingcombobox[name=idCategory]":{render:this.setCategoryComboStore},"recurringpayment_RecurringPaymentToolbar button[action=addRecurringPayment]":{click:function(){window.location="/recurring-payment/add"}},recurringpayment_FormAddCategory:{afterrender:function(d){if(d.type&&d.type==="edit"){if(d.category){var c=d.category;var b=d.down("textfield[name=price]");var e=d.down("numberfield[name=quantity]");var a=d.down("textarea[name=observations]");b.setValue(c.price);e.setValue(c.quantity);a.setValue(c.observations)}}}},"recurringpayment_FormAddCategory button[action=deleteItem]":{click:function(a){a.up("form").destroy();this.updateTotal()}},"recurringpayment_FormAddCategory textfield[name=price]":{change:this.updateItemTotal},"recurringpayment_FormAddCategory numberfield[name=quantity]":{change:this.updateItemTotal},"recurringpayment_FormAddCategory combo[name=idTax]":{change:this.updateItemTotal,render:function(e){var d=this;var c=e.up("form");var a=e.getStore();if(c.type&&c.type==="edit"){var b=c.category;if(a.hasLoaded()){e.select(b.idTax);d.updateTotal()}else{a.on("load",function(){e.select(b.idTax);d.updateTotal()})}}if(!a.hasLoaded()&&!a.isLoading()){a.load()}}},"recurringpayment_GridAll gridcolumn[type=recurringPaymentActions]":{click:function(a,b,g,f,h,k){var l=this.application;var d=Ext.get(h.target);var c=a.up("grid").getSelectionModel().getSelection()[0];if(d.hasCls("deleteRecurringPayment")){h.preventDefault();l.fireEvent("deleteRecurringPayment",{record:c,initiator:a})}}},"recurringpayment_FormAdd combo[name=currency]":{change:function(a){this.currencyComboChanged(a)}}})},saveRecurringPayment:function(d){if(this.validateForms()){d.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("recurringPayment")});var f=Ext.ComponentQuery.query("recurringpayment_FormAddCategory");var b=[];Ext.each(f,function(l){var j=l.down("groupingcombo");var h=j.findRecordByValue(j.getValue());var k=l.getForm().getValues();if(!k.idTax||k.idTax==0){delete k.idTax}if(h){b.push(k)}});var e=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var a=e.getValues();a.categories=Ext.encode(b);if(e.configs&&e.configs.resolutionModel&&e.configs.resolutionModel==="new"){var g=e.down("numerationField[name=numerationComponent]");var c=g.getSelectedNumeration();a.idResolution=c.idLocal}Ext.Ajax.request({url:"/recurring-payment/add/format/json",method:"POST",params:a,success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){var l=k.results;window.location="/recurring-payment/view/id/"+l}else{GlobalMsg.showErrorMessage("Error",k.cause);d.enable();GlobalRedirector.close()}},failure:function(){d.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                                Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},editRecurringPayment:function(d){if(this.validateForms()){d.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("recurringPayment")});var f=Ext.ComponentQuery.query("recurringpayment_FormAddCategory");var b=[];Ext.each(f,function(j){var h=j.getForm().getValues();if(!h.idTax||h.idTax===0){delete h.idTax}b.push(h)});var e=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var a=e.getValues();a.categories=Ext.encode(b);a.idLocal=e.idLocal;if(e.configs&&e.configs.resolutionModel&&e.configs.resolutionModel==="new"){var g=e.down("numerationField[name=numerationComponent]");var c=g.getSelectedNumeration();a.idResolution=c.idLocal}Ext.Ajax.request({url:"/recurring-payment/edit/format/json",method:"POST",params:a,success:function(h,j){var k=Ext.decode(h.responseText);if(k.success){var l=k.results;window.location="/recurring-payment/view/id/"+l}else{GlobalMsg.showErrorMessage("Error",k.cause);d.enable();GlobalRedirector.close()}},failure:function(){d.enable();GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},goPaymentDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/recurring-payment/view/id/"+h},initialize:function(c){var a=Ext.get("addOtherAccount");a.on("click",this.addCategoryForm);var b=c.down("combo[name=currency]");var d=b.getStore();d.load({callback:function(){var e=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});d.add(e);b.select(c.configs.currency);c.companyCurrencies=d.getRange(0,d.getCount())}});if(c.configs.multicurrency=="yes"){b.show()}if(c.type&&c.type==="edit"){Ext.Ajax.request({url:"/recurring-payment/retrieve-info/id/"+c.idLocal+"/format/json",success:function(e,f){var r=Ext.decode(e.responseText);if(r.success){var v=r.results;var q=v.recurringPayment;var u=v.categories;var g=c.down("combo[name=idAccount]");var m=c.down("combo[name=idClient]");var w=c.down("datefield[name=startDate]");var x=c.down("datefield[name=endDate]");var t=c.down("numberfield[name=repeatEvery]");var n=c.down("textarea[name=observations]");if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var p=c.down("numerationField[name=numerationComponent]");p.values.numerationIdLocal=q.idResolution;p.selectNumerationByIdLocal(q.idResolution)}c.decimalPrecision=q.decimalPrecision;var j=Ext.create("AL.model.Account",{idLocal:q.idAccount,name:q.accountName,typeName:q.typeName});g.suspendEvents();g.select(j);g.suspendEvents();if(q.idClient){var l=Ext.create("AL.model.Client",{idLocal:q.idClient,name:q.name});m.select(l)}var k=AL.date(q.startDate);k=Ext.Date.format(k,"d/m/Y");w.setValue(k);if(q.endDate){var y=AL.date(q.endDate);y=Ext.Date.format(y,"d/m/Y");x.setValue(y)}t.setValue(q.repeatEvery);n.setValue(q.observations);if(!q.datesEditable){w.disable();x.disable();t.disable()}if(c.configs.multicurrency=="yes"){var z=c.down("combo[name=currency]");var h=z.getStore();z.show();var A=function(){var B=h.findRecord("code",c.configs.currency);if(!B){B=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,exchangeRate:1});h.add(B);c.companyCurrencies=h.getRange(0,h.getCount())}var C=null;if(q.currencyCode){C=h.findRecord("code",q.currencyCode);if(!C){C=Ext.create("AL.model.CompanyCurrency",{code:q.currencyCode,symbol:q.currencySymbol});h.add(C)}}if(!C){C=B}z.select(C)};if(h.hasLoaded()){A()}else{h.load({callback:function(){A()}})}}var s=Ext.ComponentQuery.query("#addCategoryPanel")[0];var o=c.configs.canCreateNewTax;Ext.each(u,function(C){var B=Ext.create("AL.view.recurringpayment.FormAddCategory",{type:"edit",category:C,canCreateNewTax:o});s.add(B)})}else{}},failure:function(){}})}},addCategoryForm:function(){var a=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var c=Ext.ComponentQuery.query("#addCategoryPanel")[0];var b=Ext.create("AL.view.recurringpayment.FormAddCategory",{canCreateNewTax:a.configs.canCreateNewTax});c.add(b)},setCategoryComboStore:function(f,c){var e=f.up("form");var a=Ext.create("AL.store.CategoriesCombo");f.store=a;if(e.type&&e.type==="edit"){var d=e.category,g=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0],b=d.categoryName;if(g.configs.showCategoriesCode&&d.categoryCode){b=d.categoryCode+" - "+b}var h=Ext.create("AL.model.CategoryCombo",{idLocal:d.idCategory,text:b,recordType:d.recordType});a.add(h);f.selectedRecord=h;f.select(h);this.updateTotal()}},updateTotal:function(){var a={};var h=Ext.ComponentQuery.query("recurringpayment_FormAddCategory");var d=0;var c=0;var g=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var e=g.currencySign?g.currencySign:null;Ext.each(h,function(j){var m=j.down("combo[name=idTax]");var l=j.down("textfield[name=price]");var o=j.down("numberfield[name=quantity]");var k=m.findRecordByValue(m.getValue());var n=AL.math.approx(AL.math.mul(AL.math.approx(l.getValue(),null,g.decimalPrecision),o.getValue()),null,g.decimalPrecision);d=AL.math.add(d,n);if(j.type&&j.type==="edit"){if(m.getValue()==="old"){k=m.actualTax}}if(k){c=AL.math.add(c,AL.math.approx(AL.math.mul(n,AL.math.add(1,AL.math.div(k.get("tax"),100))),null,g.decimalPrecision));if(a[k.get("name")]){a[k.get("name")].value=AL.math.add(a[k.get("name")].value,AL.math.approx(AL.math.mul(n,AL.math.div(k.get("tax"),100)),null,g.decimalPrecision))}else{a[k.get("name")]={fieldLabel:k.get("name")+" ("+Ext.util.Format.round(k.get("tax"),2)+"%)",name:k.get("name"),tax:k.get("tax"),xtype:"displayfield",width:250,labelSeparator:"",labelAlign:"right",style:"text-align: right",fieldBodyCls:"totalAligned",labelPad:20,labelWidth:150,value:AL.math.approx(AL.math.mul(n,AL.math.div(k.get("tax"),100)),null,g.decimalPrecision)}}}else{c=AL.math.add(c,n)}});var f=Ext.ComponentQuery.query("#totalForm")[0];f.destroy();var b=Ext.create("Ext.form.Panel",{border:false,width:340,bodyPadding:20,style:"border: 1px solid #ccc;",bodyStyle:"background: #f1f1f1",id:"totalForm",renderTo:"totalContainer"});b.add({fieldLabel:"Subtotal",name:"subtotal",xtype:"displayfield",labelAlign:"right",style:"text-align: right",labelPad:20,fieldBodyCls:"totalAligned",width:250,labelWidth:150,labelSeparator:"",labelStyle:"font-weight: bold",currencySign:e,value:Ext.util.Format.usMoney(d,g.decimalPrecision,e)});Ext.Object.each(a,function(j,k){k.value=Ext.util.Format.usMoney(AL.math.approx(k.value,null,g.decimalPrecision),g.decimalPrecision,e);b.add(k)});b.add({fieldLabel:"Total",name:"total",xtype:"displayfield",labelAlign:"right",labelPad:20,labelWidth:150,labelSeparator:"",fieldBodyCls:"totalAligned",labelStyle:"font-weight: bold",style:"text-align: right",currencySign:e,value:Ext.util.Format.usMoney(AL.math.approx(c,null,g.decimalPrecision),g.decimalPrecision,e),width:250})},updateItemTotal:function(j,f,d,g){var c=j.up("form");var k=c.down("textfield[name=price]");var h=c.down("displayfield[name=total]");var e=c.down("numberfield[name=quantity]");var b=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var a=b.currencySign?b.currencySign:null;if(k.isValid()&&e.isValid()){h.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(k.getValue(),null,b.decimalPrecision),e.getValue()),null,b.decimalPrecision),b.decimalPrecision,a))}else{h.setValue(Ext.util.Format.usMoney(0,b.decimalPrecision,a))}this.updateTotal()},validateForms:function(){var d=Ext.ComponentQuery.query("recurringpayment_FormAdd")[0];var c=d.getForm();var b=Ext.ComponentQuery.query("recurringpayment_FormAddCategory");var a=true;if(c.isValid()){var e=d.down("[name=idAccount]");if(!e.getSelectedRecord()){a=false;e.markInvalid("El banco asociado al pago recurrente es obligatorio")}if(a){if(b.length===0){a=false}else{Ext.each(b,function(g){var f=g.getForm();if(!f.isValid()){a=false}})}}}else{a=false}return a},currencyComboChanged:function(d){var b=d.up("form");var j=b.down("displayfield[name=exchangeCurrencyDisplay]");var e=d.getSelectedRecord();var g=b.down("combo[name=idAccount]").getSelectedRecord();if((e&&e.get("code")&&e.get("code")!=b.configs.currency)||(g&&g.get("currencyCode")&&g.get("currencyCode")!=e.get("code"))){j.show()}else{j.hide()}var h=Ext.ComponentQuery.query("recurringpayment_FormAddCategory");var f=this;var c=b.down("combo[name=currency]");var a=c.getSelectedRecord();if(a.get("code")!=b.configs.currency){b.currencySign=a.get("symbol")}else{b.currencySign=null}Ext.each(h,function(l){var k=l.down("textfield[name=price]");f.updateItemTotal(k,"no")});this.updateTotal()}});Ext.define("AL.view.transaction.FormAddCategory",{extend:"AL.view.common.FormAddCategory",alias:"widget.transaction_FormAddCategory"});Ext.define("AL.view.common.FormAddItem",{extend:"Ext.form.Panel",alias:"widget.common_FormAddItem",requires:["Ext.layout.component.BoundList","Ext.toolbar.Paging","AL.plugin.SimplePaging"],bodyPadding:"18 5 10 5",border:false,style:"border-bottom: 1px solid #eee; padding-top: 0px;",layout:"hbox",defaults:{anchor:"100%",msgTarget:"side"},canCreateNewTax:"no",canCreateNewItem:false,getComboDependentFields:function(){var a=[];a.push(this.down("textfield[name=reference]"));a.push(this.down("textfield[name=price]"));a.push(this.down("textfield[name=discount]"));a.push(this.down("combo[name=idTax]"));a.push(this.down("textarea[name=description]"));a.push(this.down("numberfield[name=quantity]"));return a},enableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.enable()})},disableFields:function(){var a=this.getComboDependentFields();Ext.each(a,function(b){b.disable()})},disableDeleteButton:function(){if(this.disabledDeleteButton==true){this.down("button[action=deleteItem]").hide()}else{if(this.styleDeleteButton){var a=this.down("button[action=deleteItem]");a.style+=" left: 830px"}}},getFieldValuesAsMetadata:function(){var c=null;var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"mexico":var b=this.down("textfield[name=importRequest]");if(!b.isDisabled()&&b.getValue()&&b.getValue()!=""){c={importRequest:b.getValue()}}break;case"costaRica":var d=this.down("textfield[name=discount]");if(d.discount){c={discountNature:d.discount.discountNature}}break}return c},setFieldValuesFromMetadata:function(c){var a=this.configs&&this.configs.country?this.configs.country:null;switch(a){case"mexico":if(c&&c.importRequest){var d=this.down("combo[name=idLocal]");var b=this.down("textfield[name=importRequest]");if(c.importRequest!=""){b.setValue(c.importRequest);b.show();b.enable()}}break;case"costaRica":if(typeof c.discountNature!=="undefined"){var e=this.down("textfield[name=discount]");if(e.discount){e.discount.discountNature=c.discountNature}}break}},listeners:{beforerender:function(a){a.disableDeleteButton();var b=this.down("combo[name=idLocal]");b.on("change",function(e,c,d){if(!e.getSelectedRecord()){e.up("form").disableFields()}})},afterrender:function(b){var g=this.down("combo[name=idLocal]");var c=g.store;var e=g.getPicker();if(e.pagingToolbar.items.keys){var j=e.pagingToolbar.items.keys;for(var d=0;d<j.length;d++){if(j[d]=="next"||j[d]=="refresh"||j[d]=="displayItem"){continue}if(e.pagingToolbar.down("#"+j[d])){e.pagingToolbar.down("#"+j[d]).hide()}}}var f=e.pagingToolbar.down("#displayItem"),a=e.pagingToolbar.down("#next"),h=e.pagingToolbar.down("#refresh");if(h){h.addCls("combo-item-btn-refresh");h.on("click",function(k){c.clearOnPageLoad=false;if(c.proxy){c.proxy.forceRequest=true}})}if(a){a.addCls("combo-item-btn-next");a.on("click",function(k){c.clearOnPageLoad=false;if(c.proxy){c.proxy.forceRequest=false}})}if(f){f.addCls("combo-item-display-msg")}c.on("load",function(m,l,n){if(f){var k=m.getTotalCount();var q=1;var p=Math.min(m.currentPage*c.pageSize,k);var o=Ext.String.format(translate("showing",true)+" {0} - {1} "+translate("of")+" {2}",q,p,k);f.setText(o)}c.clearOnPageLoad=true})},render:function(){if(this.multipleTaxes=="yes"){var a=this.down("combo[name=idTax]");a.multiSelect=true;var b="";if(this.canCreateNewTax=="yes"){b='<div><a href="#" data-action="quickNewTax" class="createNewTax">'+translate("newTax",true)+"</a></div>"}a.listConfig.tpl='<tpl for="."><tpl if="values.disabled==true"><div class="x-boundlist-item checkbox-item-disabled"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div><tpl else><div class="x-boundlist-item"><span class="checkbox"></span>{name} - ({[AL.math.approx(values.tax,null,  2)]}%)</div></tpl></tpl>'+b}}},defaultType:"textfield",items:[{xtype:"hidden",name:"oldId"},{xtype:"hidden",name:"itemName"},{xtype:"hidden",name:"idRemission"},{xtype:"displayfield",name:"mxXmlItemName",hidden:true,width:252},{xtype:"fieldcontainer",layout:"anchor",defaultType:"textfield",items:[{xtype:"combo",name:"idLocal",allowBlank:false,emptyText:translate("searchBillableItem",true),displayField:"name",valueField:"idLocal",width:250,matchFieldWidth:false,triggerCls:"x-form-search-trigger",queryMode:"remote",triggerAction:"query",typeAhead:true,minChars:0,pageSize:10,forceSelection:true,listConfig:{width:250,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list",tpl:'<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl>'},},{xtype:"textfield",name:"importRequest",hidden:true,allowBlank:true,emptyText:translate("importRequest"),disabled:true,width:250,maskRe:/[0-9 ]+/,regex:/\d{2}\s{2}\d{2}\s{2}\d{4}\s{2}\d{7}/,maxLength:21,regexText:"El formato del pedimento no es el correcto.",msgTarget:"side",enableKeyEvents:true,listeners:{keyup:function(a,c,b){if(c.getKey()!==8&&c.getKey()!==46){lengthsArray=[2,6,12];if(lengthsArray.indexOf(a.getValue().length)>=0){newValue=a.getValue()+"  ";a.setValue(newValue)}}},keydown:function(b,d,c){if(d.getKey()===32){allowedLengthsToUseSpaceArray=[2,3,6,7,11,12];if(allowedLengthsToUseSpaceArray.indexOf(b.getValue().length)<0){d.stopEvent()}}if(d.getKey()!==8&&d.getKey()!==46){var a=d.getKey();if((a>=48&&a<=57)||(a>=96&&a<=105||(a==32))){if((b.getValue().length+1)>21){d.stopEvent()}}}}}},]},{name:"reference",allowBlank:true,emptyText:translate("reference",true),width:80,cls:"itemInput"},{name:"price",allowBlank:false,emptyText:translate("unitPrice",true),regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),msgTarget:"side",width:100,cls:"itemInput",listeners:{render:function(b){var a=this.up("form");if(a.type!="xml"){b.reset()}}}},{xtype:"textfield",name:"discount",width:40,cls:"itemInput",regex:/^([0-9]+(\.[0-9]+)?)$/,regexText:translate("onlyNumericalValuesWithDecimalSeparator",true),emptyText:"%",allowBlank:true,msgTarget:"side"},{xtype:"combo",name:"idTax",allowBlank:false,emptyText:translate("tax",true),store:"Taxes",displayField:"name",valueField:"idLocal",width:80,cls:"itemInput",forceSelection:true,matchFieldWidth:false,queryMode:"local",displayTpl:'<tpl for=".">{name} - ({[AL.math.approx(values.tax, null, 2)]}%)</tpl>',listConfig:{width:200,height:200,border:true,tpl:'<tpl for="."><div class="x-boundlist-item">{name} - ({[AL.math.approx(values.tax, null,2)]}%)</div></tpl>'},editable:false},{xtype:"textarea",name:"description",allowBlank:true,emptyText:translate("description",true),cls:"itemInput",width:140},{xtype:"numberfield",name:"quantity",allowBlank:false,emptyText:translate("quantity",true),cls:"itemInput",minValue:0,width:50,msgTarget:"side"},{xtype:"displayfield",allowBlank:true,cls:"itemInput",name:"total",value:"0.00",width:75,style:"text-align: right",fieldBodyCls:"totalAligned"},{xtype:"button",action:"deleteItem",width:16,height:16,style:"margin-left: 40px",baseCls:"none"}]});Ext.define("AL.view.creditnote.FormAddItem",{extend:"AL.view.common.FormAddItem",alias:"widget.creditnote_FormAddItem"});Ext.define("AL.controller.CreditNote",{extend:"Ext.app.Controller",views:["creditnote.AddVoidCause","creditnote.FormAddCreditNote","creditnote.FormAddItem","creditnote.CreditNoteToolbar","creditnote.GridAll","invoice.WindowReactiveSat","creditnote.FormAssociations","creditnote.FormAddInvoice","creditnote.FormAddRefund","creditnote.FormAdvancedOptions","creditnote.MoreActionsButton","ux.fields.Numeration","ux.form.Switch","item.FormEditDiscount",],stores:["CreditNotes","Clients","Items","ItemsCreditNote","Taxes","Accounts","PriceListCombo","DocumentPaymentMethods","CompanyCurrenciesCombo","WarehouseCombo","CreditNoteTypes","VoidCauses","CreditNoteTypesMx","SaleConditions","SalesConcepts","PaymentForm","PaymentMethods","EconomicActivities","CostCentersCombo",],models:["CreditNote","Client","Item","ItemCreditNote","Tax","Account","PriceList","CompanyCurrency","Warehouse","CountryLegalParameter","CostCenter",],errorAlertDisplayed:false,init:function(){this.application.addListener("clientCreated",function(g){var f=g.initiator;var d=g.record;var e=f.getStore();e.add(d);f.select(d.get("idLocal"))},this);this.application.addListener("itemCreated",function(e){var j=e.initiator;var f=e.record;var g=j.getStore();var d=f.multipleTaxes=="yes"?Ext.decode(f.get("idTax")):[f.get("idTax")];var h=[];Ext.each(d,function(k){h.push({id:k})});f.set("taxes",h);g.add(f);g.getProxy().clearCacheByTerms([f.get("name"),f.get("reference")]);j.select(f.get("idLocal"))},this);this.application.addListener("deleteCreditNote",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("creditNote")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theF")+" "+translate("creditNote")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,width:500,fn:function(g){if(g=="yes"){Ext.Ajax.request({url:"/credit-note/delete/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){var h=e.getStore();h.load()}else{if(l.cause){Ext.MessageBox.alert("Error",l.cause)}}},failure:function(){}})}}})},this);this.application.addListener("voidCreditNote",function(f){var d=f.record;var e=f.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("creditNote"),msg:translate("areYouSureYouWantTo",true)+" "+translate("cancel")+" "+translate("theF")+" "+translate("creditNote")+" "+d.get("creditNoteNumber")+"?.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(j){if(j=="yes"){if(["peru"].indexOf(e.up("grid").country)!==-1){var h=Ext.create("AL.view.creditnote.AddVoidCause",{voidAction:true,documentType:"credit-note",documentId:d.get("idLocal"),country:e.up("grid").country,success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){h.destroy();var k=e.getStore();k.load();if(n.stamp===true){GlobalMsg.showNotification({title:translate("success",true),text:"La "+translate("creditNote")+" ha sido "+translate("canceledFemale")+", se enviará en el comunicado de bajas a las 11:50pm",type:"success"})}}else{Ext.MessageBox.alert("Error",n.cause)}}})}else{var g=Ext.create("AL.LoadMask",{target:e,msg:translate("loading",true)});g.show();g.addDependantTask();Ext.Ajax.request({url:"/credit-note/void/format/json",method:"POST",params:{id:d.get("idLocal")},success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){var k=e.getStore();k.load();GlobalMsg.showNotification({title:translate("success",true),text:translate("theDocumentHasBeenActionSuccessfully",true,{the:translate("theF"),document:translate("creditNote"),action:translate("canceledFemale")}),type:"success"})}else{Ext.MessageBox.alert("Error",n.cause)}g.endDependantTask()},failure:function(){g.endDependantTask()}})}}}})},this);var a=this;var c=Ext.get("emailCreditNote");if(c){c.on("click",function(e,d){a.sendByEmail(d,"original")})}this.application.addListener("hiddenExchangeRateChanged",function(d){var h=Ext.ComponentQuery.query("creditnote_FormAddRefund");var e=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var f=e.down("combo[name=currency]");var g=f.getSelectedRecord();d=d?d:1;Ext.each(h,function(m){var n=m.down("displayfield[name=currencyDisplay]");var l=m.down("textfield[name=amount]");var o=m.down("combo[name=idAccount]");var k=o.getSelectedRecord();if(!n.hidden&&n.getValue()&&l.getValue()){if(l.getValue()&&k&&g&&!k.get("currencyCode")&&g.get("code")!=e.configs.currency){n.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(l.getValue(),null,2),d),null,2),2))}else{var j=g?g.get("symbol"):null;if(k&&k.get("currencyCode")){j=k.get("currencySymbol")}n.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(l.getValue(),null,2),d),null,2),2,j))}}})},this);var b=Ext.get("stampCreditNote");if(b){b.on("click",function(f,d){a.stampCreditNote(d,f)})}this.control({creditnote_MoreActionsButton:{beforerender:function(e){var d=this;e.menu.down("menuitem[action=email]").on("click",function(g,f){d.sendByEmail(g,"copy")})}},buttons_SubmitReset:{afterrender:function(d){if(d.configs&&(d.configs.country==="mexico"||a.getCountriesWithStamp().indexOf(d.configs.country)!==-1)&&d.configs.isActiveElectronicInvoicing){d.down("button[action=save]").hide();d.add({xtype:"splitbutton",text:translate("save",true)+" "+translate("and")+" "+translate("stamp"),action:"save",cls:"sm-button-primary",style:"margin-left: 20px;",width:157,height:38,id:"saveCreditNoteButton",menu:new Ext.menu.Menu({action:"saveCreditNote",items:[{text:translate("saveWithout",true)+" "+translate("stamp"),action:"save",afterSave:"noStampInvoice"}]})})}}},"buttons_SubmitReset menu[action=saveCreditNote]":{click:function(e,d){this.saveCreditNote(d)}},"buttons_SubmitReset button[action=edit]":{click:this.editCreditNote},"buttons_SubmitReset button[action=save]":{click:this.saveCreditNote},creditnote_FormAddCreditNote:{render:this.initialize,beforerender:function(d){d.executeActionsBeforeRender();if(d.configs&&["costaRica","colombia"].indexOf(d.configs.country)!==-1){var e=d.down("textarea[name=emissionCause]");e.fieldLabel="Razón"}if(d.configs&&d.configs.country==="colombia"&&d.configs.electronicInvoicingVersion=="2.1"){var e=d.down("textarea[name=emissionCause]");e.show()}},afterrender:function(f){var e=Ext.get("advancedOptionsLink");if(e){e.on("click",function(h){h.preventDefault();var g=Ext.ComponentQuery.query("creditnote_FormAdvancedOptions")[0];if(g.hidden){g.show()}else{g.hide()}})}var d=f.down("combo[name=currency]");if(f.configs.notEditableCurrency){d.getSubmitData=this.getSubmitDataDisabled;d.disable()}}},"creditnote_FormAddCreditNote combo[name=idClient]":{select:function(l,f,h){var k=Ext.ComponentQuery.query("creditnote_FormAssociations #invoiceContainer")[0];k.removeAll(true);var e=f[0],d=Ext.ComponentQuery.query("combo[name=idPriceList]")[0],g=d.getStore();if(e.get("idPriceList")){this.loadPriceListStore(d,e.get("idPriceList"))}else{var j=g.findRecord("main","yes");d.select(j)}}},"creditnote_FormAddCreditNote [name=resolutionCombo]":{change:function(o,e,d,n){var f=o.up("form");if(f.configs){switch(f.configs.country){case"peru":case"argentina":var m=Ext.ComponentQuery.query("creditnote_FormAssociations #invoiceContainer")[0];var j=false;m.items.each(function(q){var r=q.down("[name=number]");var p=r.getStore();if(p&&p.isLoading()){j=true;return false}});if(!j){m.removeAll(true)}if(f.type=="edit"){return}var l=o.getSelectedRecord();if(!l){return}var h=Ext.ComponentQuery.query("buttons_SubmitReset")[0];var g=h.down("splitbutton[action=save]");var k=h.down("button[action=save]");if(!h||!k){return}if(g){g.hide()}k.show();if(l.get("isElectronicResolution")===true){k.afterSave="";k.setText(translate("saveStamp",true))}else{k.afterSave="noStampInvoice";k.setText(translate("saveWithout",true)+" "+translate("stamp"))}break}}}},"creditnote_FormAddCreditNote [name=affectedDocumentType]":{change:function(j){var e=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var g=Ext.ComponentQuery.query("creditnote_FormAssociations #invoiceContainer")[0];var f=e.down("[name=numerationComponent]");if(!e||!f){return}var d="creditNote";if(g){var h=false;g.items.each(function(l){var m=l.down("[name=number]");var k=m.getStore();if(k&&k.isLoading()){h=true;return false}});if(!h){g.removeAll(true)}}if(j.value=="saleTicket"){d="creditNoteSaleTicket"}if(d=="creditNote"){if(e.configs&&e.configs.creditNoteResolutionModel){e.configs.resolutionModel=e.configs.creditNoteResolutionModel}}else{if(e.configs&&e.configs.creditNoteResolutionModel){e.configs.resolutionModel=e.configs.creditNoteSaleTicketResolutionModel}}f.setDocumentType(d)}},"creditnote_FormAddItem combo[name=idLocal]":{beforerender:function(e){var d=e.up("form");if(d.canCreateNewItem){e.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl><div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newM",true)+" "+translate("item")+"</a></div>"}},select:this.getItem,render:function(e){var d=Ext.create("AL.store.ItemsCombo");e.store=d}},"creditnote_CreditNoteToolbar button[action=addCreditNote]":{click:function(){window.location="/credit-note/add"}},"creditnote_FormAddItem button[action=deleteItem]":{click:function(d){d.up("form").destroy();this.updateTotal()}},"creditnote_FormAddItem textfield[name=price]":{change:this.updateItemTotal},"creditnote_FormAddItem textfield[name=discount]":{change:this.updateItemTotal},creditnote_FormAddItem:{afterrender:function(e){var h=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var k=false;if(h.configs){var k=h.configs.country==="costaRica"}if(k){var m=e.down("textfield[name=discount]");var n=function(){var s=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!s){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:m}})}};m.getEl().on("click",n);m.getEl().on("focusin",n)}if(e.type&&e.type==="edit"){var f=e.itemSold;var l=Ext.create("AL.model.Item",f);var g=e.down("combo[name=idLocal]");var q=e.down("textfield[name=reference]");var o=e.down("textfield[name=price]");var r=e.down("textfield[name=discount]");var d=e.down("textarea[name=description]");var j=e.down("numberfield[name=quantity]");var p=g.getStore();p.add(l);g.select(l);o.suspendEvents();r.suspendEvents();j.suspendEvents();o.setValue(AL.math.approx(f.priceSecondaryCurrency));q.setValue(f.reference);r.setValue(e.itemSold.discount);if(k){r.discount={discount:f.discount}}if(f.metadata){if(!e.configs){e.configs=h.configs}e.configs.country=h.configs.country;e.setFieldValuesFromMetadata(f.metadata)}d.setValue(f.description);j.setValue(e.itemSold.quantity);o.resumeEvents();r.resumeEvents();j.resumeEvents();this.updateItemTotal(o,"no")}}},"creditnote_FormAddCreditNote combo[name=idWarehouse]":{change:function(l,k,h){var e=l.up("form");l.previousValue=h;if(e.configs.costCenter.isActive&&l.canChangeCostCenter){var d=l.getSelectedRecord();var f=e.down("combo[name=idCostCenter]");if(d){var j=d.get("idCostCenter");if(f&&j){f.setValue(j);var g=f.getSelectedRecord();if(!g){a.loadCostCenterRecord(j,f)}else{f.fireEvent("select",f)}f.setReadOnly(true);f.addCls("combo-noedit-full-border")}else{if(f&&f.previousValue){f.setValue(f.previousValue);f.setReadOnly(false);f.removeCls("combo-noedit-full-border");f.fireEvent("select",f)}else{if(f){f.setValue(null);f.setReadOnly(false);f.removeCls("combo-noedit-full-border");f.fireEvent("select",f)}}}}else{if(f&&f.previousValue){f.setValue(f.previousValue);f.setReadOnly(false);f.removeCls("combo-noedit-full-border");f.fireEvent("select",f)}else{f.setValue(null);f.setReadOnly(false);f.removeCls("combo-noedit-full-border");f.fireEvent("select",f)}}}l.canChangeCostCenter=true},select:function(e){var d=e.up("form");if(d.configs.costCenter.isActive){e.selectedValue=true}},afterrender:function(f){var e=f.up("form");f.canChangeCostCenter=false;var d=f.getStore();if(!d.hasLoaded()&&!d.isLoading()){d.load({callback:function(){if(e.type!="edit"){var g=d.findRecord("isMain","yes");if(g){f.select(g);if(e.configs.costCenter.isActive){var h=e.down("combo[name=idCostCenter]");var j=g.get("idCostCenter");if(h&&j){h.setValue(j);var g=h.getSelectedRecord();if(!g){a.loadCostCenterRecord(j,h)}else{h.fireEvent("select",h)}h.previousSelected=true;h.setReadOnly(true);h.addCls("combo-noedit-full-border")}}}}}})}}},"creditnote_FormAddItem combo[name=idTax]":{render:function(h){var g=this;var d=h.getStore();var f=h.up("form");if(f.type&&f.type==="edit"){var e=f.itemSold;if(d.hasLoaded()){h.suspendEvents();h.select(e.idTax);h.resumeEvents();h.fireEvent("taxComboRendered")}else{d.on("load",function(){h.suspendEvents();h.select(e.idTax);h.resumeEvents();h.fireEvent("taxComboRendered")})}}if(!d.hasLoaded()&&!d.isLoading()){d.load()}},change:this.updateTotal,beforeselect:function(f,d,e){if(f.multiSelect==true){if(d.get("idLocal")===0||(f.getValue()&&f.getValue()[0]===0)){f.getStore().each(function(g){if(g.get("idLocal")!==0){g.set("disabled",true)}});f.setValue("[0]")}return d.get("disabled")?false:true}},beforedeselect:function(f,d,e){if(f.multiSelect==true){if(d.get("idLocal")===0){f.getStore().each(function(g){if(g.get("idLocal")!==0){g.set("disabled",false)}})}}}},"creditnote_FormAddItem numberfield[name=quantity]":{change:this.updateItemTotal},"creditnote_FormAddCreditNote combo[name=idCostCenter]":{change:function(f,e,d){f.previousValue=d},blur:function(e){var d=e.getSelectedRecord();if(!d&&e.getValue()!=null){e.markInvalid(translate("costCenterErrorCombo",true))}},beforerender:function(f){var e=f.up("form");f.previousSelected=false;if(e.configs.costCenter.isActive){f.show()}else{f.hide();return}var d=f.getStore();if(!d.hasLoaded()&&!d.isLoading()){d.load()}},select:function(h){var f=h.up("form");var d=Ext.ComponentQuery.query("creditnote_FormAddInvoice");if(d.length>0){var e=this;var g=Ext.create("AL.view.common.SmileWindow",{id:"confirm-window-deactivate-cost-centers",title:translate("costCenter",true),width:600,modal:true,items:[{xtype:"box",cls:"modal-subtitle",style:"margin: 0 13px 0px 13px; position: relative; text-align: justify; line-height: 18px;",html:"<div>"+translate("costCenterCreditNoteChange",true)+"</div>"}],footer:{items:[{text:translate("btnCancel",true),cls:"button",handler:function(k){g.close();var j=f.down("combo[name=idWarehouse]");h.suspendEvents();if(!isNaN(h.previousValue)){h.setValue(h.previousValue)}else{h.setValue(null)}if(j&&(j.selectedValue||j.idCostCenter!=null)){if(!isNaN(j.previousValue)){j.setValue(j.previousValue);delete j.previousValue}}h.resumeEvents()}},{text:translate("buttonOk",true),cls:"button main-button",handler:function(l){Ext.each(d,function(n){var m=n.down("button[action=deleteInvoice]");if(m){m.fireEvent("click",m)}});g.close();if(h.getValue()!==null){var k=h.getStore();var j=k.findRecord("idLocal",h.getValue());if(!j){this.loadCostCenterRecord(h.getValue(),h)}else{h.select(j)}}}}]}});g.show()}h.previousSelected=true}},creditnote_GridAll:{itemdblclick:this.goCreditNoteDetails,render:this.setRightClickEvent},"creditnote_GridAll gridcolumn[type=creditNoteActions]":{click:function(d,f,l,k,m,n){var o=this.application;var h=Ext.get(m.target);var g=d.up("grid").getSelectionModel().getSelection()[0];if(h.hasCls("deleteCreditNote")){m.preventDefault();if(g.get("deletable")){o.fireEvent("deleteCreditNote",{record:g,initiator:d})}else{var p=translate("youCantRemoveDocumentThatHaveMoneyBack",true,{document:translate("creditNotes")});if(["mexico","peru"].indexOf(d.up("grid").country)!==-1){p=p+translate("orThatHaveBeenStamped",false,{stamped:translate("stampedCreditNotes")})}GlobalMsg.showNotification({title:"Recuerda",text:p,type:"notice"})}}else{if(h.hasCls("voidCreditNote")){m.preventDefault();if(g.get("voidable")){o.fireEvent("voidCreditNote",{record:g,initiator:d})}else{switch(d.up("grid").country){case"mexico":GlobalMsg.showNotification({title:"Recuerda",text:"Solo puedes "+translate("cancel")+" "+translate("creditNotes")+" que han sido timbradas.",type:"notice"});break;case"peru":var p="Solo puedes "+translate("cancel")+" "+translate("creditNotes")+" "+translate("stampedCreditNotes")+" hace 7 días o menos y que no estén publicadas. ";if(d.up("grid").isActiveElectronicInvoicing===false){p+="Para "+translate("cancel")+" "+translate("creditNotes")+" "+translate("stampedCreditNotes")+' activa facturación electrónica <a href="company/edit">aquí</a>'}GlobalMsg.showNotification({title:"Recuerda",text:p,type:"notice"});break}}}}}},creditnote_FormAssociations:{addAnotherInvoice:function(w){var n=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var e=n.down("[name=affectedDocumentType]");var m=e.getValue();var f=n.down("combo[name=idClient]");var s=n.down("combo[name=currency]");var t=s.getSelectedRecord();var j=t?t.get("code"):n.configs.currency;var y=Ext.ComponentQuery.query("#invoiceContainer")[0];if(f.getValue()){var p=f.getValue();var g=Ext.create("AL.view.creditnote.FormAddInvoice");var u=g.down("combo[name=number]");var v="";if(n.configs.costCenter.isActive){var x=n.down("combo[name=idCostCenter]");if(x&&x.previousSelected){v="/idCostCenter/"+x.getValue()}}var o="/invoice/retrieve-open-by-client/idClient/"+p+"/includeElectronicInvoicingVersion/true/currency/"+j+"/checkCurrency/yes/invoiceType/"+m+v+"/format/json";if(n.configs&&n.configs.country=="argentina"){var l=n.down("numerationField[name=numerationComponent]");if(l){var r=l.getSelectedNumeration();if(r&&r.metadata){switch(r.metadata.subDocumentType){case"CREDIT_NOTE_A":o+="/subInvoiceType/INVOICE_A";break;case"CREDIT_NOTE_B":o+="/subInvoiceType/INVOICE_B";break;case"CREDIT_NOTE_C":o+="/subInvoiceType/INVOICE_C";break}}}}var q={autoLoad:false,pageSize:20,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",url:o,reader:{type:"json",root:"results"}}};if(n.configs&&n.configs.country=="peru"){var h=n.down("[name=resolutionCombo]");var d=h.getSelectedRecord();if(d.get("isElectronicResolution")===true){q.filters=[{property:"hasStamp",value:"yes"}]}else{q.filters=[{property:"hasStamp",value:"no"}]}}var k=Ext.create("AL.store.Invoices",q);u.store=k;u.emptyText=translate("search",true);u.editable=true;u.triggerCls="x-form-search-trigger";u.queryMode="remote";u.typeAhead=true;u.forceSelection=true;u.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">','{invoiceNumber} <tpl if="values.electronicInvoicingVersion">('+translate("version",true)+" {electronicInvoicingVersion})</tpl>","</tpl>");u.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{invoiceNumber}<tpl if="values.electronicInvoicingVersion"> ('+translate("version",true)+" {electronicInvoicingVersion})</tpl></div></tpl>",width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"};y.add(g)}else{Ext.MessageBox.alert("Error",translate("youMustFirstChooseThe",true)+" "+translate("clientA"))}},addAnotherRefund:function(e){var f=Ext.ComponentQuery.query("#refundContainer")[0];var d=Ext.create("AL.view.creditnote.FormAddRefund");f.add(d)}},"creditnote_FormAddInvoice button[action=deleteInvoice]":{click:function(d){d.up("form").destroy();this.updateTotal()}},"creditnote_FormAddRefund button[action=deleteRefund]":{click:function(j){j.up("form").destroy();var k=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var h=k.down("hidden[name=exchangeCurrency]");if(h.getValue()){var l=Ext.ComponentQuery.query("creditnote_FormAddRefund");var e=false;Ext.each(l,function(n){var m=n.down("groupingcombobox[name=idAccount]");if(m.getSelectedRecord()&&m.getSelectedRecord().get("currencyCode")){e=true}});var f=k.down("combo[name=currency]");var d=f.getSelectedRecord();if(!e&&d.get("code")==k.configs.currency){h.setValue(null);var g=k.down("displayfield[name=exchangeCurrencyDisplay]");g.hide();g.setValue(null)}}}},creditnote_FormAddRefund:{render:function(h){var k=h.down("groupingcombobox[name=idAccount]");var e=k.getStore();var g=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(!e.hasLoaded()){e.load({callback:function(){g.accounts=e.getRange(0,e.getCount());var l=g.down("combo[name=currency]"),m=l.getSelectedRecord();if(m&&m.get("code")&&m.get("code")!=g.configs.currency){e.each(function(n){if(n&&n.get("currencyCode")&&m.get("code")!=n.get("currencyCode")){e.remove(n)}})}}})}else{var d=g.down("combo[name=currency]");var j=d.getSelectedRecord();if(j&&j.get("code")){var f=g.accounts;e.removeAll();e.loadData(f);if(j.get("code")!=g.configs.currency){e.each(function(l){if(l&&l.get("currencyCode")&&j.get("code")!=l.get("currencyCode")){e.remove(l)}})}}}}},"creditnote_FormAddRefund combo[name=idAccount]":{change:function(j){var o=this.application;if(this.validateAccountRefund(j)){var e=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var h=e.down("combo[name=currency]");var q=j.getSelectedRecord();var d=h.getSelectedRecord();var k=j.up("form");var f=k.down("textfield[name=amount]");var m=k.down("displayfield[name=currencyDisplay]");var n=e.down("hidden[name=exchangeCurrency]");var s=e.down("displayfield[name=exchangeCurrencyDisplay]");if(q&&d&&q.get("currencyCode")&&d.get("code")){var p=h.getStore();var g=p.findRecord("code",q.get("currencyCode"));s.show();s.setValue("1 "+g.get("code")+" = "+Ext.util.Format.round(g.get("exchangeRate"),8)+" "+e.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');n.suspendEvents();n.setValue(Ext.util.Format.round(g.get("exchangeRate"),8));n.resumeEvents();var l=Ext.get("editExchangeRate");if(l){l.on("click",function(v){v.preventDefault();var u={};u.currency=g.get("code");u.initiator=s;u.currencyCode=g.get("code");u.fireChangeEvent=true;o.fireEvent("editExchangeRate",u)})}}if(f.getValue()&&q&&d&&q.get("currencyCode")){if(q.get("currencyCode")!=d.get("code")){if(q.get("currencyCode")&&q.get("currencyCode")!=e.configs.currency){m.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(f.getValue(),null,2),n.getValue()),null,2),2,q.get("currencySymbol")));m.setFieldLabel(q.get("currencyCode"))}m.show()}else{m.hide();f.setFieldLabel(null)}}else{m.hide();f.setFieldLabel(null);if(f.getValue()&&q&&d.get("code")&&!q.get("currencyCode")&&d.get("code")!=e.configs.currency){m.show();m.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(f.getValue(),null,2),n.getValue()),null,2),2));m.setFieldLabel(e.configs.currency)}}if(q&&d&&q.get("currencyCode")!=d.get("code")){if(q.get("currencyCode")){f.setFieldLabel(d.get("code"))}else{if(!q.get("currencyCode")&&d.get("code")==e.configs.currency){f.setFieldLabel(null);var t=Ext.ComponentQuery.query("creditnote_FormAddRefund");var r=false;Ext.each(t,function(v){var u=v.down("groupingcombobox[name=idAccount]");if(u.getSelectedRecord()&&u.getSelectedRecord().get("currencyCode")){r=true}});if(!r){s.setValue(null);s.hide();n.suspendEvents();n.setValue(null);n.resumeEvents()}}else{f.setFieldLabel(d.get("code"))}}}else{f.setFieldLabel(null)}}}},"creditnote_FormAddRefund textfield[name=amount]":{change:function(k,f){var e=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var g=e.down("combo[name=currency]");var h=k.up("form");var l=h.down("combo[name=idAccount]");var n=l.getSelectedRecord();var d=g.getSelectedRecord();if(n&&d&&n.get("currencyCode")!=d.get("code")){var m=e.down("hidden[name=exchangeCurrency]");var j=h.down("displayfield[name=currencyDisplay]");if(n.get("currencyCode")&&n.get("currencyCode")!=e.configs.currency){j.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.div(AL.math.approx(f,null,2),m.getValue()),null,2),2,n.get("currencySymbol")));j.setFieldLabel(n.get("currencyCode"));j.show()}else{if(!n.get("currencyCode")&&d.get("code")!=e.configs.currency){j.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(f,null,2),m.getValue()),null,2),2));j.setFieldLabel(e.configs.currency);j.show()}}}}},"creditnote_FormAddInvoice combo[name=number]":{select:this.invoiceSelected,select2:function(d){this.invoiceSelected(d.combo,[d.record])}},"creditnote_FormAddCreditNote combo[name=idPriceList]":{change:function(f){var d=Ext.ComponentQuery.query("creditnote_FormAddItem");var e=this;Ext.each(d,function(j){var k=j.down("combo[name=idLocal]");var h=j.down("textfield[name=price]");var g=k.getSelectedRecord();if(g){h.suspendEvents();e.getPrice(g,h);h.resumeEvents();e.updateItemTotal(h,"no")}});this.updateTotal()},afterrender:function(e){var d=e.getStore();d.load({callback:function(){var f=d.findRecord("main","yes");e.suspendEvents();e.select(f);e.resumeEvents()}})}},"window[reason=confirmCreditNoteEmail] form button[action=confirmEmail]":{click:function(m){var f=m.up("form");var p=f.up("window");var l=Ext.ComponentQuery.query("window[reason=confirmCreditNoteEmail] checkbox[name=email]");var n=f.down("textfield[name=email]");var h=f.down("checkbox[name=sendCopyToUser]");var s=[];var q=m.type||"original";var t;if(l){Ext.each(l,function(x){if(x.getValue()){var u=x.record;var v="";if(u.name){v=u.name;if(u.lastName){v=v+" "+u.lastName}}var w={name:v,email:u.email};s.push(w)}})}if(n.getValue()&&n.getValue()!==""){t={name:"",email:n.getValue()};s.push(t)}var j=f.down("htmleditor[name=emailMessage]");var e=f.down("textfield[name=emailSubject]");var g={subject:e.getValue(),message:j.getValue()};var k=[],o,d;Ext.each(s,function(u){k.push(u.email)});k=k.join(",");o=Ext.get("emailCreditNote").getAttribute("data-maxEmailsToSend");d=k.split(/[;,]/).length;if(d>o){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("theCreditNote")+" "+translate("creditNote"),quantity:o}));return}var r={number:p.number,emails:Ext.encode(s),sendCopyToUser:h.getValue(),emailTemplate:Ext.encode(g),type:q};Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/credit-note/email/format/json",method:"POST",params:r,showSpinner:true,success:function(u,v){var w=Ext.decode(u.responseText);if(w.success){p.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("theF",true)+" "+translate("creditNote")+" "+translate("hasBeenSentsuccessfullyF"),type:"success"});setTimeout(function(){window.location.reload()},1500)}else{Ext.Msg.alert("Error",w.cause)}},failure:function(){}})}},"creditnote_FormAddCreditNote hidden[name=exchangeCurrency]":{change:function(j){var d=Ext.ComponentQuery.query("creditnote_FormAddItem");var h=this;var f=j.up("form");var g=f.down("combo[name=currency]");var e=g.getSelectedRecord();if(e.get("code")!=f.configs.currency){f.currencySign=e.get("symbol")}else{f.currencySign=null}Ext.each(d,function(m){var n=m.down("combo[name=idLocal]");var l=m.down("textfield[name=price]");var k=n.getSelectedRecord();if(k){l.suspendEvents();h.getPrice(k,l,"no");l.resumeEvents();h.updateItemTotal(l,"no")}});this.updateTotal()}},"creditnote_FormAddCreditNote combo[name=currency]":{change:function(h,e,d){var f=h.up("form");var p=f.down("displayfield[name=exchangeCurrencyDisplay]");var n=f.down("hidden[name=exchangeCurrency]"),g=n.getValue();var l=h.getSelectedRecord();var o=this.application;if(l.get("code")&&l.get("code")!=f.configs.currency){p.show();p.setValue(" 1 "+l.get("code")+" = "+Ext.util.Format.round(l.get("exchangeRate"),8)+" "+f.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');n.setValue(Ext.util.Format.round(l.get("exchangeRate"),8));if(g==n.getValue()&&e!=d){n.fireEvent("change",h,g,g)}var j=Ext.get("editExchangeRate");if(j){j.on("click",function(r){r.preventDefault();var q={};q.currency=l.get("code");q.initiator=p;q.currencyRecord=l;o.fireEvent("editExchangeRate",q)})}}else{p.hide();n.setValue(null)}var m=Ext.ComponentQuery.query("creditnote_FormAddRefund");Ext.each(m,function(q){q.destroy()});var k=Ext.ComponentQuery.query("creditnote_FormAddInvoice");Ext.each(k,function(q){q.destroy()})}},"creditnote_FormAddCreditNote combo[name=saleCondition]":{change:function(f,e){var d=f.up("form");var g=d.down("datefield[name=dueDate]");if(d.configs&&d.configs.country==="costaRica"){if(e==="CREDIT"){g.show();g.allowBlank=false}else{g.hide();g.allowBlank=true;g.reset()}}},render:function(f){var d=f.up("form");var g=d.down("datefield[name=dueDate]");var e=f.getValue();if(e==="CREDIT"){g.show();g.allowBlank=false}else{g.hide();g.allowBlank=true;g.reset()}}},"creditnote_FormAddCreditNote combo[name=paymentForm]":{change:function(f,e){var d=f.up("form");var g=d.down("datefield[name=dueDate]");if(d.configs&&d.configs.country==="chile"){if(e===2){g.show();g.allowBlank=false}else{g.hide();g.allowBlank=true;g.reset()}}},render:function(f){var d=f.up("form");var g=d.down("datefield[name=dueDate]");var e=f.getValue();if(e===2){g.show();g.allowBlank=false}else{g.hide();g.allowBlank=true;g.reset()}}},"creditnote_FormAddCreditNote datefield[name=date]":{change:function(h,f){var e=h.up("form");if(e.configs&&["costaRica","argentina","chile"].indexOf(e.configs.country)!==-1){var g=e.down("datefield[name=dueDate]");var d=new Date(f);g.setMinValue(d)}}},"creditnote_FormAddCreditNote combo[name=saleConcept]":{change:function(k,g){var f=k.up("form");var d=Ext.ComponentQuery.query("creditnote_FormAddItem");var j="/item/retrieve-all/format/json";var e=f.down("datefield[name=startDateService]"),h=f.down("datefield[name=endDateService]");switch(g){case"PRODUCTS":j="/item/retrieve-all/format/json/type/products";e.hide();e.allowBlank=true;h.hide();h.allowBlank=true;break;case"SERVICES":j="/item/retrieve-all/format/json/type/services";e.show();e.allowBlank=false;h.show();h.allowBlank=false;break;default:e.show();e.allowBlank=false;h.show();h.allowBlank=false;break}Ext.each(d,function(o){var n=o.down("combo[name=idLocal]");var m=n.getStore();var l=m.getProxy();if(l.url!=j){l.url=j;l.clearCache();m.load()}})}}})},saveCreditNote:function(f){var q=true;var b=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(b.configs&&!b.configs.isActiveElectronicInvoicing){q=false}if(f.afterSave){switch(f.afterSave){case"noStampInvoice":q=false;break}}if(this.validateForms(q)){f.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("creditNote")});var h=Ext.getCmp("addItemPanel").items.getRange();var c=Ext.ComponentQuery.query("creditnote_FormAddInvoice");var r=Ext.ComponentQuery.query("creditnote_FormAddRefund");var o=[];Ext.each(h,function(u){if(u.getForm){var s=u.getForm().getValues();if(!s.idTax||s.idTax==0){delete s.idTax}if(s.discount===""){s.discount=0}if(!u.configs){u.configs=b.configs}u.configs.country=b.configs.country;var t=u.getFieldValuesAsMetadata();if(t){s.metadata=Ext.encode(t)}o.push(s)}});var l=[];Ext.each(c,function(s){l.push(s.getValues())});var d=[];Ext.each(r,function(s){d.push(s.getValues())});var n=b.getValues();var e=b.down("[name=affectedDocumentType]");n.affectedDocumentType=e.getValue();n.items=Ext.encode(o);n.invoices=Ext.encode(l);n.refunds=Ext.encode(d);var j=Ext.get("new-comment");if(j&&j.getValue()){var g=j.getValue();n.comment=Ext.encode(g)}if(b.configs&&b.configs.resolutionModel&&b.configs.resolutionModel=="new"){var p=b.down("numerationField[name=numerationComponent]");var m=p.getSelectedNumeration();n.idResolution=m.idLocal}if(q===false){n.noStampInvoice="no"}var a=b.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){n.exchangeRate=a.getValue()}var k=b.getFieldValuesAsMetadata();if(k){n.metadata=Ext.encode(k)}if(!this.validateCostCenter(b,n)){f.enable();GlobalRedirector.close();this.showMessageCostCenterError(b,f);return}Ext.Ajax.request({url:"/credit-note/add/format/json",method:"POST",params:n,success:function(s,t){var u=Ext.decode(s.responseText);if(u.success){var v=u.results;window.location="/credit-note/view/id/"+v}else{f.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",u.cause)}},failure:function(){f.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                               Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{if(!this.errorAlertDisplayed){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},editCreditNote:function(g){if(this.validateForms()){g.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("creditNote")});var h=Ext.getCmp("addItemPanel").items.getRange();var d=Ext.ComponentQuery.query("creditnote_FormAddInvoice");var p=Ext.ComponentQuery.query("creditnote_FormAddRefund");var n=[];var b=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];Ext.each(h,function(u){if(u.getForm){var q=u.getForm().getValues();if(q.idLocal==="old"){q.idLocal=q.oldId}else{delete q.itemName}if(q.idTax==="old"){var s=u.down("combo[name=idTax]");var t=s.actualTax;if(t.get("currentId")){q.idTax=t.get("currentId");q.taxName=t.get("name");q.tax=t.get("tax")}else{delete q.idTax}q.taxName=t.get("name");q.tax=t.get("tax")}else{if(!q.idTax||q.idTax==0){delete q.idTax}}if(!u.configs){u.configs=b.configs}u.configs.country=b.configs.country;var r=u.getFieldValuesAsMetadata();if(r){q.metadata=Ext.encode(r)}delete q.oldId;n.push(q)}});var k=[];Ext.each(d,function(q){k.push(q.getValues())});var e=[];Ext.each(p,function(q){e.push(q.getValues())});var c=b.down("combo[name=idCostCenter]");if(b.configs.costCenter.isActive&&c&&!c.allowEdit){c.enable()}var m=b.getValues();m.items=Ext.encode(n);m.invoices=Ext.encode(k);m.refunds=Ext.encode(e);var f=b.down("[name=affectedDocumentType]");m.affectedDocumentType=f.getValue();var a=b.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){m.exchangeRate=a.getValue()}if(b.configs&&b.configs.resolutionModel&&b.configs.resolutionModel=="new"){var o=b.down("numerationField[name=numerationComponent]");var l=o.getSelectedNumeration();m.idResolution=l.idLocal}var j=b.getFieldValuesAsMetadata();if(j){m.metadata=Ext.encode(j)}if(!this.validateCostCenter(b,m)){g.enable();GlobalRedirector.close();this.showMessageCostCenterError(b,g);return}Ext.Ajax.request({url:"/credit-note/edit/format/json",method:"POST",params:m,success:function(q,r){var s=Ext.decode(q.responseText);if(s.success){var t=s.results;window.location="/credit-note/view/id/"+t}else{g.enable();if(c&&!c.allowEdit){c.setReadOnly(true);c.addCls("combo-noedit-full-border")}GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",s.cause)}},failure:function(){g.enable();GlobalRedirector.close();if(c&&!c.allowEdit){c.setReadOnly(true);c.addCls("combo-noedit-full-border")}}})}else{if(!this.errorAlertDisplayed){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},invoiceSelected:function(r,l){var c=l[0];var a=r.up("form");if(this.validateDifferentInvoices(r,true)){var e=a.down("displayfield[name=date]");var k=a.down("displayfield[name=dueDate]");var d=a.down("displayfield[name=observations]");var j=a.down("displayfield[name=total]");var n=a.down("displayfield[name=totalPayed]");var m=a.down("displayfield[name=missingAmount]");var b=a.down("textfield[name=amount]");var q=new Date(c.get("date"));q=Ext.Date.format(q,"d/m/Y");var p=new Date(c.get("dueDate"));p=Ext.Date.format(p,"d/m/Y");e.setValue(q);k.setValue(p);d.setValue(c.get("observations"));j.setValue(Ext.util.Format.usMoney(c.get("total"),c.get("decimalPrecision"),c.get("currencySymbol")));n.setValue(Ext.util.Format.usMoney(c.get("totalPayed"),c.get("decimalPrecision"),c.get("currencySymbol")));m.setValue(Ext.util.Format.usMoney(c.get("missingAmount"),c.get("decimalPrecision"),c.get("currencySymbol")));var f=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];if(f.configs&&this.getCountriesWithStamp().indexOf(f.configs.country)!==-1){if(c.get("blockedAssociations")){b.disable();b.notAllowedText="No puedes asociar "+translate("invoices")+" en proceso de certificación"}else{b.notAllowedText=null;var h=f.down("combo[name=creditNoteType]");var o=this.getVoidTypes(f.configs.country);if(o.indexOf(h.getValue())!==-1){b.setValue(c.get("total"))}}}if(!c.get("blockedAssociations")){b.enable()}b.focus(false,true);if(f.configs.costCenter.isActive){var g=c.get("idCostCenter");var s=f.down("combo[name=idCostCenter]");if(s&&g!=""&&g!=null){storeCostCenter=s.getStore();if(!storeCostCenter.hasLoaded()&&!storeCostCenter.isLoading()){this.loadCostCenterRecord(g,s)}else{var c=storeCostCenter.findRecord("idLocal",g);if(!c){this.loadCostCenterRecord(g,s)}else{s.select(c)}}}s.previousSelected=true}}},initialize:function(c){var h=this;var f=c.down("[name=affectedDocumentType]");var k=c.configs&&c.configs.regime==="NEW_RUS"?"saleTicket":"invoice";f.setValue(k,true);var n=Ext.get("addOtherItem");n.on("click",function(){this.addItemForm();var o=Ext.ComponentQuery.query("creditnote_FormAddItem");if(o.length===200){Ext.Msg.show({title:"Límite de "+translate("items")+" alcanzado",msg:"Al agregar más "+translate("items")+" no podrás imprimir o descargar la "+translate("creditNote")+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var j=c.down("combo[name=currency]");var l=j.getStore();l.load({callback:function(){var o=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});l.add(o);j.select(c.configs.currency)}});if(c.configs.multicurrency=="yes"){j.show()}if(!c.configs.showWarehouses){c.down("combo[name=idWarehouse]").hide()}switch(c.configs.country){case"peru":var e=c.down("[name=affectedDocumentType]");if(c.configs.regime==="NEW_RUS"){e.hide()}else{e.show()}break;case"costaRica":var a=c.down("combo[name=economicActivity]");if(a&&c.configs.company&&c.configs.company.economicActivity){var m=a.getStore();if(m.hasLoaded()){a.setValue(c.configs.company.economicActivity)}else{m.on("load",function(){a.setValue(c.configs.company.economicActivity)})}}break;case"chile":var a=c.down("combo[name=economicActivity]");if(a&&c.configs.company&&c.configs.company.economicActivity){var m=a.getStore();if(m.hasLoaded()){a.setValue(c.configs.company.economicActivity)}else{m.on("load",function(){a.setValue(c.configs.company.economicActivity)})}}break}if(c.configs.country==="mexico"&&c.configs.stampVersion=="3.3"){var g=c.down("combo[name=mx_creditNoteType]");g.allowBlank=false;g.show()}if(c.configs.country==="costaRica"&&c.configs.isActiveElectronicInvoicing===true){var d=c.down("datefield[name=date]");var b=new Date();d.setMaxValue(AL.date(b));d.maxText="La fecha para la "+translate("creditNote")+" con "+translate("electronicNumeration")+" debe ser inferior o igual a {0}."}if(c.type==="edit"||c.idInvoice){GlobalLoadMask.show("mask-items-loading");GlobalLoadMask.show("generalContainer")}if(c.type&&c.type==="edit"){Ext.Ajax.request({url:"/credit-note/retrieve-info/id/"+c.idLocal+"/format/json",success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){h.populateForm(c,q.results)}},failure:function(){}})}else{if(c.idInvoice){Ext.Ajax.request({url:"/invoice/retrieve-info/id/"+c.idInvoice+"/invoiceCurrency/true/includeHasStamp/true/format/json",success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){if(c.configs.country=="mexico"&&q.results.invoice.documentType=="saleTicket"){GlobalLoadMask.hide("mask-items-loading");GlobalLoadMask.hide("generalContainer");return}h.populateForm(c,q.results)}},failure:function(){}})}}},addItemForm:function(){var b=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var c=Ext.create("AL.view.creditnote.FormAddItem",{canCreateNewTax:b.configs.canCreateNewTax,canCreateNewWarehouse:b.configs.canCreateNewWarehouse,canCreateNewItem:b.configs.canCreateNewItem,multipleTaxes:b.configs.multipleTaxes,});a.add(c)},getItem:function(d,e,k,l){var j=e[0];var c=d.up("form");var o=c.down("textfield[name=reference]");var n=c.down("textfield[name=price]");var p=c.down("textfield[name=discount]");var a=c.down("textarea[name=description]");var h=c.down("numberfield[name=quantity]");var b=c.down("textfield[name=idTax]");var g=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];h.suspendEvents();p.suspendEvents();n.suspendEvents();b.suspendEvents();o.setValue(j.get("reference"));p.setValue(0);a.setValue(j.get("description"));h.setValue(1);var m=function(){if(!j.get("idTax")||j.get("idTax")=="null"){return b.select(0)}var r=[];var q=j.get("taxes");Ext.each(q,function(t){if(t.status==="inactive"){if(c&&c.type==="edit"&&c.itemSold&&c.itemSold.idTax==j.get("idTax")){var s=Ext.create("AL.model.Tax",{idLocal:"old",tax:t.tax,name:t.taxName});s.set("currentId",t.idTax);b.actualTax=s;r.push(t.idTax)}else{b.select(0)}}else{r.push(t.id)}});if(r.length>0){b.setValue(r)}};if(b.getStore().isLoading()){b.getStore().on("load",m)}else{m()}if(g.configs.country==="mexico"){var f=c.down("textfield[name=importRequest]");if(j.get("canUseImportRequest")&&j.get("canUseImportRequest")==="yes"){f.show();f.enable()}else{f.hide();f.disable()}}this.getPrice(j,n);h.resumeEvents();n.resumeEvents();p.resumeEvents();b.resumeEvents();this.updateItemTotal(n);d.up("form").enableFields()},getPrice:function(c,k,e){var f=c.get("priceList");var d=c.get("price");var a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var h=a.down("combo[name=idPriceList]");var g=null;var b=a.down("combo[name=currency]");var j=b.getSelectedRecord();if(j&&j.get("code")!=a.configs.currency){g=a.down("hidden[name=exchangeCurrency]").getValue()}if(e=="no"){if(g){d=AL.math.approx(AL.math.div(d,g),null,3)}k.setValue(d)}else{if(!f){Ext.Ajax.request({url:"/item/retrieve-price-list/format/json/id/"+c.get("idLocal"),success:function(l,n){var o=Ext.decode(l.responseText);var m=o.results;var p=m;c.set("priceList",p);if(p[h.getValue()]){d=p[h.getValue()];if(g){d=AL.math.approx(AL.math.div(d,g),null,3)}else{d=AL.math.approx(d)}k.setValue(d)}else{if(g){d=AL.math.approx(AL.math.div(d,g),null,3)}else{d=AL.math.approx(d)}k.setValue(d)}}})}else{if(f[h.getValue()]){d=f[h.getValue()];if(g){d=AL.math.approx(AL.math.div(d,g),null,3)}else{d=AL.math.approx(d)}k.setValue(d)}else{if(g){d=AL.math.approx(AL.math.div(d,g),null,3)}else{d=AL.math.approx(d)}k.setValue(d)}}}},updateTotal:function(){var f={};var m=Ext.ComponentQuery.query("creditnote_FormAddItem");var d=0;var k=0;var e=0;var j=0;var a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var l=0;var g=1;var h=false;if(a&&a.configs.multicurrency=="yes"){var c=a.down("combo[name=currency]");if(c.getValue()&&a.configs.currency!=c.getValue()){h=true;g=a.down("hidden[name=exchangeCurrency]").getValue()}}Ext.each(m,function(z){var x=z.down("combo[name=idTax]");var A=z.down("textfield[name=price]");var s=z.down("numberfield[name=quantity]");var C=z.down("textfield[name=discount]");var w=null;var y=typeof(x.getValue())=="string"?[x.getValue()]:x.getValue();if(z.type&&z.type==="edit"){if(x.getValue()==="old"){w=x.actualTax}}if(x.getValue()||x.findRecordByValue(x.getValue())){var q;var o;var p;var B=AL.math.approx(A.getValue(),null,a.decimalPrecision);var r=AL.math.approx(AL.math.mul(B,g),null,a.decimalPrecision);var t=s.getValue()?s.getValue():0;if(C.getValue()){e=AL.math.add(e,AL.math.approx(AL.math.mul(t,AL.math.approx(AL.math.mul(B,AL.math.div(C.getValue(),100)),null,a.decimalPrecision)),null,a.decimalPrecision));q=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(B,(AL.math.sub(1,AL.math.div(C.getValue(),100)))),null,a.decimalPrecision),t),null,a.decimalPrecision);p=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(r,AL.math.sub(1,AL.math.div(C.getValue(),100))),null,a.decimalPrecision),s.getValue()),null,a.decimalPrecision);o=AL.math.approx(AL.math.mul(B,t),null,a.decimalPrecision)}else{q=AL.math.approx(AL.math.mul(B,t),null,a.decimalPrecision);p=AL.math.approx(AL.math.mul(r,t),null,a.decimalPrecision);o=q}j=AL.math.add(j,o);d=AL.math.add(d,q);var v=0;var u=0;Ext.each(y,function(E){w=x.findRecordByValue(E);if(w){v=AL.math.add(v,AL.math.approx(AL.math.mul(q,AL.math.div(w.get("tax"),100)),null,a.decimalPrecision));u=AL.math.add(u,AL.math.approx(AL.math.mul(p,AL.math.div(w.get("tax"),100)),null,a.decimalPrecision));var D=w.get("name")+w.get("tax");if(f[D]){f[D].value=AL.math.add(f[D].value,AL.math.approx(AL.math.mul(q,AL.math.div(w.get("tax"),100)),null,a.decimalPrecision))}else{f[D]={label:w.get("name")+" ("+Ext.util.Format.round(w.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(q,AL.math.div(w.get("tax"),100)),null,a.decimalPrecision)}}}else{k=AL.math.add(k,q);l=AL.math.add(l,p)}});k=AL.math.add(k,AL.math.add(q,v));l=AL.math.add(l,AL.math.add(p,u))}});var b=a&&a.currencySign?a.currencySign:null;var n=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];if(n){n.removeAll();n.actualTotal=k;n.addItem({label:"Subtotal",value:AL.math.approx(j,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});n.addItem({label:translate("discount",true),value:AL.math.approx(AL.math.mul(e,-1),null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});n.addItem({label:"Subtotal",value:AL.math.approx(d,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});Ext.Object.each(f,function(o,p){p.value=AL.math.approx(p.value,null,a.decimalPrecision);p.decimalPrecision=a.decimalPrecision;p.currencySign=b;n.addItem(p)});n.addItem({label:"Total",value:AL.math.approx(k,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision,currencySign:b});if(h){n.addItem({label:"Total "+a.configs.currency,value:AL.math.approx(l,null,a.decimalPrecision),important:true,decimalPrecision:a.decimalPrecision})}}else{var d=0,f=0,k=0}return{subTotal:d,taxes:f,total:k}},updateItemTotal:function(g,e){if(e!="no"){e="yes"}var c=g.up("form");var h=c.down("textfield[name=price]");var f=c.down("displayfield[name=total]");var j=c.down("textfield[name=discount]");var d=c.down("numberfield[name=quantity]");var a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var b=a.currencySign?a.currencySign:null;if(h.isValid()&&d.isValid()&&j.isValid()){f.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(h.getValue(),null,a.decimalPrecision),(AL.math.sub(1,AL.math.div(j.getValue(),100)))),null,a.decimalPrecision),d.getValue()),null,a.decimalPrecision),a.decimalPrecision,b))}else{e="no"}if(e=="yes"){this.updateTotal()}},setRightClickEvent:function(b){var a=b.getView();a.on("itemcontextmenu",function(d,c,j,g,h,f){h.preventDefault();var e=[{text:translate("seeDetail",true),iconCls:"viewDetailIcon",actionUrl:"/credit-note/view/id/"+c.get("idLocal")},{text:translate("print",true),iconCls:"printIcon",actionUrl:"/credit-note/print/id/"+c.get("idLocal")}];if(c.get("editable")){e.push({text:translate("edit",true),iconCls:"editIcon",actionUrl:"/credit-note/edit/id/"+c.get("idLocal")})}if(c.get("deletable")){e.push({text:translate("remove",true),iconCls:"deleteIcon",actionUrl:"/credit-note/delete/id/"+c.get("idLocal")})}Ext.create("Ext.menu.Menu",{width:134,margin:"0 0 10 0",record:c,listeners:{click:function(n,l,m,k){window.location=l.actionUrl}},items:e}).showAt(h.getXY())})},goCreditNoteDetails:function(d,a,f,b,g,c){var h=a.get("idLocal");window.location="/credit-note/view/id/"+h},validateDifferentInvoices:function(d,a){var c=true;var b=Ext.ComponentQuery.query("creditnote_FormAddInvoice combo[name=number]");setTimeout(function(){Ext.each(b,function(e){if(e.getId()!=d.getId()){if(d.getValue()==e.getValue()){c=false;if(a){d.setValue(null);d.clearInvalid();d.markInvalid(translate("theInvoice",true)+" "+translate("invoice")+" ya ha sido seleccionada")}}}})},100);return c},validateForms:function(f){var e=this;e.errorAlertDisplayed=false;var a=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];var c=Ext.ComponentQuery.query("creditnote_FormAddItem");var d=true;if(a.getForm().isValid()){if(c.length===0){d=false}else{Ext.each(c,function(k){var h=k.getForm();if(!h.isValid()){d=false}else{if(f===true&&a.configs&&a.configs.isActiveElectronicInvoicing===true&&["peru","costaRica"].indexOf(a.configs.country)!==-1){var j="si deseas "+translate("stamp")+" la "+translate("creditNote");var g=h.getValues()}}});d=d&&e.validateAssociateForm(f)}}else{d=false}if(a.configs.costCenter.isActive){var b=a.down("combo[name=idCostCenter]");if(b){if(isNaN(b.getValue())){b.markInvalid(translate("costCenterErrorCombo",true));d=false}}}return d},validateAssociateForm:function(n){this.updateTotal();var j=this;var g=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0].actualTotal;var h=Ext.ComponentQuery.query("creditnote_FormAddInvoice");var p=Ext.ComponentQuery.query("creditnote_FormAddRefund");var e=Ext.ComponentQuery.query("creditnote_FormAddInvoice combo[name=number]");var c=Ext.ComponentQuery.query("creditnote_FormAddCreditNote")[0];g=AL.math.approx(g,null,c.decimalPrecision);var b=true;var k=0;var f=0;var m=c.decimalPrecision?c.decimalPrecision:AL.config.decimalPrecision;Ext.each(h,function(A){var w=A.down("textfield[name=amount]");if(A.getForm().isValid()){var q=A.down("combo[name=number]");var y=q.findRecordByValue(q.getValue());if(n&&y.get("decimalPrecision")!=m){var r="La factura debe coincidir con la precisión decimal actual. Edítala en Configuración -> Empresa.";if(c&&c.configs.country==="costaRica"){r="El comprobante debe coincidir con la precisión decimal actual. Edítala en Configuración -> Empresa."}w.markInvalid(r);b=false}var x=AL.math.approx(w.getValue(),null,y.get("decimalPrecision"));k=AL.math.add(k,x);f=AL.math.add(f,x);if(AL.math.comp(x,y.get("missingAmount"))>0){var v=translate("theAmountIsGreaterThanWhatRemainsToBePaidInTheInvoiceInvoice",true);if(c&&c.configs.country==="costaRica"){v="El monto es mayor a lo que falta por pagar en el comprobante"}w.markInvalid(v);b=false}if(c.configs&&j.getCountriesWithStamp().indexOf(c.configs.country)!==-1){var z=c.down("combo[name=creditNoteType]");var s=j.getVoidTypes(c.configs.country);if(s.indexOf(z.getValue())!==-1){if(y.get("totalPayed")>0){var u="Para el tipo de "+translate("creditNote")+" seleccionado no es posible asociar "+translate("invoices")+" con pagos, "+translate("cancels")+" los pagos para poder asociarlas";if(c&&c.configs.country==="costaRica"){u="Para el tipo de "+translate("creditNote")+" seleccionado no es posible asociar comprobantes con pagos, "+translate("cancels")+" los pagos para poder asociarlas"}w.markInvalid(u);b=false}else{if(x!==y.get("total")){var t="Para el tipo de "+translate("creditNote")+" seleccionado es necesario acreditar el total de "+translate("theInvoice")+" "+translate("invoice");if(c&&c.configs.country==="costaRica"){t="Para el tipo de "+translate("creditNote")+" seleccionado es necesario acreditar el total del comprobante"}w.markInvalid(t);b=false}}}}}else{b=false}});var l=false;Ext.each(e,function(q){if(!this.validateDifferentInvoices(q,false)){b=false;l=true}},this);if(l){this.errorAlertDisplayed=true;var d=translate("youCannotSelectMoreThanOnceTheSameInvoice",true);if(c&&c.configs.country==="costaRica"){d="No se puede seleccionar más de una vez el mismo comprobante"}GlobalMsg.showNotification({title:"Error",text:d,type:"error"})}if(b&&f!=g){var a;if(n){b=false;j.errorAlertDisplayed=true;a="El monto asociado a "+translate("theInvoices")+" "+translate("invoices")+" debe ser igual al monto total de la "+translate("creditNote");if(c&&c.configs.country==="costaRica"){a="El monto asociado a los comprobantes debe ser igual al monto total de la "+translate("creditNote")}}else{if(c.configs.country==="republicaDominicana"){b=false;j.errorAlertDisplayed=true;a="El monto asociado a "+translate("theInvoices")+" "+translate("invoices")+" debe ser igual al monto total de la "+translate("creditNote")}}if(a){GlobalMsg.showNotification({title:"Error",text:a,type:"error"})}}Ext.each(p,function(r){var q=r.down("textfield[name=amount]");if(r.getForm().isValid()){k=AL.math.add(k,AL.math.approx(q.getValue(),null,2))}else{b=false}});if(b&&AL.math.comp(g,AL.math.approx(k,null,6))<0){var o=translate("theValueOfReturnsAndOrCreditsToDocument1IsGreaterThanTheTotalOfTheDocument2",true,{document1:translate("invoices"),document2:translate("creditNote")});if(c&&c.configs.country==="costaRica"){o="El valor de las devoluciones y/o créditos a comprobantes es mayor que el total de la "+translate("creditNote")}GlobalMsg.showNotification({title:"Error",text:o,type:"error"});b=false;j.errorAlertDisplayed=true}return b},showSpinner:function(b,c){if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},validateAccountRefund:function(d){var a=d.getSelectedRecord();var b=true;var c=Ext.ComponentQuery.query("creditnote_FormAddRefund");Ext.each(c,function(e){var g=e.down("combo[name=idAccount]");var f=g.getSelectedRecord();if(f&&a&&f.get("currencyCode")&&a.get("currencyCode")&&f.get("currencyCode")!=a.get("currencyCode")){b=false;setTimeout(function(){d.setValue(null);d.clearInvalid();d.markInvalid("No se puede seleccionar dos bancos de monedas extranjeras diferentes")},100)}});return b},stampCreditNote:function(b,c){var f=b.getAttribute("data-idLocal");var a=b.getAttribute("data-status");var d=b.getAttribute("data-country");c.preventDefault();if(a=="open"){GlobalRedirector.go({zoneTitle:translate("stamp",true)+" "+translate("creditNote")});Ext.Ajax.request({url:"/credit-note/stamp/format/json/id/"+f,success:function(e){var g=Ext.decode(e.responseText);if(g.success){window.location.reload()}else{GlobalRedirector.close();if(g.cause){GlobalMsg.showNotification({title:"Error",text:g.cause,type:"error",closeable:"no"})}else{GlobalMsg.showNotification({title:"Error",text:"La "+translate("creditNote")+" no se pudo "+translate("stamp"),type:"error",closeable:"no"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:"La "+translate("creditNote")+" no se pudo "+translate("stamp"),type:"error"})}})}},sendByEmail:function(c,e){var b=Ext.ComponentQuery.query("creditnote_MoreActionsButton")[0];var g,a,d;if(Ext.isElement(c)){g=c.getAttribute("data-id");a=c.getAttribute("data-idClient");d=c.getAttribute("data-canEmail")}else{g=b.idLocal;a=b.idClient;d=b.canEmail}if(!e){var e="original"}var f=function(){var h=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(h){h.destroy();c.setAttribute("data-canEmail","yes")}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+a+"/format/json/email-template/credit-note/idDocument/"+g,success:function(k,m){var o=Ext.decode(k.responseText);if(o.success){var j=[];if(o.results){var l=o.results;if(o.emailTemplate){j.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:o.emailTemplate.subject});j.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:o.emailTemplate.message});j.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}j.push({xtype:"box",style:"color: #67948E; margin-bottom:10px",html:translate("emailAddressesAssociatedWithThisClient",true)});if(o.clientEmail){j.push({boxLabel:o.clientEmail+" - ("+o.clientName+")",name:"email",record:{name:o.clientName,email:o.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(l.length==0){j.push({xtype:"box",style:"color: #999; font-size:11px",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(l,function(p){j.push({boxLabel:p.email+" - ("+p.name+" "+p.lastName+")",name:"email",record:p,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}j.push({xtype:"box",style:"color: #67948E; margin-bottom:10px; margin-top:20px",html:translate("youCanAlsoSend",true)+" "+translate("thisCreditNote")+" "+translate("creditNote")+" "+translate("toAParticularEmailOrSendTo")},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var n=Ext.create("AL.view.common.SmileWindow",{reason:"confirmCreditNoteEmail",id:"window-credit-note-send-to-emails",number:g,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,title:translate("send",true)+" "+translate("creditNote")+" "+translate("toTheseEmails"),items:{xtype:"form",items:j,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",type:e,hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",action:"save",handler:function(p){var r=p.up("window");var q=r.down("button[action=confirmEmail]");if(q){q.fireEvent("click",q)}}}]}});n.show()}else{Ext.Msg.alert("Error",o.cause)}},failure:function(){}})};if(d==="yes"){f()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theF")+" "+translate("creditNote")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),forEmail:true,number:g,callback:f,resourceTrigger:"creditNote"})}},getCountriesWithStamp:function(){return["peru","colombia","costaRica","argentina","chile"]},getVoidTypes:function(b){var a=[];switch(b){case"peru":a=["VOID_OPERATION","VOID_OPERATION_BY_ERROR_IN_RUC"];break;case"colombia":a=["VOID_ELECTRONIC_INVOICE","RECISSION"];break;case"costaRica":a=["VOID_REFERENCE_DOCUMENT","CORRECT_TEXT_OF_REFERENCE_DOCUMENT"];break;case"chile":a=["VOID_REFERENCE_DOCUMENT"];break}return a},getSubmitDataDisabled:function(){var a=this,b=null,c;if(a.submitValue&&!a.isFileUpload()){c=a.getSubmitValue();if(c!==null){b={};b[a.getName()]=c}}return b},populateForm:function(G,s){var e=null;var y=true;if(G.type==="edit"){e=s.creditNote;G.decimalPrecision=e.decimalPrecision;if(s.invoiceCredits.length>0){y=false}}else{if(G.idInvoice){e=s.invoice;GlobalMsg.showErrorMessage(translate("recommendation",true),translate("weHaveUploadedTheInvoiceDataNumberVerifyTheInformationAndSaveTheDocument",true,{document:translate("creditNote"),number:(e.invoiceNumber)}),"no","warning");G.decimalPrecision=e.decimalPrecision}}var j=G.configs&&G.configs.resolutionModel&&G.configs.resolutionModel=="new";if(j){if(G.idInvoice){this.setResolutionAffectedDocumentType(G,e)}else{var F=G.down("numerationField[name=numerationComponent]");F.values.numerationIdLocal=e.resolutionIdLocal;F.values.prefix=e.prefix;F.values.number=e.number;F.selectNumerationByIdLocal(e.resolutionIdLocal,true)}}var p=this;var t=s.items;var N=s.invoiceCredits;var V=s.refunds;if(!G.idInvoice){var T=AL.date(e.date);T=Ext.Date.format(T,"d/m/Y")}var a=G.down("hidden[name=idLocal]");var r=G.down("combo[name=idClient]");var A=G.down("datefield[name=date]");var S=G.down("datefield[name=dueDate]");var m=G.down("combo[name=creditNoteType]");var E=G.down("textarea[name=observations]");var C=G.down("combo[name=idPriceList]");var g=G.down("textarea[name=anotation]");var B=G.down("combo[name=paymentMethod]");var P=G.down("textfield[name=accountNumber]");if(G.configs.country=="mexico"&&P&&e.accountNumber&&e.paymentMethod){P.setValue(e.accountNumber);B.setValue(e.paymentMethod)}if(G.configs.country==="mexico"&&G.configs.stampVersion=="3.3"){var U=G.down("combo[name=mx_creditNoteType]");U.allowBlank=false;U.show();if(e.mx_creditNoteType){U.setValue(e.mx_creditNoteType)}}if(e.metadata){G.setFieldValuesFromMetadata(e.metadata)}if(G.configs&&G.configs.country){switch(G.configs.country){case"costaRica":if(e.saleCondition){var v=G.down("combo[name=saleCondition]");var c=v.getStore();if(c.hasLoaded()){v.select(e.saleCondition)}else{c.on("load",function(){v.select(e.saleCondition)})}if(e.saleCondition==="CREDIT"){S.setValue(e.dueDate)}}break}}var Q=Ext.create("AL.model.Client",{idLocal:e.idClient,name:e.name});var o=G.down("[name=affectedDocumentType]");if(G.configs.country=="peru"&&e.affectedDocumentType=="saleTicket"){o.setValue(e.affectedDocumentType,true)}else{if(G.configs.country=="peru"&&G.idInvoice&&e.documentType=="saleTicket"){o.suspendEvents();o.setValue(e.documentType,true);o.resumeEvents()}else{if(e.affectedDocumentType&&!G.idInvoice){o.setValue(e.affectedDocumentType)}else{if(e.documentType&&G.idInvoice){o.setValue(e.documentType)}}}}r.select(Q);if(G.idInvoice){r.getSubmitData=p.getSubmitDataDisabled;r.disable()}else{a.setValue(e.idLocal)}if(!G.idInvoice){E.setValue(e.observations);g.setValue(e.anotation)}var l=G.down("combo[name=idWarehouse]");if(e.warehouse&&e.warehouse.idLocal){var z=l.getStore();if(!z.hasLoaded()&&!z.isLoading()){z.on("load",function(){var X=Ext.create("AL.model.Warehouse",e.warehouse);z.add(X);l.select(X)})}else{var I=Ext.create("AL.model.Warehouse",e.warehouse);z.add(I);l.select(I)}}if(e.idPriceList){p.loadPriceListStore(C,e.idPriceList)}if(G.configs.multicurrency=="yes"){var k=G.down("combo[name=currency]");var w=G.down("hidden[name=exchangeCurrency]");var b=k.getStore();k.show();var h=function(){var X=b.findRecord("code",G.configs.currency);if(!X){X=Ext.create("AL.model.CompanyCurrency",{code:G.configs.currency,exchangeRate:1});b.add(X)}var Y=null;if(e.currencyCode){Y=b.findRecord("code",e.currencyCode);if(Y){Y.set("exchangeRate",e.exchangeRate)}else{Y=Ext.create("AL.model.CompanyCurrency",{exchangeRate:e.exchangeRate,code:e.currencyCode,symbol:e.currencySymbol});b.add(Y)}}if(!Y){Y=X}k.select(Y);w.setValue(e.exchangeRate)};if(b.hasLoaded()){h()}else{b.load({callback:function(){h()}})}}GlobalLoadMask.hide("generalContainer");var x=Ext.ComponentQuery.query("#addItemPanel")[0];if((G.idInvoice||G.type&&G.type==="edit")&&(!t||!t.length)){GlobalLoadMask.hide("mask-items-loading")}var D=t.length;var M=1;var J=G.configs.canCreateNewTax;var f=G.configs.canCreateNewWarehouse;var O=G.configs.canCreateNewItem;var n=G.configs.multipleTaxes;Ext.each(t,function(Y){var Z=Ext.create("AL.view.creditnote.FormAddItem",{type:"edit",itemSold:Y,canCreateNewTax:J,canCreateNewWarehouse:f,canCreateNewItem:O,multipleTaxes:n});var X=Z.down("combo[name=idTax]");x.add(Z);if(M==D){X.on("taxComboRendered",function(){p.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}M++});var q=G;var u=G.down("[name=resolutionCombo]");var L=u.getStore();if(L.hasLoaded()||!j){p.populateInvoiceCredits(q,N,e)}else{L.on("load",function(){p.populateInvoiceCredits(q,N,e)})}var K=Ext.ComponentQuery.query("#refundContainer")[0];Ext.each(V,function(ad){var ab=AL.date(ad.date);ab=Ext.Date.format(ab,"d/m/Y");var Y=Ext.create("AL.view.creditnote.FormAddRefund");var Z=Y.down("datefield[name=date]");var af=Y.down("combo[name=idAccount]");var aa=Y.down("textfield[name=amount]");var ac=Y.down("textfield[name=observations]");Z.setValue(ab);var ag=af.getStore(),X=function(){var ai=af.getSelectedRecord();if(ai.get("currencyCode")&&!e.currencyCode){aa.setValue(ad.amount)}else{aa.setValue(ad.amountSecondaryCurrency)}};if(ag.hasLoaded()){af.select(ad.idAccount);X()}else{ag.on("load",function(){af.select(ad.idAccount);X()})}ac.setValue(ad.observations);if(q.type=="edit"&&ad.isConciliated){Z.disable();af.disable();aa.disable();ac.disable();Z.getSubmitData=p.getSubmitDataDisabled;af.getSubmitData=p.getSubmitDataDisabled;aa.getSubmitData=p.getSubmitDataDisabled;ac.getSubmitData=p.getSubmitDataDisabled;var ae=Y.down("button[action=deleteRefund]");ae.hide();var ah=Y.down("hiddenfield[name=isConciliated]");ah.setValue(1)}K.add(Y)});var H=Ext.ComponentQuery.query("creditnote_FormAddRefund")[0];var W=Ext.ComponentQuery.query("creditnote_FormAddInvoice")[0];var d=Ext.ComponentQuery.query("creditnote_FormAssociations")[0];if(G.idInvoice&&d){d.setActiveTab(1)}else{if(!H&&W&&d){d.setActiveTab(1)}}if(!G.idInvoice){A.setRawValue(T)}if(G.configs.costCenter.isActive){var R=G.down("combo[name=idCostCenter]");if(R&&e.idCostCenter){if(!y){R.allowEdit=y;R.setReadOnly(true);R.addCls("combo-noedit-full-border")}storeCostCenter=R.getStore();if(!storeCostCenter.hasLoaded()&&!storeCostCenter.isLoading()){this.loadCostCenterRecord(e.idCostCenter,R)}else{var I=storeCostCenter.findRecord("idLocal",e.idCostCenter);if(!I){this.loadCostCenterRecord(e.idCostCenter,R)}else{R.select(I)}}R.previousSelected=true}}},populateInvoiceCredits:function(a,g,c){var f=a&&a.idInvoice&&c&&c.status=="open";if(f&&(c.isElectronicResolution==c.hasStamp||a.configs.country=="mexico"||a.configs.country=="republicaDominicana")){g=[c]}var e=Ext.ComponentQuery.query("#invoiceContainer")[0];var b="";if(a.configs.costCenter.isActive){var d=a.down("combo[name=idCostCenter]");if(d&&d.previousSelected){b="/idCostCenter/"+d.getValue()}}Ext.each(g,function(o){var h=Ext.create("AL.view.creditnote.FormAddInvoice");var n=h.down("combo[name=number]");var j={autoLoad:true,pageSize:20,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",url:"/invoice/retrieve-open-by-client/idClient/"+c.idClient+"/includeElectronicInvoicingVersion/true/currency/"+c.currencyCode+"/checkCurrency/yes"+b+"/format/json",reader:{type:"json",root:"results"}}};if(a.configs&&a.configs.country=="peru"){var r=a.down("[name=resolutionCombo]");var k=r.getSelectedRecord();if(k.get("isElectronicResolution")===true){j.filters=[{property:"hasStamp",value:"yes"}]}else{j.filters=[{property:"hasStamp",value:"no"}]}}var q=Ext.create("AL.store.Invoices",j);n.store=q;n.emptyText=translate("search",true);n.editable=true;n.triggerCls="x-form-search-trigger";n.queryMode="remote";n.typeAhead=true;n.forceSelection=true;n.displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">','{invoiceNumber} <tpl if="values.electronicInvoicingVersion">('+translate("version",true)+" {electronicInvoicingVersion})</tpl>","</tpl>");n.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{invoiceNumber}<tpl if="values.electronicInvoicingVersion"> ('+translate("version",true)+" {electronicInvoicingVersion})</tpl></div></tpl>",width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"};var l=Ext.create("AL.model.Invoice",o);if(f){l.set("missingAmount",parseFloat(o.missingAmount));l.set("totalPayed",parseFloat(o.totalPayed))}else{l.set("missingAmount",parseFloat(o.missingAmount)+parseFloat(o.amountSecondaryCurrency));l.set("totalPayed",parseFloat(o.totalPayed)-parseFloat(o.amountSecondaryCurrency))}l.set("currencySymbol",c.currencySymbol);if(q.hasLoaded()){q.insert(0,l);n.select(l)}else{q.on("load",function(){q.insert(0,l);n.select(l)})}n.fireEvent("select2",{combo:n,record:l});var p=h.down("textfield[name=amount]");var m=0;if(f){m=o.missingAmount}else{m=o.amountSecondaryCurrency}p.setValue(m);e.add(h)})},setResolutionAffectedDocumentType:function(c,b){var e=c.down("numerationField[name=numerationComponent]");var a=b.documentType=="saleTicket"?"creditNoteSaleTicket":"creditNote";if(a=="creditNote"){if(c.configs&&c.configs.creditNoteResolutionModel){c.configs.resolutionModel=c.configs.creditNoteResolutionModel}}else{if(c.configs&&c.configs.creditNoteResolutionModel){c.configs.resolutionModel=c.configs.creditNoteSaleTicketResolutionModel}}var d=function(h){var f=h.getStore();var g=f.findRecord("isDefault","yes");if(g&&g.get("isElectronicResolution")!=b.isElectronicResolution){g=f.findRecord("isElectronicResolution",b.isElectronicResolution)}if(g){h.select(g.get("idLocal"))}};e.setDocumentType(a,d)},loadPriceListStore:function(d,c){var a=d.getStore(),b=function(){var e=a.findRecord("idLocal",c);if(!e){e=a.findRecord("main","yes")}d.select(e)};if(a.hasLoaded()){b()}else{a.load({callback:b})}},loadCostCenterRecord:function(b,e,a,c){var d=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+b+"/format/json",success:function(g,j){var k=Ext.decode(g.responseText);if(k.success){var h=k.results;var f=Ext.create("AL.model.CostCenter",h);if(e.store.isLoading()){e.store.on("load",function(){e.store.insert(0,f);e.select(f)})}else{e.store.insert(0,f);e.select(f)}if(a){if(c!="edit"){d.saveCreditNote(a)}else{d.editCreditNote(a)}}}else{Ext.MessageBox.alert(translate("costCenterNotFound",true))}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},validateCostCenter:function(d,c){if(d.configs.costCenter.isActive){var a=d.down("combo[name=idWarehouse]");var b=d.down("combo[name=idCostCenter]");if(!a||!b){return true}var e=a.getSelectedRecord();var f=e.get("idCostCenter");if(f==""||f==null){return true}if(c.idCostCenter!=f){return false}}return true},showMessageCostCenterError:function(j,f){var c=j.down("combo[name=idWarehouse]");var h=j.down("combo[name=idCostCenter]");var d=h.getSelectedRecord();var a=c.getSelectedRecord();var g=this;var b={document:translate("invoice")};var e=Ext.create("AL.view.common.SmileWindow",{id:"window-configuration-cost-centers",title:translate("costCenterErrorValidationTitle",true),width:600,modal:true,style:"padding:10px 18px 0px 18px",items:[{xtype:"box",html:"<div>"+translate("costCenterErrorValidationMessage",true)+translate("costCenterErrorValidationFixQuestion",true,b)+'<ul class="cost-center-selection-message"> <li>'+translate("costCenterWarehouseSelected",true)+" "+a.get("costCenterName")+"</li> <li>"+translate("costCenterSelected",true,b)+" "+d.get("name")+"</li></ul></div>"},],footer:{items:[{text:translate("skip",true),cls:"button",handler:function(k){e.close()}},{text:translate("modify",true),cls:"button main-button",handler:function(k){h.setValue(a.get("idCostCenter"));d=h.getSelectedRecord();if(!d&&a.get("idCostCenter")){g.loadCostCenterRecord(a.get("idCostCenter"),h,f,j.type)}else{if(j.type!="edit"){g.saveCreditNote(f)}else{g.editCreditNote(f)}}e.close()}}]}});e.show()}});Ext.define("AL.view.estimate.FormAddItem",{extend:"AL.view.common.FormAddItem",alias:"widget.estimate_FormAddItem"});Ext.define("AL.controller.Estimate",{extend:"Ext.app.Controller",views:["estimate.FormAddEstimate","estimate.FormAddItem","estimate.GridAll","estimate.FormAdvancedOptions","estimate.BottomContainer","item.GridEstimates","invoice.TotalLeftContainer",],stores:["Estimate","Items","Taxes","Clients","SellersCombo","PriceListCombo","CompanyCurrenciesCombo","WarehouseCombo"],models:["Estimate","Item","Client","Tax","Seller","PriceList","CompanyCurrency","Warehouse"],itemCount:0,errorAlertDisplayed:false,init:function(){this.application.addListener("clientCreated",function(j){var h=j.initiator;var f=j.record;var g=h.getStore();g.add(f);h.select(f.get("idLocal"));this.getContact(h,[f])},this);this.application.addListener("itemCreated",function(h){var f=h.initiator;var j=h.record;var o=f.getStore();var n=false;if(j.get("isInventariable")=="yes"&&j.get("warehouses")){var p=Ext.decode(j.get("warehouses"));var g=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var m=g.getSelectedRecord().get("idLocal");Ext.each(p,function(q){if(q.id==m){n=true;return}})}else{n=true}var l=j.multipleTaxes=="yes"?Ext.decode(j.get("idTax")):[j.get("idTax")];var k=[];Ext.each(l,function(q){k.push({id:q})});j.set("taxes",k);if(n){o.add(j);o.getProxy().clearCacheByTerms([j.get("name"),j.get("reference")]);f.select(j.get("idLocal"));f.fireEvent("select2",{combo:f,record:j})}else{GlobalMsg.showNotification({title:"Advertencia",text:"El "+translate("item")+" se creó pero no se agregó a la "+translate("estimate")+" ya que éste no se encuentra en "+translate("theWarehouse")+" "+translate("warehouse")+" seleccionada",type:"warning"})}},this);this.application.addListener("deleteEstimate",function(h){var f=h.record;var g=h.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("estimate")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theEstimate")+" "+translate("estimate")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(j){if(j=="yes"){Ext.Ajax.request({url:"/estimate/delete/format/json",method:"POST",params:{id:f.get("idLocal")},success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){var k=g.getStore();k.load()}else{if(!n.notification){Ext.MessageBox.alert("Error",n.cause)}}},failure:function(){}})}}})},this);var d=Ext.get("emailEstimate");var e=Ext.get("printEstimateLink");if(d){d.on("click",function(j,g){var l=g.getAttribute("data-id");var f=g.getAttribute("data-idClient");var h=g.getAttribute("data-canEmail");var k=function(){var m=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(m){m.destroy();g.setAttribute("data-canEmail","yes")}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+f+"/format/json/email-template/estimate/idDocument/"+l,success:function(o,q){var s=Ext.decode(o.responseText);if(s.success){var n=[];if(s.results){var p=s.results;if(s.emailTemplate){n.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:s.emailTemplate.subject});n.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:s.emailTemplate.message});n.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}n.push({xtype:"box",style:"color: #67948E; margin-bottom:10px",html:translate("emailAddressesAssociatedWithThisClient",true)});if(s.clientEmail){n.push({boxLabel:s.clientEmail+" - ("+s.clientName+")",name:"email",record:{name:s.clientName,email:s.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(p.length==0){n.push({xtype:"box",style:"color: #999; font-size:11px",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(p,function(t){n.push({boxLabel:t.email+" - ("+t.name+" "+t.lastName+")",name:"email",record:t,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}n.push({xtype:"box",style:"color: #67948E; margin-bottom:10px; margin-top:20px",html:translate("youCanAlsoSend",true)+" "+translate("thisEstimate")+" "+translate("estimate")+" "+translate("toAParticularEmailOrSendTo")},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var r=Ext.create("AL.view.common.SmileWindow",{reason:"confirmEstimateEmail",id:"window-estimate-send-to-emails",number:l,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,title:translate("send",true)+" "+translate("estimate")+" "+translate("toTheseEmails"),items:{xtype:"form",items:n,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(t){var v=t.up("window");var u=v.down("button[action=confirmEmail]");if(u){u.fireEvent("click",u)}}}]}});r.show()}else{Ext.Msg.alert("Error",s.cause)}},failure:function(){}})};if(h==="yes"){k()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theEstimate")+" "+translate("estimate")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),forEmail:true,number:l,callback:k,resourceTrigger:"estimate"})}})}if(e){e.on("click",function(h,g){h.preventDefault();if(g.getAttribute("data-canPrintOrDownload")){var j=g.getAttribute("data-id");var f=window.open("/estimate/print/id/"+j);f.print()}})}var a=Ext.get("cloneEstimateLink");if(a){a.on("click",function(h,f){h.preventDefault();var g=f.getAttribute("data-warehouseStatus");if(g=="inactive"){GlobalMsg.showNotification({title:"Error",text:"La "+translate("estimate")+" no se puede clonar ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=f.getAttribute("href")}})}var b=Ext.get("invoiceEstimateLink");if(b){b.on("click",function(h,f){h.preventDefault();var g=f.getAttribute("data-warehouseStatus");if(g=="inactive"){GlobalMsg.showNotification({title:"Error",text:"La "+translate("estimate")+" no se puede convertir a "+translate("invoice")+" ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=f.getAttribute("href")}})}var c=this;this.control({"buttons_SubmitReset button[action=save]":{click:this.saveEstimate},"buttons_SubmitReset button[action=edit]":{click:this.editEstimate},invoice_TotalLeftContainer:{afterrender:function(h){if(h.configs){var g=h.down("box[name=signatureBox]");if(h.configs.userSignatureUrl){var f=new Image;f.onload=function(l){var k=(f.width*Math.min(g.configs.maxHeight,f.height))/f.height;var j="";if(k<g.configs.maxWidth){j="width: auto; max-height: "+g.configs.maxHeight+"px;"}else{j="height: auto; max-width: "+g.configs.maxWidth+"px;"}g.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+h.configs.userSignatureUrl+'" style="margin: 0 auto; '+j+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+g.configs.madeByText+"</div></div>")};f.src=h.configs.userSignatureUrl}else{if(h.configs.disableSignatureEditing){g.update()}}}}},"invoice_TotalLeftContainer box[name=signatureBox]":{render:function(g){var f=g.up("totalleftcontainer");if(!f.configs.disableSignatureEditing){this.promptFileUploadWindowOnClick(g,"signatureUrl",true,{asyncUpload:true,title:translate("changeSignature",true),url:"/company/set-signature/format/json",fieldName:"signature",fieldLabel:translate("signature",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingSignature",true)})}}},"estimate_FormAddEstimate combo[name=days]":{change:function(f){this.changeDueDateFromDays(f.getSelectedRecord())}},"estimate_FormAddEstimate box[name=logoBox]":{render:function(h){var j=document.querySelector(".logo");var f=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var g=false;if(f&&f.configs&&f.configs.company&&f.configs.company.designMoreVisibility!=false){g=true}if(g==true){j=document.querySelector(".image-logo-profile")}this.promptFileUploadWindowOnClick(h,"logoUrl",false,{asyncUpload:true,title:translate("changeLogo",true),url:"/company/set-logo/format/json",fieldName:"logo",fieldLabel:translate("logo",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingLogo",true)},function(k){if(g!=true){j.innerHTML='<a href="/"><img src="'+k+'" />';"</a>"}else{if(j){j.src=k}}})}},estimate_BottomContainer:{afterrender:function(f){if(f.configs.requiredText){f.down("[name=requiredText]").update(f.configs.requiredText)}}},estimate_FormAddEstimate:{afterrender:this.initialize,beforerender:function(h){h.executeActionsBeforeRender();if(h.configs){if(h.configs.companyLogoUrl){var f=h.down("box[name=logoBox]");var j=new Image;j.onload=function(m){var l=(j.width*Math.min(f.configs.maxHeight,j.height))/j.height;var k="";if(l<f.configs.maxWidth){k="width: auto; max-height: "+f.configs.maxHeight+"px;"}else{k="height: auto; max-width: "+f.configs.maxWidth+"px;"}f.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+h.configs.companyLogoUrl+'" style="margin: 0 auto; '+k+'" /></div>')};j.src=h.configs.companyLogoUrl}if(h.configs.companyName){h.down("label[name=companyName]").setText(h.configs.companyName)}if(h.configs.companyIdentification){var g=translate("identification",true);if(h.configs.companyIdentificationType){g=h.configs.companyIdentificationType}h.down("label[name=companyIdentification]").setText(g+": "+h.configs.companyIdentification)}if(h.configs.companyEmail){h.down("label[name=companyEmail]").setText(h.configs.companyEmail)}}}},"estimate_FormAddEstimate combo[name=idClient]":{render:function(h){var g=this;var f=h.up("form");if(f.idClient){Ext.Ajax.request({url:"/client/retrieve-one/id/"+f.idClient+"/format/json",success:function(k,m){var n=Ext.decode(k.responseText);if(n.success){var l=n.results;var j=Ext.create("AL.model.Client",l);h.getStore().add(j);h.select(j);g.getContact(h,[j])}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}},select:this.getContact},"estimate_FormAddEstimate combo[name=idPriceList]":{change:function(h){var f=Ext.ComponentQuery.query("estimate_FormAddItem");var g=this;Ext.each(f,function(l){var m=l.down("combo[name=idLocal]");var k=l.down("textfield[name=price]");var j=m.getSelectedRecord();if(j){k.suspendEvents();g.getPrice(j,k);k.resumeEvents();g.updateItemTotal(k,"no")}});this.updateTotal()},afterrender:function(g){var f=g.getStore();if(!f.hasLoaded()){f.load({callback:function(){var j=g.up("form");if(j.type!="edit"){var h=f.findRecord("main","yes");g.suspendEvents();g.select(h);g.resumeEvents()}}})}}},"estimate_FormAddEstimate datefield[name=date]":{change:this.changeDueDateFromDate},"window[reason=confirmEstimateEmail] form button[action=confirmEmail]":{click:function(p,m){var h=p.up("form");var s=h.up("window");var o=Ext.ComponentQuery.query("window[reason=confirmEstimateEmail] checkbox[name=email]");var q=h.down("textfield[name=email]");var k=h.down("checkbox[name=sendCopyToUser]");var u=[];var v;if(o){Ext.each(o,function(z){if(z.getValue()){var w=z.record;var x="";if(w.name){x=w.name;if(w.lastName){x=x+" "+w.lastName}}var y={name:x,email:w.email};u.push(y)}})}if(q.getValue()&&q.getValue()!==""){v={name:"",email:q.getValue()};u.push(v)}var l=h.down("htmleditor[name=emailMessage]");var g=h.down("textfield[name=emailSubject]");var j={subject:g.getValue(),message:l.getValue()};var n=[],r,f;Ext.each(u,function(w){n.push(w.email)});n=n.join(",");r=Ext.get("emailEstimate").getAttribute("data-maxEmailsToSend");f=n.split(/[;,]/).length;if(f>r){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("theEstimate")+" "+translate("estimate"),quantity:r}));return}var t={number:s.number,emails:Ext.encode(u),sendCopyToUser:k.getValue(),emailTemplate:Ext.encode(j)};Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/estimate/email/format/json",method:"POST",params:t,showSpinner:true,success:function(w,x){var y=Ext.decode(w.responseText);if(y.success){s.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("theEstimate",true)+" "+translate("estimate")+" "+translate("hasBeenSentsuccessfullyF"),type:"success"});setTimeout(function(){window.location.reload()},1500)}else{Ext.Msg.alert("Error",y.cause)}},failure:function(){}})}},"estimate_FormAddItem combo[name=idLocal]":{beforerender:function(g){var f=g.up("form");if(f.canCreateNewItem){g.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl><div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newM",true)+" "+translate("item")+"</a></div>"}},render:function(m){var l=m.up("form");var g=Ext.create("AL.store.ItemsCombo");var k=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];if(k.configs.showWarehouses){var f=k.down("combo[name=idWarehouse]");var h=g.getProxy();var n=null;if(f.getValue()){if(typeof f.getValue()=="string"){n=f.getValue()}else{n=f.getValue().get("idLocal")}h.extraParams={idWarehouse:n}}else{var j=f.getStore();j.on("load",function(){var o=j.findRecord("isMain","yes");n=o.get("idLocal");h.extraParams={idWarehouse:n}})}}m.store=g;if(l.idItem){Ext.Ajax.request({url:"/item/retrieve-one/id/"+l.idItem+"/format/json",success:function(p,r){var s=Ext.decode(p.responseText);if(s.success){var q=s.results;var o=Ext.create("AL.model.Item",q);m.getStore().add(o);m.select(o);m.fireEvent("select2",{combo:m,record:o})}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})}},select:this.getItem,select2:function(g){var h=g.combo;var f=g.record;this.getItem(h,[f])}},"estimate_FormAddItem button[action=deleteItem]":{click:function(f){f.up("form").destroy();this.updateTotal()}},"estimate_FormAddItem textfield[name=price]":{change:this.updateItemTotal},"estimate_FormAddItem textfield[name=discount]":{change:this.updateItemTotal},"estimate_FormAddItem combo[name=idTax]":{render:function(k){var j=k.up("form");var h=this;var f=k.getStore();if(j.type&&j.type==="edit"){var g=j.itemSold;if(f.hasLoaded()){k.suspendEvents();k.select(g.idTax);k.resumeEvents();k.fireEvent("taxComboRendered")}else{f.on("load",function(){k.suspendEvents();k.select(g.idTax);k.resumeEvents();k.fireEvent("taxComboRendered")})}}if(!f.hasLoaded()&&!f.isLoading()){f.load()}},change:this.updateTotal,beforeselect:function(h,f,g){if(h.multiSelect==true){if(f.get("idLocal")===0||(h.getValue()&&h.getValue()[0]===0)){h.getStore().each(function(j){if(j.get("idLocal")!==0){j.set("disabled",true)}});h.setValue("[0]")}return f.get("disabled")?false:true}},beforedeselect:function(h,f,g){if(h.multiSelect==true){if(f.get("idLocal")===0){h.getStore().each(function(j){if(j.get("idLocal")!==0){j.set("disabled",false)}})}}}},estimate_FormAddItem:{afterrender:function(g){var p=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];if(p.configs.changeItemsPrices==="no"){var q=g.down("textfield[name=price]");q.setReadOnly(true);q.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}if(p.configs.changeDiscount==="no"){var n=g.down("textfield[name=discount]");n.setReadOnly(true);n.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}var l=this.showFormEditDiscount();if(l){var n=g.down("textfield[name=discount]");var o=function(){var u=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!u){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:n,valueDiscountMax:p.configs.valueDiscountMax,isActiveElectronicInvoicing:p.configs.isActiveElectronicInvoicing,country:p.configs.country}})}};n.getEl().on("click",o);n.getEl().on("focusin",o)}if(g.type&&g.type==="edit"){var h=g.itemSold;var m=Ext.create("AL.model.Item",h);var j=g.down("combo[name=idLocal]");var s=g.down("textfield[name=reference]");var q=g.down("textfield[name=price]");var t=g.down("textfield[name=discount]");var f=g.down("textarea[name=description]");var k=g.down("numberfield[name=quantity]");var r=j.getStore();r.add(m);j.select(m);q.suspendEvents();t.suspendEvents();k.suspendEvents();q.setValue(h.priceSecondaryCurrency);s.setValue(h.reference);t.setValue(g.itemSold.discount);if(l){t.discount={discount:h.discount,discountNature:h.discountNature}}f.setValue(h.description);k.setValue(g.itemSold.quantity);q.resumeEvents();t.resumeEvents();k.resumeEvents();this.updateItemTotal(q,"no")}}},"estimate_FormAddItem numberfield[name=quantity]":{change:this.updateItemTotal},"estimate_FormAddEstimate label[name=companyEdit]":{beforerender:function(f){var g=f.up("form");if(!g.configs.canEditCompany){f.hidden=true}},afterrender:function(f){var g=this;f.getEl().on("click",function(){var h=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];h.configs.canStampInvoices=true;g.showCompanyEditWindow(h,false)},f)},},"estimate_FormAddEstimate combo[name=idWarehouse]":{afterrender:function(h){var g=h.up("form");var f=h.getStore();if(!f.hasLoaded()&&!f.isLoading()){f.load({callback:function(){if(g.type!="edit"&&!g.idEstimate){var j=f.findRecord("isMain","yes");if(j){h.select(j)}}}})}},select:function(f){var g=Ext.ComponentQuery.query("estimate_FormAddItem");Ext.each(g,function(k){var j=k.down("combo[name=idLocal]");var h=j.getStore().getProxy();h.clearCache();k.removeAll();k.destroy()});this.addItemForm()}},estimate_GridAll:{beforerender:function(f){if(f&&f.country=="peru"){f.columns[0].setText(translate("number",true))}}},"estimate_GridAll gridcolumn[type=estimateActions]":{click:function(f,h,o,m,p,q){var r=this.application;var l=Ext.get(p.target);var k=f.up("grid").getSelectionModel().getSelection()[0];if(l.hasCls("deleteEstimate")){p.preventDefault();if(k.get("deletable")){r.fireEvent("deleteEstimate",{record:k,initiator:f})}else{Ext.Msg.alert("Error","Esta "+translate("estimate")+" no se puede eliminar")}}else{if(l.hasCls("printEstimate")){p.preventDefault();var g=k.get("idLocal");var n=window.open("/estimate/print/id/"+g);n.print()}}}},"estimate_FormAddEstimate hidden[name=exchangeCurrency]":{change:function(l){var f=Ext.ComponentQuery.query("estimate_FormAddItem");var k=this;var h=l.up("form");var j=h.down("combo[name=currency]");var g=j.getSelectedRecord();if(g.get("code")!=h.configs.currency){h.currencySign=g.get("symbol")}else{h.currencySign=null}Ext.each(f,function(o){var p=o.down("combo[name=idLocal]");var n=o.down("textfield[name=price]");var m=p.getSelectedRecord();if(m){n.suspendEvents();k.getPrice(m,n,"no");n.resumeEvents();k.updateItemTotal(n,"no")}});this.updateTotal()}},"estimate_FormAddEstimate combo[name=currency]":{change:function(m){var l=m.up("form");var j=l.down("displayfield[name=exchangeCurrencyDisplay]");var h=l.down("hidden[name=exchangeCurrency]");var f=m.getSelectedRecord();var g=this.application;if(f&&f.get("code")&&f.get("code")!=l.configs.currency){j.show();j.setValue("1 "+f.get("code")+" = "+Ext.util.Format.round(f.get("exchangeRate"),8)+" "+l.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');h.setValue(Ext.util.Format.round(f.get("exchangeRate"),8));var k=Ext.get("editExchangeRate");if(k){k.on("click",function(o){o.preventDefault();var n={};n.currency=f.get("code");n.initiator=j;n.currencyRecord=f;g.fireEvent("editExchangeRate",n)})}}else{j.hide();h.setValue(null)}}}})},saveEstimate:function(f){var k=this;var h=Ext.ComponentQuery.query("estimate_FormAddItem");var c=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var m=[];var e=this.showFormEditDiscount();Ext.each(h,function(q){var p=q.getValues();if(!p.idTax||p.idTax==0){delete p.idTax}if(p.discount==""){p.discount=0}else{if(e){var r=q.down("textfield[name=discount]");if(r.discount){p.discountNature=r.discount.discountNature}}}if(p.idLocal){m.push(p)}});var n=c.getValues();var b=Ext.ComponentQuery.query("estimate_BottomContainer")[0];var d=b.down("[name=anotation]");n.anotation=d.getValue();var a=c.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){n.exchangeRate=a.getValue()}n.items=Ext.encode(m);if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var o=c.down("smilenumeration[name=numerationComponent]");var l=o.getSelectedNumeration();n.idResolution=l}var j=Ext.get("new-comment");if(j&&j.getValue()){var g=j.getValue();n.comment=Ext.encode(g)}if(k.validateForms()){f.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("estimate")+""});Ext.Ajax.request({url:"/estimate/add/format/json",method:"POST",params:n,success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){var s=r.results;if(r.hasAccess===true){window.location="/estimate/view/id/"+s}else{window.location="/estimate"}}else{f.enable();GlobalRedirector.close()}},failure:function(){f.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                                Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(c){var h=Ext.get("addOtherItem");h.on("click",function(){this.addItemForm();var k=Ext.ComponentQuery.query("estimate_FormAddItem");if(k.length===200){Ext.Msg.show({title:"Límite de "+translate("items")+" alcanzado",msg:"Al agregar más "+translate("items")+" no podrás imprimir o descargar la "+translate("estimate")+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var e=this;var f=c.down("combo[name=currency]");var g=f.getStore();g.load({callback:function(){var k=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});g.add(k);f.select(c.configs.currency)}});if(c.configs.multicurrency=="yes"){f.show()}if(!c.configs.showWarehouses){c.down("combo[name=idWarehouse]").hide()}var d=c.down("combo[name=idSeller]");if(d){var b=d.getStore();b.load({callback:function(){var k=d.findRecord("idLocal",null);if(!k){k=Ext.create("AL.model.Seller",{name:translate("anyM",true),idLocal:null});b.add(k)}}})}if((c.type&&c.type==="edit")||c.idEstimate){GlobalLoadMask.show("mask-items-loading");GlobalLoadMask.show("generalContainer");var j=c.idLocal;if(c.idEstimate){j=c.idEstimate}Ext.Ajax.request({url:"/estimate/retrieve-info/id/"+j+"/format/json",success:function(k,n){var B=Ext.decode(k.responseText);if(B.success){var E=B.results;var H=E.estimate;var D=E.items;var M=AL.date(H.date);var K=AL.date(H.dueDate);M=Ext.Date.format(M,"d/m/Y");K=Ext.Date.format(K,"d/m/Y");var N=Ext.ComponentQuery.query("estimate_BottomContainer")[0];var C=c.down("hidden[name=idLocal]");var t=c.down("combo[name=idClient]");var v=c.down("datefield[name=date]");var G=c.down("datefield[name=dueDate]");var u=c.down("textarea[name=observations]");var l=N.down("[name=anotation]");var m=c.down("combo[name=idSeller]");var L=c.down("combo[name=idPriceList]");var A=c.down("textfield[name=clientPhone]");var P=c.down("textfield[name=clientIdentification]");var s=Ext.create("AL.model.Client",{idLocal:H.idClient,name:H.name});if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var x=c.down("smilenumeration[name=numerationComponent]");x.values.numerationIdLocal=H.resolutionIdLocal;x.values.prefix=H.prefix;x.values.number=H.number;x.selectNumerationByIdLocal(H.resolutionIdLocal)}var p=t.getStore();p.on("load",function(W,T,X,V){var U=W.findExact("idLocal",H.idClient);if(U<0){Ext.Ajax.request({url:"/client/retrieve-one/id/"+H.idClient+"/format/json",success:function(Z,ab){var ac=Ext.decode(Z.responseText);if(ac.success){var aa=ac.results;var Y=Ext.create("AL.model.Client",aa);W.add(Y);t.select(Y);var ad=Y.get("identification");if(ad){ad+=(c.configs&&c.configs.country==="colombia"&&!Ext.isEmpty(Y.get("co_dv")))?"-"+Y.get("co_dv"):""}P.setValue(ad);A.setValue(Y.get("phone1"))}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}else{W.findBy(function(Y,aa){if(Y.get("idLocal")==H.idClient){t.select(Y);var Z=Y.get("identification");if(Z){Z+=(c.configs&&c.configs.country==="colombia"&&!Ext.isEmpty(Y.get("co_dv")))?"-"+Y.get("co_dv"):""}P.setValue(Z);A.setValue(Y.get("phone1"));return true}return false})}});p.load();t.select(s);if(c.type==="edit"){C.setValue(H.idLocal);c.decimalPrecision=E.estimate.decimalPrecision}u.setValue(H.observations);l.setValue(H.anotation);var z=c.down("combo[name=idWarehouse]");if(H.warehouse&&H.warehouse.idLocal){var J=z.getStore();if(!J.hasLoaded()&&!J.isLoading()){J.on("load",function(){var T=Ext.create("AL.model.Warehouse",H.warehouse);J.add(T);z.select(T)})}else{var r=Ext.create("AL.model.Warehouse",H.warehouse);J.add(r);z.select(r)}}if(m){e.loadSellerStore(m,H.idSeller)}if(H.idPriceList){e.loadPriceListStore(L,H.idPriceList)}if(c.configs.multicurrency=="yes"){var O=c.down("combo[name=currency]");var F=c.down("hidden[name=exchangeCurrency]");var q=O.getStore();O.show();var R=function(){var T=q.findRecord("code",c.configs.currency);if(!T){T=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,exchangeRate:1});q.add(T)}var U=null;if(H.currencyCode){U=q.findRecord("code",H.currencyCode);if(U){U.set("exchangeRate",H.exchangeRate)}else{U=Ext.create("AL.model.CompanyCurrency",{exchangeRate:H.exchangeRate,code:H.currencyCode,symbol:H.currencySymbol});if(U&&U.code){q.add(U)}}}if(!U){U=T}O.select(U);F.setValue(H.exchangeRate)};if(q.hasLoaded()){R()}else{q.load({callback:function(){R()}})}}GlobalLoadMask.hide("generalContainer");var o=D.length;var y=1;var w=c.configs.canCreateNewTax;var Q=c.configs.canCreateNewWarehouse;var I=c.configs.canCreateNewItem;var S=c.configs.multipleTaxes;Ext.each(D,function(W){var T=Ext.ComponentQuery.query("#addItemPanel")[0];var V=Ext.create("AL.view.estimate.FormAddItem",{type:"edit",itemSold:W,canCreateNewTax:w,canCreateNewWarehouse:Q,canCreateNewItem:I,multipleTaxes:S});var U=V.down("combo[name=idTax]");T.add(V);if(y==o){U.on("taxComboRendered",function(){e.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}y++});if(c.type==="edit"){v.setRawValue(M);G.setRawValue(K)}}},failure:function(){}})}var a=Ext.get("advancedOptionsLink");if(a){a.on("click",function(k){k.preventDefault();e.showAdvancedOptions()})}},addItemForm:function(){var b=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var c=Ext.create("AL.view.estimate.FormAddItem",{itemCount:++this.itemCount,canCreateNewTax:b.configs.canCreateNewTax,canCreateNewWarehouse:b.configs.canCreateNewWarehouse,canCreateNewItem:b.configs.canCreateNewItem,multipleTaxes:b.configs.multipleTaxes});a.add(c)},changeDueDateFromDate:function(g,b,e,d){var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();var f=30;var a=Ext.Date.add(b,Ext.Date.DAY,f);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(a,"d/m/Y"))},getItem:function(d,e,h,k){var g=e[0];var l=this;var c=d.up("form");var o=c.down("textfield[name=reference]");var n=c.down("textfield[name=price]");var a=c.down("textarea[name=description]");var f=c.down("numberfield[name=quantity]");var p=c.down("textfield[name=discount]");var b=c.down("combo[name=idTax]");f.suspendEvents();p.suspendEvents();n.suspendEvents();b.suspendEvents();o.setValue(g.get("reference"));a.setValue(g.get("description"));f.setValue(1);p.setValue(0);var j=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var m=function(){if(!g.get("idTax")||g.get("idTax")=="null"){return b.select(0)}var r=[];var q=g.get("taxes");Ext.each(q,function(t){if(t.status==="inactive"){if(j&&j.type==="edit"&&c.itemSold&&c.itemSold.idTax==g.get("idTax")){var s=Ext.create("AL.model.Tax",{idLocal:"old",tax:t.tax,name:t.taxName});s.set("currentId",t.id);b.actualTax=s;r.push(t.idTax)}else{b.select(0)}}else{r.push(t.id)}});if(r.length>0){b.setValue(r)}};if(b.getStore().isLoading()){b.getStore().on("load",m)}else{m()}this.getPrice(g,n);f.resumeEvents();n.resumeEvents();p.resumeEvents();b.resumeEvents();this.updateItemTotal(n);d.up("form").enableFields()},getPrice:function(b,c,e){var g=b.get("priceList");var d=b.get("price");var f=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var a=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];if(e=="no"){if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}c.setValue(d)}else{if(!g){Ext.Ajax.request({url:"/item/retrieve-price-list/format/json/id/"+b.get("idLocal"),success:function(h,k){var l=Ext.decode(h.responseText);var j=l.results;var m=j;b.set("priceList",m);if(m[f.getValue()]){d=m[f.getValue()];if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}else{if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}}})}else{if(g[f.getValue()]){d=g[f.getValue()];if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}else{if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}}}},updateTotal:function(){var e={};var n=Ext.ComponentQuery.query("estimate_FormAddItem");var c=0;var l=0;var d=0;var j=0;var k=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var m=0;var g=1;var h=false;if(k&&k.configs.multicurrency=="yes"){var b=k.down("combo[name=currency]");if(b.getValue()&&k.configs.currency!=b.getValue()){h=true;g=k.down("hidden[name=exchangeCurrency]").getValue()}}var f=true;Ext.each(n,function(p){var q=p.down("textfield[name=discount]").isValid();if(q==false){f=false}});if(f){Ext.each(n,function(A){var y=A.down("combo[name=idTax]");var B=A.down("textfield[name=price]");var t=A.down("numberfield[name=quantity]");var D=A.down("textfield[name=discount]");var x=null;var z=typeof(y.getValue())=="string"?[y.getValue()]:y.getValue();if(A.type&&A.type==="edit"){if(y.getValue()==="old"){x=y.actualTax}}if(y.getValue()||y.findRecordByValue(y.getValue())){var r;var q;var p;var C=AL.math.approx(B.getValue(),null,k.decimalPrecision);var s=AL.math.approx(AL.math.mul(C,g),null,k.decimalPrecision);var u=t.getValue()?t.getValue():0;if(D.getValue()){d=AL.math.add(d,AL.math.approx(AL.math.mul(u,AL.math.approx(AL.math.mul(C,AL.math.div(D.getValue(),100)),null,k.decimalPrecision)),null,k.decimalPrecision));r=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(C,AL.math.sub(1,AL.math.div(D.getValue(),100))),null,k.decimalPrecision),t.getValue()),null,k.decimalPrecision);q=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(s,AL.math.sub(1,AL.math.div(D.getValue(),100))),null,k.decimalPrecision),u),null,k.decimalPrecision);p=AL.math.approx(AL.math.mul(C,u),null,k.decimalPrecision)}else{r=AL.math.approx(AL.math.mul(C,u),null,k.decimalPrecision);q=AL.math.approx(AL.math.mul(s,u),null,k.decimalPrecision);p=r}j=AL.math.add(j,p);c=AL.math.add(c,r);var w=0;var v=0;Ext.each(z,function(F){x=y.findRecordByValue(F);if(x){w=AL.math.add(w,AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,k.decimalPrecision));v=AL.math.add(v,AL.math.approx(AL.math.mul(q,AL.math.div(x.get("tax"),100)),null,k.decimalPrecision));var E=x.get("name")+x.get("tax");if(e[E]){e[E].value=AL.math.add(e[E].value,AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,k.decimalPrecision))}else{e[E]={label:x.get("name")+" ("+Ext.util.Format.round(x.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,k.decimalPrecision)}}}else{l=AL.math.add(l,r);m=AL.math.add(m,q)}});l=AL.math.add(l,AL.math.add(r,w));m=AL.math.add(m,AL.math.add(q,v))}});var o=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];var a=k&&k.currencySign?k.currencySign:null;if(o){o.removeAll();o.addItem({label:"Subtotal",value:AL.math.approx(j,null,k.decimalPrecision),important:true,decimalPrecision:k.decimalPrecision,currencySign:a,cls:"price-row",});o.addItem({label:translate("discount",true),value:AL.math.approx(AL.math.mul(d,-1),null,k.decimalPrecision),important:true,decimalPrecision:k.decimalPrecision,currencySign:a,cls:"price-row",});o.addItem({label:"Subtotal",value:AL.math.approx(c,null,k.decimalPrecision),important:true,decimalPrecision:k.decimalPrecision,currencySign:a,cls:"price-row",});Ext.Object.each(e,function(p,q){q.value=AL.math.approx(q.value,null,k.decimalPrecision);q.decimalPrecision=k.decimalPrecision;q.currencySign=a;q.cls="price-row";o.addItem(q)});o.addItem({label:"Total",value:AL.math.approx(l,null,k.decimalPrecision),important:true,decimalPrecision:k.decimalPrecision,currencySign:a,cls:"price-total",});if(h){o.addItem({label:"Total "+k.configs.currency,value:AL.math.approx(m,null,k.decimalPrecision),important:true,decimalPrecision:k.decimalPrecision,cls:"price-total",})}}}else{var c=0,e=0,l=0}return{subTotal:c,taxes:e,total:l}},editEstimate:function(f){var c=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var g=Ext.getCmp("addItemPanel").items.getRange();var j=[];if(this.validateForms()){f.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("estimate")+""});var e=this.showFormEditDiscount();Ext.each(g,function(p){if(p.getForm){var m=p.getForm().getValues();if(m.idLocal==="old"){m.idLocal=m.oldId}else{delete m.itemName}if(e){var q=p.down("textfield[name=discount]");if(q.discount){m.discountNature=q.discount.discountNature}}if(m.idTax==="old"){var n=p.down("combo[name=idTax]");var o=n.actualTax;if(o.get("currentId")){m.idTax=o.get("currentId");m.taxName=o.get("name");m.tax=o.get("tax")}else{delete m.idTax}m.taxName=o.get("name");m.tax=o.get("tax")}else{if(!m.idTax||m.idTax==0){delete m.idTax}}delete m.oldId;j.push(m)}});var k=c.getValues();var b=Ext.ComponentQuery.query("estimate_BottomContainer")[0];var d=b.down("[name=anotation]");k.anotation=d.getValue();if(k.idClient==="old"){k.idClient=k.oldIdClient}else{delete k.oldClientName;delete k.oldIdClient}var a=c.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){k.exchangeRate=a.getValue()}k.items=Ext.encode(j);if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var l=c.down("smilenumeration[name=numerationComponent]");var h=l.getSelectedNumeration();k.idResolution=h}Ext.Ajax.request({url:"/estimate/edit/format/json",method:"POST",params:k,success:function(m,n){var o=Ext.decode(m.responseText);if(o.success){var p=o.results;window.location="/estimate/view/id/"+p}else{f.enable();GlobalRedirector.close()}},failure:function(){f.enable();GlobalRedirector.close()}})}else{if(!this.errorAlertDisplayed){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},updateItemTotal:function(g,d){if(d!="no"){d="yes"}var b=g.up("form");var h=b.down("textfield[name=price]");var f=b.down("displayfield[name=total]");var c=b.down("numberfield[name=quantity]");var j=b.down("textfield[name=discount]");var e=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var a=e.currencySign?e.currencySign:null;if(h.isValid()&&c.isValid()&&j.isValid()){f.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(h.getValue(),null,e.decimalPrecision),AL.math.sub(1,AL.math.div(j.getValue(),100))),null,e.decimalPrecision),c.getValue()),null,e.decimalPrecision),e.decimalPrecision,a))}else{d="no"}if(d=="yes"){this.updateTotal()}},validateForms:function(){var e=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];var b=Ext.ComponentQuery.query("estimate_FormAddItem");var d=true;if(e.getForm().isValid()){var a=e.down("combo[name=idClient]");if(!a.getSelectedRecord()){d=false;a.markInvalid("Debes seleccionar el cliente, no solo escribir su "+translate("name",true))}if(b.length===0){d=false}else{var c=0;Ext.each(b,function(k){var g=k.getForm();if(g.getValues().idLocal){c++;if(!g.isValid()){d=false}else{var j=k.down("combo[name=idLocal]");if(!j.getSelectedRecord()){d=false;j.markInvalid("Debes seleccionar el ítem, no solo escribir su "+translate("name",true))}var f=parseInt(e.configs.valueDiscountMax);if(e.configs.country=="colombia"&&e.configs.isActiveElectronicInvoicing&&f==100){f=99}var h=k.down("textfield[name=discount]");if(e.configs.changeDiscount==="yes"){if(h.getValue()>f){d=false;h.markInvalid("El porcentaje de "+translate("discount")+" ingresado es mayor que el permitido.")}}}}if(c===0){d=false;b[0].down("combo[name=idLocal]").markInvalid("Debes asociar al menos un ítem a la "+translate("estimate")+"")}})}}else{d=false}return d},showSpinner:function(b,c){if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},getContact:function(k,c){var f=c[0],j=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];if(f.get("idPriceList")){this.loadPriceListStore(j,f.get("idPriceList"))}else{var h=j.findRecord("main","yes");j.select(h)}var e=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(e){this.loadSellerStore(e,f.get("idSeller"))}var b=k.up("form");var o=b.down("[name=clientIdentification]");var n=b.down("[name=clientPhone]");var g=f.get("identification");if(g){g+=(b.configs&&b.configs.country==="colombia"&&!Ext.isEmpty(f.get("co_dv")))?"-"+f.get("co_dv"):""}o.setValue(g);n.setValue(f.get("phone1"));var m=Ext.ComponentQuery.query("combo[name=days]")[0];if(f.get("idTerm")){var l=m.getStore();var a=function(p){var q=l.findRecord("idLocal",p.get("idTerm"));if(q){m.select(q)}};if(l.hasLoaded()){a(f)}else{l.on("load",function(){a(f)});l.load()}}else{var d=Ext.create("AL.model.Term",{idLocal:0,days:"Vencimiento manual",name:"Vencimiento manual"});m.select(d)}},showCompanyEditWindow:function(a,c,b){this.application.fireEvent("editCompanyEvent",a,c,b)},promptFileUploadWindowOnClick:function(c,a,b,f,e){var d=false;c.getEl().on("click",function(j,m){if(d){return}d=true;var l=false;var h=c.getEl().getHTML();var g="AL.view.company.FileUploadWindowLogo";if(b){g="AL.view.company.FileUploadWindow"}var k=Ext.create(g,{asyncUpload:f.asyncUpload,title:f.title,url:f.url,fieldName:f.fieldName,fieldLabel:f.fieldLabel,buttonText:f.buttonText,helpText:f.helpText,height:230,onSubmit:function(n,o){l=true;Ext.create("Ext.fx.Anim",{target:n,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){n.close()}});Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update('<div class="form-add-invoice-image-zone-loading"></div>');Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(o,n,p){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var q=new Image;q.onload=function(t){var s=(q.width*Math.min(c.configs.maxHeight,q.height))/q.height;var r="";if(s<c.configs.maxWidth){r="width: auto; max-height: "+c.configs.maxHeight+"px;"}else{r="height: auto; max-width: "+c.configs.maxWidth+"px;"}if(b){c.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+c.configs.madeByText+"</div></div>")}else{c.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div>')}if(e){e(n[a])}Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})};q.src=n[a]}})},onFailure:function(o,n,q){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update(h);Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof n=="string"||!n.cause){Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}else{var p=n.title?n.title:translate("error",true);Ext.MessageBox.alert(p,n.cause)}},onClose:function(n){if(!l){d=false}}});k.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:k,duration:300,from:{opacity:0},to:{opacity:1}})},c)},showAdvancedOptions:function(){var a=Ext.ComponentQuery.query("estimate_FormAdvancedOptions")[0];if(a.hidden){a.show()}else{a.hide()}},changeDueDateFromDays:function(a){if(!a){return}var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();if(a.get("idLocal")){var d=parseInt(a.get("days"));var b=Ext.Date.add(c,Ext.Date.DAY,d);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(b,"d/m/Y"))}Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setMinValue(c)},loadSellerStore:function(d,c){var a=function(){var f=d.findRecord("idLocal",null);if(!f){f=Ext.create("AL.model.Seller",{name:translate("anyM",true),idLocal:null});b.add(f)}var e=d.findRecord("idLocal",c);if(!e){e=f}d.select(e)};var b=d.getStore();if(b.hasLoaded()){a()}else{b.load({callback:a})}},showFormEditDiscount:function(){var a=Ext.ComponentQuery.query("estimate_FormAddEstimate")[0];b=false;if(a&&a.configs){var b=a.configs.country=="costaRica"||(a.configs.country=="colombia"&&a.configs.isActiveElectronicInvoicing&&a.configs.electronicInvoicingVersion=="2.1")}return b},loadPriceListStore:function(d,c){var a=d.getStore(),b=function(){var e=a.findRecord("idLocal",c);if(!e){e=a.findRecord("main","yes")}d.select(e)};if(a.hasLoaded()){b()}else{a.load({callback:b})}}});Ext.define("AL.view.invoice.FormAddItem",{extend:"AL.view.common.FormAddItem",alias:"widget.invoice_FormAddItem"});Ext.define("AL.view.recurringinvoice.FormAddItem",{extend:"AL.view.common.FormAddItem",alias:"widget.recurringinvoice_FormAddItem"});Ext.define("AL.controller.RecurringInvoice",{extend:"Ext.app.Controller",views:["recurringinvoice.FormAddRecurringInvoice","recurringinvoice.FormAddItem","recurringinvoice.GridAll","ux.form.Switch","item.FormEditDiscount"],stores:["RecurringInvoices","Clients","Terms","Items","Taxes","ItemsRecurring","ResolutionsComboRecurring","PriceListCombo","CompanyCurrenciesCombo","WarehouseCombo","CFDIUseList","SaleConditions","PaymentMethods","OperationTypes","EconomicActivities",],models:["RecurringInvoice","Client","Term","Item","Tax","ItemRecurring","Resolution","PriceList","CompanyCurrency","Warehouse"],_sourcePaymentMethod:"none",init:function(){this.application.addListener("clientCreated",function(e){var d=e.initiator;var b=e.record;var c=d.getStore();c.add(b);d.select(b.get("idLocal"))},this);this.application.addListener("itemCreated",function(d){var b=d.initiator;var e=d.record;var k=b.getStore();var j=false;if(e.get("isInventariable")=="yes"&&e.get("warehouses")){var l=Ext.decode(e.get("warehouses"));var c=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var h=c.getSelectedRecord().get("idLocal");Ext.each(l,function(m){if(m.id==h){j=true;return}})}else{j=true}var g=e.multipleTaxes=="yes"?Ext.decode(e.get("idTax")):[e.get("idTax")];var f=[];Ext.each(g,function(m){f.push({id:m})});e.set("taxes",f);if(j){k.add(e);k.getProxy().clearCacheByTerms([e.get("name"),e.get("reference")]);b.select(e.get("idLocal"));b.fireEvent("select2",{combo:b,record:e})}else{GlobalMsg.showNotification({title:"Advertencia",text:"El "+translate("item")+" se creó pero no se agregó "+translate("toTheInvoice")+" "+translate("invoice")+" ya que éste no se encuentra en "+translate("theWarehouse")+" "+translate("warehouse")+" seleccionada",type:"warning"})}},this);this.application.addListener("deleteRecurringInvoice",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("deletePurchase",true),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theInvoice")+" "+translate("recurringInvoice")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){Ext.Ajax.request({url:"/recurring-invoice/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("termCreated",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"))},this);var a=this;this.control({"buttons_SubmitReset button[action=saveRecurringInvoice]":{click:this.saveRecurringInvoice},"buttons_SubmitReset button[action=editRecurringInvoice]":{click:this.editRecurringInvoice},"buttons_SubmitReset button[action=makeRecurring]":{click:this.makeRecurringInvoice},"recurringinvoice_FormAddRecurringInvoice combo[name=idClient]":{select:this.getContact,change:function(b){if(this._sourcePaymentMethod!="disabled"){this._sourcePaymentMethod="user";this.selectPaymentMethodAndType(b);this._sourcePaymentMethod="none"}}},recurringinvoice_FormAddRecurringInvoice:{beforerender:function(b){b.executeActionsBeforeRender()},render:this.initialize},recurringinvoice_GridAll:{itemdblclick:this.goInvoiceDetails,render:this.setRightClickEvent},"recurringinvoice_FormAddItem combo[name=idLocal]":{beforerender:function(c){var b=c.up("form");if(b.canCreateNewItem){c.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl><div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newM",true)+" "+translate("item")+"</a></div>"}},render:function(g){var e=g.up("form");var h=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var f=Ext.create("AL.store.ItemsCombo");if(h.configs.showWarehouses){var b=h.down("combo[name=idWarehouse]");var c=f.getProxy();var j=null;if(b.getValue()){if(typeof b.getValue()=="string"){j=b.getValue()}else{j=b.getValue().get("idLocal")}c.extraParams={idWarehouse:j}}else{var d=b.getStore();d.on("load",function(){var k=d.findRecord("isMain","yes");j=k.get("idLocal");c.extraParams={idWarehouse:j}})}}g.store=f},select:this.getItem,select2:function(c){var d=c.combo;var b=c.record;this.getItem(d,[b])}},"recurringinvoice_FormAddRecurringInvoice combo[name=resolutionCombo]":{afterrender:function(d){var c=d.up("form");if(!c.type&&c.type!=="edit"){var b=d.getStore();b.on("load",function(){var e=b.findRecord("isDefault","yes");if(e){d.select(e.data.idLocal)}else{d.show()}if(b.count()>0){d.show()}})}}},"recurringinvoice_FormAddRecurringInvoice combo[name=cfdiUse]":{beforerender:function(d){var c=this;var b=d.up("form");if(b.configs.country=="mexico"&&b.configs.stampVersion=="3.3"){d.hidden=false;d.allowBlank=false}},},"recurringinvoice_FormAddRecurringInvoice combo[name=paymentMethod]":{beforerender:function(c){var b=c.up("form");if(b.configs&&b.configs.country==="mexico"){c.store.filter("type","pue");c.allowBlank=false}},change:function(b){if(this._sourcePaymentMethod!="user"){this._sourcePaymentMethod="disabled"}}},"recurringinvoice_FormAddRecurringInvoice combo[name=paymentType]":{beforerender:function(d){var c=this;var b=d.up("form");if(b.configs.country=="mexico"&&b.configs.stampVersion=="3.3"){d.hidden=false;d.allowBlank=false;d.forceSelection=true;d.editable=false;d.emptyText="Seleccionar"}},change:function(g){if(this._sourcePaymentMethod!="user"){this._sourcePaymentMethod="disabled"}var f=g.up("form");if(f.configs.country=="mexico"&&f.configs.stampVersion=="3.3"){var e=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(e){if(g.getValue()=="PPD"){e.hideButtonForAdvances()}else{e.showButtonForAdvances()}}var b=f.down("combo[name=paymentMethod]");if(b){if(g.getValue()=="PPD"){b.store.clearFilter();b.store.filter("type","ppd");b.setValue("other");b.matchFieldWidth=true}else{if(!f.type||f.type!="edit"){b.store.clearFilter();b.store.filter("type","pue");b.setValue("cash");var c=f.down("combo[name=idClient]").getSelectedRecord();if(!c){b.setValue("cash")}else{var d=c.getData();if((b.getValue()==null||b.getValue()=="")&&d.metadata.paymentMethod){b.setValue(d.metadata.paymentMethod.toLowerCase())}else{if(d.metadata.paymentMethod){b.setValue(d.metadata.paymentMethod.toLowerCase())}else{b.setValue("cash")}}}}b.matchFieldWidth=false}}}},},recurringinvoice_FormAddItem:{afterrender:function(c){var d=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];if(d.configs.country==="costaRica"){var h=c.down("textfield[name=discount]");if(d.configs.country==="costaRica"){var j=function(){var p=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!p){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:h}})}};h.getEl().on("click",j);h.getEl().on("focusin",j)}}if(c.type&&(c.type==="edit"||c.type==="makeRecurring")){var e=c.down("combo[name=idLocal]");var m=c.down("textfield[name=reference]");var k=c.down("textfield[name=price]");var o=c.down("textfield[name=discount]");var b=c.down("textarea[name=description]");var f=c.down("numberfield[name=quantity]");var n=c.item;var g=Ext.create("AL.model.Item",n);var l=e.getStore();l.add(g);e.select(g);m.setValue(n.reference);k.setValue(n.priceSecondaryCurrency);o.setValue(n.discount);if(d.configs&&d.configs.country==="costaRica"){o.discount={discount:n.discount}}if(n.metadata){if(!c.configs){c.configs=d.configs}c.configs.country=d.configs.country;c.setFieldValuesFromMetadata(n.metadata)}b.setValue(n.description);f.setValue(n.quantity);this.updateTotal()}}},"recurringinvoice_FormAddItem numberfield[name=quantity]":{change:this.updateItemTotal},"recurringinvoice_FormAddItem textfield[name=price]":{change:this.updateItemTotal},"recurringinvoice_FormAddItem textfield[name=discount]":{change:this.updateItemTotal},"recurringinvoice_FormAddItem combo[name=idTax]":{render:function(f){var e=this;var d=f.up("form");var b=f.getStore();if(d.type&&(d.type==="edit"||d.type==="makeRecurring")){var c=d.item;if(b.hasLoaded()){f.select(c.idTax);e.updateTotal()}else{b.on("load",function(){f.select(c.idTax);e.updateTotal()})}}if(!b.hasLoaded()){b.load()}},change:this.updateTotal,beforeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0||(d.getValue()&&d.getValue()[0]===0)){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",true)}});d.setValue("[0]")}return b.get("disabled")?false:true}},beforedeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",false)}})}}}},"recurringinvoice_FormAddItem button[action=deleteItem]":{click:function(b){b.up("form").destroy();this.updateTotal()}},"recurringinvoice_RecurringInvoiceToolbar button[action=addRecurringInvoice]":{click:function(){window.location="/recurring-invoice/add"}},"recurringinvoice_GridAll gridcolumn[type=recurringInvoiceActions]":{click:function(b,c,h,g,k,l){var m=this.application;var f=Ext.get(k.target);var d=b.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("deleteRecurringInvoice")){k.preventDefault();m.fireEvent("deleteRecurringInvoice",{record:d,initiator:b})}}},"recurringinvoice_FormAddRecurringInvoice combo[name=idPriceList]":{change:function(d){var b=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");var c=this;Ext.each(b,function(g){var h=g.down("combo[name=idLocal]");var f=g.down("textfield[name=price]");var e=h.getSelectedRecord();if(e){c.getPrice(e,f);c.updateItemTotal(f)}})}},"recurringinvoice_FormAddRecurringInvoice combo[name=idWarehouse]":{afterrender:function(d){var c=d.up("form");var b=d.getStore();if(!b.hasLoaded()&&!b.isLoading()){b.load({callback:function(){if(c.type!="edit"&&c.type!="makeRecurring"){var e=b.findRecord("isMain","yes");if(e){d.select(e)}}}})}},select:function(c){var b=this;var d=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");Ext.each(d,function(g){var f=g.down("combo[name=idLocal]");var e=f.getStore().getProxy();e.clearCache();g.removeAll();g.destroy()});this.addItemForm()}},"recurringinvoice_FormAddRecurringInvoice combo[name=currency]":{change:function(g){var f=g.up("form");var d=f.down("displayfield[name=exchangeCurrencyDisplay]");var c=g.getSelectedRecord();if(c.get("code")&&c.get("code")!=f.configs.currency){d.show();f.currencySign=c.get("symbol")}else{d.hide();f.currencySign=null}var b=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");var e=this;Ext.each(b,function(k){var l=k.down("combo[name=idLocal]");var j=k.down("textfield[name=price]");var h=l.getSelectedRecord();if(h){j.suspendEvents();e.getPrice(h,j,"no");j.resumeEvents();e.updateItemTotal(j,"no")}});this.updateTotal()}},"recurringinvoice_FormAddRecurringInvoice switch[name=documentTypeSwitch]":{change:function(j){var f=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];if(!f){return}var h=f.down("combo[name=resolutionCombo]");var d=h.getStore();var c=d.getProxy();if(c.extraParams&&c.extraParams.documentType&&c.extraParams.documentType===j.value){return}c.setExtraParam("documentType",j.value);d.load({callback:function(l){var k=d.findRecord("isDefault","yes");if(!k){k=l[0]}if(k){h.select(k.data.idLocal)}if(d.count()>1){h.show()}}});if(f.configs.country!=="peru"){return}var e=f.down("combo[name=operationType]");var g=e.getStore();var b=g.getProxy();if(!b.filters||!b.filters.documentType||(b.filters.documentType&&b.filters.documentType!==j.value)){if(b.filters){b.filters.documentType=j.value}else{b.filters={documentType:j.value}}g.load({url:"/country-legal-info/retrieve-parameters-by-key/key/operationTypes/format/json?filters="+Ext.encode(b.filters),callback:function(){record=g.findRecord("value","Venta interna");e.setValue(record.data.id)}})}}},"recurringinvoice_FormAddRecurringInvoice combo[name=cr_saleCondition]":{change:function(g,e){var d=g.up("form");var f=d.down("combo[name=idTerm]");var c=f.getStore();var b=function(){var h=c.findRecord("idLocal",1);if(e==="CASH"){if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.select(h);f.disable();f.getSubmitData=a.getSubmitDataDisabled}else{if(e==="CREDIT"){c.remove(h);f.reset();f.enable()}else{if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.enable()}}};if(c.hasLoaded()){b()}else{c.on("load",{callback:function(){b()}})}}}})},saveRecurringInvoice:function(c){if(this.validateForms()){c.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("recurringSpecializedInvoice")});var a=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var e=Ext.getCmp("addItemPanel").items.getRange();var j=a.down("combo[name=resolutionCombo]");var d=j.getStore();var b=d.findRecord("idLocal",j.getValue());var h=[];var k=true;Ext.each(e,function(n){if(n.getForm){var l=n.getForm().getValues();if(!l.idTax||l.idTax==0){delete l.idTax}if(b&&b.get("isElectronicResolution")===true&&(a.configs.country=="costaRica"||a.configs.country=="peru")){var o="";if(l.description===""){k=false;o="La descripción de los "+translate("items")+" es un campo obligatorio para "+translate("stamp")+" "+translate("invoices")}if(!k){GlobalMsg.showErrorMessage("Error",o);GlobalRedirector.close();c.enable()}}if(l.discount===""){l.discount=0}var m=n.getFieldValuesAsMetadata();if(m){l.metadata=Ext.encode(m)}h.push(l)}});if(k){var g=a.getValues();g.items=Ext.encode(h);var f=a.getFieldValuesAsMetadata();if(f){g.metadata=Ext.encode(f)}Ext.Ajax.request({url:"/recurring-invoice/add/format/json",method:"POST",params:g,success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){var o=n.results;window.location="/recurring-invoice/view/id/"+o}else{c.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",n.cause)}},failure:function(){c.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                                Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},selectPaymentMethodAndType:function(h){try{var f=h.up("form");var c=h.getSelectedRecord();if(!c){return}var d=c.getData();if(f.configs){switch(f.configs.country){case"mexico":var b=f.down("combo[name=paymentType]");var a=f.down("combo[name=paymentMethod]");if(d.metadata.paymentType||d.metadata.paymentMethod){if(d.metadata.paymentType){if(b){b.setValue(d.metadata.paymentType)}}if(d.metadata.paymentMethod){if(a){a.setValue(d.metadata.paymentMethod.toLowerCase())}}}else{if(b){b.setValue("PUE")}if(a){a.setValue("cash")}}break}}}catch(g){console.warn(g.message)}},editRecurringInvoice:function(e){if(this.validateForms()){e.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("recurringInvoice")});var f=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var c=Ext.getCmp("addItemPanel").items.getRange();var b=[];Ext.each(c,function(l){if(l.getForm){var g=l.getForm().getValues();if(g.idLocal==="old"){g.idLocal=g.oldId}else{delete g.itemName}if(g.idTax==="old"){var j=l.down("combo[name=idTax]");var k=j.actualTax;if(k.get("currentId")){g.idTax=k.get("currentId");g.taxName=k.get("name");g.tax=k.get("tax")}else{delete g.idTax}g.taxName=k.get("name");g.tax=k.get("tax")}else{if(!g.idTax||g.idTax==0){delete g.idTax}}delete g.oldId;var h=l.getFieldValuesAsMetadata();if(h){g.metadata=Ext.encode(h)}b.push(g)}});var f=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var a=f.getValues();if(a.idClient==="old"){a.idClient=a.oldIdClient;delete a.oldIdClient}else{delete a.oldClientName;delete a.oldIdClient}delete a.days;a.items=Ext.encode(b);var d=f.getFieldValuesAsMetadata();if(d){a.metadata=Ext.encode(d)}Ext.Ajax.request({url:"/recurring-invoice/edit/format/json",method:"POST",params:a,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var k=j.results;window.location="/recurring-invoice/view/id/"+k}else{GlobalMsg.showErrorMessage("Error",j.cause);e.enable();GlobalRedirector.close()}},failure:function(){e.enable();GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},makeRecurringInvoice:function(e){if(this.validateForms()){e.disable();var c=Ext.getCmp("addItemPanel").items.getRange();var b=[];Ext.each(c,function(l){if(l.getForm){var g=l.getForm().getValues();if(g.idLocal==="old"){g.idLocal=g.oldId}else{delete g.itemName}if(g.idTax==="old"){var j=l.down("combo[name=idTax]");var k=j.actualTax;if(k.get("currentId")){g.idTax=k.get("currentId");g.taxName=k.get("name");g.tax=k.get("tax")}else{delete g.idTax}g.taxName=k.get("name");g.tax=k.get("tax")}else{if(!g.idTax||g.idTax==0){delete g.idTax}}delete g.oldId;var h=l.getFieldValuesAsMetadata();if(h){g.metadata=Ext.encode(h)}b.push(g)}});var f=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var a=f.getValues();if(a.idClient==="old"){a.idClient=a.oldIdClient;delete a.oldIdClient}else{delete a.oldClientName;delete a.oldIdClient}delete a.days;a.items=Ext.encode(b);var d=f.getFieldValuesAsMetadata();if(d){a.metadata=Ext.encode(d)}Ext.Ajax.request({url:"/recurring-invoice/make-recurring/format/json",method:"POST",params:a,success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var k=j.results;window.location="/recurring-invoice/view/id/"+k}else{GlobalMsg.showErrorMessage("Error",j.cause);e.enable()}},failure:function(){e.enable()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(c){var o=c.down("combo[name=idTerm]");var p=o.getStore();var k=p.getProxy();k.extraParams={displayNone:"false"};p.load();var l=this;var q=Ext.get("addOtherItem");q.on("click",function(){this.addItemForm();var s=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");if(s.length===200){Ext.Msg.show({title:"Límite de "+translate("items")+" alcanzado",msg:"Al agregar más "+translate("items")+" no podrás imprimir o descargar la "+translate("invoice")+" que se creará.",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var m=c.down("combo[name=currency]");var n=m.getStore();n.load({callback:function(){var s=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});n.add(s);m.select(c.configs.currency)}});if(c.configs.multicurrency=="yes"){m.show()}if(!c.configs.showWarehouses){c.down("combo[name=idWarehouse]").hide()}if(c.configs&&c.configs.country==="peru"){var j=c.down("switch[name=documentTypeSwitch]");if(j){if(c.configs.companyRegime==="NEW_RUS"){j.hide();j.setValue("saleTicket")}else{j.show()}var b=Ext.ComponentQuery.query("combo[name=resolutionCombo]")[0];var g=b.getStore();var k=g.getProxy();var d=j.getOptionSelected();k.setExtraParam("documentType",d.value);g.load()}var f=c.down("combo[name=operationType]");var r=f.getStore();var e=r.getProxy();if(!e.filters||!e.filters.documentType||(e.filters.documentType&&e.filters.documentType!==d.value)){if(e.filters){e.filters.documentType=d.value}else{e.filters={documentType:d.value}}e.url="/country-legal-info/retrieve-parameters-by-key/key/operationTypes/format/json?filters="+Ext.encode(e.filters);r.load({callback:function(s){record=r.findRecord("value","Venta interna");if(record){f.setValue(record.data.id);if(c.configs&&c.configs.ublVersion!=="2.1"){f.setDisabled(true)}}}})}}if(c.type){var a=c.idLocal;if(c.type==="edit"){Ext.Ajax.request({url:"/recurring-invoice/retrieve-info/id/"+a+"/format/json",success:function(x,X){var D=Ext.decode(x.responseText);if(D.success){var K=D.results;c.decimalPrecision=K.recurringInvoice.decimalPrecision;var C=K.recurringInvoice;var L=K.items;var s=c.down("hidden[name=idLocal]");var ae=c.down("hidden[name=oldClientName]");var y=c.down("hidden[name=oldIdClient]");var J=c.down("combo[name=idClient]");var F=c.down("datefield[name=startDate]");var z=c.down("datefield[name=endDate]");var Z=c.down("combo[name=idTerm]");var ag=c.down("numberfield[name=repeatEvery]");var Q=c.down("textarea[name=observations]");var w=c.down("textarea[name=anotation]");var M=c.down("combo[name=resolutionCombo]");var P=c.down("combo[name=idPriceList]");var W=M.getStore();var ad=c.down("combo[name=cfdiUse]");var H=c.down("combo[name=paymentType]");if(C.metadata){c.setFieldValuesFromMetadata(C.metadata)}if(c.configs){switch(c.configs.country){case"mexico":if(C.paymentMethod){var G=c.down("combo[name=paymentMethod]");var ab=c.down("textfield[name=accountNumber]");G.setValue(C.paymentMethod);if(C.accountNumber){ab.setValue(C.accountNumber)}if(H&&C.paymentType){H.setValue(C.paymentType)}}if(C.identification){if(C.identification.length==12){Ext.getStore("CFDIUseList").filter("personType","both");if(C.cfdiUse&&C.cfdiUse[0]!="D"){ad.setValue(C.cfdiUse)}}else{Ext.getStore("CFDIUseList").clearFilter();ad.setValue(C.cfdiUse)}}else{ad.setValue(C.cfdiUse)}break;default:break}}var E=c.down("combo[name=idWarehouse]");if(C.warehouse&&C.warehouse.idLocal){var O=E.getStore();if(!O.hasLoaded()&&!O.isLoading()){O.on("load",function(){var ah=Ext.create("AL.model.Warehouse",C.warehouse);O.add(ah);E.select(ah)})}else{var U=Ext.create("AL.model.Warehouse",C.warehouse);O.add(U);E.select(U)}}if(c.configs&&c.configs.country==="peru"){var Y=c.down("switch[name=documentTypeSwitch]");if(Y){var T=Y.findOptionById(C.resolutionDocumentType);if(T){Y.select(T)}}}W.load({callback:function(){var ah=W.findRecord("idLocal",C.resolutionidLocal);if(!ah){var ah=Ext.create("AL.model.Resolution",{idLocal:C.resolutionidLocal,name:C.resolutionName});W.add(ah)}M.select(ah);if(W.count()>1){M.show()}}});s.setValue(C.idLocal);var u=J.getStore();var ac=Ext.create("AL.model.Client",{idLocal:C.idClient,name:C.name});u.add(ac);J.select(ac);if(C.idPriceList){var af=P.getStore();if(!af.hasLoaded()){af.on("load",function(){var ah=af.findRecord("idLocal",C.idPriceList);P.suspendEvents();P.select(ah);P.resumeEvents(true)})}else{var S=af.findRecord("idLocal",C.idPriceList);P.select(S)}}if(c.configs.multicurrency=="yes"){var B=c.down("combo[name=currency]");var t=B.getStore();B.show();var A=function(){var ah=t.findRecord("code",c.configs.currency);if(!ah){ah=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,exchangeRate:1});t.add(ah);c.companyCurrencies=t.getRange(0,t.getCount())}var ai=null;if(C.currencyCode){ai=t.findRecord("code",C.currencyCode);if(!ai){ai=Ext.create("AL.model.CompanyCurrency",{code:C.currencyCode,symbol:C.currencySymbol});if(ai&&ai.code){t.add(ai)}}}if(!ai){ai=ah}B.select(ai)};if(t.hasLoaded()){A()}else{t.load({callback:function(){A()}})}}var R=Z.getStore();R.addListener("load",function(){var aj=null;var ai=R.findBy(function(al,am){aj=al.get("idLocal");return(al.get("days")==C.term)});if(ai>-1){Z.select(aj)}var ah=AL.date(C.startDate);ah=Ext.Date.format(ah,"d/m/Y");F.setValue(ah);if(C.endDate){var ak=AL.date(C.endDate);ak=Ext.Date.format(ak,"d/m/Y");z.setValue(ak)}if(!C.datesEditable){F.disable();z.disable();ag.disable()}});R.load();ag.setValue(C.repeatEvery);Q.setValue(C.observations);w.setValue(C.anotation);var N=Ext.ComponentQuery.query("#addItemPanel")[0];var V=c.configs.canCreateNewTax;var v=c.configs.canCreateNewWarehouse;var aa=c.configs.canCreateNewItem;var I=c.configs.multipleTaxes;Ext.each(L,function(ai){var ah=Ext.create("AL.view.recurringinvoice.FormAddItem",{type:"edit",item:ai,canCreateNewTax:V,canCreateNewWarehouse:v,canCreateNewItem:aa,multipleTaxes:I});N.add(ah)})}else{}},failure:function(){}})}else{if(c.type==="makeRecurring"){var h=c.invoiceIdLocal;Ext.Ajax.request({url:"/invoice/retrieve-info/id/"+h+"/format/json",success:function(s,u){var G=Ext.decode(s.responseText);if(G.success){var P=G.results;var O=P.invoice;var N=P.items;var K=c.down("hidden[name=idLocal]");var B=c.down("hidden[name=oldClientName]");var I=c.down("hidden[name=oldIdClient]");var A=c.down("combo[name=idClient]");var R=c.down("datefield[name=startDate]");var S=c.down("datefield[name=endDate]");var M=c.down("combo[name=idTerm]");var t=c.down("textarea[name=anotation]");var w=c.down("combo[name=resolutionCombo]");var V=c.down("combo[name=idPriceList]");var Q=c.down("combo[name=cfdiUse]");if(O.cfdiUse){Q.setValue(O.cfdiUse)}K.setValue(O.idLocal);t.setValue(O.anotation);var F=c.down("combo[name=idWarehouse]");if(O.warehouse&&O.warehouse.idLocal){var U=F.getStore();if(!U.hasLoaded()&&!U.isLoading()){U.on("load",function(){var X=Ext.create("AL.model.Warehouse",O.warehouse);U.add(X);F.select(X)})}else{var y=Ext.create("AL.model.Warehouse",O.warehouse);U.add(y);F.select(y)}}if(c.configs&&c.configs.country==="peru"){var E=c.down("switch[name=documentTypeSwitch]");if(E){var J=E.findOptionById(O.resolutionDocumentType);if(J){E.select(J)}}}var H=w.getStore();if(!H.hasLoaded()){H.on("load",function(){var Y=H.findRecord("idLocal",O.resolutionIdLocal);if(Y){w.select(Y.data.idLocal)}else{var X=H.findRecord("isDefault","yes");if(X){w.select(X.data.idLocal)}else{w.show()}}if(H.count()>1){w.show()}})}else{var z=H.findRecord("idLocal",O.resolutionIdLocal);if(z){w.select(z.data.idLocal)}else{var y=H.findRecord("isDefault","yes");if(y){w.select(y.data.idLocal)}else{w.show()}}if(H.count()>1){w.show()}}var D=A.getStore();A.getStore().addListener("load",function(){var ab=null;var Z=null;var Y=null;var X=D.findBy(function(ac,ad){ab=ac.get("idLocal");Z=ac.get("name");Y=ac;return(ab==O.idClient&&Z==O.name)});if(X>-1){A.select(ab)}else{I.setValue(O.idClient);B.setValue(O.name);Y=Ext.create("AL.model.Client",{idLocal:"old",name:O.name});A.select(Y)}l.getContact(A,[Y]);if(c.configs.country=="mexico"&&P.invoice&&P.invoice.cfdiUse){var aa=c.down("combo[name=cfdiUse]");if(aa){aa.setValue(P.invoice.cfdiUse)}}});D.load();setTimeout(function(){if(O.idPriceList){var ab=V.getStore();if(!ab.hasLoaded()){ab.on("load",function(){var ae=ab.findRecord("idLocal",O.idPriceList);V.select(ae)})}else{var Z=ab.findRecord("idLocal",O.idPriceList);V.select(Z)}}var aa=Ext.ComponentQuery.query("#addItemPanel")[0];var ac=c.configs.canCreateNewTax;var X=c.configs.canCreateNewWarehouse;var Y=c.configs.canCreateNewItem;var ad=c.configs.multipleTaxes;Ext.each(N,function(af){var ae=Ext.create("AL.view.recurringinvoice.FormAddItem",{type:"makeRecurring",item:af,canCreateNewTax:ac,canCreateNewWarehouse:X,canCreateNewItem:Y,multipleTaxes:ad});aa.add(ae)})},1300);switch(c.configs.country){case"mexico":if(P.invoice&&P.invoice.paymentType){if(P.invoice.paymentType=="PUE"&&P.invoice.paymentMethod){var L=c.down("combo[name=paymentType]");if(L){L.setValue(P.invoice.paymentType)}var C=c.down("combo[name=paymentMethod]");if(C){C.setValue(P.invoice.paymentMethod)}if(P.invoice.accountNumber){var v=c.down("textfield[name=accountNumber]");if(v){v.setValue(P.invoice.accountNumber)}}}else{if(P.invoice.paymentType=="PPD"){var L=c.down("combo[name=paymentType]");if(L){L.setValue(P.invoice.paymentType)}}}}break}if(c.configs.multicurrency=="yes"){var W=c.down("combo[name=currency]");var x=W.getStore();W.show();if(x.hasLoaded()){var T=x.findRecord("code",O.currencyCode);if(!T){T=Ext.create("AL.model.CompanyCurrency",{code:O.currencyCode,symbol:O.currencySymbol});if(T&&T.code){x.add(T)}}W.select(T)}else{x.on("load",function(){var X=x.findRecord("code",O.currencyCode);if(!X){X=Ext.create("AL.model.CompanyCurrency",{exchangeRate:1,code:O.currencyCode,symbol:O.currencySymbol});if(X&&X.code){x.add(X)}}W.select(X)})}}if(O.metadata){c.setFieldValuesFromMetadata(O.metadata)}}else{}},failure:function(){}})}}}else{Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(s,u){var w=Ext.decode(s.responseText,true);if(w&&w.success){var t=w.results;if(t.invoiceAnotation){var v=c.down("textarea[name=anotation]");v.setValue(t.invoiceAnotation)}}}})}},addItemForm:function(){var c=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var b=Ext.create("AL.view.recurringinvoice.FormAddItem",{canCreateNewTax:c.configs.canCreateNewTax,canCreateNewWarehouse:c.configs.canCreateNewWarehouse,canCreateNewItem:c.configs.canCreateNewItem,multipleTaxes:c.configs.multipleTaxes});a.add(b)},getItem:function(d,e,h,j){var g=e[0];var c=d.up("form");var m=c.down("textfield[name=reference]");var l=c.down("textfield[name=price]");var n=c.down("textfield[name=discount]");var a=c.down("textarea[name=description]");var f=c.down("numberfield[name=quantity]");var b=c.down("textfield[name=idTax]");m.setValue(g.get("reference"));f.setValue(1);n.setValue(0);a.setValue(g.get("description"));var k=function(){if(!g.get("idTax")||g.get("idTax")=="null"){return b.select(0)}var p=[];var o=g.get("taxes");Ext.each(o,function(q){if(q.status==="inactive"){b.select(0)}else{p.push(q.id)}});if(p.length>0){b.setValue(p)}};if(b.getStore().isLoading()){b.getStore().on("load",k)}else{k()}this.getPrice(g,l);this.updateItemTotal(l);d.up("form").enableFields()},getPrice:function(c,j,e){var f=c.get("priceList");var d=AL.math.approx(c.get("price"));var h=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var b=Ext.ComponentQuery.query("combo[name=currency]")[0];var a=b.getSelectedRecord();var g=1;if(a&&a.get("exchangeRate")){g=a.get("exchangeRate")}if(e=="no"){d=AL.math.approx(AL.math.div(d,g),null,3);j.setValue(d)}else{if(!f){Ext.Ajax.request({url:"/item/retrieve-price-list/format/json/id/"+c.get("idLocal"),success:function(k,m){var n=Ext.decode(k.responseText);var l=n.results;var o=l;c.set("priceList",o);if(o[h.getValue()]){d=AL.math.approx(o[h.getValue()]);d=AL.math.approx(AL.math.div(d,g),null,3);j.setValue(d)}else{d=AL.math.approx(AL.math.div(d,g),null,3);j.setValue(d)}}})}else{if(f[h.getValue()]){d=AL.math.approx(f[h.getValue()]);d=AL.math.approx(AL.math.div(d,g),null,3);j.setValue(d)}else{d=AL.math.approx(AL.math.div(d,g),null,3);j.setValue(d)}}}},getContact:function(b,c,j){var g=c[0];var l=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice combo[name=idTerm]")[0];var a=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];if(g.get("idTerm")){var d=Ext.create("AL.model.Term",{idLocal:g.get("idTerm"),days:g.get("termDays"),name:g.get("termName")});l.select(d)}else{if(!l.disabled){l.setRawValue(null)}}var h=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];if(g.get("idPriceList")){var e=h.getStore(),k=function(){var o=e.findRecord("idLocal",g.get("idPriceList"));if(o){h.select(o)}else{var n=e.findRecord("main","yes");h.select(n)}};if(!e.hasLoaded()){e.load()}else{k()}e.on("load",k)}else{var m=h.findRecord("main","yes");h.select(m)}var f=Ext.ComponentQuery.query("combo[name=cfdiUse]")[0];if(a.configs.country=="mexico"&&g.data.identification&&f){if(g.data.identification.length==12){Ext.getStore("CFDIUseList").filter("personType","both");if(g.getData()["cfdiUse"]&&g.getData().cfdiUse.length>0&&g.getData().cfdiUse[0]!="D"){f.setValue(g.getData().cfdiUse)}}else{Ext.getStore("CFDIUseList").clearFilter();f.setValue(g.getData().cfdiUse)}}},updateTotal:function(){var e={};var h=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");var b=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var c=0;var g=0;var d=0;var f=0;Ext.each(h,function(t){var r=t.down("combo[name=idTax]");var u=t.down("textfield[name=price]");var m=t.down("numberfield[name=quantity]");var w=t.down("textfield[name=discount]");var q=null;var s=typeof(r.getValue())=="string"?[r.getValue()]:r.getValue();if(t.type&&t.type==="edit"){if(r.getValue()==="old"){q=r.actualTax}}if(r.getValue()||r.findRecordByValue(r.getValue())){var l;var k;var v=AL.math.approx(u.getValue(),null,b.decimalPrecision);var n=m.getValue()?m.getValue():0;if(w.getValue()){l=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(v,AL.math.sub(1,AL.math.div(w.getValue(),100))),null,b.decimalPrecision),n),null,b.decimalPrecision);k=AL.math.approx(AL.math.mul(v,n),null,b.decimalPrecision)}else{l=AL.math.approx(AL.math.mul(v,n),null,b.decimalPrecision);k=l}f=AL.math.add(f,k);c=AL.math.add(c,l);var p=0;var o=0;Ext.each(s,function(y){q=r.findRecordByValue(y);if(q){p=AL.math.add(p,AL.math.approx(AL.math.mul(l,AL.math.div(q.get("tax"),100)),null,b.decimalPrecision));var x=q.get("name")+q.get("tax");if(e[x]){e[x].value=AL.math.add(e[x].value,AL.math.approx(AL.math.mul(l,AL.math.div(q.get("tax"),100)),null,b.decimalPrecision))}else{e[x]={label:q.get("name")+" ("+Ext.util.Format.round(q.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(l,AL.math.div(q.get("tax"),100)),null,b.decimalPrecision)}}}else{g=AL.math.add(g,l)}});g=AL.math.add(g,AL.math.add(l,p))}});var a=b&&b.currencySign?b.currencySign:null;var j=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];j.removeAll();j.addItem({label:translate("subTotal",true),value:f,important:true,decimalPrecision:b.decimalPrecision,currencySign:a});j.addItem({label:translate("discount",true),value:AL.math.approx(c-f),important:true,decimalPrecision:b.decimalPrecision,currencySign:a});j.addItem({label:translate("subTotal",true),value:c,important:true,decimalPrecision:b.decimalPrecision,currencySign:a});Ext.Object.each(e,function(k,l){l.value=AL.math.approx(l.value,null,b.decimalPrecision);l.decimalPrecision=b.decimalPrecision;l.currencySign=a;j.addItem(l)});j.addItem({label:translate("total",true),value:g,important:true,decimalPrecision:b.decimalPrecision,currencySign:a});return{subTotal:c,taxes:e,total:g}},updateItemTotal:function(j,f,d,g){var b=j.up("form");var k=b.down("textfield[name=price]");var h=b.down("displayfield[name=total]");var e=b.down("numberfield[name=quantity]");var l=b.down("textfield[name=discount]");var c=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var a=c.currencySign?c.currencySign:null;if(k.isValid()&&e.isValid()){h.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(AL.math.approx(k.getValue(),null,c.decimalPrecision),AL.math.sub(1,AL.math.div(l.getValue(),100))),null,c.decimalPrecision),e.getValue()),null,c.decimalPrecision),c.decimalPrecision,a))}this.updateTotal()},goInvoiceDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/recurring-invoice/view/id/"+h},setRightClickEvent:function(c){var a=c.getView();var b=this.application;a.on("itemcontextmenu",function(e,d,j,g,h,f){h.preventDefault();Ext.create("Ext.menu.Menu",{width:134,margin:"0 0 10 0",record:d,listeners:{click:function(n,l,m,k){if(l.action&&l.action==="deleteRecurringInvoice"){b.fireEvent("deleteRecurringInvoice",{record:d,initiator:c})}else{window.location=l.actionUrl}}},items:[{text:translate("seeDetail",true),iconCls:"viewDetailIcon",actionUrl:"/recurring-invoice/view/id/"+d.get("idLocal")},{text:translate("edit",true),iconCls:"editIcon",actionUrl:"/recurring-invoice/edit/id/"+d.get("idLocal")},{text:translate("remove",true),iconCls:"deleteIcon",action:"deleteRecurringInvoice",actionUrl:"/recurring-invoice/delete/id/"+d.get("idLocal")}]}).showAt(h.getXY())})},validateForms:function(){var a=Ext.ComponentQuery.query("recurringinvoice_FormAddRecurringInvoice")[0];var b=Ext.ComponentQuery.query("recurringinvoice_FormAddItem");var d=a.getForm();var c=true;if(d.isValid()){if(b.length===0){c=false}else{Ext.each(b,function(g){var f=g.getForm();if(!f.isValid()){c=false}})}}else{c=false}if(a.configs.country==="costaRica"){if(a.configs.isActiveElectronicInvoicing){var e=Ext.ComponentQuery.query("combo[name=economicActivity]")[0];if(e&&!e.getSelectedRecord()){e.markInvalid("Selecciona una actividad de la lista");c=false}}}return c},getSubmitDataDisabled:function(){var a=this,b=null;if(!a.isFileUpload()){b={};b[a.getName()]=a.getValue()}return b}});Ext.define("AL.view.remission.FormAddItem",{extend:"AL.view.common.FormAddItem",alias:"widget.remission_FormAddItem"});Ext.define("AL.controller.Remission",{extend:"Ext.app.Controller",views:["remission.FormAddRemission","remission.FormAddItem","remission.FormAdvancedOptions","remission.GridAll","remission.MoreActionsButton","remission.BottomContainer","item.FormEditDiscount","invoice.TotalLeftContainer",],stores:["Remissions","Items","Clients","SellersCombo","PriceListCombo","CompanyCurrenciesCombo","WarehouseCombo","SalesConcepts","CostCentersCombo",],models:["Remission","Item","Client","Seller","PriceList","CompanyCurrency","Warehouse","CostCenter",],init:function(){this.application.addListener("clientCreated",function(h){var g=h.initiator;var e=h.record;var f=g.getStore();f.add(e);g.select(e.get("idLocal"));this.getContact(g,[e])},this);this.application.addListener("itemCreatedRemission",function(g){var e=g.initiator;var h=g.record;var n=e.getStore();var m=false;if(h.get("isInventariable")=="yes"&&h.get("warehouses")){var o=Ext.decode(h.get("warehouses"));var f=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var l=f.getSelectedRecord().get("idLocal");Ext.each(o,function(p){if(p.id==l){m=true;return}})}else{m=true}var k=h.multipleTaxes=="yes"?Ext.decode(h.get("idTax")):[h.get("idTax")];var j=[];Ext.each(k,function(p){j.push({id:p})});h.set("taxes",j);if(m){n.add(h);n.getProxy().clearCacheByTerms([h.get("name"),h.get("reference")]);e.select(h.get("idLocal"));e.fireEvent("select2",{combo:e,record:h})}else{GlobalMsg.showNotification({title:"Advertencia",text:"El "+translate("item")+" se creó pero no se agregó a "+translate("theRemission")+" "+translate("remission")+" ya que éste no se encuentra en "+translate("theWarehouse")+" "+translate("warehouse")+" seleccionada",type:"warning"})}},this);this.application.addListener("deleteRemission",function(g){var e=g.record;var f=g.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("remission")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theRemission")+" "+translate("remission")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/remission/delete/format/json",method:"POST",params:{id:e.get("idLocal")},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){var j=f.getStore();j.load()}else{if(m.cause){Ext.MessageBox.alert("Error",m.cause)}}},failure:function(){}})}}})},this);this.application.addListener("convertRemissionToOpen",function(g){var e=g.record;var f=g.initiator;Ext.Ajax.request({url:"/remission/convert-to-open/id/"+e.get("idLocal")+"/format/json",success:function(j,k){var l=Ext.decode(j.responseText);if(l.success){if(f){var h=f.getStore();h.load()}else{window.location="/remission/view/id/"+e.get("idLocal")}}}})},this);this.application.addListener("voidRemission",function(g){var e=g.record;var f=g.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("remission"),msg:translate("areYouSureYouWantTo",true)+" "+translate("cancel")+" "+translate("theRemission")+" "+translate("remission")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(h){if(h=="yes"){Ext.Ajax.request({url:"/remission/void/format/json",method:"POST",params:{id:e.get("idLocal")},success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){if(f){var j=f.getStore();j.load()}else{window.location="/remission/view/id/"+e.get("idLocal")}}else{if(m.cause){Ext.MessageBox.alert("Error",m.cause)}}},failure:function(){}})}}})},this);var a=Ext.select("a[data-action=voidRemission]");if(a.elements.length>0){a.on("click",function(j,k){j.preventDefault();var g=Ext.get(k);var h=g.getAttribute("data-idRemission");var f=Ext.create("AL.model.Remission",{idLocal:h});this.application.fireEvent("voidRemission",{initiator:null,record:f})},this)}var d=Ext.get("printRemissionLink");if(d){d.on("click",function(g,f){g.preventDefault();if(f.getAttribute("data-canPrintOrDownload")){var h=f.getAttribute("data-id");var e=window.open("/remission/print/id/"+h);e.print()}})}var c=Ext.get("emailRemission");if(c){c.on("click",function(j,f){var l=f.getAttribute("data-id");var e=f.getAttribute("data-idClient");var g=f.getAttribute("data-canEmail");var h=f.getAttribute("data-name");var k=function(){var m=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(m){m.destroy();f.setAttribute("data-canEmail","yes")}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+e+"/format/json/email-template/remission/idDocument/"+l,success:function(o,q){var s=Ext.decode(o.responseText);if(s.success){var n=[];if(s.results){var p=s.results;if(s.emailTemplate){n.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:s.emailTemplate.subject});n.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:s.emailTemplate.message});n.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}n.push({xtype:"box",style:"color: #67948E; margin-bottom:10px",html:translate("emailAddressesAssociatedWithThisClient",true)});if(s.clientEmail){n.push({boxLabel:s.clientEmail+" - ("+s.clientName+")",name:"email",record:{name:s.clientName,email:s.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(p.length==0){n.push({xtype:"box",style:"color: #999; font-size:11px",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(p,function(t){n.push({boxLabel:t.email+" - ("+t.name+" "+t.lastName+")",name:"email",record:t,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}n.push({xtype:"box",style:"color: #67948E; margin-bottom:2px; margin-top:20px",html:translate("youCanAlsoSend",true)+"  "+translate("thisRemission")+" "+translate("remission")+" "+translate("toAParticularEmailOrSendTo")},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var r=Ext.create("AL.view.common.SmileWindow",{reason:"confirmRemissionEmail",id:"window-remission-send-to-emails",number:l,title:translate("send",true)+" "+translate("remission")+" "+translate("toTheseEmails"),height:500,bodyPadding:"0 35 35 35",width:600,modal:true,items:{xtype:"form",items:n,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(t){var v=t.up("window");var u=v.down("button[action=confirmEmail]");if(u){u.fireEvent("click",u)}}}]}});r.show()}else{Ext.Msg.alert("Error",s.cause)}},failure:function(){}})};if(g==="yes"){k()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theRemission")+" "+translate("remission")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),forEmail:true,number:l,callback:k,resourceTrigger:"remission"})}})}var b=Ext.get("invoiceRemission");if(b){b.on("click",function(g,e){g.preventDefault();var f=e.getAttribute("data-warehouseStatus");if(f=="inactive"){GlobalMsg.showNotification({title:"Error",text:translate("theRemission",true)+" "+translate("remission")+" no se puede facturar ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=e.getAttribute("href")}})}this.control({"buttons_SubmitReset button[action=save]":{click:this.saveRemission},"buttons_SubmitReset button[action=edit]":{click:this.editRemission},invoice_TotalLeftContainer:{afterrender:function(g){if(g.configs){var f=g.down("box[name=signatureBox]");if(g.configs.userSignatureUrl){var e=new Image;e.onload=function(k){var j=(e.width*Math.min(f.configs.maxHeight,e.height))/e.height;var h="";if(j<f.configs.maxWidth){h="width: auto; max-height: "+f.configs.maxHeight+"px;"}else{h="height: auto; max-width: "+f.configs.maxWidth+"px;"}f.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+g.configs.userSignatureUrl+'" style="margin: 0 auto; '+h+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+f.configs.madeByText+"</div></div>")};e.src=g.configs.userSignatureUrl}else{if(g.configs.disableSignatureEditing){f.update()}}}}},"invoice_TotalLeftContainer box[name=signatureBox]":{render:function(f){var e=f.up("totalleftcontainer");if(!e.configs.disableSignatureEditing){this.promptFileUploadWindowOnClick(f,"signatureUrl",true,{asyncUpload:true,title:translate("changeSignature",true),url:"/company/set-signature/format/json",fieldName:"signature",fieldLabel:translate("signature",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingSignature",true)})}}},"remission_FormAddItem combo[name=idTax]":{render:function(j){var h=j.up("form");var g=this;var e=j.getStore();if(h.type&&h.type==="edit"){var f=h.itemRemission;if(e.hasLoaded()){j.suspendEvents();j.select(f.idTax);j.resumeEvents();j.fireEvent("taxComboRendered")}else{e.on("load",function(){j.suspendEvents();j.select(f.idTax);j.resumeEvents();j.fireEvent("taxComboRendered")})}}if(!e.hasLoaded()&&!e.isLoading()){e.load()}},change:this.updateTotal,beforeselect:function(g,e,f){if(g.multiSelect==true){if(e.get("idLocal")===0||(g.getValue()&&g.getValue()[0]===0)){g.getStore().each(function(h){if(h.get("idLocal")!==0){h.set("disabled",true)}});g.setValue("[0]")}return e.get("disabled")?false:true}},beforedeselect:function(g,e,f){if(g.multiSelect==true){if(e.get("idLocal")===0){g.getStore().each(function(h){if(h.get("idLocal")!==0){h.set("disabled",false)}})}}}},remission_FormAddItem:{afterrender:function(f){var j=Ext.ComponentQuery.query("remission_FormAddRemission")[0];if(j.configs.changeItemsPrices==="no"){var p=f.down("textfield[name=price]");p.setReadOnly(true);p.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}var m=f.down("textfield[name=discount]");if(j.configs.changeDiscount==="no"){m.setReadOnly(true);m.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}var k=this.showFormEditDiscount();if(k){var n=function(){var t=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!t){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:m,valueDiscountMax:j.configs.valueDiscountMax,isActiveElectronicInvoicing:j.configs.isActiveElectronicInvoicing,country:j.configs.country}})}};m.getEl().on("click",n);m.getEl().on("focusin",n)}if(f.type&&f.type==="edit"){var o=f.itemRemission;var l=Ext.create("AL.model.Item",o);var g=f.down("combo[name=idLocal]");var r=f.down("textfield[name=reference]");var p=f.down("textfield[name=price]");var s=f.down("textfield[name=discount]");var e=f.down("textarea[name=description]");var h=f.down("numberfield[name=quantity]");this.changeStoreItemsToSaleConcept(f);var q=g.getStore();q.add(l);g.select(l);p.suspendEvents();s.suspendEvents();h.suspendEvents();p.setValue(o.priceSecondaryCurrency);r.setValue(o.reference);s.setValue(o.discount);e.setValue(o.description);h.setValue(o.quantity);if(k){s.discount={discount:o.discount,discountNature:o.discountNature}}p.resumeEvents();s.resumeEvents();h.resumeEvents();this.updateItemTotal(p,"no")}}},"remission_FormAddRemission combo[name=days]":{change:function(e){this.changeDueDateFromDays(e.getSelectedRecord())}},"remission_FormAddRemission hidden[name=exchangeCurrency]":{change:function(j){var e=Ext.ComponentQuery.query("remission_FormAddItem");var h=this;var k=j.up("form");var g=k.down("combo[name=currency]");var f=g.getSelectedRecord();if(f.get("code")!=k.configs.currency){k.currencySign=f.get("symbol")}else{k.currencySign=null}Ext.each(e,function(n){var o=n.down("combo[name=idLocal]");var m=n.down("textfield[name=price]");var l=o.getSelectedRecord();if(l){m.suspendEvents();h.getPrice(l,m,"no");m.resumeEvents();h.updateItemTotal(m,"no")}});this.updateTotal()}},"remission_FormAddRemission combo[name=currency]":{change:function(l){var k=l.up("form");var h=k.down("displayfield[name=exchangeCurrencyDisplay]");var g=k.down("hidden[name=exchangeCurrency]");var e=l.getSelectedRecord();var f=this.application;if(e&&e.get("code")&&e.get("code")!=k.configs.currency){h.show();h.setValue("1 "+e.get("code")+" = "+Ext.util.Format.round(e.get("exchangeRate"),8)+" "+k.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');g.setValue(Ext.util.Format.round(e.get("exchangeRate"),8));var j=Ext.get("editExchangeRate");if(j){j.on("click",function(n){n.preventDefault();var m={};m.currency=e.get("code");m.initiator=h;m.currencyRecord=e;f.fireEvent("editExchangeRate",m)})}}else{h.hide();g.setValue(null)}}},"remission_FormAddItem combo[name=idLocal]":{beforerender:function(f){var e=f.up("form");if(e.canCreateNewItem){f.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl><div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newM",true)+" "+translate("item")+"</a></div>"}},render:function(l){var j=l.up("form");var f=Ext.create("AL.store.ItemsCombo");var k=Ext.ComponentQuery.query("remission_FormAddRemission")[0];if(k.configs.showWarehouses){var e=k.down("combo[name=idWarehouse]");var g=f.getProxy();var m=null;if(e.getValue()){if(typeof e.getValue()=="string"){m=e.getValue()}else{m=e.getValue().get("idLocal")}g.extraParams={idWarehouse:m}}else{var h=e.getStore();h.on("load",function(){var n=h.findRecord("isMain","yes");m=n.get("idLocal");g.extraParams={idWarehouse:m}})}}l.store=f;this.changeStoreItemsToSaleConcept(j);if(j.idItem){Ext.Ajax.request({url:"/item/retrieve-one/id/"+j.idItem+"/format/json",success:function(o,q){var r=Ext.decode(o.responseText);if(r.success){var p=r.results;var n=Ext.create("AL.model.Item",p);l.getStore().add(n);l.select(n);l.fireEvent("select2",{combo:l,record:n})}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})}},select:function(f,e){this.getItem(f,e);this.checkQuantity(f)},select2:function(f){var g=f.combo;var e=f.record;this.getItem(g,[e]);this.checkQuantity(g)}},"remission_FormAddRemission combo[name=idClient]":{render:function(g){var f=this;var e=g.up("form");if(e.idClient){Ext.Ajax.request({url:"/client/retrieve-one/id/"+e.idClient+"/format/json",success:function(j,l){var m=Ext.decode(j.responseText);if(m.success){var k=m.results;var h=Ext.create("AL.model.Client",k);g.getStore().add(h);g.select(h);f.getContact(g,[h])}else{Ext.MessageBox.alert("Error","Ha ocurriOdo un error cargando el cliente")}},failure:function(){}})}},select:this.getContact},"remission_FormAddItem textfield[name=price]":{change:this.updateItemTotal},"remission_FormAddItem textfield[name=discount]":{change:this.updateItemTotal},"remission_FormAddItem numberfield[name=quantity]":{change:function(f,j,e){var g=f.up("form");var h=g.down("combo[name=idLocal]");this.checkQuantity(h);this.updateItemTotal(f)}},"remission_FormAddItem button[action=deleteItem]":{click:function(e){e.up("form").destroy();this.updateTotal()}},"remission_FormAddRemission datefield[name=date]":{change:this.changeDueDateFromDate},remission_GridAll:{beforerender:function(e){if(e&&e.country=="peru"){e.columns[0].setText(translate("number",true))}}},"remission_GridAll gridcolumn[type=remissionActions]":{click:function(f,h,o,m,p,q){var r=this.application;var l=Ext.get(p.target);var k=f.up("grid").getSelectionModel().getSelection()[0];if(l.hasCls("deleteRemission")){p.preventDefault();if(k.get("deletable")){r.fireEvent("deleteRemission",{record:k,initiator:f})}else{Ext.Msg.alert("Error",translate("theRemission")+" "+translate("remission")+" no se puede eliminar")}}else{if(l.hasCls("printRemission")){p.preventDefault();var g=k.get("idLocal");var n=window.open("/remission/print/id/"+g);n.print()}else{if(l.hasCls("voidRemission")){p.preventDefault();if(k.get("voidable")){r.fireEvent("voidRemission",{record:k,initiator:f})}}else{if(l.hasCls("editDisabled")){p.preventDefault();GlobalMsg.showNotification({title:"Error",text:translate("theRemission",true)+" "+translate("remission")+" "+translate("canNotBeEditedBecauseHasMinimum")+" "+translate("aSalesInvoice")+" "+translate("invoice")+" "+translate("associatedRemission"),type:"error"})}else{if(l.hasCls("convertRemissionToOpen")){r.fireEvent("convertRemissionToOpen",{record:k,initiator:f})}}}}}}},"remission_FormAddRemission combo[name=idPriceList]":{change:function(g){var e=Ext.ComponentQuery.query("remission_FormAddItem");var f=this;if(e.length>0){Ext.each(e,function(k){var l=k.down("combo[name=idLocal]");var j=k.down("textfield[name=price]");var h=l.getSelectedRecord();if(h){j.suspendEvents();f.getPrice(h,j);j.resumeEvents();f.updateItemTotal(j,"no")}});this.updateTotal()}},afterrender:function(f){var e=f.getStore();if(!e.hasLoaded()){e.load({callback:function(){var h=f.up("form");if(h.type!="edit"){var g=e.findRecord("main","yes");f.suspendEvents();f.select(g);f.resumeEvents()}}})}}},"remission_FormAddRemission box[name=logoBox]":{render:function(f){var g=document.querySelector(".logo");var h=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var e=false;if(h&&h.configs&&h.configs.company&&h.configs.company.designMoreVisibility!=false){e=true}if(e==true){g=document.querySelector(".image-logo-profile")}this.promptFileUploadWindowOnClick(f,"logoUrl",false,{asyncUpload:true,title:translate("changeLogo",true),url:"/company/set-logo/format/json",fieldName:"logo",fieldLabel:translate("logo",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingLogo",true)},function(j){if(e!=true){g.innerHTML='<a href="/"><img src="'+j+'" />';"</a>"}else{if(g){g.src=j}}})}},remission_FormAddRemission:{afterrender:this.initialize,beforerender:function(g){g.executeActionsBeforeRender();if(g.configs){if(g.configs.companyLogoUrl){var e=g.down("box[name=logoBox]");var h=new Image;h.onload=function(l){var k=(h.width*Math.min(e.configs.maxHeight,h.height))/h.height;var j="";if(k<e.configs.maxWidth){j="width: auto; max-height: "+e.configs.maxHeight+"px;"}else{j="height: auto; max-width: "+e.configs.maxWidth+"px;"}e.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+g.configs.companyLogoUrl+'" style="margin: 0 auto; '+j+'" /></div>')};h.src=g.configs.companyLogoUrl}if(g.configs.companyName){g.down("label[name=companyName]").setText(g.configs.companyName)}if(g.configs.companyIdentification){var f=translate("identification",true);if(g.configs.companyIdentificationType){f=g.configs.companyIdentificationType}g.down("label[name=companyIdentification]").setText(f+": "+g.configs.companyIdentification)}if(g.configs.companyEmail){g.down("label[name=companyEmail]").setText(g.configs.companyEmail)}}}},"remission_FormAddRemission label[name=companyEdit]":{beforerender:function(e){var f=e.up("form");if(!f.configs.canEditCompany){e.hidden=true}},afterrender:function(e){var f=this;e.getEl().on("click",function(){var g=Ext.ComponentQuery.query("remission_FormAddRemission")[0];g.configs.canStampInvoices=true;f.showCompanyEditWindow(g,false)},e)},},remission_BottomContainer:{afterrender:function(e){if(e.configs.requiredText){e.down("[name=requiredText]").update(e.configs.requiredText)}}},"remission_FormAddRemission combo[name=idWarehouse]":{select:function(f){var e=this;var g=Ext.ComponentQuery.query("remission_FormAddItem");Ext.each(g,function(k){var j=k.down("combo[name=idLocal]");var h=j.getStore().getProxy();h.clearCache();k.removeAll();k.destroy()});this.addItemForm()}},"window[reason=confirmRemissionEmail] form button[action=confirmEmail]":{click:function(n){var g=n.up("form");var q=g.up("window");var m=Ext.ComponentQuery.query("window[reason=confirmRemissionEmail] checkbox[name=email]");var o=g.down("textfield[name=email]");var j=g.down("checkbox[name=sendCopyToUser]");var s=[];var t;if(m){Ext.each(m,function(x){if(x.getValue()){var u=x.record;var v="";if(u.name){v=u.name;if(u.lastName){v=v+" "+u.lastName}}var w={name:v,email:u.email};s.push(w)}})}if(o.getValue()&&o.getValue()!==""){t={name:"",email:o.getValue()};s.push(t)}var k=g.down("htmleditor[name=emailMessage]");var f=g.down("textfield[name=emailSubject]");var h={subject:f.getValue(),message:k.getValue()};var l=[],p,e;Ext.each(s,function(u){l.push(u.email)});l=l.join(",");p=Ext.get("emailRemission").getAttribute("data-maxEmailsToSend");e=l.split(/[;,]/).length;if(e>p){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("theRemission")+" "+translate("remission"),quantity:p}));return}var r={number:q.number,emails:Ext.encode(s),sendCopyToUser:j.getValue(),emailTemplate:Ext.encode(h)};Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/remission/email/format/json",method:"POST",params:r,showSpinner:true,success:function(u,v){var w=Ext.decode(u.responseText);if(w.success){q.close();GlobalMsg.showNotification({title:"Éxito",text:translate("theRemission",true)+" "+translate("remission")+" "+translate("hasBeenSentsuccessfullyF"),type:"success"});setTimeout(function(){window.location.reload()},1500)}else{Ext.Msg.alert("Error",w.cause)}},failure:function(){}})}},"remission_FormAddRemission combo[name=saleConcept]":{change:function(l,h){var g=l.up("form");var e=Ext.ComponentQuery.query("remission_FormAddItem");var k="/item/retrieve-all/format/json";var f=g.down("datefield[name=startDateService]"),j=g.down("datefield[name=endDateService]");switch(h){case"PRODUCTS":k="/item/retrieve-all/format/json/type/products";f.hide();f.allowBlank=true;j.hide();j.allowBlank=true;break;case"SERVICES":k="/item/retrieve-all/format/json/type/services";f.show();f.allowBlank=false;j.show();j.allowBlank=false;break;default:f.show();f.allowBlank=false;j.show();j.allowBlank=false;break}Ext.each(e,function(p){var o=p.down("combo[name=idLocal]");var n=o.getStore();var m=n.getProxy();if(m.url!=k){m.url=k;m.clearCache();n.load({callback:function(){if(p&&!p.itemRemission){return}var r=p.itemRemission,q=n.findRecord("idLocal",r.idLocal);addItem=true;switch(h){case"SERVICES":addItem=r&&r.unit==="service"?true:false;break;case"PRODUCTS":addItem=r&&r.unit!=="service"?true:false;break}if(!q&&addItem){var q=Ext.create("AL.model.Item",r);n.add(q)}if(q){o.select(q)}}})}})}},})},checkQuantity:function(b){var k="La cantidad indicada es mayor a la disponible en el "+translate("inventory"),l="El "+translate("item")+" ",c=" ha alcanzado la cantidad mínima configurada. Te recomendamos comprar este producto";var j=b.getSelectedRecord(),m=function(n){GlobalMsg.showNotification({type:"warning",title:"Advertencia",text:n})},a=b.up("form"),f=a.down("numberfield[name=quantity]"),e=f.getValue();if(j&&j.get("isInventariable")=="yes"){if(j.get("availableQuantity")>0){var h=AL.math.sub(j.get("availableQuantity"),j.get("quantityRemissioned")),g=j.get("minQuantity");if(a.type==="edit"){if(!e){e=parseFloat(j.get("quantity"))}var d=AL.math.add(h,j.get("quantity"));if(e&&AL.math.comp(e,d)>0){m(k)}else{if(g&&e&&AL.math.comp(g,AL.math.sub(d,e))>=0){m(l+j.get("name")+c)}}}else{if(h<=0||(e&&AL.math.comp(e,h)>0)){m(k)}else{if(g&&e&&AL.math.comp(g,AL.math.sub(h,e))>=0){m(l+j.get("name")+c)}}}}else{if(j.get("availableQuantity")<=0&&e){m(k)}}}},saveRemission:function(g){var l=this;var j=Ext.ComponentQuery.query("remission_FormAddItem");var e=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var p=[];var f=this.showFormEditDiscount();Ext.each(j,function(s){var r=s.getValues();if(!r.idTax||r.idTax==0){delete r.idTax}if(r.discount==""){r.discount=0}else{if(f){var t=s.down("textfield[name=discount]");if(t.discount){r.discountNature=t.discount.discountNature}}}if(r.idLocal){p.push(r)}});var c=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var b=Ext.ComponentQuery.query("remission_BottomContainer")[0];var o=c.getValues();var d=b.down("[name=anotation]");var a=c.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){o.exchangeRate=a.getValue()}o.items=Ext.encode(p);o.anotation=d.getValue();if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var q=c.down("[name=numerationComponent]");var n=q.getSelectedNumeration();o.idResolution=n}var k=Ext.get("new-comment");if(k&&k.getValue()){var h=k.getValue();o.comment=Ext.encode(h)}var m=c.getFieldValuesAsMetadata();if(m){o.metadata=Ext.encode(m)}if(l.validateForms()){g.disable();GlobalRedirector.go({zoneTitle:translate("creatingAction",true)+" "+translate("remission")});Ext.Ajax.request({url:"/remission/add/format/json",method:"POST",params:o,success:function(r,s){var t=Ext.decode(r.responseText);if(t.success){var u=t.results;window.location="/remission/view/id/"+u}else{g.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",t.cause)}},failure:function(){g.enable();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                                Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},initialize:function(c){var k=Ext.get("addOtherItem");k.on("click",function(){this.addItemForm();var m=Ext.ComponentQuery.query("remission_FormAddItem");if(m.length===200){Ext.Msg.show({title:"Límite de "+translate("items")+" alcanzado",msg:"Al agregar más "+translate("items")+" no podrás imprimir o descargar "+translate("theRemission")+" "+translate("remission")+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var f=this;var e=c.down("combo[name=idSeller]");if(e){var b=e.getStore();b.load({callback:function(){var m=e.findRecord("idLocal",null);if(!m){m=Ext.create("AL.model.Seller",{name:translate("anyM",true),idLocal:null});b.add(m)}}})}var g=c.down("combo[name=currency]");var h=g.getStore();h.load({callback:function(){var m=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,name:c.configs.nameCurrency,exchangeRate:1});h.add(m);g.select(c.configs.currency)}});if(c.configs.multicurrency=="yes"){g.show()}if(!c.configs.showWarehouses){c.down("combo[name=idWarehouse]").hide()}var d=c.down("combo[name=idWarehouse]");var j=d.getStore();if(!j.hasLoaded()&&!j.isLoading()){j.load({callback:function(){if(c.type!="edit"){var m=j.findRecord("isMain","yes");if(m){d.select(m)}}}})}if((c.type&&c.type==="edit")){GlobalLoadMask.show("mask-items-loading");GlobalLoadMask.show("generalContainer");var l=c.idLocal;Ext.Ajax.request({url:"/remission/retrieve-info/id/"+l+"/format/json",success:function(m,p){var D=Ext.decode(m.responseText);if(D.success){var G=D.results;var H=G.remission;var F=G.items;var O=AL.date(H.date);var M=AL.date(H.dueDate);O=Ext.Date.format(O,"d/m/Y");M=Ext.Date.format(M,"d/m/Y");var E=c.down("hidden[name=idLocal]");var v=c.down("combo[name=idClient]");var x=c.down("datefield[name=date]");var J=c.down("datefield[name=dueDate]");var w=c.down("textarea[name=observations]");var P=Ext.ComponentQuery.query("remission_BottomContainer")[0];var n=P.down("[name=anotation]");var o=c.down("combo[name=idSeller]");var N=c.down("combo[name=idPriceList]");var C=c.down("textfield[name=clientPhone]");var R=c.down("textfield[name=clientIdentification]");if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var A=c.down("[name=numerationComponent]");A.values.numerationIdLocal=H.resolutionIdLocal;A.values.prefix=H.prefix;A.values.number=H.number;A.selectNumerationByIdLocal(H.resolutionIdLocal)}var u=Ext.create("AL.model.Client",{idLocal:H.idClient,name:H.name});v.getStore().add(u);v.select(u);var r=v.getStore();r.on("load",function(Y,V,Z,X){var W=Y.findExact("idLocal",H.idClient);if(W<0){Ext.Ajax.request({url:"/client/retrieve-one/id/"+H.idClient+"/format/json",success:function(ab,ad){var ae=Ext.decode(ab.responseText);if(ae.success){var ac=ae.results;var aa=Ext.create("AL.model.Client",ac);Y.add(aa);v.select(aa);var af=aa.get("identification");if(af){af+=(c.configs&&c.configs.country==="colombia"&&!Ext.isEmpty(aa.get("co_dv")))?"-"+aa.get("co_dv"):""}R.setValue(af);C.setValue(aa.get("phone1"))}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}else{Y.findBy(function(aa,ac){if(aa.get("idLocal")==H.idClient){v.select(aa);var ab=aa.get("identification");if(ab){ab+=(c.configs&&c.configs.country==="colombia"&&!Ext.isEmpty(aa.get("co_dv")))?"-"+aa.get("co_dv"):""}R.setValue(ab);C.setValue(aa.get("phone1"));return true}return false})}});r.load();var z=c.down("combo[name=documentName]");z.setValue(H.documentName);E.setValue(H.idLocal);c.decimalPrecision=G.remission.decimalPrecision;w.setValue(H.observations);n.setValue(H.anotation);if(H.metadata){c.setFieldValuesFromMetadata(H.metadata)}if(H.warehouse&&H.warehouse.idLocal){var L=d.getStore();if(!L.hasLoaded()&&!L.isLoading()){L.on("load",function(){var V=Ext.create("AL.model.Warehouse",H.warehouse);L.add(V);d.select(V)})}else{var t=Ext.create("AL.model.Warehouse",H.warehouse);L.add(t);d.select(t)}}if(o){f.loadSellerStore(o,H.idSeller)}if(H.idPriceList){f.loadPriceListStore(N,H.idPriceList)}if(c.configs.multicurrency=="yes"){var Q=c.down("combo[name=currency]");var I=c.down("hidden[name=exchangeCurrency]");var s=Q.getStore();Q.show();var T=function(){var V=s.findRecord("code",c.configs.currency);if(!V){V=Ext.create("AL.model.CompanyCurrency",{code:c.configs.currency,exchangeRate:1});s.add(V)}var W=null;if(H.currencyCode){W=s.findRecord("code",H.currencyCode);if(W){W.set("exchangeRate",H.exchangeRate)}else{W=Ext.create("AL.model.CompanyCurrency",{exchangeRate:H.exchangeRate,code:H.currencyCode,symbol:H.currencySymbol});if(W&&W.code){s.add(W)}}}if(!W){W=V}Q.select(W);I.setValue(H.exchangeRate)};if(s.hasLoaded()){T()}else{s.load({callback:function(){T()}})}}GlobalLoadMask.hide("generalContainer");var q=F.length;var B=1;var y=c.configs.canCreateNewTax;var S=c.configs.canCreateNewWarehouse;var K=c.configs.canCreateNewItem;var U=c.configs.multipleTaxes;Ext.each(F,function(Y){var V=Ext.ComponentQuery.query("#addItemPanel")[0];var X=Ext.create("AL.view.remission.FormAddItem",{type:"edit",itemRemission:Y,canCreateNewTax:y,canCreateNewWarehouse:S,canCreateNewItem:K,multipleTaxes:U});V.add(X);var W=X.down("combo[name=idTax]");V.add(X);if(B==q){W.on("taxComboRendered",function(){f.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}B++});x.setRawValue(O);J.setRawValue(M)}},failure:function(){}})}var a=Ext.get("advancedOptionsLink");if(a){a.on("click",function(m){m.preventDefault();f.showAdvancedOptions()})}},addItemForm:function(){var c=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var b=Ext.create("AL.view.remission.FormAddItem",{itemCount:++this.itemCount,canCreateNewTax:c.configs.canCreateNewTax,canCreateNewWarehouse:c.configs.canCreateNewWarehouse,canCreateNewItem:c.configs.canCreateNewItem,multipleTaxes:c.configs.multipleTaxes,});a.add(b);this.changeStoreItemsToSaleConcept(b)},getItem:function(d,e,h,j){var g=e[0];var k=this;var c=d.up("form");var n=c.down("textfield[name=reference]");var m=c.down("textfield[name=price]");var a=c.down("textarea[name=description]");var f=c.down("numberfield[name=quantity]");var o=c.down("textfield[name=discount]");var b=c.down("combo[name=idTax]");f.suspendEvents();o.suspendEvents();m.suspendEvents();b.suspendEvents();n.setValue(g.get("reference"));a.setValue(g.get("description"));f.setValue(1);o.setValue(0);var l=function(){if(!g.get("idTax")||g.get("idTax")=="null"){return b.select(0)}var q=[];var p=g.get("taxes");Ext.each(p,function(s){if(s.status==="inactive"){if(c&&c.type==="edit"&&c.itemRemission&&c.itemRemission.idTax==g.get("idTax")){var r=Ext.create("AL.model.Tax",{idLocal:"old",tax:s.tax,name:s.taxName});r.set("currentId",s.id);b.actualTax=r;q.push(s.idTax)}else{b.select(0)}}else{q.push(s.id)}});if(q.length>0){b.setValue(q)}};if(b.getStore().isLoading()){b.getStore().on("load",l)}else{l()}this.getPrice(g,m);f.resumeEvents();m.resumeEvents();o.resumeEvents();b.resumeEvents();this.updateItemTotal(m);d.up("form").enableFields()},getPrice:function(b,c,e){var g=b.get("priceList");var d=b.get("price");var f=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var a=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];if(e=="no"){if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}c.setValue(d)}else{if(!g){Ext.Ajax.request({url:"/item/retrieve-price-list/format/json/id/"+b.get("idLocal"),success:function(h,k){var l=Ext.decode(h.responseText);var j=l.results;var m=j;b.set("priceList",m);if(m[f.getValue()]){d=m[f.getValue()];if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}else{if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}}})}else{if(g[f.getValue()]){d=g[f.getValue()];if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}else{if(a.getValue()){d=AL.math.approx(AL.math.div(d,a.getValue()),null,3)}else{d=AL.math.approx(d)}c.setValue(d)}}}},updateItemTotal:function(h,f){if(f!="no"){f="yes"}var b=h.up("form");var j=b.down("textfield[name=price]");var g=b.down("displayfield[name=total]");var c=b.down("numberfield[name=quantity]");var l=b.down("textfield[name=discount]");var d=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var a=d.currencySign?d.currencySign:null;if(j.isValid()&&c.isValid()&&l.isValid()){var e=AL.math.sub(1,AL.math.div(l.getValue(),100));var k=AL.math.approx(j.getValue(),null,d.decimalPrecision);g.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(k,e),null,d.decimalPrecision),c.getValue()),null,d.decimalPrecision),d.decimalPrecision,a))}else{f="no"}if(f=="yes"){this.updateTotal()}},updateTotal:function(){var f={};var n=Ext.ComponentQuery.query("remission_FormAddItem");var d=0;var l=0;var e=0;var k=0;var c=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var m=0;var h=1;var j=false;if(c&&c.configs.multicurrency=="yes"){var b=c.down("combo[name=currency]");if(b.getValue()&&c.configs.currency!=b.getValue()){j=true;h=c.down("hidden[name=exchangeCurrency]").getValue()}}var g=true;Ext.each(n,function(p){var q=p.down("textfield[name=discount]").isValid();if(q==false){g=false}});if(g){Ext.each(n,function(A){var y=A.down("combo[name=idTax]");var x=null;var B=A.down("textfield[name=price]");var u=A.down("numberfield[name=quantity]");var D=A.down("textfield[name=discount]");var z=typeof(y.getValue())=="string"?[y.getValue()]:y.getValue();if(A.type&&A.type==="edit"){if(y.getValue()==="old"){x=y.actualTax}}if(y.getValue()||y.findRecordByValue(y.getValue())){var r;var q;var p;var t=u.getValue()?u.getValue():0;var C=AL.math.approx(B.getValue(),null,c.decimalPrecision);var s=AL.math.approx(AL.math.mul(C,h),null,c.decimalPrecision);if(D.getValue()){e=AL.math.add(e,AL.math.approx(AL.math.mul(t,AL.math.approx(AL.math.mul(C,AL.math.div(D.getValue(),100)),null,c.decimalPrecision)),null,c.decimalPrecision));r=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(C,AL.math.sub(1,AL.math.div(D.getValue(),100))),null,c.decimalPrecision),t),null,c.decimalPrecision);q=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(s,AL.math.sub(1,AL.math.div(D.getValue(),100))),null,c.decimalPrecision),t),null,c.decimalPrecision);p=AL.math.approx(AL.math.mul(C,t),null,c.decimalPrecision)}else{r=AL.math.approx(AL.math.mul(C,t),null,c.decimalPrecision);q=AL.math.approx(AL.math.mul(s,t),null,c.decimalPrecision);p=r}k=AL.math.add(k,p);d=AL.math.add(d,r);var w=0;var v=0;Ext.each(z,function(F){x=y.findRecordByValue(F);if(x){w=AL.math.add(w,AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,c.decimalPrecision));v=AL.math.add(v,AL.math.approx(AL.math.mul(q,AL.math.div(x.get("tax"),100)),null,c.decimalPrecision));var E=x.get("name")+x.get("tax");if(f[E]){f[E].value=AL.math.add(f[E].value,AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,c.decimalPrecision))}else{f[E]={label:x.get("name")+" ("+Ext.util.Format.round(x.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(r,AL.math.div(x.get("tax"),100)),null,c.decimalPrecision)}}}else{l=AL.math.add(l,r);m=AL.math.add(m,q)}});l=AL.math.add(l,AL.math.add(r,w));m=AL.math.add(m,AL.math.add(q,v))}});var a=c&&c.currencySign?c.currencySign:null;var o=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];o.removeAll();o.addItem({label:"Subtotal",cls:"price-row",value:AL.math.approx(k,null,c.decimalPrecision),important:true,decimalPrecision:c.decimalPrecision,currencySign:a});o.addItem({label:translate("discount",true),cls:"price-row",value:AL.math.approx(AL.math.mul(e,-1),null,c.decimalPrecision),important:true,decimalPrecision:c.decimalPrecision,currencySign:a});o.addItem({label:"Subtotal",cls:"price-row",value:AL.math.approx(d,null,c.decimalPrecision),important:true,decimalPrecision:c.decimalPrecision,currencySign:a});Ext.Object.each(f,function(p,q){q.value=AL.math.approx(q.value,null,c.decimalPrecision);q.decimalPrecision=c.decimalPrecision;q.currencySign=a;q.cls="price-row";o.addItem(q)});o.addItem({label:"Total",cls:"price-total",value:AL.math.approx(l,null,c.decimalPrecision),important:true,decimalPrecision:c.decimalPrecision,currencySign:a});if(j){o.addItem({label:"Total "+c.configs.currency,value:AL.math.approx(m,null,c.decimalPrecision),important:true,cls:"price-total",decimalPrecision:c.decimalPrecision})}}else{var d=0,f=0,l=0}return{subTotal:d,taxes:f,total:l}},getContact:function(j,c){var f=c[0],h=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];if(f.get("idPriceList")){this.loadPriceListStore(h,f.get("idPriceList"))}else{var m=h.findRecord("main","yes");h.select(m)}var e=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(e){this.loadSellerStore(e,f.get("idSeller"))}var b=j.up("form");var o=b.down("[name=clientIdentification]");var n=b.down("[name=clientPhone]");var g=f.get("identification");if(g){g+=(b.configs&&b.configs.country==="colombia"&&!Ext.isEmpty(f.get("co_dv")))?"-"+f.get("co_dv"):""}o.setValue(g);n.setValue(f.get("phone1"));var l=Ext.ComponentQuery.query("combo[name=days]")[0];if(f.get("idTerm")){var k=l.getStore();var a=function(p){var q=k.findRecord("idLocal",p.get("idTerm"));if(q){l.select(q)}};if(k.hasLoaded()){a(f)}else{k.on("load",function(){a(f)});k.load()}}else{var d=Ext.create("AL.model.Term",{idLocal:0,days:"Vencimiento manual",name:"Vencimiento manual"});l.select(d)}},changeDueDateFromDate:function(h,b,d,c){var g=30;var a=Ext.Date.add(b,Ext.Date.DAY,g);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(a,"d/m/Y"));var e=Ext.ComponentQuery.query("datefield[name=endDateService]")[0];var f=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(!e||(e&&(e.getValue()==""||b>e.getValue()))){f.setMinValue(b)}},validateForms:function(){var e=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var b=Ext.ComponentQuery.query("remission_FormAddItem");var d=true;if(e.getForm().isValid()){var a=e.down("combo[name=idClient]");if(!a.getSelectedRecord()){d=false;a.markInvalid("Debes seleccionar el cliente, no solo escribir su "+translate("name",true))}if(b.length===0){d=false}else{var c=0;Ext.each(b,function(k){var g=k.getForm();if(g.getValues().idLocal){c++;if(!g.isValid()){d=false}else{var j=k.down("combo[name=idLocal]");if(!j.getSelectedRecord()){d=false;j.markInvalid("Debes seleccionar el ítem, no solo escribir su "+translate("name",true))}var f=parseInt(e.configs.valueDiscountMax);if(e.configs.country=="colombia"&&e.configs.isActiveElectronicInvoicing&&f==100){f=99}var h=k.down("textfield[name=discount]");if(e.configs.changeDiscount==="yes"){if(h.getValue()>f){d=false;h.markInvalid("El porcentaje de "+translate("discount")+" ingresado es mayor que el permitido.")}}}}if(c===0){d=false;b[0].down("combo[name=idLocal]").markInvalid("Debes asociar al menos un ítem")}})}}else{d=false}return d},editRemission:function(g){var e=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var h=Ext.getCmp("addItemPanel").items.getRange();var m=[];if(this.validateForms()){g.disable();GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+translate("remission")});var f=this.showFormEditDiscount();Ext.each(h,function(r){if(r.getForm){var o=r.getForm().getValues();if(o.idLocal==="old"){o.idLocal=o.oldId}else{delete o.itemName}if(f){var s=r.down("textfield[name=discount]");if(s.discount){o.discountNature=s.discount.discountNature}}if(o.idTax==="old"){var p=r.down("combo[name=idTax]");var q=p.actualTax;if(q.get("currentId")){o.idTax=q.get("currentId");o.taxName=q.get("name");o.tax=q.get("tax")}else{delete o.idTax}o.taxName=q.get("name");o.tax=q.get("tax")}else{if(!o.idTax||o.idTax==0){delete o.idTax}}delete o.oldId;m.push(o)}});var b=Ext.ComponentQuery.query("remission_BottomContainer")[0];var c=Ext.ComponentQuery.query("remission_FormAddRemission")[0];var d=b.down("[name=anotation]");var l=c.getValues();l.anotation=d.getValue();if(l.idClient==="old"){l.idClient=l.oldIdClient}else{delete l.oldClientName;delete l.oldIdClient}l.items=Ext.encode(m);var a=c.down("hidden[name=exchangeCurrency]");if(a&&a.getValue()){l.exchangeRate=a.getValue()}if(c.configs&&c.configs.resolutionModel&&c.configs.resolutionModel==="new"){var n=c.down("[name=numerationComponent]");var k=n.getSelectedNumeration();l.idResolution=k}var j=c.getFieldValuesAsMetadata();if(j){l.metadata=Ext.encode(j)}Ext.Ajax.request({url:"/remission/edit/format/json",method:"POST",params:l,success:function(o,p){var q=Ext.decode(o.responseText);if(q.success){var r=q.results;window.location="/remission/view/id/"+r}else{g.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",q.cause)}},failure:function(){g.enable();GlobalRedirector.close()}})}else{if(!this.errorAlertDisplayed){GlobalMsg.showNotification({tpl:"formInvalidFields"})}}},showSpinner:function(b,c){if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:translate("sending",true)});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},showCompanyEditWindow:function(a,c,b){this.application.fireEvent("editCompanyEvent",a,c,b)},promptFileUploadWindowOnClick:function(c,a,b,f,e){var d=false;c.getEl().on("click",function(j,m){if(d){return}d=true;var l=false;var h=c.getEl().getHTML();var g="AL.view.company.FileUploadWindowLogo";if(b){g="AL.view.company.FileUploadWindow"}var k=Ext.create(g,{asyncUpload:f.asyncUpload,title:f.title,url:f.url,fieldName:f.fieldName,fieldLabel:f.fieldLabel,buttonText:f.buttonText,helpText:f.helpText,height:230,onSubmit:function(n,o){l=true;Ext.create("Ext.fx.Anim",{target:n,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){n.close()}});Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update('<div class="form-add-invoice-image-zone-loading"></div>');Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(o,n,p){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var q=new Image;q.onload=function(t){var s=(q.width*Math.min(c.configs.maxHeight,q.height))/q.height;var r="";if(s<c.configs.maxWidth){r="width: auto; max-height: "+c.configs.maxHeight+"px;"}else{r="height: auto; max-width: "+c.configs.maxWidth+"px;"}if(b){c.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+c.configs.madeByText+"</div></div>")}else{c.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div>')}if(e){e(n[a])}Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})};q.src=n[a]}})},onFailure:function(o,n,q){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update(h);Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof n=="string"||!n.cause){Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}else{var p=n.title?n.title:translate("error",true);Ext.MessageBox.alert(p,n.cause)}},onClose:function(n){if(!l){d=false}}});k.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:k,duration:300,from:{opacity:0},to:{opacity:1}})},c)},showAdvancedOptions:function(){var a=Ext.ComponentQuery.query("remission_FormAdvancedOptions")[0];if(a.hidden){a.show()}else{a.hide()}},changeDueDateFromDays:function(a){if(!a){return}var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();if(a.get("idLocal")){var f=parseInt(a.get("days"));var b=Ext.Date.add(c,Ext.Date.DAY,f);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(b,"d/m/Y"))}Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setMinValue(c);var d=Ext.ComponentQuery.query("datefield[name=endDateService]")[0];var e=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(!d||(d&&(d.getValue()==""||c>d.getValue()))){e.setMinValue(c)}},loadSellerStore:function(d,c){var a=function(){var f=d.findRecord("idLocal",null);if(!f){f=Ext.create("AL.model.Seller",{name:translate("anyM",true),idLocal:null});b.add(f)}var e=d.findRecord("idLocal",c);if(!e){e=f}d.select(e)};var b=d.getStore();if(b.hasLoaded()){a()}else{b.load({callback:a})}},showFormEditDiscount:function(){var a=Ext.ComponentQuery.query("remission_FormAddRemission")[0];b=false;if(a&&a.configs){var b=a.configs.country=="costaRica"||(a.configs.country=="colombia"&&a.configs.isActiveElectronicInvoicing&&a.configs.electronicInvoicingVersion=="2.1")}return b},loadPriceListStore:function(d,c){var a=d.getStore(),b=function(){var e=a.findRecord("idLocal",c);if(!e){e=a.findRecord("main","yes")}d.select(e)};if(a.hasLoaded()){b()}else{a.load({callback:b})}},changeStoreItemsToSaleConcept:function(e){var h=Ext.ComponentQuery.query("remission_FormAddRemission")[0];if(h&&h.configs.country==="argentina"){saleConceptField=h.down("combo[name=saleConcept]");value=saleConceptField.getValue();var f="/item/retrieve-all/format/json",g=false,d=e&&e.type==="edit";switch(value){case"SERVICES":if(d){g=e.itemRemission&&e.itemRemission.unit==="service"}f="/item/retrieve-all/format/json/type/services";break;case"PRODUCTS":if(d){g=e.itemRemission&&e.itemRemission.unit!=="service"}f="/item/retrieve-all/format/json/type/products";break}var a=e.down("combo[name=idLocal]"),c=a.getStore(),b=c.getProxy();if(b.url!=f){b.url=f;c.load({callback:function(){var k=e.down("combo[name=idLocal]"),l=e.itemRemission,j=c.findRecord("idLocal",l.idLocal);if(!j&&g){var j=Ext.create("AL.model.Item",l);c.add(j)}if(j){k.select(j)}}})}}}});Ext.define("AL.store.admin.Plans",{extend:"Ext.data.Store",model:"AL.model.admin.Plan",autoLoad:false,proxy:{type:"ajax",url:"/admin/retrieve-all-plans/format/json",reader:{type:"json",root:"results"}}});Ext.define("AL.view.admin.company.FormSearch",{extend:"Ext.form.Panel",alias:"widget.admin_company_FormSearch",title:"",border:false,frame:false,requires:["AL.store.admin.Plans","AL.view.admin.company.CountriesCombo","AL.view.admin.company.OriginKeywordCombo"],layout:"column",items:[{columnWidth:0.5,xtype:"container",defaults:{width:300},items:[{xtype:"textareafield",name:"idCompanies",fieldLabel:"IDs",beforeBodyEl:'<div style="color: gray; font-size: 11px; font-weight: bold;">Varios ids separandolos por coma <b>(,)</b></div>',width:450,maskRe:/(,|[0-9])/,regex:/^[0-9]+(,[0-9]+)*$/,regexText:"Los ids de las compañías solo pueden ser númericos y deben ir separados por comas (,) y sin espacios"},{xtype:"admin_company_CountriesCombo",name:"keyCountry",multiSelect:true,fieldLabel:"Países"},{xtype:"fieldcontainer",fieldLabel:"Fecha de registro",layout:"hbox",items:[{xtype:"combo",name:"dateRegistryOperator",hideLabel:true,width:50,displayField:"operator",valueField:"value",queryMode:"local",editable:false,value:"equalsDate",allowBlank:false,store:{fields:["operator","value"],data:[{operator:"=",value:"equalsDate"},{operator:">",value:"laterThan"},{operator:"<",value:"earlierThan"},{operator:">=",value:"laterThanOrEqual"},{operator:"<=",value:"earlierThanOrEqual"}]}},{xtype:"splitter"},{xtype:"datefield",name:"dateRegistry",hideLabel:true,width:90}]},{xtype:"fieldcontainer",itemId:"lastAccessDateContainer",fieldLabel:"Último ingreso",layout:"hbox",items:[{xtype:"combo",name:"lastAccessDateOperator",hideLabel:true,width:50,displayField:"operator",valueField:"value",queryMode:"local",editable:false,value:"equalsDate",allowBlank:false,store:{fields:["operator","value"],data:[{operator:"=",value:"equalsDate"},{operator:">",value:"laterThan"},{operator:"<",value:"earlierThan"},{operator:">=",value:"laterThanOrEqual"},{operator:"<=",value:"earlierThanOrEqual"}]}},{xtype:"splitter"},{xtype:"datefield",name:"lastAccessDate",hideLabel:true,width:90}]},{xtype:"admin_company_OriginKeywordCombo",name:"originKeyword",multiSelect:true},{xtype:"textareafield",name:"city",fieldLabel:"Ciudad",beforeBodyEl:'<div style="color: gray; font-size: 11px; font-weight: bold;">Varias ciudades separandolas por coma <b>(,)</b></div>',width:450,maskRe:/(,|[A-z])/,regex:/^[A-z]+(,[A-z]+)*$/,regexText:"Los ids de las compañías solo pueden ser númericos y deben ir separados por comas (,) y sin espacios"},{xtype:"combo",name:"currentPlan",fieldLabel:"Plan Actual",displayField:"name",valueField:"id",queryMode:"local",multiSelect:true,editable:false,forceSelection:true,store:{model:"AL.model.admin.Plan",data:[]},},{xtype:"combo",name:"membershipType",fieldLabel:"Tipo membresía",displayField:"label",valueField:"value",queryMode:"local",multiSelect:true,editable:false,forceSelection:true,store:{fields:["label","value"],data:[{label:"No paga",value:"not-paid"},{label:"Premium",value:"premium"},{label:"Paga",value:"paid"}]}}]},{columnWidth:0.5,xtype:"container",defaults:{width:300},items:[{xtype:"textareafield",name:"notIdCompanies",fieldLabel:"IDs Excluídos",beforeBodyEl:'<div style="color: gray; font-size: 11px; font-weight: bold;">Varios ids separandolos por coma <b>(,)</b></div>',width:450,maskRe:/(,|[0-9])/,regex:/^[0-9]+(,[0-9]+)*$/,regexText:"Los ids de las compañías solo pueden ser númericos y deben ir separados por comas (,) y sin espacios"},{xtype:"admin_company_OriginKeywordCombo",name:"notOriginKeyword",fieldLabel:"Origen Excluídos",multiSelect:true},]}],buttons:[{text:translate("send",true),action:"apply",formBind:true}],listeners:{beforerender:function(b){b.down("fieldcontainer[itemId=lastAccessDateContainer]").hide();var a=Ext.create("AL.store.admin.Plans",{autoLoad:true});b.down("combo[name=notOriginKeyword]").select("partner-claro");a.on("load",function(f,e){var c=[];var g=[];var d=[];Ext.each(e,function(j){var k=j.get("name");var l=g.indexOf(k);if(l>-1){if(d.indexOf(l)===-1){d.push(l)}k+=" (";var h=[];Ext.each(j.get("availableCountries"),function(m){h.push(m.slice(0,3))});k+=h.join("-")+")"}else{g.push(k)}j.set("name",k);c.push(j.getData())});Ext.each(d,function(k){var j=c[k].name;j+=" (";var h=[];Ext.each(e[k].get("availableCountries"),function(l){h.push(l.slice(0,3))});j+=h.join("-")+")";c[k].name=j});b.down("combo[name=currentPlan]").getStore().loadData(c,false)})}}});Ext.define("AL.controller.admin.CustomEmail",{extend:"Ext.app.Controller",views:["admin.customemail.FormEdit","admin.company.FormSearch"],init:function(){this.control({admin_customemail_FormEdit:{afterrender:function(a){a.resetForm()}},"admin_customemail_FormEdit button[itemId=reset]":{click:function(a){var b=a.up("form");b.resetForm()}},"admin_customemail_FormEdit button[itemId=preview]":{click:function(a){var b=a.up("form");var c=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                        <html xmlns="http://www.w3.org/1999/xhtml">                            <head>                                <meta http-equiv="Content-Type" content="text/html; charset=utf-8">                                <!--[if !mso]><!-->                                    <meta http-equiv="X-UA-Compatible" content="IE=edge">                                <!--<![endif]-->                                <meta name="viewport" content="width=device-width, initial-scale=1.0">                                <title></title>                                <!--[if (gte mso 9)|(IE)]>                                    <style type="text/css">                                    table {border-collapse: collapse;}                                    </style>                                <![endif]-->                            </head>                            <body style="margin-top: 12px;padding: 0;min-width: 100%;font-family: Gotham, `Helvetica Neue`, Helvetica, Arial, sans-serif;background-color: #F6F7F9;">                                <center class="wrapper" style="width: 100%;table-layout: fixed;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100%;">                                    <div class="webkit" style="max-width: 600px;">                                        <!--[if (gte mso 9)|(IE)]>                                        <table width="600" align="center">                                            <tr>                                                <td>                                        <![endif]-->                                        <table border="0" cellpadding="0" cellspacing="0" class="outer main-table" align="center" style="border-spacing: 0;font-family: sans-serif;color: #666;background: #fff;margin: 0 auto;width: 100%;max-width: 600px;">                                            <tr class="header">                                                <td class="full-width-image" style="padding-top:0;padding-bottom:0;padding-right:0;padding-left:0;" >                                                    <img src="https://cdn1.getsoft.app/images/emails/newfeatures-common/header-colombia.png" alt="" style="border-width:0;width:100%;max-width:600px;height:auto; display: block;" />                                                </td>                                            </tr>                                            <tr class="body">                                                <td>'+b.down("htmleditor").getValue()+'</td>                                            </tr>                                            <tr class="footer">                                                <td>                                                    <center class="wrapper" style="width: 100%;table-layout: fixed;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100%;">                                                        <table width="600px" border="0" cellpadding="0" cellspacing="0">                                                            <tr>                                                                <td class="redes" style="padding: 0;background-color: #F6F7F9;text-align: center;">                                                                    <div height="60" colspan="2" align="center" style="font-family: sans-serif; margin-top: 30px; margin-bottom: 16px;"><font color="#00b19d"><span style="font-size: 14px;">Con Alegra Ganas </span></font><b style="color: rgb(0, 177, 157); font-size: 14px;">Tiempo y Tranquilidad</b> </div>                                                                                                                                        <a href="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=1084859936&amp;mt=8" target="_blank" style="color: rgb(0, 177, 157); font-size: 11px; text-decoration: none;"><img src="https://cdn2.getsoft.app/email/images/ui/but-apl.png" style="border:none; outline:none;max-width: 30%"> </a>                                                                    <a href="https://play.google.com/store/apps/details?id=co.alegra.app" target="_blank" style="color: rgb(0, 177, 157); font-size: 11px; text-decoration: none;"><img src="https://cdn2.getsoft.app/email/images/ui/but-goo.png" style="border:none; outline:none;max-width: 30%"> </a>                                                                                                                                        <br><span style="color: rgb(128, 128, 128); font-size: 14px;"><br>Si no deseas recibir este mail, puedes cancelar </span><strong style="color: rgb(128, 128, 128); font-size: 14px;"><a href="#" style="color: rgb(128, 128, 128); text-decoration-line: none;">tu suscripción aquí</a></strong>                                                                                                                                        <p class="centrar margen-simple-arriba" style="font-size: 11px;margin: 15px;line-height: 150%;text-align: center;padding: 15px 20px;padding-top: 0px;color: #fffce8;">                                                                        <a style="margin: 20px" href="https://twitter.com/AlegraWeb" target="_blank"><img src="https://cdn2.getsoft.app/email/images/ui/ico-tw.png" style="border:none; outline:none;"></a>                                                                        <a style="margin: 20px" href="https://www.facebook.com/alegra.web/" target="_blank"><img src="https://cdn2.getsoft.app/email/images/ui/ico-fb.png" style="border:none; outline:none;"></a>                                                                        <a style="margin: 20px" href="https://www.instagram.com/alegraweb/" target="_blank"><img src="https://cdn2.getsoft.app/email/images/ui/ico-in.png" style="border:none; outline:none;"></a>                                                                        <a style="margin: 20px" href="https://www.youtube.com/user/AlegraWeb" target="_blank"><img src="https://cdn2.getsoft.app/email/images/ui/ico-yt.png" style="border:none; outline:none;"></a>                                                                        <br>                                                                        <br><span style="color: rgb(128, 128, 128);">© Alegra - Todos los derechos reservados</span>                                                                    </p>                                                                </td>                                                            </tr>                                                        </table>                                                    </center>                                                </td>                                            </tr>                                        </table>                                        <!--[if (gte mso 9)|(IE)]>                                            </td>                                            </tr>                                            </table>                                        <![endif]-->                                    </div>                                </center>                            </body>                        </html>'].join("");Ext.create("Ext.window.Window",{title:"Previsualización del correo",height:500,width:"90%",items:{xtype:"component",autoEl:{tag:"iframe",src:"data:text/html;charset=utf-8,"+encodeURIComponent(c)},height:"100%",width:"100%",style:{color:"#000",backgroundColor:"#FFF"}}}).show()}},"admin_customemail_FormEdit button[itemId=save]":{click:function(a){var b=a.up("form");this.checkAndSendForm(b,"/custom-email/new-features-email/format/json",b.getValues(),translate("saving",true),function(d){var e=Ext.decode(d.responseText);if(e.success){var c=b.getCustomEmail();c.code=e.code;c.subject=e.subject;b.resetForm()}})}},"admin_customemail_FormEdit button[itemId=sendTest]":{click:function(a){var b=a.up("form");this.checkAndSendForm(b,"/custom-email/send-test-new-features-email/format/json",b.getValues(),"Enviando prueba...")}},"admin_company_FormSearch button[action=apply]":{click:function(c){var e=this,d=c.up("form"),b=Ext.encode(d.getValues()),a=function(g){var h=Ext.decode(g.responseText);if(h.success&&h.companiesFound){var f="Se le enviará el correo a "+h.companiesFound+" compañías. ¿Desea continuar? Para continuar escriba el número de compañías al que se le enviará el correo";Ext.Msg.prompt("Confirmación de envío",f,function(j,k){if(j=="ok"){if(k.toLowerCase()==h.companiesFound){e.checkAndSendForm(d,"/labs/send-new-features-email/format/json",b,"Procesando envío de correo...",null,null,400000)}else{GlobalMsg.showErrorMessage("Error","No escribiste bien el número de compañías, inténtalo de nuevo")}}})}};e.checkAndSendForm(d,"/labs/send-new-features-email/format/json/onlyFindCompanies/yes",b,"Procesando envío de correo...",a,null,400000)}}})},checkAndSendForm:function(d,h,b,f,a,g,c){f=typeof f==="undefined"||!f?"Enviando...":f;a=typeof a==="undefined"||!a?function(){}:a;g=typeof g==="undefined"||!g?function(){}:g;c=typeof c==="undefined"||!c?30000:c;if(d.isValid()){var e=Ext.MessageBox.show({msg:f,wait:true});Ext.Ajax.request({url:h,params:b,timeout:c,success:function(j){e.close();a(j)},failure:function(){e.close();g()}})}}});Ext.define("AL.plugin.grid.AdvancedFields",{extend:"Ext.AbstractPlugin",alias:"plugin.grid_AdvancedFields",pluginId:"advancedfields",items:[],requires:["AL.view.ux.form.AdvancedField"],itemsAvalible:[],documentType:null,init:function(b){var k=null;if(b.configs&&b.configs.userMetadata){k=Ext.JSON.decode(b.configs.userMetadata)}this.form=b;this.initializeMetadata(k);var s=this;var q=0,r=null,a=null,u=null,o=b.configs.country,g=[],d=[];for(q;q<this.items.length;q++){r=this.items[q];u="[name="+r.name+"]";a=b.down(u);var h=false;if(r.required){switch(typeof r.required){case"function":h=r.required(b,this,a);break;case"boolean":h=r.required;break}}var t=r.forceRendering;if(r.countries){if(!r.countries.includes(o)){continue}}if(r.only){var m=true;switch(typeof r.only){case"function":m=r.only(b,this,a);break;case"boolean":m=r.only;break}if(!m){continue}}var e=null;if(r.type!="textfield"){e=a.getStore()}if(a){var f=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:r.name+"Custom",store:e,label:{text:a.getFieldLabel()},listConfig:a.listConfig,valueField:a.valueField,value:a.value,displayField:a.displayField,displayTpl:a.displayTpl,afTooltip:r.afTooltip,cls:"advancedfields",allowBlank:a.allowBlank,mirrorElement:a,changeCB:r.change,type:r.type,mandatory:h,after:r.after,emptyText:a.emptyText,queryMode:a.queryMode,queryParam:a.queryParam,forceSelection:a.forceSelection,autoSelect:a.autoSelect,minChars:a.minChars,minLength:a.minLength,maxLength:a.maxLength,matchFieldWidth:a.matchFieldWidth,regex:a.regex,regexText:a.regexText,editable:true,});if(r.name=="currency"){var c=Ext.ComponentQuery.query("displayfield[name=exchangeCurrencyDisplay]")[0];c.on("change",function(w,x){var v=Ext.get("edit-exchange-rate");if(v){v.el.dom.innerHTML=x}})}a.on("change",function(w,x){var v=Ext.ComponentQuery.query("advancedfield[name="+w.getName()+"Custom]")[0];if(r.type=="textfield"){v.getComboElement().setValue(x)}else{v.getComboElement().select(x)}});f.getComboElement().on("change",function(v,w){if(r.type=="textfield"){v.up("panel").getMirrorElement().setValue(w)}else{v.up("panel").getMirrorElement().select(w)}});f.getComboElement().on("select",function(v,w){if(r.type=="textfield"){v.up("panel").getMirrorElement().setValue(w)}else{v.up("panel").getMirrorElement().select(w)}if(v.up("panel").changeCB){v.up("panel").changeCB(b,s,a)}});if(h||t){f.getComboElement().allowBlank=false;d.push(f)}else{var j=false;if(this.metadata.advancedFields[this.documentType][a.name]==undefined){if(a.name=="idCostCenter"&&this.metadata.advancedFields[this.documentType]["idWarehouse"]){this.metadata.advancedFields[this.documentType][a.name]=this.metadata.advancedFields[this.documentType]["idWarehouse"];j=this.metadata.advancedFields[this.documentType][a.name]}else{this.metadata.advancedFields[this.documentType][a.name]=false}}else{j=this.metadata.advancedFields[this.documentType][a.name]}if(j){d.push(f)}g.push({name:f.name,enable:j,label:{text:a.getFieldLabel()},item:f})}if(t&&!h){f.getComboElement().allowBlank=true}}}var p=Ext.create("Ext.form.Panel",{renderTo:"advancedfieldscontainer",items:d,id:"containeradvancedfields",hidden:true,name:"advancedFields",listeners:{beforerender:function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side"}}});if(d.length>0){p.show()}this.itemsAvalible=g;var n=Ext.create("AL.view.common.CustomizeOptionsDropdownList",{name:"customizeOptionsDropdownListContainer",smTarget:"customizeoptionsdropdownlisttrigger",smStore:g,smIsEnable:true,smSelectFirstByDefault:false,smVisible:false,smAlignXTo:1,smAlignYTo:2,smX:13,smY:8,});n.smOnSelect=function(x,y,w){var A=s.searchItemAvalible(y.value);if(A){var z=A.item;if(z.after){var v=Ext.ComponentQuery.query("advancedfield[name="+z.after+"Custom]")[0];var w=p.items.indexOf(v);p.insert(w+1,z)}else{p.add(A.item);p.show()}}};n.smOnChange=function(w,x,v,y){s.metadata.advancedFields[s.documentType][x.value.replace("Custom","")]=y;if(!y){var A=p.down("[name="+x.value+"]");s.itemsAvalible.push({name:A.name,item:A});p.remove(A,false);if(p.items.getCount()==0){p.hide()}}var z={metadata:Ext.encode(s.metadata)};Ext.Ajax.request({url:"/user/update-metadata/format/json",method:"POST",params:z,success:function(B,C){},failure:function(B){}})};var l=Ext.get("customizeoptionsdropdownlisttrigger");l.el.on("click",function(v,w){if(!n.smVisible){n.smShow()}});this.dropdownList=n;this.panel=p},searchItemAvalible:function(a){for(var b=0;b<this.itemsAvalible.length;b++){var c=this.itemsAvalible[b];if(c.name==a){return this.itemsAvalible.splice(b,1)[0]}}return null},getItemFromPanelByName:function(a){var b=null;if(this.panel&&this.panel.items&&this.panel.items.items){var b=this.panel.items.items.filter(function(c){return c.name==a})[0]}return b},initializeMetadata:function(a){var b={advancedFields:{}};if(a&&a.advancedFields&&a.advancedFields[this.documentType]){b.advancedFields[this.documentType]=a.advancedFields[this.documentType]}else{b.advancedFields[this.documentType]={}}this.metadata=b},insertElement:function(l,g){if(!l||!g){return}var k=false,c=this.form,e=this.form.configs.country,a=this.panel;if(g.required){switch(typeof g.required){case"function":k=g.required(c,this,l);break;case"boolean":k=g.required;break}}if(g.countries){if(!g.countries.includes(e)){return}}if(g.only){var d=true;switch(typeof g.only){case"function":d=g.only(c,this,l);break;case"boolean":d=g.only;break}if(!d){return}}var n=g.title?g.title:l.getFieldLabel();var m=null;if(g.type!="textfield"){m=l.getStore()}var h=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:g.name+"Custom",store:m,label:{text:n},listConfig:l.listConfig,valueField:l.valueField,value:l.value,displayField:l.displayField,cls:"advancedfields",allowBlank:l.allowBlank,mirrorElement:l,afTooltip:g.afTooltip,changeCB:g.change,type:g.type,mandatory:k,empty:g.empty,minChars:g.minChars,minLength:g.minLength,maxLength:g.maxLength,regex:g.regex,regexText:g.regexText,});l.on("change",function(p,q){var o=Ext.ComponentQuery.query("advancedfield[name="+p.getName()+"Custom]")[0];if(g.type=="textfield"){o.getComboElement().setValue(q)}else{o.getComboElement().select(q)}});h.getComboElement().on("change",function(o,p){if(g.type=="textfield"){o.up("panel").getMirrorElement().setValue(p)}else{o.up("panel").getMirrorElement().select(p)}});h.getComboElement().on("select",function(o,p){if(g.type=="textfield"){o.up("panel").getMirrorElement().setValue(p)}else{o.up("panel").getMirrorElement().select(p)}if(o.up("panel").changeCB){o.up("panel").changeCB(c,me,l)}});if(g.after){var b=g.after;if(typeof b=="number"){a.insert(b,h)}else{var f=Ext.ComponentQuery.query("advancedfield[name="+b+"]")[0];var j=a.items.indexOf(f);a.insert(j+1,h)}}else{if(g.customPosition){g.customPosition(h,l,c,g,this)}}if(g.customRender){g.customRender(h,l,c,g,this)}},toggleElement:function(m,f){if(!m||!f){return}var l=Ext.ComponentQuery.query("advancedfield[name="+m+"]")[0];var k=document.querySelector('[data-value="'+m+'"]');var d=false,c=this.form,a=this.panel;if(!l){return}if(k){d=k.className.indexOf("active")!=-1}var h=f.insert;var j=f.required;if(h){if(d||j){if(f.after){var b=f.after;if(typeof b=="number"){a.insert(b,l)}else{var e=Ext.ComponentQuery.query("advancedfield[name="+b+"]")[0];var g=a.items.indexOf(e);a.insert(g+1,l)}}else{if(f.customPosition){f.customPosition(l,c,f,this)}else{a.add(l)}}}if(k){k.parentElement.style="";this.dropdownList.editStore("Moneda","hidden",false)}if(a.items.getCount()>0){a.show()}}else{if(d||j){a.remove(l,false);if(a.items.getCount()==0){a.hide()}}if(k){k.parentElement.style="display:none;";this.dropdownList.editStore("Moneda","hidden",true)}}}});Ext.define("AL.view.invoice.FormAddInvoice",{extend:"Ext.form.Panel",alias:"widget.invoice_FormAddInvoice",requires:["AL.view.ux.form.Switch","AL.plugin.grid.AdvancedFields"],callUpdateTotal:true,plugins:[{ptype:"grid_AdvancedFields",items:[{name:"type",countries:["colombia","costaRica","chile"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing&&b.isAvailableTypeField()},only:function(b,c,a){return b.isAvailableTypeField()},forceRendering:true},{name:"saleTicketType",countries:["chile"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing&&b.isAvailableTypeField()},forceRendering:true},{type:"searchableCombo",name:"economicActivity",countries:["costaRica","chile"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing},afTooltip:"Selecciona tu actividad económica relacionada a lo que estás vendiendo"},{name:"paymentMethod",countries:["costaRica"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing},forceRendering:true},{name:"paymentForm",countries:["chile"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing},},{name:"saleCondition",countries:["costaRica"],required:function(b,c,a){return b.configs.isActiveElectronicInvoicing},forceRendering:true},{name:"paymentType",countries:["mexico"],required:true,afTooltip:"En sustituciones se conserva el método de pago original."},{name:"idInvoiceTemplate",type:"groupingcombobox",only:function(b,c,a){return !(!b.type||b.type!=="edit")},required:function(b,c,a){return !(!b.type||b.type!=="edit")}},{name:"currency",only:function(b,c,a){return b.configs.multicurrency=="yes"},afTooltip:""+translate("learnHowToCreateOtherCurrencies",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205737499">'+translate("here")+"</a>."},{name:"idWarehouse",change:function(d,f,b){var e=AL.app.getController("Invoice");var c=Ext.ComponentQuery.query("invoice_FormAddItem");Ext.each(c,function(j){var h=j.down("combo[name=idLocal]");var g=h.getStore().getProxy();g.clearCache();j.removeAll();j.destroy()});e.addItemForm();if(b&&!b.up("form").type){e.addItemForm();e.addItemForm()}var a=Ext.ComponentQuery.query("container[name=remissionContainer]")[0];if(a){e.updateRemissionContainer(null,a)}}},{type:"combo",name:"operationTypeCol",countries:["colombia"],maxLength:20,forceRendering:true,afTooltip:'Descubre cómo crear facturas con AIU <a href="https://ayudas.getsoft.app/es/articles/3702710" target="_blank">aquí</a>.',required:function(b,c,a){return b.configs.isActiveElectronicInvoicing&&b.configs.electronicInvoicingVersion=="2.1"},only:function(b,c,a){return b.configs.isActiveElectronicInvoicing&&b.configs.electronicInvoicingVersion=="2.1"}},{name:"idPriceList",afTooltip:translate("discoverHowToCreatePriceLists",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205799159">'+translate("here")+"</a>."},{name:"idSeller",afTooltip:translate("discoverHowToCreateYourSellers",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205772559">'+translate("here")+"</a>."},{type:"textfield",name:"numberPurchaseOrder",countries:["peru"],maxLength:20,},{type:"textfield",name:"numberPurchaseOrderCol",countries:["colombia"],maxLength:20,maxLengthText:"El tamaño máximo para este campo es de 20",regex:/^[A-z0-9]+$/,regexText:"Solo se admite un valor alfanumérico",only:function(b,c,a){return b.configs.isActiveElectronicInvoicing&&b.configs.electronicInvoicingVersion=="2.1"},afTooltip:"Ingresa el número de orden de compra relacionado con tu factura de venta."},{type:"searchableCombo",name:"idCostCenter",only:function(b,c,a){return b.configs.costCenter.isActive},},],documentType:"invoice"}],configs:{autoIncrement:true},bodyPadding:"15 44 30 44",layout:{type:"vbox",align:"stretch"},defaultType:"textfield",items:[{xtype:"container",flex:1,padding:"0 0 27 0",style:"border-bottom: 1px rgba(151, 151, 151, 0.2) solid",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:33,layout:{type:"hbox",align:"stretch"},items:[{xtype:"box",name:"logoBox",configs:{maxWidth:300,maxHeight:86},html:'<div class="form-add-invoice-image-zone" onselectstart="return false;"><div style="font-size: 24px; font-weight: bold; padding-top: 23px;">'+translate("useMyLogo",true)+'</div><div style="font-size: 12px;">178 x 51 '+translate("pixels")+"</div></div>"}]},{xtype:"container",flex:33,id:"companyInfoInvoice",layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",id:"labelInvoiceCompanyName",name:"companyName",style:"padding-top: 10px; padding-bottom: 2px; font-family: Roboto; font-size: 20px; font-weight: bold; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyIdentification",name:"companyIdentification",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"labelInvoiceCompanyEmail",name:"companyEmail",style:"font-family: Roboto; font-size: 14px; color: #767681; text-align: center; line-height: normal; word-wrap: break-word",text:""},{xtype:"label",id:"companyEditInvoice",name:"companyEdit",style:"height: 16px; font-family: Roboto; text-align: center; line-height: normal; word-wrap: break-word; margin-top: 5px; cursor: pointer;",html:'<svg class="icon small" id="editIcon" style="color: #00B19D; display: none;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use></svg><a href="#" id="editHref" style="color: #00B19D; display: none;">'+translate("edit",true)+"</a>",text:""},],listeners:{el:{mouseover:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","inline-block");a.setStyle("display","inline-block")},mouseout:function(){var b=Ext.get("editIcon");var a=Ext.get("editHref");b.setStyle("display","none");a.setStyle("display","none")}}}},{xtype:"container",flex:33,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:29,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",name:"resolutionDropdown",style:"text-align: right;",html:'<a class="form-add-invoice-header-number-dropdown" href="#" onclick="return false;" id="number-dropdown">'+translate("loading",true)+'<svg class="icon" style="margin-right: 0px !important; color: inherit !important;"><use xlink:href="/images/smile-icons.svg#caret-down"></use></svg></a>',hidden:true,smIsEnable:true,initComponent:function(){this.callParent(arguments);var a=AL.app.getController("Invoice");a.createResolutionDropdownList()},smIsEnable:function(){return this.smIsEnable},smEnable:function(){var a=Ext.get("number-dropdown");if(a){a.addCls("form-add-invoice-header-number-dropdown");a.removeCls("form-add-invoice-header-number-dropdown-disable")}this.smIsEnable=true},smDisable:function(){var a=Ext.get("number-dropdown");if(a){a.addCls("form-add-invoice-header-number-dropdown-disable");a.removeCls("form-add-invoice-header-number-dropdown")}this.smIsEnable=false}}]},{xtype:"container",name:"nextInvoiceNumberContainer",id:"nextInvoiceNumberContainer",flex:71,layout:{type:"hbox",pack:"end"},items:[]}]}]},{xtype:"container",flex:1,padding:"27 0 0 0",layout:{type:"hbox",align:"stretch"},items:[{xtype:"hidden",name:"idLocal"},{xtype:"hidden",name:"oldIdClient"},{xtype:"hidden",name:"oldClientName"},{xtype:"hidden",name:"oldIdResolution"},{xtype:"hidden",name:"oldResolutionName"},{xtype:"hidden",name:"oldResolutionStatus"},{xtype:"hidden",name:"oldDocumentType"},{xtype:"hidden",name:"oldPrefix"},{xtype:"hidden",name:"oldNumber"},{xtype:"container",name:"containerLeft",flex:1.5,items:[{xtype:"container",layout:"hbox",items:[{xtype:"combo",id:"invoiceClientCombo",fieldLabel:translate("client",true),name:"idClient",blankText:translate("itIsNecessaryToAssignAClientTo",true)+translate("theInvoice")+" "+translate("invoice")+".",style:"margin-bottom:5px",msgTarget:"side",labelAlign:"right",width:400,triggerCls:"x-form-search-trigger",labelPad:15,minChars:0,typeAhead:true,emptyText:translate("search",true),triggerAction:"all",allowBlank:false,store:"Clients",matchFieldWidth:false,forceSelection:true,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" id="createNewContact">'+translate("newContact",true)+"</a></div>",width:282,height:200,loadingText:translate("searching",true),emptyText:'<div style="padding:3px 10px 10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",cls:"search-input-list"},tooltip:{title:"Edición de cliente deshabilitada",description:"No puedes editar el cliente a causa de los "+translate("advances")+" aplicados en "+translate("theInvoice")+" "+translate("invoice"),visible:false},displayField:"name",valueField:"idLocal",labelWidth:123},{xtype:"box",width:170,style:"margin-left: 10px;",html:'<a href="#" title="'+translate("registerHereNewContactToAssociateWith",true)+translate("theInvoice")+" "+translate("invoice")+" "+translate("asClient")+'." data-tooltip-title="'+translate("createNewClient",true)+'" class="addAnother" id="createOtherContact">'+translate("newContact",true)+"</a>"}]},{xtype:"textfield",fieldLabel:translate("identification",true),name:"clientIdentification",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},{xtype:"textfield",fieldLabel:translate("phone",true),name:"clientPhone",width:400,labelAlign:"right",labelPad:15,readOnly:true,allowBlank:true,disabled:true,disabledCls:"x-item x-item-info",labelWidth:123},{xtype:"combo",name:"paymentType",fieldLabel:"Método de pago",displayField:"label",valueField:"value",labelAlign:"right",allowBlank:true,hidden:true,width:275,forceSelection:true,value:"",labelPad:15,queryMode:"local",store:{fields:["label","value"],data:[{label:"Una sola exhibición",value:"PUE"},{label:"Parcialidades o Diferido",value:"PPD"}]},labelWidth:123}]},{xtype:"container",flex:0.84,defaults:{msgTarget:"side",labelAlign:"right",width:300,labelWidth:110,labelPad:15},items:[{xtype:"combo",name:"type",fieldLabel:translate("invoiceType",true),allowBlank:false,store:"InvoiceTypes",valueField:"key",displayField:"value",hidden:true,requires:["colombia"]},{xtype:"combo",name:"saleTicketType",fieldLabel:translate("saleTicketType",true),store:"SaleTicketTypes",valueField:"key",displayField:"value",hidden:true,},{xtype:"datefield",id:"invoiceDateDateField",fieldLabel:translate("date",true),tooltip:translate("dateWhenIsEmitted",true)+" "+translate("theInvoice")+" "+translate("invoice")+".",name:"date",allowBlank:false,value:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineTheIssueDateOf",true)+translate("theInvoice")+" "+translate("invoice"),invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}."},{xtype:"combo",name:"paymentMethodCol",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Forma de pago",hidden:true,store:"PaymentMethods",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],tooltip:"Forma de pago de "+translate("theInvoice")+" "+translate("invoice")},{xtype:"combo",name:"paymentTypeCol",emptyText:"Buscar...",allowBlank:false,fieldLabel:"Medio de pago",hidden:true,store:"PaymentTypes",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,countries:["colombia"],isRequiredForElectronicInvoicing:["colombia"],tooltip:"Medio de pago de "+translate("theInvoice")+" "+translate("invoice"),triggerCls:"x-form-search-trigger",minChars:0,typeAhead:true,triggerAction:"all"},{xtype:"combo",name:"saleCondition",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Condición",store:"SaleConditions",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["costaRica","argentina"],isRequiredForElectronicInvoicing:["costaRica","argentina"],hidden:true},{xtype:"combo",name:"paymentForm",emptyText:"Seleccionar",allowBlank:true,fieldLabel:"Forma de pago",store:"PaymentForm",valueField:"id",displayField:"value",editable:false,hidden:true,isRequiredForElectronicInvoicing:["chile"],},{xtype:"combo",name:"economicActivity",emptyText:"Buscar...",fieldLabel:"Actividad económica",allowBlank:true,store:"EconomicActivities",valueField:"id",displayField:"value",displayTpl:'<tpl for=".">{id} - {value}</tpl>',queryMode:"remote",queryParam:"queryByIdAndValue",forceSelection:true,autoSelect:false,minChars:1,listConfig:{loadingText:"Buscando...",emptyText:'<div style="padding:10px !important; color: #666">'+translate("searchNotMatch",true)+"</div>",getInnerTpl:function(){return"{id} - {value}"}},hidden:true},{xtype:"combo",id:"invoiceTermCombo",fieldLabel:translate("deadline",true),name:"days",allowBlank:true,afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 5px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom" style="left: -274px; top: -52px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 260px;"><div class="text">'+translate("selectThePaymentDueDateYouCanAdd",true)+'<a href="/term" target="_blank">'+translate("here")+"</a>.</div></div></div></div>",store:"Terms",displayField:"name",valueField:"idLocal",queryMode:"local",listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl><div><a href="#" data-action="quickNewTerm" class="createNewTerm">'+translate("newDeadline",true)+".</a></div>"},editable:false},{xtype:"datefield",id:"invoiceDueDateDateField",fieldLabel:translate("due",true),name:"dueDate",tooltip:translate("expirationDateIsCalculatedAutomatically",true)+".",allowBlank:false,value:new Date(),minValue:new Date(),format:"d/m/Y",blankText:translate("itIsNecessaryToDefineADateWhen",true)+translate("theInvoice")+" "+translate("invoice")+" "+translate("expiresItself")+".",invalidText:"{0} "+translate("itIsNotAValidDateItMust",true)+" {1}."},{xtype:"combo",fieldLabel:"Concepto",name:"saleConcept",tooltip:"Indica el concepto de "+translate("theInvoice")+" "+translate("invoice"),emptyText:translate("selectSimple",true),allowBlank:true,hidden:true,store:"SalesConcepts",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["argentina"],isRequiredForElectronicInvoicing:["argentina"],},{xtype:"datefield",fieldLabel:"Fecha inicio de servicio",name:"startDateService",tooltip:"Indica la fecha en la que se inició la prestación del servicio",allowBlank:true,format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true},{xtype:"datefield",fieldLabel:"Fecha fin de servicio",name:"endDateService",tooltip:"Indica la fecha en la que se terminó la prestación del servicio",allowBlank:true,format:"d/m/Y",invalidText:"{0} no es una fecha válida - debe estar en el formato {1}",hidden:true},{xtype:"combo",name:"paymentMethod",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Método de pago",hidden:true,store:"PaymentMethods",valueField:"key",displayField:"value",queryMode:"local",forceSelection:true,editable:false,countries:["costaRica"],isRequiredForElectronicInvoicing:["costaRica"],},{xtype:"combo",fieldLabel:translate("currency",true),name:"currency",emptyText:translate("selectSimple",true),store:"CompanyCurrenciesCombo",displayField:"code",valueField:"code",queryMode:"local",allowBlank:true,matchFieldWidth:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{code}</div></tpl><div><a href="/currency" id="newCurrency">'+translate("newF",true)+" "+translate("currency")+"</a></div>",cls:"search-input-list"},afterBodyEl:'<div class="tooltip-wrapper add-invoice" style="margin-left: 6px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-bottom"><div class="tooltip-text-wrapper tooltip-small"><div class="text">'+translate("learnHowToCreateOtherCurrencies",true)+' <a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/205737499">'+translate("here")+"</a>.</div></div></div></div>",editable:false,hidden:true},{xtype:"displayfield",fieldLabel:translate("rate",true),name:"exchangeCurrencyDisplay",tooltip:" ",hidden:true},{xtype:"hidden",name:"exchangeCurrency",hidden:true},{xtype:"combo",name:"idWarehouse",fieldLabel:translate("warehouse",true),displayField:"name",valueField:"idLocal",store:"WarehouseCombo",editable:false,hidden:true,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:false,listConfig:{tpl:'<tpl for="."><div class="x-boundlist-item">{name}</div></tpl>'}},{xtype:"combo",name:"cfdiUse",fieldLabel:"Uso",displayField:"name",valueField:"code",store:"CFDIUseList",tooltip:"Indica el uso que el receptor le dará a la factura de venta",editable:false,labelAlign:"right",queryMode:"local",labelPad:15,emptyText:translate("selectSimple",true),allowBlank:true,hidden:true,matchFieldWidth:false,listConfig:{width:350}},{xtype:"combo",name:"operationType",emptyText:translate("selectSimple",true),allowBlank:true,fieldLabel:"Tipo de operación",store:"OperationTypes",valueField:"key",displayField:"value",forceSelection:true,queryMode:"local",editable:false,countries:["peru"],isRequiredForElectronicInvoicing:["peru"],hidden:true,labelAlign:"right",},{xtype:"textarea",fieldLabel:"Razón de sustitución",name:"substitutionCause",allowBlank:false,maxLength:180,hidden:true},{xtype:"combo",name:"idCostCenter",fieldLabel:translate("costCenter",true),hidden:true,allowBlank:true,emptyText:"Seleccionar",store:"CostCentersCombo",displayField:"name",valueField:"idLocal",editable:true,forceSelection:true,queryMode:"remote",listConfig:{width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list",},},]}]},{xtype:"container",flex:1,name:"advancedOptionsContainer",allowBlank:true,msgTarget:"side",labelAlign:"right",hidden:true,labelPad:15,items:[{xtype:"label",html:'<span id="advancedOptionsLink" href="#">Más opciones</span>'},{xtype:"invoice_FormAdvancedOptions",hidden:true}]}],listeners:{beforerender:function(e,c){switch(e.configs.country){case"peru":var b=this.down("container[name=containerLeft]");var d="";if(this.documentType==="saleTicket"){d='<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para emitir boletas de venta,<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270826" target="_blank">clic aquí</a>.</div></div></div></div>'}else{if(this.documentType==="invoice"||this.documentType==="null"){d='<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para emitir facturas de venta,<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270283" target="_blank">clic aquí</a>.</div></div></div></div>'}}var a={xtype:"switch",name:"documentTypeSwitch",label:{text:"Tipo de documento"},options:[{id:"invoice",value:"invoice",text:"Factura",checked:true},{id:"saleTicket",value:"saleTicket",text:"Boleta"},],hidden:true,afterBodyEl:d};b.insert(0,a);break;case"mexico":var b=this.down("container[name=containerLeft]");var d='<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayuda.getsoft.app/c%C3%B3mo-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.</div></div></div></div>';var a={xtype:"switch",name:"documentTypeSwitch",label:{text:"Tipo de documento"},options:[{id:"invoice",value:"invoice",text:"Factura",checked:true},{id:"saleTicket",value:"saleTicket",text:"Ticket"},],hidden:true,afterBodyEl:d};b.insert(0,a);break;case"costaRica":var b=this.down("container[name=containerLeft]");var d='<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayuda.getsoft.app/c%C3%B3mo-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.</div></div></div></div>';var a={xtype:"switch",name:"documentTypeSwitch",label:{text:"Tipo de documento"},options:[{id:"invoice",value:"invoice",text:"Factura",checked:true},{id:"saleTicket",value:"saleTicket",text:"Tiquete"},],hidden:true,afterBodyEl:d};b.insert(0,a);break;case"chile":var b=this.down("container[name=containerLeft]");var d='<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayudas.getsoft.app/ayuda-general/ingresos/como-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.</div></div></div></div>';var a={xtype:"switch",name:"documentTypeSwitch",label:{text:"Tipo de documento"},options:[{id:"invoice",value:"invoice",text:"Factura",checked:true},{id:"saleTicket",value:"saleTicket",text:"Boleta"},],hidden:true,afterBodyEl:d};b.insert(0,a);break}},afterrender:function(c,l){if(c.type||c.type==="edit"){var q=c.down("#nextInvoiceNumberContainer");var a,r;if(c.configs.country=="republicaDominicana"){a=77;r=77;maxLengthNumber=9}else{a=63;r=91;maxLengthNumber=10}var m=[{xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:a,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[1-9]([0-9]+)?$/,regexText:translate("theNumeration",true)+" "+translate("numeration")+" debe iniciar con un valor diferente a cero",allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" para "+translate("theInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:r,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:maxLengthNumber}];q.add(m)}switch(c.configs.country){case"peru":var g="";if(this.documentType==="saleTicket"){g="Si necesitas ayuda para "+translate("stamp")+" "+translate("saleTickets")+',<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270826" target="_blank">clic aquí</a>.'}else{if(this.documentType==="invoice"||this.documentType==="null"){g="Si necesitas ayuda para "+translate("stamp")+" "+translate("specializedInvoices")+',<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270283" target="_blank">clic aquí</a>.'}}var n=c.down("[name=documentTypeSwitch]");if(c.configs.companyRegime=="NEW_RUS"){n.hide()}var h=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:"DefaultTypeCustom",label:{text:"Tipo de documento"},mirrorElement:n,afTooltip:g,type:"switch",cls:"advancedfields",options:[{id:"invoice",value:"invoice",text:"Factura",},{id:"saleTicket",value:"saleTicket",text:"Boleta",},],});h.getSwitchElement().on("change",function(u){h.getMirrorElement().select(u);var s="advancedFieldTooltipDefaultTypeCustom";var t=Ext.ComponentQuery.query("[name="+s+"]")[0];var v="";if(u.value==="saleTicket"){v="Si necesitas ayuda para "+translate("stamp")+" "+translate("saleTickets")+',<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270826" target="_blank">clic aquí</a>.'}else{if(u.value==="invoice"||u.value==="null"){v="Si necesitas ayuda para "+translate("stamp")+" "+translate("specializedInvoices")+',<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270283" target="_blank">clic aquí</a>.'}}if(t){t.update(v)}});c.getPlugin("advancedfields").panel.insert(0,h);c.getPlugin("advancedfields").panel.show();break;case"mexico":var d=c.down("[name=paymentMethod]");if(d){d.destroy()}var f;if(c.configs.stampVersion=="3.3"){f="Forma de pago"}else{f="Método de pago"}var b=this.down("container[name=containerLeft]"),k={xtype:"panel",id:"paymentMethodContainer",layout:"hbox",border:false,width:430,style:" margin-bottom: 8px;",hidden:true,items:[{xtype:"combo",name:"paymentMethod",fieldLabel:f,valueField:"paymentMethod",displayField:"display",labelAlign:"right",emptyText:translate("selectSimple",true),allowBlank:false,forceSelection:true,value:"cash",labelPad:15,width:275,labelWidth:123,queryMode:"local",matchFieldWidth:false,value:"",store:Ext.create("AL.store.DocumentPaymentMethods",{country:c.configs.country,stampVersion:c.configs.stampVersion}),listeners:{change:function(w){var v=w.up("form");var s=w.getValue();if(s!=""&&s!=null){var y=v.down("textfield[name=accountNumber]");var x=Ext.ComponentQuery.query("advancedfield[name=accountNumberCustom]")[0];if(s!="cash"&&s!="other"&&s!="not-applicable"){y.enable();if(x){var u=Ext.ComponentQuery.query("advancedfield[name=paymentMethodCustom]")[0];var t=v.getPlugin("advancedfields").panel.items.indexOf(u);v.getPlugin("advancedfields").panel.insert(t+1,x)}}else{y.disable();y.setValue(null);if(x){v.getPlugin("advancedfields").panel.remove(x,false)}}}}}},{xtype:"textfield",name:"accountNumber",emptyText:"Número cuenta",style:"margin-left:15px; ",width:110,tooltip:"Ingresa aquí los últimos cuatro números de la cuenta o tarjeta",hideLabel:true,disabled:true,minLength:4},]};b.insert(5,k);var p=b.down("[name=paymentMethod]");var o=b.down("[name=accountNumber]");c.getPlugin("advancedfields").insertElement(p,{after:"paymentTypeCustom",required:true,countries:["mexico"],name:"paymentMethod",afTooltip:"En sustituciones se conserva la forma de pago original."});c.getPlugin("advancedfields").insertElement(o,{after:"paymentMethodCustom",countries:["mexico"],title:"Número de cuenta",empty:"Número de cuenta",type:"textfield",name:"accountNumber",afTooltip:"Ingresa aquí los últimos cuatro números de tú cuenta o tarjeta",minLength:4,customRender:function(t,x,v,z,u){var w=v.down("combo[name=paymentMethod]");var s=w.getValue();var y=Ext.ComponentQuery.query("advancedfield[name=accountNumberCustom]")[0];if(!(s!="cash"&&s!="other"&&s!="not-applicable")){if(y){v.getPlugin("advancedfields").panel.remove(y,false)}}}});if(!(c.type||c.type==="edit")){var n=c.down("[name=documentTypeSwitch]");var h=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:"DefaultTypeCustom",label:{text:"Tipo de documento"},mirrorElement:n,type:"switch",cls:"advancedfields",afTooltip:'Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayuda.getsoft.app/c%C3%B3mo-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.',options:[{id:"invoice",value:"invoice",text:"Factura",},{id:"saleTicket",value:"saleTicket",text:"Ticket",},],});if(!(c.idInvoice||c.idEstimate||c.idRemission)){h.getSwitchElement().on("change",function(s){h.getMirrorElement().select(s)});c.getPlugin("advancedfields").panel.insert(0,h);c.getPlugin("advancedfields").panel.show()}}break;case"costaRica":var j=c.down("[name=saleCondition]");if(j){j.hide()}if(!(c.type||c.type==="edit")){var n=c.down("[name=documentTypeSwitch]");var h=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:"DefaultTypeCustom",label:{text:"Tipo de documento"},mirrorElement:n,type:"switch",cls:"advancedfields",afTooltip:'Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayuda.getsoft.app/c%C3%B3mo-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.',options:[{id:"invoice",value:"invoice",text:"Factura",},{id:"saleTicket",value:"saleTicket",text:"Tiquete",},],});if(!(c.idInvoice||c.idEstimate||c.idRemission)){h.getSwitchElement().on("change",function(s){h.getMirrorElement().select(s)});c.getPlugin("advancedfields").panel.insert(0,h);c.getPlugin("advancedfields").panel.show()}}break;case"chile":var e=c.down("[name=paymentForm]");if(e){e.hide()}if(!(c.type||c.type==="edit")){var n=c.down("[name=documentTypeSwitch]");var h=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:"DefaultTypeCustom",label:{text:"Tipo de documento"},mirrorElement:n,type:"switch",cls:"advancedfields",afTooltip:'Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayudas.getsoft.app/ayuda-general/ingresos/como-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.',options:[{id:"invoice",value:"invoice",text:"Factura",},{id:"saleTicket",value:"saleTicket",text:"Boleta",},],});if(!(c.idInvoice||c.idEstimate||c.idRemission)){h.getSwitchElement().on("change",function(s){h.getMirrorElement().select(s)});c.getPlugin("advancedfields").panel.insert(0,h);c.getPlugin("advancedfields").panel.show()}}break}}},getFieldValuesAsMetadata:function(){var j=null;var k=this.configs&&this.configs.country?this.configs.country:null;switch(k){case"colombia":if(this.configs.isActiveElectronicInvoicing&&this.configs.electronicInvoicingVersion=="2.1"){var b=this.getPlugin("advancedfields");var g=Ext.ComponentQuery.query("[name=operationTypeCol]")[0];var e=this.down("combo[name=paymentMethodCol]");var p=this.down("combo[name=paymentTypeCol]");var m=this.down("textfield[name=numberPurchaseOrderCol]");var n=b.getItemFromPanelByName("deliveryTerm");j={operationType:g.getValue(),deliveryTerm:n?n.getComboElement().getValue():null,paymentMethod:e.getValue(),paymentType:e.getValue()=="CASH"?p.getValue():null,numberPurchaseOrder:m.getValue(),}}break;case"peru":var g=this.down("combo[name=operationType]");var m=this.down("textfield[name=numberPurchaseOrder]");j={operationType:g.getValue(),numberPurchaseOrder:m.getValue()};break;case"costaRica":var o=this.down("combo[name=saleCondition]");var e=this.down("combo[name=paymentMethod]");var a=this.down("combo[name=economicActivity]");j={saleCondition:o.getValue(),paymentMethod:e.getValue(),economicActivity:a.getValue(),};if(this.configs.replace){var h=this.down("textarea[name=substitutionCause]");j.associatedDocument={association:{cause:h.getValue()}}}break;case"argentina":var c=this.down("combo[name=saleConcept]"),f=this.down("datefield[name=startDateService]"),l=this.down("datefield[name=endDateService]"),o=this.down("combo[name=saleCondition]");j={saleConcept:c.getValue(),saleCondition:o.getValue(),startDateService:Ext.Date.format(f.getValue(),"Y-m-d"),endDateService:Ext.Date.format(l.getValue(),"Y-m-d"),};break;case"chile":var d=this.down("combo[name=paymentForm]");var a=this.down("combo[name=economicActivity]");j={paymentForm:d.getValue(),economicActivity:a.getValue()};break;case"mexico":var q=this.down("combo[name=cfdiUse]"),p=this.down("combo[name=paymentType]"),j={cfdiUse:q.getValue(),paymentType:p.getValue(),};break}return j},setFieldValuesFromMetadata:function(j){var k=this.configs&&this.configs.country?this.configs.country:null;switch(k){case"colombia":if(this.configs.isActiveElectronicInvoicing&&this.configs.electronicInvoicingVersion=="2.1"){var b=this.getPlugin("advancedfields");if(typeof j.operationType!=="undefined"){var g=Ext.ComponentQuery.query("[name=operationTypeCol]")[0];var n=g.getStore();var r=function(){var v=Ext.get("advancedFieldTooltipoperationTypeColCustomContainer");if(v){if(j.operationType0==="AIU_SERVICE"){v.show()}else{v.hide()}}g.setValue(j.operationType);if(typeof j.deliveryTerm!=="undefined"){var s=b.getItemFromPanelByName("deliveryTerm");if(s){var u=s.getComboElement();var t=u.getStore();if(t.hasLoaded()){u.setValue(j.deliveryTerm)}else{t.on("load",function(w){u.setValue(j.deliveryTerm)})}}}};if(n.hasLoaded()){r()}else{n.on("load",function(s){r()})}}if(typeof j.paymentMethod!=="undefined"){var d=this.down("combo[name=paymentMethodCol]");if(d){d.setValue(j.paymentMethod)}}if(typeof j.paymentType!=="undefined"){var p=this.down("combo[name=paymentTypeCol]");if(p){p.setValue(j.paymentType)}}if(typeof j.numberPurchaseOrder!=="undefined"){var m=this.down("textfield[name=numberPurchaseOrderCol]");if(m){m.setValue(j.numberPurchaseOrder)}}}break;case"peru":if(typeof j.operationType!=="undefined"){var g=this.down("combo[name=operationType]");var n=g.getStore();if(n.hasLoaded()){g.setValue(j.operationType)}else{n.on("load",function(s){g.setValue(j.operationType)})}}if(typeof j.numberPurchaseOrder!=="undefined"){var m=this.down("textfield[name=numberPurchaseOrder]");if(m){m.setValue(j.numberPurchaseOrder)}}break;case"costaRica":if(typeof j.saleCondition!=="undefined"){var o=this.down("combo[name=saleCondition]");var n=o.getStore();if(n.hasLoaded()){o.setValue(j.saleCondition)}else{n.on("load",function(s){o.setValue(j.saleCondition)})}}if(typeof j.paymentMethod!=="undefined"){var d=this.down("combo[name=paymentMethod]");var n=d.getStore();if(n.hasLoaded()){d.setValue(j.paymentMethod)}else{n.on("load",function(s){d.setValue(j.paymentMethod)})}}if(typeof j.economicActivity!=="undefined"){var a=this.down("combo[name=economicActivity]");var n=a.getStore();if(n.hasLoaded()){a.setValue(j.economicActivity)}else{n.on("load",function(s){a.setValue(j.economicActivity)})}}if(typeof j.associatedDocument!=="undefined"&&typeof j.associatedDocument.association!=="undefined"&&typeof j.associatedDocument.association.cause!=="undefined"){var h=this.down("textarea[name=substitutionCause]");h.setValue(j.associatedDocument.association.cause)}break;case"argentina":if(typeof j.saleCondition!=="undefined"){var o=this.down("combo[name=saleCondition]");var n=o.getStore();if(n.hasLoaded()){o.setValue(j.saleCondition)}else{n.on("load",function(s){o.setValue(j.saleCondition)})}}if(typeof j.saleConcept!=="undefined"){var c=this.down("combo[name=saleConcept]");var n=c.getStore();if(n.hasLoaded()){c.setValue(j.saleConcept)}else{n.on("load",function(s){c.setValue(j.saleConcept)})}}if(typeof j.startDateService!=="undefined"&&j.startDateService!=""){var f=this.down("datefield[name=startDateService]");f.setValue(j.startDateService)}if(typeof j.endDateService!=="undefined"&&j.startDateService!=""){var l=this.down("datefield[name=endDateService]");l.setValue(j.endDateService)}break;case"chile":if(typeof j.paymentForm!=="undefined"){var e=this.down("combo[name=paymentForm]");e.setValue(j.paymentForm)}if(typeof j.economicActivity!=="undefined"){var a=this.down("combo[name=economicActivity]");var n=a.getStore();if(n.hasLoaded()){a.setValue(j.economicActivity)}else{n.on("storeloaded",function(){a.setValue(j.economicActivity)});n.on("load",function(s){n.fireEvent("storeloaded");n.suspendEvent("storeloaded")})}}break;case"mexico":if(typeof j.cfdiUse!=="undefined"){var q=this.down("combo[name=cfdiUse]");var n=q.getStore();if(n.hasLoaded()){q.setValue(j.cfdiUse)}else{n.on("load",function(s){q.setValue(j.cfdiUse)})}}if(typeof j.paymentType!=="undefined"){var p=this.down("combo[name=saleConcept]");var n=p.getStore();if(n.hasLoaded()){p.setValue(j.paymentType)}else{n.on("load",function(s){p.setValue(j.paymentType)})}}break}},isAvailableTypeField:function(){return this.configs&&(Ext.Array.contains(["costaRica","chile"],this.configs.country)||(this.configs.country=="colombia"&&this.configs.electronicInvoicingVersion=="2.1"))}});Ext.define("AL.controller.Invoice",{extend:"Ext.app.Controller",views:["invoice.FormAddInvoice","invoice.GridAll","buttons.SaveInvoice","invoice.FormAddRetention","invoice.WindowPrint","invoice.FormAddItem","common.GridAllInvoices","common.FormSignature","invoice.FormAddAutoRetention","invoice.FormAddRetentionSuggested","invoice.GridVersions","invoice.MoreActionsButton","invoice.FormAdvancedOptions","invoice.WindowReactiveSat","invoice.FormAddRemissions","invoice.TotalLeftContainer","invoice.BottomContainer","remission.ComboRemissions","remission.RemissionForInvoice","invoice.FormCloseInvoice","invoice.AddVoidCause","ux.form.Switch","ux.smile.floating.DropdownList","item.FormEditDiscount","invoice.GridAllGlobalInvoices","common.CustomizeOptionsDropdownList",],stores:["Invoices","Clients","Terms","Items","ItemsSold","Taxes","ItemsCombo","InvoicePayments","Retentions","AutoRetentions","ResolutionsCombo","InvoiceVersions","SellersCombo","PriceListCombo","InvoiceTemplates","RemissionsCombo","CompanyCurrenciesCombo","DocumentPaymentMethods","CategoriesCombo","OptionsForCloseInvoice","VoidCauses","WarehouseCombo","CFDIUseList","SaleConditions","PaymentForm","PaymentMethods","GlobalInvoices","OperationTypes","SalesConcepts","EconomicActivities","PaymentTypes","InvoiceTypes","SaleTicketTypes","DeliveryTerms","CostCentersCombo",],models:["Invoice","Client","Term","Item","ItemSold","Tax","InvoicePayment","Retention","AutoRetention","Resolution","InvoiceVersion","Seller","PriceList","Remission","CompanyCurrency","Warehouse","CountryLegalParameter","GlobalInvoice","CostCenter",],itemCount:0,resiszeTimeout:null,maxHeight:0,changeIdPriceList:false,isChangedIdPriceList:false,isChangedIdSeller:false,_sourcePaymentMethod:"none",init:function(){var a=this;this.application.addListener("nextInvoiceNumberEdited",function(h){var f=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(f){var d=f.down("#nextInvoiceNumberContainer");d.removeAll(false);var c=Ext.ComponentQuery.query("invoice_BottomContainer")[0];var q=c?c.down("box[name=resolutionText]"):null;var g=c.down("textarea[name=resolutionPie]");if(g&&q){g.hide();q.hide();if((f.configs.country=="peru"||f.configs.country=="costaRica")&&(h.isElectronicResolution)){g.hide();q.show();var r="";switch(f.configs.country){case"peru":r="Autorizado mediante resolución Nº 032-005-0000211";break;case"costaRica":r="Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019";break;default:r=translate("payOnCheckingAccount",true);resolutionEmptyTextLabel.show();break}q.update(r)}else{g.show();q.hide();if(h.resolutionText){g.setValue(h.resolutionText)}else{g.setValue("")}}}if(h.autoincrement==="yes"){var l=h.prefix?new String(h.prefix):"";var j=new String(h.nextInvoiceNumber);var k="";if(f.configs){switch(f.configs.country){case"argentina":j=Ext.String.leftPad(j,8,"0");k="-";break;case"peru":k=l?"-":"";break}}var s=l+k+j;var e=a.calculateAutoResolutionNumberFieldWidth(s);d.add({xtype:"label",padding:"5 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",padding:"0 3 0 0",width:e,height:48,fieldCls:"form-add-invoice-header-number-left",readOnly:true,value:s},{xtype:"box",padding:"5 0 0 0",html:'<a class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})}else{var o=[{xtype:"label",padding:"5 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:59,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[1-9]([0-9]+)?$/,regexText:translate("theNumeration",true)+" "+translate("numeration")+" debe iniciar con un valor diferente a cero",allowBlank:false,blankText:"Debe ingresar el "+translate("number")+" "+translate("ofTheInvoice")+" "+translate("invoice"),padding:"0 3 0 0",width:95,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:10},{xtype:"box",padding:"5 0 0 0",html:'<a class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'}];d.add(o)}if(f.configs&&a.getCountriesWithStamp().indexOf(f.configs.country)!==-1&&f.configs.isActiveElectronicInvoicing){var p=Ext.getStore("ResolutionsCombo");if(p.hasLoaded()){a.updateResolution()}else{p.load(function(){a.updateResolution()})}}var b=Ext.getStore("ResolutionsCombo");var m=b.findExact("idLocal",h.idLocal);var n=p.getAt(m);n.set("isElectronicResolution",h.isElectronicResolution)}},this);this.application.addListener("clientCreated",function(f){var e=f.initiator;var c=f.record;var d=e.getStore();if(f.country=="mexico"){var b=Ext.create("AL.model.Client",c.data)}else{var b=Ext.create("AL.model.Client",c)}d.add(b);e.select(c.get("idLocal"));this.getContact(e,[c])},this);this.application.addListener("companyEditedToStamp",function(c){var b=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];b.configs.isActiveElectronicInvoicing=true;c.action="save";this.saveInvoice(c)},this);this.application.addListener("convertInvoiceToOpen",function(c){var d=this;var b=c.record;if(c.stamp){b.stampInvoice=c.stamp}else{b.stampInvoice="yes"}var e=c.callback;d.convertInvoiceToOpen(b,e,c.showWarning)},this);this.application.addListener("itemCreatedInvoice",function(d){var b=d.initiator;var e=d.record;var k=b.getStore();var j=false;if(e.get("isInventariable")=="yes"&&e.get("warehouses")){var l=Ext.decode(e.get("warehouses"));var c=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var h=c.getSelectedRecord().get("idLocal");Ext.each(l,function(m){if(m.id==h){j=true;return}})}else{j=true}var g=e.multipleTaxes=="yes"?Ext.decode(e.get("idTax")):[e.get("idTax")];var f=[];Ext.each(g,function(m){f.push({id:m})});e.set("taxes",f);if(j){k.add(e);k.getProxy().clearCacheByTerms([e.get("name"),e.get("reference")]);b.select(e.get("idLocal"));b.fireEvent("select2",{combo:b,record:e})}else{GlobalMsg.showNotification({title:"Advertencia",text:"El "+translate("item")+" se creó pero no se agregó "+translate("toTheInvoice")+" "+translate("invoice")+" ya que éste no se encuentra en "+translate("theWarehouse")+" "+translate("warehouse")+" seleccionada",type:"warning"})}},this);this.application.addListener("deleteInvoice",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("invoice"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+b.get("invoiceNumber")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e==="yes"){Ext.Ajax.request({url:"/invoice/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){c.up("gridpanel").getPlugin("recordSelector").selectRecords([b],false);var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("deleteGlobalInvoice",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("remove ",true)+" "+translate("globalInvoice"),msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theGlobalInvoice")+" "+b.get("invoiceNumber")+"? Esta operación no se puede deshacer.",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e==="yes"){Ext.Ajax.request({url:"/global-invoice/delete/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(g,h){var j=Ext.decode(g.responseText);if(j.success){var f=c.getStore();f.load()}else{if(j.cause){Ext.MessageBox.alert("Error",j.cause)}}},failure:function(){}})}}})},this);this.application.addListener("voidGlobalInvoice",function(d){var b=d.record;var c=d.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("globalInvoice"),msg:translate("areYouSureYouWantTo",true)+translate("cancel")+" "+translate("theGlobalInvoice")+" "+b.get("invoiceNumber")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f){if(f=="yes"){var e=Ext.create("AL.LoadMask",{target:c,msg:translate("loading",true)});e.show();e.addDependantTask();Ext.Ajax.request({url:"/global-invoice/void/format/json",method:"POST",params:{id:b.get("idLocal")},success:function(h,l){var n=Ext.decode(h.responseText);var n=null;var k=null;try{n=Ext.decode(h.responseText)}catch(j){k=j.message}if(n.success){var g=c.getStore();g.load()}else{var m="Ha ocurrido un error, por favor inténtalo de nuevo.";if(n&&n.cause){m=n.cause}else{if(k.match(/SOAP-ERROR/)){m="El "+translate("governmentEntity")+" está presentando intermitencias. Intenta cancelar tu factura más tarde."}}Ext.MessageBox.alert("Error",m)}e.endDependantTask()},failure:function(){e.endDependantTask()}})}}})},this);this.application.addListener("openGlobalInvoice",function(d){var b=d.record;var c=d.initiator;Ext.Ajax.request({url:"/global-invoice/stamp/format/json/id/"+b.get("idLocal"),method:"POST",success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){var e=c.getStore();e.load()}else{Ext.MessageBox.alert("Error",h.cause)}},failure:function(){}})},this);this.application.addListener("voidInvoice",function(f){var b=f.record;var e=f.initiator;var g=translate("cancel",true)+" "+translate("invoice");var c=translate("areYouSureYouWantToVoid",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("with")+" "+translate("number")+" "+b.get("invoiceNumber")+"? ";if(b.get("showSatMessage")=="yes"){c+="<br><strong>Debes tener en cuenta que este documento NO se "+translate("willCancel")+" en el SAT ya que fue timbrado en otro sistema</strong>"}var d=null;if(e.country=="mexico"){d={text:'Para saber más sobre la cancelación de tus facturas, haz <strong><a href="https://ayudas.getsoft.app/es/articles/3567406-cancela-tus-facturas-cfdi-mexico" target="_blank">clic aquí</a></strong>.',style:"top: 17px; height: 50px; width: 300px; left: -40px;",nodeStyle:"float: right; position: relative; top: -32px; left: -220px;"}}Ext.create("AL.view.common.SmileWindow",{autoShow:true,modal:true,border:false,width:500,title:g,smileTooltip:d,bodyPadding:"20 20",bodyStyle:"background: transparent",items:{xtype:"form",items:[{xtype:"box",html:'<div class="sublabel" style="font-size: 12px;text-align: center; padding: 5px 10px 20px 10px;">'+c+"</div>"}]},footer:{items:[{text:"Si",cls:"button main-button",handler:function(j){var n=j.up("window");var k=n.down("form");n.destroy();if(["republicaDominicana","peru"].indexOf(e.country)!==-1){var h;if(b.get("date")){h=b.get("date")}else{h=new Date(e.date);h.setDate(h.getDate()+1)}var m=Ext.create("AL.view.invoice.AddVoidCause",{voidAction:true,documentType:"invoice",documentId:b.get("idLocal"),documentDate:h,country:e.country,refreshVoidCauses:f.refreshVoidCauses&&f.refreshVoidCauses===true?true:false,success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){if(e.getStore){var o=e.getStore();o.load();m.destroy();if(r.stamp===true){GlobalMsg.showNotification({title:"Éxito",text:translate("theInvoice",true)+" "+translate("invoice")+" ha sido "+translate("canceledFemale")+", se enviará en el comunicado de bajas a las 11:50pm",type:"success"})}}else{if(r.stamp===true){m.destroy();GlobalMsg.showNotification({title:"Éxito",text:translate("theInvoice",true)+" "+translate("invoice")+" ha sido "+translate("canceledFemale")+", se enviará en el comunicado de bajas a las 11:50pm",type:"success"});setTimeout(function(){window.location.reload()},3000)}else{window.location.reload()}}}else{Ext.MessageBox.alert("Error",r.cause)}}})}else{var l=Ext.create("AL.LoadMask",{target:e,msg:translate("loading",true)});l.show();l.addDependantTask();Ext.Ajax.request({url:"/invoice/void/format/json",method:"POST",timeout:120000,params:{id:b.get("idLocal")},success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){if(e.getStore){var o=e.getStore();o.load();if(r.needReplacement){Ext.Msg.show({title:"Sustitución",icon:Ext.Msg.QUESTION,msg:"La "+translate("invoice")+" se ha "+translate("canceledMale")+' correctamente. Recuerda sustituirla, puedes hacerlo <a href="/invoice/add/idInvoice/'+b.get("idLocal")+'/replace/true">aquí</a>.',buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})}}else{window.location.reload()}}else{if(r.mxVoidRequest){Ext.MessageBox.alert(translate("cancelation",true)+" en proceso",r.cause);Ext.Msg.show({title:translate("cancelation",true),msg:r.cause,buttons:Ext.Msg.YES,buttonText:{yes:"Aceptar"},fn:function(s){window.location.reload()}})}else{Ext.MessageBox.alert("Error",r.cause)}}l.endDependantTask()},failure:function(){l.endDependantTask()}})}}},{text:"No",handler:function(){this.up("window").close()},cls:"button",}]}})},this);this.application.addListener("addRemission",function(){var d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0],f=Ext.ComponentQuery.query("invoice_FormAddRemissions")[0],b=d.down("combo[name=saleConcept]"),h=b.getValue(),c=Ext.ComponentQuery.query("remission_RemissionForInvoice"),g=false;Ext.each(c,function(j){var k=j.down("combo[name=idRemission]");if(k&&k.getValue()&&d.configs.country==="argentina"&&h!=="PRODUCTOS"&&c.length>1){Ext.Msg.show({title:"Información",msg:"Solo puedes agregar "+translate("aRemission")+" "+translate("remission")+" de Concepto Servicio o Productos y servicios por "+translate("invoice")+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO});g=true;return}});if(g){return}var e=Ext.create("AL.view.remission.RemissionForInvoice");f.add(e)},this);this.application.addListener("termCreated",function(d){var e=d.initiator;var b=d.record;var c=e.getStore();c.add(b);e.select(b.get("idLocal"));a.changeDueDateFromDays(e.getSelectedRecord())},this);this.application.addListener("retentionCreatedInvoice",function(e){var f=e.initiator;var b=e.record;var c=f.getStore();var d=f.up("form");c.add(b);f.select(b.get("idLocal"));this.calculateRetentionAfterRetentionCreated(d,f,[b])},this);this.control({invoice_MoreActionsButton:{beforerender:function(b,e){if(Ext.get("printInvoice")){Ext.get("printInvoice").on("click",function(h,g){h.preventDefault();if(g.getAttribute("data-canPrintOrDownload")){a.printInvoice(g,h)}})}if(Ext.get("stampInvoice")){Ext.get("stampInvoice").on("click",function(h,g){a.stampInvoice(g,h)})}if(b.menu.down("menuitem[action=print]")){if(b.canPrintOrDownload){b.menu.down("menuitem[action=print]").on("click",function(h,g){a.printInvoice(h,g)})}else{b.menu.down("menuitem[action=print]").hide()}}if(Ext.get("downloadInvoice")){Ext.get("downloadInvoice").on("click",function(h,g){h.preventDefault();if(g.getAttribute("data-canPrintOrDownload")){a.downloadInvoice(g,h)}})}if(b.menu.down("menuitem[action=download]")){if(b.canPrintOrDownload){b.menu.down("menuitem[action=download]").on("click",function(h,g){a.downloadInvoice(h,g)})}else{b.menu.down("menuitem[action=download]").hide()}}var f=Ext.get("emailInvoice");if(f){f.on("click",function(h,g){a.emailInvoice(g,h)})}if(b.menu.down("menuitem[action=email]")){b.menu.down("menuitem[action=email]").on("click",function(h,g){a.emailInvoice(h,g)})}var c=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0];if(c.sendByEmail&&c.sendByEmail===true){var d=Ext.get("emailInvoice");a.emailInvoice(d,undefined)}}},"menuitem[action=addVoidCause]":{click:function(b,c){c.preventDefault();var d=b.up("splitbutton");a.addVoidCause(d)}},"menuitem[action=cloneInvoice]":{click:function(b,c){c.preventDefault();var d=b.up("splitbutton");if(d.warehouseStatus=="inactive"){GlobalMsg.showNotification({title:"Error",text:translate("theInvoice",true)+" "+translate("invoice")+" no se puede clonar ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=b.href}}},"menuitem[action=makeRecurring]":{click:function(b,c){c.preventDefault();var d=b.up("splitbutton");if(d.warehouseStatus=="inactive"){GlobalMsg.showNotification({title:"Error",text:translate("theInvoice",true)+" "+translate("invoice")+" no se puede volver "+translate("recurring")+" ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=b.href}}},"menuitem[action=voidInvoiceFromMoreActions]":{click:function(c,d){d.preventDefault();var f=c.up("splitbutton");var b=Ext.create("AL.model.Invoice",{idLocal:f.idLocal,invoiceNumber:f.invoiceNumber,showSatMessage:f.showSatMessage});a.application.fireEvent("voidInvoice",{initiator:f,record:b})}},"menuitem[action=convertInvoiceToOpen]":{click:function(d,g){g.preventDefault();var h=d.up("splitbutton");var c=d.stamp=="no"?"no":"yes";var b=Ext.create("AL.model.Invoice",{idLocal:h.idLocal});var f=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0];if(f.total===0){Ext.Msg.show({title:"Advertencia",msg:"El total de esta factura es cero, si la facturas no podrá ser editada. ¿Deseas continuar?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.WARNING,fn:function(e){if(e==="ok"){a.application.fireEvent("convertInvoiceToOpen",{record:b,stamp:c,showWindow:"no",callback:function(j){GlobalMsg.showNotification({title:translate("success",true),text:translate("theInvoice",true)+" "+translate("invoice")+" "+translate("hasBeenSuccessfullyCheckedIn"),type:"success"});setTimeout(function(){window.location.reload()},2500)}})}else{window.location.reload()}}})}else{a.application.fireEvent("convertInvoiceToOpen",{record:b,stamp:c,callback:function(e){GlobalMsg.showNotification({title:translate("success",true),text:translate("theInvoice",true)+" "+translate("invoice")+" "+translate("hasBeenSuccessfullyCheckedIn"),type:"success"});setTimeout(function(){window.location.reload()},2500)}})}}},"menuitem[action=addInvoicePayment]":{click:function(g,h){h.preventDefault();var j=g.up("splitbutton");var k=j.idLocal;var c=j.status;if(c==="draft"){var b=Ext.create("AL.model.Invoice",{idLocal:k,status:c});var d=Ext.ComponentQuery.query("client_GridInvoices")[0];var f=Ext.ComponentQuery.query("invoice_GridAll")[0];if((d&&d.country=="mexico")||(f&&f.country=="mexico")||(j&&j.country=="mexico")){willStamp="timbrará"}Ext.Msg.show({msg:translate("yourInvoiceIsInStatusWhenYouPerformThisActionItWillBeIssuedAndConvertedToStatus",true,{willStamp:willStamp})+" "+translate("areYouSureYouWantToPerformThisAction",true),buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.QUESTION,fn:function(e){if(e=="yes"){a.application.fireEvent("convertInvoiceToOpen",{record:b,callback:function(){window.location="/transaction/in/number/"+b.get("idLocal")}})}else{this.close()}}})}else{window.location="/transaction/in/number/"+k}}},"menuitem[action=uploadPdfFile]":{click:function(f){var e={};var d="";var b=f.up("button");if(b.maxFiles){d=b.maxFiles}if(b.canUpload=="yes"){e.type="invoicePdf";e.idType=b.idType;this.application.fireEvent("uploadFile",e)}else{var c=Ext.create("AL.modal.PlanLimit",{configs:{message:"Has agregado <strong>"+d+" archivos adjuntos </strong> disponibles en tu plan actual. Elige un nuevo plan para realizar esta acción y seguir creciendo con Alegra."}});c.init()}}},"menuitem[action=closeInvoice]":{click:function(g,j){var d=g.up("button"),f=Ext.create("AL.view.invoice.FormCloseInvoice",{invoiceNumber:d.invoiceNumber,invoiceId:d.idLocal,date:d.date,emergent:true}),h=f.down("combo[name=idOptions]"),b=function(){var e=h.store.findRecord("default",true);if(e){h.select(e)}};if(!d.closeInvoiceOptionsStore){var c=Ext.create("AL.store.OptionsForCloseInvoice");c.getProxy().setExtraParam("query","");h.lastQuery="";h.store=c;d.closeInvoiceOptionsStore=c}else{h.lastQuery="";h.store=d.closeInvoiceOptionsStore}if(!h.store.hasLoaded()&&!h.store.isLoading()){h.store.load({callback:b})}else{b()}}},invoice_FormCloseInvoice:{afterrender:function(b){b.down("textarea[name=observations]").setValue(translate("itIsAdjustedDueToTheClosureOf",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("number")+": "+b.invoiceNumber);var c=b.down("combo[name=idCategory]");c.store.proxy.url+="type/expense"}},"invoice_FormCloseInvoice datefield[name=date]":{render:function(g){var j=g.up("invoice_FormCloseInvoice");var e=new Date();var d=new Date(j.date);var c=new Date(d.getFullYear(),d.getMonth(),d.getDate()+1);var h=new Date(e.getFullYear(),e.getMonth()-1,1);var f=new Date(e.getFullYear(),e.getMonth(),31);var b=e.getMonth()===f.getMonth()?f:new Date(e.getFullYear(),e.getMonth(),30);g.setMinValue(d>h?c:h);g.setMaxValue(b);g.setValue((d>e)?c:e)}},"invoice_FormCloseInvoice combo[name=idCategory]":{hide:function(b){b.allowBlank=true;b.up("form[name=formCloseInvoice]").getForm().isValid()},show:function(b){b.allowBlank=false}},"invoice_FormCloseInvoice combo[name=idOptions]":{change:function(h,f){var e=h.up("invoice_FormCloseInvoice"),c=h.findRecord("idLocal",f);var g=e.down("combo[name=idCategory]");var j=e.down("textarea[name=observations]");var b=e.down("box[name=help-category]");var d="";j.setValue(translate("itIsAdjustedDueToTheClosureOf",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("number")+": "+e.invoiceNumber);if(c.get("keyword")=="other-categories"){g.show()}else{if(c.get("keyword")=="financial-discount"){j.setValue(translate("itIsAdjustedBecauseOfTheApplicationOfFinancialDiscountIn",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("number")+": "+e.invoiceNumber);d=translate("theInvoiceIsClosedWithoutPaymentByApplicationOfTheFinancialDiscountOrByEarlyPayment",true);g.hide()}else{d=translate("theInvoiceIsClosedWithoutPaymentAndAnExpenseIsGenerated",true);g.hide()}}b.update('<div style="width: 229px;display: inline-block;margin-right: 27px;"></div><div style="width:60%; display:inline-block;'+(d?"margin-bottom:20px":"")+' ">'+d+"</div>")}},"invoice_FormCloseInvoice button[action=save]":{click:function(j){var d=j.up("invoice_FormCloseInvoice");var h=d.down("combo[name=idOptions]");var k=d.down("combo[name=idCategory]");var e=d.down("textarea[name=observations]").getValue();var l=d.down("datefield[name=date]");var f=h.getValue();if(f==1){if(!k.getSelectedRecord()){k.markInvalid("Debes seleccionar la "+translate("category",true)+", no solo escribir su nombre");return}f=k.getValue()}if(f){GlobalRedirector.go({zoneTitle:translate("closingAction",true)+" "+translate("invoice")});var c=d.invoiceId;var g={idResource:c,resourceType:"invoice",idCategory:f,date:new Date(l.getValue()),observations:e};var b="/invoice/close/id/"+c+"/format/json";Ext.Ajax.request({url:b,method:"POST",params:g,success:function(m){var o=Ext.decode(m.responseText);if(o.success){window.location.reload()}else{var n=o.cause?o.cause:"Ha ocurrido un error al cerrar "+translate("theInvoice")+" "+translate("invoice");GlobalRedirector.close();if(d.emergent){Ext.MessageBox.alert("Error",n)}else{GlobalMsg.showErrorMessage("Ha ocurrido un error cerrando "+translate("theInvoice")+" "+translate("invoice"),n)}}}})}else{d.down("form[name=formCloseInvoice]").getForm().isValid();if(d.emergent){Ext.MessageBox.alert("Error","Hay un error en el formulario")}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}}}},"invoice_FormCloseInvoice button[action=close]":{click:function(b){b.up("window").close()}},buttons_SaveInvoice:{beforerender:function(d){var w=this;var b=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if((d.country=="mexico"&&d.addFromXml!="yes")||(w.getCountriesWithStamp().indexOf(d.country)!==-1&&d.isActiveElectronicInvoicing)){var c=d.down("splitbutton[action=save]");c.text=translate("stamp",true);var f=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var v=f.down("[afterSave=createInvoice]");if(v){v.setText(translate("stamp",true)+" y crear nueva")}var p=Ext.ComponentQuery.query("menu[action=saveInvoice]")[0];var t=p.down("[afterSave=print]");if(t){t.setText(translate("stamp",true)+" e imprimir")}var k=f.down("[afterSave=addPayment]");if(k){k.setText(translate("stamp",true)+" y agregar pago")}var q=f.down("[afterSave=sendByEmail]");if(q){q.setText(translate("stamp",true)+" y enviar por correo")}var h=b.down("switch[name=documentTypeSwitch]");var e="invoice";if(h){e=h.getOptionSelected().value}if(b.configs.country==="mexico"&&!b.configs.isActiveElectronicInvoicing&&!b.configs.hasAnyInvoice&&e!="saleTicket"){var g=Ext.ComponentQuery.query("buttons_SaveInvoice [action=save]")[5];var s=d.down("button[afterSave=createInvoice]");var o=d.down("button[afterSave=addPayment]");c.action="configCompany";g.action="configCompany";s.action="configCompany";o.action="configCompany";c.on("click",function(x){if(b.configs.isActiveElectronicInvoicing){c.action="save";w.saveInvoice(c);return}Ext.create("Ext.window.MessageBox",{setButtonPrimaryStyle:function(){var y=this.query("button[itemId=no]")[0];if(y){y.addCls("sm-button-primary")}return this}}).show({title:"Configurar la información de tu empresa",msg:"Debes configurar tu CSD, llave y contraseña para poder timbrar. Si omites esta información "+translate("theInvoice")+" "+translate("invoice")+" se guardará como borrador.",icon:Ext.Msg.QUESTION,width:500,buttons:Ext.MessageBox.YESNO,buttonText:{no:"Configurar",yes:"Omitir"},buttonAlign:"center",fn:function(y){if(y=="no"){w.showCompanyEditWindow(b,true,c)}else{c.action="save";w.saveInvoice(c)}}}).setButtonPrimaryStyle();return});g.on("click",function(x){if(b.configs.isActiveElectronicInvoicing){g.action="save";w.saveInvoice(g);return}Ext.Msg.show({title:"Configurar la información de tu empresa",msg:"Debes configurar tu CSD, llave y contraseña para poder timbrar. Si omites esta información "+translate("theInvoice")+" "+translate("invoice")+" se guardará como borrador.",icon:Ext.Msg.QUESTION,width:500,buttons:Ext.MessageBox.YESNO,buttonText:{no:"Configurar",yes:"Omitir"},buttonAlign:"center",fn:function(y){if(y=="no"){w.showCompanyEditWindow(b,true,c)}else{c.action="save";w.saveInvoice(c)}}}).setButtonPrimaryStyle();return});s.on("click",function(x){if(b.configs.isActiveElectronicInvoicing){s.action="save";w.saveInvoice(s);return}Ext.Msg.show({title:"Configurar la información de tu empresa",msg:"Debes configurar tu CSD, llave y contraseña para poder timbrar. Si omites esta información "+translate("theInvoice")+" "+translate("invoice")+" se guardará como borrador.",icon:Ext.Msg.QUESTION,width:500,buttons:Ext.MessageBox.YESNO,buttonText:{no:"Configurar",yes:"Omitir"},buttonAlign:"center",fn:function(y){if(y=="no"){w.showCompanyEditWindow(b,true,c)}else{c.action="save";w.saveInvoice(c)}}}).setButtonPrimaryStyle();return});o.on("click",function(x){if(b.configs.isActiveElectronicInvoicing){o.action="save";w.saveInvoice(o);return}Ext.Msg.show({title:"Configurar la información de tu empresa",msg:"Debes configurar tu CSD, llave y contraseña para poder timbrar. Si omites esta información "+translate("theInvoice")+" "+translate("invoice")+" se guardará como borrador.",icon:Ext.Msg.QUESTION,width:500,buttons:Ext.MessageBox.YESNO,buttonText:{no:"Configurar",yes:"Omitir"},buttonAlign:"center",fn:function(y){if(y=="no"){w.showCompanyEditWindow(b,true,c)}else{c.action="save";w.saveInvoice(c)}}}).setButtonPrimaryStyle();return})}}if(b.configs.replace){var n=d.down("button[afterSave=preview]");var j=d.down("button[afterSave=addPayment]");var s=d.down("button[afterSave=createInvoice]");var r=d.down("splitbutton[action=save]");var m=d.down("button[name=stampReplace]");r.setVisible(false);n.setVisible(false);j.setVisible(false);s.setVisible(false);m.setVisible(true);if(b.configs.country=="mexico"){var u=Ext.ComponentQuery.query("combo[name=paymentType]")[0];var l=Ext.ComponentQuery.query("combo[name=paymentMethod]")[0];if(u){u.store.filter("value","PPD");u.disable();if(l){l.tooltip="En sustituciones se conserva la forma de pago original.";l.disable()}}}}},render:function(c){var b=c.query("button[action=save]");Ext.each(b,function(d){d.on({click:this.saveInvoice,scope:this})},this)},afterrender:function(b){var c=b.down("menu[action=saveInvoice]");if((b.country=="mexico"&&b.mxStampInvoces=="yes")||b.isActiveElectronicInvoicing){c.isActiveElectronicInvoicing=true;c.add({text:"Guardar sin "+translate("stamp"),action:"save",status:"open",afterSave:"noStampInvoice"})}if(b.country=="panama"&&b.paHasFiscalPrinter=="Yes"){c.add({text:"Guardar y obtener comprobante fiscal",action:"save",status:"open",afterSave:"paFiscalPrint"})}}},"buttons_SaveInvoice button[name=stampReplace]":{click:function(b){var c=b.up("form");Ext.Msg.show({title:"Sustitución de "+translate("invoice"),msg:"¿Estás seguro que deseas sustituir la "+translate("invoice")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(e){if(e==="yes"){var d=document.getElementById("invoiceSaveInvoiceButton");d.click()}}})}},"buttons_SubmitReset button[action=editInvoice]":{click:this.editInvoice},"remission_RemissionForInvoice button[action=deleteRemission]":{click:function(b){var c=b.up("remission_RemissionForInvoice");if(c){c.destroy();this.updateTotal()}}},invoice_FormAddInvoice:{render:this.initialize,beforerender:function(g){g.executeActionsBeforeRender();var f=g.configs.linkNumeration;if(g.configs){if(g.configs.companyLogoUrl){var b=g.down("box[name=logoBox]");var h=new Image;h.onload=function(m){var l=(h.width*Math.min(b.configs.maxHeight,h.height))/h.height;var k="";if(l<b.configs.maxWidth){k="width: auto; max-height: "+b.configs.maxHeight+"px;"}else{k="height: auto; max-width: "+b.configs.maxWidth+"px;"}b.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+g.configs.companyLogoUrl+'" style="margin: 0 auto; '+k+'" /></div>')};h.src=g.configs.companyLogoUrl}if(g.configs.companyName){g.down("label[name=companyName]").setText(g.configs.companyName)}if(g.configs.companyIdentification){var e=translate("identification",true);if(g.configs.companyIdentificationType){e=g.configs.companyIdentificationType}g.down("label[name=companyIdentification]").setText(e+": "+g.configs.companyIdentification)}if(g.configs.companyEmail){g.down("label[name=companyEmail]").setText(g.configs.companyEmail)}if(g.configs.country==="costaRica"&&g.configs.company&&g.configs.company["economicActivity"]){var j=g.down("combo[name=economicActivity]");if(j){var d=j.getStore();if(d.hasLoaded()){j.setValue(g.configs.company["economicActivity"])}else{d.on("storeloaded",function(){j.setValue(g.configs.company["economicActivity"])});d.on("load",function(k){d.fireEvent("storeloaded");d.suspendEvent("storeloaded")})}}}if(g.configs.country==="chile"){if(g.configs.company.economicActivity!==null){var j=g.down("combo[name=economicActivity]");j.setValue(g.configs.company.economicActivity)}}if(g.configs.country==="colombia"){var c=g.down("combo[name=paymentTypeCol]");if(!(g.configs.isActiveElectronicInvoicing&&g.configs.electronicInvoicingVersion=="2.1")){c.allowBlank=true}c.hide()}}},afterrender:function(e){var c=e.down("combo[name=currency]");var d=e.down("displayfield[name=exchangeCurrencyDisplay]");var b=e.down("combo[name=idClient]");if(e.configs.notEditableCurrency){c.getSubmitData=this.getSubmitDataDisabled;c.disable()}else{}if(e.configs.notEditableExchangeRate){d.getSubmitData=this.getSubmitDataDisabled;d.disable()}else{}if(e.configs.notEditableClient){var f=Ext.get("createOtherContact");f.destroy();b.getSubmitData=this.getSubmitDataDisabled;b.disable();b.tooltip.setVisibleIconHelp(true)}if(e.configs&&e.configs.country==="peru"&&e.configs.companyRegime==="NEW_RUS"){e.down("[name=documentTypeSwitch]").hide()}},afterlayout:function(r,q,o,m,l,k){var p=this;var g=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var j=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var n=Ext.get("editInvoiceInfo");if(n){var h=j.smGetSelectedRecord().data;n.removeAllListeners();n.on("click",function(b){b.preventDefault();p.application.fireEvent("editInvoiceNumberWindow",{idLocal:h.idLocal,country:g.configs?g.configs.country:null,isActiveElectronicInvoicing:g.configs?g.configs.isActiveElectronicInvoicing:null})})}}},invoice_FormAdvancedOptions:{afterrender:function(c){var e=c.down("combo[name=idSeller]");var b=e.getStore();var d=Ext.create("AL.model.Seller",{name:translate("anySeller",true),idLocal:0});if(b.hasLoaded()){b.add(d)}else{b.load({callback:function(){b.add(d)}})}}},invoice_FormAddRemissions:{afterrender:function(e){var k=this;var o=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var f=Ext.ComponentQuery.query("combo[name=currency]")[0];var m=f.getSelectedRecord();var c="";if(m&&m.get("code")){c=m.get("code")}var l=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var h=l.getSelectedRecord();var d="";if(h&&h.get("idLocal")){d=h.get("idLocal")}var g=o.down("combo[name=idWarehouse]");var n=g.getStore();var q=o.down("combo[name=idClient]");e.show();if(n.isLoading()){n.on("load",function(){var s=g.getSelectedRecord();var r="";if(s&&s.get("idLocal")){r=s.get("idLocal")}else{s=n.findRecord("isMain","yes");r=s.get("idLocal")}})}else{var b=g.getSelectedRecord();var j="";if(b&&b.get("idLocal")){j=b.get("idLocal")}else{b=n.findRecord("isMain","yes");j=b.get("idLocal")}}var p=Ext.get("addRemissionLink");if(p){p.removeAllListeners();p.on("click",function(r){r.preventDefault();k.application.fireEvent("addRemission",this)})}}},"invoice_FormAddRemissions combo[name=idRemission]":{change:function(e,d,c){if(c&&d!=c&&d){var b=Ext.ComponentQuery.query("invoice_FormAddItem[queryName=remission_"+c+"]");Ext.each(b,function(f){f.destroy()})}},select:function(g){var f=this,h=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0],e=g.getValue(),c=g.up("container"),d=this.validateDifferentRemissions(g,true);GlobalLoadMask.show(c);if(d){var b=g.getSelectedRecord(),j=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(j){this.loadSellerStore(j,b.get("idSeller"))}this.validateDatesServicesRemission(b.data,"yes");Ext.Ajax.request({url:"/remission/retrieve-items/format/json/id/"+e,method:"POST",success:function(q){var m=q.responseText,o=Ext.decode(m);if(o.success){var r=o.results,u=r.length,p=1,s=c.down("container[name=tableHeader]");if(!s){c.add({xtype:"container",name:"tableHeader",html:'<div id="headersTable" class="remission"><table><tr><td class="tbName">'+translate("item",true)+'</td><td class="tbReference">'+translate("reference",true)+'</td><td class="tbPrice">Precio</td><td class="tbDiscount">'+translate("discountAbbreviature",true)+' %</td><td class="tbTax">Impuesto</td><td class="tbDescription">Descripción</td><td class="tbQuantity">Cantidad</td><td class="tbTotal">Total</td></tr></table></div>',style:"background: #eee; margin-top:12px; background:#F9FAFD;color:#00535E;padding-top:10px;font-weight:bold;border-bottom:2px solid rgba(0, 83, 94, 0.5); height:48px;     border-top: 2px solid white;",queryName:"remission_"+e})}var l=h.configs.canCreateNewTax,k=h.configs.canCreateNewWarehouse,t=h.configs.canCreateNewItem,n=h.configs.multipleTaxes;h.callUpdateTotal=u<=1;Ext.each(r,function(w){var x=Ext.create("AL.view.invoice.FormAddItem",{itemSold:w,type:"remission",queryName:"remission_"+e,disabledDeleteButton:true,canCreateNewTax:l,canCreateNewWarehouse:k,canCreateNewItem:t,multipleTaxes:n});var y=x.down("hidden[name=idRemission]");y.setValue(e);var v=x.down("combo[name=idTax]");c.add(x);if(p==u){v.on("taxComboRendered",function(){f.changeIdPriceList=true;h.callUpdateTotal=true;f.updateTotal();GlobalLoadMask.hide(c)});f.changeIdPriceList=true;h.callUpdateTotal=true;f.updateTotal();GlobalLoadMask.hide(c)}p++})}else{GlobalLoadMask.hide(c);GlobalMsg.showErrorMessage("Error",o.cause)}},failure:function(){GlobalLoadMask.hide(c)}})}else{GlobalLoadMask.hide(c)}}},"invoice_GridAll gridcolumn[type=invoiceActions]":{click:function(c,m,r,q,t,d){var k=this.application;var s=Ext.get(t.target);var b=c.up("grid").getSelectionModel().getSelection()[0];var v=this;if(s.hasCls("convertInvoiceToOpen")){t.preventDefault();v.convertInvoiceToOpen(b,function(){c.getStore().load()})}else{if(s.hasCls("addInvoicePayment")){if(b.get("status")==="draft"){t.preventDefault();v.convertInvoiceToOpen(b,function(e){window.location="/transaction/in/number/"+e},"yes")}}else{if(s.hasCls("printInvoice")){t.preventDefault();var u=b.get("idLocal");var p=b.get("status");var o=c.up("grid").canPrint;var h=c.getStore();var f=function(){if(p==="draft"&&o==="yes"){h.load();Ext.create("AL.view.invoice.WindowPrint",{idLocal:u})}else{if(p==="draft"){h.load()}if(o==="yes"){l()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",title:"Completa la siguiente información para continuar",infoTitle:"¡Para imprimir debes ingresar los siguientes datos de tu empresa!",url:"/invoice/print/id/"+u,idLocal:u,callback:l,resourceTrigger:"invoice"})}}};var l=function(){var j=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(j){j.destroy();c.up("grid").canPrint="yes";window.location="/invoice/print/id/"+u}else{var e=window.open("/invoice/print/id/"+u);e.print()}};if(p==="draft"){v.convertInvoiceToOpen(b,f,"yes")}else{f()}}else{if(s.hasCls("deleteInvoice")){t.preventDefault();if(b.get("deletable")){k.fireEvent("deleteInvoice",{record:b,initiator:c})}else{var g=translate("youCanOnlyRemove",true)+" "+translate("invoices")+" "+translate("inDraftState");var c=c.up("grid");if(v.getCountriesWithStamp().indexOf(c.country)!==-1&&c.isActiveElectronicInvoicing){g+=" "+translate("thatAreNotInTheProcessOfCertification")+"."}GlobalMsg.showNotification({title:translate("remember",true),text:g,type:"notice"})}}else{if(s.hasCls("voidInvoice")){t.preventDefault();if(b.get("voidable")&&!b.get("hasCreditNotes")){k.fireEvent("voidInvoice",{record:b,initiator:c.up("grid"),refreshVoidCauses:true})}else{var n=translate("youCanOnly",true)+" "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+", "+translate("thatDoNotHave")+" "+translate("creditNotes")+" "+translate("appliedCreditNotes")+" "+translate("orAssociatedUnpaidClosures")+".";switch(c.up("grid").country){case"mexico":n=translate("youCanOnly",true)+" "+translate("cancel")+" "+translate("invoices")+" "+translate("openInvoices")+" que hayas timbrado en Alegra, sin "+translate("creditNotes")+" y complementos de pago asociados.";if(b.get("status")==="void"&&b.get("mx_waitingToVoid")!==true){n=translate("theInvoice",true)+" "+translate("invoice")+" ya fue cancelada y no es necesario cancelarla de nuevo."}else{if(b.get("mx_waitingToVoid")===true){n=translate("theInvoice",true)+" "+translate("invoice")+" está en proceso de cancelación, se ha enviado la solicitud de cancelación al cliente. Recibirás un correo con su respuesta en máximo 72 horas."}}break;case"peru":n+="Para "+translate("cancel")+" "+translate("invoices")+" "+translate("stampedInvoices")+", emite una "+translate("creditNote");break}GlobalMsg.showNotification({title:translate("remember",true),text:n,type:"notice"})}}}}}}}},"invoice_GridAllGlobalInvoices gridcolumn[type=invoiceActions]":{click:function(b,d,k,h,l,m){var o=this.application;var g=Ext.get(l.target);var f=b.up("grid").getSelectionModel().getSelection()[0];var n=this;if(g.hasCls("deleteGlobalInvoice")){l.preventDefault();if(f.get("deletable")){o.fireEvent("deleteGlobalInvoice",{record:f,initiator:b})}else{var c=translate("youCanOnlyRemove",true)+" "+translate("globalInvoices")+" "+translate("inDraftState");var b=b.up("grid");GlobalMsg.showNotification({title:translate("remember",true),text:c,type:"notice"})}}if(g.hasCls("voidGlobalInvoice")){l.preventDefault();if(f.get("voidable")){o.fireEvent("voidGlobalInvoice",{record:f,initiator:b})}else{GlobalMsg.showNotification({title:translate("remember",true),text:translate("youCanOnly",true)+" "+translate("cancel")+" "+translate("globalInvoices")+" que han sido timbradas.",type:"notice"})}}if(g.hasCls("openGlobalInvoice")){l.preventDefault();if(f.get("status")=="draft"){o.fireEvent("openGlobalInvoice",{record:f,initiator:b})}}if(g.hasCls("printInvoice")&&g.hasCls("disabled")){l.preventDefault();Ext.Msg.show({title:"Imprimir",msg:"No puedes imprimir "+translate("globalInvoices")+" "+translate("inDraftState")+".<br>Para imprimirla primero debes timbrarla.<br>",buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION})}}},"window[reason=confirmInvoiceEmail] form checkbox[name=statementAttached]":{change:function(b,d){var c=b.up("form");var e=c.down("htmleditor[name=emailMessage]");if(!e){return console.warn("htmleditor not find")}var g=e.getValue();var f="{{AccesoEstadoCuenta}}";if(d&&g.indexOf(f)===-1){e.setValue(g.concat("<p>"+f+"</p>"))}else{e.setValue(g.replace(f,""))}}},"window[reason=confirmInvoiceEmail] form button[action=confirmEmail]":{click:function(k){var d=k.up("form");var n=d.up("window");var j=Ext.ComponentQuery.query("window[reason=confirmInvoiceEmail] checkbox[name=email]");var l=d.down("textfield[name=email]");var f=d.down("checkbox[name=sendCopyToUser]");var s=d.down("checkbox[name=statementAttached]");var q=[];var r;if(j){Ext.each(j,function(w){if(w.getValue()){var t=w.record;var u="";if(t.name){u=t.name;if(t.lastName){u=u+" "+t.lastName}}var v={name:u,email:t.email};q.push(v)}})}if(l.getValue()&&l.getValue()!==""){r={name:"",email:l.getValue()};q.push(r)}var g=d.down("htmleditor[name=emailMessage]"),c=d.down("textfield[name=emailSubject]"),e={subject:c.getValue(),message:g.getValue()};var h=[],p,b;Ext.each(q,function(t){h.push(t.email)});h=h.join(",");p=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0];b=h.split(/[;,]/).length;if(b>p.maxEmailsToSend){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("theInvoice")+" "+translate("invoice"),quantity:p.maxEmailsToSend}));return}var o={id:n.idLocal,emails:Ext.encode(q),sendCopyToUser:f.getValue(),emailTemplate:Ext.encode(e),attachClientStatement:s?s.getValue():false};var m="/invoice/email/format/json";if(n.type){m+="/type/"+n.type}Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:m,method:"POST",params:o,showSpinner:true,timeout:120000,success:function(t,u){var v=Ext.decode(t.responseText);if(v.success){n.close()}else{Ext.Msg.alert("Error",v.cause)}},failure:function(){}})}},"invoice_FormAddInvoice box[name=logoBox]":{render:function(c){var d=document.querySelector(".logo");var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var b=false;if(e&&e.configs&&e.configs.company&&e.configs.company.designMoreVisibility!=false){b=true}if(b==true){d=document.querySelector(".image-logo-profile")}this.promptFileUploadWindowOnClick(c,"logoUrl",false,{asyncUpload:true,title:translate("changeLogo",true),url:"/company/set-logo/format/json",fieldName:"logo",fieldLabel:translate("logo",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingLogo",true)},function(f){if(b!=true){d.innerHTML='<a href="/"><img src="'+f+'" />';"</a>"}else{if(d){d.src=f}}})}},"invoice_FormAddInvoice [name=prefix]":{change:function(d,e,b,c){d.setWidth(this.calculateManualResolutionFieldWidth("prefix",12,e))}},"invoice_FormAddInvoice [name=number]":{change:function(d,e,b,c){d.setWidth(this.calculateManualResolutionFieldWidth("number",12,e))}},"invoice_FormAddInvoice label[name=companyEdit]":{beforerender:function(b){var c=b.up("form");if(!c.configs.canEditCompany){b.hidden=true}},afterrender:function(b){var c=this;b.getEl().on("click",function(){var d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];d.configs.isActiveElectronicInvoicing=true;c.showCompanyEditWindow(d,false)},b)},},"invoice_BottomContainer label[name=resolutionTextEdit]":{afterrender:function(b){var d=this;var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(c.configs.country==="peru"||c.configs.country==="costaRica"){b.hide()}else{b.getEl().on("click",function(){var g=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var f=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var e=f.smGetSelectedRecord().data;d.application.fireEvent("editInvoiceNumberWindow",{idLocal:e.idLocal,country:g.configs?g.configs.country:null,isActiveElectronicInvoicing:g.configs?g.configs.isActiveElectronicInvoicing:null})},b)}},},"invoice_BottomContainer label[name=resolutionEmptyTextEdit]":{afterrender:function(b){var d=this;var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(c.configs.country==="peru"||c.configs.country==="costaRica"){b.hide()}else{b.getEl().on("click",function(){var g=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var f=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var e=f.smGetSelectedRecord().data;d.application.fireEvent("editInvoiceNumberWindow",{idLocal:e.idLocal,country:g.configs?g.configs.country:null,isActiveElectronicInvoicing:g.configs?g.configs.isActiveElectronicInvoicing:null})},b)}},},"invoice_FormAddInvoice combo[name=idClient]":{render:function(d){var c=this;var b=d.up("form");if(b.idClient){Ext.Ajax.request({url:"/client/retrieve-one/id/"+b.idClient+"/format/json",success:function(f,h){var j=Ext.decode(f.responseText);if(j.success){var g=j.results;var e=Ext.create("AL.model.Client",g);d.getStore().add(e);d.select(e);c.getContact(d,[e])}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}},select:this.getContact,change:function(f){var c=f.up("form");var h=f.getSelectedRecord();if(!h){return}var g=h.getData();if(c.configs){switch(c.configs.country){case"costaRica":var e=g&&g.metadata&&g.metadata.exemptionDocument;var l=Ext.ComponentQuery.query("invoice_FormAddItem")[0];var b=l.down("combo[name=idTax]");var m=b.getStore();if(e){m.getProxy().extraParams={taxReference:"Exento",displayNone:false};m.load()}else{m.getProxy().extraParams=null;m.load()}break;case"chile":var j=c.down("switch[name=documentTypeSwitch]"),d="invoice";if(j){d=j.getOptionSelected().value}if(d=="saleTicket"&&f.getSelectedRecord().get("identification")&&f.getSelectedRecord().get("identification")==0){var k=f.findRecord("identification","66666666-6");f.setValue(k.get("idLocal"));GlobalMsg.showErrorMessage("Error",translate("clientWithIdDifferentFromZero",true))}break}if(this._sourcePaymentMethod!="disabled"){this._sourcePaymentMethod="user";this.selectPaymentMethodAndType(f);this._sourcePaymentMethod="none"}}}},"invoice_FormAddInvoice combo[name=cfdiUse]":{beforerender:function(d){var c=this;var b=d.up("form");if(b.configs.country=="mexico"&&b.configs.stampVersion=="3.3"){d.hidden=false;d.allowBlank=false}},},"invoice_FormAddInvoice combo[name=paymentMethod]":{beforerender:function(c){var b=c.up("form");if(b.configs&&b.configs.country==="mexico"){c.store.filter("type","pue")}},change:function(b){if(this._sourcePaymentMethod!="user"){this._sourcePaymentMethod="disabled"}}},"invoice_FormAddInvoice textfield[name=accountNumber]":{beforerender:function(c){var b=c.up("form");if(b.configs.country=="mexico"&&b.configs.replace){c.tooltip="En sustituciones se conserva la forma de pago original."}},},"invoice_FormAddInvoice combo[name=idCostCenter]":{beforerender:function(d){var c=d.up("form");if(!c.configs.costCenter.isActive){return}var b=d.getStore();if(!b.hasLoaded()&&!b.isLoading()){b.load()}},select:function(e){var d=e.up("form");if(e.getValue()!==null){var c=e.getStore();var b=c.findRecord("idLocal",e.getValue());if(!b){this.loadCostCenterRecord(e.getValue(),e)}else{e.select(b)}}}},"invoice_FormAddInvoice combo[name=paymentType]":{beforerender:function(d){var c=this;var b=d.up("form");if(b.configs.country=="mexico"&&b.configs.stampVersion=="3.3"){d.hidden=false;d.allowBlank=false;d.forceSelection=true;if(b.configs.replace){d.tooltip="En sustituciones se conserva el método de pago original."}}},change:function(g){if(this._sourcePaymentMethod!="user"){this._sourcePaymentMethod="disabled"}var f=g.up("form");if(f.configs.country=="mexico"&&f.configs.stampVersion=="3.3"){var e=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(e){if(g.getValue()=="PPD"){e.hideButtonForAdvances()}else{e.showButtonForAdvances()}}var b=f.down("combo[name=paymentMethod]");if(b){if(g.getValue()=="PPD"){b.store.clearFilter();b.store.filter("type","ppd");b.setValue("other");b.matchFieldWidth=true}else{b.store.clearFilter();b.store.filter("type","pue");var c=f.down("combo[name=idClient]").getSelectedRecord();if(!c){b.setValue("cash")}else{var d=c.getData();if((b.getValue()==null||b.getValue()=="")&&d.metadata.paymentMethod){b.setValue(d.metadata.paymentMethod.toLowerCase())}else{if(d.metadata.paymentMethod){b.setValue(d.metadata.paymentMethod.toLowerCase())}else{b.setValue("cash")}}}b.matchFieldWidth=false}}}},},"invoice_FormAddInvoice combo[name=paymentMethodCol]":{beforerender:function(c){var b=c.up("form");if(b.configs.country=="colombia"&&b.configs.isActiveElectronicInvoicing&&b.configs.electronicInvoicingVersion=="2.1"){c.allowBlank=false;c.enable();c.show()}else{c.allowBlank=true;c.select(null);c.disable();c.hide()}},change:function(f,d,b,g){var e=f.up("form");if(e.configs.country=="colombia"&&e.configs.isActiveElectronicInvoicing&&e.configs.electronicInvoicingVersion=="2.1"){var h=e.down("combo[id=invoiceTermCombo]");var l=e.down("datefield[name=dueDate]");var k=e.down("combo[name=paymentTypeCol]");switch(d){case"CASH":h.disable();h.hide();l.setRawValue(Ext.Date.format(e.down("datefield[name=date]").getValue(),"d/m/Y"));l.disable();l.hide();k.allowBlank=false;k.enable();k.show();break;case"CREDIT":l.enable();l.show();k.allowBlank=true;k.select(null);k.disable();k.hide();var j=h.getStore();var c=function(){if(h.getSelectedRecord().get("idLocal")==1){var m=j.findRecord("idLocal",1);if(m){j.remove(m);h.reset()}m=j.findRecord("idLocal",0);h.select(m)}h.enable();h.show()};if(j.hasLoaded()){c()}else{j.on("load",{callback:function(){c()}})}break}}}},"[name=resolutionDropdown]":{afterrender:function(h){var g=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var e=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];e.smAlignWithTarget();if(g.type!=="edit"&&!g.idInvoice){var d=e.smGetStore();if(g.configs&&g.configs.country==="peru"){var b=g.down("switch[name=documentTypeSwitch]");if(b){var f=d.getProxy();var j=b.getOptionSelected();if(f.extraParams){f.extraParams.documentType=j.value}else{f.extraParams={documentType:j.value}}}}if(!d.hasLoaded()){d.on("load",function(l){var k=d.findRecord("isDefault","yes");if(!k){k=l.getAt(0)}if(k){e.smSetValue(k.data.idLocal)}if(d.count()>1){h.show()}})}else{var c=d.findRecord("isDefault","yes");if(!c){c=data.getAt(0)}if(c){e.smSetValue(c.data.idLocal)}if(d.count()>1){h.show()}}}h.getEl().on("click",function(k,l){if(h.smIsEnable){e.smShow()}})}},"invoice_FormAddInvoice datefield[name=date]":{change:this.changeDueDateFromDate},"invoice_FormAddInvoice datefield[name=dueDate]":{change:this.changeTerms},invoice_GridAll:{itemdblclick:this.goInvoiceDetails,render:this.setRightClickEvent,selectedRecordsChanged:function(f,h){var g=h.getSelectedRecords().length;if(g>=2){var d=false;for(var e=0;e<g;e++){var c=h.getSelectedRecords()[e];if(!c.get("canPrintOrDownload")){d=true}}if(d){var b=h.getOperationsButton(true);Ext.each(b,function(j){j.setDisabled(true);if(j.operationName==="Imprimir"){j.notAllowedText="Al menos una de "+translate("theInvoices")+" "+translate("invoices")+" que intentas imprimir supera el máximo de "+translate("items")+" permitidos para su impresión."}else{j.notAllowedText="Al menos una de "+translate("theInvoices")+" "+translate("invoices")+" que intentas descargar supera el máximo de "+translate("items")+" permitidos para su descarga."}})}document.getElementById("tooltip-many-selections").style.display="inline-block"}else{document.getElementById("tooltip-many-selections").style.display="none"}}},invoice_GridOverdue:{itemdblclick:this.goInvoiceDetails,render:this.setRightClickEvent},invoice_TotalLeftContainer:{afterrender:function(d){if(d.configs){var c=d.down("box[name=signatureBox]");if(d.configs.userSignatureUrl){var b=new Image;b.onload=function(h){var g=(b.width*Math.min(c.configs.maxHeight,b.height))/b.height;var f="";if(g<c.configs.maxWidth){f="width: auto; max-height: "+c.configs.maxHeight+"px;"}else{f="height: auto; max-width: "+c.configs.maxWidth+"px;"}c.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+d.configs.userSignatureUrl+'" style="margin: 0 auto; '+f+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+c.configs.madeByText+"</div></div>")};b.src=d.configs.userSignatureUrl}else{if(d.configs.disableSignatureEditing){c.update()}}}}},"invoice_TotalLeftContainer box[name=signatureBox]":{render:function(c){var b=c.up("totalleftcontainer");if(!b.configs.disableSignatureEditing){this.promptFileUploadWindowOnClick(c,"signatureUrl",true,{asyncUpload:true,title:translate("changeSignature",true),url:"/company/set-signature/format/json",fieldName:"signature",fieldLabel:translate("signature",true),buttonText:translate("selectSimple",true),helpText:translate("inOrderToHaveAGoodLookingSignature",true)})}}},invoice_BottomContainer:{afterrender:function(b){if(b.configs.requiredText){b.down("[name=requiredText]").update(b.configs.requiredText)}}},"buttons_SaveInvoice menu[action=saveInvoice]":{click:function(c,b){this.saveInvoice(b)}},"buttons_EditInvoice menu[action=editInvoice]":{click:function(c,b){this.editInvoice(b)}},"invoice_FormAddInvoice combo[name=days]":{change:function(b){this.changeDueDateFromDays(b.getSelectedRecord())}},"invoice_FormAddInvoice combo[name=idSeller]":{afterrender:function(c){var b=c.getStore();b.on("load",function(){var d=Ext.get("createSeller");if(d){d.on("click",function(){window.location="/seller/add"})}})}},"invoice_FormAddItem combo[name=idLocal]":{beforerender:function(c){var b=c.up("form");if(b.canCreateNewItem){c.listConfig.tpl='<tpl for="."><div class="x-boundlist-item">{name} <tpl if="productKey && reference"> - ('+translate("productKeyShort")+' {productKey} - Ref. {reference})<tpl elseif="productKey && !reference"> - ('+translate("productKeyShort")+' {productKey})<tpl elseif="reference && !productKey"> - ({reference})</tpl></div></tpl><div><a href="#" data-action="quickNewItem" class="createNewItem">'+translate("newItem",true)+"</a></div>"}},render:function(f){var c=f.up("form");var b=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var d=Ext.create("AL.store.ItemsCombo");var e=function(h){var h=h?h:null;var l=null;var g=b.down("combo[name=idWarehouse]");var j=d.getProxy();if(h){if(h.isInventariable=="yes"){g.setValue(h.warehouses[0].idWarehouse)}else{if(h.type=="kit"){g.setValue(h.warehouse.idLocal)}}}if(g.getValue()){if(typeof g.getValue()=="string"){l=g.getValue()}else{l=g.getValue().get("idLocal")}j.extraParams={idWarehouse:l}}else{var k=g.getStore();k.on("load",function(){var m=k.findRecord("isMain","yes");l=m.get("idLocal");j.extraParams={idWarehouse:l}})}return l};f.store=d;this.changeStoreItemsToSaleConcept(c);if(c.idItem){Ext.Ajax.request({url:"/item/retrieve-one/id/"+c.idItem+"/format/json",success:function(h,k){var l=Ext.decode(h.responseText);if(l.success){var j=l.results;var m=false;warehouseValue=e(j);if(j.isInventariable=="yes"&&j.warehouses){Ext.each(j.warehouses,function(n){if(n.idWarehouse==warehouseValue){m=true;return}})}else{if(j.type=="kit"&&j.warehouse){if(j.warehouse&&j.warehouse.idLocal==warehouseValue){m=true}}else{m=true}}if(m){var g=Ext.create("AL.model.Item",j);f.getStore().add(g);f.select(g);f.fireEvent("select2",{combo:f,record:g})}else{GlobalMsg.showNotification({title:"Advertencia",text:"El "+translate("item")+" no se pudo cargar ya que éste no se encuentra asociado a "+translate("theWarehouse")+" "+translate("warehouse")+" seleccionada",type:"warning"})}}else{Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}},failure:function(){Ext.MessageBox.alert("Error","Ha ocurrido un error al cargar el ítem")}})}else{if(b.configs.showWarehouses){e()}}},select:function(c,b){this.getItem(c,b);this.checkQuantity(c)},select2:function(c){var d=c.combo;var b=c.record;this.getItem(d,[b]);this.checkQuantity(d)}},"invoice_FormAddItem button[action=deleteItem]":{click:function(b){b.up("form").destroy();this.updateTotal()}},"invoice_FormAddItem textfield[name=price]":{change:this.updateItemTotal},"invoice_FormAddItem textfield[name=discount]":{change:this.updateItemTotal},"invoice_FormAddItem combo[name=idTax]":{render:function(g){var f=g.up("form");var b=g.getStore();var d=b.getProxy();d.extraParams={forCombo:"yes"};if(f.type==="edit"||f.type=="remission"){var e=f.itemSold;var c=function(){g.suspendEvents();var h=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var k=function(m){var l=g.findRecordByValue(m.id);if(!l){var l=Ext.create("AL.model.Tax",{idLocal:m.id,tax:m.tax,name:m.name,status:m.status});b.add(l)}g.select(l)};var j=[];Ext.each(e.taxes,function(l){if(l.status==="inactive"){if(h.type==="edit"||h.type==="remission"){k(l);j.push(l.id)}else{g.select(0)}}else{j.push(l.id)}});if(j&&j.length>0){g.setValue(j)}else{g.select(0)}g.resumeEvents();g.fireEvent("taxComboRendered")};if(b.hasLoaded()){c()}else{b.on("load",function(){c()})}}if(!b.hasLoaded()&&!b.isLoading()){if(f.type&&(f.type==="edit"||f.type=="remission")){b.load({callback:function(){c()}})}else{b.load()}}},change:this.updateTotal,beforeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0||(d.getValue()&&d.getValue()[0]===0)){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",true)}});d.setValue("[0]")}return b.get("disabled")?false:true}},beforedeselect:function(d,b,c){if(d.multiSelect==true){if(b.get("idLocal")===0){d.getStore().each(function(e){if(e.get("idLocal")!==0){e.set("disabled",false)}})}}}},invoice_FormAddItem:{afterrender:function(c){var l=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(l.configs.changeItemsPrices==="no"){var m=c.down("textfield[name=price]");m.setReadOnly(true);m.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}var h=false;if(l.configs){var h=l.configs.country=="costaRica"}if(l.configs.changeDiscount==="no"){var j=c.down("textfield[name=discount]");j.setReadOnly(true);j.setFieldStyle("background:#EEEEEE; border: 1px solid #CCCCCC;")}else{if(h){var j=c.down("textfield[name=discount]");var k=function(){var r=Ext.ComponentQuery.query("window[name=modalDiscount]")[0];if(!r){Ext.create("AL.view.item.FormEditDiscount",{configs:{discountField:j,valueDiscountMax:l.configs.valueDiscountMax,isActiveElectronicInvoicing:l.configs.isActiveElectronicInvoicing,country:l.configs.country}})}};j.getEl().on("click",k);j.getEl().on("focusin",k)}}if(c.type==="edit"||c.type=="remission"){var d=c.itemSold;var e=c.down("combo[name=idLocal]");var o=c.down("textfield[name=reference]");var m=c.down("textfield[name=price]");var p=c.down("textfield[name=discount]");var b=c.down("textarea[name=description]");var f=c.down("numberfield[name=quantity]");var n=e.getStore();var g=Ext.create("AL.model.Item",d);n.on("load",function(){var s=n.findRecord("idLocal",d.idLocal);if(!s&&l.configs.country==="argentina"){var r=l.down("combo[name=saleConcept]");if(r&&r.getValue()){var t=true;switch(value){case"SERVICES":t=d&&d.unit==="service"?true:false;break;case"PRODUCTS":t=d&&d.unit!=="service"?true:false;break}if(t){s=Ext.create("AL.model.Item",d);n.add(s)}}}if(s){e.suspendEvents();e.select(s);e.resumeEvents();e.up("form").enableFields()}});n.add(g);e.select(g);m.suspendEvents();p.suspendEvents();f.suspendEvents();f.setValue(c.itemSold.quantity);m.setValue(d.priceSecondaryCurrency);o.setValue(d.reference);p.setValue(c.itemSold.discount);if(h){p.discount={discount:d.discount,discountNature:d.discountNature}}if(d.metadata){if(!c.configs){c.configs=l.configs}c.configs.country=l.configs.country;c.setFieldValuesFromMetadata(d.metadata)}b.setValue(d.description);m.resumeEvents();p.resumeEvents();f.resumeEvents();this.updateItemTotal(m,"no");if(c.type=="remission"){var q=c.down("displayfield[name=mxXmlItemName]");q.setValue(c.itemSold.name);e.hide();f.maxValue=c.itemSold.maxQuantityToBeBilled;f.maxText="El valor máximo para este campo es de  "+parseInt(c.itemSold.maxQuantityToBeBilled);f.minValue=c.itemSold.minQuantityToBeBilled;f.setFieldStyle("text-align:center;")}}if(l.type=="xml"){c.down("displayfield[name=mxXmlItemName]").width=176}},beforerender:function(b){if(b.type=="remission"){var c=b.down("displayfield[name=mxXmlItemName]");c.hidden=false}}},"invoice_FormAddItem numberfield[name=quantity]":{change:function(c,f,b){var d=c.up("form");var e=d.down("combo[name=idLocal]");this.checkQuantity(e);this.updateItemTotal(c)}},"combo[name=idAutoRetention]":{select:this.calculateAutoRetention},"#addRetentionsPanel":{render:function(b){var c=this.application;var e=Ext.get("addOtherRetention");var d=this;e.on("click",function(){d.addRetentionForm(c)});Ext.Ajax.request({url:"/invoice/retrieve-retentions/id/"+b.invoiceIdLocal+"/onlyActive/true/format/json",success:function(f,h){var j=Ext.decode(f.responseText);if(j.success){var g=j.results;Ext.each(g,function(s){var n=Ext.ComponentQuery.query("#addRetentionsPanel")[0];var m={retention:s};if(n.configs.country=="colombia"){m.width=1220;m.allowBase=true}var r=Ext.create("AL.view.invoice.FormAddRetention",m);if(m.allowBase&&m.allowBase===true&&s.calculatedBy=="percentage"){var u=r.down("[name=base]");var k=0;if(s.percentage>0){k=AL.math.approx(AL.math.div(AL.math.mul(s.amountSecondaryCurrency,100),s.percentage),null,n.invoiceDecimalPrecision)}u.setValue(k)}if(n.configs){r.configs=n.configs}var o=r.down("combo[name=idRetention]");if(n.configs&&["republicaDominicana","argentina"].indexOf(n.configs.country)!=-1&&s.supportDocument){var l=r.down("box[name=supportDocumentSection]");l.html='<a href="/'+s.supportDocumentType+"/view/id/"+s.supportDocument.idLocal+'" target="_blank">Soportada por transacción: '+s.supportDocument.number+"</a>"}var t=o.getStore();var q=function(){var y=r.down("textfield[name=amount]");if(s.status==="inactive"){var w=Ext.create("AL.model.Retention",{idLocal:s.idRetention,name:s.name,percentage:s.percentage,exchangeRate:s.exchangeRate,calculatedBy:s.calculatedBy});t.add(w)}o.select(s.idRetention);y.setValue(s.amountSecondaryCurrency);if(r.configs.showExchangeRate=="yes"){r.down("textfield[name=exchangeRate]").show();r.down("textfield[name=exchangeRate]").allowBlank=false;p.setValue(Ext.util.Format.round(s.exchangeRate,8));p.setFieldLabel("1 "+r.configs.invoiceCurrency+" = ");var x=r.down("label[name=currencyLabel]");Ext.each(x,function(z){x.destroy()});var v=r.down("container[name=exchangeRateContainer]");v.add({xtype:"label",name:"currencyLabel",text:r.configs.currency,margin:"3 0 0 7"})}};if(t.hasLoaded()){q()}else{t.on("load",q);t.load()}var p=r.down("textfield[name=exchangeRate]");p.setValue(Ext.util.Format.round(r.configs.invoiceExchangeRate,8));n.add(r)})}else{GlobalMsg.showErrorMessage("Error",j.cause)}},failure:function(){}})}},"#addRetentionsPanel invoice_FormAddRetention combo[name=idRetention]":{select:this.calculateRetentionPanel},"buttons_SubmitReset button[action=editRetentions]":{click:this.editRetentions},"invoice_FormAddRetentionSuggested combo[name=idRetention]":{render:function(c){var b=c.getStore();if(!b.hasLoaded()){b.load()}},select:this.calculateRetentionSuggested},"invoice_FormAddRetention combo[name=idRetention]":{render:function(c){var b=c.getStore();if(!b.hasLoaded()){b.load()}},select:this.calculateRetention},"invoice_FormAddInvoice hidden[name=exchangeCurrency]":{change:function(f){var b=Ext.ComponentQuery.query("invoice_FormAddItem");var e=this;var g=f.up("form");var d=g.down("combo[name=currency]");var c=d.getSelectedRecord();if(c.get("code")!=g.configs.currency){g.currencySign=c.get("symbol")}else{g.currencySign=null}Ext.each(b,function(k){var l=k.down("combo[name=idLocal]");var j=k.down("textfield[name=price]");var h=l.getSelectedRecord();if(h){j.suspendEvents();e.getPrice(h,j,"no");j.resumeEvents();e.updateItemTotal(j,"no")}});this.updateTotal()}},"invoice_FormAddInvoice combo[name=currency]":{change:function(d){var c=d.up("form");var n=c.down("displayfield[name=exchangeCurrencyDisplay]");var h=c.down("hidden[name=exchangeCurrency]");var f=d.getSelectedRecord();var l=this.application;var m=c.down("switch[name=documentTypeSwitch]");if(f&&f.get("code")&&f.get("code")!=c.configs.currency){n.setValue("1 "+f.get("code")+"="+Ext.util.Format.round(f.get("exchangeRate"),8)+" "+c.configs.currency+'<div class="editExchangeRate">                                <a id="editExchangeRate" href="#">                                    <svg class="icon">                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use>                                    </svg>                                </a>                            </div>');h.setValue(Ext.util.Format.round(f.get("exchangeRate"),8));var e=Ext.get("editExchangeRate");if(e){e.on("click",function(p){p.preventDefault();var o={};o.currency=f.get("code");o.initiator=n;o.currencyRecord=f;l.fireEvent("editExchangeRate",o)})}}else{n.setValue(null);n.hide();h.setValue(null)}var j=Ext.ComponentQuery.query("container[name=remissionContainer]")[0];if(j){this.updateRemissionContainer(null,j);this.updateTotal()}if(c.configs.country!="mexico"||(c.configs.country==="mexico"&&m&&m.getOptionSelected().value!="saleTicket")){var g=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(g){var k={code:f.get("code"),symbol:f.get("symbol")};g.setCurrency(k)}}var b=Ext.ComponentQuery.query("advance_Panel")[0];if(b){b.destroy()}}},"invoice_FormAddInvoice combo[name=idWarehouse]":{change:function(d,c,b){var k=d.up("form");if(k.configs.costCenter.isActive&&d.canChangeCostCenter){var f=d.getSelectedRecord();var e=Ext.ComponentQuery.query("advancedfield[name=idCostCenterCustom]")[0];e=e.down("combo[name=idCostCenterCustom]");var g=k.down("combo[name=idCostCenter]");if(f){var j=f.get("idCostCenter");if(g&&j){g.setValue(j);var h=g.getSelectedRecord();if(!h){a.loadCostCenterRecord(j,g)}if(e){e.setReadOnly(true);e.addCls("combo-noedit-full-border")}}else{if(g){g.setValue(null);e.setReadOnly(false);e.removeCls("combo-noedit-full-border")}}}else{if(e){g.setValue(null);e.setReadOnly(false);e.removeCls("combo-noedit-full-border")}}}d.canChangeCostCenter=true},afterrender:function(e){var b=e.up("form");var d=this;e.canChangeCostCenter=false;var c=e.getStore();if(!c.hasLoaded()&&!c.isLoading()){c.load({callback:function(){if(b.type!="edit"&&!b.idEstimate&&!b.idRemission&&!b.idInvoice){e.canChangeCostCenter=true;var f=c.findRecord("isMain","yes");if(f){e.select(f);if(b.configs.costCenter.isActive){var j=Ext.ComponentQuery.query("advancedfield[name=idCostCenterCustom]")[0];var g=b.down("combo[name=idCostCenter]");var h=f.get("idCostCenter");if(g&&h){g.setValue(h);var f=g.getSelectedRecord();if(!f){d.loadCostCenterRecord(h,g)}j=j.down("combo[name=idCostCenterCustom]");if(j){j.setReadOnly(true);j.addCls("combo-noedit-full-border")}}}}}}})}},select:function(e){var b=this;var d=Ext.ComponentQuery.query("invoice_FormAddItem");Ext.each(d,function(h){var g=h.down("combo[name=idLocal]");var f=g.getStore().getProxy();f.clearCache();h.removeAll();h.destroy()});this.addItemForm();if(e&&!e.up("form").type){this.addItemForm();this.addItemForm()}var c=Ext.ComponentQuery.query("container[name=remissionContainer]")[0];if(c){this.updateRemissionContainer(null,c)}}},"invoice_FormAdvancedOptions combo[name=idPriceList]":{change:function(e){var c=this;if(this.changeIdPriceList===true){this.isChangedIdPriceList=true;var d=Ext.ComponentQuery.query("container[name=remissionContainer]")[0];if(d){this.updateRemissionContainer(null,d)}var b=Ext.ComponentQuery.query("invoice_FormAddItem");Ext.each(b,function(h){var j=h.down("combo[name=idLocal]");var g=h.down("textfield[name=price]");var f=j.getSelectedRecord();if(f){g.suspendEvents();c.getPrice(f,g);g.resumeEvents();c.updateItemTotal(g,"no")}});this.updateTotal()}else{this.changeIdPriceList=true}},afterrender:function(c){var b=c.getStore();if(!b.hasLoaded()){b.load({callback:function(){var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(e.type!="edit"){var d=b.findRecord("main","yes");c.select(d)}}})}}},"invoice_FormAdvancedOptions combo[name=idSeller]":{change:function(c){var b=c.getValue();if(b!=""){this.isChangedIdSeller=true}}},"invoice_FormAddInvoice switch[name=documentTypeSwitch]":{change:function(J){var p=this;var r=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var C=r;if(!r){return}var t=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var H=t.smGetStore();var N=H.getProxy();var I=r.down("switch[name=documentTypeSwitch]");var O=C.down("combo[name=idClient]");selectedValue=J?J.value:I.getValue();if(!N.extraParams||!N.extraParams.documentType||(N.extraParams.documentType&&N.extraParams.documentType!==selectedValue)){if(N.extraParams){N.extraParams.documentType=selectedValue}else{N.extraParams={documentType:selectedValue}}var h=this;if(r.configs.country==="peru"){this.tooltipDocumentType(I,J)}else{if(r.configs.country==="mexico"){var u=selectedValue;var f=C.down("textarea[name=anotation]");var b=Ext.get("createOtherContact");var K=C.down("combo[name=days]");var Q=C.down("datefield[name=date]");var F=C.down("datefield[name=dueDate]");var L=C.down("combo[name=currency]");var m=C.down("combo[name=paymentType]");var g=C.down("combo[name=cfdiUse]");var s=C.down("textfield[name=clientPhone]");var d=C.down("textfield[name=clientIdentification]");var D=Ext.ComponentQuery.query("advancedfield[name=paymentTypeCustom]")[0];var M=Ext.ComponentQuery.query("invoice_FormAddItem");var G=Ext.get("retentionsContainer");var B=Ext.get("addOtherRetentionSuggested");if(u==="saleTicket"){if(f){f.setVisible(false)}if(b){b.setVisible(false)}if(K){K.setVisible(false)}if(F){F.setVisible(false)}if(L){L.setVisible(false)}if(m){m.setVisible(false)}if(s){s.setVisible(false)}if(d){d.setVisible(false)}if(O){O.setVisible(false)}if(g){g.setVisible(false)}if(D){r.getPlugin("advancedfields").panel.remove(D,false)}if(G){G.setVisible(false)}if(B){B.setVisible(false)}var R=Ext.ComponentQuery.query("invoice_FormAddRetentionSuggested");Ext.each(R,function(S){S.destroy()});var A=Ext.get("retentionsSuggestedPanel");var w=u==="saleTicket"?"none":"block";if(A){A.applyStyles("display:"+w)}if(remissions){remissions.style.display=w}r.getPlugin("advancedfields").toggleElement("currencyCustom",{insert:false,required:false,});if(Q&&C.type!="edit"){Q.reset()}}else{if(C.type!="edit"&&!C.idInvoice){var x=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var c=x.down("splitbutton[action=save]");if(c){c.setText("Guardar y "+translate("stamp"))}var e=x.down("menu[action=saveInvoice]");var q=Ext.ComponentQuery.query("buttons_SaveInvoice [afterSave=noStampInvoice]")[0];if(!q){e.add({text:"Guardar sin "+translate("stamp"),action:"save",status:"open",afterSave:"noStampInvoice"})}var v=Ext.ComponentQuery.query("buttons_SaveInvoice [status=draft]")[1];if(!v){e.add({text:translate("saveAsDraft",true),action:"save",status:"draft",})}if(Q){Q.reset()}if(O){O.reset();O.store.load();O.setVisible(true)}if(f){f.setVisible(true)}if(b){b.setVisible(true)}if(K){K.setVisible(true)}if(F){F.reset();F.setVisible(true)}if(s){s.reset();s.setVisible(true)}if(d){d.reset();d.setVisible(true)}if(g){g.reset();g.setVisible(true)}if(G){G.setVisible(true)}if(B){B.setVisible(true)}if(D){r.getPlugin("advancedfields").panel.insert(1,D)}r.getPlugin("advancedfields").toggleElement("currencyCustom",{insert:true,required:false,});var A=Ext.get("retentionsSuggestedPanel");var j=Ext.get("remissions");var w=u.documentType==="saleTicket"?"none":"block";if(A){A.applyStyles("display:"+w)}if(remissions){remissions.style.display=w}}}if(u==="invoice"){Ext.each(M,function(U){var V=U.down("combo[name=idLocal]");var S=V.getSelectedRecord();var T=U.down("textfield[name=importRequest]");if(S&&S.get("canUseImportRequest")&&S.get("canUseImportRequest")==="yes"){T.show();T.enable()}})}else{Ext.each(M,function(T){var S=T.down("textfield[name=importRequest]");S.hide();S.disable()})}}}var k=Ext.ComponentQuery.query("advancedfield[name=typeCustom]")[0];var z=Ext.ComponentQuery.query("advancedfield[name=saleTicketTypeCustom]")[0];if(k){if(selectedValue=="saleTicket"){if(N.extraParams.subDocumentType){delete N.extraParams.subDocumentType}r.getPlugin("advancedfields").panel.remove(k,false);if(Ext.Array.contains(["chile"],r.configs.country)&&z){var y=r.down("combo[name=saleTicketType]"),E=(r.type&&r.type==="edit")?0:1;if(!r.type){N=p.setResolutionFromSwitchSelectionToProxy(N,r,selectedValue)}r.getPlugin("advancedfields").panel.insert(E,z);p.setItemsTaxExemptAndNotExempt(y.getValue());O.getStore().clearFilter()}}else{r.getPlugin("advancedfields").panel.insert(1,k);if(Ext.Array.contains(["chile"],C.configs.country)&&z){r.getPlugin("advancedfields").panel.remove(z,false);if(!r.type){N=p.setResolutionFromSwitchSelectionToProxy(N,r,selectedValue)}var o=r.down("combo[name=type]");p.setItemsTaxExemptAndNotExempt(o.getValue());if(C.configs.country=="chile"){O.getStore().filterBy(function(S,T){return S.data.identification!="66666666-6"})}}}}H.load({callback:function(W){var U;if(r.invoice&&r.invoice&&r.invoice["resolutionIdLocal"]){U=Ext.create("AL.model.Resolution",{idLocal:r.invoice.resolutionIdLocal});if(r.invoice&&r.invoice&&r.invoice["resolutionDocumentType"]&&r.invoice["resolutionDocumentType"]==selectedValue){var T=H.findRecord("idLocal",r.invoice.resolutionIdLocal);if(!T){U=H.findRecord("isDefault","yes")}}else{H.each(function(X){if(X&&X.data.documentType!=selectedValue){H.remove(X);t.smSyncWithStore()}});U=null}}else{U=H.findRecord("isDefault","yes")}if(!U){U=W[0]}if(U){t.smSetValue(U.data.idLocal);h.verifyResolutionInactive(r)}if(H.count()>1){var S=Ext.ComponentQuery.query("[name=resolutionDropdown]")[0];S.show()}if(Ext.Array.contains(["chile"],r.configs.country)&&selectedValue==="saleTicket"&&W==0){var V=r.down("combo[name=saleTicketType]");if(V.getValue()=="EXEMPT"){GlobalMsg.showNotification({title:"Error",text:translate("youHaveNotYetConfiguredAnyNumerationFor",true,{documents:translate("exemptSaleTickets")})+' <a href="/resolution" target="_blank">'+translate("here")+"</a>",type:"error",closeable:"no"});V.setValue("NATIONAL")}else{GlobalMsg.showNotification({title:"Error",text:translate("youHaveNotYetConfiguredAnyNumerationFor",true,{documents:translate("saleTickets")})+' <a href="/resolution" target="_blank">'+translate("here")+"</a>",type:"error",closeable:"no"});I.setValue("invoice");I.fireEvent("change")}}}})}if(r.configs.country!=="peru"){return}var l=r.down("combo[name=operationType]");var n=l.getStore();var P=n.getProxy();if(!P.filters||!P.filters.documentType||(P.filters.documentType&&P.filters.documentType!==selectedValue)){if(P.filters){P.filters.documentType=selectedValue}else{P.filters={documentType:selectedValue}}P.url="/country-legal-info/retrieve-parameters-by-key/key/operationTypes/format/json?filters="+Ext.encode(P.filters);n.load({callback:function(S){if(!l.getValue()){record=n.findRecord("value","Venta interna");l.setValue(record.data.key)}}})}}},"invoice_FormAddInvoice combo[name=saleCondition]":{change:function(g,e){var d=g.up("form");var f=d.down("combo[name=days]");var c=f.getStore();var b=function(){var h=c.findRecord("idLocal",1);var j=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(e==="CASH"){if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.select(h);f.disable();if(!d.configs||(d.configs&&d.configs.country!=="argentina")){j.disable()}f.getSubmitData=a.getSubmitDataDisabled;j.getSubmitData=a.getSubmitDataDisabled}else{if(e==="CREDIT"){if(h.get("idLocal")==1){c.remove(h);f.reset()}clientCombo=Ext.ComponentQuery.query("combo[name=idClient]")[0];clientTerm=clientCombo.getSelectedRecord().get("idTerm");if(clientTerm){f.select(clientTerm)}f.enable();j.enable()}else{if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.enable();j.enable()}}};if(c.hasLoaded()){b()}else{c.on("load",{callback:function(){b()}})}}},"combo[name=paymentForm]":{change:function(g,e){var d=g.up("form");var f=d.down("combo[name=days]");var c=f.getStore();var b=function(){var h=c.findRecord("idLocal",1);var j=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(e===1){if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.select(h);f.disable();j.disable();f.getSubmitData=a.getSubmitDataDisabled;j.getSubmitData=a.getSubmitDataDisabled}else{if(e===2){c.remove(h);f.reset();f.enable();j.enable()}else{if(!h){h=Ext.create("AL.model.Term",{idLocal:1,name:"De contado",days:0});c.insert(0,h)}f.enable();j.enable()}}};if(c.hasLoaded()){b()}else{c.on("load",{callback:function(){b()}})}}},"invoice_FormAddInvoice combo[name=saleConcept]":{change:function(h,e){var d=h.up("form"),g="/item/retrieve-all/format/json",c=d.down("datefield[name=startDateService]"),f=d.down("datefield[name=endDateService]");switch(e){case"PRODUCTS":g="/item/retrieve-all/format/json/type/products";c.hide();c.allowBlank=true;f.hide();f.allowBlank=true;break;case"SERVICES":g="/item/retrieve-all/format/json/type/services";c.show();c.allowBlank=false;f.show();f.allowBlank=false;c.enable();f.enable();break;default:c.show();c.allowBlank=false;f.show();f.allowBlank=false;c.enable();f.enable();break}this.updateRemissionContainer();var b=Ext.ComponentQuery.query("invoice_FormAddItem");Ext.each(b,function(m){var l=m.down("combo[name=idLocal]"),k=l.getStore(),j=k.getProxy();if(j.url!=g){j.url=g;j.clearCache();k.load({callback:function(){if(m&&!m.itemSold){return}var o=m.itemSold,n=k.findRecord("idLocal",o.idLocal),p=true;switch(e){case"SERVICES":p=o&&o.unit==="service"?true:false;break;case"PRODUCTS":p=o&&o.unit!=="service"?true:false;break}if(!n&&p){var n=Ext.create("AL.model.Item",o);k.add(n)}if(n){l.select(n)}}})}})}},"invoice_FormAddInvoice combo[name=type]":{afterrender:function(d){var c=d.up("form");if(!c.isAvailableTypeField()){return}var b=d.getStore();b.load({callback:function(e){if(!d.getValue()){record=b.findRecord("key","NATIONAL");if(record){d.setValue(record.data.key)}}}})},change:function(q,l){var c=q.up("form");switch(c.configs.country){case"colombia":var e=c.getPlugin("advancedfields");var n=e.panel.items.items.filter(function(u){return u.name=="deliveryTerm"})[0];if(l==="EXPORT"){if(!n){n=Ext.create("AL.view.ux.form.AdvancedField",{xtype:"advancedfield",name:"deliveryTerm",label:{text:"Condición de entrega"},allowBlank:true,type:"combo",cls:"advancedfields",store:"DeliveryTerms",valueField:"key",displayField:"value",required:false,forceRendering:true});var t=n.getComboElement().getStore();t.load();var r=null;for(var h=0;h<e.panel.items.length;h++){var p=e.panel.items.items[h];if(p.name=="operationTypeColCustom"){r=h;break}}if(r!=null){e.panel.insert(r+1,n)}}}else{if(n){e.panel.remove(n,false)}}break;case"costaRica":var g=c.down("switch[name=documentTypeSwitch]");var d=g.getOptionSelected();var b=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var k=b.smGetStore();var m=k.getProxy();var o=l=="EXPORT"?"EXPORT_INVOICE":"invoice";var j=!m.extraParams||!m.extraParams.documentType||(m.extraParams.documentType&&m.extraParams.documentType!==d.value);var f=!m.extraParams||!m.extraParams.subDocumentType||(m.extraParams.subDocumentType&&m.extraParams.subDocumentType!==o);if(j||f){if(m.extraParams){m.extraParams.documentType=d.value;m.extraParams.subDocumentType=o}else{m.extraParams={documentType:d.value,subDocumentType:o}}var s=this;k.load({callback:function(x){var w;if(c.invoice&&c.invoice&&c.invoice["resolutionIdLocal"]){w=Ext.create("AL.model.Resolution",{idLocal:c.invoice.resolutionIdLocal});if(c.invoice&&c.invoice&&c.invoice["resolutionDocumentType"]&&c.invoice["resolutionDocumentType"]==d.value){var v=k.findRecord("idLocal",c.invoice.resolutionIdLocal);if(!v){w=k.findRecord("isDefault","yes")}}else{k.each(function(y){if(y&&y.data.documentType!=d.value){k.remove(y);b.smSyncWithStore()}});w=null}}else{w=k.findRecord("isDefault","yes")}if(x.length>0){if(!w){w=x[0]}if(w){b.smSetValue(w.data.idLocal);s.verifyResolutionInactive(c)}if(k.count()>1){var u=Ext.ComponentQuery.query("[name=resolutionDropdown]")[0];u.show()}}else{if(l=="EXPORT"){GlobalMsg.showNotification({title:"Error",text:'Aún no has configurado ninguna numeración para facturas de exportación, configúrala <a href="/resolution/add" target="_blank">aquí</a>',type:"error",closeable:"no"});q.setValue("NATIONAL")}}}})}break;case"chile":var b=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0],g=c.down("switch[name=documentTypeSwitch]"),d=g.getOptionSelected(),k=b.smGetStore(),m=k.getProxy();var o=l=="EXEMPT"?"EXEMPT_INVOICE":"invoice";var j=!m.extraParams||!m.extraParams.documentType||(m.extraParams.documentType&&m.extraParams.documentType!==d.value);var f=!m.extraParams||!m.extraParams.subDocumentType||(m.extraParams.subDocumentType&&m.extraParams.subDocumentType!==o);this.setItemsTaxExemptAndNotExempt(l);if(j||f){if(m.extraParams){m.extraParams.subDocumentType=o}else{m.extraParams={subDocumentType:o}}var s=this;k.load({callback:function(x){var w;if(c.invoice&&c.invoice&&c.invoice["resolutionIdLocal"]){w=Ext.create("AL.model.Resolution",{idLocal:c.invoice.resolutionIdLocal});if(c.invoice&&c.invoice){var v=k.findRecord("idLocal",c.invoice.resolutionIdLocal);if(!v){w=k.findRecord("isDefault","yes")}}else{k.each(function(y){if(y&&y.data.documentType){k.remove(y);b.smSyncWithStore()}});w=null}}else{w=k.findRecord("isDefault","yes")}if(x.length>0){if(!w){w=x[0]}if(w){b.smSetValue(w.data.idLocal);s.verifyResolutionInactive(c)}if(k.count()>1){var u=Ext.ComponentQuery.query("[name=resolutionDropdown]")[0];u.show()}}else{if(l=="EXEMPT"){GlobalMsg.showNotification({title:"Error",text:translate("youHaveNotYetConfiguredAnyNumerationFor",true,{documents:translate("exemptInvoices")})+' <a href="/resolution" target="_blank">'+translate("here")+"</a>",type:"error",closeable:"no"});q.setValue("NATIONAL")}}}})}break}}},"invoice_FormAddInvoice combo[name=saleTicketType]":{beforerender:function(d){var b=d.up("form");if(!b.isAvailableTypeField()){return}var c=Ext.ComponentQuery.query("advancedfield[name=saleTicketTypeCustom]")[0];if(Ext.Array.contains(["chile"],b.configs.country)&&c&&b.documentType!="saleTicket"){b.getPlugin("advancedfields").panel.remove(c,false)}var e=d.getStore();if(b.configs.country==="chile"){e.load({callback:function(f){}})}},change:function(d,o){var b=d.up("form");switch(b.configs.country){case"chile":var k=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0],m=b.down("switch[name=documentTypeSwitch]"),c=m.getOptionSelected(),h=k.smGetStore(),l=h.getProxy();var j=o=="EXEMPT"?"EXEMPT_SALE_TICKET":"saleTicket";var f=!l.extraParams||!l.extraParams.documentType||(l.extraParams.documentType&&l.extraParams.documentType!==c.value);var e=!l.extraParams||!l.extraParams.subDocumentType||(l.extraParams.subDocumentType&&l.extraParams.subDocumentType!==j);var g=Ext.ComponentQuery.query("invoice_FormAddItem");if(!b.type){Ext.each(g,function(r){if(o=="EXEMPT"){var p=r.down("combo[name=idTax]");var q=p.getStore();q.clearFilter();q.filter("idLocal",0);p.setValue(0)}else{var p=r.down("combo[name=idTax]");var q=p.getStore();if(k.smGetSelectedRecord()&&k.smGetSelectedRecord().data.metadata.isElectronicResolution==true){q.clearFilter();q.filter(function(s){return !s.data.idLocal==0});p.setValue("1")}else{q.clearFilter()}}});if(f||e){if(l.extraParams){l.extraParams.subDocumentType=j}else{l.extraParams={subDocumentType:j}}var n=this;h.load({callback:function(s){var r;if(b.invoice&&b.invoice&&b.invoice["resolutionIdLocal"]){r=Ext.create("AL.model.Resolution",{idLocal:b.invoice.resolutionIdLocal});if(b.invoice&&b.invoice){var q=h.findRecord("idLocal",b.invoice.resolutionIdLocal);if(!q){r=h.findRecord("isDefault","yes")}}else{h.each(function(t){if(t&&t.data.documentType){h.remove(t);k.smSyncWithStore()}});r=null}}else{r=h.findRecord("isDefault","yes")}if(s.length>0){if(!r){r=s[0]}if(r){k.smSetValue(r.data.idLocal);n.verifyResolutionInactive(b)}if(h.count()>1){var p=Ext.ComponentQuery.query("[name=resolutionDropdown]")[0];p.show()}}else{if(o=="EXEMPT"){GlobalMsg.showNotification({title:"Error",text:translate("youHaveNotYetConfiguredAnyNumerationFor",true,{documents:translate("exemptSaleTickets")})+' <a href="/resolution" target="_blank">'+translate("here")+"</a>",type:"error",closeable:"no"});d.setValue("NATIONAL")}}}})}}break}}},})},addVoidCause:function(a){var b=Ext.create("AL.view.invoice.AddVoidCause",{documentType:"invoice",documentId:a.idLocal,documentDate:a.date,country:a.country})},editRetentions:function(c){if(this.validateRetentionForms()){c.disable();GlobalRedirector.go({zoneTitle:translate("savingAction",true)+" "+translate("retentions")});var b=Ext.ComponentQuery.query("#addRetentionsPanel")[0];var d=Ext.ComponentQuery.query("invoice_FormAddRetention");var a=[];Ext.each(d,function(j){var g=j.getValues();if(j.retention){g.idRetentionApplied=j.retention.id}var f=j.down("combo[name=idRetention]");var h=f.currentRetention;if(g.idRetention==="old"&&h){g.idRetention=h.get("currentId")}else{if(g.idRetention==="old"&&!h){delete g.idRetention}}g.exchangeRate=j.down("textfield[name=exchangeRate]").getValue();a.push(g)});var e={invoiceIdLocal:b.invoiceIdLocal,retentions:Ext.encode(a)};Ext.Ajax.request({url:"/invoice/edit-retentions/format/json",method:"POST",params:e,success:function(f,g){var h=Ext.decode(f.responseText);if(h.success){window.location="/invoice/view/id/"+b.invoiceIdLocal}else{c.enable();GlobalRedirector.close();GlobalMsg.showErrorMessage("Error",h.cause)}},failure:function(){GlobalRedirector.close()}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},addRetentionForm:function(g){var d=Ext.ComponentQuery.query("#addRetentionsPanel")[0];var c={canCreateNewRetention:d.configs.canCreateNewRetention};if(d.configs.country=="colombia"){c.width=1220;c.allowBase=true}var b=Ext.create("AL.view.invoice.FormAddRetention",c);var f=b.down("textfield[name=exchangeRate]");var e=b.down("combo[name=idRetention]");var j=Ext.create("AL.store.Retentions",{autoLoad:false,data:[]});if(d.configs){b.configs=d.configs}if(b.configs.showExchangeRate=="yes"){b.down("textfield[name=exchangeRate]").show();f.setValue(Ext.util.Format.round(b.configs.invoiceExchangeRate,8));f.setFieldLabel("1 "+b.configs.invoiceCurrency+" = ");var h=b.down("label[name=currencyLabel]");Ext.each(h,function(k){h.destroy()});var a=b.down("container[name=exchangeRateContainer]");a.add({xtype:"label",name:"currencyLabel",text:b.configs.currency,margin:"3 0 0 7"})}if(b.configs&&!b.configs.invoiceCurrency){f.hide()}e.store=j;j.load();d.add(b)},showSpinner:function(b,c,d){d=d?d:translate("sending",true);if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},printInvoice:function(g,j){var l=this,a,c,b,o=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0],m=Ext.getDom("printInvoice"),n=Ext.getDom("downloadInvoice"),h=Ext.getDom("emailInvoice");j.preventDefault();if(Ext.isElement(g)){a=g.getAttribute("data-idLocal");c=g.getAttribute("data-status");b=g.getAttribute("data-canPrint")}else{a=o.idLocal;c=o.status;b=o.canPrint}var k=(g.type)?g.type:"original";var p=function(){if(c==="draft"&&b==="yes"){m.setAttribute("data-status","open");o.status="open";n.setAttribute("data-status","open");h.setAttribute("data-status","open");Ext.create("AL.view.invoice.WindowPrint",{idLocal:a,pdfType:k})}else{if(c==="draft"){m.setAttribute("data-status","open");o.status="open";n.setAttribute("data-status","open");h.setAttribute("data-status","open")}if(b==="yes"){d()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:"¡Para imprimir debes ingresar los siguientes datos de tu empresa!",title:"Completa la siguiente información para continuar",idLocal:a,callback:d,resourceTrigger:"invoice"})}}};var d=function(){var q=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(q){q.destroy();m.setAttribute("data-canPrint","yes");o.canPrint="yes";n.setAttribute("data-canDownload","yes");window.location="/invoice/print/id/"+a+"/type/"+k}else{var e=window.open("/invoice/print/id/"+a+"/type/"+k);e.print()}};if(c==="draft"){var f=Ext.create("AL.model.Invoice",{idLocal:a,status:c});l.convertInvoiceToOpen(f,p,"yes")}else{p()}},selectPaymentMethodAndType:function(h){try{var f=h.up("form");var c=h.getSelectedRecord();if(!c){return}var d=c.getData();if(f.configs){switch(f.configs.country){case"mexico":var b=f.down("combo[name=paymentType]");var a=f.down("combo[name=paymentMethod]");if(d.metadata.paymentType||d.metadata.paymentMethod){if(d.metadata.paymentType&&b){b.setValue(d.metadata.paymentType)}if(d.metadata.paymentMethod&&a){a.setValue(d.metadata.paymentMethod.toLowerCase())}}else{if(b){b.setValue("PUE")}if(a){a.setValue("cash")}}break}}}catch(g){console.warn(g.message)}},stampInvoice:function(f,h){var a=f.getAttribute("data-idLocal");var d=f.getAttribute("data-status");var c=f.getAttribute("data-country");var k=f.getAttribute("data-priceFeInCurrentMembership");var n=f.getAttribute("data-showModalInfoFe");var m=f.getAttribute("data-monthsCurrentMembership");h.preventDefault();if(["open","closed"].indexOf(d)!=-1){var l=function(){if(c=="panama"){GlobalRedirector.go({zoneTitle:"Generando comprobante fiscal",width:599});Ext.Ajax.request({url:"/invoice/pa-stamp/format/json/id/"+a,success:function(o){var q=Ext.decode(o.responseText);if(q.success){var p=0;var e=setInterval(function(){Ext.Ajax.request({async:false,url:"/invoice/has-stamp/format/json/id/"+a,success:function(r){var s=Ext.decode(r.responseText);if(s.hasStamp){window.location.reload()}},failure:function(){clearInterval(e)}});p++;if(p>40){clearInterval(e);GlobalRedirector.close();Ext.Msg.show({title:"",msg:'No se generó número de comprobante fiscal.<br>Verifica la conexión de tu impresora.<br><a href="http://ayuda.getsoft.app/hc/es/articles/217951563">Ver más</a>.<br>',buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}},4000)}else{GlobalRedirector.close();if(q.cause){GlobalMsg.showNotification({title:"Error",text:q.cause,type:"error"})}else{GlobalMsg.showNotification({title:"Error",text:"No se pudo obtener el número de comprobante fiscal",type:"error"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:"No se pudo obtener el número de comprobante fiscal",type:"error"})}})}else{GlobalRedirector.go({zoneTitle:translate("stamping",true)+" "+translate("invoice")});Ext.Ajax.request({url:"/invoice/stamp/format/json/id/"+a,success:function(e){var o=Ext.decode(e.responseText);if(o.success){window.location.reload()}else{GlobalRedirector.close();if(o.cause){GlobalMsg.showNotification({title:"Error",text:o.cause,type:"error",closeable:"no"})}else{GlobalMsg.showNotification({title:"Error",text:translate("theInvoice",true)+" "+translate("invoice")+" no se pudo "+translate("stamp"),type:"error",closeable:"no"})}}},failure:function(){GlobalRedirector.close();GlobalMsg.showNotification({title:"Error",text:translate("theInvoice",true)+" "+translate("invoice")+" no se pudo "+translate("stamp"),type:"error"})}})}};if(["costaRica","peru","colombia"].indexOf(c)!==-1&&n==true){var b="mensuales";switch(m){case"3":b="trimestrales";break;case"6":b="semestrales";break;case"12":b="anuales";break}var j,g;switch(c){case"costaRica":j=(new Date()<new Date("2018-10-01")?"Disfruta de facturación electrónica sin costo hasta el 30 de septiembre. <br> Luego podrás emitir ":" Para continuar emitiendo comprobantes deberás activar facturación electrónica")+" por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g=(new Date()<new Date("2018-10-01")?"Disfrutala sin costo hasta el 30 de septiembre. <br> ":"")+"Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"peru":j="Para continuar emitiendo comprobantes deberás activar facturación electrónica por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"colombia":j="Para continuar expidiendo comprobantes deberás activar facturación electrónica por <strong>"+k+"</strong> "+b+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";g="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break}Ext.Msg.show({title:"Incluir facturación electrónica",msg:j,buttons:Ext.MessageBox.YESNO,cls:"modal-info-fe",width:480,fn:function(e){GlobalRedirector.go({zoneTitle:"Actualizando membresía"});Ext.Ajax.request({url:"/membership/include-fe/value/"+e+"/format/json",success:function(o,p){GlobalRedirector.close();var q=Ext.decode(o.responseText);if(q.success&&e==="yes"){GlobalMsg.showNotification({type:"success",title:"Facturación electrónica incluida",text:g,});setTimeout(l,3000)}else{l()}}})}})}else{l()}}},downloadInvoice:function(g,j){var l=this,a,c,b,o=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0],m=Ext.getDom("printInvoice"),n=Ext.getDom("downloadInvoice"),h=Ext.getDom("emailInvoice");j.preventDefault();if(Ext.isElement(g)){a=g.getAttribute("data-idLocal");c=g.getAttribute("data-status");b=g.getAttribute("data-canDownload")}else{a=o.idLocal;c=o.status;b=o.canPrint}var k=(g.type)?g.type:"original";var p=function(){if(c==="draft"&&b==="yes"){n.setAttribute("data-status","open");m.setAttribute("data-status","open");o.status="open";h.setAttribute("data-status","open");window.location="/invoice/generate-pdf/id/"+a+"/download/yes/type/"+k}else{if(c==="draft"){n.setAttribute("data-status","open");m.setAttribute("data-status","open");o.status="open";h.setAttribute("data-status","open")}if(b==="yes"){d()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:"¡Para descargar "+translate("theInvoice")+" "+translate("invoices")+" debes ingresar los siguientes datos de tu empresa!",title:"Completa la siguiente información para continuar",url:"/invoice/print/id/"+a+"/type/"+k,idLocal:a,callback:d,resourceTrigger:"invoice"})}}};var d=function(){var e=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(e){e.destroy();n.setAttribute("data-canDownload","yes");m.setAttribute("data-canPrint","yes");o.canPrint="yes"}window.location="/invoice/generate-pdf/id/"+a+"/download/yes/type/"+k};if(c==="draft"){var f=Ext.create("AL.model.Invoice",{idLocal:a,status:c});l.convertInvoiceToOpen(f,p,"yes")}else{p()}},emailInvoice:function(d,g){var j=this,a,b,m,k=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0],f=Ext.getDom("emailInvoice");if(g){g.preventDefault()}if(Ext.isElement(d)){a=d.getAttribute("data-idLocal");b=d.getAttribute("data-status");m=d.getAttribute("data-canEmail")}else{a=k.idLocal;b=k.status;m=k.canEmail}var h=(d.type)?d.type:"original";var l=function(){var e=function(){var n=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(n){n.destroy();k.canEmail="yes";f.setAttribute("data-canEmail","yes")}Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-invoice/id/"+a+"/notification/no/format/json/email-template/invoice",success:function(p,r){var t=Ext.decode(p.responseText);if(t.success){var o=[];if(t.results){var q=t.results;o.push({xtype:"textfield",name:"email",labelWidth:55,fieldLabel:translate("toRecipientEmail",true)+":",tooltip:translate("youCanAlsoSend",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("toAParticularEmailOrSendTo")+".</div>",width:50,anchor:"94%",labelAlign:"right"});if(t.clientEmail){o.push({boxLabel:t.clientEmail+" - ("+t.clientName+")",name:"email",record:{name:t.clientName,email:t.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right",margin:"2 0 2 60"})}else{if(q.length==0){o.push({xtype:"box",style:"color: #999; font-size: 11px; margin: 2px 0px 2px 60px;",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(q,function(u){o.push({boxLabel:u.email+" - ("+u.name+" "+u.lastName+")",name:"email",record:u,xtype:"checkbox",labelWidth:200,labelAlign:"right",margin:"2 0 2 60"})});o.push({xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"2 0 2 60"});if(t.emailTemplate){o.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:55,margin:"7 0 10 0",value:t.emailTemplate.subject,labelAlign:"right"});o.push({xtype:"htmleditor",name:"emailMessage",labelWidth:50,enableSourceEdit:false,margin:"0 0 10 0",height:250,value:t.emailTemplate.message});o.push({xtype:"label",html:'<a class="editEmailTemplate" target="_blank" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",style:"position: relative; bottom: 4px; width: auto; z-index: 10;",margin:"0 0 0 330"})}}o.push({xtype:"checkboxfield",name:"statementAttached",boxLabel:translate("includeLinkTo",true)+" "+translate("statement")+'<div class="tooltip-wrapper" style="margin-left: -228px; margin-top: -23px;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="margin-top: -25px;"><div class="tooltip-text-wrapper tooltip-small" style="width: 110px;"><div class="text">'+translate("knowMore",true)+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/213081003">'+translate("here")+"</a>.</div></div></div></div>",checked:t.statementClientAttached,margin:"-23 0 0 0"});var s=Ext.create("AL.view.common.SmileWindow",{reason:"confirmInvoiceEmail",id:"window-invoice-send-to-emails",title:"",idLocal:a,title:translate("send",true)+" "+translate("invoice")+" "+translate("toTheseEmails"),type:h,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,autoScroll:true,items:{xtype:"form",items:o,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(u){var w=u.up("window");var v=w.down("button[action=confirmEmail]");if(v){v.fireEvent("click",v)}}}]}});s.show()}else{Ext.Msg.alert("Error",t.cause)}},failure:function(){}})};if(m==="yes"){e()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theInvoice")+" "+translate("invoice")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),url:"/invoice/print/id/"+a,forEmail:true,idLocal:a,callback:e,resourceTrigger:"invoice"})}};if(b==="draft"){var c=Ext.create("AL.model.Invoice",{idLocal:a,status:b});j.convertInvoiceToOpen(c,l,"yes")}else{l()}},saveInvoice:function(q){var p=this;var r=Ext.ComponentQuery.query("invoice_FormAddItem");var E=[];var D=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(q.action==="configCompany"){return}Ext.each(r,function(R){var P=R.getValues();if(!P.idTax||P.idTax==0){delete P.idTax}if(P.discount===""){P.discount=0}if(!R.configs){R.configs=D.configs}R.configs.country=D.configs.country;var Q=R.getFieldValuesAsMetadata();if(Q){P.metadata=Ext.encode(Q)}if(P.idLocal){E.push(P)}});var w=q.status;var D=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var L=Ext.ComponentQuery.query("invoice_BottomContainer")[0];if(D.configs.country=="mexico"&&D.configs.replace&&D.idInvoice){var o=Ext.ComponentQuery.query("combo[name=paymentType]")[0];var y=Ext.ComponentQuery.query("combo[name=paymentMethod]")[0];if(o&&y){o.enable();y.enable()}}var j=D.getValues();var d=L.down("[name=anotation]");var x=L.down("[name=termsConditions]");j.anotation=d.getValue();j.termsConditions=x.getValue();j.items=Ext.encode(E);j.status=w;j.idEstimate=D.idEstimate;var k=Ext.ComponentQuery.query("invoice_FormAddAutoRetention");var g=[];Ext.each(k,function(Q){var P=Q.getValues();if(P.idAutoRetention&&P.amount){g.push(P)}});j.autoRetentions=Ext.encode(g);var N=Ext.ComponentQuery.query("invoice_FormAddRetentionSuggested");var I=[];Ext.each(N,function(Q){var P=Q.getValues();if(P.idRetention&&P.amount){I.push(P)}});j.retentionsSuggested=Ext.encode(I);var G=Ext.ComponentQuery.query("invoice_FormAddRetention");var e=[];Ext.each(G,function(Q){var P=Q.getValues();if(P.idRetention&&P.amount){e.push(P)}});j.retentions=Ext.encode(e);var u=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var m=u.smGetSelectedRecord().data;j.idResolution=m.idLocal;var v=L.down("textarea[name=resolutionPie]");j.resolutionPieText=v?v.getValue():"";var B=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];if(B){var s=B.getValues();j.observations=s.observations;j.idSeller=s.idSeller;j.idPriceList=s.idPriceList}var b=D.down("hidden[name=exchangeCurrency]");if(b&&b.getValue()){j.exchangeRate=b.getValue()}var J=Ext.ComponentQuery.query("advance_FormPanel");if(J){var F=[];Ext.each(J,function(Q){var P=Q.getValues();if(P.number&&P.amountToApply){F.push({id:P.number,amount:P.amountToApply,date:P.date})}});j.advances=Ext.encode(F)}if(["mexico","costaRica"].indexOf(D.configs.country)!==-1&&D.configs.replace&&D.idInvoice){j.idReplacedInvoice=D.idInvoice}var A=true;if(this.getCountriesWithStamp().indexOf(D.configs.country)!==-1&&m.isElectronicResolution===false){j.noStampInvoice="no";A=false}if(D.configs.country=="colombia"&&D.configs.isActiveElectronicInvoicing&&D.configs.electronicInvoicingVersion=="2.1"&&D.down("combo[name=paymentMethodCol]").getValue()=="CASH"){j.dueDate=Ext.Date.format(D.down("datefield[name=date]").getValue(),"d/m/Y")}var H=D.down("switch[name=documentTypeSwitch]");if(H&&H.getOptionSelected()&&H.getOptionSelected().value==="saleTicket"){delete j.type}var f="/invoice/view/id/";var c=false;var l=translate("creatingAction",true)+" "+translate("invoice");if(D.configs.country==="mexico"){l="Creando venta"}var a=D.getFieldValuesAsMetadata();if(a){j.metadata=Ext.encode(a)}var C=Ext.get("new-comment");if(C&&C.getValue()){var z=C.getValue();j.comment=Ext.encode(z)}if(q.afterSave){switch(q.afterSave){case"sendEmail":f="/invoice/view/id/";break;case"print":f="/invoice/print/id/";break;case"createInvoice":c=true;break;case"addPayment":f="/transaction/in/number/";break;case"noStampInvoice":j.noStampInvoice="no";A=false;break;case"preview":j.noStampInvoice="no";A=false;l=translate("generatingPreview",true);j.saveHistory="no";f="/invoice/preview/id/";break;case"paFiscalPrint":j.paFiscalPrint="yes";break;case"sendByEmail":f="/invoice/view/sendByEmail/yes/id/";break;default:f="/invoice/view/id/";break}}else{if(q.status==="draft"){j.noStampInvoice="no";A=false}}var n=q.up("form");if(D.type=="xml"){j.mxIdXml=D.idXml;if(D.configs.idPdf){j.mxIdPdf=D.configs.idPdf}}if(Ext.Array.contains(["chile"],D.configs.country)){var O=D.down("switch[name=documentTypeSwitch]");if(O&&O.getValue()=="saleTicket"){j.type=j.saleTicketType}}if(!p.validateCostCenter(D,j)){p.showMessageCostCenterError(D,q);return}if(p.validateForms(A)){n.disableButtons();var h=function(){GlobalRedirector.go({zoneTitle:l});Ext.Ajax.request({url:"/invoice/add/format/json",method:"POST",timeout:120000,params:j,success:function(Q,S){var T=Ext.decode(Q.responseText);if(T.success){var U=T.results;if(c){if(D.configs.country==="mexico"&&m.documentType==="saleTicket"){window.location="/invoice/add/dt/saleTicket"}else{window.location="/invoice/add"}}else{if(q.afterSave=="preview"){n.enableButtons();GlobalRedirector.close();Ext.Msg.show({msg:"Observa la vista previa de tu "+translate("invoice")+" presionando el siguiente botón",buttons:Ext.MessageBox.YES,buttonText:{yes:"Descargar"},height:100,minHeight:20,closable:false,header:false,tbar:false,bodyPadding:0,buttonAlign:"center",fn:function(V){if(V=="yes"){window.location=f+U+"/download/yes"}}})}else{if(j.paFiscalPrint=="yes"){GlobalRedirector.close();GlobalRedirector.go({zoneTitle:"Obteniendo comprobante fiscal"});var R=0;var P=setInterval(function(){Ext.Ajax.request({async:false,url:"/invoice/has-stamp/format/json/id/"+U,success:function(V){var W=Ext.decode(V.responseText);if(W.hasStamp){window.location=f+U}},failure:function(){clearInterval(P)}});R++;if(R>10){clearInterval(P);GlobalRedirector.close();Ext.Msg.show({title:"OUCH",msg:'No se generó número de comprobante fiscal.<br>Verifica la conexión de tu impresora.<br><a href="http://ayuda.getsoft.app/hc/es/articles/217951563">Ver más.</a><br>Tu factura se creó en estado abierta. Cuando soluciones el inconveniente, puedes obtener el comprobante fiscal.',fn:function(){window.location=f+U},buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}},1500)}else{window.history.pushState({},"","/invoice/view/id/"+U);window.location=f+U;if(q.afterSave&&q.afterSave=="print"){setTimeout(function(){Ext.Msg.show({msg:"Tu "+translate("invoice")+' está siendo descargada.  Al terminar este proceso \n                                                haz clic <a href="/invoice/view/id/'+U+'">aquí</a> para ser redirigido a \n                                                la pantalla de consulta de tu '+translate("invoice")+".",buttons:Ext.MessageBox.YES,buttonText:{yes:"Ir a "+translate("invoice")},fn:function(V){if(V=="yes"){window.location="/invoice/view/id/"+U}}})},10000)}}}}}else{n.enableButtons();GlobalRedirector.close();if(T.cause){GlobalMsg.showErrorMessage("Advertencia",T.cause,"no","warning")}}},failure:function(){n.enableButtons();GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                                    Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");GlobalRedirector.close()}})};if(A&&D.configs&&["costaRica","peru","colombia"].indexOf(D.configs.country)!==-1&&D.configs.showModalInfoFe){var M="mensuales";switch(D.configs.monthsCurrentMembership){case"3":M="trimestrales";break;case"6":M="semestrales";break;case"12":M="anuales";break}var K,t;switch(D.configs.country){case"costaRica":K=(new Date()<new Date("2018-10-01")?"Disfruta de facturación electrónica sin costo hasta el 30 de septiembre. <br> Luego podrás emitir ":" Para continuar emitiendo comprobantes deberás activar facturación electrónica")+" por <strong>"+D.configs.priceFeInCurrentMembership+"</strong> "+M+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";t=(new Date()<new Date("2018-10-01")?"Disfrutala sin costo hasta el 30 de septiembre. <br> ":"")+"Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"peru":K="Para continuar emitiendo comprobantes deberás activar facturación electrónica por <strong>"+D.configs.priceFeInCurrentMembership+"</strong> "+M+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";t="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"colombia":K="Para continuar expidiendo comprobantes deberás activar facturación electrónica por <strong>"+D.configs.priceFeInCurrentMembership+"</strong> "+M+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";t="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break}Ext.Msg.show({title:"Incluir facturación electrónica",msg:K,buttons:Ext.MessageBox.YESNO,cls:"modal-info-fe",width:480,fn:function(P){GlobalRedirector.go({zoneTitle:"Actualizando membresía"});Ext.Ajax.request({url:"/membership/include-fe/value/"+P+"/format/json",success:function(Q,R){GlobalRedirector.close();var S=Ext.decode(Q.responseText);if(S.success&&P==="yes"){GlobalMsg.showNotification({type:"success",title:"Facturación electrónica incluida",text:t,});setTimeout(h,3000)}else{h()}}})}})}else{h()}}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},editInvoice:function(a){var r=Ext.ComponentQuery.query("invoice_FormAddItem");var w=Ext.ComponentQuery.query("[name=containerTotal]");var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var j=0;Ext.each(w,function(C){if(C.fieldLabel==="Total"){j=C.value}});var B=[];if(this.validateForms()){a.disable();var n=translate("invoice");if(e.configs.country==="mexico"){n="venta"}GlobalRedirector.go({zoneTitle:translate("editingAction",true)+" "+n});var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];Ext.each(r,function(G){if(G.getForm){var C=G.getForm().getValues();if(C.idLocal==="old"){C.idLocal=C.oldId}else{delete C.itemName}if(C.idTax==="old"){var E=G.down("combo[name=idTax]");var F=E.actualTax;if(F.get("currentId")){C.idTax=F.get("currentId");C.taxName=F.get("name");C.tax=F.get("tax")}else{delete C.idTax}C.taxName=F.get("name");C.tax=F.get("tax")}else{if(!C.idTax||C.idTax==0){delete C.idTax}}if(!G.configs){G.configs=e.configs}G.configs.country=e.configs.country;var D=G.getFieldValuesAsMetadata();if(D){C.metadata=Ext.encode(D)}delete C.oldId;B.push(C)}});var v=a.status;var z=Ext.ComponentQuery.query("invoice_BottomContainer")[0];var l=e.getValues();var b=z.down("[name=anotation]");var g=z.down("[name=termsConditions]");var t=z.down("textarea[name=resolutionPie]");l.anotation=b.getValue();l.termsConditions=g.getValue();l.resolution=t?t.getValue():"";if(l.idClient==="old"){l.idClient=l.oldIdClient}else{delete l.oldClientName;delete l.oldIdClient}if(e.configs.country=="colombia"&&e.configs.isActiveElectronicInvoicing&&e.configs.electronicInvoicingVersion=="2.1"&&e.down("combo[name=paymentMethodCol]").getValue()=="CASH"){l.dueDate=Ext.Date.format(e.down("datefield[name=date]").getValue(),"d/m/Y")}delete l.days;l.items=Ext.encode(B);l.status=v;var u=Ext.ComponentQuery.query("invoice_FormAddAutoRetention");var d=[];Ext.each(u,function(D){var C=D.getValues();if(C.idAutoRetention&&C.amount){d.push(C)}});l.autoRetentions=Ext.encode(d);var h=Ext.ComponentQuery.query("invoice_FormAddRetentionSuggested");var s=[];Ext.each(h,function(E){var C=E.getValues();if(C.idRetention==="old"){var F=E.down("combo[name=idRetention]");var D=F.currentRetention;if(D.get("currentId")){C.idRetention=D.get("currentId");C.name=D.get("name");C.percentage=D.get("percentage")}else{delete C.idRetention}C.name=D.get("name");C.percentage=D.get("percentage")}if(C.idRetention&&C.amount){s.push(C)}});var t=z.down("textarea[name=resolutionPie]");l.resolutionPieText=t?t.getValue():"";l.retentionsSuggested=Ext.encode(s);var k=Ext.ComponentQuery.query("invoice_FormAddRetention");var y=[];Ext.each(k,function(D){var C=D.getValues();if(C.idRetention&&C.amount){y.push(C)}});l.retentions=Ext.encode(y);var c=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var q=c.smGetSelectedRecord().data;l.idResolution=q.idLocal;var m=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];if(m){var p=m.getValues();l.observations=p.observations;l.idSeller=p.idSeller;l.idPriceList=p.idPriceList;l.idInvoiceTemplate=p.idInvoiceTemplate}var A=e.down("hidden[name=exchangeCurrency]");if(A&&A.getValue()){l.exchangeRate=A.getValue()}var o=e.getFieldValuesAsMetadata();if(o){l.metadata=Ext.encode(o)}if(Ext.Array.contains(["chile"],e.configs.country)){var f=e.down("switch[name=documentTypeSwitch]");if(f&&f.getValue()=="saleTicket"){l.type=l.saleTicketType}}var x=function(){Ext.Ajax.request({url:"/invoice/edit/format/json",method:"POST",timeout:120000,params:l,success:function(C,E){var F=Ext.decode(C.responseText);if(F.success){var D=F.results;if(window.history.replaceState){window.history.replaceState("","",D)}window.location="/invoice/view/id/"+D}else{a.enable();GlobalRedirector.close()}},failure:function(){a.enable();GlobalRedirector.close()}})};if(!this.validateCostCenter(e,l)){a.enable();GlobalRedirector.close();this.showMessageCostCenterError(e,a);return}if(this.updateTotal().total===0){Ext.Msg.show({title:"Advertencia",msg:"El total de esta factura es cero, si la guardas no podrá ser editada. ¿Deseas continuar?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.WARNING,fn:function(C){if(C==="ok"){x()}else{a.enable()}}})}else{x()}}else{GlobalMsg.showErrorMessage("Error")}},getContact:function(z,s,d){var f=s[0];var p=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(p){var l=f.getData();var t=Ext.ComponentQuery.query("combo[name=currency]")[0];var u=t.getSelectedRecord();var x=Ext.ComponentQuery.query("advance_Panel")[0];if(x){x.destroy()}if(u&&u.get("code")){var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var g=c&&c.currencySign?c.currencySign:null;var h={code:u.get("code"),symbol:g};p.setClient(l);p.setCurrency(h)}else{p.setClient(l,true)}var e=z.up("form");if(e.configs){var a=function(){Ext.Ajax.request({url:"/invoice/retrieve-all-invoices-that-need-replacement/idClient/"+l.idLocal+"/format/json",success:function(B,C){var D=Ext.decode(B.responseText);var F=D.invoices;if(F.length>0){replacementMsg="Estas son las facturas del cliente pendientes por sustitución. Haz clic sobre la que desees reemplazar: <br> ";for(i=0;i<F.length;i++){if(F[i].prefix){replacementMsg+='<li> <a href="/invoice/add/idInvoice/'+F[i].idLocal+'/replace/true">'+translate("invoice",true)+" "+F[i].prefix+F[i].number+"</a> </li> "}else{replacementMsg+='<li> <a href="/invoice/add/idInvoice/'+F[i].idLocal+'/replace/true">'+translate("invoice",true)+" "+F[i].number+"</a> </li> "}}var A=Ext.get("display-invoice-replacement-window");A.addListener("click",function(){Ext.Msg.show({title:"Sustitución",icon:Ext.Msg.QUESTION,msg:replacementMsg,buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})});var E=document.getElementsByClassName("need-replacement-hint")[0];E.style.display="inline"}else{var E=document.getElementsByClassName("need-replacement-hint")[0];E.style.display="none"}},failure:function(){}})};switch(e.configs.country){case"mexico":if(e.configs.stampVersion=="3.3"){var q=Ext.ComponentQuery.query("combo[name=paymentType]")[0];if(q.getValue()=="PPD"){p.hideButtonForAdvances()}else{p.showButtonForAdvances()}a()}break;case"costaRica":a();break}}}var r=Ext.ComponentQuery.query("combo[name=days]")[0];if(r&&(!this.isValidValue(r.getValue())||f.get("idTerm"))){this.loadTermStore(r,null,f.get("idTerm"))}var b=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];if(b&&!this.isChangedIdPriceList){var k=b.getStore();if(f.get("idPriceList")){var w=function(){var B=k.findRecord("idLocal",f.get("idPriceList"));if(B){b.select(B)}else{var A=k.findRecord("main","yes");b.select(A)}};if(!k.hasLoaded()){k.load()}else{w()}k.on("load",w)}else{var n=k.findRecord("main","yes");b.select(n)}}var v=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(v&&!this.isChangedIdSeller){this.loadSellerStore(v,f.get("idSeller"))}this.updateRemissionContainer(z);var e=z.up("form");var y=e.down("[name=clientIdentification]");var m=e.down("[name=clientPhone]");var j=f.get("identification");y.setValue(j);m.setValue(f.get("phone1"));if(e.configs.stampVersion=="3.3"){var o=Ext.ComponentQuery.query("combo[name=cfdiUse]")[0];if(o&&!this.isValidValue(o.getValue())){if(f.getData().identification.length==12){Ext.getStore("CFDIUseList").filter("personType","both");if(f.getData().cfdiUse&&f.getData().cfdiUse[0]!="D"){o.setValue(f.getData().cfdiUse)}}else{Ext.getStore("CFDIUseList").clearFilter();o.setValue(f.getData().cfdiUse)}}}},updateRemissionContainer:function(n,h){var j=this;if(!n){n=Ext.ComponentQuery.query("combo[name=idClient]")[0]}if(!h){h=Ext.ComponentQuery.query("container[name=remissionContainer]")[0]}if(h){h.removeAll();var o=Ext.create("AL.view.remission.RemissionForInvoice");var d=Ext.ComponentQuery.query("combo[name=currency]")[0];var l=d.getSelectedRecord();var b="";if(l&&l.get("code")){b=l.get("code")}var k=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var f=k.getSelectedRecord();var c="";if(f&&f.get("idLocal")){c=f.get("idLocal")}var e=Ext.ComponentQuery.query("combo[name=idWarehouse]")[0];var m=e.getStore();if(!m.hasLoaded()){m.on("load",function(){var q=e.getSelectedRecord();var p="";if(q&&q.get("idLocal")){p=q.get("idLocal")}else{q=m.findRecord("isMain","yes");p=q.get("idLocal")}j.setRemissionProxy(o,n,b,p,c)})}else{var a=e.getSelectedRecord();var g="";if(a&&a.get("idLocal")){g=a.get("idLocal")}else{a=m.findRecord("isMain","yes");g=a.get("idLocal")}this.setRemissionProxy(o,n,b,g,c)}}},setRemissionProxy:function(g,j,a,f,b,c){var h=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(!c){var d=g.down("remission_ComboRemissions");if(d){c=d.getStore()}}if(c&&j.getValue()){filterBySaleConcept="";if(h&&h.configs.country==="argentina"){var e=h.down("combo[name=saleConcept]");filterBySaleConcept=e.getValue()?"/saleConcept/"+e.getValue():""}c.getProxy().url="/remission/retrieve-all-open-by-client/format/json/idClient/"+j.getValue()+"/currency/"+a+"/idWarehouse/"+f+"/idPriceList/"+b+"/deletable/false/editable/false/voidable/false"+filterBySaleConcept;c.proxy.timeout=1200000;c.load()}},changeDueDateFromDate:function(f,n,d,h){var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();var a=Ext.ComponentQuery.query("combo[name=days]")[0].getValue();if(a!=0){var e=Ext.ComponentQuery.query("combo[name=days]")[0].findRecordByValue(a);if(e){var o=parseInt(e.get("days"));var b=Ext.Date.add(n,Ext.Date.DAY,o);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(b,"d/m/Y"))}}var k=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(k.configs.country==="mexico"){var j=k.down("switch[name=documentTypeSwitch]");if(j&&j.getOptionSelected()&&j.getOptionSelected().value==="saleTicket"){Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(n,"d/m/Y"))}}if(k.configs.country=="colombia"&&k.configs.isActiveElectronicInvoicing&&k.configs.electronicInvoicingVersion=="2.1"&&k.down("combo[name=paymentMethodCol]").getValue()=="CASH"){Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(n,"d/m/Y"))}var g=Ext.ComponentQuery.query("advance_FormPanel");if(g){Ext.each(g,function(p){p.changeMinDateField(p,n)})}var m=Ext.ComponentQuery.query("datefield[name=endDateService]")[0];var l=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(!m||(m&&(m.getValue()==""||n>m.getValue()))){l.setMinValue(n)}},changeTerms:function(){var a=Ext.ComponentQuery.query("combo[name=days]")[0].getValue();if(a!=0){var b=Ext.ComponentQuery.query("combo[name=days]")[0];b.select(0)}},changeDueDateFromDays:function(a){if(!a){return}var c=Ext.ComponentQuery.query("datefield[name=date]")[0].getValue();if(a.get("idLocal")){var f=parseInt(a.get("days"));var b=Ext.Date.add(c,Ext.Date.DAY,f);Ext.ComponentQuery.query("datefield[name=dueDate]")[0].setRawValue(Ext.Date.format(b,"d/m/Y"))}var d=Ext.ComponentQuery.query("datefield[name=endDateService]")[0];var e=Ext.ComponentQuery.query("datefield[name=dueDate]")[0];if(!d||(d&&(d.getValue()==""||c>d.getValue()))){e.setMinValue(c)}},initialize:function(b){var A=this;var t=b.down("combo[name=days]");t.getStore().load({callback:function(){var D=t.getStore().findRecord("days",0);if(D){t.select(D)}}});var z=b.down("combo[name=currency]");var d=z.getStore();d.load({callback:function(){var D=Ext.create("AL.model.CompanyCurrency",{name:b.configs.nameCurrency,code:b.configs.currency,exchangeRate:1});d.add(D);if(!b.currencySelected){z.select(D)}}});var y=Ext.ComponentQuery.query("combo[name=idSeller]")[0];if(y){var f=y.getStore();f.load({callback:function(){var D=y.findRecord("idLocal",null);if(!D){D=Ext.create("AL.model.Seller",{name:translate("anySeller",true),idLocal:null});f.add(D)}}})}var j=b.down("textarea[name=substitutionCause]");j.allowBlank=true;if(b.configs.replace==true&&b.configs.country==="costaRica"){j.allowBlank=false;j.show()}var w=Ext.get("addOtherItem");w.on("click",function(){this.addItemForm();var G=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var F=Ext.ComponentQuery.query("invoice_FormAddItem");var E=translate("invoice");if(G.configs&&(G.configs.country==="mexico"||G.configs.country==="peru")){var D=G.down("switch[name=documentTypeSwitch]");if(D&&D.getOptionSelected().value==="saleTicket"){E=translate("saleTicket")}}if(F.length===200){Ext.Msg.show({title:"Límite de "+translate("items")+" alcanzado",msg:"Al agregar más "+translate("items")+" no podrás imprimir o descargar la "+E+".",buttons:Ext.Msg.OK,buttonText:{ok:"Entendido"},icon:Ext.Msg.INFO})}},this);var g=Ext.get("addOtherAutoRetention");if(g){g.on("click",this.addOtherAutoRetention,this)}var C=Ext.get("addOtherRetentionSuggested");if(C){C.on("click",this.addOtherRetentionSuggested,this)}if(!b.configs.showWarehouses){b.down("combo[name=idWarehouse]").hide()}var k=Ext.get("addOtherRetention");k.on("click",this.addOtherRetention,this);var u=b.down("combo[name=type]");u.allowBlank=true;if(b.configs&&b.configs.isActiveElectronicInvoicing&&b.isAvailableTypeField()){u.allowBlank=false}var q=Ext.getStore("ResolutionsCombo");if(b.configs&&b.configs.country==="peru"){var l=b.down("switch[name=documentTypeSwitch]");if(l){l.show();var x=q.getProxy();if(b.documentType){var r=l.findOptionById(b.documentType);if(r){l.select(r);A.tooltipDocumentType(l,r)}}var c=l.getOptionSelected();if(x.extraParams){x.extraParams.documentType=c.value}else{x.extraParams={documentType:c.value}}A.tooltipDocumentType(l,c);var h=b.down("combo[name=operationType]");var s=h.getStore();var B=s.getProxy();if(!B.filters||!B.filters.documentType||(B.filters.documentType&&B.filters.documentType!==c.value)){if(B.filters){B.filters.documentType=c.value}else{B.filters={documentType:c.value}}B.url="/country-legal-info/retrieve-parameters-by-key/key/operationTypes/format/json?filters="+Ext.encode(B.filters);s.load({callback:function(D){record=s.findRecord("value","Venta interna");if(record){h.setValue(record.data.key);if(b.configs&&b.configs.ublVersion!=="2.1"){h.setDisabled(true)}}}})}}}else{if(b.configs&&["mexico","costaRica","chile"].indexOf(b.configs.country)!==-1&&b.configs.saleTicketResolution&&b.type!="xml"&&!b.idEstimate&&!b.idInvoice&&!b.idRemission){var l=b.down("switch[name=documentTypeSwitch]");if(l){l.show();var x=q.getProxy();if(b.documentType){var r=l.findOptionById(b.documentType);if(r){l.select(r)}}var c=l.getOptionSelected();if(x.extraParams){x.extraParams.documentType=c.value}else{x.extraParams={documentType:c.value}}}}}q.load();var n=Ext.get("advancedOptionsLink");if(n){n.on("click",function(D){D.preventDefault();A.showAdvancedOptions()})}var p=Ext.get("remissionsLink");if(p){p.on("click",function(D){D.preventDefault();A.showRemissionsForm()})}if(b.type==="edit"||b.idEstimate||b.idInvoice||b.type=="xml"||b.idRemission){GlobalLoadMask.show("mask-items-loading");GlobalLoadMask.show("generalContainer")}if(b.type&&b.type==="edit"){Ext.Ajax.request({url:"/invoice/retrieve-info/id/"+b.idLocal+"/format/json",success:function(D,E){var F=Ext.decode(D.responseText);if(F.success){A.populateForm(b,F.results)}else{}},failure:function(){}})}else{if(b.idEstimate){Ext.Ajax.request({url:"/estimate/retrieve-info/id/"+b.idEstimate+"/format/json",success:function(D,E){var F=Ext.decode(D.responseText);if(F.success){if(b.configs&&b.configs.country==="peru"&&b.configs.companyRegime==="NEW_RUS"){F.results.estimate.resolutionDocumentType="saleTicket"}A.populateForm(b,F.results)}},failure:function(){}});this.setTermsConditionsAndAnotation()}else{if(b.idInvoice){Ext.Ajax.request({url:"/invoice/retrieve-info/id/"+b.idInvoice+"/format/json",success:function(D,E){var F=Ext.decode(D.responseText);if(F.success){A.populateForm(b,F.results)}},failure:function(){}})}else{if(b.idRemission){Ext.Ajax.request({url:"/remission/retrieve-info/id/"+b.idRemission+"/format/json",success:function(D,F){var G=Ext.decode(D.responseText);if(G.success){var E={};E.invoice=G.results.remission;E.invoice.itemsRemission=G.results.items;if(b.configs&&b.configs.country==="peru"&&b.configs.companyRegime==="NEW_RUS"){E.invoice.resolutionDocumentType="saleTicket"}A.populateForm(b,E)}},failure:function(){}});this.setTermsConditionsAndAnotation()}else{this.setTermsConditionsAndAnotation();if(b.type=="xml"){var e=b.idXml;Ext.Ajax.request({url:"/invoice/retrieve-info-from-xml/format/json",method:"POST",params:{idXml:e},success:function(D){var N=Ext.decode(D.responseText);if(N.success){var S=N.results;var G=S.client;var Y=b.down("combo[name=idClient]");if(G.idLocal){var X=b.down("[name=clientIdentification]");var P=b.down("[name=clientPhone]");var L=Y.getStore();var G=Ext.create("AL.model.Client",{idLocal:G.idLocal,name:G.name,identification:G.identification,phone1:G.phone1,});L.add(G);Y.select(G);var J=G.get("identification");if(J){J+=(b.configs&&b.configs.country==="colombia"&&!Ext.isEmpty(G.get("co_dv")))?"-"+G.get("co_dv"):""}X.setValue(J);P.setValue(G.get("phone1"))}else{b.client={name:G.name,identification:G.identification,address:G.address}}if(S.errors.length>0){var aa=Ext.create("Ext.panel.Panel",{renderTo:"errorsXmlInvoice",id:"xmlErrors",cls:"xml-errors",frame:false,border:false,bodyPadding:10,bodyStyle:"background: transparent;",margin:"10 0 10 0",width:500});Ext.each(S.errors,function(ac){aa.add({xtype:"displayfield",value:ac.text})});var T=Ext.get("createOtherContactXml");if(T){var ab={link:T,combo:Y};A.application.fireEvent("setNewClientEvent",ab)}}var I=b.down("datefield[name=date]");I.setValue(S.invoiceInfo.date);if(S.invoiceInfo.currency&&S.invoiceInfo.exchangeRate){var U=b.down("combo[name=currency]");var F=U.getStore();var W=F.findRecord("code",S.invoiceInfo.currency);if(W){W.set("exchangeRate",Ext.util.Format.round(S.invoiceInfo.exchangeRate,8));U.select(W)}}var E=S.items.length;var M=1;GlobalLoadMask.hide("generalContainer");var O=Ext.ComponentQuery.query("#addItemPanel")[0];if(S.cfdiUse){var R=b.down("combo[name=cfdiUse]");R.setValue(S.cfdiUse)}var Q=b.down("combo[name=paymentType]");Q.setValue(S.invoiceInfo.paymentType);var H=b.down("combo[name=paymentMethod]");H.setValue(S.invoiceInfo.paymentMethod);var K=b.configs.canCreateNewTax;var Z=b.configs.canCreateNewWarehouse;var V=b.configs.canCreateNewItem;Ext.each(S.items,function(al){var ac=Ext.create("AL.view.invoice.FormAddItem",{type:"xml",itemSold:al,canCreateNewTax:K,canCreateNewWarehouse:Z,canCreateNewItem:V,fromXml:true,});var ai=ac.down("combo[name=idLocal]");var ad=ac.down("textfield[name=importRequest]");var am=ac.down("displayfield[name=mxXmlItemName]");var af=ac.down("textarea[name=description]");var ag=ac.down("button[action=deleteItem]");ai.width=170;ad.width=170;af.width=100;ag.hidden=true;am.hidden=false;am.setValue(al.name);ac.enableFields();var ae=ac.down("textfield[name=quantity]");var aj=ac.down("textfield[name=price]");ae.suspendEvents();aj.suspendEvents();ae.setValue(al.quantity);aj.setValue(AL.math.approx(al.price,2));if(al.importRequest){ad.show();ad.enable();ad.setValue(al.importRequest)}var ah=[];if(al.taxes){Ext.each(al.taxes,function(an){ah.push(an.idLocal)})}var ak=ac.down("combo[name=idTax]").getStore();if(ak.hasLoaded()){ac.down("combo[name=idTax]").setValue(ah)}else{ak.on("load",function(){ac.down("combo[name=idTax]").setValue(ah)})}if(!ak.hasLoaded()&&!ak.isLoading()){ak.load()}O.add(ac);if(M==E){A.changeIdPriceList=true;b.callUpdateTotal=true;A.updateTotal();GlobalLoadMask.hide("mask-items-loading")}M++;ae.resumeEvents();aj.resumeEvents();A.updateItemTotal(aj,"no")});Ext.each(S.retentions,function(ad){var ae=Ext.widget("invoice_FormAddRetentionSuggested",{renderTo:"retentionsSuggestedAdd"});var ag=ae.down("combo[name=idRetention]");var af=ae.down("textfield[name=amount]");var ac=ag.getStore();if(!ac.hasLoaded()){ac.on("load",function(){ag.select(ad.idRetention);af.setValue(ad.amount)})}else{ag.select(ad.idRetention);af.setValue(ad.amount)}})}else{GlobalMsg.showErrorMessage("Error",N.cause)}},failure:function(){GlobalMsg.showErrorMessage("Error","Ha ocurrido un erro por favor inténtalo de nuevo más tarde")}})}}}}}var o=b.down("combo[name=paymentMethod]");if(b.configs.country=="costaRica"){if(o){o.hide()}}o=b.down("combo[name=paymentType]");if(b.configs.country=="mexico"){if(o){o.hide()}}if(b.configs.country=="chile"){if(b.documentType!="saleTicket"){var a=b.down("combo[name=idClient]");if(a){var m=new Ext.util.Filter({filterFn:function(D){return D.data.identification!="66666666-6"}});a.getStore().addFilter(m)}}}if(["mexico","peru","costaRica","chile"].indexOf(b.configs.country)!==-1||b.configs.companyRegime==="NEW_RUS"){b.down("[name=documentTypeSwitch]").hide()}if(b.configs.costCenter.isActive){var v=Ext.ComponentQuery.query("advancedfield[name=idCostCenterCustom]")[0];if(v){v.getComboElement().on("blur",function(E){var D=E.getSelectedRecord();if(!D&&E.getValue()!=""&&E.getValue()!=null){E.markInvalid(translate("costCenterErrorCombo",true))}})}}},addOtherAutoRetention:function(){var a=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];Ext.widget("invoice_FormAddAutoRetention",{renderTo:"autoRetentionsAdd",canCreateNewRetention:a.configs.canCreateNewRetention})},addOtherRetention:function(){var a=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];Ext.widget("invoice_FormAddRetention",{renderTo:"retentionsAdd",canCreateNewRetention:a.configs.canCreateNewRetention,})},addOtherRetentionSuggested:function(){var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var f=e.decimalPrecision?e.decimalPrecision:e.configs.companyDecimalPrecision;var b={renderTo:"retentionsSuggestedAdd",canCreateNewRetention:e.configs.canCreateNewRetention,suggested:e.configs.country!=="mexico"};if(e.configs.country==="colombia"){b.allowBase=true;b.width=1220}var a=Ext.widget("invoice_FormAddRetentionSuggested",b);if(b.allowBase&&b.allowBase===true){var c=this.updateTotal();var d=a.down("[name=base]");d.setValue(AL.math.approx(c.subTotal,null,f))}},addItemForm:function(){var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var a=Ext.ComponentQuery.query("#addItemPanel")[0];var b=Ext.create("AL.view.invoice.FormAddItem",{itemCount:++this.itemCount,canCreateNewTax:c.configs.canCreateNewTax,canCreateNewWarehouse:c.configs.canCreateNewWarehouse,canCreateNewItem:c.configs.canCreateNewItem,multipleTaxes:c.configs.multipleTaxes});if(c.type=="xml"){b.down("combo[name=idLocal]").width=170;b.down("textfield[name=importRequest]").width=170;b.down("displayfield[name=mxXmlItemName]").hidden=false;b.down("displayfield[name=mxXmlItemName]").width=176;b.down("textarea[name=description]").width=100}a.add(b);this.changeStoreItemsToSaleConcept(b)},checkQuantity:function(c){var m=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var k="La cantidad vendida es mayor a la disponible en el "+translate("inventory"),n="El "+translate("item")+" ",d=" ha alcanzado la cantidad mínima configurada. Te recomendamos comprar este producto.";var j=c.getSelectedRecord(),o=function(q){GlobalMsg.showNotification({type:"warning",title:"Advertencia",text:q})},b=c.up("form"),l=b.down("combo[name=idLocal]"),f=b.down("numberfield[name=quantity]"),e=f.getValue(),a=m&&m.type=="edit";if(j&&j.get("isInventariable")=="yes"){if(j&&j.get("availableQuantity")){var h=AL.math.sub(j.get("availableQuantity"),j.get("quantityRemissioned"));var g=j.get("minQuantity");if(b.type==="edit"){if(!e){e=parseFloat(j.get("quantity"))}if(e&&l){var p=a?AL.math.sub(e,parseFloat(j.get("quantity"))):e}else{var p=parseFloat(j.get("quantity"))}if(AL.math.comp(p,h)>0){o(k)}else{if(g!==null&&AL.math.comp(g,AL.math.sub(h,p))>=0){o(n+j.get("name")+d)}}}else{if(h===0||(e&&AL.math.comp(e,h)>0)){o(k)}else{if(e&&g!==null&&AL.math.comp(g,AL.math.sub(h,e))>=0){o(n+j.get("name")+d)}}}}else{if(j&&j.get("availableQuantity")==0&&e){o(k)}}}},getItem:function(d,e,j,k){var h=e[0];var m=this;var c=d.up("form");var p=c.down("textfield[name=price]");var q=c.down("textfield[name=reference]");var a=c.down("textarea[name=description]");var g=c.down("numberfield[name=quantity]");var r=c.down("textfield[name=discount]");var b=c.down("textfield[name=idTax]");g.suspendEvents();r.suspendEvents();p.suspendEvents();b.suspendEvents();q.setValue(h.get("reference"));a.setValue(h.get("description"));var o=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var n=function(){if(o.configs.country==="chile"&&(!h.get("idTax")||h.get("idTax")=="null")){var t=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];if(t.smGetSelectedRecord()&&t.smGetSelectedRecord().data.metadata.isElectronicResolution==true&&(t.smGetSelectedRecord().data.metadata.subDocumentType==""||!t.smGetSelectedRecord().data.metadata.subDocumentType)){return b.select("1")}}if(!h.get("idTax")||h.get("idTax")=="null"){return b.select(0)}var v=function(x){var w=Ext.create("AL.model.Tax",{idLocal:"old",tax:x.tax,name:x.taxName});w.set("currentId",x.idTax);b.actualTax=w;b.select(w)};var u=[];var s=h.get("taxes");Ext.each(s,function(w){if(w.status==="inactive"){if(o.type&&o.type==="edit"&&c.type!=="remission"&&c.itemSold&&c.itemSold.idTax==h.get("idTax")){v(w)}else{if(o.type&&o.type==="edit"&&c.type==="remission"){var x=Ext.ComponentQuery.query("remission_RemissionForInvoice")[0];if(x.type==="edit"){v(w)}else{b.select(0)}}else{b.select(0)}}}else{u.push(w.id)}});if(u.length>0){b.setValue(u)}if(o.configs.country==="chile"){var t=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];if(t.smGetSelectedRecord()&&t.smGetSelectedRecord().data.metadata.isElectronicResolution==true&&Ext.Array.contains(["EXEMPT_INVOICE","EXEMPT_SALE_TICKET"],t.smGetSelectedRecord().data.metadata.subDocumentType)){b.setValue(0)}else{b.setValue("1")}}};if(b.getStore().isLoading()){b.getStore().on("load",n)}else{n()}if(c.type!="xml"&&c.type!="remission"){g.setValue(1);this.getPrice(h,p)}if(o.configs.country==="mexico"){var l=o.down("switch[name=documentTypeSwitch]");var f=c.down("textfield[name=importRequest]");if(l&&l.getOptionSelected()&&l.getOptionSelected().value=="invoice"&&h.get("canUseImportRequest")&&h.get("canUseImportRequest")==="yes"){f.show();f.enable()}else{f.hide();f.disable()}}g.resumeEvents();p.resumeEvents();r.resumeEvents();b.resumeEvents();m.updateItemTotal(p);d.up("form").enableFields()},getPrice:function(c,k,e){var f=c.get("priceList");var d=c.get("price");var h=Ext.ComponentQuery.query("combo[name=idPriceList]")[0];var g=Ext.ComponentQuery.query("hidden[name=exchangeCurrency]")[0];var j=g.up("form"),a=j.down("combo[name=currency]");var b=(j.idEstimate&&j.invoice.currencyCode==a.getValue()?j.invoice.exchangeRate:g.getValue());if(e=="no"){if(b){d=AL.math.approx(AL.math.div(d,b),null,j.decimalPrecision)}else{d=AL.math.approx(d,null,j.decimalPrecision)}k.setValue(d)}else{if(!f&&h){Ext.Ajax.request({url:"/item/retrieve-price-list/format/json/id/"+c.get("idLocal"),success:function(l,n){var o=Ext.decode(l.responseText);var m=o.results;var p=m;c.set("priceList",p);if(p[h.getValue()]){d=p[h.getValue()];if(b){d=AL.math.approx(AL.math.div(d,b),null,j.decimalPrecision)}else{d=AL.math.approx(d,null,j.decimalPrecision)}k.setValue(d)}else{if(b){d=AL.math.approx(AL.math.div(d,b),null,j.decimalPrecision)}else{d=AL.math.approx(d,null,j.decimalPrecision)}k.setValue(d)}}})}else{if(h&&f[h.getValue()]){d=f[h.getValue()];if(b){d=AL.math.approx(AL.math.div(d,b),null,j.decimalPrecision)}else{d=AL.math.approx(d,null,j.decimalPrecision)}k.setValue(d)}else{if(b){d=AL.math.approx(AL.math.div(d,b),null,j.decimalPrecision)}else{d=AL.math.approx(d,null,j.decimalPrecision)}k.setValue(d)}}}},updateTotal:function(){var l=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var g=l&&!l.type?true:l.callUpdateTotal==true;if(!g){return}var f={};var o=Ext.ComponentQuery.query("invoice_FormAddItem");var d=0;var m=0;var e=0;var k=0;var n=0;var h=1;var j=false;var c="";if(l&&l.configs.multicurrency=="yes"){var b=l.down("combo[name=currency]");if(b.getValue()&&l.configs.currency!=b.getValue()){c=b.getValue();j=true;h=l.down("hidden[name=exchangeCurrency]").getValue()}}var g=true;Ext.each(o,function(q){var r=q.down("textfield[name=discount]").isValid();if(r==false){g=false}});if(g){Ext.each(o,function(B){var z=B.down("combo[name=idTax]");var C=B.down("textfield[name=price]");var u=B.down("numberfield[name=quantity]");var E=B.down("textfield[name=discount]");var y=null;var A=typeof(z.getValue())=="string"?[z.getValue()]:z.getValue();var D=AL.math.approx(C.getValue(),null,l.decimalPrecision);var t=AL.math.approx(AL.math.mul(D,h),null,l.decimalPrecision);var v=u.getValue()?u.getValue():0;if(l.type&&l.type==="edit"){if(z.getValue()==="old"){y=z.actualTax}}if(z.getValue()||z.findRecordByValue(z.getValue())){var s;var r;var q;if(E.getValue()){s=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(D,AL.math.sub(1,AL.math.div(E.getValue(),100))),null,l.decimalPrecision),v),null,l.decimalPrecision);r=AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(t,AL.math.sub(1,AL.math.div(E.getValue(),100))),null,l.decimalPrecision),v),null,l.decimalPrecision);q=AL.math.approx(AL.math.mul(D,v),null,l.decimalPrecision)}else{s=AL.math.approx(AL.math.mul(D,v),null,l.decimalPrecision);r=AL.math.approx(AL.math.mul(t,v),null,l.decimalPrecision);q=s}k=AL.math.add(k,q);d=AL.math.add(d,s);var x=0;var w=0;Ext.each(A,function(G){y=z.findRecordByValue(G);if(y){x=AL.math.add(x,AL.math.approx(AL.math.mul(s,AL.math.div(y.get("tax"),100)),null,l.decimalPrecision));w=AL.math.add(w,AL.math.approx(AL.math.mul(r,AL.math.div(y.get("tax"),100)),null,l.decimalPrecision));var F=y.get("name")+y.get("tax");if(f[F]){f[F].value=AL.math.add(f[F].value,AL.math.approx(AL.math.mul(s,AL.math.div(y.get("tax"),100)),null,l.decimalPrecision))}else{f[F]={label:y.get("name")+" ("+Ext.util.Format.round(y.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(s,AL.math.div(y.get("tax"),100)),null,l.decimalPrecision)}}}else{m=AL.math.add(m,s);n=AL.math.add(n,r)}});m=AL.math.add(m,AL.math.add(s,x));n=AL.math.add(n,AL.math.add(r,w))}});var p=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];var a=l&&l.currencySign?l.currencySign:null;if(p){p.removeAll();p.addItem({label:"Subtotal",value:AL.math.approx(k,null,l.decimalPrecision),important:true,cls:"price-row",decimalPrecision:l.decimalPrecision,currencySign:a});p.addItem({label:translate("discount",true),value:AL.math.approx(d-k),important:true,cls:"price-row",decimalPrecision:l.decimalPrecision,currencySign:a});p.addItem({label:"Subtotal",value:AL.math.approx(d,null,l.decimalPrecision),important:true,cls:"price-row",decimalPrecision:l.decimalPrecision,currencySign:a});Ext.Object.each(f,function(q,r){r.value=AL.math.approx(r.value,null,l.decimalPrecision);r.decimalPrecision=l.decimalPrecision;r.currencySign=a;r.cls="price-row";p.addItem(r)});p.addItem({label:"Total "+c,value:AL.math.approx(m,null,l.decimalPrecision),important:true,cls:"price-total",decimalPrecision:l.decimalPrecision,currencySign:a});if(j){p.addItem({label:"Total "+l.configs.currency,value:AL.math.approx(n,null,l.decimalPrecision),important:true,cls:"price-total",decimalPrecision:l.decimalPrecision})}}}else{var d=0,f=0,m=0}return{subTotal:d,taxes:f,total:m}},goInvoiceDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/invoice/view/id/"+h},convertInvoiceToOpen:function(f,k,h){var g=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0];var b=f.stampInvoice?f.stampInvoice:"yes";var c=function(){GlobalRedirector.go({zoneTitle:translate("checkingIn",true)});Ext.Ajax.request({url:"/invoice/convert-to-open/id/"+f.get("idLocal")+"/stampInvoice/"+b+"/format/json",success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){if(k){k(n.results)}}else{if(n.cause){GlobalMsg.showNotification({type:"error",title:"",text:n.cause,})}}GlobalRedirector.close()}})};var j=function(){var o=Ext.ComponentQuery.query("invoice_MoreActionsButton")[0];if(b==="yes"&&o&&["costaRica","peru","colombia"].indexOf(o.country)!==-1&&o.showModalInfoFe){var n="mensuales";switch(o.monthsCurrentMembership){case"3":n="trimestrales";break;case"6":n="semestrales";break;case"12":n="anuales";break}var m,l;switch(o.country){case"costaRica":m=(new Date()<new Date("2018-10-01")?"Disfruta de facturación electrónica sin costo hasta el 30 de septiembre. <br> Luego podrás emitir ":" Para continuar emitiendo comprobantes deberás activar facturación electrónica")+" por <strong>"+o.priceFeInCurrentMembership+"</strong> "+n+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";l=(new Date()<new Date("2018-10-01")?"Disfrutala sin costo hasta el 30 de septiembre. <br> ":"")+"Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"peru":m="Para continuar emitiendo comprobantes deberás activar facturación electrónica por <strong>"+o.priceFeInCurrentMembership+"</strong> "+n+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";l="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break;case"colombia":m="Para continuar expidiendo comprobantes deberás activar facturación electrónica por <strong>"+o.priceFeInCurrentMembership+"</strong> "+n+" adicionales a tu plan. <br><br> ¿Deseas activarla en este momento?";l="Nos comunicaremos contigo para darte los detalles de tu próximo cobro.";break}Ext.Msg.show({title:"Incluir facturación electrónica",msg:m,buttons:Ext.MessageBox.YESNO,cls:"modal-info-fe",width:480,fn:function(p){GlobalRedirector.go({zoneTitle:"Actualizando membresía"});Ext.Ajax.request({url:"/membership/include-fe/value/"+p+"/format/json",success:function(q,r){GlobalRedirector.close();var s=Ext.decode(q.responseText);if(s.success&&p==="yes"){GlobalMsg.showNotification({type:"success",title:"Facturación electrónica incluida",text:l,});setTimeout(c,3000)}else{c()}}})}})}else{c()}};if(f.get("status")=="draft"&&h=="yes"){var e="emitirá";var a=Ext.ComponentQuery.query("client_GridInvoices")[0];var d=Ext.ComponentQuery.query("invoice_GridAll")[0];if((a&&a.country=="mexico")||(d&&d.country=="mexico")||(g&&g.country=="mexico")){e="timbrará"}Ext.Msg.show({msg:translate("yourInvoiceIsInStatusWhenYouPerformThisActionItWillBeIssuedAndConvertedToStatus",true,{willStamp:e})+" "+translate("areYouSureYouWantToPerformThisAction",true),buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.QUESTION,fn:function(l){if(l=="yes"){j()}}})}else{if(f.get("total")===0&&g===undefined){Ext.Msg.show({title:"Advertencia",msg:"El total de esta factura es cero, si la conviertes a abierta no podrá ser editada. ¿Deseas continuar?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.WARNING,fn:function(l){if(l==="ok"){j()}else{window.location.reload()}}})}else{if(f.get("status")=="void"){b="no"}j()}}},setRightClickEvent:function(c){var a=c.getView();var b=this.application;var d=this;a.on("itemcontextmenu",function(f,e,m,j,l,h){l.preventDefault();var g=[{text:translate("seeDetail",true),iconCls:"viewDetailIcon",action:"viewDetail",actionUrl:"/invoice/view/id/"+e.get("idLocal")},{text:translate("print",true),iconCls:"printIcon",action:"print",actionUrl:"/invoice/print/id/"+e.get("idLocal")}];if(e.get("status")==="draft"){var k=translate("bill",true);if(c.isActiveElectronicInvoicing){k+=(" "+translate("and")+" "+translate("stamp"))}g.push({text:k,iconCls:"convertOpenIcon",action:"convertToOpen",actionUrl:"/invoice/view/id/"+e.get("idLocal")})}if(e.get("status")==="draft"||e.get("status")==="open"){g.push({text:translate("addPayment",true),iconCls:"addPaymentIcon",action:"addPayment",actionUrl:"/transaction/in/number/"+e.get("idLocal")});g.push({text:translate("edit",true),iconCls:"editIcon",action:"edit",actionUrl:"/invoice/edit/id/"+e.get("idLocal")})}if(e.get("status")==="draft"){g.push({text:translate("remove",true),iconCls:"deleteIcon",action:"deleteInvoice",actionUrl:"/invoice/delete/id/"+e.get("idLocal")})}else{if(e.get("voidable")){g.push({text:translate("cancel",true),iconCls:"voidIcon",action:"voidInvoice",actionUrl:"/invoice/void/id/"+e.get("idLocal")})}}if((c.country==="mexico"&&e.get("documentType")!=="saleTicket")||(c.country!=="mexico")){g.push({text:translate("clone",true),iconCls:"icon-invoice",action:"clone",actionUrl:"/invoice/add/idInvoice/"+e.get("idLocal")})}Ext.create("Ext.menu.Menu",{width:134,margin:"0 0 10 0",record:e,listeners:{click:function(s,q,r,p){if(q.action==="convertToOpen"){if(e.get("status")==="draft"){var o=c.getStore();d.convertInvoiceToOpen(e,function(t){o.load()})}}else{if(q.action==="deleteInvoice"){if(e.get("status")==="draft"){b.fireEvent("deleteInvoice",{record:e,initiator:c})}else{Ext.MessageBox.alert("Error","")}}else{if(q.action==="voidInvoice"){if(e.get("voidable")){b.fireEvent("voidInvoice",{record:e,initiator:c,refreshVoidCauses:true})}else{Ext.MessageBox.alert("Error","")}}else{if(q.action==="edit"){window.location=q.actionUrl}else{if(q.action==="addPayment"){if(e.get("status")==="draft"){d.convertInvoiceToOpen(e,function(t){window.location="/transaction/in/number/"+t},"yes")}else{window.location="/transaction/in/number/"+e.get("idLocal")}}else{if(q.action==="print"){if(e.get("status")==="draft"){d.convertInvoiceToOpen(e,function(u){var t=c.getStore();t.load();Ext.create("AL.view.invoice.WindowPrint",{idLocal:u})},"yes")}else{var n=window.open("/invoice/print/id/"+e.get("idLocal"));n.print()}}else{if(q.action==="viewDetail"){window.location=q.actionUrl}else{if(q.action==="clone"){if(e.get("warehouse").status=="inactive"){GlobalMsg.showNotification({title:"Error",text:translate("theInvoice",true)+" "+translate("invoice")+" no se puede clonar ya que "+translate("theWarehouse")+" "+translate("warehouse")+" asociada está inactiva",type:"error"})}else{window.location=q.actionUrl}}}}}}}}}}},items:g}).showAt(l.getXY())})},updateItemTotal:function(h,e){if(e!="no"){e="yes"}var b=h.up("form");var j=b.down("textfield[name=price]");var g=b.down("displayfield[name=total]");var c=b.down("numberfield[name=quantity]");var l=b.down("textfield[name=discount]");var f=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var a=f.currencySign?f.currencySign:null;if(j.isValid()&&c.isValid()&&l.isValid()){var d=AL.math.sub(1,AL.math.div(l.getValue(),100));var k=AL.math.approx(j.getValue(),null,f.decimalPrecision);g.setValue(Ext.util.Format.usMoney(AL.math.approx(AL.math.mul(AL.math.approx(AL.math.mul(k,d),null,f.decimalPrecision),c.getValue()),null,f.decimalPrecision),f.decimalPrecision,a))}else{e="no"}if(e=="yes"){this.updateTotal()}},validateRetentionForms:function(){var b=Ext.ComponentQuery.query("invoice_FormAddRetention");var a=true;Ext.each(b,function(c){if(!c.getForm().isValid()){a=false}});return a},showCompanyEditWindow:function(a,c,b){this.application.fireEvent("editCompanyEvent",a,c,b)},validateForms:function(h){var p=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var k=Ext.ComponentQuery.query("invoice_FormAddItem");var e=Ext.ComponentQuery.query("advance_Panel")[0];var b=true;if(p.getForm().isValid()){var j=p.down("combo[name=idClient]");if(!j.getSelectedRecord()){b=false;j.markInvalid("Debes seleccionar el cliente, no solo escribir su "+translate("name",true))}if(k.length===0){b=false}else{var m=0,d=false;resolutionIsElectronic=false;if(p.configs.country=="colombia"){d=p.configs.isActiveElectronicInvoicing;var l=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];resolutionIsElectronic=(l.smGetSelectedRecord()&&l.smGetSelectedRecord().data.isElectronicResolution==true)}Ext.each(k,function(q){var r=q.getForm();if(r.getValues().idLocal||q.fromXml){m++;if(!r.isValid()){b=false}else{var z=q.down("combo[name=idLocal]");if(!z.getSelectedRecord()){b=false;z.markInvalid("Debes seleccionar el ítem, no solo escribir su nombre");return false}var s=parseInt(p.configs.valueDiscountMax);if(d&&s==100){s=99}var v=q.down("textfield[name=discount]");if(p.configs.changeDiscount==="yes"){if(v.getValue()>s){b=false;v.markInvalid("El porcentaje de "+translate("discount")+" ingresado es mayor que el permitido.")}}if(resolutionIsElectronic){var w=q.down("combo[name=idTax]"),x=typeof(w.getValue())=="string"?[w.getValue()]:w.getValue();if(x.length>1){var y=q.down("combo[name=idTax]");y.markInvalid("No puedes agregar mas de un impuesto a los ítems de la factura");b=false}}if(h===true&&p.configs&&p.configs.isActiveElectronicInvoicing===true&&["peru","costaRica"].indexOf(p.configs.country)!==-1){var u="si deseas "+translate("stamp")+" "+translate("theInvoice")+" "+translate("invoice");var A=r.getValues()}}}if(p.getValues().type=="EXEMPT"){if(r.getValues().idTax!=0){var t=q.down("combo[name=idTax]");t.markInvalid("No puedes agregar impuesto a un ítem en facturas exentas");b=false}}});if(m===0){b=false;k[0].down("combo[name=idLocal]").markInvalid(translate("youMustAssociateAtLeastOneItemWith",true)+" "+translate("theInvoice")+" "+translate("invoice"))}if(e){var o=this.updateTotal().total;var a=Ext.ComponentQuery.query("invoice_FormAddRetentionSuggested");if(a){Ext.each(a,function(r){var q=r.getValues();o=AL.math.sub(o,q.amount)})}b=b&&e.validateAdvancesForm(o,a?true:false)}}}else{var n=Ext.ComponentQuery.query("[name=advancedFields]")[0];if(n){n.getForm().isValid()}b=false}if(p.configs.country==="costaRica"){if(p.configs.isActiveElectronicInvoicing){var c=Ext.ComponentQuery.query("combo[name=economicActivityCustom]")[0];if(!c.getSelectedRecord()){c.markInvalid("Selecciona una actividad de la lista");b=false}}}if(p.configs.costCenter.isActive){var f=Ext.ComponentQuery.query("advancedfield[name=idCostCenterCustom]")[0];if(f){var g=f.items.items[1];if(isNaN(g.getValue())){b=false}}}return b},populateForm:function(v,w){var b=null;if(v.type==="edit"){b=w.invoice;v.decimalPrecision=w.invoice.decimalPrecision}else{if(v.idEstimate){b=w.estimate;v.decimalPrecision=w.estimate.decimalPrecision}else{if(v.idInvoice){b=w.invoice}else{if(v.idRemission){b=w.invoice}}}}v.invoice=b;var ah=Ext.ComponentQuery.query("invoice_BottomContainer")[0];var x=w.items;var q=w.autoRetentions;var aa=w.retentionsSuggested;var j=w.retentions;var al=AL.date(b.date);al=Ext.Date.format(al,"d/m/Y");var V=AL.date(b.dueDate);V=Ext.Date.format(V,"d/m/Y");var u=v.down("combo[name=idClient]");var E=v.down("[name=resolutionDropdown]");var y=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var an=v.down("[name=clientIdentification]");var D=v.down("[name=clientPhone]");var I=v.down("datefield[name=date]");var aj=v.down("datefield[name=dueDate]");var d=ah.down("textarea[name=anotation]");var L=ah.down("textfield[name=termsConditions]");var l=v.down("combo[name=idWarehouse]");if(v.configs){switch(v.configs.country){case"republicaDominicana":if(v.type==="edit"){var X=Ext.get("retentionsContainer");X.applyStyles({display:"none"});var ai=Ext.get("viewRetentionsApplied");ai.applyStyles({display:"inline-block"})}else{if(w.invoice&&w.invoice.retentionsSupported&&w.invoice.retentionsSupported.length>0){var O=Ext.get("addOtherRetention");O.applyStyles({display:"none"})}}break;case"mexico":if(v.type==="edit"&&b.documentType=="saleTicket"){var X=Ext.get("retentionsContainer");X.applyStyles({display:"none"});var ai=Ext.get("viewRetentionsApplied");ai.applyStyles({display:"none"})}break;default:break}if(b.metadata){v.setFieldValuesFromMetadata(b.metadata)}}if(b.warehouse&&b.warehouse.idLocal){var H=l.getStore();if(!H.hasLoaded()&&!H.isLoading()){H.on("load",function(){var ao=Ext.create("AL.model.Warehouse",b.warehouse);H.add(ao);l.select(ao);if(v.idRemission){l.fireEvent("select")}})}else{var R=Ext.create("AL.model.Warehouse",b.warehouse);H.add(R);l.select(R);if(v.idRemission){l.fireEvent("select")}}}if(v.type&&v.type==="edit"){var G=v.down("textfield[name=number]");var U=v.down("textfield[name=prefix]");var e=v.down("hidden[name=idLocal]");var ac=v.down("combo[name=days]");U.setValue(b.prefix);G.setValue(b.number);e.setValue(b.idLocal);L.setValue(b.termsConditions);if(v.configs&&v.configs.country==="peru"){L.maxLength=70;L.maxLengthText="Puedes agregar máximo 70 caracteres, para poder emitir tus documentos."}if(ac){var f=this.calculateDiffBetweenDateAndDueDate(b.date,b.dueDate);this.loadTermStore(ac,f,null)}}if(v.type&&v.type==="edit"){aj.setRawValue(V);I.setRawValue(al);aj.setMinValue(V)}var r=u.getStore();var k=this;var C=true;r.on("load",function(ar,ao,au,aq){if(C){C=false;var at=Ext.ComponentQuery.query("container[name=remissionContainer]")[0];var ap=ar.findExact("idLocal",b.idClient);if(ap<0){Ext.Ajax.request({url:"/client/retrieve-one/id/"+b.idClient+"/format/json",success:function(aw,ay){var az=Ext.decode(aw.responseText);if(az.success){var ax=az.results;var av=Ext.create("AL.model.Client",ax);ar.add(av);u.select(av);var aA=av.get("identification");if(aA){aA+=(v.configs&&v.configs.country==="colombia"&&!Ext.isEmpty(av.get("co_dv")))?"-"+av.get("co_dv"):""}an.setValue(aA);D.setValue(av.get("phone1"));if(at&&(v.type=="edit"&&!v.idLocal||Ext.isEmpty(b.itemsRemission))){k.updateRemissionContainer(u,at)}}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}else{ar.findBy(function(av,ax){if(av.get("idLocal")==b.idClient){u.select(av);var aw=av.get("identification");if(aw){aw+=(v.configs&&v.configs.country==="colombia"&&!Ext.isEmpty(av.get("co_dv")))?"-"+av.get("co_dv"):""}an.setValue(aw);D.setValue(av.get("phone1"));if(at&&(v.type=="edit"&&!v.idLocal||Ext.isEmpty(b.itemsRemission))){k.updateRemissionContainer(u,at)}return true}return false})}}});r.load();var o=v.down("combo[name=paymentType]");if(o&&b.paymentType){o.setValue(b.paymentType)}if(b.resolutionDocumentType=="saleTicket"){var af=v.down("combo[name=saleTicketType]");if(b.type&&af){var B=af.getStore();if(B.hasLoaded()){af.setValue(b.type)}else{B.on("load",function(){af.setValue(b.type)})}}}else{var n=v.down("combo[name=type]");if(b.type&&n){var Z=n.getStore();if(Z.hasLoaded()){n.setValue(b.type)}else{Z.on("load",function(){n.setValue(b.type)})}}}if(v.configs.stampVersion=="3.3"){var ak=v.down("combo[name=cfdiUse]");if(b.identification&&b.identification.length==12){Ext.getStore("CFDIUseList").filter("personType","both");if(b.cfdiUse&&b.cfdiUse[0]!="D"){ak.setValue(b.cfdiUse)}}else{Ext.getStore("CFDIUseList").clearFilter();ak.setValue(b.cfdiUse)}if(b.cfdiUse){ak.setValue(b.cfdiUse)}else{if((v.idRemission||v.idEstimate)&&v.configs.country=="mexico"){Ext.Ajax.request({url:"/client/retrieve-one/id/"+b.idClient+"/format/json",success:function(ao,aq){var ar=Ext.decode(ao.responseText);if(ar.success){var ap=ar.results;ak.setValue(ap.cfdiUse)}else{Ext.MessageBox.alert("Error","Ha ocurrido un error cargando el cliente")}},failure:function(){}})}}}var Y=v.down("switch[name=documentTypeSwitch]");if(Y){var Q=b.resolutionDocumentType?b.resolutionDocumentType:"invoice";var P=Y.findOptionById(Q);if(P){Y.select(P)}this.tooltipDocumentType(Y,P);if(v.configs&&v.configs.country==="mexico"){Y.disable()}}var F=function(){if(v.idEstimate){var ao=W.findRecord("isDefault","yes");y.smSetValue(ao.data.idLocal)}else{if(v.idInvoice){var aq=W.findRecord("idLocal",b.resolutionIdLocal);if(!aq){aq=W.findRecord("isDefault","yes")}y.smSetValue(aq.data.idLocal)}else{if(b.resolutionIdLocal&&b.resolutionName){var ap=Ext.create("AL.model.Resolution",{idLocal:b.resolutionIdLocal,name:b.resolutionName,status:b.resolutionStatus,isElectronicResolution:b.isElectronicResolution});W.add(ap);y.smSyncWithStore();y.smSetValue(ap.data.idLocal);k.populationOldResolution(v,b);k.verifyResolutionInactive(v)}}}if(W.count()>1){E.show()}};var W=y.smGetStore();if(!W.hasLoaded()){var k=this;W.on("load",F)}else{F()}var N=this.application;if(v.configs.multicurrency=="yes"){var h=v.down("combo[name=currency]");var a=h.getStore();var g=function(){var aq=a.findRecord("code",v.configs.currency);if(!aq){aq=Ext.create("AL.model.CompanyCurrency",{name:v.configs.nameCurrency,code:v.configs.currency,exchangeRate:1});a.add(aq)}var at=null;if(b.currencyCode){at=a.findRecord("code",b.currencyCode);if(at){at.set("exchangeRate",b.exchangeRate)}else{at=Ext.create("AL.model.CompanyCurrency",{exchangeRate:b.exchangeRate,code:b.currencyCode,symbol:b.currencySymbol});if(at&&at.code){a.add(at)}}}if(!at){at=aq}h.select(at);if(v.idRemission&&b&&b.exchangeRate){var ap=v.down("displayfield[name=exchangeCurrencyDisplay]");var ao=v.down("hidden[name=exchangeCurrency]");ap.show();ap.setValue("1 "+at.get("code")+" = "+Ext.util.Format.round(b.exchangeRate,8)+" "+v.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/smile-icons.svg#edit"></use></svg></a></div>');ao.setValue(Ext.util.Format.round(b.exchangeRate,8));var ar=Ext.get("editExchangeRate");if(ar){ar.on("click",function(av){av.preventDefault();var au={};au.currency=at.get("code");au.initiator=ap;au.currencyRecord=at;N.fireEvent("editExchangeRate",au)})}}};if(a.hasLoaded()){g()}else{a.load({callback:function(){g()}})}}GlobalLoadMask.hide("generalContainer");var A=Ext.ComponentQuery.query("#addItemPanel")[0];var ab=1;var t=this;var p=[];var z=[];if(!b.itemsRemission){Ext.each(x,function(ao){if(!ao.idRemission){z.push(ao)}else{p.push(ao)}});b.itemsRemission=p}else{p=b.itemsRemission;GlobalLoadMask.hide("mask-items-loading")}var K=z.length;if(v.type&&v.type==="edit"){if(!x||!x.length){GlobalLoadMask.hide("mask-items-loading")}}var T=v.configs.canCreateNewTax;var c=v.configs.canCreateNewWarehouse;var ad=v.configs.canCreateNewItem;var s=v.configs.multipleTaxes!="yes"?"no":"yes";v.callUpdateTotal=K<=1;Ext.each(z,function(ao){var aq=Ext.create("AL.view.invoice.FormAddItem",{type:"edit",itemSold:ao,canCreateNewTax:T,canCreateNewWarehouse:c,canCreateNewItem:ad,multipleTaxes:s});var ap=aq.down("combo[name=idTax]");if(ab==K){ap.on("taxComboRendered",function(){t.changeIdPriceList=true;v.callUpdateTotal=true;t.updateTotal();GlobalLoadMask.hide("mask-items-loading")})}A.add(aq);ab++});var am=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];if(b.observations){t.showAdvancedOptions("edit",b);am.down("textarea[name=observations]").setValue(b.observations);var M=Ext.get("new-comment");if(M){M.dom.value=b.observations}}var S=am.down("textarea[name=resolutionText]");if(S){S.setValue(b.resolution)}var ah=Ext.ComponentQuery.query("invoice_BottomContainer")[0];var J=ah.down("textarea[name=resolutionPie]");if(J){J.setValue(b.resolution)}if(p.length>0){t.showRemissionsForm("edit",b);t.populateRemissionsForm();t.validateDatesServicesRemission(b)}if(!v.idEstimate&&!v.idRemission){d.setValue(b.anotation);L.setValue(b.termsConditions)}if(v.idEstimate||v.idRemission){var ac=v.down("combo[name=days]");if(ac){var f=this.calculateDiffBetweenDateAndDueDate(b.date,b.dueDate);this.loadTermStore(ac,f,null)}}Ext.each(q,function(at){var ap=Ext.widget("invoice_FormAddAutoRetention",{renderTo:"autoRetentionsAdd",canCreateNewRetention:v.configs.canCreateNewRetention});var ar=ap.down("combo[name=idAutoRetention]");var aq=ap.down("textfield[name=amount]");var ao=ar.getStore();if(!ao.hasLoaded()){ao.on("load",function(){ar.select(at.idLocal);aq.setValue(at.amount)})}else{ar.select(at.idLocal);aq.setValue(at.amount)}});Ext.each(aa,function(au){if(v.type!=="edit"&&au.status==="inactive"){return}var ap={renderTo:"retentionsSuggestedAdd",canCreateNewRetention:v.configs.canCreateNewRetention,suggested:v.configs.country!=="mexico"};if(v.configs.country==="colombia"){ap.allowBase=true;ap.width=1220}var ar=Ext.widget("invoice_FormAddRetentionSuggested",ap);if(ap.allowBase&&ap.allowBase===true){var aq=ar.down("[name=base]");aq.setValue(AL.math.approx(b.subTotal,null,b.decimalPrecision))}var aw=ar.down("combo[name=idRetention]");var av=ar.down("textfield[name=amount]");var ao=aw.getStore();var at=function(){if(v.type==="edit"&&au.status==="inactive"){var ax=Ext.create("AL.model.Retention",{idLocal:au.idRetention,percentage:au.percentage,name:au.name,calculatedBy:au.calculatedBy});ao.add(ax);aw.select(ax)}else{aw.select(au.idRetention)}av.setValue(au.amount)};if(!ao.hasLoaded()){ao.on("load",at)}else{at()}});if(b.canApplyRetentionsUponCreation&&v.configs&&v.configs.country==="republicaDominicana"){if(v.type==="edit"){if(w.invoice&&w.invoice.retentions&&w.invoice.retentions.length>0){var ai=Ext.get("viewRetentionsApplied");ai.applyStyles({display:"block"})}}else{Ext.each(j,function(ap){var aq=Ext.widget("invoice_FormAddRetention",{renderTo:"retentionsAdd",canCreateNewRetention:v.configs.canCreateNewRetention});var at=aq.down("combo[name=idRetention]");var ar=aq.down("textfield[name=amount]");var ao=at.getStore();if(!ao.hasLoaded()){ao.on("load",function(){at.select(ap.idRetention);ar.setValue(ap.amount)})}else{at.select(ap.idRetention);ar.setValue(ap.amount)}})}}if(v.configs.country==="mexico"&&b.paymentMethod){var m=v.down("combo[name=paymentMethod]");var ae=v.down("textfield[name=accountNumber]");m.select(b.paymentMethod);if(b.accountNumber){ae.setValue(b.accountNumber)}}if(v.configs.costCenter.isActive){var ag=v.down("combo[name=idCostCenter]");if(ag&&b.idCostCenter){storeCostCenter=ag.getStore();if(!storeCostCenter.hasLoaded()&&!storeCostCenter.isLoading()){this.loadCostCenterRecord(b.idCostCenter,ag)}else{var R=storeCostCenter.findRecord("idLocal",b.idCostCenter);if(!R){this.loadCostCenterRecord(b.idCostCenter,ag)}else{ag.select(R)}}}}t.populateAdvancedForm()},getTotalIva:function(){var a=Ext.ComponentQuery.query("invoice_FormAddItem");var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var b=0;Ext.each(a,function(h){var g=h.down("combo[name=idTax]");var j=h.down("textfield[name=price]");var e=h.down("numberfield[name=quantity]");var k=c.configs.multipleTaxes=="yes"?g.getValue():[g.getValue()];if(j.getValue()&&e.getValue()){var f=h.down("textfield[name=discount]");var l=f.getValue();var m=0;if(l>0){l=AL.math.sub(1,AL.math.div(f.getValue(),100));m=AL.math.approx(AL.math.mul(j.getValue(),l),c.decimalPrecision)}else{m=j.getValue()}var d=AL.math.approx(AL.math.mul(AL.math.approx(m,null,c.decimalPrecision),e.getValue(),c.decimalPrecision),c.decimalPrecision);if(k){Ext.each(k,function(o){var p=g.getStore();var n=p.findRecord("idLocal",o);if(n&&(n.get("idTaxReference")==1||n.get("idTaxReference")==4||n.get("idTaxReference")==8)){b=AL.math.add(b,AL.math.approx(AL.math.mul(d,AL.math.div(n.get("tax"),100),c.decimalPrecision),null,c.decimalPrecision),c.decimalPrecision)}})}}});return b},getSubtotalItemsWithIva:function(){var a=Ext.ComponentQuery.query("invoice_FormAddItem");var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var b=0;Ext.each(a,function(g){var f=g.down("combo[name=idTax]");var e=g.down("textfield[name=price]");var l=g.down("numberfield[name=quantity]");var d=c.configs.multipleTaxes=="yes"?f.getValue():[f.getValue()];var j=g.down("textfield[name=discount]");var k=j.getValue();if(e.getValue()&&l.getValue()){if(k>0){k=AL.math.div(k,100);var h=AL.math.approx(AL.math.mul(AL.math.approx(e.getValue(),null,c.decimalPrecision),l.getValue()));discountTotal=AL.math.approx(AL.math.mul(h,k));h=AL.math.approx(AL.math.sub(h,discountTotal))}else{var h=AL.math.approx(AL.math.mul(AL.math.approx(e.getValue(),null,c.decimalPrecision),l.getValue()))}if(d){Ext.each(d,function(n){var o=f.getStore();var m=o.findRecord("idLocal",n);if(m&&m.get("idTaxReference")==3&&m.get("tax")>0){b=AL.math.add(b,h)}})}}});return b},calculateRetentionSuggested:function(c,d,g,h){var a=c.up("form");var k=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var l=a.down("textfield[name=amount]");var e=d[0];var f=0;if(e.get("calculatedBy")!="percentage"){return}if(e.get("idRetentionReference")==1||e.get("idRetentionReference")==8||e.get("idRetentionReference")==25){f=this.getTotalIva()}else{if(e.get("idRetentionReference")==6){f=this.getSubtotalItemsWithIva()}else{var b=this.updateTotal();f=k.configs.country==="peru"?b.total:b.subTotal}}if(k.configs.country==="colombia"){var m=a.down("[name=base]");m.setValue(AL.math.approx(f,null,k.decimalPrecision))}var j=AL.math.approx(AL.math.mul(f,AL.math.div(e.get("percentage"),100)),null,k.decimalPrecision);l.setValue(j)},calculateRetention:function(c,d,g,h){var a=c.up("form");var m=a.down("textfield[name=amount]");var e=d[0];var k=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(e.get("calculatedBy")!="percentage"){return}if(k){var l=k?k.decimalPrecision:2;var f=0;if(e.get("idRetentionReference")==1||e.get("idRetentionReference")==8||e.get("idRetentionReference")==25){f=this.getTotalIva()}else{var b=this.updateTotal();f=b.subTotal}var j=AL.math.approx(AL.math.mul(f,AL.math.div(e.get("percentage"),100)),null,l);m.setValue(j)}},calculateAutoRetention:function(d,e,g,h){var f=e[0];var a=d.up("form");var l=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var c=this.updateTotal();var k=c.subTotal;var b=a.down("textfield[name=amount]");var j=AL.math.approx(AL.math.mul(k,AL.math.div(f.get("retention"),100)),null,l.decimalPrecision);b.setValue(j)},showAdvancedOptions:function(b,c){var a=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];if(a.hidden){a.show()}else{a.hide()}},showRemissionsForm:function(b,c){var a=Ext.ComponentQuery.query("invoice_FormAddRemissions")[0]},validateDifferentRemissions:function(f,b){var e=true;var a=Ext.ComponentQuery.query("invoice_FormAddInvoice combo[name=idWarehouse]")[0];if(f.getSelectedRecord()&&a){var c=f.getSelectedRecord();if(c.get("warehouse").idLocal!=a.getSelectedRecord().get("idLocal")){f.setValue(null);f.clearInvalid();f.markInvalid(translate("theAssociatedWarehouse",true)+" a la "+translate("remission")+" es diferente a "+translate("theAssociatedWarehouse")+" al documento");e=false}}var d=Ext.ComponentQuery.query("invoice_FormAddRemissions combo[name=idRemission]");Ext.each(d,function(g){if(g.getId()!=f.getId()){if(f.getValue()==g.getValue()){e=false;if(b){f.setValue(null);f.clearInvalid();f.markInvalid(translate("theRemission",true)+" "+translate("remission")+" ya ha sido seleccionada")}}}});return e},populateAdvancedForm:function(){var a=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];var k=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var e=k.invoice;var f=a.down("combo[name=idSeller]");this.loadSellerStore(f,e.idSeller);var m=Ext.ComponentQuery.query("advancedfield[name=idPriceListCustom]")[0];var h=a.down("combo[name=idPriceList]");var c=h.getStore();var d;if(!c.hasLoaded()){c.load()}else{if(e.idPriceList){d=c.findRecord("idLocal",e.idPriceList)}if(!d){d=c.findRecord("main","yes")}h.suspendEvents();if(m){m.getComboElement().select(d)}h.select(d);h.resumeEvents()}c.on("load",function(){if(e.idPriceList){d=c.findRecord("idLocal",e.idPriceList)}if(!d){d=c.findRecord("main","yes")}h.suspendEvents();if(m){m.getComboElement().select(d)}h.select(d);h.resumeEvents()});if(e.idInvoiceTemplate&&k.type&&k.type=="edit"){var b=a.down("combo[name=idInvoiceTemplate]");if(k.configs.country!="mexico"){b.show()}else{b.hide()}var l=b.getStore();if(e.documentType=="saleTicket"){var g=l.getProxy();g.setExtraParam("addUseInternal",true)}l.load();if(!l.hasLoaded()){l.on("load",function(n){var o=l.findRecord("id",e.idInvoiceTemplate);if(!o){o=l.findRecord("companysDefault",true)}b.select(o)})}else{var j=l.findRecord("id",e.idInvoiceTemplate);if(!j){j=l.findRecord("companysDefault",true)}b.select(j)}}},populateRemissionsForm:function(){var j=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0],a=j.invoice,g=this,b=a.itemsRemission;if(b.length>0){var f=Ext.ComponentQuery.query("remission_RemissionForInvoice")[0];if(f){f.destroy()}var d=[];if(!j.idRemission){var c=0;var h=null;Ext.each(b,function(l){if(h!=l.idRemission){h=l.idRemission;c++}var k=[];if(d[c]){k=d[c].items}else{d[c]={};d[c].remissionNumber=l.remissionNumber;d[c].idRemission=l.idRemission}k.push(l);d[c].items=k})}else{d[0]={items:b,idRemission:j.idRemission}}var e=Ext.ComponentQuery.query("invoice_FormAddRemissions")[0];Ext.each(d,function(t){if(t){var r=t.idRemission;var n=Ext.ComponentQuery.query("combo[name=currency]")[0];var s=n.getSelectedRecord();var k="";if(s&&s.get("code")){k=s.get("code")}var q=Ext.create("AL.view.remission.RemissionForInvoice",{type:!j.idRemission?"edit":null});e.insert(2,q);var l=q.down("combo[name=idRemission]");var m=l.getStore();if(m&&a.idClient){filterBySaleConcept="";if(j.configs.country==="argentina"){var o=j.down("combo[name=saleConcept]");filterBySaleConcept=o.getValue()?"/saleConcept/"+o.getValue():""}m.getProxy().url="/remission/retrieve-all-open-by-client/format/json/idClient/"+a.idClient+"/currency/"+k+"/idWarehouse/"+a.warehouse.idLocal+"/idPriceList/"+a.idPriceList+"/deletable/false/editable/false/voidable/false"+filterBySaleConcept;m.getProxy().timeout=1200000}if(j.type=="edit"){var p=Ext.create("AL.model.Remission",{idLocal:r,remissionNumber:t.remissionNumber,warehouse:{idLocal:a.warehouse.idLocal}});m.add(p);l.select(p)}if(j.type=="edit"){m.on("load",function(u){if(!l.getStore()){l.store=m}m.add(p);l.select(p)})}m.load({callback:function(){var v=m.findRecord("idLocal",r);if(v||j.type=="edit"){if(j.type!="edit"){if(!l.getStore()){l.store=m}m.add(v);l.select(v)}else{if(!v){v=Ext.create("AL.model.Remission",{idLocal:r,remissionNumber:t.remissionNumber})}m.add(v);l.select(v)}q.add({xtype:"container",name:"tableHeader",html:'<div id="headersTable" class="remission"><table><tr><td class="tbName"> '+translate("item",true)+'</td><td class="tbReference">'+translate("reference",true)+'</td><td class="tbPrice">Precio</td><td class="tbDiscount">'+translate("discountAbbreviature",true)+' %</td><td class="tbTax">Impuesto</td><td class="tbDescription">Descripción</td><td class="tbQuantity">Cantidad</td><td class="tbTotal">Total</td></tr></table></div>',style:"background: #eee; margin-top:12px; background:#F9FAFD;color:#00535E;padding-top:10px;font-weight:bold;border-bottom:2px solid rgba(0, 83, 94, 0.5); height:48px;     border-top: 2px solid white;",queryName:"remission_"+r});var x=t.items;var B=x.length;var z=1;var y=j.configs.canCreateNewTax;var u=j.configs.canCreateNewWarehouse;var w=j.configs.canCreateNewItem;var A=j.configs.multipleTaxes;j.callUpdateTotal=B<=1;Ext.each(x,function(D){D.idRemission=j.idRemission;var E=Ext.create("AL.view.invoice.FormAddItem",{itemSold:D,type:"remission",queryName:"remission_"+r,disabledDeleteButton:false,styleDeleteButton:"left: 830px",canCreateNewTax:y,canCreateNewWarehouse:u,canCreateNewItem:w,multipleTaxes:A});var F=E.down("hidden[name=idRemission]");F.setValue(r);var C=E.down("combo[name=idTax]");q.add(E);if(z==B){C.on("taxComboRendered",function(){g.changeIdPriceList=true;j.callUpdateTotal=true;g.updateTotal();GlobalLoadMask.hide("mask-items-loading")});g.changeIdPriceList=true;j.callUpdateTotal=true;g.updateTotal();GlobalLoadMask.hide("mask-items-loading")}z++})}else{GlobalLoadMask.hide("mask-items-loading")}}})}})}},updateResolution:function(){var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(c.configs.country==="mexico"){return}var b=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var a=b.smGetSelectedRecord().data;var d=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var f=d.down("menu[action=saveInvoice]");var e=d.down("splitbutton[action=save]");if(a.isElectronicResolution===true){e.setText(translate("stamp",true));if(f.isActiveElectronicInvoicing!==true){f.isActiveElectronicInvoicing=true;f.add({text:"Guardar sin "+translate("stamp"),action:"save",status:"open",afterSave:"noStampInvoice"})}}else{e.setText(translate("save",true));if(f.isActiveElectronicInvoicing===true){Ext.each(f.items.items,function(g){if(g.afterSave==="noStampInvoice"){f.remove(g.id)}})}f.isActiveElectronicInvoicing=false}},promptFileUploadWindowOnClick:function(c,a,b,f,e){var d=false;c.getEl().on("click",function(j,m){if(d){return}d=true;var l=false;var h=c.getEl().getHTML();var g="AL.view.company.FileUploadWindowLogo";if(b){g="AL.view.company.FileUploadWindow"}var k=Ext.create(g,{asyncUpload:f.asyncUpload,title:f.title,url:f.url,fieldName:f.fieldName,fieldLabel:f.fieldLabel,buttonText:f.buttonText,helpText:f.helpText,height:230,onSubmit:function(n,o){l=true;Ext.create("Ext.fx.Anim",{target:n,duration:300,from:{opacity:1},to:{opacity:0},callback:function(){n.close()}});Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update('<div class="form-add-invoice-image-zone-loading"></div>');Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}})},onSuccess:function(o,n,p){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){var q=new Image;q.onload=function(t){var s=(q.width*Math.min(c.configs.maxHeight,q.height))/q.height;var r="";if(s<c.configs.maxWidth){r="width: auto; max-height: "+c.configs.maxHeight+"px;"}else{r="height: auto; max-width: "+c.configs.maxWidth+"px;"}if(b){c.update('<div style="cursor: pointer;"><div class="form-add-invoice-signature-zone" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div><div class="form-add-invoice-signature-zone-made-by-text" onselectstart="return false;">'+c.configs.madeByText+"</div></div>")}else{c.update('<div class="form-add-invoice-image-zone-image" onselectstart="return false;"><img src="'+n[a]+'" style="margin: 0 auto; '+r+'" /></div>')}if(e){e(n[a])}Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})};q.src=n[a]}})},onFailure:function(o,n,q){d=false;Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:1},to:{opacity:0},callback:function(){c.update(h);Ext.create("Ext.fx.Anim",{target:c,duration:100,from:{opacity:0},to:{opacity:1}})}});if(typeof n=="string"||!n.cause){Ext.MessageBox.alert(translate("error",true),translate("anErrorHasOccurredWeWillSolveItAsSoonAsPossible",true))}else{var p=n.title?n.title:translate("error",true);Ext.MessageBox.alert(p,n.cause)}},onClose:function(n){if(!l){d=false}}});k.getEl().setOpacity(0);Ext.create("Ext.fx.Anim",{target:k,duration:300,from:{opacity:0},to:{opacity:1}})},c)},tooltipDocumentType:function(c,a){var b=!a?"invoice":a.value;var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var d=e.configs.country;switch(d){case"mexico":c.update('<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para crear una venta,<br />haz <a href="https://ayuda.getsoft.app/c%C3%B3mo-hacer-una-factura-de-venta" target="_blank">clic aquí</a>.</div></div></div></div>');break;case"peru":if(b==="invoice"){c.update('<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para emitir facturas de venta,<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270283" target="_blank">clic aquí</a>.</div></div></div></div>')}else{c.update('<div class="tooltip-wrapper add-invoice" style="left:300px!important;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container tooltip-left" style="left:13px;top:-24px;"><div class="tooltip-text-wrapper tooltip-small" style="width:321px!important;"><div class="text">Si necesitas ayuda para emitir boletas de venta,<br />haz <a href="https://ayuda.getsoft.app/hc/es/articles/360000270826" target="_blank">clic aquí</a>.</div></div></div></div>')}break}},createResolutionDropdownList:function(){var a=this;var b=Ext.create("AL.view.ux.smile.floating.DropdownList",{name:"resolutionDropdownList",smTarget:"number-dropdown",smAlignXTo:1,smAlignYTo:2,smX:13,smY:8,smStore:"ResolutionsCombo",smDisplayField:"name",smValueField:"idLocal",smSelectFirstByDefault:false});b.smOnChange=function(j,q,H,y){var B=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var C=j.smGetSelectedRecord().data;var A=B.down("#nextInvoiceNumberContainer");if(B.type!=="edit"&&C){if(B.configs&&a.getCountriesWithStamp().indexOf(B.configs.country)!==-1&&B.configs.isActiveElectronicInvoicing){a.updateResolution()}if(C.autoincrement&&C.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json/cache/yes",method:"POST",params:{id:C.idLocal},success:function(O,Q){var P=Ext.decode(O.responseText);var S=P.results;var T="";if(B.configs){switch(B.configs.country){case"argentina":S.number=Ext.String.leftPad(S.number,8,"0");T="-";break;case"peru":T=S.prefix?"-":"";break}}var U=S.prefix+T+S.number;var R=a.calculateAutoResolutionNumberFieldWidth(U);A.removeAll(false);A.add({xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",padding:"0 3 0 0",width:R,height:48,fieldCls:"form-add-invoice-header-number-left",readOnly:true,value:U},{xtype:"box",padding:"5 0 0 0",html:'<a class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'})},failure:function(){}})}else{A.removeAll(false);var f,n;if(B.configs.country=="republicaDominicana"){f=77;n=77}else{f=63;n=91}var l=[{xtype:"label",padding:"4 7 0 0",cls:"form-add-invoice-header-number-text",html:'N<span style="font-size: 18px;">o.</span>'},{xtype:"textfield",name:"prefix",emptyText:translate("prefix",true),padding:"0 9 0 0",width:f,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus"},{xtype:"textfield",name:"number",emptyText:translate("number",true),regex:/^[1-9]([0-9]+)?$/,regexText:translate("theNumeration",true)+" "+translate("numeration")+" debe iniciar con un valor diferente a cero",allowBlank:false,blankText:"Debe ingresar el "+translate("number",true)+" "+translate("ofTheInvoice")+" "+translate("invoices"),padding:"0 3 0 0",width:n,height:48,fieldCls:"form-add-invoice-header-number-left-with-focus",invalidCls:"form-add-invoice-header-number-error",maxLength:10},{xtype:"box",padding:"5 0 0 0",html:'<a class="button clear" style="padding: 0px !important; margin: 0px !important;" href="/resolution" id="editInvoiceInfo"><svg class="icon gray" style="margin-right: 0px !important;"><use xlink:href="/images/smile-icons.svg#settings"></use></svg></a>'}];A.add(l)}}if(C&&B.configs){switch(B.configs.country){case"peru":if(C.documentType==="saleTicket"){var N=Ext.ComponentQuery.query("invoice_FormAddRetentionSuggested");Ext.each(N,function(O){O.destroy()})}var z=Ext.get("retentionsSuggestedPanel");var p=C.documentType==="saleTicket"?"none":"block";if(z){z.applyStyles("display:"+p)}break;case"mexico":var F=B.down("switch[name=documentTypeSwitch]");if(C.documentType==="saleTicket"||(F&&F.getOptionSelected()&&F.getOptionSelected().value==="saleTicket")){var L=B.down("combo[name=idClient]");var e=B.down("combo[name=paymentType]");var d=B.down("combo[name=cfdiUse]");var J=B.down("combo[name=currency]");if(e){e.select("PUE")}if(L){a.addContactGeneric(L,B)}if(d){d.select("G03")}if(J){J.select(B.configs.currency)}var r=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];if(r){var c=r.down("splitbutton[action=save]");c.setText(translate("save",true));var E=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var g=E.down("[afterSave=createInvoice]");if(g){g.setText(translate("saveAndCreateNew",true))}var m=r.down("[afterSave=print]");if(m){m.setText(translate("saveAndPrint",true))}var u=E.down("[afterSave=addPayment]");if(u){u.setText(translate("saveAndAddPayment",true))}var h=E.down("[afterSave=sendByEmail]");if(h){h.setText(translate("saveAndSendByEmail",true))}var k=Ext.ComponentQuery.query("buttons_SaveInvoice [afterSave=noStampInvoice]")[0];if(k){k.destroy()}var o=Ext.ComponentQuery.query("buttons_SaveInvoice [status=draft]")[1];if(o){o.destroy()}}}break;case"costaRica":var s=B.down("datefield[name=date]");if(C.isElectronicResolution===true){var I=new Date();s.setMaxValue(AL.date(I));s.maxText="La fecha para "+translate("theInvoices")+" "+translate("invoices")+" con "+translate("electronicNumeration")+" debe ser inferior o igual a {0}.";if(B.configs.electronicInvoicingVersion==="4.3"){s.setMinValue(AL.date(I));s.minText="Solo puedes emitir comprobantes electrónicos con la fecha actual.";s.maxText="Solo puedes emitir comprobantes electrónicos con la fecha actual."}}else{s.setMaxValue(null);s.setMinValue(null)}if(C.documentType==="saleTicket"||(F&&F.getOptionSelected()&&F.getOptionSelected().value==="saleTicket")){var L=B.down("combo[name=idClient]");if(L){a.addContactGeneric(L,B)}}break;case"chile":var s=B.down("datefield[name=date]");if(C.isElectronicResolution===true&&C.documentType=="saleTicket"){var I=new Date();s.setMaxValue(AL.date(I));s.setMinValue(AL.date(I));s.minText="Solo puedes emitir comprobantes electrónicos con la fecha actual.";s.maxText="Solo puedes emitir comprobantes electrónicos con la fecha actual."}else{s.setMaxValue(null);s.setMinValue(null)}var L=B.down("combo[name=idClient]");var x=L.getStore();if(C.documentType==="saleTicket"||(F&&F.getOptionSelected()&&F.getOptionSelected().value==="saleTicket")){if(L){a.addContactGeneric(L,B)}}break}}var G=Ext.get("number-dropdown");G.el.dom.innerHTML=Ext.util.Format.htmlEncode(q)+'<svg class="icon" style="margin-right: 0px !important; color: inherit !important;"><use xlink:href="/images/smile-icons.svg#caret-down"></use></svg>';var M=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];var D=M?M.down("textarea[name=resolutionText]"):null;var K=Ext.ComponentQuery.query("invoice_BottomContainer")[0];var v=K.down("textarea[name=resolutionPie]");var t=K?K.down("box[name=resolutionText]"):null;if(v&&t){v.setValue("")}if(C&&(B.type!=="edit"||(B.type==="edit"&&!D))){var w=C.resolutionText?C.resolutionText:"";if(B.type==="edit"&&!w){w=B.invoice.resolution}if(v&&t){v.hide();t.hide();if((B.configs.country=="peru"||B.configs.country=="costaRica")&&(C.isElectronicResolution)){v.hide();t.show();var q="";switch(B.configs.country){case"peru":q="Autorizado mediante resolución Nº 032-005-0000211";break;case"costaRica":q="Autorizada mediante resolución No DGT-R-033-2019 del 20 de junio de 2019";break;default:q=translate("payOnCheckingAccount",true);resolutionEmptyTextLabel.show();break}t.update(q)}else{v.show();t.hide();v.setValue(w)}}}if(C&&B.type!="edit"){var c=Ext.ComponentQuery.query("menu[action=saveInvoice]")[0];if(C.isElectronicResolution===true&&B.configs&&B.configs.isActiveElectronicInvoicing===true){var h=c.down("[afterSave=sendByEmail]");if(h){c.remove(h)}var E=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var g=E.down("[afterSave=createInvoice]");if(g){g.setText(translate("stamp",true)+" y crear nueva")}var m=E.down("[afterSave=print]");if(m){m.setText(translate("stamp",true)+" e imprimir")}var u=E.down("[afterSave=addPayment]");if(u){u.setText(translate("stamp",true)+" y agregar pago");u.hide()}}else{var h=c.down("[afterSave=sendByEmail]");var q=translate("saveAndSendByEmail",true);if(B.configs.country==="mexico"){q="Timbrar y enviar por correo"}if(!h){c.add({text:q,action:"save",status:"open",afterSave:"sendByEmail"})}if(B.configs.country!=="mexico"){var E=Ext.ComponentQuery.query("buttons_SaveInvoice")[0];var g=E.down("[afterSave=createInvoice]");if(g){g.setText(translate("saveAndCreateNew",true))}var m=E.down("[afterSave=print]");if(m){m.setText(translate("saveAndPrint",true))}var u=E.down("[afterSave=addPayment]");if(u){u.setText(translate("saveAndAddPayment",true));u.show()}}}}};b.smOnSelect=function(k,o,l,h,j){var c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(c.type==="edit"){var g=k.smGetSelectedRecord().data;var f=c.down("textfield[name=prefix]");var d=c.down("textfield[name=number]");var n=Ext.ComponentQuery.query("invoice_FormAdvancedOptions")[0];var m=n.down("textarea[name=resolutionText]");if(c.invoice.resolutionIdLocal==g.idLocal){if(m){m.setValue(c.invoice.resolution)}f.setValue(c.invoice.prefix);d.setValue(c.invoice.number)}else{if(m){m.setValue(c.invoice.resolution)}if(g.autoincrement&&g.autoincrement==="yes"){Ext.Ajax.request({url:"/resolution/retrieve-next-available-number/format/json",method:"POST",params:{id:g.idLocal},success:function(e,q){var p=Ext.decode(e.responseText);var r=p.results;var s="";if(c.configs){switch(c.configs.country){case"argentina":r.number=Ext.String.leftPad(r.number,8,"0");break}}f.setValue(r.prefix);d.setValue(r.number)},failure:function(){}})}else{d.setValue(null)}}}}},calculateAutoResolutionNumberFieldWidth:function(e){var b=95;var c=200;var d=11;var a=e.length*d;if(a>c){a=c}else{if(a<b){a=b}}return a},calculateManualResolutionFieldWidth:function(g,f,e){var d=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var b,c;if(g=="prefix"){if(d.configs.country=="republicaDominicana"){b=77;c=116}else{b=63;c=87}}else{if(d.configs.country=="republicaDominicana"){b=77;c=116}else{b=91;c=145}}var a=e.length*f;if(a>c){a=c}else{if(a<b){a=b}}return a},getCountriesWithStamp:function(){return["peru","colombia","costaRica","argentina","chile"]},getSubmitDataDisabled:function(){var a=this,b=null;if(!a.isFileUpload()){b={};b[a.getName()]=a.getValue()}return b},populationOldResolution:function(e,b){var f=e.down("hidden[name=oldIdResolution]");var h=e.down("hidden[name=oldResolutionName]");var d=e.down("hidden[name=oldResolutionStatus]");var g=e.down("hidden[name=oldDocumentType]");var c=e.down("hidden[name=oldPrefix]");var a=e.down("hidden[name=oldNumber]");f.setValue(b.resolutionIdLocal);h.setValue(b.resolutionName);d.setValue(b.resolutionStatus);g.setValue(b.resolutionDocumentType);c.setValue(b.prefix);a.setValue(b.number)},verifyResolutionInactive:function(f){if(f.type!="edit"){return}var a=f.down("[name=resolutionDropdown]");var c=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0];var y=f.down("textfield[name=prefix]");var h=f.down("textfield[name=number]");var l=f.down("switch[name=documentTypeSwitch]");var q=f.down("hidden[name=oldIdResolution]");var w=f.down("hidden[name=oldResolutionName]");var z=f.down("hidden[name=oldResolutionStatus]");var k=f.down("hidden[name=oldDocumentType]");var x=f.down("hidden[name=oldPrefix]");var u=f.down("hidden[name=oldNumber]");var n=c.smGetStore();var o=c.smGetSelectedRecord().data;var t=y.getValue();var e=h.getValue();var b=q.getValue();var j=w.getValue();var d=z.getValue();var s=k.getValue();var p=x.getValue();var v=u.getValue();if(l){var g=l.getOptionSelected();if((g.value==s&&b!=o.idLocal)||(o.status=="inactive")){if(t!=p){y.setValue(p)}if(e!=v){h.setValue(v)}var m=n.findExact("idLocal",b);if(m<0){var r=Ext.create("AL.model.Resolution",{idLocal:b,name:j,status:d});n.add(r);c.smSyncWithStore()}c.smSetValue(b);a.smDisable();y.getSubmitData=this.getSubmitDataDisabled;y.disable();h.getSubmitData=this.getSubmitDataDisabled;h.disable()}else{c.smOnSelect(c);a.smEnable();y.enable();h.enable()}}else{if((b==o.idLocal&&d=="inactive")||(o.status=="inactive")){if(t!=p){y.setValue(p)}if(e!=v){h.setValue(v)}a.smDisable();y.getSubmitData=this.getSubmitDataDisabled;y.disable();h.getSubmitData=this.getSubmitDataDisabled;h.disable()}else{c.smOnSelect(c);a.smEnable();y.enable();h.enable()}}},calculateRetentionPanel:function(e,g,l,m){var j=g[0];var d=e.up("form");var a=d.up("panel");var f=d.down("textfield[name=amount]");if(j.get("calculatedBy")!="percentage"){return}if(j.get("idRetentionReference")==1||j.get("idRetentionReference")==8||j.get("idRetentionReference")==6||j.get("idRetentionReference")==25){var c=a.invoiceIdLocal;var b;if(j.get("idRetentionReference")==6){b="/invoice/retrieve-total-iva/id/"+c+"/subTotalWithIva/true/format/json"}else{b="/invoice/retrieve-total-iva/id/"+c+"/format/json"}Ext.Ajax.request({url:b,success:function(p,q){var u=Ext.decode(p.responseText);if(u.success){var t=AL.math.approx(u.results,null,a.invoiceDecimalPrecision);var s=AL.math.approx(AL.math.mul(t,AL.math.div(j.get("percentage"),100)),null,a.invoiceDecimalPrecision);f.setValue(s);if(d.allowBase&&d.allowBase===true){var r=d.down("[name=base]");r.setValue(t)}}}})}else{var k=a.total;var n=j.get("percentage");var h=AL.math.approx(AL.math.mul(k,AL.math.div(n,100)),null,a.invoiceDecimalPrecision);f.setValue(h);if(a&&d.allowBase&&d.allowBase===true){var o=d.down("[name=base]");o.setValue(AL.math.approx(a.total,null,a.invoiceDecimalPrecision))}}},calculateRetentionAfterRetentionCreated:function(c,d,a){var e=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];var b=c.renderTo?c.renderTo:"";if(e){switch(b){case"retentionsSuggestedAdd":this.calculateRetentionSuggested(d,a);break;case"autoRetentionsAdd":this.calculateAutoRetention(d,a);break;default:this.calculateRetention(d,a);break}}else{this.calculateRetentionPanel(d,a)}},setTermsConditionsAndAnotation:function(){Ext.Ajax.request({url:"/company/retrieve-info/format/json",success:function(a,d){var g=Ext.decode(a.responseText,true);if(g&&g.success){var c=g.results;var b=Ext.ComponentQuery.query("invoice_BottomContainer")[0];if(c.invoiceAnotation){var f=b.down("textarea[name=anotation]");f.setValue(c.invoiceAnotation)}if(c.termsConditions){var e=b.down("textarea[name=termsConditions]");e.setValue(c.termsConditions)}}}})},addContactGeneric:function(e,d){var f=d.configs.country;if(["mexico","costaRica","chile"].indexOf(f)==-1){return}var a=null;switch(f){case"mexico":a={name:"Venta al público general",identification:"XAXX010101000",idLocal:"generic"};break;case"costaRica":a={name:"Cliente de contado",idLocal:"generic"};break;case"chile":a={name:"Cliente genérico",idLocal:"generic",identification:"66666666-6"};break}if(d.type!="edit"&&a){var c=function(){var g=Ext.create("AL.model.Client",a);e.getStore().add(g);e.select(g)};var b=e.getStore();if(!b.hasLoaded()&&b.isLoading()){b.on("load",c)}else{c()}}},loadSellerStore:function(d,c){var a=function(){var f=d.findRecord("idLocal",null);if(!f){f=Ext.create("AL.model.Seller",{name:translate("anySeller",true),idLocal:null});b.add(f)}var e=d.findRecord("idLocal",c);if(!e){e=f}d.select(e)};var b=d.getStore();if(b.hasLoaded()){a()}else{b.load({callback:function(){a()}})}},calculateDiffBetweenDateAndDueDate:function(c,b){var e=AL.date(c);e=e.getTime();var d=AL.date(b);d=d.getTime();var a=1000*60*60*24;var f=AL.math.div(AL.math.sub(d,e),a);return f},loadTermStore:function(a,e,c){var d=a.getStore(),b=function(){var f=d.findRecord("idLocal",0);if(!f){f=Ext.create("AL.model.Term",{idLocal:0,name:"Vencimiento manual",days:"Vencimiento manual"});d.add(f)}recordTerm=null;if(c){recordTerm=d.findRecord("idLocal",c)}else{if(e||e==0){e=e.toString();recordTerm=d.findRecord("days",e)}}if(!recordTerm){recordTerm=f}a.select(recordTerm)};if(!d.hasLoaded()){d.load()}else{b()}d.on("load",b)},isValidValue:function(a){if(a===undefined){return false}if(typeof a==="undefined"){return false}if(a===null){return false}if(a===false){return false}return true},loadCostCenterRecord:function(b,d,a){var c=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+b+"/format/json",success:function(f,h){var j=Ext.decode(f.responseText);if(j.success){var g=j.results;var e=Ext.create("AL.model.CostCenter",g);if(d.store.isLoading()){d.store.on("load",function(){d.store.insert(0,e);d.select(e)})}else{d.store.insert(0,e);d.select(e)}if(a){a.fireEvent("click",a)}}else{Ext.MessageBox.alert(translate("costCenterNotFound",true))}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},changeStoreItemsToSaleConcept:function(d){var f=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(f&&f.configs.country==="argentina"){saleConceptField=f.down("combo[name=saleConcept]");value=saleConceptField.getValue();var e="/item/retrieve-all/format/json";switch(value){case"PRODUCTS":e="/item/retrieve-all/format/json/type/products";break;case"SERVICES":e="/item/retrieve-all/format/json/type/services";break}var a=d.down("combo[name=idLocal]"),c=a.getStore(),b=c.getProxy();if(b.url!=e){b.url=e;c.load({callback:function(){if(!d||!d.item){return}var g=c.findRecord("idLocal",d.idLocal),h=true;switch(value){case"SERVICES":h=d&&d.unit==="service"?true:false;break;case"PRODUCTS":h=d&&d.unit!=="service"?true:false;break}if(!g&&h){var g=Ext.create("AL.model.Item",d);c.add(g)}if(g){itemCombo.select(g)}}})}}},validateDatesServicesRemission:function(b,e){var a=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];if(a&&((a.configs&&a.configs.country!=="argentina")||(a.type&&a.type==="edit"))){return}if(b&&b.metadata){var c=a.down("datefield[name=startDateService]"),d=a.down("datefield[name=endDateService]");if(["PRODUCTS"].indexOf(b.metadata.saleConcept)!==-1){c.enable();d.enable()}else{c.disable();d.disable();c.getSubmitData=this.getSubmitDataDisabled;d.getSubmitData=this.getSubmitDataDisabled;if(e&&e==="yes"){c.setValue(b.metadata.startDateService);d.setValue(b.metadata.endDateService)}}}},setResolutionFromSwitchSelectionToProxy:function(c,d,b){var a="";if(b=="saleTicket"){var e=d.down("combo[name=saleTicketType]");e.setValue("NATIONAL");a=e.getValue();if(a=="EXEMPT"){c.extraParams.subDocumentType="EXEMPT_SALE_TICKET"}else{c.extraParams.subDocumentType="saleTicket"}}else{a=d.down("combo[name=type]").getValue();if(a=="EXEMPT"){c.extraParams.subDocumentType="EXEMPT_INVOICE"}else{c.extraParams.subDocumentType="invoice"}}return c},setItemsTaxExemptAndNotExempt:function(a){var b=Ext.ComponentQuery.query("[name=resolutionDropdownList]")[0],d=Ext.ComponentQuery.query("invoice_FormAddItem"),c=Ext.ComponentQuery.query("invoice_FormAddInvoice")[0];Ext.each(d,function(g){if(a=="EXEMPT"){var e=g.down("combo[name=idTax]");var f=e.getStore();f.clearFilter();f.filter("idLocal",0);e.setValue(0)}else{var e=g.down("combo[name=idTax]");var f=e.getStore();if(c.configs.isActiveElectronicInvoicing&&b.smGetSelectedRecord()&&b.smGetSelectedRecord().data.metadata.isElectronicResolution==true){f.clearFilter();f.filter(function(h){return !h.data.idLocal==0});e.setValue("1")}else{f.clearFilter()}}})},validateCostCenter:function(d,c){if(d.configs.costCenter.isActive){var a=d.down("combo[name=idWarehouse]");var b=d.down("combo[name=idCostCenter]");if(!a||!b){return true}var e=a.getSelectedRecord();var f=e.get("idCostCenter");if(f==""||f==null){return true}if(c.idCostCenter!=f){return false}}return true},showMessageCostCenterError:function(j,f){var c=j.down("combo[name=idWarehouse]");var h=j.down("combo[name=idCostCenter]");var d=h.getSelectedRecord();var a=c.getSelectedRecord();var g=this;var b={document:translate("invoice")};var e=Ext.create("AL.view.common.SmileWindow",{id:"window-configuration-cost-centers",title:translate("costCenterErrorValidationTitle",true),width:600,modal:true,style:"padding:10px 18px 0px 18px",items:[{xtype:"box",html:"<div>"+translate("costCenterErrorValidationMessage",true)+translate("costCenterErrorValidationFixQuestion",true,b)+'<ul class="cost-center-selection-message"> <li>'+translate("costCenterWarehouseSelected",true)+" "+a.get("costCenterName")+"</li> <li>"+translate("costCenterSelected",true,b)+" "+d.get("name")+"</li></ul></div>"},],footer:{items:[{text:translate("skip",true),cls:"button",handler:function(k){e.close()}},{text:translate("modify",true),cls:"button main-button",handler:function(k){h.setValue(a.get("idCostCenter"));d=h.getSelectedRecord();if(!d&&a.get("idCostCenter")){g.loadCostCenterRecord(a.get("idCostCenter"),h,f)}else{f.fireEvent("click",f)}e.close()}}]}});e.show()}});Ext.define("AL.view.transaction.GridAll",{extend:"Ext.grid.Panel",alias:"widget.transaction_GridAll",requires:["AL.plugin.grid.PageSize","AL.plugin.grid.ColumnFilter","AL.plugin.grid.RecordSelector"],title:"",minHeight:390,border:true,scroll:true,frame:false,store:"Transactions",holds:"transactions",dockedItems:[{xtype:"pagingtoolbar",store:"Transactions"}],plugins:[{ptype:"grid_PageSize"},{ptype:"grid_ColumnFilter"}],initComponent:function(){var a=125;var b=70;switch(this.country){case"mexico":a=145;break;case"republicaDominicana":b=90;break}if(this.country==="mexico"&&this.transactionType&&this.transactionType==="in"){var c=Ext.create("AL.plugin.grid.RecordSelector",{ptype:"grid_RecordSelector",recordsIdProperty:"idLocal",recordTitleField:"number",recordTitle:translate("transaction",true),operations:[{text:"Descargar XML",icon:"https://cdn1.getsoft.app/images/icons/ico_xml.png",minRecords:1,operationName:"Descargar",operationUrl:"/transaction/bulk-download-xml",run:function(j,m,k,e){var d=Ext.Object.getKeys(m),o=d.length,f=j.operationUrl,h;var n=true;var p=[];for(h=0;h<o;h++){var l=d[h];var g=m[l].getData();if(!g.uuid){n=false;p.push(g)}f+="/id"+(h+1)+"/"+d[h]}if(!n){replacementMsg="Los siguientes pagos no se encuentran timbrados por lo que no se incluyen sus XML: <br> ";for(h=0;h<p.length;h++){replacementMsg+='<li> <a href="/transaction/view/id/'+p[h].idLocal+'">Pago '+p[h].number+"</a> </li> "}Ext.Msg.show({title:"Descargar XML",icon:Ext.Msg.QUESTION,msg:replacementMsg,buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})}window.open(f,"_blank");j.afterRun(j,m,k,e)},afterRun:function(e,g,f,d){}}]});this.plugins.push(c);this.plugins[2].operations[0].maxRecords=30;this.plugins[2].operations[0].notAllowedText="Puedes descargar hasta 30 pagos al mismo tiempo"}this.columns=[{header:translate("number",true),dataIndex:"number",renderer:this.linkCode,width:b,align:"center"},{header:translate("clientA",true),dataIndex:"name",flex:1,renderer:this.renderLink},{header:translate("detail",true),dataIndex:"associations",flex:1},{header:translate("creation",true),dataIndex:"date",width:100,align:"center",renderer:this.renderDate},{header:translate("account",true),dataIndex:"accountName",flex:1},{header:"<span>"+translate("reconciledM",true)+'</span><span style="position: absolute;margin-top: -2px;margin-left: 2px;"><img id="tooltip1" class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"></span>',dataIndex:"conciliated",renderer:this.renderConciliated,align:"center",width:120},{header:translate("status",true),dataIndex:"status",width:90,align:"center",renderer:this.renderStatus},{header:translate("amount",true),dataIndex:"amount",align:"right",renderer:this.renderMoney,width:108},{header:translate("actions",true),align:"center",type:"transactionInActions",renderer:this.setActions,sortable:false,width:a}];this.callParent(arguments)},renderConciliated:function(f,g,b,h,d,c,a){var e=(b.get("conciliated"))?translate("reconciledF",true):translate("notReconciled",true);return e},renderLink:function(f,g,b,h,d,c,a){var e;if(f){e='<a href="/transaction/view/id/'+b.get("idLocal")+'">'+f+"</a>"}return e},linkCode:function(f,g,b,h,d,c,a){var e;if(f){e='<a href="/transaction/view/id/'+b.get("idLocal")+'">'+b.get("transactionNumber")+"</a>"}return e},renderDate:function(f,g,b,h,e,c,a){var d=AL.date(f);return Ext.Date.format(d,"d/m/Y")},setActions:function(h,l,e,f,k,j,g){var c=e.get("number");console.log("asds");var d='<div class="action-icons">';if(e.get("editable")){d+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="editTransaction"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_edit.png" alt="'+translate("edit",true)+'" title="'+translate("edit",true)+'" class="disabled"/>'}if(e.get("deletable")){d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="deleteTransaction"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/delete.png" alt="'+translate("remove",true)+'" title="'+translate("remove",true)+'" class="disabled"/>'}d+='<a target="_blank" href="/transaction/print/id/'+e.get("idLocal")+'"><img src="https://cdn1.getsoft.app/images/icons/printer.png" alt="'+translate("print",true)+'" title="'+translate("print",true)+'" class="printTransaction"></a>';if(this.country=="mexico"&&e.get("type")==="in"){var a=e.get("uuid");var b=e.get("idLocal");var c=e.get("number");if(a){d+='<a href="/transaction/download-stamp-files/id/'+b+'" title="'+translate("download",true)+' XML"><img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="'+translate("download",true)+' XML" class="downloadXml"></a>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/ico_xml.png" alt="'+translate("download",true)+' XML" class="disabled">'}}if(e.get("voidable")){d+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="voidTransaction"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_red.png" alt="'+translate("cancel",true)+'" class="disabled voidTransaction"/>'}if(e.get("openable")){d+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("openF")+'" class="convertTransactionToOpen"/>'}else{d+='<img src="https://cdn1.getsoft.app/images/icons/page_white_put.png" alt="'+translate("convertTo",true)+" "+translate("openF")+'" class="disabled"/>'}d+="</div>";return d},renderMoney:function(f,g,b,h,e,c,a){var d=b.get("currencySymbol")?b.get("currencySymbol"):null;return Ext.util.Format.usMoney(f,b.get("decimalPrecision"),d)},renderStatus:function(e,h,b,c,g,f,d){var j="";var a="";if(e=="void"){j="invoiceVoid";a=translate("canceledMale",true)}return'<span class="'+j+'">'+a+"</span>"}});Ext.define("AL.view.payment.GridAllTransactions",{extend:"AL.view.transaction.GridAll",alias:"widget.payment_GridAllTransactions",idAccount:null,viewConfig:{stripeRows:true,emptyText:'<style>.grid-account-transactions .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotRegisteredDocumentYet",true,{document:translate("payment")})+'!</div><div class="button-wrapper"><a href="/transaction/out" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("add",true)+" "+translate("payment")+"</a></div></div></div>"},listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.url="/transaction/retrieve-for-type/type/out/format/json";a.remoteSort=false;a.sorters.removeAll();a.sorters.add(new Ext.util.Sorter({property:"number",direction:"DESC"}));if(!a.isLoading()&&!a.hasLoaded()){a.load()}}}});Ext.define("AL.controller.Payment",{extend:"Ext.app.Controller",views:["payment.FormAdd","payment.PaymentToolbar","payment.FormAddCategory","payment.GridAllTransactions","payment.FormAddRetention"],stores:["Payments","CategoriesCombo","Clients","Accounts","Taxes","Transactions","Retentions"],models:["Payment","CategoryCombo","Client","Account","Tax","Retention"],init:function(){this.control({"buttons_SubmitCreate button[action=savePayment]":{click:this.savePayment},"buttons_SubmitCreate button[action=saveCreatePayment]":{click:this.savePayment},"payment_PaymentToolbar button[action=addPayment]":{click:function(){window.location="/payment/add"}},payment_FormAdd:{render:this.initialize},"payment_FormAdd groupingcombobox[name=idAccount]":{render:function(b){var a=b.getStore();if(!a.hasLoaded()){a.load()}}},"payment_FormAddCategory groupingcombobox[name=idCategory]":{render:this.setCategoryComboStore},payment_GridAll:{itemdblclick:this.goPaymentDetails},"payment_FormAddRetention combo[name=idRetention]":{render:function(b){var a=b.getStore();if(!a.hasLoaded()){a.load()}},select:this.calculateRetention},"payment_FormAddCategory button[action=deleteItem]":{click:function(a){a.up("form").destroy();this.updateTotal()}},"payment_FormAddCategory textfield[name=price]":{change:this.updateItemTotal},"payment_FormAddCategory combo[name=idTax]":{render:function(b){var a=b.getStore();if(!a.hasLoaded()){a.load()}},change:this.updateTotal},"payment_FormAddCategory numberfield[name=quantity]":{change:this.updateItemTotal},payment_GridAllTransactions:{itemdblclick:function(d,a,f,b,g,c){window.location="/transaction/view/id/"+a.get("idLocal")},render:function(){var a=Ext.create("Ext.tip.ToolTip",{target:"tooltip1",listeners:{render:function(b){b.getEl().on({mouseenter:function(){a.show()},mouseleave:function(){a.hide()},scope:b})}},constrain:true,closeAction:"hide",html:translate("toLearnMoreAboutBankReconciliation",true)+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/205801459"> '+translate("clickHere")+"</a>."})}},"payment_GridAllTransactions gridcolumn[type=transactionActions]":{click:function(a,c,k,g,l,m){var n=this.application;var f=Ext.get(l.target);var d=a.up("grid").getSelectionModel().getSelection()[0];if(f.hasCls("editTransaction")){l.preventDefault();n.fireEvent("editTransaction",{record:d,initiator:a})}else{if(f.hasCls("deleteTransaction")){l.preventDefault();n.fireEvent("deleteTransaction",{record:d,initiator:a})}else{if(f.hasCls("voidTransaction")){l.preventDefault();n.fireEvent("voidTransaction",{record:d,initiator:a})}else{if(f.hasCls("convertTransactionToOpen")){l.preventDefault();n.fireEvent("convertTransactionToOpen",{record:d,initiator:a})}else{if(f.hasCls("printTransaction")){l.preventDefault();var b=d.get("idLocal");var h=window.open("/transaction/print/id/"+b);h.print()}}}}}}}})},initialize:function(){var a=Ext.get("addOtherAccount");a.on("click",this.addCategoryForm);var b=Ext.get("addOtherRetention");b.on("click",this.addRetentionForm)},addRetentionForm:function(){var a=Ext.ComponentQuery.query("#addRetentionsPanel")[0];var b=Ext.create("AL.view.payment.FormAddRetention",{});a.add(b)},calculateRetention:function(c,d,g,h){var f=d[0];if(f.get("calculatedBy")!="percentage"){return}var a=c.up("form");var e=Ext.ComponentQuery.query("payment_FormAddCategory");var k=0;Ext.each(e,function(n){var l=n.down("textfield[name=price]");var m=n.down("numberfield[name=quantity]");k+=l.getValue()*m.getValue()});var b=a.down("textfield[name=amount]");var j=k*f.get("percentage")/100;b.setValue(j)},goPaymentDetails:function(b,a,f,c,g,d){var h=a.get("idLocal");window.location="/transaction/view/id/"+h},savePayment:function(e){if(this.validateForms()){var a=e.up("form");var g=a.query("button");Ext.each(g,function(k){k.disable()});var d=Ext.ComponentQuery.query("payment_FormAddCategory");var b=Ext.ComponentQuery.query("payment_FormAddRetention");var j=[];Ext.each(b,function(k){j.push(k.getValues())});var f=[];Ext.each(d,function(l){var k=l.getForm().getValues();if(!k.idTax||k.idTax==0){delete k.idTax}f.push(k)});var c=Ext.ComponentQuery.query("payment_FormAdd")[0];var h=c.getValues();h.categories=Ext.encode(f);h.retentions=Ext.encode(j);Ext.Ajax.request({url:"/payment/add/format/json",method:"POST",params:h,success:function(k,l){var m=Ext.decode(k.responseText);if(m.success){if(e.createAnother){window.location="/payment/add"}else{window.location="/payment"}}else{GlobalMsg.showErrorMessage("Error",m.cause);Ext.each(g,function(n){n.enable()})}},failure:function(){Ext.each(g,function(k){k.enable()})}})}else{GlobalMsg.showNotification({tpl:"formInvalidFields"})}},addCategoryForm:function(){var b=Ext.ComponentQuery.query("#addCategoryPanel")[0];var a=Ext.create("AL.view.payment.FormAddCategory");b.add(a)},setCategoryComboStore:function(c,b){var a=Ext.create("AL.store.CategoriesCombo");c.store=a},updateTotal:function(){var a={};var f=Ext.ComponentQuery.query("payment_FormAddCategory");var d=0;var c=0;Ext.each(f,function(g){var k=g.down("combo[name=idTax]");var j=g.down("textfield[name=price]");var m=g.down("numberfield[name=quantity]");var h=k.findRecordByValue(k.getValue());var l=j.getValue()*m.getValue();d+=parseFloat(l);if(h){c+=l*(1+h.get("tax")/100);if(a[h.get("idLocal")]){a[h.get("idLocal")].value+=l*h.get("tax")/100}else{a[h.get("idLocal")]={fieldLabel:h.get("name")+" ("+Ext.util.Format.round(h.get("tax"),2)+"%)",name:h.get("name"),tax:h.get("tax"),xtype:"displayfield",width:250,labelSeparator:"",labelAlign:"right",style:"text-align: right",fieldBodyCls:"totalAligned",labelPad:20,labelWidth:150,value:l*h.get("tax")/100}}}else{c+=l}});var e=Ext.ComponentQuery.query("#totalForm")[0];e.destroy();var b=Ext.create("Ext.form.Panel",{border:false,width:340,bodyPadding:20,style:"border: 1px solid #ccc;",bodyStyle:"background: #f1f1f1",id:"totalForm",renderTo:"totalContainer"});b.add({fieldLabel:"Subtotal",name:"subtotal",xtype:"displayfield",labelAlign:"right",style:"text-align: right",labelPad:20,fieldBodyCls:"totalAligned",width:250,labelWidth:150,labelSeparator:"",labelStyle:"font-weight: bold",value:Ext.util.Format.usMoney(d)});Ext.Object.each(a,function(g,h){h.value=Ext.util.Format.usMoney(h.value);b.add(h)});b.add({fieldLabel:"Total",name:"total",xtype:"displayfield",labelAlign:"right",labelPad:20,labelWidth:150,labelSeparator:"",fieldBodyCls:"totalAligned",labelStyle:"font-weight: bold",style:"text-align: right",value:Ext.util.Format.usMoney(Ext.util.Format.round(c,2)),width:250})},updateItemTotal:function(h,a,g,c){var e=h.up("form");var b=e.down("textfield[name=price]");var d=e.down("displayfield[name=total]");var f=e.down("numberfield[name=quantity]");if(b.isValid()&&f.isValid()){d.setValue(Ext.util.Format.usMoney(b.getValue()*f.getValue()))}else{d.setValue(Ext.util.Format.usMoney(0))}this.updateTotal()},validateForms:function(){var c=Ext.ComponentQuery.query("payment_FormAdd")[0].getForm();var b=Ext.ComponentQuery.query("payment_FormAddCategory");var d=Ext.ComponentQuery.query("payment_FormAddRetention");var a=true;if(c.isValid()){if(b.length===0){a=false}else{Ext.each(b,function(f){var e=f.getForm();if(!e.isValid()){a=false}});Ext.each(d,function(f){var e=f.getForm();if(!e.isValid()){a=false}})}}else{a=false}return a}});Ext.define("AL.view.transaction.GridAllIn",{extend:"AL.view.transaction.GridAll",alias:"widget.transaction_GridAllIn",viewConfig:{stripeRows:true,emptyText:'<style>.grid-invoices-payments .x-grid-view {overflow: hidden !important}</style><div class="no-grid-data-wrapper"><div class="no-grid-data"><div class="message">'+translate("youHaveNotRegisteredPaymentsReceivedYet",true)+'!</div><div class="button-wrapper"><a href="/transaction/in" class="button"><svg class="icon small light"><use xlink:href="/images/smile-icons.svg#plus"></use></svg>'+translate("addPaymentReceived",true)+"</a></div></div></div>"},listeners:{afterrender:function(c){var a=c.getStore();var b=a.getProxy();b.url="/transaction/retrieve-for-type/type/in/format/json";a.remoteSort=false;a.sorters.removeAll();a.sorters.add(new Ext.util.Sorter({property:"number",direction:"DESC"}));if(!a.isLoading()&&!a.hasLoaded()){a.load()}}}});Ext.define("AL.controller.Transaction",{extend:"Ext.app.Controller",views:["common.FormAddInvoice","transaction.FormTransaction","transaction.FormAddInvoice","transaction.FormAddRetention","transaction.FormAddCategory","transaction.TransactionInQuestion","transaction.TransactionOutQuestion","transaction.FormAddBill","displayPanel.TotalSummaryBoard","transaction.MoreActionsButton","transaction.GridAllIn","transaction.AddVoidCause"],stores:["Accounts","CategoriesCombo","Clients","Retentions","Invoices","Transactions","Taxes","Invoices","DocumentPaymentMethods","Bills","CompanyCurrenciesCombo","VoidCauses","CostCentersCombo"],models:["CategoryCombo","Invoice","Transaction","Retention","Client","Tax","Account","Bill","CompanyCurrency","CountryLegalParameter","CostCenter"],init:function(){var e=this;var c=Ext.select("a[data-action=deleteTransaction]");if(c.elements.length>0){c.on("click",function(k,l){k.preventDefault();var h=Ext.get(l);var j=h.getAttribute("data-idAccount");var m=h.getAttribute("data-idTransaction");var g=Ext.create("AL.model.Transaction",{idLocal:m});this.application.fireEvent("deleteTransaction",{idAccount:j,initiator:null,record:g})},this)}var b=Ext.select("a[data-action=voidTransaction]");if(b.elements.length>0){b.on("click",function(m,n){m.preventDefault();var j=Ext.get(n);var k=j.getAttribute("data-idAccount");var o=j.getAttribute("data-idTransaction");var h=j.getAttribute("data-isObligedAddVoidCause");var g=Ext.create("AL.model.Transaction",{idLocal:o,isObligedAddVoidCause:h});var l={country:j.getAttribute("current-country"),date:j.getAttribute("transaction-date"),target:j};this.application.fireEvent("voidTransaction",{idAccount:k,initiator:l,record:g})},this)}var a=Ext.select("a[data-action=convertTransactionToOpen]");if(a.elements.length>0){a.on("click",function(k,l){k.preventDefault();var h=Ext.get(l);var j=h.getAttribute("data-idAccount");var m=h.getAttribute("data-idTransaction");var g=Ext.create("AL.model.Transaction",{idLocal:m});this.application.fireEvent("convertTransactionToOpen",{idAccount:j,initiator:null,record:g})},this)}this.application.addListener("deleteTransaction",function(j){var g=j.record;var h=j.initiator;Ext.Msg.show({title:translate("remove",true)+" "+translate("transaction")+"",msg:translate("areYouSureYouWantToDelete",true)+" "+translate("theTransaction")+" "+translate("transaction")+"? "+translate("thisOperationCannotBeUndone",true)+".",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(k){if(k=="yes"){Ext.Ajax.request({url:"/transaction/delete/format/json",method:"POST",params:{id:g.get("idLocal")},success:function(m,n){var o=Ext.decode(m.responseText);if(o.success){if(h){var l=h.getStore();l.load()}else{window.location="/account/view/id/"+j.idAccount}}else{if(o.cause){Ext.MessageBox.alert("Error",o.cause)}}},failure:function(){}})}}})},this);this.application.addListener("voidTransaction",function(j){var g=j.record;var h=j.initiator;Ext.Msg.show({title:translate("cancel",true)+" "+translate("transaction"),msg:translate("areYouSureYouWantToVoid",true)+" "+translate("theTransaction")+" "+translate("transaction")+"?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(n){if(n=="yes"){if(h.country==="republicaDominicana"&&g.get("isObligedAddVoidCause")==true){var k;if(g.get("date")){k=g.get("date")}else{k=new Date(h.date)}var m=Ext.create("AL.view.transaction.AddVoidCause",{voidAction:true,documentType:"transaction",documentId:g.get("idLocal"),country:h.country,documentDate:k,success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){if(h.getStore){var o=h.getStore();o.load();m.destroy()}else{window.location.reload()}}else{Ext.MessageBox.alert("Error",r.cause)}}})}else{if(h.target){target=h.target}else{target=h}var l=Ext.create("AL.LoadMask",{target:target,msg:translate("loading",true)});l.show();Ext.Ajax.request({url:"/transaction/void/format/json",method:"POST",params:{id:g.get("idLocal")},success:function(p,q){var r=Ext.decode(p.responseText);if(r.success){if(h.getStore){var o=h.getStore();o.load();if(r.needReplacement){Ext.Msg.show({title:"Sustitución",icon:Ext.Msg.QUESTION,msg:"El pago se ha "+translate("canceledMale")+' correctamente. Recuerda sustituirlo, puedes hacerlo <a href="/transaction/in/idTransaction/'+g.get("idLocal")+'/mxReplace/true">'+translate("here")+"</a>.",buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})}}else{window.location.reload()}}else{Ext.MessageBox.alert("Error",r.cause)}l.destroy()},failure:function(){l.destroy()}})}}}})},this);this.application.addListener("convertTransactionToOpen",function(j){var g=j.record;var h=j.initiator;Ext.Ajax.request({url:"/transaction/convert-to-open/format/json",method:"POST",params:{id:g.get("idLocal")},success:function(l,m){var n=Ext.decode(l.responseText);if(n.success){if(h){var k=h.getStore();k.load();GlobalMsg.showNotification({title:translate("success",true),text:translate("theTransaction",true)+" "+translate("transaction")+" "+translate("hasBeenSuccessfullyConvertedToOpen"),type:"success"})}else{window.location="/transaction/view/id/"+g.get("idLocal")}}else{Ext.MessageBox.alert("Error",n.cause)}},failure:function(){}})},this);this.application.addListener("editTransaction",function(k){var g=k.record;var j=k.initiator;var h=g.get("type");var l=g.get("idLocal");window.location="/transaction/edit-"+h+"/id/"+l});var f=Ext.get("emailTransaction");if(f){f.on("click",function(l,h){var k=h.getAttribute("data-number");var g=h.getAttribute("data-idClient");var j=h.getAttribute("data-canEmail");var m=function(){var n=Ext.ComponentQuery.query("window[reason=incompleteCompanyInfo]")[0];if(n){n.destroy();h.setAttribute("data-canEmail","yes")}if(g){Ext.Ajax.request({url:"/contact/retrieve-email-contacts-by-client/id/"+g+"/format/json/email-template/transaction/idDocument/"+k,success:function(p,r){var t=Ext.decode(p.responseText);if(t.success){var o=[];if(t.results){var q=t.results;if(t.emailTemplate){o.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:t.emailTemplate.subject});o.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:t.emailTemplate.message});o.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}o.push({xtype:"box",style:"color: #67948E; margin-bottom:10px",html:translate("emailAddressesAssociatedWithThisClient",true)});if(t.clientEmail){o.push({boxLabel:t.clientEmail+" - ("+t.clientName+")",name:"email",record:{name:t.clientName,email:t.clientEmail},xtype:"checkbox",labelWidth:200,labelAlign:"right"})}else{if(q.length==0){o.push({xtype:"box",style:"color: #999; font-size:11px",html:translate("thereAreNoEmailAddressesAssociatedWithThisClient",true)})}}Ext.each(q,function(u){o.push({boxLabel:u.email+" - ("+u.name+" "+u.lastName+")",name:"email",record:u,xtype:"checkbox",labelWidth:200,labelAlign:"right"})})}o.push({xtype:"box",style:"color: #67948E; margin-bottom:10px; margin-top:20px",html:translate("youCanAlsoSend",true)+" "+translate("thisTransaction")+" "+translate("transaction")+" "+translate("toAParticularEmailOrSendTo")},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var s=Ext.create("AL.view.common.SmileWindow",{reason:"confirmTransactionEmail",id:"window-transaction-send-to-emails",title:translate("send",true)+" "+translate("transaction")+" "+translate("toTheseEmails"),number:k,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,items:{xtype:"form",items:o,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(u){var w=u.up("window");var v=w.down("button[action=confirmEmail]");if(v){v.fireEvent("click",v)}}}]}});s.show()}else{Ext.MessageBox.alert("Error",t.cause)}},failure:function(){}})}else{Ext.Ajax.request({url:"/company/retrieve-email-template/format/json/type/transaction/idDocument/"+k,success:function(p,q){var s=Ext.decode(p.responseText);if(s.success){var o=[];if(s.emailTemplate){o.push({xtype:"textfield",fieldLabel:translate("subject",true)+":",name:"emailSubject",labelWidth:60,value:s.emailTemplate.subject});o.push({xtype:"htmleditor",fieldLabel:translate("message",true),name:"emailMessage",margin:"0 0 10 0",labelWidth:60,enableSourceEdit:false,height:250,value:s.emailTemplate.message});o.push({xtype:"label",html:'<a class="editEmailTemplate" href="/company/edit-email-templates">'+translate("configEmailTemplate",true)+"</a>",margin:"0 0 0 353"})}o.push({xtype:"box",style:"color: #67948E; margin-bottom:2px; margin-top:10px",html:translate("emailAddressesAssociatedWithThisClient",true)},{xtype:"textfield",name:"email",labelWidth:115,labelPad:15,fieldLabel:translate("emailAddress",true)},{xtype:"checkbox",name:"sendCopyToUser",boxLabel:translate("sendACopyToMyEmail",true),margin:"0 0 0 130"});var r=Ext.create("AL.view.common.SmileWindow",{reason:"confirmTransactionEmail",id:"window-transaction-send-to-emails",number:k,bodyPadding:"0 35 35 35",width:600,height:500,modal:true,title:translate("send",true)+" "+translate("transaction")+" "+translate("toTheseEmails"),items:{xtype:"form",items:o,border:false,anchor:100,layout:"anchor",bodyPadding:5,defaults:{anchor:"100%"},buttons:[{text:translate("send",true),action:"confirmEmail",hidden:true}]},footer:{items:[{text:translate("send",true),cls:"button main-button",handler:function(t){var v=t.up("window");var u=v.down("button[action=confirmEmail]");if(u){u.fireEvent("click",u)}}}]}});r.show()}else{Ext.MessageBox.alert("Error",s.cause)}},failure:function(){}})}};if(j==="yes"){m()}else{Ext.create("AL.view.company.WindowIncompleteInfo",{reason:"incompleteCompanyInfo",infoTitle:translate("toSent",true)+" "+translate("theTransaction")+" "+translate("transaction")+" "+translate("byMailYouMustEnterTheFollowingDataOfYourCompany")+"!",title:translate("completeTheNextInformationToContinue",true),forEmail:true,number:k,callback:m,resourceTrigger:"transaction"})}})}this.application.addListener("clientCreated",function(k){var j=k.initiator;var g=k.record;var h=j.getStore();h.add(g);j.select(g.get("idLocal"))},this);this.application.addListener("taxCreated",function(j){var k=j.initiator;var g=j.record;var h=k.getStore();h.add(g);k.select(g.get("idLocal"))},this);this.application.addListener("retentionCreated",function(k){var l=k.initiator;var g=k.record;var h=l.getStore();var j=l.up("form");h.add(g);l.select(g.get("idLocal"));this.calculateRetentionAfterRetentionCreated(j,l,[g])},this);this.control({"buttons_SubmitReset button[action=save]":{click:function(g){this.saveTransaction(g,false)}},"buttons_SubmitReset button[name=onlySaveAndStamp]":{click:function(g){var h=g.up("form");Ext.Msg.show({title:"Sustitución de complemento de pago",msg:"¿Estás seguro que deseas sustituir el complemento de pago?",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(k){if(k==="yes"){var j=Ext.ComponentQuery.query("buttons_SubmitReset button[name=stampTransactionSplitBtn]")[0];if(j){j.el.dom.click()}}}})}},"buttons_SubmitReset button[action=stampTransaction]":{click:function(g){this.saveTransaction(g,true)}},"buttons_SubmitReset menu[action=saveTransaction]":{click:function(g){this.saveTransaction(g,false)}},"window[reason=confirmTransactionEmail] form button[action=confirmEmail]":{click:function(p){var j=p.up("form");var s=j.up("window");var o=Ext.ComponentQuery.query("window[reason=confirmTransactionEmail] checkbox[name=email]");var q=j.down("textfield[name=email]");var l=j.down("checkbox[name=sendCopyToUser]");var u=[];var v;if(o){Ext.each(o,function(z){if(z.getValue()){var w=z.record;var x="";if(w.name){x=w.name;if(w.lastName){x=x+" "+w.lastName}}var y={name:x,email:w.email};u.push(y)}})}if(q.getValue()&&q.getValue()!==""){v={name:"",email:q.getValue()};u.push(v)}var m=j.down("htmleditor[name=emailMessage]");var h=j.down("textfield[name=emailSubject]");var k={subject:h.getValue(),message:m.getValue()};var n=[],r,g;Ext.each(u,function(w){n.push(w.email)});n=n.join(",");r=Ext.get("emailTransaction").getAttribute("data-maxEmailsToSend");g=n.split(/[;,]/).length;if(g>r){Ext.Msg.alert("Error",translate("youHaveExceededTheMaximumNumberOfRecipientsToSendTheyCannotBeMoreThan",true,{document:translate("theTransaction")+" "+translate("transaction"),quantity:r}));return}var t={number:s.number,emails:Ext.encode(u),sendCopyToUser:l.getValue(),emailTemplate:Ext.encode(k)};Ext.Ajax.on("beforerequest",this.showSpinner,this);Ext.Ajax.on("requestcomplete",this.hideSpinner,this);Ext.Ajax.request({url:"/transaction/email/format/json",method:"POST",params:t,showSpinner:true,timeout:60000,success:function(w,x){var y=Ext.decode(w.responseText);if(y.success){s.close();GlobalMsg.showNotification({title:translate("success",true),text:translate("theTransaction",true)+" "+translate("transaction")+" "+translate("hasBeenSentsuccessfullyF"),type:"success"});setTimeout(function(){window.location.reload()},1500)}else{Ext.MessageBox.alert("Error",y.cause)}},failure:function(){}})}},transaction_FormTransaction:{beforerender:function(k){var h=k.down("combo[name=paymentMethod]"),g=Ext.create("AL.store.DocumentPaymentMethods",{country:k.configs.country,stampVersion:k.configs.stampVersion,type:"transaction",transactionType:k.transactionType});if(k.configs.country=="mexico"&&k.configs.stampVersion=="3.3"){h.fieldLabel="Forma de pago";h.allowBlank=false}h.bindStore(g);if(k.configs&&k.configs.country==="republicaDominicana"){h.allowBlank=false}if(k.configs&&k.configs.resolutionModel&&k.configs.resolutionModel==="new"){var m=k.down("numerationField[name=numerationComponent]");m.setDocumentType(k.transactionType==="in"?"transactionIn":"transactionOut")}var l=k.down("combo[name=idAccount]");var j=k.down("combo[name=idClient]");if(k&&k.transactionType&&k.transactionType==="in"){l.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="left: 104%;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">'+translate("selectTheBankAccountInWhichYouWantToDepositTheMoney",true)+" "+translate("learnHowToManageYourBankAccounts",true)+'<a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/206512965">'+translate("here")+"</a>.</div></div></div></div>";j.fieldLabel=translate("clientA",true)}else{l.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="left: 104%;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">'+translate("selectTheBankAccountUsedToMakeThePayment",true)+" "+translate("learnHowToManageYourBankAccounts",true)+'<a target="_blank" href="http://ayuda.getsoft.app/hc/es/articles/206512965">'+translate("here")+"</a>.</div></div></div></div>";j.fieldLabel=translate("provider",true)}var n=k.down("combo[name=idCostCenter]");if(k.configs.costCenter.isActive&&n){n.enable();n.show()}else{if(n){n.disable();n.hide()}}},afterrender:function(h){var r=this;var g=Ext.DomQuery.select("#labelNextTransactionNumner");var l=(h.transactionType==="out")?'<span style="margin-left: 6px">'+translate("transactionOut",true)+" #</span>":'<span style="margin-left: 56px">'+translate("transactionIn",true)+" #</span>";g[0].innerHTML=l;var v=h.down("textarea[name=anotation]");var n=(h.transactionType==="in")?translate("paymentReceivedAnotation",true):translate("paymentAnotation",true);v.setFieldLabel(n);var q=function(){var w=this,x=null,y;if(w.submitValue&&!w.isFileUpload()){y=w.getSubmitValue();if(y!==null){x={};x[w.getName()]=y}}return x};if(h.configs&&h.configs.resolutionModel&&h.configs.resolutionModel==="new"){var g=h.down("#nextTransactionNumberContainer");g.hide()}else{if(h.edit){var u=h.down("textfield[name=number]");var m=((h.transactionType==="out")?translate("transactionOut",true):translate("transactionIn",true))+" #";h.down("label[name=numberLabel]").setText(m);var g=h.down("#nextTransactionNumberContainer");g.getSubmitData=q;g.disable();g.hide();var k=h.down("textfield[name=number]");u.enable();k.show()}}var j=h.down("combo[name=idAccount]");var p=j.getStore();if(h.idAccount){p.on("load",function(){j.select(p.findRecord("idLocal",h.idAccount))})}p.load();var s=h.down("combo[name=currency]");var o=h.invoiceCurrency;var t=s.getStore();t.load({callback:function(){h.companyCurrencies=t.getRange(0,t.getCount());if(o){var w=s.findRecord("code",o);if(w){if(h.idBill||h.invoiceIdLocal){s.suspendEvents();s.select(w);s.resumeEvents();r.currencyComboChanged(s,"no")}else{s.select(w);r.currencyComboChanged(s)}}}else{var x=Ext.create("AL.model.CompanyCurrency",{code:h.configs.currency,name:h.configs.nameCurrency,exchangeRate:1});t.add(x);if(h.idBill||h.invoiceIdLocal){s.suspendEvents();s.select(x);s.resumeEvents();r.currencyComboChanged(s,"no")}else{s.suspendEvents();s.select(x);s.resumeEvents();r.currencyComboChanged(s)}}}});if(h.configs.multicurrency=="yes"){s.show()}this.addEvents();if(h.edit){this.prepareEdit(h.id)}else{if(h.idBill){this.renderBillPayment(h.idBill,h.idClient)}else{if(h.invoiceIdLocal){this.renderInvoicePayment(h.invoiceIdLocal,h.idClient)}else{if(h.idClient){}else{if(h.configs.idTransaction){this.prepareToClone(h.configs.idTransaction)}}}}}}},"transaction_TransactionInQuestion radiogroup":{change:function(m,j,g){this.clearTransactionMessage();var k=Ext.get("transaction-to-categories-wrapper");var h=Ext.get("transaction-retentions-wrapper");var n=Ext.get("transaction-to-invoices-wrapper");if(j.associateTo==="invoice"){h.setStyle({display:"none"});this.removeCategoryForms(true);var o=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];if(o.getValue()&&o.findRecordByValue(o.getValue())){this.addInvoiceForms()}else{this.removeTotalContainer();this.removeRetentionsContainer();n.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aSalesInvoice")+" <strong>"+translate("invoice")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",true,{clientOrProvider:translate("clientA")})+" "+translate("salesInvoicesPendingToPay")].join(" "),{cls:"yellow"})}}else{k.show();var l=Ext.ComponentQuery.query("checkbox[name=mx_stampTransaction]")[0];if(l){l.setValue(false)}var p=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(p.configs.canApplyRetentions&&p.configs.country!="argentina"){h.show()}this.removeInvoiceForms(true);this.addCategoryForm();this.updateTotal()}}},"transaction_FormTransaction combo[name=idAccount]":{change:function(k){var p=this;var o=k.getSelectedRecord();var h=k.up("form");var n=h.companyCurrencies;var j=h.down("combo[name=currency]");var r=j.getStore();Ext.each(n,function(s){if(!r.findRecord("code",s.get("code"))){r.add(s)}});if(o&&o.get("currencyCode")){var g=o.get("currencyCode");var q=function(){r.each(function(s){if(s&&s.get("code")!=g&&s.get("code")!=h.configs.currency){r.remove(s);q()}})};if(r.hasLoaded()){q()}else{r.on("load",q());r.load()}var m=r.findRecord("code",h.configs.currency);if(!h.edit){if(m){j.select(m)}p.currencyComboChanged(j,"no",o.get("currencyCode"))}else{var l=j.getSelectedRecord();if(!l){j.select(m)}p.currencyComboChanged(j,"no",o.get("currencyCode"))}}else{if(o){p.currencyComboChanged(j,"no")}}}},"transaction_FormTransaction combo[name=currency]":{change:function(g){this.currencyComboChanged(g,"yes")}},"transaction_FormTransaction datefield[name=date]":{beforerender:function(h){var g=h.up("form");if(g.configs.country=="mexico"&&g.configs.stampVersion=="3.3"){h.tooltip="Selecciona la fecha en la que recibiste la contraprestación."}}},"transaction_FormTransaction checkbox[name=mx_stampTransaction]":{beforerender:function(g){var h=g.up("form");if(h.configs.country=="mexico"&&h.transactionType=="in"&&h.configs.stampVersion=="3.3"){g.setVisible(true);if(h.configs.mxReplace==true){g.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="left: 10%; top: 30%;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container" style="margin-top: -20px; line-height: 12px"><div class="tooltip-text-wrapper"><div class="text">El documento de sustitución también debe ser timbrado.</div></div></div></div>'}}},change:function(n){var o=n.up("form");if(o.configs.country=="mexico"&&o.transactionType=="in"&&o.configs.stampVersion=="3.3"){var m=Ext.ComponentQuery.query("buttons_SubmitReset splitbutton[action=stampTransaction]")[0];var l=Ext.ComponentQuery.query("buttons_SubmitReset button[action=save]")[0];var h=Ext.ComponentQuery.query("buttons_SubmitReset button[name=onlySaveAndStamp]")[0];var j=Ext.ComponentQuery.query("transaction_TransactionInQuestion radiogroup")[0];var g=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var k=function(){var p=this,q=null,r;if(p.submitValue&&!p.isFileUpload()){r=p.getSubmitValue();if(r!==null){q={};q[p.getName()]=r}}return q};if(j.getValue().associateTo==="invoice"){this.removeInvoiceForms();this.addInvoiceForms()}if(n.checked==true){j.items.items[0].setValue(true);l.setVisible(false);m.setVisible(true);if(o.configs.mxReplace==true){n.setReadOnly(true);n.getSubmitData=k;n.disable();j.setReadOnly(true);g.setReadOnly(true);g.getSubmitData=k;g.disable();l.setVisible(false);m.setVisible(false);h.setVisible(true)}}else{m.setVisible(false);l.setVisible(true)}}}},"transaction_FormTransaction hidden[name=exchangeCurrency]":{change:function(l){var m=Ext.ComponentQuery.query("transaction_FormAddCategory");var j=this;var k=l.up("form");var h=k.down("combo[name=currency]");var g=h.getSelectedRecord();if(g&&g.get("code")!=k.configs.currency){k.currencySign=g.get("symbol")}else{k.currencySign=null}if(m){Ext.each(m,function(o){var n=o.down("textfield[name=price]");j.updateCategoryTotal(n)})}this.updateTotal()}},"transaction_TransactionOutQuestion radiogroup":{change:function(k,m,j){this.clearTransactionMessage();var h=Ext.get("transaction-to-categories-wrapper");var n=Ext.get("transaction-retentions-wrapper");var l=Ext.get("transaction-to-bills-wrapper");var o=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(o.configs.canApplyRetentions&&o.configs.country!="argentina"){n.show()}if(m.associateTo==="bill"){n.setStyle({display:"none"});this.removeCategoryForms(true);var g=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];if(g.getValue()&&g.findRecordByValue(g.getValue())){this.addBillForms()}else{this.removeTotalContainer();this.removeRetentionsContainer();l.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aBill")+" <strong>"+translate("supplierInvoice")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",true,{clientOrProvider:translate("supplier")})+" "+translate("pendingSupplierInvoice")].join(" "),{cls:"yellow"})}}else{l.setStyle({display:"none"});h.show();var o=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(o.configs.canApplyRetentions&&o.configs.country!="argentina"){n.show()}this.removeBillForms(true);this.addCategoryForm();this.updateTotal()}}},"transaction_FormTransaction combo[name=idClient]":{change:function(k,h,g,p){var j=k.up("form");var o=Ext.get("transaction-to-bills-wrapper");var l=Ext.get("transaction-to-invoices-wrapper");var m=null;this.removeInvoiceForms(true);this.removeBillForms(true);var q=Ext.ComponentQuery.query("transaction_TransactionInQuestion radiogroup")[0];if(!q){q=Ext.ComponentQuery.query("transaction_TransactionOutQuestion radiogroup")[0]}var n=Ext.ComponentQuery.query("client_PositiveBalances")[0];if(h&&k&&k.findRecordByValue(h)&&n){m=k.findRecordByValue(h).getData();n.setClient(m,true)}if(q.getValue().associateTo==="invoice"){if(h&&k.findRecordByValue(h)){l.show();this.addInvoiceForms()}else{this.removeTotalContainer();l.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aSalesInvoice")+" <strong>"+translate("invoice")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",true,{clientOrProvider:translate("clientA")})+" "+translate("pendingSalesInvoice")].join(" "),{cls:"yellow"})}}else{if(q.getValue().associateTo==="bill"){if(h&&k.findRecordByValue(h)){o.show();this.addBillForms()}else{this.removeTotalContainer();o.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aSalesInvoice")+" <strong>"+translate("invoice")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",true,{clientOrProvider:translate("provider")}),translate("pendingSupplierInvoice")].join(" "),{cls:"yellow"})}}}if(j.configs.country=="mexico"&&m&&m.idLocal){Ext.Ajax.request({url:"/transaction/need-replacement/idClient/"+m.idLocal+"/format/json",success:function(t,u){var v=Ext.decode(t.responseText);var s=v.transactions;if(s.length>0){replacementMsg="Estos son los complementos de pago del cliente pendientes por sustitución. Haz clic sobre el que desees reemplazar: <br> ";for(i=0;i<s.length;i++){replacementMsg+='<li> <a href="/transaction/in/idTransaction/'+s[i].idLocal+'/mxReplace/true">Pago '+s[i].number+"</a> </li> "}var r=Ext.get("mx-display-payment-replacement-window");if(r){r.addListener("click",function(){Ext.Msg.show({title:"Sustitución",icon:Ext.Msg.QUESTION,msg:replacementMsg,buttons:Ext.MessageBox.YES,buttonText:{yes:"Aceptar"},buttonAlign:"center",})})}var w=document.getElementsByClassName("need-replacement-hint")[0];if(w){w.style.display="inline"}}else{var w=document.getElementsByClassName("need-replacement-hint")[0];if(w){w.style.display="none"}}},failure:function(){}})}},beforerender:function(h){var g=h.up("form");if(g.configs.country=="mexico"&&g.configs.mxReplace==true){h.afterBodyEl='<div class="tooltip-wrapper add-invoice" style="left: 107%;"><img class="tooltip" src="https://cdn1.getsoft.app/images/sm-help.png"><div class="tooltip-text-container"><div class="tooltip-text-wrapper"><div class="text">En sustituciones se conserva el cliente original.</div></div></div></div>'}}},"transaction_FormAddCategory groupingcombobox[name=idCategory]":{blur:function(g){g.getStore().clearFilter()},},"transaction_FormAddCategory button[action=deleteItem]":{beforerender:function(g){g.addCls("btn-delete-cost-center-category")},click:function(g){var h=g.up("form");h.destroy();this.updateTotal()}},"transaction_FormAddCategory numberfield[name=quantity], transaction_FormAddCategory combo[name=idTax], transaction_FormAddCategory textfield[name=price]":{change:function(g){this.updateCategoryTotal(g)}},"transaction_FormAddBill > textfield[name=amount], transaction_FormAddInvoice > textfield[name=amount]":{change:function(){this.updateTotal()},keypress:function(h,j,g){h.calculateFromRetentions=false}},"transaction_FormAddRetention[type=bill] textfield[name=amount]":{change:function(h){var g=h.up("transaction_FormAddBill");if(g){this.calculateTotalAmountFromRetentions(g)}this.updateTotal()}},"transaction_FormAddRetention[type=invoice] textfield[name=amount]":{change:function(h){var g=h.up("transaction_FormAddInvoice");if(g){this.calculateTotalAmountFromRetentions(g)}this.updateTotal()}},"transaction_FormAddRetention[type=category] textfield[name=amount]":{change:function(g){this.updateTotal()}},"transaction_FormAddRetention[type=category] combo[name=idRetention]":{select:this.calculateRetentionCategory},"transaction_FormAddRetention[type=invoice] combo[name=idRetention]":{select:this.calculateRetentionOfInvoiceOrBill},"transaction_FormAddRetention[type=bill] combo[name=idRetention]":{select:this.calculateRetentionOfInvoiceOrBill},"transaction_FormAddInvoice, transaction_FormAddBill":{afterrender:function(g){var h=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(h&&!h.configs.canApplyRetentions){g.down("button[name=addRetention]").hide()}}},"transaction_FormAddRetention button[action=deleteRetention]":{click:function(h){var j=h.up("form");var g=null;if(j.type=="invoice"){g=j.up("transaction_FormAddInvoice")}else{if(j.type=="bill"){g=j.up("transaction_FormAddBill")}}j.destroy();if(g){this.calculateTotalAmountFromRetentions(g)}this.updateTotal()}},transaction_GridAll:{render:function(){var g=Ext.create("Ext.tip.ToolTip",{target:"tooltip1",anchorToTarget:false,listeners:{render:function(h){h.getEl().on({mouseenter:function(){g.show()},mouseleave:function(){g.hide()},scope:h})}},constrain:true,closeAction:"hide",html:translate("toLearnMoreAboutBankReconciliation",true)+' <a target="_blank" href="https://ayuda.getsoft.app/hc/es/articles/205801459"> '+translate("clickHere")+"</a>."})}},"transaction_GridAll gridcolumn[type=transactionInActions], account_GridConciliationTransactions gridcolumn[type=transactionInActions]":{click:function(g,k,p,n,q,r){var s=this.application;var m=Ext.get(q.target);var l=g.up("grid").getSelectionModel().getSelection()[0];if(m.hasCls("editTransaction")){q.preventDefault();s.fireEvent("editTransaction",{record:l,initiator:g})}else{if(m.hasCls("deleteTransaction")){q.preventDefault();s.fireEvent("deleteTransaction",{record:l,initiator:g})}else{if(m.hasCls("voidTransaction")){q.preventDefault();s.fireEvent("voidTransaction",{record:l,initiator:g.up("grid")})}else{if(m.hasCls("convertTransactionToOpen")){q.preventDefault();s.fireEvent("convertTransactionToOpen",{record:l,initiator:g})}else{if(m.hasCls("printTransaction")){q.preventDefault();var h=l.get("idLocal");var o=window.open("/transaction/print/id/"+h);o.print()}}}}}}},"transaction_MoreActionsButton menuitem[action=addVoidCause]":{click:function(g,h){h.preventDefault();var j=g.up("splitbutton");e.addVoidCause(j)}},"transaction_FormAddInvoice combo[name=number]":{select:this.invoiceSelected,select2:function(g){this.invoiceSelected(g.combo,[g.record])}},"transaction_FormAddInvoice button[action=deleteInvoice]":{click:function(g){var h=g.up("form");h.destroy();this.updateTotal()}},});var d=Ext.get("addOtherItem");if(d){d.hide();d.on("click",function(){this.addAnotherInvoice()},this)}},addEvents:function(){var c=Ext.get("addAnotherCategory");if(c){c.on("click",function(f){f.preventDefault();this.addCategoryForm()},this)}var b=Ext.get("add-retention");if(b){b.on("click",function(f){f.preventDefault();this.addRetentionCategoryForm()},this)}var e=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var d=e.transactionType;var a=Ext.get("editTransactionInfo");if(a){a.removeAllListeners();a.on("click",function(f){f.preventDefault();this.application.fireEvent("editTransactionNumber",{type:d,country:e.configs.country})},this)}this.application.addListener("billsLoaded",function(){GlobalLoadMask.hide("transaction-wrapper")});this.application.addListener("invoicesLoaded",function(){GlobalLoadMask.hide("transaction-wrapper")})},addVoidCause:function(a){var b=Ext.create("AL.view.transaction.AddVoidCause",{documentType:"transaction",documentId:a.idType,country:a.country,documentDate:a.date})},renderBillPayment:function(b,a){this.application.addListener("billsLoaded",function(){this.selectBillForm(b)},this);this.selectClientByAjax(a,"bill")},renderInvoicePayment:function(b,a){this.application.addListener("invoicesLoaded",function(){GlobalLoadMask.hide("transaction-wrapper");this.selectInvoiceForm(b)},this);this.selectClientByAjax(a,"invoice")},showSpinner:function(b,c,d){d=d?d:translate("sending",true);if(c.showSpinner){var a=new Ext.LoadMask(Ext.getBody(),{msg:d});a.show();c.mask=a}},hideSpinner:function(b,a,c){if(c.showSpinner){c.mask.destroy()}},selectBillForm:function(d){var a=Ext.ComponentQuery.query("transaction_FormAddBill hidden[name=idBill][value="+d+"]")[0];var b=Ext.ComponentQuery.query("transaction_FormAddBill displayfield[name=billNumber]");if(a){var c=a.up("form");if(b&&b.length>1){c.addCls("highlighted")}}},selectInvoiceForm:function(d){var a=Ext.ComponentQuery.query("transaction_FormAddInvoice hidden[name=invoiceIdLocal][value="+d+"]")[0];var b=Ext.ComponentQuery.query("transaction_FormAddInvoice displayfield[name=invoiceNumber]");if(a){var c=a.up("form");if(b&&b.length>1){c.addCls("highlighted")}}},selectClientByAjax:function(a,c){var d=this;var e=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var b=e.down("combo[name=idClient]");GlobalLoadMask.show("transaction-wrapper");Ext.Ajax.request({url:"/client/retrieve-one/id/"+a+"/format/json",success:function(g,j){var k=Ext.decode(g.responseText);if(k.success){var h=k.results;var f=Ext.create("AL.model.Client",h);b.getStore().add(f);b.select(f);if(c){d.setTransactionQuestionValue(c)}}}})},addInvoiceForms:function(){this.removeRetentionsContainer();this.removeTotalContainer();var h=Ext.get("transaction-to-categories-wrapper");h.setStyle({display:"none"});var g=Ext.get("transaction-to-invoices-wrapper");var j=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var d=j.up("form");if(j.getValue()&&j.findRecordByValue(j.getValue())){this.clearTransactionMessage();this.updateTotal();this.removeTotalContainer();var e=this;var b=Ext.ComponentQuery.query("combo[name=currency]")[0];var f=b.getValue();var k="false";if(d.configs.country=="mexico"){var a=Ext.ComponentQuery.query("checkbox[name=mx_stampTransaction]")[0];if(a.checked==true){var k="true"}}var c="";if(d.invoiceIdLocal&&k!="true"){c="/number/"+d.invoiceIdLocal}if(d.configs.oldestFirst=="yes"){c=c+"/oldestFirst/yes"}GlobalLoadMask.show("transaction-wrapper");Ext.Ajax.request({url:"/invoice/retrieve-open-by-client/idClient/"+j.getValue()+"/currency/"+f+"/checkCurrency/true/mxParcialities/"+k+"/limit/101/format/json"+c,timeout:120000,success:function(l,p){var r=Ext.decode(l.responseText);if(r.success){var o=r.results;var n=o.length;if(n>0){var q=Ext.get("addOtherItem");if(n<=100){if(q){q.hide()}g.show();Ext.each(o,function(s){e.addInvoiceForm(s,"no",false)});e.updateTotal();e.application.fireEvent("invoicesLoaded")}else{GlobalLoadMask.hide("transaction-wrapper");g.setStyle({display:"none"});g.show();if(!d.edit){for(var m=0;m<4;m++){e.addAnotherInvoice()}}if(q){q.show()}e.updateTotal();e.application.fireEvent("invoicesLoaded")}}else{if(d.edit&&d.type&&d.type==="invoices"){g.show();e.application.fireEvent("invoicesLoaded",o)}else{GlobalLoadMask.hide("transaction-wrapper");g.setStyle({display:"none"});e.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("clientA")})+" <strong>"+translate("invoices")+"</strong> "+translate("pendingToPay")].join(" "),{cls:"warning"})}}}},failure:function(){}})}else{Ext.MessageBox.alert("Error","Para asociar este pago a una "+translate("invoice")+", primero debe escoger el cliente al que está asociado "+translate("theInvoice")+" "+translate("invoice")+".")}},addBillForms:function(){this.removeRetentionsContainer();this.removeTotalContainer();var f=Ext.get("transaction-to-categories-wrapper");f.setStyle({display:"none"});var d=Ext.get("transaction-to-bills-wrapper");var b=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var h=b.up("form");if(b.getValue()&&b.findRecordByValue(b.getValue())){GlobalLoadMask.show("transaction-wrapper");this.clearTransactionMessage();this.updateTotal();this.removeTotalContainer();var g=this;var c=Ext.ComponentQuery.query("combo[name=currency]")[0];var a=c.getValue();var e="";if(h.invoiceIdLocal){e="/idBill/"+h.invoiceIdLocal}Ext.Ajax.request({url:"/bill/retrieve-open-by-client/idClient/"+b.getValue()+"/currency/"+a+"/checkCurrency/true/format/json"+e,success:function(j,l){var m=Ext.decode(j.responseText);if(m.success){var k=m.results;if(k.length>0){d.show();Ext.each(k,function(n){g.addBillForm(n,"yes")});g.updateTotal();g.application.fireEvent("billsLoaded")}else{if(h.edit&&h.type&&h.type==="bills"){d.show();g.application.fireEvent("billsLoaded",k)}else{GlobalLoadMask.hide("transaction-wrapper");d.setStyle({display:"none"});g.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("provider")}),"<strong>"+translate("bills")+"</strong> "+translate("pendingToPay")].join(" "),{cls:"warning"})}}}},failure:function(){}})}else{Ext.MessageBox.alert("Error","Para asociar este pago a una factura de proveedor, primero debe escoger el proveedor al que está asociado la factura.")}},addBillForm:function(o,e){var j=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var a=Ext.create("AL.view.transaction.FormAddBill",{renderTo:"transaction-to-bills",idBill:o.idLocal,billDecimalPrecision:o.decimalPrecision,configs:j.configs});var g=a.down("button[name=addRetention]");var m=a.down("button[name=viewRetentionsApplied]");if(e=="yes"){var b=a.down(" > textfield[name=amount]");b.suspendEvents()}o.idBill=o.idLocal;var c=AL.date(o.date);c=Ext.Date.format(c,"d/m/Y");o.billNumber=(o.billNumber)?o.billNumber:"Factura "+c.toString();var d=o.prefix?o.prefix:"";a.getForm().setValues({idBill:o.idBill,billNumber:d+o.billNumber,total:Ext.util.Format.usMoney(o.total,o.decimalPrecision,o.currencySymbol),missingAmount:Ext.util.Format.usMoney(o.missingAmount,o.decimalPrecision,o.currencySymbol),totalPayed:Ext.util.Format.usMoney(o.totalPayed,o.decimalPrecision,o.currencySymbol),amount:o.amount});if(e=="yes"){b.resumeEvents()}a.billSubTotal=j&&j.configs.country==="peru"?o.total:o.subTotal;a.missingAmount=o.missingAmount;a.bill=o;if(j&&j.configs.country==="argentina"){var l=a.down("container[name=retentionPanel]");l.hide();if(o.retentionsSupported&&j.edit==true&&o.amount){var h=[];for(var f=0;f<o.retentionsSupported.length;f++){var k=o.retentionsSupported[f];if(k.supportDocument&&k.supportDocument.idLocal==j.id){h.push(k)}}var n=a.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");n.setRetentionsForShowOnPanel(h)}}else{if((j&&j.configs)&&((!j.configs.canApplyRetentions)||(j.configs.country==="republicaDominicana"&&o.retentions&&o.retentions.length>0))){g.hide()}else{g.show()}if(j&&j.configs&&j.configs.country==="republicaDominicana"&&o.retentionsSupported&&o.retentionsSupported.length>0){m.show()}else{m.hide()}}},addInvoiceForm:function(g,b,f){var h=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var c=Ext.create("AL.view.transaction.FormAddInvoice",{renderTo:"transaction-to-invoices",idInvoice:g.idLocal,invoiceSubTotal:g.subTotal,invoiceDecimalPrecision:g.decimalPrecision,isAddManual:f,configs:h.configs});var e=c.down("button[name=addRetention]");var a=c.down("button[name=viewRetentionsApplied]");if((h&&h.configs)&&((!h.configs.canApplyRetentions)||(h.configs.country==="republicaDominicana"&&g.retentions&&g.retentions.length>0))){e.hide()}else{e.show()}if(h&&h.configs&&h.configs.country==="republicaDominicana"){if(g.retentionsSupported&&g.retentionsSupported.length>0){a.show()}else{a.hide()}}if(b=="yes"){var d=c.down(" > textfield[name=amount]");d.suspendEvents()}c.getForm().setValues({invoiceIdLocal:g.idLocal,number:g.number,invoiceNumber:g.invoiceNumber,total:Ext.util.Format.usMoney(g.total,g.decimalPrecision,g.currencySymbol),missingAmount:Ext.util.Format.usMoney(g.missingAmount,g.decimalPrecision,g.currencySymbol),totalPayed:Ext.util.Format.usMoney(g.totalPayed,g.decimalPrecision,g.currencySymbol),amount:g.amount});if(b=="yes"){d.resumeEvents()}c.invoiceSubTotal=h&&h.configs.country==="peru"?g.total:g.subTotal;c.missingAmount=g.missingAmount;c.setInvoice(g)},addCategoryForm:function(b,m){var e=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var c=Ext.create("AL.view.transaction.FormAddCategory",{renderTo:"transaction-to-categories",canCreateNewTax:e.configs.canCreateNewTax});var j=c.down("combo[name=idCategory]");var d=Ext.create("AL.store.CategoriesCombo");j.store=d;if(!d.hasLoaded()&&!d.isLoading()&&this.getTransactionType()==="out"){var k=j.getStore().getProxy();k.url="/category/retrieve-for-combo/types/expense-income-liability-equity-asset/format/json"}if(b){var l=Ext.create("AL.model.CategoryCombo",b);d.add(l);j.selectedRecord=l;j.select(l);var o=c.down("textfield[name=price]");var g=c.down("numberfield[name=quantity]");if(m=="yes"){o.suspendEvents();g.suspendEvents()}o.setValue(b.priceSecondaryCurrency);g.setValue(b.quantity);if(m=="yes"){o.resumeEvents();g.resumeEvents()}var f=c.down("textarea[name=observations]");f.setValue(b.observations)}var h=c.down("combo[name=idTax]");var a=h.getStore();var n=function(){if(!b){return}var q=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(b.taxStatus=="inactive"&&q.edit){var p=Ext.create("AL.model.Tax",{idLocal:b.idTax,tax:b.tax,name:b.taxName});a.add(p);h.select(p)}else{h.select(b.idTax)}};if(a.hasLoaded()){n()}else{a.on("load",n);a.load()}},addRetentionCategoryForm:function(k){var d=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var e={renderTo:"transaction-retentions",type:"category",canCreateNewRetention:d.configs.canCreateNewRetention,};if(d.configs.country=="colombia"){e.allowBase=true}var b=Ext.create("AL.view.transaction.FormAddRetention",e);if(k){if(e.allowBase&&e.allowBase===true&&k.calculatedBy=="percentage"){var m=b.down("[name=base]");var a=AL.math.approx(AL.math.div(AL.math.mul(k.amountSecondaryCurrency,100),k.percentage),null,d.decimalPrecision);m.setValue(a)}var g=b.down("combo[name=idRetention]");var c=g.getStore();var f=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var j=this;var h=function(){if(f.edit&&k.status==="inactive"){var n=Ext.create("AL.model.Retention",{idLocal:k.idRetention,percentage:k.percentage,calculatedBy:k.calculatedBy,name:k.name});c.add(n);g.select(n)}else{g.select(k.idRetention)}j.updateTotal()};if(c.hasLoaded()){h()}else{c.on("load",h)}var l=b.down("textfield[name=amount]");l.setValue(k.amountSecondaryCurrency)}},getTransactionType:function(){var a=Ext.ComponentQuery.query("transaction_FormTransaction")[0];return a.transactionType},saveTransaction:function(a,r){if(this.validateForms()){var m=Ext.ComponentQuery.query("transaction_FormTransaction")[0];if(m.configs.mxReplace==true){var w=Ext.ComponentQuery.query("transaction_FormTransaction checkbox[name=mx_stampTransaction]")[0];var c=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];if(w&&c){w.enable();c.enable()}}var u=m.getValues();var t=Ext.ComponentQuery.query("transaction_FormAddCategory");var y=[];Ext.each(t,function(C){var A=C.getValues();if(A.idTax==="old"){var B=C.down("combo[name=idTax]");var D=B.currentTax;if(D.get("currentId")){A.idTax=D.get("currentId");A.taxName=D.get("name");A.tax=D.get("tax")}else{delete A.idTax}}else{if(!A.idTax||A.idTax===0){delete A.idTax}}y.push(A)});var s=[];var o=Ext.ComponentQuery.query("transaction_FormAddRetention[type=category]");Ext.each(o,function(D){var B=D.down("combo[name=idRetention]");var A=D.getValues();if(B.getValue()==="old"){var C=B.currentRetention;if(C.get("currentId")){A.idRetention=C.get("currentId");A.retentionName=C.get("name");A.percentage=C.get("percentage")}else{delete A.idRetention}}if(A.idRetention){s.push(A)}});var d=Ext.ComponentQuery.query("transaction_FormAddInvoice");var x=[];Ext.each(d,function(D){var F=D.down(" > textfield[name=amount]");if(F.getValue()&&F.getValue()>0){var H=D.down("hidden[name=invoiceIdLocal]");var G=D.down("hidden[name=number]");var B={};B.invoiceIdLocal=H.getValue();B.number=G.getValue();B.amount=F.getValue();var A=[];if(m.configs.country=="argentina"){var C=D.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");A=C.getRetentionsWithMetadataEncoded()}else{var E=D.query("transaction_FormAddRetention");Ext.each(E,function(J){var I=J.down("combo[name=idRetention]");if(I.getSelectedRecord()){A.push(J.getValues())}})}B.retentions=A;B.advances=D.invoice.advances;x.push(B)}});var k=Ext.ComponentQuery.query("transaction_FormAddBill");var q=[];Ext.each(k,function(E){var G=E.down(" > textfield[name=amount]");if(G.getValue()&&G.getValue()>0){var D=E.down("hidden[name=idBill]");var B={};B.idBill=D.getValue();B.amount=G.getValue();var A=[];if(m.configs.country=="argentina"){var C=E.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");A=C.getRetentionsWithMetadataEncoded()}else{var F=E.query("transaction_FormAddRetention");Ext.each(F,function(I){var H=I.down("combo[name=idRetention]");if(H.getSelectedRecord()){A.push(I.getValues())}})}B.retentions=A;B.advances=E.bill.advances;q.push(B)}});u.categories=Ext.encode(y);u.bills=Ext.encode(q);u.invoices=Ext.encode(x);u.retentions=Ext.encode(s);var z=m.down("hidden[name=exchangeCurrency]");if(z&&z.getValue()){u.exchangeRate=z.getValue()}var g="";var e=m.transactionType;if(m.configs.mxReplace==true){u.mxReplace=m.configs.idTransaction}var l=m.down("checkbox[name=mx_stampTransaction]");if(l.checked==true){u.mx_stampTransaction="true"}if(m.configs&&m.configs.resolutionModel&&m.configs.resolutionModel==="new"){var j=m.down("numerationField[name=numerationComponent]");var v=j.getSelectedNumeration();u.idResolution=v.idLocal}var h=[translate("savingAction",true),translate("transaction")].join(" ");if(m.edit){h=[translate("editingAction",true),translate("transaction")].join(" ");if(r&&l.checked){g="/transaction/edit-"+e+"/stamp/true/format/json"}else{g="/transaction/edit-"+e+"/format/json"}}else{if(r&&l.checked){g="/transaction/"+e+"/stamp/true/format/json"}else{g="/transaction/"+e+"/format/json"}var n=Ext.get("new-comment");if(n&&n.getValue()){var b=n.getValue();u.comment=Ext.encode(b)}}var p=m.getFieldValuesAsMetadata();if(p){u.metadata=Ext.encode(p)}var f=Ext.MessageBox.show({msg:h,width:200,wait:true,waitConfig:{interval:600}});a.disable();Ext.Ajax.request({url:g,methdod:"POST",params:u,timeout:60000,success:function(A,B){var C=Ext.decode(A.responseText);if(C.success){window.location="/transaction/view/id/"+C.idTransaction}else{if(C.redirect){window.location=C.redirect}a.enable();f.hide()}},failure:function(){GlobalMsg.showErrorMessage("Advertencia","Hay un problema con tu conexión a Internet.  \n                                    Verifica si el documento se creó antes de intentarlo nuevamente.","no","warning");f.hide()}})}},updateCategoryTotal:function(n){var c=n.up("form");var j=c.down("textfield[name=price]");var a=c.down("combo[name=idTax]");var h=c.down("numberfield[name=quantity]");var d=c.down("displayfield[name=total]");var f=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var b=f.currencySign?f.currencySign:null;var l=AL.math.approx(j.getValue(),null,f.decimalPrecision);var k=a.findRecordByValue(a.getValue());var e=null;if(a.getValue()=="old"){k=a.currentTax}if(k){e=k.get("tax")}else{e=0}var g=h.getValue();if(g&&l){var m=AL.math.approx(AL.math.mul(l,g),null,f.decimalPrecision);d.setValue(Ext.util.Format.usMoney(m,f.decimalPrecision,b))}else{d.setValue(Ext.util.Format.usMoney(0,f.decimalPrecision,b))}this.updateTotal()},updateTotal:function(d){d=d||false;var a=Ext.ComponentQuery.query("transaction_FormAddInvoice");var g=Ext.ComponentQuery.query("transaction_FormAddBill");var k=Ext.ComponentQuery.query("transaction_FormAddCategory");var v=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var h={};var c=0;var j=0;var n=0;var w=0;var e={};var u=0;var t=1;var p=false;if(v.configs.multicurrency=="yes"){var q=v.down("combo[name=currency]");if(v.configs.currency!=q.getValue()){p=true;t=v.down("hidden[name=exchangeCurrency]").getValue()}}var s=null;Ext.each(a,function(y){s=y.invoice?y.invoice.decimalPrecision:null;var B=y.down(" > textfield[name=amount]");if(B.getValue()){var A=AL.math.approx(AL.math.mul(AL.math.approx(B.getValue(),null,s),t),null,s);w=AL.math.add(w,AL.math.approx(B.getValue(),null,s));u=AL.math.add(u,AL.math.approx(A,null,s));var z=y.query("transaction_FormAddRetention");var x=this.getRetentionObjects(z,e);e=x.retentions;c=x.totalRetentions;n=AL.math.add(n,AL.math.add(AL.math.approx(B.getValue(),null,s),c))}},this);Ext.each(g,function(y){var B=y.down(" > textfield[name=amount]");if(B.getValue()){s=y.bill?y.bill.decimalPrecision:null;var A=AL.math.approx(AL.math.mul(AL.math.approx(B.getValue(),null,s),t),null,s);w=AL.math.add(w,AL.math.approx(B.getValue(),null,s));u=AL.math.add(u,AL.math.approx(A,null,s));var z=y.query("transaction_FormAddRetention");var x=this.getRetentionObjects(z,e);e=x.retentions;c=x.totalRetentions;n=AL.math.add(n,AL.math.add(AL.math.approx(B.getValue(),null,s),c))}},this);Ext.each(k,function(x){s=v.decimalPrecision;var D=x.down("combo[name=idTax]");var F=x.down("textfield[name=price]");var A=x.down("numberfield[name=quantity]");var B=D.findRecordByValue(D.getValue());if(D.getValue()=="old"){B=D.currentTax}var y=AL.math.approx(AL.math.mul(AL.math.approx(F.getValue(),null,s),A.getValue()),null,s);var E=AL.math.approx(AL.math.mul(AL.math.approx(F.getValue(),null,s),t),null,s);var z=AL.math.approx(AL.math.mul(E,A.getValue()),null,s);n=AL.math.add(n,y);if(B){w=AL.math.add(w,AL.math.approx(AL.math.mul(y,AL.math.add(1,AL.math.div(B.get("tax"),100))),null,s));u=AL.math.add(u,AL.math.approx(AL.math.mul(z,AL.math.add(1,AL.math.div(B.get("tax"),100))),null,s));var C=B.get("name")+B.get("tax");if(h[C]){h[C].value=AL.math.add(h[C].value,AL.math.approx(AL.math.mul(y,AL.math.div(B.get("tax"),100)),null,s))}else{h[C]={label:B.get("name")+" ("+Ext.util.Format.round(B.get("tax"),2)+"%)",value:AL.math.approx(AL.math.mul(y,AL.math.div(B.get("tax"),100)),null,s)}}}else{w=AL.math.add(w,y);u=AL.math.add(u,z)}},this);var b=v.currencySign?v.currencySign:null;var l=Ext.ComponentQuery.query("transaction_FormAddRetention[type=category]");if(l.length>0&&!d){var o=this.getRetentionObjects(l);e=o.retentions;c=o.totalRetentions;j=AL.math.approx(AL.math.mul(o.totalRetentions,t),s);w=AL.math.sub(w,c);u=AL.math.sub(u,j)}this.removeTotalContainer();var f=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];var m=Ext.get("transaction-total-wrapper");m.show();var r=v.decimalPrecision;if((g.length&&g)||(a.length&&a)){if(r<=2){r=2}}f.addItem({label:"Subtotal",value:n,important:true,decimalPrecision:r,currencySign:b});Ext.Object.each(h,function(x,y){y.value=AL.math.approx(y.value,null,r);y.decimalPrecision=r;y.currencySign=b;f.addItem(y)});Ext.Object.each(e,function(x,y){y.decimalPrecision=r;y.currencySign=b;f.addItem(y)});f.addItem({label:"Total",value:w,important:true,decimalPrecision:r,currencySign:b});if(p){f.addItem({label:"Total "+v.configs.currency,value:AL.math.approx(u,null,v.decimalPrecision),important:true,decimalPrecision:v.decimalPrecision})}return{subTotal:n,taxes:h,total:w}},getRetentionObjects:function(c,b){var e=0;var a=(b)?b:{};var d=Ext.ComponentQuery.query("transaction_FormTransaction")[0];Ext.each(c,function(k){var h=k.down("combo[name=idRetention]");var m=k.down("textfield[name=amount]");var j=k.up("form");var l=d.decimalPrecision;if(j&&j.invoice){l=j.invoice.decimalPrecision}else{if(j&&j.bill){l=j.bill.decimalPrecision}}var f=h.getSelectedRecord();if(h.getValue()==="old"){f=h.currentRetention}if(f){e=AL.math.add(e,AL.math.approx(m.getValue(),null,l));var g=f.get("name")+(f.get("calculatedBy")=="percentage"?f.get("percentage"):"");if(a[g]){a[g].value=AL.math.sub(a[g].value,AL.math.approx(m.getValue(),null,l))}else{a[g]={label:f.get("name")+(f.get("calculatedBy")=="percentage"?(" ("+Ext.util.Format.round(f.get("percentage"),4)+"%)"):""),value:AL.math.mul(-1,AL.math.approx(m.getValue(),null,l))}}}});return{totalRetentions:e,retentions:a}},getTotalIva:function(){var c=Ext.ComponentQuery.query("transaction_FormAddCategory");var b=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var a=0;Ext.each(c,function(d){var g=d.down("combo[name=idTax]");var f=d.down("textfield[name=price]");var j=d.down("numberfield[name=quantity]");var e=g.findRecordByValue(g.getValue());if(f.getValue()&&j.getValue()){var h=AL.math.approx(AL.math.mul(AL.math.approx(f.getValue(),null,b.decimalPrecision),j.getValue()),null,b.decimalPrecision);if(e){if(e.get("idTaxReference")==1||e.get("idTaxReference")==4||e.get("idTaxReference")==8){a=AL.math.add(a,AL.math.approx(AL.math.mul(h,AL.math.div(e.get("tax"),100)),null,b.decimalPrecision))}}}});return a},getSubtotalItemsWithIva:function(){var c=Ext.ComponentQuery.query("transaction_FormAddCategory");var b=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var a=0;Ext.each(c,function(d){var g=d.down("combo[name=idTax]");var f=d.down("textfield[name=price]");var j=d.down("numberfield[name=quantity]");var e=g.findRecordByValue(g.getValue());if(f.getValue()&&j.getValue()){var h=AL.math.approx(AL.math.mul(AL.math.approx(f.getValue(),null,b.decimalPrecision),j.getValue()));if(e){if(e.get("idTaxReference")==3&&e.get("tax")>0){a=AL.math.add(a,h)}}}});return a},calculateTotalAmountFromRetentions:function(d){var b=(d.invoice)?d.invoice:d.bill;var f=d.down(" > textfield[name=amount]");if(f.calculateFromRetentions){var g=d.query("transaction_FormAddRetention textfield[name=amount]");var a=0;Ext.each(g,function(j){var h=AL.math.approx(j.getValue(),null,b.decimalPrecision);a=AL.math.add(a,h)});var e=d.missingAmount;var c=AL.math.sub(e,a);if(AL.math.comp(c,0)>0){f.setValue(AL.math.approx(c,null,b.decimalPrecision))}}},removeTotalContainer:function(){var b=Ext.ComponentQuery.query("displayPanel_TotalSummaryBoard")[0];var a=Ext.get("transaction-total-wrapper");b.removeAll();a.setStyle({display:"none"})},removeRetentionsContainer:function(){var a=Ext.ComponentQuery.query("transaction_FormAddRetention");Ext.each(a,function(b){b.destroy()})},removeBillForms:function(a){var b=Ext.ComponentQuery.query("transaction_FormAddBill");Ext.each(b,function(d){d.destroy()});if(a){var c=Ext.get("transaction-to-bills-wrapper");if(c){c.setStyle({display:"none"})}}},removeInvoiceForms:function(a){var b=Ext.ComponentQuery.query("transaction_FormAddInvoice");Ext.each(b,function(d){d.destroy()});if(a){var c=Ext.get("transaction-to-invoices-wrapper");if(c){c.setStyle({display:"none"})}}},removeCategoryForms:function(a){var c=Ext.ComponentQuery.query("transaction_FormAddCategory");Ext.each(c,function(d){d.destroy()});if(a){var b=Ext.get("transaction-to-categories-wrapper");if(b){b.setStyle({display:"none"})}}},setTransactionMessage:function(b,a){var c=Ext.get("transaction-message");c.setHTML(b);c.set({"class":""});if(a&&a.cls){c.set({"class":a.cls})}},clearTransactionMessage:function(){this.setTransactionMessage("")},prepareEdit:function(b){var a=this;GlobalLoadMask.show("transaction-wrapper");Ext.Ajax.request({timeout:120000,url:"/transaction/retrieve-for-edit/idTransaction/"+b+"/format/json",success:function(d,f){var t=Ext.decode(d.responseText);if(t.success){var u=t.results;var r=Ext.ComponentQuery.query("transaction_FormTransaction")[0];r.decimalPrecision=u.decimalPrecision;if(u.exchangeRate){var p=r.down("hidden[name=exchangeCurrency]");if(p){p.exchangeRateForEditTransaction=u.exchangeRate}}var v=r.down("hidden[name=idTransaction]");v.setValue(u.idLocal);var A=r.down("combo[name=idAccount]");var q=A.getStore();if(q.hasLoaded()){A.select(u.idAccount);if(u.conciliated){A.setReadOnly(true);A.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}}else{q.on("load",function(){A.select(u.idAccount);if(u.conciliated){A.setReadOnly(true);A.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}})}if(u.idClient){var e=r.down("combo[name=idClient]");var s=e.getStore();var j=Ext.create("AL.model.Client",{idLocal:u.idClient,name:u.name});s.add(j);e.select(j)}if(u.paymentMethod){var l=r.down("combo[name=paymentMethod]");if(u.paymentMethod=="deposit"){l.bindStore(Ext.create("AL.store.DocumentPaymentMethods",{country:r.configs.country,includeDepositRecord:true,type:"transaction",transactionType:r.transactionType}))}l.select(u.paymentMethod)}var y=AL.date(u.date);y=Ext.Date.format(y,"d/m/Y");var m=r.down("datefield[name=date]");m.setValue(y);if(r.configs&&r.configs.resolutionModel&&r.configs.resolutionModel==="new"){var n=r.down("numerationField[name=numerationComponent]");n.values.numerationIdLocal=u.resolutionIdLocal;n.values.prefix=u.prefix;n.values.number=u.number;n.selectNumerationByIdLocal(u.resolutionIdLocal)}else{var h=r.down("textfield[name=number]");h.setValue(u.number)}var k=r.down("textarea[name=observations]");k.setValue(u.observations);var c=r.down("textarea[name=anotation]");c.setValue(u.anotation);var o=r.down("checkbox[name=mx_stampTransaction]");if(u.mx_stampTransaction){o.setValue(true)}if(r.configs.multicurrency=="yes"){var z=r.down("combo[name=currency]");z.show();var g=z.getStore();if(g.hasLoaded()){r.companyCurrencies=g.getRange(0,g.getCount());a.renderCurrenciesEdit(z,u)}else{g.load({callback:function(){r.companyCurrencies=g.getRange(0,g.getCount());a.renderCurrenciesEdit(z,u)}})}}else{var A=r.down("combo[name=idAccount]"),q=A.getStore();if(q.hasLoaded()){A.select(u.idAccount);if(u.conciliated){A.setReadOnly(true);A.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}}else{q.on("load",function(){A.select(u.idAccount);if(u.conciliated){A.setReadOnly(true);A.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}})}if(u.categoriesPayed.length>0){a.renderCategoriesForEdit(u.categoriesPayed);a.renderRetentionsForEdit(u.retentions);r.type="categories"}else{if(u.invoicesPayed.length>0){for(var w=0;w<u.invoicesPayed.length;w++){if(u.invoicesPayed[w]){u.invoicesPayed[w].transactionStatus=u.status}}a.renderInvoicesForEdit(u.invoicesPayed);r.type="invoices"}else{if(u.billsPayed.length>0){for(var w=0;w<u.billsPayed.length;w++){if(u.billsPayed[w]){u.billsPayed[w].transactionStatus=u.status}}a.renderBillsForEdit(u.billsPayed);r.type="bills"}else{GlobalLoadMask.hide("transaction-wrapper")}}}}var x=r.configs.costCenter.isActive;if(x){var B=r.down("combo[name=idCostCenter]");if(B&&u.idCostCenter){a.setCostCenterField(B,u.idCostCenter)}}}},failure:function(){}})},prepareToClone:function(b){var a=this;GlobalLoadMask.show("transaction-wrapper");Ext.Ajax.request({url:"/transaction/retrieve-for-clone/idTransaction/"+b+"/format/json",success:function(d,f){var r=Ext.decode(d.responseText);if(r.success){var s=r.results;var p=Ext.ComponentQuery.query("transaction_FormTransaction")[0];p.decimalPrecision=s.decimalPrecision;var t=p.down("hidden[name=idTransaction]");t.setValue(s.idLocal);var z=p.down("combo[name=idAccount]");var o=z.getStore();var v=function(){z.setValue(s.idAccount);if(s.conciliated){z.setReadOnly(true);z.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}};if(o.hasLoaded()){v()}else{o.on("load",function(){v()})}if(s.idClient){var e=p.down("combo[name=idClient]");var q=e.getStore();var j=Ext.create("AL.model.Client",{idLocal:s.idClient,name:s.name});q.add(j);e.select(j)}if(s.paymentMethod){var l=p.down("combo[name=paymentMethod]");if(s.paymentMethod=="deposit"){l.bindStore(Ext.create("AL.store.DocumentPaymentMethods",{country:p.configs.country,includeDepositRecord:true}))}l.select(s.paymentMethod)}var x=AL.date(s.date);x=Ext.Date.format(x,"d/m/Y");var m=p.down("datefield[name=date]");m.setValue(x);var h=p.down("textfield[name=number]");h.setValue(s.number);var k=p.down("textarea[name=observations]");k.setValue(s.observations);var c=p.down("textarea[name=anotation]");c.setValue(s.anotation);var n=p.down("checkbox[name=mx_stampTransaction]");if(s.mx_stampTransaction){n.setValue(true)}if(p.configs.multicurrency=="yes"){var y=p.down("combo[name=currency]");y.show();var g=y.getStore();var A=function(){p.companyCurrencies=g.getRange(0,g.getCount());a.renderCurrenciesEdit(y,s)};if(g.hasLoaded()){A()}else{g.on("load",function(){A()})}}else{var z=p.down("combo[name=idAccount]"),o=z.getStore();if(o.hasLoaded()){z.select(s.idAccount);if(s.conciliated){z.setReadOnly(true);z.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}}else{o.on("load",function(){z.select(s.idAccount);if(s.conciliated){z.setReadOnly(true);z.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}})}if(s.categoriesPayed.length>0){a.renderCategoriesForEdit(s.categoriesPayed);a.renderRetentionsForEdit(s.retentions);p.type="categories"}else{if(s.invoicesPayed.length>0){for(var u=0;u<s.invoicesPayed.length;u++){if(s.invoicesPayed[u]){s.invoicesPayed[u].transactionStatus=s.status}}a.renderInvoicesForEdit(s.invoicesPayed);p.type="invoices"}else{if(s.billsPayed.length>0){for(var u=0;u<s.billsPayed.length;u++){if(s.billsPayed[u]){s.billsPayed[u].transactionStatus=s.status}}a.renderBillsForEdit(s.billsPayed);p.type="bills"}else{GlobalLoadMask.hide("transaction-wrapper")}}}var w=p.configs.costCenter.isActive;if(w){var B=p.down("combo[name=idCostCenter]");if(B&&s.idCostCenter){a.setCostCenterField(B,s.idCostCenter)}}}}},failure:function(){}})},setTransactionQuestionValue:function(b){var d=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var c;if(d.transactionType==="out"){c=Ext.ComponentQuery.query("transaction_TransactionOutQuestion")[0]}else{c=Ext.ComponentQuery.query("transaction_TransactionInQuestion")[0]}var a=c.down("radio[inputValue="+b+"]");a.setValue(true)},renderCategoriesForEdit:function(a){this.setTransactionQuestionValue("category");var b=false;this.removeCategoryForms(b);Ext.each(a,function(c){this.addCategoryForm(c,"yes")},this);GlobalLoadMask.hide("transaction-wrapper")},renderRetentionsForEdit:function(a){if(a&&a.length>0){Ext.each(a,function(b){this.addRetentionCategoryForm(b)},this);this.updateTotal()}},renderBillsForEdit:function(b){var a=this;this.application.addListener("billsLoaded",function(f){var d=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var c=d.getValue();if(c&&b[0]&&c===b[0].idClient){var j=d.up("form");var e=j.down("combo[name=currency]");var h=e.getSelectedRecord();if(h&&h.get("code")==b[0].currencyCode){Ext.each(b,function(x){var n=Ext.ComponentQuery.query("transaction_FormAddBill hidden[name=idBill][value="+x.idLocal+"]")[0];var p=x.amount;var v=0;var t=[];if(x.transactionStatus=="void"){p=0}if(j.configs&&j.configs.country=="argentina"&&x.retentionsSupported){for(var q=0;q<x.retentionsSupported.length;q++){var u=x.retentionsSupported[q];if(u.supportDocument&&u.supportDocument.idLocal==j.id){t.push(u);v=AL.math.add(v,u.amount)}}}var s=AL.math.add(AL.math.add(p,x.missingAmount),v);var l=AL.math.sub(x.totalPayed,p);if(n){var k=n.up("form");var r=k.down("displayfield[name=totalPayed]");var o=k.down("displayfield[name=missingAmount]");var m=k.down(" > textfield[name=amount]");o.setValue(Ext.util.Format.usMoney(s,x.decimalPrecision));r.setValue(Ext.util.Format.usMoney(l,x.decimalPrecision));m.suspendEvents();m.setValue(x.amount);m.resumeEvents();k.missingAmount=s;var w=k.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");w.setRetentionsForShowOnPanel(t)}else{x.missingAmount=s;x.amount=x.amount;x.totalPayed=l;a.addBillForm(x,"yes")}})}else{if(f&&f.length===0){GlobalLoadMask.hide("transaction-wrapper");var g=Ext.get("transaction-to-bills-wrapper");g.setStyle({display:"none"});a.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("provider")}),"<strong>"+translate("bills")+"</strong>"+translate("pendingToPay")].join(" "),{cls:"warning"})}}a.updateTotal()}else{if(f.length===0){GlobalLoadMask.hide("transaction-wrapper");var g=Ext.get("transaction-to-bills-wrapper");g.setStyle({display:"none"});a.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("provider")}),"<strong>"+translate("bills")+"</strong> "+translate("pendingToPay")].join(" "),{cls:"warning"})}}});this.setTransactionQuestionValue("bill")},renderInvoicesForEdit:function(b){var a=this;this.application.addListener("invoicesLoaded",function(f){GlobalLoadMask.hide("transaction-wrapper");var d=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var c=d.getValue();if(c&&b[0]&&c===b[0].idClient){var j=d.up("form");var e=j.down("combo[name=currency]");var h=e.getSelectedRecord();if(h&&h.get("code")==b[0].currencyCode){Ext.each(b,function(q){var o=Ext.ComponentQuery.query("transaction_FormAddInvoice hidden[name=invoiceIdLocal][value="+q.idLocal+"]")[0];var r=q.amount;var x=0;var v=[];var m=j.down("checkbox[name=mx_stampTransaction]");if(q.transactionStatus=="void"||j.configs.mxReplace==true||(m&&m.getValue())){r=0}if(j.configs&&j.configs.country=="argentina"&&q.retentionsSupported){for(var s=0;s<q.retentionsSupported.length;s++){var w=q.retentionsSupported[s];if(w.supportDocument&&w.supportDocument.idLocal==j.id){v.push(w);x=AL.math.add(x,w.amount)}}}var u=AL.math.add(AL.math.add(r,q.missingAmount),x);var l=AL.math.sub(q.totalPayed,r);if(o){var k=o.up("form");var t=k.down("displayfield[name=totalPayed]");var p=k.down("displayfield[name=missingAmount]");var n=k.down(" > textfield[name=amount]");p.setValue(Ext.util.Format.usMoney(u,q.decimalPrecision));t.setValue(Ext.util.Format.usMoney(l,q.decimalPrecision));n.suspendEvents();n.setValue(q.amount);n.resumeEvents();k.missingAmount=u;var y=k.down("panelForApplyRetentionsComponent[name=panelForApplyRetentions]");y.setRetentionsForShowOnPanel(v)}else{q.missingAmount=u;q.amount=q.amount;q.totalPayed=l;a.addInvoiceForm(q,"yes")}})}else{if(f&&f.length===0){GlobalLoadMask.hide("transaction-wrapper");var g=Ext.get("transaction-to-invoices-wrapper");g.setStyle({display:"none"});a.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("clientA")})," <strong>"+translate("invoice")+"</strong> "+translate("pendingToPay")].join(" "),{cls:"warning"})}}a.updateTotal()}else{if(f&&f.length===0){GlobalLoadMask.hide("transaction-wrapper");var g=Ext.get("transaction-to-invoices-wrapper");g.setStyle({display:"none"});a.setTransactionMessage([translate("theSelectedClientOrProviderDoesNotHave",true,{clientOrProvider:translate("clientA")})+" <strong>"+translate("invoice")+"</strong>"+translate("pendingToPay")].join(" "),{cls:"warning"})}}});this.setTransactionQuestionValue("invoice")},validateForms:function(){var a=true;var b=translate("error",true);var j=translate("checkTheFieldsMarkedInRed",true);var k=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var m=Ext.ComponentQuery.query("transaction_TransactionOutQuestion")[0];if(!m){m=Ext.ComponentQuery.query("transaction_TransactionInQuestion")[0]}var e=Ext.ComponentQuery.query("transaction_FormAddInvoice");var o=Ext.ComponentQuery.query("transaction_FormAddBill");var f=Ext.ComponentQuery.query("transaction_FormAddCategory");var g=Ext.ComponentQuery.query("transaction_FormAddRetention[type=category]");if(!k.getForm().isValid()){a=false}var n=k.down("combo[name=idClient]");if(n.getValue()&&!n.getSelectedRecord()){a=false;n.markInvalid(["Si vas a asociar un contacto, debes","seleccionarlo de la lista"].join(" "))}var l=k.down("combo[name=idAccount]");if(!l.getSelectedRecord()){a=false;l.markInvalid(translate("theBankAccountAssociatedWithThePaymentIsRequired",true))}if(!m.getForm().isValid()){a=false}var h=0;Ext.each(e,function(p){var s=p.invoice;var r=p.down(" > textfield[name=amount]");if(r.getValue()&&AL.math.approx(r.getValue(),null,s.decimalPrecision)!=0){h++;if(p.getForm().isValid()){var q=p.query("transaction_FormAddRetention[type=invoice]");Ext.each(q,function(u){var t=u.down("combo[name=idRetention]");if(t.getSelectedRecord()){var v=u.down("textfield[name=amount]");if(!v.getValue()||AL.math.approx(v.getValue(),null,s.decimalPrecision)==0){v.markInvalid("Debes especificar un valor para la "+translate("retention"));a=false}}})}else{a=false}}});Ext.each(o,function(p){var s=p.bill;var r=p.down(" > textfield[name=amount]");if(r.getValue()&&AL.math.approx(r.getValue(),null,s.decimalPrecision)!=0){h++;if(p.getForm().isValid()){var q=p.query("transaction_FormAddRetention[type=bill]");Ext.each(q,function(u){var t=u.down("combo[name=idRetention]");if(t.getSelectedRecord()){var v=u.down("textfield[name=amount]");if(!v.getValue()||AL.math.approx(v.getValue(),null,s.decimalPrecision)==0){v.markInvalid("Debes especificar un valor para la "+translate("retention"));a=false}}})}else{a=false}}});Ext.each(f,function(p){h++;if(!p.getForm().isValid()){a=false}});Ext.each(g,function(q){var p=q.down("combo[name=idRetention]");if(p.getSelectedRecord()){var r=q.down("textfield[name=amount]");if(!r.getValue()||AL.math.approx(r.getValue(),null,k.decimalPrecision)==0){r.markInvalid("Debes especificar un valor para la "+translate("retention"));a=false}}});if(a&&h===0){a=false;var d=(k.transactionType==="out")?translate("bill"):translate("invoice");b="Error";j=translate("theTransactionMustBeAssociatedWithAtLeastOne",true)+" "+d+" "+translate("or")+" "+translate("category")}if(a){var c=this.updateTotal();if(AL.math.comp(c.total,0)<0){a=false;b="Error";j=translate("theTotalOfTheTransactionMustBePositive",true)}}if(!a){GlobalMsg.showNotification({title:b,text:j,type:"error"})}return a},currencyComboChanged:function(t,f,g){var c=t.up("form");f=f=="no"?"no":"yes";var m=c.down("displayfield[name=exchangeCurrencyDisplay]");var j=c.down("hidden[name=exchangeCurrency]");var e=t.getSelectedRecord();var k=this.application;var b=c.down("combo[name=idAccount]").getSelectedRecord();if((e&&e.get("code")&&e.get("code")!=c.configs.currency)||(e&&b&&b.get("currencyCode")&&e.get("code")!=c.configs.currency&&b.get("currencyCode")!=e.get("code"))){var h=null;var n=null;if(e&&e.get("code")&&e.get("code")!=c.configs.currency){h=e.get("code");n=Ext.util.Format.round(e.get("exchangeRate"),8)}else{if(b&&b.get("currencyCode")!=e.get("code")){h=b.get("currencyCode");var d=t.getStore();var r=d.findRecord("code",h);var s=null;if(j.exchangeRateForEditTransaction){s=j.exchangeRateForEditTransaction;r.set("exchangeRate",s);j.exchangeRateForEditTransaction=null}else{s=r.get("exchangeRate")}n=r?Ext.util.Format.round(s,8):1}}m.show();m.setValue("1 "+h+" = "+n+" "+c.configs.currency+'<div class="editExchangeRate"><a id="editExchangeRate" href="#"><img src="https://cdn1.getsoft.app/images/icons/page_edit.png"></a></div>');j.setValue(n);var p=Ext.get("editExchangeRate");if(!g){g=e.get("code")}if(p){p.on("click",function(v){v.preventDefault();var u={};u.currency=g;u.initiator=m;u.currencyRecord=e;k.fireEvent("editExchangeRate",u)})}}else{m.hide();j.setValue(null)}if(f=="yes"){var o=Ext.get("transaction-to-bills-wrapper");var l=Ext.get("transaction-to-invoices-wrapper");this.removeInvoiceForms(true);this.removeBillForms(true);var q=Ext.ComponentQuery.query("transaction_TransactionInQuestion radiogroup")[0];if(!q){q=Ext.ComponentQuery.query("transaction_TransactionOutQuestion radiogroup")[0]}var a=c.down("combo[name=idClient]");if(q.getValue().associateTo==="invoice"){if(a&&a.getSelectedRecord()){this.removeInvoiceForms(true);l.show();this.addInvoiceForms()}else{this.removeTotalContainer();l.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aSalesInvoice")+" <strong>"+translate("invoice")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",true,{clientOrProvider:translate("clientA")})+" "+translate("pendingSalesInvoice")].join(" "),{cls:"yellow"})}}else{if(q.getValue().associateTo==="bill"){if(a&&a.getSelectedRecord()){this.removeBillForms(true);o.show();this.addBillForms()}else{this.removeTotalContainer();o.setStyle({display:"none"});this.setTransactionMessage([translate("toAssociateThisPaymentTo",true)+" "+translate("aBill")+" <strong>"+translate("bill")+"</strong>, "+translate("youMustFirstSelectAClientOrProviderThatHas",false,{clientOrProvider:translate("provider")})+" "+translate("pendingSupplierInvoice")].join(" "),{cls:"yellow"})}}}}},renderCurrenciesEdit:function(f,d){var a=f.up("form");var h=f.getStore();var g=h.findRecord("code",d.currencyCode);var b=a.down("hidden[name=exchangeCurrency]");if(g){g.set("exchangeRate",d.exchangeRate);f.suspendEvents();f.select(g);f.resumeEvents();this.currencyComboChanged(f,"no")}else{if(d.currencyCode){g=Ext.create("AL.model.CompanyCurrency",{exchangeRate:d.exchangeRate,code:d.currencyCode,symbol:d.currencySymbol});if(!g){g=Ext.create("AL.model.CompanyCurrency",{exchangeRate:1,code:a.configs.currency,name:a.configs.nameCurrency})}if(g&&g.code){h.add(g)}f.suspendEvents();f.select(g);f.resumeEvents();this.currencyComboChanged(f,"no")}}b.setValue(d.exchangeRate);var j=a.down("combo[name=idAccount]");var e=j.getStore();if(e.hasLoaded()){j.setValue(d.idAccount);if(d.conciliated){j.setReadOnly(true);j.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}}else{e.on("load",function(){j.setValue(d.idAccount);if(d.conciliated){j.setReadOnly(true);j.setFieldStyle("background: #EEEEEE; border: 1px solid #CCCCCC;")}})}if(d.categoriesPayed.length>0){this.renderCategoriesForEdit(d.categoriesPayed);this.renderRetentionsForEdit(d.retentions);a.type="categories"}else{if(d.invoicesPayed.length>0){for(var c=0;c<d.invoicesPayed.length;c++){if(d.invoicesPayed[c]){d.invoicesPayed[c].transactionStatus=d.status}}this.renderInvoicesForEdit(d.invoicesPayed);a.type="invoices"}else{if(d.billsPayed.length>0){for(var c=0;c<d.billsPayed.length;c++){if(d.billsPayed[c]){d.billsPayed[c].transactionStatus=d.status}}this.renderBillsForEdit(d.billsPayed);a.type="bills"}else{GlobalLoadMask.hide("transaction-wrapper")}}}},calculateRetentionCategory:function(c,e){var a=c.up("form");var d=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var j=a.down("textfield[name=amount]");var f=e[0];var g=0;if(f.get("calculatedBy")!="percentage"){return}if(f.get("idRetentionReference")==1||f.get("idRetentionReference")==8||f.get("idRetentionReference")==25){g=this.getTotalIva()}else{if(f.get("idRetentionReference")==6){g=this.getSubtotalItemsWithIva()}else{var b=this.updateTotal(true);g=d&&d.configs.country==="peru"?b.total:b.subTotal}}if(d.configs.country==="colombia"){var k=a.down("[name=base]");k.setValue(AL.math.approx(g,null,d.decimalPrecision))}var h=AL.math.approx(AL.math.mul(g,AL.math.div(f.get("percentage"),100)),null,d.decimalPrecision);j.setValue(h)},validateRetentionReference:function(a){return a&&(a.get("idRetentionReference")==1||a.get("idRetentionReference")==8||a.get("idRetentionReference")==6||a.get("idRetentionReference")==25)},getFieldIdLocal:function(b,a){if(a=="invoice"){return b.down("hidden[name=invoiceIdLocal]")}return b.down("hidden[name=idBill]")},calculateRetentionOfInvoiceOrBill:function(g,h){var l=g.up("form");var j=h[0];var k=0;if(j.get("calculatedBy")!="percentage"){return}if(this.validateRetentionReference(j)){var f=l.up("form");var a=f.invoice?"invoice":"bill";var e=this.getFieldIdLocal(f,a);var c=e.getValue();var b="/"+a+"/retrieve-total-iva/id/"+c+(j.get("idRetentionReference")==6?"/subTotalWithIva/true":"")+"/format/json";Ext.Ajax.request({url:b,success:function(p,r){var u=Ext.decode(p.responseText);if(u.success){k=u.results;var q=l.down("textfield[name=amount]");var t=AL.math.mul(k,AL.math.div(j.get("percentage"),100));q.setValue(AL.math.approx(t,null,f[a].decimalPrecision));if(l.allowBase&&l.allowBase===true){var s=l.down("[name=base]");s.setValue(AL.math.approx(k,null,f[a].decimalPrecision))}}}})}else{var d=l.up("form");var a=d.invoice?"invoice":"bill";k=d[a+"SubTotal"];var n=l.down("textfield[name=amount]");var m=AL.math.mul(k,AL.math.div(j.get("percentage"),100));n.setValue(AL.math.approx(m,null,d[a].decimalPrecision));if(l.allowBase&&l.allowBase===true){var o=l.down("[name=base]");o.setValue(AL.math.approx(k,null,d[a].decimalPrecision))}}},calculateRetentionAfterRetentionCreated:function(c,d,a){if(c){var b=c.type?c.type:"";switch(b){case"category":this.calculateRetentionCategory(d,a);break;case"bill":case"invoice":this.calculateRetentionOfInvoiceOrBill(d,a);break}}},addAnotherInvoice:function(){var l=Ext.ComponentQuery.query("transaction_FormTransaction combo[name=idClient]")[0];var g=l.up("form");var d=Ext.ComponentQuery.query("combo[name=currency]")[0];var j=d.getValue();var m="false";if(g.configs.country=="mexico"){var c=Ext.ComponentQuery.query("checkbox[name=mx_stampTransaction]")[0];if(c.checked==true){var m="true"}}var h="";if(g.invoiceIdLocal&&m!="true"){h="/number/"+g.invoiceIdLocal}if(g.configs.oldestFirst=="yes"){h=h+"/oldestFirst/yes"}var b=Ext.create("AL.view.transaction.FormAddInvoice",{renderTo:"transaction-to-invoices",isAddManual:true});var f=b.down("combo[name=number]");var e="/invoice/retrieve-open-by-client/idClient/"+l.getValue()+"/currency/"+j+"/checkCurrency/true/mxParcialities/"+m+"/limit/100/format/json"+h;var a={autoLoad:false,pageSize:100,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",url:e,reader:{type:"json",root:"results"}}};var k=Ext.create("AL.store.Invoices",a);f.store=k;f.emptyText="Buscar "+translate("invoice")+"...";f.editable=true;f.triggerCls="x-form-search-trigger";f.queryMode="remote";f.typeAhead=true;f.forceSelection=true;f.listConfig={tpl:'<tpl for="."><div class="x-boundlist-item">{invoiceNumber}</div></tpl>',width:250,height:200,loadingText:"Buscando...",emptyText:'<div style="padding:3px 10px 10px !important; color: #666">La búsqueda no obtuvo ningún resultado</div>',cls:"search-input-list"}},invoiceSelected:function(b,d){var h=Ext.ComponentQuery.query("transaction_FormTransaction")[0];var f=d[0];var e=f.data;var a=b.up("form");var j=this.validateDifferentInvoices(b,true);if(j){if(a){a.invoiceSubTotal=f.get("subTotal");a.invoiceDecimalPrecision=f.get("decimalPrecision");a.missingAmount=f.get("missingAmount");a.setInvoice(f.data);a.getForm().setValues({invoiceIdLocal:e.idLocal,number:e.number,invoiceNumber:e.invoiceNumber,total:Ext.util.Format.usMoney(e.total,e.decimalPrecision,e.currencySymbol),missingAmount:Ext.util.Format.usMoney(e.missingAmount,e.decimalPrecision,e.currencySymbol),totalPayed:Ext.util.Format.usMoney(e.totalPayed,e.decimalPrecision,e.currencySymbol),amount:e.amount})}var g=a.down("button[name=addRetention]");var k=a.down("button[name=viewRetentionsApplied]");var c=a.down("textfield[name=amount]");if(h&&h.configs&&h.configs.country==="republicaDominicana"&&e.retentions&&e.retentions.length>0){g.hide()}else{if(!e.retentionsAreEditable){g.hide()}else{g.show()}}if(h&&h.configs&&h.configs.country==="republicaDominicana"){if(e.retentionsSupported&&e.retentionsSupported.length>0){k.show()}else{k.hide()}}else{if(!e.retentionsAreEditable){k.hide()}else{k.show()}}if(c){c.enable()}}},validateDifferentInvoices:function(d,a){var c=true;var b=Ext.ComponentQuery.query("transaction_FormAddInvoice combo[name=number]");setTimeout(function(){Ext.each(b,function(g){if(g.getId()!=d.getId()){if(d.getValue()==g.getValue()){c=false;if(a){d.setValue(null);d.clearInvalid();d.markInvalid(translate("theInvoice",true)+" "+translate("invoice")+" ya ha sido seleccionada")}var f=d.up("form");f.getForm().setValues({invoiceIdLocal:"",number:"",invoiceNumber:"",total:"",missingAmount:"",totalPayed:"",amount:""});var j=f.down("button[name=addRetention]");j.hide();var k=f.down("button[name=viewRetentionsApplied]");k.hide();var h=f.down("textfield[name=amount]");h.disable();var e=f.down("button[action=apply-retentions-suggested]");e.hide()}}})},100);return c},loadCostCenterRecord:function(a,c){var b=this;Ext.Ajax.request({url:"/cost-center/retrieve-one/id/"+a+"/format/json",success:function(e,g){var j=Ext.decode(e.responseText);if(j.success){var f=j.results;var d=Ext.create("AL.model.CostCenter",f);var h=c.getStore();if(h.isLoading()){h.on("load",function(){h.insert(0,d);c.select(d)})}else{h.insert(0,d);c.select(d)}}},failure:function(){Ext.MessageBox.alert(translate("costCenterNotFound",true))}})},setCostCenterField:function(e,c){var b=e.getStore();var d=this;if(!b.hasLoaded()){b.load({callback:function(){var f=b.findRecord("idLocal",c);if(!f){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(f);e.resumeEvents()}}})}else{var a=b.findRecord("idLocal",c);if(!a){d.loadCostCenterRecord(c,e)}else{e.suspendEvents();e.select(a);e.resumeEvents()}}},});